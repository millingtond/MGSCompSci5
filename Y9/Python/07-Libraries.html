<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Year 9 Python Course - Section 7: Libraries</title>
    
    <!-- External Dependencies (Required - DO NOT MODIFY VERSIONS) -->
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/solarized.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.min.css">

    <!-- Sound Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    
    <!-- Pyodide -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    
    <!-- CodeMirror JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/python-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/brace-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/indent-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.min.js"></script>
    
    <!-- Font for dyslexia support -->
    <link href="https://fonts.googleapis.com/css2?family=OpenDyslexic:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS Variables for Libraries Theme */
        :root {
            --primary-color: #2563eb; /* Blue for libraries */
            --primary-dark: #1d4ed8;
            --primary-light: #60a5fa;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --xp-color: #8b5cf6;
            --bg-primary: #eff6ff;
            --bg-secondary: white;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        body.dyslexic-font {
            font-family: 'OpenDyslexic', sans-serif;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem 0;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: 'import math random time';
            position: absolute;
            font-size: 90px;
            opacity: 0.1;
            right: -50px;
            top: -10px;
            transform: rotate(-15deg);
            font-family: monospace;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .header-left h1 {
            font-size: 2rem;
            margin-bottom: 0.25rem;
            font-weight: 700;
        }

        .header-left p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        /* User Stats */
        .user-stats {
            display: flex;
            gap: 2rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .stat-item {
            text-align: center;
            min-width: 80px;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .xp-bar {
            width: 100px;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .xp-fill {
            height: 100%;
            background: var(--xp-color);
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        /* Progress Section */
        .progress-section {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem 2rem 1rem 2rem;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            transition: width 0.5s ease;
            border-radius: 5px;
        }

        .badges-preview {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .badge {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            filter: grayscale(100%);
            opacity: 0.5;
        }

        .badge.earned {
            filter: grayscale(0%);
            opacity: 1;
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .badge:hover {
            transform: scale(1.1);
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 300px);
        }

        /* Sidebar */
        .sidebar {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            height: fit-content;
            position: sticky;
            top: 2rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--primary-light);
        }

        .task-list {
            list-style: none;
            margin-bottom: 1.5rem;
        }

        .task-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-item:hover {
            background: var(--bg-primary);
            border-color: var(--primary-light);
        }

        .task-item.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .task-item.completed {
            border-left: 4px solid var(--success-color);
        }

        .task-xp {
            font-size: 0.75rem;
            opacity: 0.7;
            font-weight: 500;
        }

        /* Extension Toggle */
        .extension-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--primary-light);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 1rem;
        }

        .extension-toggle:hover {
            background: var(--primary-color);
        }

        .extension-icon {
            font-size: 1.25rem;
        }

        .extension-arrow {
            margin-left: auto;
            transition: transform 0.3s ease;
        }

        .extension-arrow.open {
            transform: rotate(90deg);
        }

        .extension-section {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-primary);
            border-radius: 8px;
        }

        /* Content Area */
        .content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            min-height: 600px;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .task-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .task-type {
            display: inline-block;
            padding: 0.25rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .task-type.example { background: #dbeafe; color: #1e40af; }
        .task-type.practice { background: #d1fae5; color: #065f46; }
        .task-type.challenge { background: #fef3c7; color: #92400e; }
        .task-type.assessment { background: #ede9fe; color: #5b21b6; }

        /* Instructions */
        .instructions {
            margin-bottom: 2rem;
            line-height: 1.8;
        }

        .instructions h3 {
            color: var(--primary-color);
            margin: 1.5rem 0 0.75rem 0;
            font-size: 1.2rem;
        }

        .instructions pre {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-color);
        }
        
        .instructions code {
            background: #f3f4f6;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }


        .instructions ul, .instructions ol {
            margin: 0.5rem 0 0.5rem 2rem;
        }

        .instructions li {
            margin: 0.5rem 0;
        }

        .instructions .why-matters,
        .instructions .common-mistake {
            margin: 1.5rem 0;
        }

        /* Code Editor */
        .editor-container {
            margin: 1.5rem 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .editor-header {
            background: var(--text-primary);
            color: white;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .editor-title {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .editor-actions {
            display: flex;
            gap: 0.5rem;
        }

        .editor-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .editor-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .editor-btn.run {
            background: var(--success-color);
            border-color: var(--success-color);
        }

        .editor-btn.run:hover {
            background: #059669;
        }

        .CodeMirror {
            height: 300px;
            font-size: 1rem;
        }

        /* Output Panel */
        .output-panel {
            margin-top: 1rem;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .output-header {
            background: #f9fafb;
            padding: 0.75rem 1rem;
            font-weight: 500;
            border-bottom: 1px solid var(--border-color);
        }

        .output-content {
            padding: 1rem;
            font-family: 'Courier New', monospace;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.5;
        }

        .output-content.error {
            color: var(--error-color);
        }

        /* Control Buttons */
        .controls {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        /* Hints */
        .hint-box {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            display: none;
        }

        .hint-box.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .hint-header {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Checks */
        .checks-container {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f9fafb;
            border-radius: 8px;
        }

        .check-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .check-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .check-icon.pending {
            background: #e5e7eb;
            color: #6b7280;
        }

        .check-icon.passed {
            background: var(--success-color);
            color: white;
        }

        .check-icon.failed {
            background: var(--error-color);
            color: white;
        }

        /* Achievement Notification */
        .achievement {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 1rem;
            opacity: 0;
            transform: translateX(400px);
            transition: all 0.5s ease;
            z-index: 1000;
            border-left: 4px solid var(--xp-color);
        }

        .achievement.show {
            opacity: 1;
            transform: translateX(0);
        }

        .achievement-icon {
            font-size: 2.5rem;
        }

        .achievement-content h3 {
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .achievement-xp {
            color: var(--xp-color);
            font-weight: 600;
        }

        /* Why This Matters Box */
        .why-matters {
            background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
            border: 2px solid var(--primary-light);
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
            position: relative;
            overflow: hidden;
        }

        .why-matters::before {
            content: 'üí°';
            position: absolute;
            font-size: 60px;
            opacity: 0.1;
            right: 10px;
            top: -10px;
        }

        .why-matters h4 {
            color: var(--primary-dark);
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
        }

        .why-matters p {
            color: #1e3a8a;
            margin: 0;
            position: relative;
            z-index: 1;
        }

        /* Common Mistake Box */
        .common-mistake {
            background: #fee2e2;
            border: 2px solid #ef4444;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
            position: relative;
        }

        .common-mistake h4 {
            color: #991b1b;
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .common-mistake p {
            color: #7f1d1d;
            margin: 0.5rem 0;
        }

        .common-mistake pre,
        .common-mistake code {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 0.75rem;
            margin: 0.5rem 0;
            color: #991b1b;
        }
        
        /* Assessment & Worksheet Styles */
        .worksheet-section {
            margin-top: 2rem;
        }
        .worksheet-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }
        .worksheet-question {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .worksheet-question h4 {
            margin: 0 0 1rem 0;
            font-weight: 600;
        }
        .worksheet-answer {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
        }
        .worksheet-answer:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .worksheet-code {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-light);
            font-family: 'Courier New', monospace;
        }

        /* Accessibility Features */
        .accessibility-menu {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            padding: 1rem;
            display: none;
            z-index: 999;
        }

        .accessibility-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 56px;
            height: 56px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            z-index: 998;
        }

        .accessibility-toggle:hover {
            transform: scale(1.1);
            background: var(--primary-dark);
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                margin-bottom: 2rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
            }
            
            .user-stats {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 640px) {
            .header-left h1 {
                font-size: 1.5rem;
            }
            
            .content {
                padding: 1rem;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .achievement {
                right: 1rem;
                left: 1rem;
                top: auto;
                bottom: 5rem;
            }
        }

        /* Loading State */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            color: var(--text-secondary);
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }

        /* Extension content styles */
        .extension-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .extension-content {
            line-height: 1.8;
        }

        .concept-section {
            margin-bottom: 2rem;
        }

        .example-box {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-left: 4px solid var(--primary-color);
        }

        .example-box h4 {
            margin-top: 0;
            color: var(--primary-color);
        }

        .try-it {
            margin-top: 2rem;
        }

        .try-it h4 {
            color: var(--primary-dark);
            margin-bottom: 1rem;
        }

        .extension-editor-container {
            margin: 1rem 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

    </style>
</head>
<body oncopy="return false" oncut="return false" onpaste="return false">
    <!-- Header with gradient background -->
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <h1>Year 9 Python Programming</h1>
                <p>Section 7 - Libraries</p>
            </div>
            <div class="user-stats">
                <div class="stat-item">
                    <div class="stat-value" id="userLevel">1</div>
                    <div class="stat-label">Level</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="userXP">0</div>
                    <div class="stat-label">XP</div>
                    <div class="xp-bar">
                        <div class="xp-fill" id="xpFill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="userStreak">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>
        </div>
        
        <!-- Progress bar and badges -->
        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <p style="margin: 5px 0 0 0; font-size: 14px; color: white;">
                Progress: <span id="progressText">0/9 tasks completed</span>
            </p>
            <div class="badges-preview">
                <div class="badge" id="badge-importer" title="Master Importer - Complete all import tasks">üìö</div>
                <div class="badge" id="badge-mathematician" title="Mathematician - Use the math library correctly">‚ûó</div>
                <div class="badge" id="badge-randomizer" title="Randomizer - Complete all random library tasks">üé≤</div>
                <div class="badge" id="badge-timekeeper" title="Time Keeper - Complete all time library tasks">‚è±Ô∏è</div>
                <div class="badge" id="badge-challenger" title="Challenge Champion - Complete the final challenge without hints">üöÄ</div>
                <div class="badge" id="badge-perfect" title="Perfect Score - Complete 5 tasks without using hints">‚≠ê</div>
                <div class="badge" id="badge-first-try" title="Quick Learner - Complete 3 tasks on first try">üß†</div>
                <div class="badge" id="badge-scholar" title="Library Scholar - Complete the final assessment">üéì</div>
                <div class="badge" id="badge-champion" title="Section Champion - Complete all tasks and extensions">üèÜ</div>
            </div>
        </div>
    </div>

    <!-- Main content area -->
    <div class="main-container">
        <!-- Sidebar navigation -->
        <aside class="sidebar">
            <div class="section-title">Section 7 - Libraries</div>
            <ul class="task-list" id="taskList">
                <!-- Task items will be dynamically generated -->
            </ul>
            
            <!-- Extension activities toggle -->
            <div class="extension-toggle" onclick="toggleExtension()">
                <span class="extension-icon">üöÄ</span>
                <span class="extension-text">Extension Activities</span>
                <span class="extension-arrow" id="extensionArrow">‚ñ∂</span>
            </div>
            <div class="extension-section" id="extensionSection" style="display: none;">
                <div class="task-item" onclick="showExtensionTopic('dice-roller')">
                    <span>Dice Rolling Simulator</span>
                    <span class="task-xp">40 XP</span>
                </div>
                <div class="task-item" onclick="showExtensionTopic('password-gen')">
                    <span>Password Generator</span>
                    <span class="task-xp">50 XP</span>
                </div>
                <div class="task-item" onclick="showExtensionTopic('reaction-game')">
                    <span>Reaction Time Game</span>
                    <span class="task-xp">50 XP</span>
                </div>
                 <div class="task-item" onclick="showExtensionTopic('datetime-lib')">
                    <span>Exploring `datetime`</span>
                    <span class="task-xp">30 XP</span>
                </div>
            </div>
        </aside>
        
        <!-- Main content area -->
        <main class="content">
            <div id="taskContent">
                <div class="loading">Loading Python environment</div>
            </div>
            <div id="extensionContent" style="display: none;">
                <!-- Extension content loads here -->
            </div>
        </main>
    </div>

    <!-- Achievement notification -->
    <div class="achievement" id="achievementPopup">
        <div class="achievement-icon" id="achievementIcon">üèÜ</div>
        <div class="achievement-content">
            <h3 id="achievementTitle">Achievement Unlocked!</h3>
            <p id="achievementMessage">You've completed a task!</p>
            <p class="achievement-xp">+<span id="achievementXP">50</span> XP</p>
        </div>
    </div>

    <!-- Accessibility Menu -->
    <button class="accessibility-toggle" onclick="toggleAccessibility()" title="Accessibility Options">
        ‚ôø
    </button>
    
    <div class="accessibility-menu" id="accessibilityMenu">
        <h3>Accessibility Options</h3>
        <label>
            <input type="checkbox" onchange="toggleDyslexicFont(this.checked)">
            Dyslexic-friendly font
        </label>
        <br>
        <label>
            <input type="checkbox" onchange="toggleHighContrast(this.checked)">
            High contrast mode
        </label>
    </div>

    <script>
        // Global variables
        let pyodide = null;
        let editors = {};
        let extensionEditors = {};
        let currentTask = 1;
        let userProgress = {
            completedTasks: {},
            hintsUsed: {},
            xp: 0,
            level: 1,
            streak: 0,
            lastVisit: new Date().toDateString(),
            badges: {},
            perfectTasks: 0,
            firstTryTasks: 0,
            taskAttempts: {},
            assessmentAnswers: {}
        };

        // Badge definitions
        const BADGES = {
            'importer': { 
                icon: 'ÔøΩ', 
                name: 'Master Importer', 
                desc: 'Complete all import tasks',
                check: () => [1, 2, 3, 4, 5, 6, 7, 8].some(t => userProgress.completedTasks[t])
            },
            'mathematician': { 
                icon: '‚ûó', 
                name: 'Mathematician', 
                desc: 'Use the math library correctly',
                check: () => [1, 2, 4].some(t => userProgress.completedTasks[t])
            },
            'randomizer': { 
                icon: 'üé≤', 
                name: 'Randomizer', 
                desc: 'Complete all random library tasks',
                check: () => [3, 4, 8].every(t => userProgress.completedTasks[t])
            },
            'timekeeper': { 
                icon: '‚è±Ô∏è', 
                name: 'Time Keeper', 
                desc: 'Complete all time library tasks',
                check: () => [5, 6, 7, 8].every(t => userProgress.completedTasks[t])
            },
            'challenger': { 
                icon: 'üöÄ', 
                name: 'Challenge Champion', 
                desc: 'Complete the final challenge without hints',
                check: () => userProgress.completedTasks[8] && !userProgress.hintsUsed[8]
            },
            'perfect': { 
                icon: '‚≠ê', 
                name: 'Perfect Score', 
                desc: 'Complete 5 tasks without using hints',
                check: () => userProgress.perfectTasks >= 5
            },
            'first-try': { 
                icon: 'üß†', 
                name: 'Quick Learner', 
                desc: 'Complete 3 tasks on first try',
                check: () => userProgress.firstTryTasks >= 3
            },
            'scholar': { 
                icon: 'üéì', 
                name: 'Library Scholar', 
                desc: 'Complete the final assessment',
                check: () => userProgress.completedTasks[9]
            },
            'champion': { 
                icon: 'üèÜ', 
                name: 'Section Champion', 
                desc: 'Complete all tasks and extensions',
                check: () => Object.keys(userProgress.completedTasks).length >= 9
            }
        };

        // Task definitions
        const tasks = {
            1: {
                id: "fea6da32-6a2c-4acc-a351-207fa37b7c86",
                title: "7.1 Libraries",
                type: "practice",
                xp: 75,
                instructions: `
                    <h3>Libraries</h3>
                    <p>A <strong>library</strong> is a collection of pre-written code and functions that you can use in your own programs. The <code>import</code> keyword loads a library into your program.</p>
                    <p>To import a specific function from a library, you can use the <code>from</code> keyword:</p>
                    <pre>from library_name import function_name</pre>
                    <p>When you import a function this way, you can call it directly without typing the library name first (e.g., <code>sqrt(9)</code> instead of <code>math.sqrt(9)</code>).</p>
                    
                    <h3>Your Task</h3>
                    <p>Change the code so that it asks the user to input a number, and then prints the square root of that number.</p>
                    
                    <div class="common-mistake">
                        <h4>‚ö†Ô∏è Common Mistake</h4>
                        <p>The <code>input()</code> function always returns text (a string). You can't do math with text! You must convert the input to a number using <code>int()</code> or <code>float()</code> before finding the square root.</p>
                        <pre># Incorrect
num = input("Enter a number: ")
print(sqrt(num)) # This will cause an error!

# Correct
num = float(input("Enter a number: "))
print(sqrt(num))</pre>
                    </div>
                `,
                starterCode: `# Import the square root function from the math library\nfrom math import sqrt\n\n# Print the square root of 5\nprint( sqrt(5) )`,
                hints: [
                    "You need to get input from the user. The function for this is `input()`.",
                    "Remember to convert the user's input from a string to a number. `float()` is a good choice because square roots can be decimals.",
                    "Replace the number `5` inside `sqrt()` with the variable that holds the user's input."
                ],
                checks: [
                    {
                        name: "Uses the input() function",
                        test: (code, output) => code.includes('input(')
                    },
                    {
                        name: "Converts input to a number",
                        test: (code, output) => code.includes('float(') || code.includes('int(')
                    },
                    {
                        name: "Calls the sqrt() function on a variable",
                        test: (code) => {
                            const match = code.match(/sqrt\s*\(\s*([a-zA-Z_]\w*)\s*\)/);
                            return match && isNaN(match[1]);
                        }
                    }
                ]
            },
            2: {
                id: "f4e4fd6e-a9a2-4bc2-b950-d754129445a4",
                title: "7.2 Absolute Value",
                type: "practice",
                xp: 75,
                instructions: `
                    <h3>Absolute Value</h3>
                    <p>Given a number <code>x</code>, use the <code>fabs</code> function from the <code>math</code> library to print its absolute value.</p>
                    <p>This will return the number in its positive form as a float (decimal number).</p>
                    <p>For example, <code>-9</code> would become <code>9.0</code>.</p>

                    <h3>Reminder</h3>
                    <pre># Import a function from a library
from math import some_function

# Use the function
print( some_function(...) )</pre>
                `,
                starterCode: `x = -10\n\n# Import the fabs function and use it to print the absolute value of x`,
                hints: [
                    "You need to import `fabs` from the `math` library.",
                    "The import statement should be: `from math import fabs`",
                    "After importing, you can print the result like this: `print(fabs(x))`"
                ],
                checks: [
                    {
                        name: "Imports fabs from math",
                        test: (code, output) => code.replace(/\s/g, '').includes('frommathimportfabs')
                    },
                    {
                        name: "Uses the fabs() function",
                        test: (code, output) => code.includes('fabs(x)') || code.includes('fabs(-10)')
                    },
                    {
                        name: "Prints the correct absolute value",
                        test: (code, output) => output.trim().includes('10.0')
                    }
                ]
            },
            3: {
                id: "08efa9bf-6387-44ce-a855-85d1feeb7e5b",
                title: "7.3 The random Library",
                type: "example",
                xp: 50,
                instructions: `
                    <h3>The <code>random</code> Library</h3>
                    <p>The <code>random</code> library contains functions for generating random numbers and making random choices.</p>
                    <p>The <code>randint</code> function generates a random integer within a given range (inclusive).</p>

                    <h3>Your Task</h3>
                    <p>Click the 'Run Code' button several times and watch the output. Notice how the number changes each time.</p>
                `,
                starterCode: `from random import randint\n\n# Print a random number from 1 to 100 inclusive\nprint( randint(1, 100) )`,
                hints: [
                    "Just click the 'Run Code' button to see what happens!",
                    "Each time you run the code, `randint(1, 100)` picks a new random number between 1 and 100."
                ],
                checks: [
                    {
                        name: "Code runs without errors",
                        test: (code, output) => !output.toLowerCase().includes('error')
                    },
                    {
                        name: "Imports randint from random",
                        test: (code, output) => code.replace(/\s/g, '').includes('fromrandomimportrandint')
                    }
                ]
            },
            4: {
                id: "fe069330-67c4-48b5-9319-048a0e6ba87a",
                title: "7.4 Square Root of a Random Number",
                type: "practice",
                xp: 100,
                instructions: `
                    <h3>Combining Libraries</h3>
                    <p>You can import and use functions from multiple libraries in the same program.</p>
                    
                    <h3>Your Task</h3>
                    <p>Print the square root of a random number between 1 and 10000.</p>
                    <p><strong>Note:</strong> You will have to import two different functions from two different libraries.</p>

                    <div class="why-matters">
                        <h4>üåü Why This Matters</h4>
                        <p>Combining libraries is essential for building complex applications, like simulations, games, or data analysis tools that require both random data and mathematical calculations.</p>
                    </div>
                `,
                starterCode: `# Import the functions you need\n\n# Generate a random number\n\n# Calculate and print its square root`,
                hints: [
                    "You need to import `randint` from the `random` library and `sqrt` from the `math` library.",
                    "First, generate a random number and store it in a variable, e.g., `random_num = randint(1, 10000)`",
                    "Then, pass that variable to the `sqrt` function inside a print statement: `print(sqrt(random_num))`"
                ],
                checks: [
                    {
                        name: "Imports randint from random",
                        test: (code, output) => code.replace(/\s/g, '').includes('fromrandomimportrandint')
                    },
                    {
                        name: "Imports sqrt from math",
                        test: (code, output) => code.replace(/\s/g, '').includes('frommathimportsqrt')
                    },
                    {
                        name: "Uses both randint() and sqrt()",
                        test: (code, output) => code.includes('randint(') && code.includes('sqrt(')
                    }
                ]
            },
            5: {
                id: "769a9a8a-ba5c-4cfc-8f38-1acc281650cb",
                title: "7.5 The time Library",
                type: "practice",
                xp: 100,
                instructions: `
                    <h3>The <code>time</code> Library</h3>
                    <p>The <code>time</code> library contains functions for working with time, such as getting the current time or pausing your program.</p>
                    
                    <h3>The <code>sleep</code> function</h3>
                    <p>The <code>sleep</code> function, found in the <code>time</code> library, pauses your program for a given number of seconds before moving to the next instruction.</p>

                    <h3>Your Task</h3>
                    <ol>
                        <li>Increase the delay between the two <code>print</code> instructions.</li>
                        <li><strong>Challenge:</strong> Can you make the delay a random number of seconds between 1 and 5?</li>
                    </ol>
                `,
                starterCode: `from time import sleep\n\nprint("The program has started.")\nsleep(1)\nprint("The program has ended.")`,
                hints: [
                    "To change the delay to 3 seconds, change the number inside `time.sleep()`.",
                    "For the challenge, you'll need to import `randint` from the `random` library.",
                    "For the challenge, you can use `time.sleep(randint(1, 5))`."
                ],
                checks: [
                    {
                        name: "Imports the time library",
                        test: (code, output) => code.includes('import time') || code.includes('from time import')
                    },
                    {
                        name: "Uses the sleep() function",
                        test: (code, output) => code.includes('sleep(')
                    },
                    {
                        name: "The delay is not 1 second",
                        test: (code, output) => !code.includes('sleep(1)')
                    }
                ]
            },
            6: {
                id: "0993fbbb-fa8c-4e9a-955c-889491553767",
                title: "7.6 Getting the Current Time",
                type: "example",
                xp: 50,
                instructions: `
                    <h3>The <code>time()</code> function</h3>
                    <p>The <code>time</code> library has another function, also called <code>time()</code>. This function gives the number of seconds that have passed since January 1st, 1970.</p>
                    <p>This standard date is known as the 'Unix Epoch', and it's a common reference point for computers to measure time.</p>
                    
                    <h3>Your Task</h3>
                    <p>Run the code several times. You should notice that the number increases with each run.</p>
                `,
                starterCode: `from time import time\n\n# Print the number of seconds since January 1st, 1970\nprint( time() )`,
                hints: [
                    "Just click the 'Run Code' button and observe the output.",
                    "The large number you see is the total number of seconds from 1970 to now. It's constantly increasing!"
                ],
                checks: [
                    {
                        name: "Imports time function from time library",
                        test: (code, output) => code.replace(/\s/g, '').includes('fromtimeimporttime')
                    },
                    {
                        name: "Calls the time() function",
                        test: (code, output) => code.includes('print(time())')
                    },
                    {
                        name: "Output is a large number",
                        test: (code, output) => {
                            const num = parseFloat(output.trim());
                            return !isNaN(num) && num > 1000000000;
                        }
                    }
                ]
            },
            7: {
                id: "f8ee1cbc-a76f-4308-bd95-cf3c1b96d3f0",
                title: "7.7 Timing Instructions",
                type: "practice",
                xp: 125,
                instructions: `
                    <h3>Timing Your Code</h3>
                    <p>Certain instructions take longer for a computer to perform. We can measure this time.</p>
                    <p>To calculate how long an instruction takes, you can store the time *before* the instruction runs, and then store the time *after* it finishes. The difference between these two times is the duration.</p>

                    <h3>Your Task</h3>
                    <ol>
                        <li>Run the code and note the duration. It will be very small (e.g., <code>1.4e-06</code> means 0.0000014 seconds).</li>
                        <li>Delete the comment characters (<code>#</code>) on lines 10, 11, and 12 to enable the <code>for</code> loop.</li>
                        <li>Run the code again and see how much longer it takes to complete.</li>
                    </ol>
                `,
                starterCode: `from time import time\nfrom math import sqrt,pi\n\n# Get the starting time\nstart = time()\n\n# Take the square root of a big number\nsqrt(100)\n\n#for x in range(9999):\n#  z = pi * x**2\n#  print(z)\n\n\n# Get the ending time\nend = time()\nduration = end - start\n\nprint("Found answer in " + str(duration) + " seconds.")`,
                hints: [
                    "To uncomment the lines, simply delete the `#` at the beginning of lines 10, 11, and 12.",
                    "The `for` loop makes the computer do a calculation 9999 times, which is why it takes much longer.",
                    "Make sure you uncomment all three lines of the loop."
                ],
                checks: [
                    {
                        name: "Uncommented the 'for' loop",
                        test: (code, output) => !code.includes('#for x in') && !code.includes('#  z =')
                    },
                    {
                        name: "The loop calculation is present",
                        test: (code, output) => code.includes('z = pi * x**2') && !code.includes('#z = pi * x**2')
                    },
                    {
                        name: "The print(z) line is uncommented",
                        test: (code, output) => code.includes('print(z)') && !code.includes('#print(z)')
                    }
                ]
            },
            8: {
                id: "1514f286-0d3c-498c-a516-6b87901a5aa9",
                title: "7.8 Libraries Challenge",
                type: "challenge",
                xp: 200,
                instructions: `
                    <h3>Libraries Challenge</h3>
                    <p>Write a program that does the following:</p>
                    <ul>
                        <li>Imports the <code>random</code> and <code>time</code> modules.</li>
                        <li>Stores 2 random numbers (between 1 and 100) in 2 different variables.</li>
                        <li>Calculates 4 different answers by adding, subtracting, multiplying, and dividing the 2 numbers.</li>
                        <li>Prints each of the four answers, but with a random delay of between 1 and 3 seconds between each print statement.</li>
                    </ul>
                `,
                starterCode: `# Your code here!`,
                hints: [
                    "You will need to import `randint` from `random` and `sleep` from `time`.",
                    "Generate two random numbers first: `num1 = randint(1, 100)` and `num2 = randint(1, 100)`.",
                    "Perform the calculations: `add_result = num1 + num2`, etc.",
                    "Between each print statement, add a random delay: `sleep(randint(1, 3))`."
                ],
                checks: [
                    {
                        name: "Imports from random and time libraries",
                        test: (code, output) => code.includes('random') && code.includes('time')
                    },
                    {
                        name: "Generates two random integers",
                        test: (code, output) => (code.match(/randint\s*\(/g) || []).length >= 2
                    },
                    {
                        name: "Uses the sleep function",
                        test: (code, output) => code.includes('sleep(')
                    },
                    {
                        name: "Performs all four arithmetic operations (+, -, *, /)",
                        test: (code, output) => code.includes('+') && code.includes('-') && code.includes('*') && code.includes('/')
                    }
                ]
            },
            9: {
                id: "assessment-07",
                title: "Section 7 Assessment",
                type: "assessment",
                xp: 250,
                instructions: `
                    <div class="worksheet-section">
                        <h3 class="worksheet-title">üìù End of Section 7: Worksheet</h3>
                        
                        <div class="worksheet-question">
                            <h4>1. Describe what is meant by a ‚Äòlibrary‚Äô in Python.</h4>
                            <textarea class="worksheet-answer" rows="3" placeholder="A library is..." data-question="1"></textarea>
                        </div>
                        
                        <div class="worksheet-question">
                            <h4>2. Explain what the following lines of code are doing.</h4>
                            <div class="worksheet-code">from math import sqrt
print(sqrt(25))</div>
                            <textarea class="worksheet-answer" rows="4" placeholder="Line 1 does... Line 2 does..." data-question="2"></textarea>
                        </div>
                        
                        <div class="worksheet-question">
                            <h4>3. Explain what the following lines of code are doing.</h4>
                            <div class="worksheet-code">import random
print(random.randint(1, 10))</div>
                            <textarea class="worksheet-answer" rows="4" placeholder="Line 1 does... Line 2 does..." data-question="3"></textarea>
                        </div>

                        <div class="worksheet-question">
                            <h4>4. Research what the <code>math.ceil()</code> function does and detail your findings below. (ceil is short for ceiling).</h4>
                            <textarea class="worksheet-answer" rows="4" placeholder="The math.ceil() function..." data-question="4"></textarea>
                        </div>

                        <div class="worksheet-question">
                            <h4>5. What is the difference in how you would use a function when you import it in these two ways?</h4>
                            <div class="worksheet-code"># Method 1
import math
# Method 2
from math import sqrt</div>
                            <textarea class="worksheet-answer" rows="4" placeholder="With Method 1, I would call the function by writing... With Method 2, I would call it by writing..." data-question="5"></textarea>
                        </div>

                        <div class="worksheet-question">
                            <h4>6. Using the <code>random</code> library, write a single line of code that would print a random colour from the list provided. (Hint: you may need to research a new function in the random library).</h4>
                            <div class="worksheet-code">colours = ['red', 'green', 'blue']</div>
                            <textarea class="worksheet-answer" rows="3" placeholder="Your line of code here..." data-question="6"></textarea>
                        </div>
                    </div>
                `,
                starterCode: ``,
                checks: [] 
            }
        };

        // Extension progress tracking
        const extensionProgress = {
            'dice-roller': { completed: false, xp: 40 },
            'password-gen': { completed: false, xp: 50 },
            'reaction-game': { completed: false, xp: 50 },
            'datetime-lib': { completed: false, xp: 30 }
        };

        // Extension checks
        const extensionChecks = {
            'dice-roller': {
                check: (code, output) => code.includes('randint(1, 6)') && output.toLowerCase().includes('you rolled'),
                hint: "Use `randint(1, 6)` to simulate a standard die roll."
            },
            'password-gen': {
                check: (code, output) => code.includes('random.choice') && code.includes('for') && code.includes('password'),
                hint: "Use a `for` loop to choose multiple random characters from a string of letters, numbers, and symbols."
            },
            'reaction-game': {
                check: (code, output) => code.includes('time.sleep') && code.includes('time.time()') && code.includes('input()'),
                hint: "Store the start time, wait for a random duration, get user input, then find the difference from the end time."
            },
            'datetime-lib': {
                check: (code, output) => code.includes('datetime.now()') && (code.includes('.year') || code.includes('.strftime')),
                hint: "Use `datetime.now()` to get the current date and time, then access its attributes like `.year` or format it with `.strftime()`."
            }
        };

        // Extension topics content
        const extensionTopics = {
            'dice-roller': {
                title: 'Dice Rolling Simulator',
                content: `
                    <div class="extension-header"><h2>Dice Rolling Simulator üé≤</h2></div>
                    <div class="extension-content">
                        <p>Let's use the <code>random</code> library to simulate rolling dice. This is a fundamental part of many games!</p>
                        <div class="example-box">
                            <h4>Concept</h4>
                            <p>A standard die has 6 sides, numbered 1 to 6. The <code>random.randint(1, 6)</code> function is perfect for simulating a single die roll.</p>
                        </div>
                        <div class="try-it">
                            <h4>Try it yourself!</h4>
                            <p>Write a program that simulates rolling two dice and prints the value of each die and their total. For example: "You rolled a 4 and a 6. Total: 10"</p>
                            <div class="extension-editor-container">
                                <div class="editor-header"><div class="editor-title">Python Code Editor</div><div class="editor-actions"><button class="editor-btn run" onclick="runExtensionCode('dice-roller')">‚ñ∂ Run Code</button></div></div>
                                <textarea id="ext-dice-roller">
import random

# Roll two dice
die1 = random.randint(1, 6)
die2 = random.randint(1, 6)

# Calculate the total


# Print the results

</textarea>
                            </div>
                            <div class="output-panel"><div class="output-header">Output</div><div class="output-content" id="output-ext-dice-roller"></div></div>
                            <div class="controls"><button onclick="checkExtensionComplete('dice-roller')" class="btn btn-success">‚úì Check Solution</button></div>
                        </div>
                    </div>`
            },
            'password-gen': {
                title: 'Password Generator',
                content: `
                    <div class="extension-header"><h2>Simple Password Generator üîë</h2></div>
                    <div class="extension-content">
                        <p>A great use of the <code>random</code> library is to generate secure passwords. We can use <code>random.choice()</code> to pick random characters from a set.</p>
                        <div class="example-box">
                            <h4>Concept</h4>
                            <p>We define a set of possible characters (letters, numbers, symbols). Then we loop a certain number of times, picking one random character on each iteration and adding it to our password string.</p>
                        </div>
                        <div class="try-it">
                            <h4>Try it yourself!</h4>
                            <p>Complete the code to generate a 12-character password. Use a <code>for</code> loop that runs 12 times. Inside the loop, choose a random character from <code>all_chars</code> and add it to the <code>password</code> variable.</p>
                            <div class="extension-editor-container">
                                <div class="editor-header"><div class="editor-title">Python Code Editor</div><div class="editor-actions"><button class="editor-btn run" onclick="runExtensionCode('password-gen')">‚ñ∂ Run Code</button></div></div>
                                <textarea id="ext-password-gen">
import random

letters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'
numbers = '0123456789'
symbols = '!@#$%^&*()'
all_chars = letters + numbers + symbols

password = ""
password_length = 12

# Your for loop here...


print("Generated password:", password)
</textarea>
                            </div>
                            <div class="output-panel"><div class="output-header">Output</div><div class="output-content" id="output-ext-password-gen"></div></div>
                            <div class="controls"><button onclick="checkExtensionComplete('password-gen')" class="btn btn-success">‚úì Check Solution</button></div>
                        </div>
                    </div>`
            },
            'reaction-game': {
                title: 'Reaction Time Game',
                content: `
                    <div class="extension-header"><h2>Reaction Time Game ‚ö°</h2></div>
                    <div class="extension-content">
                        <p>Let's combine the <code>time</code> and <code>random</code> libraries to make a simple game that tests your reaction time!</p>
                        <div class="example-box">
                            <h4>Concept</h4>
                            <ol>
                                <li>Wait for a random amount of time.</li>
                                <li>Tell the user to press Enter.</li>
                                <li>Record the time just before you ask them.</li>
                                <li>Wait for their input.</li>
                                <li>Record the time just after they press Enter.</li>
                                <li>The difference is their reaction time!</li>
                            </ol>
                        </div>
                        <div class="try-it">
                            <h4>Try it yourself!</h4>
                            <p>Fill in the blanks in the code to complete the reaction time game.</p>
                            <div class="extension-editor-container">
                                <div class="editor-header"><div class="editor-title">Python Code Editor</div><div class="editor-actions"><button class="editor-btn run" onclick="runExtensionCode('reaction-game')">‚ñ∂ Run Code</button></div></div>
                                <textarea id="ext-reaction-game">
import time
import random

print("Press Enter when you see the word 'NOW!'")
# Wait for a random time between 2 and 5 seconds
time.sleep(random.randint(2, 5))

# Record the start time
start_time = time.time()

input("NOW!")

# Record the end time
end_time = time.time()

# Calculate and print the reaction time
reaction_time = end_time - start_time
print("Your reaction time was:", reaction_time, "seconds")
</textarea>
                            </div>
                            <div class="output-panel"><div class="output-header">Output</div><div class="output-content" id="output-ext-reaction-game"></div></div>
                            <div class="controls"><button onclick="checkExtensionComplete('reaction-game')" class="btn btn-success">‚úì Check Solution</button></div>
                        </div>
                    </div>`
            },
            'datetime-lib': {
                title: 'Exploring `datetime`',
                content: `
                    <div class="extension-header"><h2>Exploring the \`datetime\` Library üìÖ</h2></div>
                    <div class="extension-content">
                        <p>While the <code>time</code> library is good for seconds and delays, the <code>datetime</code> library is much more powerful for working with dates and times in a human-readable format.</p>
                        <div class="example-box">
                            <h4>Concept</h4>
                            <p>The <code>datetime</code> library can get the current date and time, and you can easily access parts of it like the year, month, day, or hour.</p>
                        </div>
                        <div class="try-it">
                            <h4>Try it yourself!</h4>
                            <p>Import the <code>datetime</code> library. Get the current date and time using <code>datetime.datetime.now()</code> and print the current year and the current minute.</p>
                            <div class="extension-editor-container">
                                <div class="editor-header"><div class="editor-title">Python Code Editor</div><div class="editor-actions"><button class="editor-btn run" onclick="runExtensionCode('datetime-lib')">‚ñ∂ Run Code</button></div></div>
                                <textarea id="ext-datetime-lib">
import datetime

# The 'datetime' library has a 'datetime' object inside it.
# To get the current time, you can uncomment the lines below:
# now = datetime.datetime.now()
# print("Full timestamp:", now)


# Get and print the current year from the 'now' variable


# Get and print the current minute from the 'now' variable

</textarea>
                            </div>
                            <div class="output-panel"><div class="output-header">Output</div><div class="output-content" id="output-ext-datetime-lib"></div></div>
                            <div class="controls"><button onclick="checkExtensionComplete('datetime-lib')" class="btn btn-success">‚úì Check Solution</button></div>
                        </div>
                    </div>`
            }
        };

        // Initialize Pyodide
        async function initializePyodide() {
            try {
                pyodide = await loadPyodide({
                    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
                });
                
                // Set up input handling
                pyodide.runPython(`
                    import sys
                    from js import prompt
                    
                    def custom_input(prompt_text=""):
                        return prompt(prompt_text)
                    
                    __builtins__.input = custom_input
                `);
                
                console.log("Pyodide loaded successfully");
                loadAllProgress();
                generateTaskList();
                switchTask(1);
            } catch (error) {
                console.error("Failed to load Pyodide:", error);
                document.getElementById('taskContent').innerHTML = `
                    <div class="error-message">
                        <h3>Failed to load Python environment</h3>
                        <p>Please refresh the page to try again.</p>
                    </div>
                `;
            }
        }

        // Initialize CodeMirror editor
        function initializeEditor(taskNumber) {
            const editorElement = document.getElementById(`editor-${taskNumber}`);
            if (!editorElement) return;

            if (editors[taskNumber]) {
                editors[taskNumber].toTextArea();
            }

            editors[taskNumber] = CodeMirror.fromTextArea(editorElement, {
                mode: 'python',
                theme: 'monokai',
                lineNumbers: true,
                autoCloseBrackets: true,
                matchBrackets: true,
                indentUnit: 4,
                tabSize: 4,
                indentWithTabs: false,
                lineWrapping: true,
                foldGutter: true,
                gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
                extraKeys: {
                    "Tab": (cm) => cm.replaceSelection("    "),
                    "Ctrl-Enter": (cm) => runCode(taskNumber),
                    "Cmd-Enter": (cm) => runCode(taskNumber)
                }
            });

            // Set initial value
            const task = tasks[taskNumber];
            const savedCode = localStorage.getItem(`libs-code-${task.id}`);
            editors[taskNumber].setValue(savedCode || task.starterCode);
            
            // Auto-save
            editors[taskNumber].on('change', () => {
                localStorage.setItem(`libs-code-${task.id}`, editors[taskNumber].getValue());
            });
        }

        // Generate task list in sidebar
        function generateTaskList() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            for (let i = 1; i <= Object.keys(tasks).length; i++) {
                const task = tasks[i];
                const li = document.createElement('li');
                li.className = 'task-item';
                if (userProgress.completedTasks[i]) {
                    li.classList.add('completed');
                }
                if (i === currentTask) {
                    li.classList.add('active');
                }
                
                li.innerHTML = `
                    <span>${task.title}</span>
                    <span class="task-xp">${task.xp} XP</span>
                `;
                
                li.onclick = () => switchTask(i);
                taskList.appendChild(li);
            }
        }

        // Switch between tasks
        function switchTask(taskNum) {
            currentTask = taskNum;
            const task = tasks[taskNum];
            
            // Update active state in sidebar
            document.querySelectorAll('.task-item').forEach((item, index) => {
                item.classList.toggle('active', index === taskNum - 1);
            });
            
            // Route to the correct rendering function based on task type
            if (task.type === 'assessment') {
                renderAssessmentTask(taskNum);
            } else {
                renderRegularTask(taskNum);
            }
            
            // Hide extension content
            document.getElementById('taskContent').style.display = 'block';
            document.getElementById('extensionContent').style.display = 'none';
        }

        // Render assessment task
        function renderAssessmentTask(taskNum) {
            const task = tasks[taskNum];
            const contentDiv = document.getElementById('taskContent');
            contentDiv.innerHTML = `
                <div class="task-header">
                    <h2 class="task-title">${task.title}</h2>
                    <span class="task-type ${task.type}">${task.type}</span>
                </div>
                ${task.instructions}
                <div class="controls">
                     <button class="btn btn-success" onclick="markAssessmentComplete(${taskNum})">
                        ‚úì Mark as Complete
                    </button>
                    ${taskNum < Object.keys(tasks).length ? 
                        `<button class="btn btn-primary" onclick="switchTask(${taskNum + 1})">Next Task ‚Üí</button>` : 
                        '<button class="btn btn-primary" onclick="exportProgress()">Export Progress Report</button>'}
                </div>
            `;
            
            // Load and save answers
            document.querySelectorAll('.worksheet-answer').forEach(textarea => {
                const qId = textarea.dataset.question;
                textarea.value = userProgress.assessmentAnswers[qId] || '';
                textarea.addEventListener('input', (e) => {
                    userProgress.assessmentAnswers[qId] = e.target.value;
                    saveAllProgress();
                });
            });
        }

        // Simple completion for assessment
        function markAssessmentComplete(taskNum) {
            if (!userProgress.completedTasks[taskNum]) {
                const task = tasks[taskNum];
                userProgress.completedTasks[taskNum] = true;
                awardXP(task.xp);
                updateProgress();
                generateTaskList();
                showAchievement('üéì', 'Assessment Complete!', `You've completed the assessment!`, task.xp);
                checkBadges();
            } else {
                alert("You have already completed this assessment.");
            }
        }
        
        // Render regular task
        function renderRegularTask(taskNum) {
            const task = tasks[taskNum];
            
            // Update main content
            document.getElementById('taskContent').innerHTML = `
                <div class="task-header">
                    <h2 class="task-title">${task.title}</h2>
                    <span class="task-type ${task.type}">${task.type}</span>
                </div>
                
                <div class="instructions">
                    ${task.instructions}
                </div>
                
                <div class="editor-container">
                    <div class="editor-header">
                        <div class="editor-title">
                            <span>Python Code Editor</span>
                        </div>
                        <div class="editor-actions">
                            <button class="editor-btn" onclick="resetCode(${taskNum})">
                                ‚Ü∫ Reset
                            </button>
                            <button class="editor-btn run" onclick="runCode(${taskNum})">
                                ‚ñ∂ Run Code
                            </button>
                        </div>
                    </div>
                    <textarea id="editor-${taskNum}"></textarea>
                </div>
                
                <div class="output-panel">
                    <div class="output-header">Output</div>
                    <div class="output-content" id="output-${taskNum}"></div>
                </div>
                
                <div class="hint-box" id="hint-${taskNum}">
                    <div class="hint-header">
                        <span>üí°</span>
                        <span>Hint <span id="hintNumber-${taskNum}">1</span>/${task.hints.length}</span>
                    </div>
                    <p id="hintText-${taskNum}">${task.hints[0]}</p>
                </div>
                
                <div class="controls">
                    <button class="btn btn-secondary" onclick="showHint(${taskNum})">
                        üí° Show Hint
                    </button>
                    <button class="btn btn-success" onclick="checkCode(${taskNum})">
                        ‚úì Check Solution
                    </button>
                    ${taskNum < Object.keys(tasks).length ? 
                        `<button class="btn btn-primary" onclick="switchTask(${taskNum + 1})">Next Task ‚Üí</button>` : 
                        '<button class="btn btn-primary" onclick="exportProgress()">Export Progress Report</button>'}
                </div>
                
                <div class="checks-container" id="checks-${taskNum}" style="display: none;">
                    <h3>Solution Checks:</h3>
                    ${task.checks.map((check, index) => 
                        `<div class="check-item" id="check-${taskNum}-${index}">
                            <div class="check-icon pending" id="checkIcon-${taskNum}-${index}">?</div>
                            <span>${check.name}</span>
                        </div>`
                    ).join('')}
                </div>
            `;
            
            // Initialize editor after DOM is ready
            setTimeout(() => {
                initializeEditor(taskNum);
            }, 0);
        }

        // Run Python code
        async function runCode(taskNumber, isExtension = false, topic = '') {
            const editorId = isExtension ? `ext-${topic}` : taskNumber;
            const editor = isExtension ? extensionEditors[editorId] : editors[editorId];
            if (!pyodide || !editor) return;

            const outputId = isExtension ? `output-ext-${topic}` : `output-${taskNumber}`;
            const outputElement = document.getElementById(outputId);
            outputElement.textContent = 'Running...';
            outputElement.classList.remove('error');
            
            try {
                const code = editor.getValue();
                
                pyodide.runPython(`
                    import sys
                    from io import StringIO
                    sys.stdout = StringIO()
                    sys.stderr = StringIO()
                `);
                
                await pyodide.runPythonAsync(code);
                
                const stdout = pyodide.runPython("sys.stdout.getvalue()");
                const stderr = pyodide.runPython("sys.stderr.getvalue()");
                
                if (stderr) {
                    outputElement.textContent = stderr;
                    outputElement.classList.add('error');
                } else {
                    outputElement.textContent = stdout || 'No output';
                }
                
                pyodide.runPython(`
                    sys.stdout = sys.__stdout__
                    sys.stderr = sys.__stderr__
                `);
                
            } catch (error) {
                outputElement.textContent = error.message;
                outputElement.classList.add('error');
            }
        }

        // Check code against criteria
        async function checkCode(taskNumber) {
            const task = tasks[taskNumber];
            const checksContainer = document.getElementById(`checks-${taskNumber}`);
            checksContainer.style.display = 'block';
            
            if (!userProgress.taskAttempts[taskNumber]) {
                userProgress.taskAttempts[taskNumber] = 0;
            }
            userProgress.taskAttempts[taskNumber]++;
            
            await runCode(taskNumber);
            
            const code = editors[taskNumber].getValue();
            const output = document.getElementById(`output-${taskNumber}`).textContent;
            
            let allChecksPassed = true;
            
            task.checks.forEach((check, index) => {
                const passed = check.test(code, output);
                const checkIcon = document.getElementById(`checkIcon-${taskNumber}-${index}`);
                
                if (passed) {
                    checkIcon.textContent = '‚úì';
                    checkIcon.className = 'check-icon passed';
                } else {
                    checkIcon.textContent = '‚úó';
                    checkIcon.className = 'check-icon failed';
                    allChecksPassed = false;
                }
            });
            
            if (allChecksPassed && !userProgress.completedTasks[taskNumber]) {
                userProgress.completedTasks[taskNumber] = true;
                
                if (userProgress.taskAttempts[taskNumber] === 1) {
                    userProgress.firstTryTasks++;
                }
                
                if (!userProgress.hintsUsed[taskNumber]) {
                    userProgress.perfectTasks++;
                }
                
                awardXP(task.xp);
                updateProgress();
                generateTaskList();
                
                showAchievement('‚úÖ', 'Task Complete!', `${task.title} completed successfully!`, task.xp);
                checkBadges();
            }
        }

        function showHint(taskNumber) {
            const task = tasks[taskNumber];
            const hintBox = document.getElementById(`hint-${taskNumber}`);
            const hintText = document.getElementById(`hintText-${taskNumber}`);
            const hintNumber = document.getElementById(`hintNumber-${taskNumber}`);
            
            if (!userProgress.hintsUsed[taskNumber]) {
                userProgress.hintsUsed[taskNumber] = 0;
            }
            
            const currentHint = userProgress.hintsUsed[taskNumber];
            if (currentHint < task.hints.length) {
                hintBox.classList.add('show');
                hintText.textContent = task.hints[currentHint];
                hintNumber.textContent = currentHint + 1;
                userProgress.hintsUsed[taskNumber]++;
                saveAllProgress();
            }
        }

        function resetCode(taskNumber) {
            if (confirm('Are you sure you want to reset your code?')) {
                const task = tasks[taskNumber];
                editors[taskNumber].setValue(task.starterCode);
                localStorage.removeItem(`libs-code-${task.id}`);
            }
        }

        function awardXP(amount) {
            userProgress.xp += amount;
            
            const newLevel = Math.floor(userProgress.xp / 500) + 1;
            if (newLevel > userProgress.level) {
                userProgress.level = newLevel;
                showAchievement('üéâ', 'Level Up!', `You've reached Level ${newLevel}!`, 0);
            }
            
            updateProgress();
            saveAllProgress();
        }

        function updateProgress() {
            document.getElementById('userLevel').textContent = userProgress.level;
            document.getElementById('userXP').textContent = userProgress.xp;
            document.getElementById('userStreak').textContent = userProgress.streak;
            
            const xpInCurrentLevel = userProgress.xp % 500;
            const xpPercent = (xpInCurrentLevel / 500) * 100;
            document.getElementById('xpFill').style.width = `${xpPercent}%`;
            
            const completedCount = Object.keys(userProgress.completedTasks).length;
            const totalTasks = Object.keys(tasks).length;
            const progressPercent = (completedCount / totalTasks) * 100;
            document.getElementById('progressBar').style.width = `${progressPercent}%`;
            document.getElementById('progressText').textContent = `${completedCount}/${totalTasks} tasks completed`;
            
            Object.keys(BADGES).forEach(badgeId => {
                const badgeElement = document.getElementById(`badge-${badgeId}`);
                if (badgeElement && userProgress.badges[badgeId]) {
                    badgeElement.classList.add('earned');
                }
            });
        }

        function checkBadges() {
            Object.keys(BADGES).forEach(badgeId => {
                if (!userProgress.badges[badgeId] && BADGES[badgeId].check()) {
                    userProgress.badges[badgeId] = true;
                    const badge = BADGES[badgeId];
                    const badgeElement = document.getElementById(`badge-${badgeId}`);
                    if (badgeElement) {
                        badgeElement.classList.add('earned');
                    }
                    showAchievement(badge.icon, 'Badge Earned!', badge.name, 50);
                    awardXP(50);
                }
            });
        }

        function showAchievement(icon, title, message, xp) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementIcon').textContent = icon;
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementMessage').textContent = message;
            const xpElement = document.getElementById('achievementXP');
            
            if(xp > 0) {
                xpElement.parentElement.style.display = 'block';
                xpElement.textContent = xp;
            } else {
                 xpElement.parentElement.style.display = 'none';
            }
            
            popup.classList.add('show');
            setTimeout(() => {
                popup.classList.remove('show');
            }, 4000);
        }

        function saveAllProgress() {
            localStorage.setItem('libs-progress', JSON.stringify(userProgress));
        }

        function loadAllProgress() {
            const saved = localStorage.getItem('libs-progress');
            if (saved) {
                userProgress = JSON.parse(saved);
                if (!userProgress.assessmentAnswers) {
                    userProgress.assessmentAnswers = {}; // Ensure assessment answers object exists
                }
                
                const today = new Date().toDateString();
                const lastVisitDate = userProgress.lastVisit ? new Date(userProgress.lastVisit) : new Date(0);
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (today !== userProgress.lastVisit) {
                    if (yesterday.toDateString() === lastVisitDate.toDateString()) {
                        userProgress.streak++;
                    } else {
                        userProgress.streak = 1;
                    }
                    userProgress.lastVisit = today;
                }
            }
            updateProgress();
        }

        function toggleExtension() {
            const section = document.getElementById('extensionSection');
            const arrow = document.getElementById('extensionArrow');
            
            if (section.style.display === 'none') {
                section.style.display = 'block';
                arrow.classList.add('open');
            } else {
                section.style.display = 'none';
                arrow.classList.remove('open');
            }
        }

        function showExtensionTopic(topic) {
            const extensionContent = document.getElementById('extensionContent');
            const taskContent = document.getElementById('taskContent');
            
            extensionContent.innerHTML = extensionTopics[topic] ? extensionTopics[topic].content : '<p>Extension topic not found.</p>';
            extensionContent.style.display = 'block';
            taskContent.style.display = 'none';
            
            document.querySelectorAll('.task-item').forEach(item => item.classList.remove('active'));
            
            setTimeout(() => {
                initializeExtensionEditors(topic);
            }, 0);
        }
        
        function initializeExtensionEditors(topic) {
            const practiceElement = document.getElementById(`ext-${topic}`);
            if (practiceElement && !extensionEditors[`ext-${topic}`]) {
                extensionEditors[`ext-${topic}`] = CodeMirror.fromTextArea(practiceElement, {
                    mode: 'python',
                    theme: 'monokai',
                    lineNumbers: true,
                    autoCloseBrackets: true,
                    matchBrackets: true,
                    indentUnit: 4,
                    tabSize: 4,
                    indentWithTabs: false,
                    lineWrapping: true
                });
            }
        }
        
        async function runExtensionCode(topic) {
            await runCode(null, true, topic);
        }
        
        async function checkExtensionComplete(topic) {
            const editor = extensionEditors[`ext-${topic}`];
            if (!editor) return;
            
            const code = editor.getValue();
            const outputElement = document.getElementById(`output-ext-${topic}`);
            
            await runExtensionCode(topic);
            const output = outputElement.textContent;
            
            const check = extensionChecks[topic];
            if (check.check(code, output)) {
                if (!extensionProgress[topic].completed) {
                    extensionProgress[topic].completed = true;
                    awardXP(extensionProgress[topic].xp);
                    showAchievement('üåü', 'Extension Complete!', `${extensionTopics[topic].title} completed!`, extensionProgress[topic].xp);
                    saveAllProgress();
                    checkBadges();
                } else {
                    alert('You have already completed this extension!');
                }
            } else {
                alert(`Not quite right! Hint: ${check.hint}`);
            }
        }

        function toggleAccessibility() {
            const menu = document.getElementById('accessibilityMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }

        function toggleDyslexicFont(enabled) {
            document.body.classList.toggle('dyslexic-font', enabled);
            localStorage.setItem('libs-dyslexic-font', enabled);
        }

        function toggleHighContrast(enabled) {
            alert('High contrast mode is not yet implemented.');
            localStorage.setItem('libs-high-contrast', enabled);
        }

        function loadAccessibilityPreferences() {
            const dyslexicFont = localStorage.getItem('libs-dyslexic-font') === 'true';
            if (dyslexicFont) {
                document.body.classList.add('dyslexic-font');
                const checkbox = document.querySelector('input[onchange*="toggleDyslexicFont"]');
                if (checkbox) checkbox.checked = true;
            }
        }
        
        function exportProgress() {
            const report = {
                date: new Date().toISOString(),
                section: "Libraries",
                level: userProgress.level,
                xp: userProgress.xp,
                completedTasks: Object.keys(userProgress.completedTasks).length,
                totalTasks: Object.keys(tasks).length,
                taskDetails: Object.keys(tasks).map(taskNum => ({
                    task: tasks[taskNum].title,
                    completed: !!userProgress.completedTasks[taskNum],
                    hintsUsed: userProgress.hintsUsed[taskNum] || 0,
                    attempts: userProgress.taskAttempts[taskNum] || 0
                })),
                badges: Object.keys(userProgress.badges).map(b => BADGES[b].name),
                assessment: userProgress.assessmentAnswers
            };
            
            const dataStr = JSON.stringify(report, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `libraries-progress-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // Initialize on load
        window.addEventListener('load', () => {
            loadAccessibilityPreferences();
            initializePyodide();
        });

        // Prevent text selection (robust version)
        document.addEventListener('selectstart', function(e) {
            const target = e.target;
            if (target.nodeType === 1 && typeof target.closest === 'function') {
                if (target.tagName !== 'TEXTAREA' && target.tagName !== 'INPUT' && !target.closest('.CodeMirror')) {
                    e.preventDefault();
                }
            } else if (target.nodeType !== 1) {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
ÔøΩ