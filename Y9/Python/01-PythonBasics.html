<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Year 9 Python Course - Section 1: Python Basics</title>
    
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/solarized.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.min.css">
    
    <!-- Pyodide -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    
    <!-- CodeMirror JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/python-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/brace-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/indent-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.min.js"></script>
    
    <!-- Font for dyslexia support -->
    <link href="https://fonts.googleapis.com/css2?family=OpenDyslexic:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --xp-color: #8b5cf6;
            --bg-primary: #f0f2f5;
            --bg-secondary: white;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            background-color: var(--bg-primary);
            transition: font-family 0.3s ease;
        }
        
        body.dyslexic-font {
            font-family: 'OpenDyslexic', sans-serif;
        }
        
        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header-left h1 {
            margin: 0;
            font-size: 28px;
        }
        
        .header-left p {
            margin: 5px 0 0 0;
            opacity: 0.9;
        }
        
        .user-stats {
            display: flex;
            gap: 20px;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 8px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .xp-bar {
            width: 150px;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .xp-fill {
            height: 100%;
            background: var(--xp-color);
            transition: width 0.5s ease;
        }
        
        .progress-section {
            max-width: 1400px;
            margin: 10px auto 0;
        }
        
        .progress-bar {
            background: rgba(255,255,255,0.3);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: #4ade80;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .badges-preview {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            filter: grayscale(1);
            opacity: 0.5;
            transition: all 0.3s;
        }
        
        .badge.earned {
            filter: grayscale(0);
            opacity: 1;
            background: rgba(255,255,255,0.3);
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        
        .main-container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            gap: 20px;
            padding: 20px;
        }
        
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .task-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .task-item {
            padding: 12px;
            margin: 5px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #e5e7eb;
            position: relative;
        }
        
        .task-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .task-item.active {
            background: #eff6ff;
            border-color: var(--primary-color);
            color: #1e40af;
        }
        
        .task-item.completed {
            border-color: var(--success-color);
        }
        
        .task-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .task-status.completed {
            background: var(--success-color);
            color: white;
        }
        
        .task-xp {
            position: absolute;
            right: 10px;
            font-size: 12px;
            color: var(--xp-color);
            font-weight: bold;
        }
        
        .task-name {
            flex: 1;
            font-size: 14px;
        }
        
        .daily-challenge {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 8px;
            color: white;
        }
        
        .daily-challenge h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
        }
        
        .daily-challenge p {
            margin: 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .settings-panel {
            margin-top: 20px;
            padding: 15px;
            background: #f3f4f6;
            border-radius: 8px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }
        
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background: #d1d5db;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle-switch.active {
            background: var(--primary-color);
        }
        
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }
        
        .worksheet-container {
            flex: 1;
            background: var(--bg-secondary);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 30px;
            position: relative;
        }
        
        .task-header {
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 20px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .task-header-left h2 {
            margin: 0 0 10px 0;
            color: var(--text-primary);
        }
        
        .task-badges {
            display: flex;
            gap: 10px;
        }
        
        .task-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: #fef3c7;
            color: #92400e;
        }
        
        .task-type.practice {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .instructions {
            background: #f9fafb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #e5e7eb;
            position: relative;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: var(--text-primary);
            font-size: 18px;
        }
        
        .instructions code {
            background: #e5e7eb;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .instructions pre {
            background: #1f2937;
            color: #f3f4f6;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .audio-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .audio-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .audio-btn:hover {
            background: #2563eb;
        }
        
        .audio-btn.playing {
            background: var(--error-color);
        }
        
        .code-section {
            margin: 20px 0;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #1f2937;
            color: white;
            padding: 10px 15px;
            border-radius: 6px 6px 0 0;
        }
        
        .editor-title {
            font-weight: 600;
            font-size: 14px;
        }
        
        .editor-container {
            border: 1px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 6px 6px;
            overflow: hidden;
            position: relative;
        }
        
        .CodeMirror {
            height: 300px;
            font-size: 14px;
            width: 100% !important;
        }
        
        /* Force CodeMirror to take full width */
        .CodeMirror-scroll {
            overflow-y: auto !important;
            overflow-x: auto !important;
        }
        
        .CodeMirror-sizer {
            min-width: 100% !important;
        }
        
        .CodeMirror-lint-tooltip {
            background: #1f2937;
            color: #f3f4f6;
            border: 1px solid #374151;
            border-radius: 4px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 13px;
            padding: 5px 8px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        button:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .run-btn {
            background: var(--success-color);
        }
        
        .run-btn:hover {
            background: #059669;
        }
        
        .check-btn {
            background: var(--xp-color);
        }
        
        .check-btn:hover {
            background: #7c3aed;
        }
        
        .debug-btn {
            background: #ec4899;
        }
        
        .debug-btn:hover {
            background: #db2777;
        }
        
        .reset-btn {
            background: #6b7280;
        }
        
        .reset-btn:hover {
            background: #4b5563;
        }
        
        .hint-btn {
            background: var(--warning-color);
        }
        
        .hint-btn:hover {
            background: #d97706;
        }
        
        .ai-help-btn {
            background: #06b6d4;
        }
        
        .ai-help-btn:hover {
            background: #0891b2;
        }
        
        .history-btn {
            background: #84cc16;
        }
        
        .history-btn:hover {
            background: #65a30d;
        }
        
        .output-section {
            margin-top: 25px;
        }
        
        .output-panel {
            background: #1f2937;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .output-header {
            background: #111827;
            color: white;
            padding: 10px 15px;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .output-content {
            color: #f3f4f6;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.5;
        }
        
        .debugger-panel {
            display: none;
            background: #1f2937;
            border-radius: 6px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .debugger-controls {
            background: #111827;
            padding: 10px;
            display: flex;
            gap: 10px;
        }
        
        .debugger-btn {
            padding: 6px 12px;
            font-size: 12px;
            background: #374151;
        }
        
        .debugger-btn:hover {
            background: #4b5563;
        }
        
        .debugger-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 15px;
        }
        
        .debug-section {
            background: #111827;
            padding: 10px;
            border-radius: 4px;
        }
        
        .debug-section h4 {
            margin: 0 0 10px 0;
            color: #9ca3af;
            font-size: 12px;
            text-transform: uppercase;
        }
        
        .current-line {
            background: #374151;
            padding: 5px;
            border-radius: 3px;
            margin-bottom: 10px;
            color: #fbbf24;
        }
        
        .variable-list {
            font-size: 12px;
        }
        
        .variable-item {
            margin: 5px 0;
            padding: 5px;
            background: #1f2937;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
        }
        
        .variable-name {
            color: #60a5fa;
        }
        
        .variable-value {
            color: #34d399;
        }
        
        .visualization-panel {
            display: none;
            background: #f3f4f6;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .loop-visualization {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .loop-item {
            width: 50px;
            height: 50px;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: bold;
            opacity: 0.3;
            transition: all 0.3s;
        }
        
        .loop-item.active {
            opacity: 1;
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-pass {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        
        .test-fail {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .xp-gained {
            font-weight: bold;
            color: var(--xp-color);
            font-size: 16px;
            animation: bounce 0.5s;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .loading {
            color: #60a5fa;
            font-style: italic;
        }
        
        .error {
            color: #f87171;
        }
        
        .success {
            color: #4ade80;
        }
        
        .hint-box {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
        }
        
        .hint-box strong {
            color: #92400e;
        }
        
        .ai-help-box {
            background: #e0f2fe;
            border: 1px solid #7dd3fc;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
        }
        
        .ai-help-box strong {
            color: #075985;
        }
        
        .execution-info {
            color: #9ca3af;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .code-quality-feedback {
            background: #f0fdf4;
            border: 1px solid #86efac;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            display: none;
        }
        
        .quality-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
            color: #166534;
        }
        
        .history-panel {
            display: none;
            background: #f3f4f6;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .history-item:hover {
            border-color: var(--primary-color);
        }
        
        .history-timestamp {
            font-size: 12px;
            color: #9ca3af;
        }
        
        .next-task-section {
            margin-top: 30px;
            padding: 20px;
            background: #f3f4f6;
            border-radius: 6px;
            text-align: center;
            display: none;
        }
        
        .next-btn {
            background: var(--primary-color);
            font-size: 16px;
            padding: 12px 24px;
            margin-top: 10px;
        }
        
        .next-btn:hover {
            background: #2563eb;
        }
        
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            text-align: center;
            z-index: 1000;
            display: none;
        }
        
        .achievement-popup.show {
            display: block;
            animation: popIn 0.5s ease-out;
        }
        
        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }
        
        .achievement-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        .achievement-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .achievement-desc {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }
        
        .achievement-xp {
            font-size: 20px;
            font-weight: bold;
            color: var(--xp-color);
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }
        
        .overlay.show {
            display: block;
        }
        
        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.warning {
            border-left: 4px solid var(--warning-color);
        }
        
        .notification.success {
            border-left: 4px solid var(--success-color);
        }
        
        .notification.error {
            border-left: 4px solid var(--error-color);
        }
        
        .notification-icon {
            font-size: 20px;
        }
        
        .notification-content h4 {
            margin: 0 0 5px 0;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .notification-content p {
            margin: 0;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Disable text selection in code areas */
        .CodeMirror {
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
            user-select: text !important;
        }
        
        /* But show warning cursor on attempt to select for copy */
        .no-copy {
            cursor: not-allowed !important;
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                position: static;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .user-stats {
                width: 100%;
                justify-content: space-around;
            }
        }
        /* Assessment Styles */
.assessment-container {
    max-width: 800px;
    margin: 0 auto;
}

.assessment-question {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.assessment-question h4 {
    margin-top: 0;
    color: var(--text-primary);
}

.mc-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin: 15px 0;
}

.mc-option {
    display: flex;
    align-items: center;
    padding: 10px;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
}

.mc-option:hover {
    background: #f3f4f6;
    border-color: var(--primary-color);
}

.mc-option input {
    margin-right: 10px;
}

.text-answer {
    width: 100%;
    padding: 10px;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    font-family: inherit;
    font-size: 14px;
    resize: vertical;
}

.feedback-box {
    margin-top: 10px;
    padding: 10px;
    border-radius: 6px;
    display: none;
}

.feedback-box.success {
    display: block;
    background: #d1fae5;
    color: #065f46;
    border: 1px solid #6ee7b7;
}

.feedback-box.error {
    display: block;
    background: #fee2e2;
    color: #991b1b;
    border: 1px solid #fca5a5;
}

.feedback-box.warning {
    display: block;
    background: #fef3c7;
    color: #92400e;
    border: 1px solid #fcd34d;
}

.simulations-section {
    margin-top: 40px;
    padding: 20px;
    background: #f3f4f6;
    border-radius: 8px;
}

.simulation-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.simulation-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
}

.simulation-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.play-btn {
    margin-top: 10px;
    background: var(--success-color);
}

.assessment-progress {
    margin-top: 40px;
    padding: 20px;
    background: #eff6ff;
    border-radius: 8px;
    text-align: center;
}

.progress-items {
    display: flex;
    justify-content: space-around;
    margin: 20px 0;
}

.progress-item {
    padding: 10px 20px;
    background: white;
    border-radius: 6px;
    border: 1px solid #e5e7eb;
}

.progress-item.completed {
    background: var(--success-color);
    color: white;
    border-color: var(--success-color);
}

.submit-btn {
    background: var(--xp-color);
    font-size: 16px;
    padding: 12px 30px;
}

.submit-btn:disabled {
    background: #9ca3af;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 20px;
    border-radius: 12px;
    width: 80%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
}

.close {
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    color: #aaa;
}

.close:hover {
    color: #000;
}

/* Game Styles */
.game-timer {
    font-size: 20px;
    font-weight: bold;
    color: var(--error-color);
    margin: 10px 0;
}

.game-score {
    font-size: 18px;
    color: var(--success-color);
    margin-bottom: 20px;
}

.syntax-challenge {
    background: #f3f4f6;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
}

.syntax-challenge pre {
    background: #1f2937;
    color: #f3f4f6;
    padding: 15px;
    border-radius: 6px;
    font-size: 16px;
    margin: 15px 0;
}

.syntax-challenge input {
    width: 100%;
    padding: 10px;
    font-family: 'Courier New', monospace;
    font-size: 16px;
    border: 2px solid #e5e7eb;
    border-radius: 6px;
    margin-bottom: 10px;
}

.task-type.assessment {
    background: #e0e7ff;
    color: #3730a3;
}

/* Extension Section Styles */
.extension-toggle {
    margin-top: 20px;
    padding: 15px;
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    border-radius: 8px;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s;
}

.extension-toggle:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
}

.extension-icon {
    font-size: 20px;
}

.extension-text {
    flex: 1;
    font-weight: 600;
}

.extension-arrow {
    font-size: 14px;
    transition: transform 0.3s;
}

.extension-section {
    margin-top: 10px;
    background: #f3f4f6;
    border-radius: 8px;
    padding: 10px;
}

.extension-item {
    padding: 12px;
    margin: 5px 0;
    background: white;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s;
    border: 1px solid #e5e7eb;
}

.extension-item:hover {
    background: #f9fafb;
    border-color: var(--primary-color);
}

.extension-item.active {
    background: #eff6ff;
    border-color: var(--primary-color);
    color: #1e40af;
}

.topic-icon {
    font-size: 18px;
}
.extension-header {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #e5e7eb;
}

.extension-header h2 {
    margin: 0;
    color: var(--text-primary);
}

.back-btn {
    background: #6b7280;
}

.extension-content {
    max-width: 800px;
    margin: 0 auto;
}

.concept-section {
    margin-bottom: 30px;
}

.example-box {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
}

.example-box h4 {
    margin-top: 0;
    color: #374151;
}

.try-it {
    background: #eff6ff;
    border: 1px solid #3b82f6;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
}

.extension-output {
    margin-top: 15px;
    padding: 15px;
    background: #1f2937;
    color: #f3f4f6;
    border-radius: 6px;
    font-family: 'Courier New', monospace;
    min-height: 50px;
}

.extension-output pre {
    margin: 0;
    white-space: pre-wrap;
}

.challenge-box {
    background: #fef3c7;
    border: 1px solid #fcd34d;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
}

.fun-fact {
    background: #e0f2fe;
    border: 1px solid #7dd3fc;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
}

.project-idea {
    background: #f0fdf4;
    border: 1px solid #86efac;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
}

.extension-code {
    width: 100%;
    min-height: 100px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
}

.extension-item {
    position: relative;
    padding: 12px;
    margin: 5px 0;
    background: white;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s;
    border: 1px solid #e5e7eb;
}

.extension-item.completed {
    border-color: var(--success-color);
}

.extension-status {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
}

.extension-status.completed {
    background: var(--success-color);
    color: white;
}

.extension-name {
    flex: 1;
    font-size: 14px;
    min-width: 0; /* Allow text to shrink */
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.extension-xp {
    font-size: 12px;
    color: var(--xp-color);
    font-weight: bold;
    flex-shrink: 0; /* Prevent XP from shrinking */
    margin-left: auto; /* Push to the right */
}

.extension-feedback {
    margin-top: 15px;
}
    </style>
</head>
<body oncopy="return false" oncut="return false" onpaste="return false">
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <h1>Year 9 Python Programming</h1>
                <p>Section 1 - Python Basics</p>
            </div>
            <div class="user-stats">
                <div class="stat-item">
                    <div class="stat-value" id="userLevel">1</div>
                    <div class="stat-label">Level</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="userXP">0</div>
                    <div class="stat-label">XP</div>
                    <div class="xp-bar">
                        <div class="xp-fill" id="xpFill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="userStreak">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>
        </div>
        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <p style="margin: 5px 0 0 0; font-size: 14px; color: white;">Progress: <span id="progressText">0/5 lessons completed</span></p>
            <div class="badges-preview">
                <div class="badge" id="badge-first" title="First Program">üë∂</div>
                <div class="badge" id="badge-bug" title="Bug Fixer">üêõ</div>
                <div class="badge" id="badge-comment" title="Comment Champion">üí¨</div>
                <div class="badge" id="badge-streak" title="5-Day Streak">üî•</div>
                <div class="badge" id="badge-perfect" title="Perfect Score">‚≠ê</div>
            </div>
        </div>
    </div>

    <div class="main-container">
        <aside class="sidebar">
            <div class="section-title">Section 1 - Python Basics</div>
            <ul class="task-list" id="taskList">
                <li class="task-item active" onclick="switchTask(1)">
                    <span class="task-status" id="status1"></span>
                    <span class="task-name">01.01 Print</span>
                    <span class="task-xp">+50 XP</span>
                </li>
                <li class="task-item" onclick="switchTask(2)">
                    <span class="task-status" id="status2"></span>
                    <span class="task-name">01.02 Print Again</span>
                    <span class="task-xp">+75 XP</span>
                </li>
                <li class="task-item" onclick="switchTask(3)">
                    <span class="task-status" id="status3"></span>
                    <span class="task-name">01.03 Parameters</span>
                    <span class="task-xp">+100 XP</span>
                </li>
                <li class="task-item" onclick="switchTask(4)">
                    <span class="task-status" id="status4"></span>
                    <span class="task-name">01.04 Syntax</span>
                    <span class="task-xp">+125 XP</span>
                </li>
                <li class="task-item" onclick="switchTask(5)">
                    <span class="task-status" id="status5"></span>
                    <span class="task-name">01.05 Comments</span>
                    <span class="task-xp">+100 XP</span>
                </li>
                <li class="task-item" onclick="switchTask(6)">
    <span class="task-status" id="status6"></span>
    <span class="task-name">Section Assessment</span>
    <span class="task-xp">+150 XP</span>
</li>
<div class="extension-toggle" onclick="toggleExtension()">
    <span class="extension-icon">üöÄ</span>
    <span class="extension-text">Extension Activities</span>
    <span class="extension-arrow" id="extensionArrow">‚ñ∂</span>
</div>
<div class="extension-section" id="extensionSection" style="display: none;">
    <div class="extension-item" onclick="showExtensionTopic('special-chars')">
        <span class="extension-status" id="ext-status-special-chars"></span>
        <span class="topic-icon">‚ú®</span>
        <span class="extension-name">Special Characters</span>
        <span class="extension-xp">+25 XP</span>
    </div>
    <div class="extension-item" onclick="showExtensionTopic('escape-sequences')">
        <span class="extension-status" id="ext-status-escape-sequences"></span>
        <span class="topic-icon">üî§</span>
        <span class="extension-name">Escape Sequences</span>
        <span class="extension-xp">+30 XP</span>
    </div>
    <div class="extension-item" onclick="showExtensionTopic('string-multiplication')">
        <span class="extension-status" id="ext-status-string-multiplication"></span>
        <span class="topic-icon">‚úñÔ∏è</span>
        <span class="extension-name">String Multiplication</span>
        <span class="extension-xp">+30 XP</span>
    </div>
    <div class="extension-item" onclick="showExtensionTopic('advanced-print')">
        <span class="extension-status" id="ext-status-advanced-print"></span>
        <span class="topic-icon">üéØ</span>
        <span class="extension-name">Advanced Print</span>
        <span class="extension-xp">+40 XP</span>
    </div>
    <div class="extension-item" onclick="showExtensionTopic('print-formatting')">
        <span class="extension-status" id="ext-status-print-formatting"></span>
        <span class="topic-icon">üé®</span>
        <span class="extension-name">Print Formatting</span>
        <span class="extension-xp">+50 XP</span>
    </div>
</div>
            </ul>
            
            <div class="daily-challenge">
                <h3>üåü Challenge</h3>
                <p>Complete all tasks without using hints for bonus 200 XP!</p>
            </div>
            
            <div class="settings-panel">
                <div class="section-title">Settings</div>
                <div class="setting-item">
                    <span>Dyslexic Font</span>
                    <div class="toggle-switch" onclick="toggleDyslexicFont()" id="dyslexicToggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="setting-item">
                    <span>Audio Instructions</span>
                    <div class="toggle-switch" onclick="toggleAudio()" id="audioToggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="setting-item">
                    <span>Live Syntax Check</span>
                    <div class="toggle-switch active" onclick="toggleSyntaxCheck()" id="syntaxToggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <button onclick="downloadProgress()" style="width: 100%; margin: 5px 0;">
                    üì• Save Progress
                </button>
                <button onclick="resetSection()" style="width: 100%; margin: 5px 0; background: #ef4444;">
                    üîÑ Reset Section
                </button>
            </div>

            
        </aside>

        <div class="worksheet-container">
            <div id="taskContent">
                <!-- Task content will be dynamically loaded here -->
            </div>

            <div id="extensionContent" style="display: none;">
    <!-- Extension content will be loaded here -->
</div>
        </div>
    </div>
    
    <div class="overlay" id="overlay"></div>
    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-icon" id="achievementIcon">üèÜ</div>
        <div class="achievement-title" id="achievementTitle">Achievement Unlocked!</div>
        <div class="achievement-desc" id="achievementDesc">You've earned a new badge!</div>
        <div class="achievement-xp" id="achievementXP">+50 XP</div>
    </div>

    <script>
        // Global variables
        let pyodide = null;
        let editors = {};
        let currentTask = 1;
        let taskProgress = {};
        let currentTheme = 'monokai';
        let userProfile = {
            level: 1,
            xp: 0,
            xpToNextLevel: 500,
            streak: 0,
            badges: [],
            hintsUsed: {},
            attemptsBeforeSuccess: {},
            totalTime: 0,
            lastLogin: new Date().toDateString()
        };
        let extensionProgress = {
    'special-chars': { completed: false, xp: 25 },
    'escape-sequences': { completed: false, xp: 30 },
    'string-multiplication': { completed: false, xp: 30 },
    'advanced-print': { completed: false, xp: 40 },
    'print-formatting': { completed: false, xp: 50 }
};

const extensionChecks = {
    'special-chars': {
        check: (code, output) => {
            return output.includes('Python says "Welcome!"') || 
                   output.includes("Python says \"Welcome!\"");
        },
        hint: "Remember to use \\ before quotes inside the string"
    },
    'escape-sequences': {
        check: (code, output) => {
            return output.includes("RECEIPT") && 
                   output.includes("\t") && 
                   code.includes("\\t");
        },
        hint: "Use \\t to add tabs between items and prices"
    },
    'string-multiplication': {
        check: (code, output) => {
            return output.includes("*" * 30) && 
                   output.includes("PYTHON BASICS") &&
                   code.includes("* 30");
        },
        hint: "Don't forget to add the bottom border using string multiplication"
    },
    'advanced-print': {
        check: (code, output) => {
            return output.includes("555-123-4567") || 
                   (output.includes("555") && output.includes("123") && output.includes("4567"));
        },
        hint: "Use the sep parameter to add dashes between the numbers"
    },
    'print-formatting': {
        check: (code, output) => {
            // Check if they created some ASCII art
            const lines = output.split('\n');
            return lines.length >= 3 && 
                   (output.includes("^") || output.includes("*") || output.includes("/") || output.includes("\\"));
        },
        hint: "Create your own ASCII art - be creative!"
    }
};
        let taskStartTime = {};
        let codeHistory = {};
        let debuggerState = {
            active: false,
            currentLine: 0,
            variables: {},
            stepMode: false
        };
        let settings = {
            dyslexicFont: false,
            audioEnabled: false,
            syntaxCheckEnabled: true
        };
        
        // In-memory storage
        let memoryStorage = {
            pythonWorksheetProgress: {},
            pythonWorksheetTaskProgress: {},
            userProfile: userProfile,
            settings: settings
        };
        
        // XP values for different actions
        const XP_VALUES = {
            taskComplete: { 1: 50, 2: 75, 3: 100, 4: 125, 5: 100 },
            noHints: 25,
            firstTry: 50,
            dailyChallenge: 200,
            perfectWeek: 500
        };
        
        // Badge definitions
        const BADGES = {
            'first': { icon: 'üë∂', name: 'First Program', desc: 'Complete your first task' },
            'bug': { icon: 'üêõ', name: 'Bug Fixer', desc: 'Fix all syntax errors in task 4' },
            'comment': { icon: 'üí¨', name: 'Comment Champion', desc: 'Complete the comments task' },
            'streak': { icon: 'üî•', name: '5-Day Streak', desc: 'Complete tasks 5 days in a row' },
            'perfect': { icon: '‚≠ê', name: 'Perfect Score', desc: 'Complete all tasks without hints' }
        };
        
        // Task definitions based on curriculum
        const tasks = {
            1: {
                id: "7460eb4f-2195-41db-aa67-9b784659f763",
                title: "01.01 Print",
                type: "example",
                xp: 50,
                instructions: `
                    <h3>Instructions</h3>
                    <p>Let's learn how to make the computer display text!</p>
                    <p>The <code>print()</code> command tells Python to show text on the screen.</p>
                    <p>The text must be inside quotation marks like this: <code>"your text"</code></p>
                    
                    <h3>Your Task</h3>
                    <p>1. Keep the example line that says "Welcome to Python!"</p>
                    <p>2. Add a new line that prints your favourite hobby</p>
                    <p>3. Add another line that prints your favourite food</p>
                    
                    <h3>Example</h3>
                    <pre>print("I love playing football")</pre>
                `,
                starterCode: `print("Welcome to Python!")`,
                hints: [
                    "Look at the example print statement. Notice how the text is inside quotation marks.",
                    "To add a new print statement, type: print(\"Your text here\")",
                    "Remember to use quotation marks around your text and close the brackets!"
                ],
                smartHints: {
                    'missing_quote': "It looks like you're missing a quotation mark. Make sure your text is surrounded by quotes: \"like this\"",
                    'missing_paren': "Don't forget to close your parentheses! Every ( needs a matching )",
                    'wrong_quotes': "Make sure you're using straight quotes \" not curly quotes ",
                    'no_prints': "You need to add more print statements. Each one should be on a new line."
                },
                checks: [
                    {
                        name: "Has example print",
                        test: (code, output) => output.includes("Welcome to Python!")
                    },
                    {
                        name: "Added hobby print",
                        test: (code, output) => {
                            const lines = code.split('\n');
                            const printCount = lines.filter(line => line.includes('print(')).length;
                            return printCount >= 2;
                        }
                    },
                    {
                        name: "Added food print",
                        test: (code, output) => {
                            const lines = code.split('\n');
                            const printCount = lines.filter(line => line.includes('print(')).length;
                            return printCount >= 3;
                        }
                    }
                ]
            },
            2: {
                id: "c9166264-19c7-4e80-9daf-64dbb58f721b",
                title: "01.02 Print Again",
                type: "practice",
                xp: 75,
                instructions: `
                    <h3>Print Again</h3>
                    <p>Now let's practice using print statements!</p>
                    <p>Remember, each print statement shows one line of text.</p>
                    
                    <h3>Task - Favourites</h3>
                    <p>You need to print THREE things, each on its own line:</p>
                    <ol>
                        <li>Your favourite sportsperson (like "Lionel Messi")</li>
                        <li>Your favourite musical artist (like "Taylor Swift")</li>
                        <li>Your favourite historical figure (like "Albert Einstein")</li>
                    </ol>
                    
                    <h3>Example Format</h3>
                    <pre>print("Lionel Messi")
print("Taylor Swift")
print("Albert Einstein")</pre>
                `,
                starterCode: `print("Write your code here")`,
                hints: [
                    "Replace the starter text with your first print statement for your favourite sportsperson",
                    "Add two more print statements below the first one",
                    "Each print statement should be on its own line. For example:\nprint(\"Lionel Messi\")\nprint(\"Taylor Swift\")\nprint(\"Albert Einstein\")"
                ],
                smartHints: {
                    'still_starter': "You need to replace 'Write your code here' with your own text",
                    'only_one_print': "You need 3 print statements total - one for each favourite",
                    'only_two_prints': "Almost there! You need one more print statement"
                },
                checks: [
                    {
                        name: "Removed starter code",
                        test: (code, output) => !output.includes("Write your code here")
                    },
                    {
                        name: "Has 3 print statements",
                        test: (code, output) => {
                            const lines = code.split('\n');
                            const printCount = lines.filter(line => line.trim().startsWith('print(')).length;
                            return printCount >= 3;
                        }
                    },
                    {
                        name: "Outputs 3 lines",
                        test: (code, output) => {
                            const outputLines = output.trim().split('\n').filter(line => line.length > 0);
                            return outputLines.length >= 3;
                        }
                    }
                ]
            },
3: {
    id: "f9efb5be-2e96-4d4d-8ab9-097a87d47ef6",
    title: "01.03 Parameters",
    type: "practice",
    xp: 100,
    instructions: `
        <h3>Print procedure</h3>
        <p>The text inside the brackets of print() is called a <strong>parameter</strong>.</p>
        <p>Parameters give information to the command.</p>
        
        <h3>Task - Old McDonald</h3>
        <p>Complete the verse by adding the last 3 lines.</p>
        <p>The code already has most of the verse - you just need to finish it!</p>
        
        <div style="background: #f3f4f6; padding: 15px; border-radius: 6px; margin: 10px 0;">
            <p style="margin: 0; color: #6b7280;">The verse should end with:</p>
            <p style="margin: 10px 0; font-family: 'Courier New', monospace;">
            Everywhere a moo-moo<br>
            <span style="color: #059669;">‚Üê blank line here</span><br>
            Old MacDonald had a farm<br>
            Ee i ee i o
            </p>
        </div>
        
        <p><strong>Tip:</strong> For the blank line, use <code>print("")</code></p>
    `,
    starterCode: `print("Old MacDonald had a farm")
print("Ee i ee i o")
print("")
print("And on his farm he had some cows")
print("Ee i ee i oh")
print("With a moo-moo here")
print("And a moo-moo there")
print("Here a moo, there a moo")
# Add the last 3 lines here`,
    hints: [
        "The next line should be: print(\"Everywhere a moo-moo\")",
        "Don't forget the blank line after 'Everywhere a moo-moo' - use print(\"\")",
        "End with the same two lines that started the verse"
    ],
    smartHints: {
        'no_blank_lines': "Don't forget the blank line! Use print(\"\") after 'Everywhere a moo-moo'",
        'missing_lines': "You need to add 3 more lines: 'Everywhere a moo-moo', a blank line, then the last 2 lines",
        'typo_mcdonald': "Check your spelling - it's 'MacDonald' with a capital D"
    },
    checks: [
        {
            name: "Has 'Everywhere a moo-moo'",
            test: (code, output) => output.toLowerCase().includes("everywhere a moo")
        },
        {
            name: "Ends with farm line",
            test: (code, output) => {
                const lines = output.split('\n');
                const lastLines = lines.slice(-2).join(' ').toLowerCase();
                return lastLines.includes("old macdonald") && lastLines.includes("ee i ee i o");
            }
        },
        {
            name: "Complete verse with blank line",
            test: (code, output) => {
                const lines = output.split('\n');
                // Check if there's a blank line after "Everywhere a moo-moo"
                for (let i = 0; i < lines.length - 1; i++) {
                    if (lines[i].toLowerCase().includes("everywhere a moo") && 
                        lines[i + 1] === "" && 
                        lines[i + 2] && lines[i + 2].toLowerCase().includes("old macdonald")) {
                        return true;
                    }
                }
                return false;
            }
        }
    ]
},
            4: {
                id: "3d67cd86-cc5a-4e56-b043-1c0e7514c4ca",
                title: "01.04 Syntax",
                type: "practice",
                xp: 125,
                instructions: `
                    <h3>Syntax</h3>
                    <p>Python is very picky about how we write code. This is called <strong>syntax</strong>.</p>
                    <p>When syntax is wrong, Python shows an <strong>error message</strong>.</p>
                    
                    <h3>Task</h3>
                    <p>The code below has 4 syntax errors. Run it to see the first error.</p>
                    <p>Fix each error one by one. The errors are:</p>
                    <ol>
                        <li>Line 1: Missing something at the end</li>
                        <li>Line 2: Missing something to close the text</li>
                        <li>Line 3: Wrong format for print command</li>
                        <li>Line 4: Spelling mistake in the command</li>
                    </ol>
                    
                    <p><strong>Tip:</strong> Fix one error at a time, then run again!</p>
                `,
                starterCode: `print("hello"
print("The computer gods
print "Spoke upon man, hello world")
prin("When it all began.")`,
                hints: [
                    "Look at line 1 - is something missing at the end?",
                    "Line 2 is missing something to close the text",
                    "Line 3 has the wrong syntax - print needs brackets",
                    "Line 4 has a typo in the command name"
                ],
                smartHints: {
                    'line1_paren': "Line 1 needs a closing parenthesis )",
                    'line2_quote': "Line 2 needs a closing quotation mark \"",
                    'line3_syntax': "Line 3 needs parentheses around the text: print(\"text\")",
                    'line4_typo': "Line 4: 'prin' should be 'print'"
                },
                checks: [
                    {
                        name: "Fixed line 1",
                        test: (code, output) => {
                            const lines = code.split('\n');
                            return lines[0].includes(')');
                        }
                    },
                    {
                        name: "Fixed line 2",
                        test: (code, output) => {
                            const lines = code.split('\n');
                            return lines[1].includes('"') && lines[1].lastIndexOf('"') > lines[1].indexOf('"');
                        }
                    },
                    {
                        name: "No syntax errors",
                        test: (code, output) => !output.includes("Error") && !output.includes("error")
                    },
                    {
                        name: "All text printed",
                        test: (code, output) => output.includes("hello") && output.includes("computer gods") && output.includes("began")
                    }
                ]
            },
            5: {
                id: "d0717e53-3c8e-4cba-a34b-ec7e7dc08206",
                title: "01.05 Comments",
                type: "practice",
                xp: 100,
                instructions: `
                    <h3>Comments</h3>
                    <p>Comments are notes for humans that Python ignores.</p>
                    <p>We use the <code>#</code> symbol to create comments.</p>
                    <p>Everything after <code>#</code> on a line is a comment.</p>
                    
                    <h3>Examples</h3>
                    <pre># This whole line is a comment
print("Hello")  # This is also a comment</pre>
                    
                    <h3>Task</h3>
                    <p>The code draws a 3D box and a sunset. Add:</p>
                    <ol>
                        <li>One comment on its own line (anywhere)</li>
                        <li>One comment at the end of a print line</li>
                    </ol>
                    
                    <p><strong>Ideas for comments:</strong></p>
                    <ul>
                        <li>What the code does</li>
                        <li>Which part is the box/sunset</li>
                        <li>Your thoughts about the art</li>
                    </ul>
                `,
                starterCode: `# Print a 3D object
print("    __ __ __ __ __  ")
print("  /__/__/__/__/__/| ")
print(" /__/__/__/__/__/|/ ")
print(" |__'__'__'__'__|/  ")



# Print a sunset
print("                            ") # sky
print("       \\  '  /              ") # sun
print("         .-.          ^^    ") # wave
print("    -=  (   )  =-       ^^  ") # horizon
print("~-~^~^~-=~=~=-~^~^~^-~^~^~^~") # ocean
print("~~-~^~^~-=^~~^-~^~^~^-~^~^~^")
print(".:..::::..:..:.::.::...:::..") # beach
print("::::::::::::::::::::::::::::")`,
                hints: [
                    "Look for lines without comments - you can add # at the end",
                    "To add a comment on its own line, just start the line with #",
                    "Comments can explain what the code does or why it's there"
                ],
                smartHints: {
                    'needs_standalone': "Add a comment on its own line, like: # This is my comment",
                    'needs_endline': "Add a comment at the end of a print line, like: print(\"text\") # comment",
                    'good_comments': "Great job! Comments help others understand your code"
                },
                checks: [
                    {
                        name: "Original code runs",
                        test: (code, output) => output.includes("__") && output.includes("~")
                    },
                    {
                        name: "Added end-of-line comment",
                        test: (code, output) => {
                            const lines = code.split('\n');
                            const newEndComments = lines.filter(line => 
                                line.includes('print(') && 
                                line.includes('#') && 
                                line.indexOf('#') > line.indexOf('print(')
                            ).length;
                            return newEndComments > 6; // More than the original 6
                        }
                    },
                    {
                        name: "Added standalone comment",
                        test: (code, output) => {
                            const lines = code.split('\n');
                            const standaloneComments = lines.filter(line => 
                                line.trim().startsWith('#') && 
                                !line.includes('Print a 3D object') && 
                                !line.includes('Print a sunset')
                            ).length;
                            return standaloneComments > 0;
                        }
                    }
                ]
            },

            6: {
    id: "assessment-section-1",
    title: "Section 1 Assessment",
    type: "assessment",
    xp: 150,
    instructions: `
        <h3>üéØ Section 1 Assessment</h3>
        <p>Great job completing the practical tasks! Now let's check your understanding with some questions and fun challenges.</p>
        <p>This assessment includes:</p>
        <ul>
            <li>Quick review questions</li>
            <li>Code challenges</li>
            <li>Interactive simulations</li>
            <li>A fun mini-game!</li>
        </ul>
        <p><strong>Tip:</strong> You can refer back to previous tasks if you need help!</p>
    `,
    starterCode: `# Question 1: Write your print statement here\n\n\n# Question 4: Add your comment on the line below\n\nPrint(answer"`,
    assessmentQuestions: [
        {
            id: "q1",
            type: "code",
            question: "Write a print statement that displays: Computer Science is amazing!",
            hint: "Remember the syntax: print(\"your text here\")",
            check: (code) => {
                return code.includes('print(') && 
                       (code.includes('"Computer Science is amazing!"') || 
                        code.includes("'Computer Science is amazing!'"));
            }
        },
        {
            id: "q2",
            type: "multiple-choice",
            question: "What is meant by the word 'syntax' in programming?",
            options: [
                "The speed at which code runs",
                "The rules for how code must be written",
                "The color of the text in the editor",
                "The name of a Python command"
            ],
            correct: 1,
            explanation: "Syntax refers to the rules and structure for writing code that the computer can understand."
        },
        {
            id: "q3",
            type: "text-input",
            question: "Explain why it is a good idea to add comments to your code (write at least 2 reasons)",
            hint: "Think about who might read your code later...",
            keywords: ["understand", "explain", "remember", "help", "other", "people", "later", "forget", "clear", "purpose"]
        },
        {
            id: "q4",
            type: "code",
            question: "Add a comment above the code that says 'I need to correct this', then fix the error",
            check: (code) => {
                const hasComment = code.includes('# I need to correct this') || 
                                 code.includes('#I need to correct this');
                const hasCorrectPrint = code.includes('print(answer)') || 
                                       code.includes('print("answer")');
                return hasComment && hasCorrectPrint;
            }
        }
    ],
    simulations: [
        {
            id: "syntax-detective",
            title: "üîç Syntax Detective",
            description: "Find and fix the syntax errors before time runs out!"
        },
        {
            id: "comment-match",
            title: "üí¨ Comment Matcher",
            description: "Match code snippets with appropriate comments"
        },
        {
            id: "print-puzzle",
            title: "üß© Print Puzzle",
            description: "Arrange code blocks to create the requested output"
        }
    ]
    
}
        };

// Add ALL these functions right here, immediately after the tasks object:

// Assessment-specific functions
let assessmentProgress = {
    q1: false,
    q2: false,
    q3: false,
    q4: false
};

function initializeAssessmentEditors() {
    // Initialize CodeMirror for assessment code questions
    const assessEditor1 = CodeMirror.fromTextArea(document.getElementById('assessCode1'), {
        mode: 'python',
        theme: currentTheme,
        lineNumbers: true,
        indentUnit: 4,
        autoCloseBrackets: true,
        matchBrackets: true
    });
    editors['assess1'] = assessEditor1;
    
    const assessEditor4 = CodeMirror.fromTextArea(document.getElementById('assessCode4'), {
        mode: 'python',
        theme: currentTheme,
        lineNumbers: true,
        indentUnit: 4,
        autoCloseBrackets: true,
        matchBrackets: true
    });
    editors['assess4'] = assessEditor4;
}

function checkAssessmentCode(taskNum, questionIndex, editorId) {
    const editor = editors[editorId === 'assessCode1' ? 'assess1' : 'assess4'];
    const code = editor.getValue();
    const question = tasks[taskNum].assessmentQuestions[questionIndex];
    const feedbackEl = document.getElementById(`feedback-q${questionIndex + 1}`);
    
    if (question.check(code)) {
        feedbackEl.innerHTML = '<span class="success">‚úì Correct! Well done!</span>';
        feedbackEl.className = 'feedback-box success';
        assessmentProgress[`q${questionIndex + 1}`] = true;
        document.getElementById(`prog-q${questionIndex + 1}`).textContent = `‚úì Question ${questionIndex + 1}`;
        document.getElementById(`prog-q${questionIndex + 1}`).classList.add('completed');
    } else {
        feedbackEl.innerHTML = `<span class="error">Not quite right. Hint: ${question.hint}</span>`;
        feedbackEl.className = 'feedback-box error';
    }
    
    checkAssessmentComplete();
}

function checkMCAnswer(taskNum, questionIndex) {
    const question = tasks[taskNum].assessmentQuestions[questionIndex];
    const selected = document.querySelector('input[name="q2"]:checked');
    const feedbackEl = document.getElementById('feedback-q2');
    
    if (!selected) {
        feedbackEl.innerHTML = '<span class="error">Please select an answer</span>';
        return;
    }
    
    if (parseInt(selected.value) === question.correct) {
        feedbackEl.innerHTML = `<span class="success">‚úì Correct! ${question.explanation}</span>`;
        feedbackEl.className = 'feedback-box success';
        assessmentProgress.q2 = true;
        document.getElementById('prog-q2').textContent = '‚úì Question 2';
        document.getElementById('prog-q2').classList.add('completed');
    } else {
        feedbackEl.innerHTML = '<span class="error">Not quite. Think about what rules we need to follow when writing code.</span>';
        feedbackEl.className = 'feedback-box error';
    }
    
    checkAssessmentComplete();
}

function checkTextAnswer(taskNum, questionIndex) {
    const answer = document.getElementById('textAnswer3').value.toLowerCase();
    const question = tasks[taskNum].assessmentQuestions[questionIndex];
    const feedbackEl = document.getElementById('feedback-q3');
    
    if (answer.length < 20) {
        feedbackEl.innerHTML = '<span class="error">Please write a more detailed answer</span>';
        return;
    }
    
    const keywordCount = question.keywords.filter(keyword => 
        answer.includes(keyword)
    ).length;
    
    if (keywordCount >= 2) {
        feedbackEl.innerHTML = '<span class="success">‚úì Good explanation!</span>';
        feedbackEl.className = 'feedback-box success';
        assessmentProgress.q3 = true;
        document.getElementById('prog-q3').textContent = '‚úì Question 3';
        document.getElementById('prog-q3').classList.add('completed');
    } else {
        feedbackEl.innerHTML = `<span class="warning">Your answer could be more detailed. ${question.hint}</span>`;
        feedbackEl.className = 'feedback-box warning';
    }
    
    checkAssessmentComplete();
}

function checkAssessmentComplete() {
    const allComplete = Object.values(assessmentProgress).every(v => v === true);
    const submitBtn = document.getElementById('submitBtn');
    if (submitBtn) {
        submitBtn.disabled = !allComplete;
    }
}

function submitAssessment(taskNum) {
    if (confirm('Submit your assessment?')) {
        // Mark assessment as completed
        taskProgress[taskNum] = {
            completed: true,
            timestamp: new Date().toISOString()
        };
        
        // Award XP
        awardXP(tasks[taskNum].xp);
        
        // Show completion message
        showAchievement('üèÜ', 'Assessment Complete!', 'You finished Section 1!', 150);
        
        updateProgress();
        saveAllProgress();
    }
}

// Simulation functions
function startSimulation(simId) {
    const modal = document.getElementById('simulationModal');
    const content = document.getElementById('simulationContent');
    
    modal.style.display = 'block';
    
    switch(simId) {
        case 'syntax-detective':
            content.innerHTML = createSyntaxDetectiveGame();
            startSyntaxDetective();
            break;
        case 'comment-match':
            content.innerHTML = createCommentMatchGame();
            startCommentMatch();
            break;
        case 'print-puzzle':
            content.innerHTML = createPrintPuzzleGame();
            startPrintPuzzle();
            break;
    }
}

function closeSimulation() {
    const modal = document.getElementById('simulationModal');
    if (modal) {
        modal.style.display = 'none';
    }
}

// Mini-game implementations
function createSyntaxDetectiveGame() {
    return `
        <h2>üîç Syntax Detective</h2>
        <p>Find and fix all syntax errors before time runs out!</p>
        <div class="game-timer">Time: <span id="gameTimer">60</span>s</div>
        <div class="game-score">Score: <span id="gameScore">0</span></div>
        <div id="syntaxChallenges"></div>
    `;
}

function startSyntaxDetective() {
    const challenges = [
        { code: 'print"Hello World"', fix: 'print("Hello World")', hint: 'Missing parentheses' },
        { code: 'print("Python is fun)', fix: 'print("Python is fun")', hint: 'Missing closing quote' },
        { code: 'prin("Debug me")', fix: 'print("Debug me")', hint: 'Typo in print' }
    ];
    
    let score = 0;
    let timeLeft = 60;
    let currentChallenge = 0;
    
function showChallenge() {
    if (currentChallenge < challenges.length) {
        document.getElementById('syntaxChallenges').innerHTML = `
            <div class="syntax-challenge">
                <p>Fix this code:</p>
                <pre>${challenges[currentChallenge].code}</pre>
                <input type="text" id="fixInput" placeholder="Type the corrected code" autocomplete="off">
                <button id="checkBtn" onclick="checkSyntaxFix(${currentChallenge})">Check</button>
                <div id="syntaxFeedback"></div>
            </div>
        `;
        
        // Auto-focus the input and add enter key listener
        const input = document.getElementById('fixInput');
        input.focus();
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                checkSyntaxFix(currentChallenge);
            }
        });
    } else {
        endSyntaxGame();
    }
}
    
window.checkSyntaxFix = function(index) {
    const input = document.getElementById('fixInput');
    if (input.value === challenges[index].fix) {
        score += 100;
        document.getElementById('gameScore').textContent = score;
        document.getElementById('syntaxFeedback').innerHTML = '<span class="success">Correct!</span>';
        currentChallenge++;
        setTimeout(() => {
            showChallenge();
        }, 1000);
    } else {
        document.getElementById('syntaxFeedback').innerHTML = 
            `<span class="error">Not quite. Hint: ${challenges[index].hint}</span>`;
        // Select all text for easy retry
        input.select();
    }
};
    
    function endSyntaxGame() {
        document.getElementById('syntaxChallenges').innerHTML = `
            <h3>Game Over!</h3>
            <p>Final Score: ${score}</p>
            <p>You fixed ${currentChallenge} syntax errors!</p>
            <button onclick="closeSimulation()">Close</button>
        `;
    }
    
    // Start timer
    const timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('gameTimer').textContent = timeLeft;
        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            endSyntaxGame();
        }
    }, 1000);
    
    showChallenge();
}

function createCommentMatchGame() {
    return `<h2>üí¨ Comment Matcher</h2><p>Coming soon!</p><button onclick="closeSimulation()">Close</button>`;
}

function startCommentMatch() {
    // Implementation for comment matching game
}

function createPrintPuzzleGame() {
    return `<h2>üß© Print Puzzle</h2><p>Coming soon!</p><button onclick="closeSimulation()">Close</button>`;
}

function startPrintPuzzle() {
    // Implementation for print puzzle game
}

// NOW continue with the rest of your code (loadTaskContent, etc.)
        
        
        // DEFINE ALL FUNCTIONS BEFORE USING THEM
        
        // Load task content
        function loadTaskContent(taskNum) {
            const task = tasks[taskNum];
            const taskContent = document.getElementById('taskContent');
if (task.type === 'assessment') {
    taskContent.innerHTML = `
        <div class="task-header">
            <div class="task-header-left">
                <h2>${task.title}</h2>
                <span class="task-type assessment">Assessment</span>
            </div>
            <div class="task-badges">
                <span class="task-xp">+${task.xp} XP</span>
            </div>
        </div>
        
        <div class="instructions">
            ${task.instructions}
        </div>
        
        <div class="assessment-container">
            <!-- Question 1: Code -->
            <div class="assessment-question" id="aq1">
                <h4>Question 1: ${task.assessmentQuestions[0].question}</h4>
                <div class="code-section">
                    <div class="editor-container">
                        <textarea id="assessCode1"></textarea>
                    </div>
                    <button onclick="checkAssessmentCode(6, 0, 'assessCode1')" class="check-btn">
                        Check Answer
                    </button>
                </div>
                <div id="feedback-q1" class="feedback-box"></div>
            </div>
            
            <!-- Question 2: Multiple Choice -->
            <div class="assessment-question" id="aq2">
                <h4>Question 2: ${task.assessmentQuestions[1].question}</h4>
                <div class="mc-options">
                    ${task.assessmentQuestions[1].options.map((opt, i) => `
                        <label class="mc-option">
                            <input type="radio" name="q2" value="${i}">
                            <span>${opt}</span>
                        </label>
                    `).join('')}
                </div>
                <button onclick="checkMCAnswer(6, 1)" class="check-btn">
                    Check Answer
                </button>
                <div id="feedback-q2" class="feedback-box"></div>
            </div>
            
            <!-- Question 3: Text Input -->
            <div class="assessment-question" id="aq3">
                <h4>Question 3: ${task.assessmentQuestions[2].question}</h4>
                <textarea class="text-answer" id="textAnswer3" rows="4" 
                    placeholder="Write your explanation here..."></textarea>
                <button onclick="checkTextAnswer(6, 2)" class="check-btn">
                    Check Answer
                </button>
                <div id="feedback-q3" class="feedback-box"></div>
            </div>
            
            <!-- Question 4: Code with Comment -->
            <div class="assessment-question" id="aq4">
                <h4>Question 4: ${task.assessmentQuestions[3].question}</h4>
                <div class="code-section">
                    <div class="editor-container">
                        <textarea id="assessCode4">${task.starterCode.split('# Question 4:')[1]}</textarea>
                    </div>
                    <button onclick="checkAssessmentCode(6, 3, 'assessCode4')" class="check-btn">
                        Check Answer
                    </button>
                </div>
                <div id="feedback-q4" class="feedback-box"></div>
            </div>
            
            <!-- Interactive Simulations -->
            <div class="simulations-section">
                <h3>üéÆ Interactive Challenges</h3>
                <div class="simulation-grid">
                    ${task.simulations.map(sim => `
                        <div class="simulation-card" onclick="startSimulation('${sim.id}')">
                            <h4>${sim.title}</h4>
                            <p>${sim.description}</p>
                            <button class="play-btn">Play ‚Üí</button>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- Progress Summary -->
            <div class="assessment-progress" id="assessProgress">
                <h3>Your Progress</h3>
                <div class="progress-items">
                    <div class="progress-item" id="prog-q1">‚ùì Question 1</div>
                    <div class="progress-item" id="prog-q2">‚ùì Question 2</div>
                    <div class="progress-item" id="prog-q3">‚ùì Question 3</div>
                    <div class="progress-item" id="prog-q4">‚ùì Question 4</div>
                </div>
                <button onclick="submitAssessment(6)" class="submit-btn" id="submitBtn" disabled>
                    Submit Assessment
                </button>
            </div>
        </div>
        
        <!-- Simulation Modal -->
        <div id="simulationModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeSimulation()">&times;</span>
                <div id="simulationContent"></div>
            </div>
        </div>
    `;
    
    // Initialize code editors for assessment
    setTimeout(() => {
        initializeAssessmentEditors();
    }, 100);
} else {
    // Keep your existing taskContent.innerHTML here (the original content)
taskContent.innerHTML = `
                <div class="task-header">
                    <div class="task-header-left">
                        <h2>${task.title}</h2>
                        <span class="task-type ${task.type}">${task.type === 'example' ? 'Example' : 'Practice'}</span>
                    </div>
                    <div class="task-badges">
                        <span class="task-xp">+${task.xp} XP</span>
                    </div>
                </div>
                
                <div class="instructions">
                    ${task.instructions}
<div class="audio-controls">
    <button class="audio-btn" id="playAudioBtn${taskNum}" onclick="toggleAudioInstructions(${taskNum})" title="Read instructions aloud">
        üîä
    </button>
    <button class="audio-btn" id="stopAudioBtn${taskNum}" onclick="stopAudio()" title="Stop audio" style="display: none;">
        ‚èπÔ∏è
    </button>
</div>
                </div>
                
                <div class="code-section">
                    <div class="editor-header">
                        <div class="editor-title">Python Code Editor</div>
                    </div>
                    
                    <div class="editor-container">
                        <textarea id="code${taskNum}">${task.starterCode}</textarea>
                    </div>
                    
                    <div class="controls">
                        <button onclick="runCode(${taskNum})" id="runBtn${taskNum}" class="run-btn">
                            ‚ñ∂ Run
                        </button>
                        <button onclick="checkCode(${taskNum})" id="checkBtn${taskNum}" class="check-btn">
                            ‚úì Check
                        </button>
                        <button onclick="toggleDebugger(${taskNum})" class="debug-btn">
                            üêõ Debug
                        </button>
                        <button onclick="showHint(${taskNum})" class="hint-btn">
                            üí° Hint
                        </button>


                        <button onclick="showHistory(${taskNum})" class="history-btn">
                            üìú History
                        </button>
                        <button onclick="resetCode(${taskNum})" class="reset-btn">
                            ‚Üª Reset
                        </button>
                    </div>
                    
                    <div class="hint-box" id="hint${taskNum}"></div>
                   
                    
                    <div class="debugger-panel" id="debugger${taskNum}">
                        <div class="debugger-controls">
                            <button class="debugger-btn" onclick="debugStep(${taskNum})">Step ‚Üí</button>
                            <button class="debugger-btn" onclick="debugRun(${taskNum})">Run to End</button>
                            <button class="debugger-btn" onclick="debugStop(${taskNum})">Stop</button>
                        </div>
                        <div class="debugger-content">
                            <div class="debug-section">
                                <h4>Current Line</h4>
                                <div class="current-line" id="debugLine${taskNum}">Not running</div>
                            </div>
                            <div class="debug-section">
                                <h4>Variables</h4>
                                <div class="variable-list" id="debugVars${taskNum}">No variables yet</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="visualization-panel" id="visualization${taskNum}">
                        <h4>Loop Visualization</h4>
                        <div class="loop-visualization" id="loopVis${taskNum}"></div>
                    </div>
                    
                    <div class="history-panel" id="history${taskNum}">
                        <h4>Code History</h4>
                        <div class="history-list" id="historyList${taskNum}"></div>
                    </div>
                    
                    <div class="output-section">
                        <div class="output-panel">
                            <div class="output-header">
                                <span>Output</span>
                                <span class="execution-info" id="execInfo${taskNum}"></span>
                            </div>
                            <div class="output-content" id="output${taskNum}">
                                <span class="success">Ready to run your code...</span>
                            </div>
                        </div>
                        
                        <div class="output-panel" id="checkPanel${taskNum}" style="display: none;">
                            <div class="output-header">
                                <span>Check Results</span>
                            </div>
                            <div class="output-content" id="checkOutput${taskNum}">
                            </div>
                        </div>
                        
                        <div class="code-quality-feedback" id="qualityFeedback${taskNum}"></div>
                    </div>
                </div>
                
                <div class="next-task-section" id="nextSection${taskNum}">
                    <h3>üéâ Well done! You've completed this task.</h3>
                    <button class="next-btn" onclick="nextTask()">
                        Continue to Next Task ‚Üí
                    </button>
                </div>
            `;
}
            
            
        }
        // Extension section functions
function toggleExtension() {
    const section = document.getElementById('extensionSection');
    const arrow = document.getElementById('extensionArrow');
    
    if (section.style.display === 'none') {
        section.style.display = 'block';
        arrow.textContent = '‚ñº';
    } else {
        section.style.display = 'none';
        arrow.textContent = '‚ñ∂';
    }
}

function showExtensionTopic(topic) {
    const taskContent = document.getElementById('taskContent');
    const extensionContent = document.getElementById('extensionContent');
    
    // Hide task content and show extension content
    taskContent.style.display = 'none';
    extensionContent.style.display = 'block';
    
    // Update active states - remove active from tasks
    document.querySelectorAll('.task-item').forEach(item => item.classList.remove('active'));
    document.querySelectorAll('.extension-item').forEach(item => item.classList.remove('active'));
    
    // Add active to clicked extension item
    event.currentTarget.classList.add('active');
    
    // Destroy any existing editors
    Object.keys(editors).forEach(key => {
        if (editors[key]) {
            editors[key].toTextArea();
            delete editors[key];
        }
    });
    
    // Load the extension content
    extensionContent.innerHTML = getExtensionContent(topic);
    
    // Initialize any code editors in the extension
    setTimeout(() => {
        const textareas = extensionContent.querySelectorAll('textarea.extension-code');
        textareas.forEach((textarea, index) => {
            const editor = CodeMirror.fromTextArea(textarea, {
                mode: 'python',
                theme: currentTheme,
                lineNumbers: true,
                indentUnit: 4,
                readOnly: textarea.hasAttribute('readonly')
            });
            editor.setSize("100%", "auto");
        });
    }, 100);
}

function getExtensionContent(topic) {
    const topics = {
        'special-chars': {
            title: 'Special Characters in Strings',
            content: `
<div class="extension-header">
    <h2>Special Characters in Strings</h2>
</div>
                
                <div class="extension-content">
                    <div class="concept-section">
                        <h3>What are Special Characters?</h3>
                        <p>Sometimes we need to include characters in our strings that can't be typed directly or have special meaning in Python.</p>
                        
                        <h4>Common Special Characters:</h4>
                        <ul>
                            <li><code>\\"</code> - Double quote inside a string</li>
                            <li><code>\\'</code> - Single quote inside a string</li>
                            <li><code>\\\\</code> - Backslash character</li>
                        </ul>
                        
                        <div class="example-box">
                            <h4>Example 1: Quotes inside quotes</h4>
                            <textarea class="extension-code" readonly>print("She said, \\"Hello!\\" to me")
print('It\\'s a beautiful day')</textarea>
                        </div>
                        
<div class="try-it">
    <h4>Try it yourself!</h4>
    <p>Write a print statement that displays: Python says "Welcome!"</p>
    <textarea class="extension-code" id="trySpecialChars">print()</textarea>
    <button onclick="runExtensionCode('trySpecialChars')" class="run-btn">‚ñ∂ Run</button>
    <button onclick="checkExtensionComplete('special-chars', 'trySpecialChars')" class="check-btn">‚úì Check</button>
    <div class="extension-output" id="output-trySpecialChars"></div>
    <div class="extension-feedback" id="feedback-trySpecialChars"></div>
</div>
                    </div>
                </div>
            `
        },
        'escape-sequences': {
            title: 'Escape Sequences',
            content: `
                <div class="extension-header">
                    <h2>Escape Sequences</h2>
                </div>
                
                <div class="extension-content">
                    <div class="concept-section">
                        <h3>Special Escape Sequences</h3>
                        <p>Escape sequences let us add formatting to our text output.</p>
                        
                        <h4>Common Escape Sequences:</h4>
                        <ul>
                            <li><code>\\n</code> - New line (like pressing Enter)</li>
                            <li><code>\\t</code> - Tab (adds spacing)</li>
                            <li><code>\\r</code> - Carriage return</li>
                        </ul>
                        
                        <div class="example-box">
                            <h4>Example: Multi-line output with one print</h4>
                            <textarea class="extension-code" readonly>print("Line 1\\nLine 2\\nLine 3")
print("Name:\\tJohn\\nAge:\\t15\\nGrade:\\t9")</textarea>
                        </div>
                        
                        <div class="try-it">
                            <h4>Try it yourself!</h4>
                            <p>Create a receipt format using tabs:</p>
                            <textarea class="extension-code" id="tryEscape">print("RECEIPT")
print("========")
# Add items with prices using \\t</textarea>
                            <button onclick="runExtensionCode('tryEscape')" class="run-btn">‚ñ∂ Run</button>
                            <div class="extension-output" id="output-tryEscape"></div>
                        </div>
                        
                        <div class="challenge-box">
                            <h4>üéØ Challenge</h4>
                            <p>Create a pyramid shape using a single print statement with \\n:</p>
                            <pre>   *
  ***
 *****
*******</pre>
                        </div>
                    </div>
                </div>
            `
        },
        'string-multiplication': {
            title: 'String Multiplication',
            content: `
                <div class="extension-header">
                    <h2>String Multiplication</h2>
                </div>
                
                <div class="extension-content">
                    <div class="concept-section">
                        <h3>Repeating Strings</h3>
                        <p>Python lets us multiply strings to repeat them!</p>
                        
                        <div class="example-box">
                            <h4>Example: Creating lines and patterns</h4>
                            <textarea class="extension-code" readonly>print("=" * 20)
print("Hello " * 3)
print("*-" * 10)</textarea>
                        </div>
                        
                        <div class="try-it">
                            <h4>Try it yourself!</h4>
                            <p>Create a border for a title:</p>
                            <textarea class="extension-code" id="tryMultiply">print("*" * 30)
print("   PYTHON BASICS   ")
# Add bottom border here</textarea>
                            <button onclick="runExtensionCode('tryMultiply')" class="run-btn">‚ñ∂ Run</button>
                            <div class="extension-output" id="output-tryMultiply"></div>
                        </div>
                        
                        <div class="fun-fact">
                            <h4>üí° Fun Fact</h4>
                            <p>You can combine string multiplication with variables later to create dynamic borders!</p>
                        </div>
                    </div>
                </div>
            `
        },
        'advanced-print': {
            title: 'Advanced Print Features',
            content: `
                <div class="extension-header">
                    <h2>Advanced Print Features</h2>
                </div>
                
                <div class="extension-content">
                    <div class="concept-section">
                        <h3>Multiple Items in One Print</h3>
                        <p>You can print multiple things separated by commas!</p>
                        
                        <div class="example-box">
                            <h4>Example: Printing multiple values</h4>
                            <textarea class="extension-code" readonly>print("Hello", "World", "!")
print("The answer is", 42)
print("A", "B", "C", "D", "E")</textarea>
                        </div>
                        
                        <h3>Custom Separators</h3>
                        <p>Change what appears between items with <code>sep</code>:</p>
                        
                        <div class="example-box">
                            <h4>Example: Using sep parameter</h4>
                            <textarea class="extension-code" readonly>print("A", "B", "C", sep="-")
print("2024", "12", "25", sep="/")
print("red", "green", "blue", sep=" | ")</textarea>
                        </div>
                        
                        <div class="try-it">
                            <h4>Try it yourself!</h4>
                            <p>Create a phone number format:</p>
                            <textarea class="extension-code" id="tryAdvanced">print("555", "123", "4567", sep="-")</textarea>
                            <button onclick="runExtensionCode('tryAdvanced')" class="run-btn">‚ñ∂ Run</button>
                            <div class="extension-output" id="output-tryAdvanced"></div>
                        </div>
                    </div>
                </div>
            `
        },
        'print-formatting': {
            title: 'Creative Print Formatting',
            content: `
                <div class="extension-header">
                    <h2>Creative Print Formatting</h2>
                </div>
                
                <div class="extension-content">
                    <div class="concept-section">
                        <h3>ASCII Art with Print</h3>
                        <p>Combine everything you've learned to create art!</p>
                        
                        <div class="example-box">
                            <h4>Example: Creating a house</h4>
                            <textarea class="extension-code" readonly>print("     /\\\\")
print("    /  \\\\")
print("   /    \\\\")
print("  /======\\\\")
print("  |      |")
print("  |  []  |")
print("  |______|")
print("=" * 12)</textarea>
                        </div>
                        
                        <h3>Combining Techniques</h3>
                        <div class="example-box">
                            <h4>Example: Formatted output</h4>
                            <textarea class="extension-code" readonly># Title with border
print("+" + "-" * 20 + "+")
print("|" + " STUDENT REPORT ".center(20) + "|")
print("+" + "-" * 20 + "+")
print()  # Empty line
print("Name:\\tJohn Smith")
print("Grade:\\t9")
print("=" * 22)</textarea>
                        </div>
                        
                        <div class="project-idea">
                            <h4>üöÄ Mini Project</h4>
                            <p>Create your own ASCII art animal or object using print statements!</p>
                            <textarea class="extension-code" id="tryProject"># Create your ASCII art here
print("  ^___^")
print(" ( o.o )")
print("  > ^ <")</textarea>
                            <button onclick="runExtensionCode('tryProject')" class="run-btn">‚ñ∂ Run</button>
                            <div class="extension-output" id="output-tryProject"></div>
                        </div>
                    </div>
                </div>
            `
        }
    };
    
    return topics[topic]?.content || '<p>Topic not found</p>';
}



async function runExtensionCode(editorId) {
    if (!pyodide) {
        alert('Python environment not ready');
        return;
    }
    
    const textarea = document.getElementById(editorId);
    const outputDiv = document.getElementById(`output-${editorId}`);
    
    // Get code from CodeMirror or textarea
    let code;
    const cm = textarea.nextSibling;
    if (cm && cm.CodeMirror) {
        code = cm.CodeMirror.getValue();
    } else {
        code = textarea.value;
    }
    
    outputDiv.innerHTML = '<span class="loading">Running...</span>';
    
    try {
        // Capture output
        pyodide.runPython(`
import sys
from io import StringIO
output_buffer = StringIO()
old_stdout = sys.stdout
sys.stdout = output_buffer
        `);
        
        // Run user code
        pyodide.runPython(code);
        
        // Get output
        pyodide.runPython(`
sys.stdout = old_stdout
output_text = output_buffer.getvalue()
output_buffer.close()
        `);
        
        const output = pyodide.globals.get('output_text');
        outputDiv.innerHTML = `<pre>${output || 'No output'}</pre>`;
        
    } catch (error) {
        outputDiv.innerHTML = `<span class="error">Error: ${error.message}</span>`;
    }
}
        
        // Initialize CodeMirror editors
        function initializeEditor(taskNum) {
            // Always create a fresh editor
            const textarea = document.getElementById(`code${taskNum}`);
            if (!textarea) return null;
            
            // Create the editor
            const editor = CodeMirror.fromTextArea(textarea, {
                mode: 'python',
                theme: currentTheme,
                lineNumbers: true,
                indentUnit: 4,
                autoCloseBrackets: true,
                matchBrackets: true,
                indentWithTabs: false,
                viewportMargin: Infinity,
                lint: settings.syntaxCheckEnabled ? pythonLinter : false,
                gutters: settings.syntaxCheckEnabled ? ["CodeMirror-lint-markers"] : ["CodeMirror-linenumbers"],
                extraKeys: {
                    "Tab": function(cm) {
                        cm.replaceSelection("    ", "end");
                    },
                    "Ctrl-Space": "autocomplete",
                    // Disable copy, cut, and paste
"Ctrl-C": function(cm) {
    return false;
},
"Ctrl-X": function(cm) {
    return false;
},
"Ctrl-V": function(cm) {
    return false;
},
"Cmd-C": function(cm) {
    return false;
},
"Cmd-X": function(cm) {
    return false;
},
"Cmd-V": function(cm) {
    return false;
}
                }
            });
            
            // Store reference
            editors[taskNum] = editor;
            
            // Disable right-click context menu in the editor
editor.getWrapperElement().addEventListener('contextmenu', function(e) {
    e.preventDefault();
    return false;
});
            
            // Disable drag and drop
editor.on('drop', function(cm, e) {
    e.preventDefault();
    return false;
});
            
            // Track code changes for smart hints
            editor.on('change', function() {
                saveProgress(taskNum);
                checkForCommonMistakes(taskNum);
                
                // Add to history
                if (!codeHistory[taskNum]) codeHistory[taskNum] = [];
                codeHistory[taskNum].push({
                    code: editor.getValue(),
                    timestamp: new Date()
                });
                
                // Keep only last 20 versions
                if (codeHistory[taskNum].length > 20) {
                    codeHistory[taskNum].shift();
                }
            });
            
            // Set explicit size and refresh
            editor.setSize("100%", "300px");
            editor.refresh();
            
            return editor;
        }
        
        // Python linter for live syntax checking
        function pythonLinter(text, options) {
            const errors = [];
            const lines = text.split('\n');
            
            lines.forEach((line, i) => {
                // Check for missing closing parenthesis
                const openParens = (line.match(/\(/g) || []).length;
                const closeParens = (line.match(/\)/g) || []).length;
                if (openParens > closeParens) {
                    errors.push({
                        from: CodeMirror.Pos(i, line.length),
                        to: CodeMirror.Pos(i, line.length),
                        message: "Missing closing parenthesis )",
                        severity: "error"
                    });
                }
                
                // Check for unclosed quotes
                const quotes = line.match(/"/g) || [];
                if (quotes.length % 2 !== 0) {
                    errors.push({
                        from: CodeMirror.Pos(i, line.length),
                        to: CodeMirror.Pos(i, line.length),
                        message: "Unclosed string - missing \"",
                        severity: "error"
                    });
                }
                
                // Check for common typos
                if (line.includes('prin(') && !line.includes('print(')) {
                    const col = line.indexOf('prin(');
                    errors.push({
                        from: CodeMirror.Pos(i, col),
                        to: CodeMirror.Pos(i, col + 4),
                        message: "Did you mean 'print'?",
                        severity: "warning"
                    });
                }
            });
            
            return errors;
        }
        
        // Load Pyodide
        async function initializePyodide() {
            const outputElements = document.querySelectorAll('.output-content');
            outputElements.forEach(el => {
                if (el) el.innerHTML = '<span class="loading">Loading Python environment...</span>';
            });
            
            try {
                pyodide = await loadPyodide({
                    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
                });
                
                outputElements.forEach(el => {
                    if (el) el.innerHTML = '<span class="success">Python ready! Click "Run" to execute your code.</span>';
                });
            } catch (error) {
                outputElements.forEach(el => {
                    if (el) el.innerHTML = '<span class="error">Failed to load Python. Please refresh.</span>';
                });
                console.error('Failed to load Pyodide:', error);
            }
        }


        
        // Switch between tasks
function switchTask(taskNum) {
    currentTask = taskNum;
    
    // Hide extension content and show task content
    document.getElementById('extensionContent').style.display = 'none';
    document.getElementById('taskContent').style.display = 'block';
    
    // Update sidebar - remove active from all items
    document.querySelectorAll('.task-item').forEach((item, index) => {
        item.classList.toggle('active', index + 1 === taskNum);
    });
    document.querySelectorAll('.extension-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Destroy all existing editors to prevent display issues
    Object.keys(editors).forEach(key => {
        if (editors[key]) {
            editors[key].toTextArea();
            delete editors[key];
        }
    });
    
    // Load task content
    loadTaskContent(taskNum);
    
    // Create new editor after content is loaded
    setTimeout(() => {
        const editor = initializeEditor(taskNum);
        loadProgress(taskNum);
        
        // Force multiple refreshes to ensure proper display
        if (editor) {
            editor.refresh();
            setTimeout(() => {
                editor.refresh();
                editor.focus();
                editor.setCursor(editor.lineCount(), 0);
            }, 100);
        }
    }, 50);
    
    // Record task start time
    taskStartTime[taskNum] = new Date();
}

async function checkExtensionComplete(topic, editorId) {
    const textarea = document.getElementById(editorId);
    const feedbackDiv = document.getElementById(`feedback-${editorId}`);
    
    // Get code from CodeMirror or textarea
    let code;
    const cm = textarea.nextSibling;
    if (cm && cm.CodeMirror) {
        code = cm.CodeMirror.getValue();
    } else {
        code = textarea.value;
    }
    
    // Get the output
    const outputDiv = document.getElementById(`output-${editorId}`);
    const output = outputDiv.textContent || '';
    
    // Check if the task is completed correctly
    const check = extensionChecks[topic];
    if (check && check.check(code, output)) {
        // Success!
        if (!extensionProgress[topic].completed) {
            extensionProgress[topic].completed = true;
            const xpEarned = extensionProgress[topic].xp;
            
            feedbackDiv.innerHTML = `<div class="test-result test-pass">
                ‚úì Excellent work! You've mastered ${topic.replace(/-/g, ' ')}! 
                <span class="xp-gained">+${xpEarned} XP</span>
            </div>`;
            
            // Award XP
            awardXP(xpEarned);
            
            // Update extension status in sidebar
            updateExtensionStatus(topic);
            
            // Check for extension badge
            checkExtensionBadges();
            
            // Save progress
            saveExtensionProgress();
            
            // Show achievement for first extension
            const completedCount = Object.values(extensionProgress).filter(e => e.completed).length;
            if (completedCount === 1) {
                showAchievement('üöÄ', 'Extension Explorer!', 'You completed your first extension activity!', 50);
            } else if (completedCount === Object.keys(extensionProgress).length) {
                showAchievement('üåü', 'Extension Master!', 'You completed all extension activities!', 100);
            }
        } else {
            feedbackDiv.innerHTML = `<div class="test-result test-pass">
                ‚úì Correct! You've already completed this activity.
            </div>`;
        }
    } else {
        feedbackDiv.innerHTML = `<div class="test-result test-fail">
            Not quite right. ${check ? check.hint : 'Try again!'}
        </div>`;
    }
}

function updateExtensionStatus(topic) {
    const statusElement = document.getElementById(`ext-status-${topic}`);
    if (statusElement) {
        statusElement.classList.add('completed');
        statusElement.textContent = '‚úì';
    }
    
    // Add completed class to the extension item
    document.querySelectorAll('.extension-item').forEach(item => {
        if (item.onclick && item.onclick.toString().includes(topic)) {
            item.classList.add('completed');
        }
    });
}

function checkExtensionBadges() {
    // Add new badges for extensions
    if (!userProfile.badges.includes('extension-explorer')) {
        const completedCount = Object.values(extensionProgress).filter(e => e.completed).length;
        if (completedCount >= 1) {
            userProfile.badges.push('extension-explorer');
        }
    }
    
    if (!userProfile.badges.includes('extension-master')) {
        const allCompleted = Object.values(extensionProgress).every(e => e.completed);
        if (allCompleted) {
            userProfile.badges.push('extension-master');
        }
    }
}

function saveExtensionProgress() {
    memoryStorage.extensionProgress = { ...extensionProgress };
    // If using localStorage:
    // localStorage.setItem('pythonWorksheetExtensionProgress', JSON.stringify(extensionProgress));
}
        
        // Run code
        async function runCode(taskNumber) {
            if (!pyodide) {
                document.getElementById(`output${taskNumber}`).innerHTML = 
                    '<span class="error">Python environment not ready. Please wait...</span>';
                return;
            }
            
            const code = editors[taskNumber].getValue();
            const outputElement = document.getElementById(`output${taskNumber}`);
            const execInfoElement = document.getElementById(`execInfo${taskNumber}`);
            const runButton = document.getElementById(`runBtn${taskNumber}`);
            
            runButton.disabled = true;
            runButton.textContent = '‚è≥ Running...';
            outputElement.innerHTML = '';
            
            const startTime = performance.now();
            
            // Increment attempts
            if (!userProfile.attemptsBeforeSuccess[taskNumber]) {
                userProfile.attemptsBeforeSuccess[taskNumber] = 0;
            }
            userProfile.attemptsBeforeSuccess[taskNumber]++;
            
            try {
                // Capture output
                pyodide.runPython(`
import sys
from io import StringIO

output_buffer = StringIO()
old_stdout = sys.stdout
sys.stdout = output_buffer
                `);
                
                // Run user code
                try {
                    pyodide.runPython(code);
                } catch (userError) {
                    outputElement.innerHTML = `<span class="error">Error: ${userError.message}</span>`;
                    showErrorHelp(taskNumber, userError.message);
                    return;
                } finally {
                    // Restore stdout
                    pyodide.runPython(`
sys.stdout = old_stdout
output_text = output_buffer.getvalue()
output_buffer.close()
                    `);
                }
                
                const output = pyodide.globals.get('output_text');
                
                if (output) {
                    outputElement.textContent = output;
                } else {
                    outputElement.innerHTML = '<span style="color: #9ca3af;">No output. Use print() to display text.</span>';
                }
                
                // Show execution time
                const endTime = performance.now();
                const execTime = (endTime - startTime).toFixed(2);
                execInfoElement.textContent = `Executed in ${execTime}ms`;
                
                // Auto-save
                saveProgress(taskNumber);
                
                // Check for visualization opportunities
                if (code.includes('for') || code.includes('while')) {
                    showLoopVisualization(taskNumber, code);
                }
                
            } catch (error) {
                outputElement.innerHTML = `<span class="error">System Error: ${error.message}</span>`;
            } finally {
                runButton.disabled = false;
                runButton.textContent = '‚ñ∂ Run';
                
                // Cleanup
                try {
                    pyodide.runPython(`
if 'output_buffer' in locals():
    output_buffer.close()
if 'output_text' in locals():
    del output_text
                    `);
                } catch (cleanupError) {
                    // Ignore
                }
            }
        }
        
        // Check code
        async function checkCode(taskNumber) {
            const checkPanel = document.getElementById(`checkPanel${taskNumber}`);
            const checkOutput = document.getElementById(`checkOutput${taskNumber}`);
            const checkButton = document.getElementById(`checkBtn${taskNumber}`);
            
            checkPanel.style.display = 'block';
            checkButton.disabled = true;
            checkButton.textContent = '‚è≥ Checking...';
            
            // First run the code
            await runCode(taskNumber);
            
            const code = editors[taskNumber].getValue();
            const output = document.getElementById(`output${taskNumber}`).textContent;
            const task = tasks[taskNumber];
            
            let checkResults = '';
            let allPassed = true;
            let xpEarned = 0;
            
            for (const check of task.checks) {
                const passed = check.test(code, output);
                allPassed = allPassed && passed;
                checkResults += `<div class="test-result ${passed ? 'test-pass' : 'test-fail'}">
                    ${passed ? '‚úì' : '‚úó'} ${check.name}
                </div>`;
            }
            
            checkOutput.innerHTML = checkResults;
            
            if (allPassed) {
                // Calculate XP
                xpEarned = task.xp;
                
                // Bonus XP for not using hints
                if (!userProfile.hintsUsed[taskNumber] || userProfile.hintsUsed[taskNumber] === 0) {
                    xpEarned += XP_VALUES.noHints;
                    checkOutput.innerHTML += '<div class="test-result test-pass">üåü No hints bonus! +25 XP</div>';
                }
                
                // Bonus XP for first try
                if (userProfile.attemptsBeforeSuccess[taskNumber] === 1) {
                    xpEarned += XP_VALUES.firstTry;
                    checkOutput.innerHTML += '<div class="test-result test-pass">‚ö° First try bonus! +50 XP</div>';
                }
                
                // Mark as completed
                taskProgress[taskNumber] = {
                    completed: true,
                    code: code,
                    timestamp: new Date().toISOString(),
                    attempts: userProfile.attemptsBeforeSuccess[taskNumber],
                    hintsUsed: userProfile.hintsUsed[taskNumber] || 0
                };
                
                // Award XP
                awardXP(xpEarned);
                
                // Check for badges
                checkBadges();
                
                // Update progress
                updateProgress();
                saveAllProgress();
                
                // Show next task button
                document.getElementById(`nextSection${taskNumber}`).style.display = 'block';
                
                checkOutput.innerHTML += `<div class="test-result test-pass xp-gained">üéâ Task Complete! +${xpEarned} XP</div>`;
                
                // Show code quality feedback
                showCodeQualityFeedback(taskNumber, code);
            } else {
                checkOutput.innerHTML += '<div class="test-result test-fail">Keep trying! Click "Hint" or "AI Help" if you need assistance.</div>';
            }
            
            checkButton.disabled = false;
            checkButton.textContent = '‚úì Check';
        }
        
        // Show hint
        let hintLevel = {};
        function showHint(taskNumber) {
            const hintBox = document.getElementById(`hint${taskNumber}`);
            const hints = tasks[taskNumber].hints;
            
            if (!hintLevel[taskNumber]) hintLevel[taskNumber] = 0;
            if (!userProfile.hintsUsed[taskNumber]) userProfile.hintsUsed[taskNumber] = 0;
            
            if (hintLevel[taskNumber] < hints.length) {
                hintBox.style.display = 'block';
                hintBox.innerHTML = `<strong>Hint ${hintLevel[taskNumber] + 1}:</strong> ${hints[hintLevel[taskNumber]]}`;
                hintLevel[taskNumber]++;
                userProfile.hintsUsed[taskNumber]++;
            } else {
                hintBox.innerHTML = `<strong>All hints shown!</strong> Try the AI Help button for more personalized assistance.`;
            }
        }
        

        
        // Check code patterns for smart hints
        function checkCodePattern(code, pattern) {
            switch (pattern) {
                case 'missing_quote':
                    return (code.match(/"/g) || []).length % 2 !== 0;
                case 'missing_paren':
                    const openParens = (code.match(/\(/g) || []).length;
                    const closeParens = (code.match(/\)/g) || []).length;
                    return openParens !== closeParens;
                case 'wrong_quotes':
                    return code.includes('"') || code.includes('"');
                case 'no_prints':
                    return !code.includes('print(');
                case 'still_starter':
                    return code.includes('Write your code here');
                case 'only_one_print':
                    return code.split('print(').length === 2;
                case 'only_two_prints':
                    return code.split('print(').length === 3;
                case 'no_blank_lines':
                    return !code.includes('print("")');
                case 'missing_lines':
                    return code.split('\n').length < 8;
                case 'typo_mcdonald':
                    return code.toLowerCase().includes('mcdonald') && !code.includes('MacDonald');
                case 'line1_paren':
                    return code.split('\n')[0] && !code.split('\n')[0].includes(')');
                case 'line2_quote':
                    return code.split('\n')[1] && (code.split('\n')[1].match(/"/g) || []).length === 1;
                case 'line3_syntax':
                    return code.split('\n')[2] && code.split('\n')[2].includes('print ');
                case 'line4_typo':
                    return code.split('\n')[3] && code.split('\n')[3].includes('prin(');
                case 'needs_standalone':
                    const lines = code.split('\n');
                    return !lines.some(line => line.trim().startsWith('#') && line.trim().length > 1);
                case 'needs_endline':
                    return !code.includes(') #');
                case 'good_comments':
                    return code.includes('#') && !code.includes('Write your code here');
                default:
                    return false;
            }
        }
        
        // Toggle debugger
        function toggleDebugger(taskNumber) {
            const debuggerPanel = document.getElementById(`debugger${taskNumber}`);
            debuggerPanel.style.display = debuggerPanel.style.display === 'none' ? 'block' : 'none';
            
            if (debuggerPanel.style.display === 'block') {
                initDebugger(taskNumber);
            }
        }
        
        // Initialize debugger
        function initDebugger(taskNumber) {
            const code = editors[taskNumber].getValue();
            const lines = code.split('\n');
            debuggerState.currentLine = 0;
            debuggerState.variables = {};
            
            updateDebuggerDisplay(taskNumber);
        }
        
        // Debug step
        function debugStep(taskNumber) {
            const code = editors[taskNumber].getValue();
            const lines = code.split('\n');
            
            if (debuggerState.currentLine < lines.length) {
                const currentLineElement = document.getElementById(`debugLine${taskNumber}`);
                currentLineElement.textContent = `Line ${debuggerState.currentLine + 1}: ${lines[debuggerState.currentLine]}`;
                
                debuggerState.currentLine++;
            } else {
                document.getElementById(`debugLine${taskNumber}`).textContent = 'Execution complete';
            }
        }
        
        // Update debugger display
        function updateDebuggerDisplay(taskNumber) {
            const varsElement = document.getElementById(`debugVars${taskNumber}`);
            let varsHTML = '';
            
            for (const [name, value] of Object.entries(debuggerState.variables)) {
                varsHTML += `<div class="variable-item">
                    <span class="variable-name">${name}</span>
                    <span class="variable-value">${value}</span>
                </div>`;
            }
            
            varsElement.innerHTML = varsHTML || 'No variables yet';
        }
        
        // Show loop visualization
        function showLoopVisualization(taskNumber, code) {
            const visPanel = document.getElementById(`visualization${taskNumber}`);
            const loopVis = document.getElementById(`loopVis${taskNumber}`);
            
            if (code.includes('for') && code.includes('range')) {
                visPanel.style.display = 'block';
                
                const rangeMatch = code.match(/range\((\d+)\)/);
                if (rangeMatch) {
                    const count = parseInt(rangeMatch[1]);
                    let visHTML = '';
                    
                    for (let i = 0; i < Math.min(count, 10); i++) {
                        visHTML += `<div class="loop-item" id="loopItem${taskNumber}_${i}">${i}</div>`;
                    }
                    
                    loopVis.innerHTML = visHTML;
                    
                    // Animate
                    let currentItem = 0;
                    const animateLoop = setInterval(() => {
                        if (currentItem > 0) {
                            document.getElementById(`loopItem${taskNumber}_${currentItem - 1}`).classList.remove('active');
                        }
                        
                        if (currentItem < count && currentItem < 10) {
                            document.getElementById(`loopItem${taskNumber}_${currentItem}`).classList.add('active');
                            currentItem++;
                        } else {
                            clearInterval(animateLoop);
                        }
                    }, 500);
                }
            }
        }
        
        // Show code history
        function showHistory(taskNumber) {
            const historyPanel = document.getElementById(`history${taskNumber}`);
            const historyList = document.getElementById(`historyList${taskNumber}`);
            
            historyPanel.style.display = historyPanel.style.display === 'none' ? 'block' : 'none';
            
            if (codeHistory[taskNumber] && codeHistory[taskNumber].length > 0) {
                let historyHTML = '';
                
                codeHistory[taskNumber].slice(-10).reverse().forEach((entry, index) => {
                    const timestamp = new Date(entry.timestamp).toLocaleTimeString();
                    historyHTML += `<div class="history-item" onclick="restoreHistory(${taskNumber}, ${codeHistory[taskNumber].length - 1 - index})">
                        <div class="history-timestamp">${timestamp}</div>
                        <div>${entry.code.substring(0, 50)}...</div>
                    </div>`;
                });
                
                historyList.innerHTML = historyHTML;
            } else {
                historyList.innerHTML = '<p>No history yet</p>';
            }
        }
        
        // Restore from history
        function restoreHistory(taskNumber, index) {
            if (confirm('Restore this version?')) {
                const entry = codeHistory[taskNumber][index];
                editors[taskNumber].setValue(entry.code);
                document.getElementById(`history${taskNumber}`).style.display = 'none';
            }
        }
        
        // Reset code
        function resetCode(taskNumber) {
            if (confirm('Reset to the starter code? Your current work will be saved in history.')) {
                editors[taskNumber].setValue(tasks[taskNumber].starterCode);
                document.getElementById(`output${taskNumber}`).innerHTML = '<span class="success">Code reset.</span>';
                document.getElementById(`checkPanel${taskNumber}`).style.display = 'none';
                document.getElementById(`hint${taskNumber}`).style.display = 'none';
                document.getElementById(`aiHelp${taskNumber}`).style.display = 'none';
                hintLevel[taskNumber] = 0;
                saveProgress(taskNumber);
            }
        }
        
        // Show error help
        function showErrorHelp(taskNumber, errorMessage) {
            const qualityFeedback = document.getElementById(`qualityFeedback${taskNumber}`);
            
            let helpMessage = '<strong>Error Help:</strong><br>';
            
            if (errorMessage.includes('SyntaxError')) {
                helpMessage += '‚Ä¢ Syntax error means Python doesn\'t understand your code format<br>';
                helpMessage += '‚Ä¢ Check for missing quotes, parentheses, or colons<br>';
            } else if (errorMessage.includes('NameError')) {
                helpMessage += '‚Ä¢ NameError means Python doesn\'t recognize a word you used<br>';
                helpMessage += '‚Ä¢ Check your spelling, especially for print()<br>';
            } else if (errorMessage.includes('IndentationError')) {
                helpMessage += '‚Ä¢ IndentationError means your spacing is wrong<br>';
                helpMessage += '‚Ä¢ Make sure lines start at the beginning (no spaces)<br>';
            }
            
            qualityFeedback.innerHTML = helpMessage;
            qualityFeedback.style.display = 'block';
        }
        
        // Show code quality feedback
        function showCodeQualityFeedback(taskNumber, code) {
            const feedback = document.getElementById(`qualityFeedback${taskNumber}`);
            let feedbackHTML = '<h4>Code Quality Feedback:</h4>';
            
            const qualityChecks = [];
            
            if (code.includes('#') && !code.includes('Write your code here')) {
                qualityChecks.push('‚úì Good use of comments!');
            }
            
            if (code.split('\n').filter(line => line.trim()).length > 3) {
                qualityChecks.push('‚úì Well-structured code with multiple lines');
            }
            
            if (!code.includes('  print') && !code.includes('\tprint')) {
                qualityChecks.push('‚úì Correct indentation');
            }
            
            if (code.includes('"') && !code.includes("'")) {
                qualityChecks.push('‚úì Consistent use of double quotes');
            } else if (code.includes("'") && !code.includes('"')) {
                qualityChecks.push('‚úì Consistent use of single quotes');
            }
            
            qualityChecks.forEach(check => {
                feedbackHTML += `<div class="quality-item">${check}</div>`;
            });
            
            feedback.innerHTML = feedbackHTML;
            feedback.style.display = 'block';
        }
        
        // Award XP
        function awardXP(amount) {
            userProfile.xp += amount;
            
            // Check for level up
            while (userProfile.xp >= userProfile.xpToNextLevel) {
                userProfile.xp -= userProfile.xpToNextLevel;
                userProfile.level++;
                userProfile.xpToNextLevel = userProfile.level * 500;
                
                showAchievement('üéâ', 'Level Up!', `You reached level ${userProfile.level}!`, 100);
            }
            
            updateUserStats();
        }
        
        // Check for badges
        function checkBadges() {
            // First Program badge
            if (taskProgress[1] && taskProgress[1].completed && !userProfile.badges.includes('first')) {
                userProfile.badges.push('first');
                showAchievement('üë∂', 'First Program!', 'You completed your first Python task!', 50);
            }
            
            // Bug Fixer badge
            if (taskProgress[4] && taskProgress[4].completed && !userProfile.badges.includes('bug')) {
                userProfile.badges.push('bug');
                showAchievement('üêõ', 'Bug Fixer!', 'You fixed all the syntax errors!', 75);
            }
            
            // Comment Champion badge
            if (taskProgress[5] && taskProgress[5].completed && !userProfile.badges.includes('comment')) {
                userProfile.badges.push('comment');
                showAchievement('üí¨', 'Comment Champion!', 'You mastered Python comments!', 75);
            }
            
            // Perfect Score badge
            const allCompleted = Object.keys(tasks).every(key => taskProgress[key] && taskProgress[key].completed);
            const noHintsUsed = Object.keys(tasks).every(key => !userProfile.hintsUsed[key] || userProfile.hintsUsed[key] === 0);
            
            if (allCompleted && noHintsUsed && !userProfile.badges.includes('perfect')) {
                userProfile.badges.push('perfect');
                showAchievement('‚≠ê', 'Perfect Score!', 'You completed all tasks without hints!', 200);
            }
            
            updateBadgeDisplay();
        }
        
        // Show achievement popup
        function showAchievement(icon, title, description, xp) {
            const popup = document.getElementById('achievementPopup');
            const overlay = document.getElementById('overlay');
            
            document.getElementById('achievementIcon').textContent = icon;
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementDesc').textContent = description;
            document.getElementById('achievementXP').textContent = `+${xp} XP`;
            
            overlay.classList.add('show');
            popup.classList.add('show');
            
            // Award XP
            awardXP(xp);
            
            // Hide after 3 seconds
            setTimeout(() => {
                overlay.classList.remove('show');
                popup.classList.remove('show');
            }, 3000);
        }
        
        // Update badge display
        function updateBadgeDisplay() {
            userProfile.badges.forEach(badgeId => {
                const badgeElement = document.getElementById(`badge-${badgeId}`);
                if (badgeElement) {
                    badgeElement.classList.add('earned');
                }
            });
        }
        
        // Update user stats
        function updateUserStats() {
            document.getElementById('userLevel').textContent = userProfile.level;
            document.getElementById('userXP').textContent = userProfile.xp;
            document.getElementById('userStreak').textContent = userProfile.streak;
            
            const xpPercentage = (userProfile.xp / userProfile.xpToNextLevel) * 100;
            document.getElementById('xpFill').style.width = `${xpPercentage}%`;
        }
        
        // Toggle settings
        function toggleDyslexicFont() {
            settings.dyslexicFont = !settings.dyslexicFont;
            document.body.classList.toggle('dyslexic-font', settings.dyslexicFont);
            document.getElementById('dyslexicToggle').classList.toggle('active', settings.dyslexicFont);
            saveSettings();
        }
        
        function toggleAudio() {
            settings.audioEnabled = !settings.audioEnabled;
            document.getElementById('audioToggle').classList.toggle('active', settings.audioEnabled);
            
            // Stop any playing audio when disabling
            if (!settings.audioEnabled) {
                stopAudio();
            }
            
            saveSettings();
        }
        
        function toggleSyntaxCheck() {
            settings.syntaxCheckEnabled = !settings.syntaxCheckEnabled;
            document.getElementById('syntaxToggle').classList.toggle('active', settings.syntaxCheckEnabled);
            
            // Recreate all editors with new settings
            Object.keys(editors).forEach(key => {
                if (editors[key]) {
                    const code = editors[key].getValue();
                    editors[key].toTextArea();
                    delete editors[key];
                }
            });
            
            setTimeout(() => {
                initializeEditor(currentTask);
                loadProgress(currentTask);
            }, 100);
            
            saveSettings();
        }
        
        // Audio control variables
        let currentUtterance = null;
        let isPlaying = false;
        
        // Toggle audio instructions (play/pause)
        function toggleAudioInstructions(taskNumber) {
            if (!settings.audioEnabled) {
                showNotification('üîä Audio Disabled', 'Enable audio in settings to use this feature', 'warning');
                return;
            }
            
            if (isPlaying) {
                stopAudio();
            } else {
                playAudioInstructions(taskNumber);
            }
        }
        
        // Play audio instructions
function playAudioInstructions(taskNumber) {
    const task = tasks[taskNumber];
    const text = task.instructions.replace(/<[^>]*>/g, ''); // Strip HTML
    
    if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        currentUtterance = new SpeechSynthesisUtterance(text);
        currentUtterance.rate = 0.9;
        
        currentUtterance.onstart = () => {
            isPlaying = true;
            const playBtn = document.getElementById(`playAudioBtn${taskNumber}`);
            const stopBtn = document.getElementById(`stopAudioBtn${taskNumber}`);
            if (playBtn) playBtn.style.display = 'none';
            if (stopBtn) stopBtn.style.display = 'block';
        };
        
        currentUtterance.onend = () => {
            isPlaying = false;
            const playBtn = document.getElementById(`playAudioBtn${taskNumber}`);
            const stopBtn = document.getElementById(`stopAudioBtn${taskNumber}`);
            if (playBtn) playBtn.style.display = 'block';
            if (stopBtn) stopBtn.style.display = 'none';
        };
        
        speechSynthesis.speak(currentUtterance);
    }
}
        
function stopAudio() {
    if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        isPlaying = false;
        
        // Reset all audio buttons
        for (let i = 1; i <= Object.keys(tasks).length; i++) {
            const playBtn = document.getElementById(`playAudioBtn${i}`);
            const stopBtn = document.getElementById(`stopAudioBtn${i}`);
            if (playBtn) playBtn.style.display = 'block';
            if (stopBtn) stopBtn.style.display = 'none';
        }
    }
}
        
        // Read instructions aloud (kept for backward compatibility)
        function readInstructions(taskNumber) {
            toggleAudioInstructions(taskNumber);
        }
        
        // Check for common mistakes
        function checkForCommonMistakes(taskNumber) {
            const code = editors[taskNumber].getValue();
            const task = tasks[taskNumber];
            
            if (!task.smartHints) return;
            
            // Check patterns and show inline hints
            for (const [pattern, hint] of Object.entries(task.smartHints)) {
                if (checkCodePattern(code, pattern)) {
                    // Could show inline hint here
                    break;
                }
            }
        }
        
        // Next task
        function nextTask() {
            if (currentTask < Object.keys(tasks).length) {
                switchTask(currentTask + 1);
            } else {
                // Check for daily challenge completion
                const allCompleted = Object.keys(tasks).every(key => taskProgress[key] && taskProgress[key].completed);
                const noHintsUsed = Object.keys(tasks).every(key => !userProfile.hintsUsed[key] || userProfile.hintsUsed[key] === 0);
                
                if (allCompleted && noHintsUsed) {
                    showAchievement('üåü', 'Daily Challenge Complete!', 'You completed all tasks without hints!', 200);
                }
                
                alert('Congratulations! You have completed all tasks in Section 1.');
            }
        }
        
        // Save/Load functions
function saveProgress(taskNumber) {
    if (!editors[taskNumber]) return;
    
    const code = editors[taskNumber].getValue();
    const progress = {
        code: code,
        timestamp: new Date().toISOString()
    };
    
    // Save to localStorage
    const allProgress = JSON.parse(localStorage.getItem('pythonWorksheetProgress') || '{}');
    allProgress[taskNumber] = progress;
    localStorage.setItem('pythonWorksheetProgress', JSON.stringify(allProgress));
}

function saveAllProgress() {
    localStorage.setItem('pythonWorksheetTaskProgress', JSON.stringify(taskProgress));
    localStorage.setItem('pythonWorksheetUserProfile', JSON.stringify(userProfile));
}

function saveSettings() {
    localStorage.setItem('pythonWorksheetSettings', JSON.stringify(settings));
}
        
function loadProgress(taskNumber) {
    const allProgress = JSON.parse(localStorage.getItem('pythonWorksheetProgress') || '{}');
    
    if (allProgress[taskNumber] && editors[taskNumber]) {
        editors[taskNumber].setValue(allProgress[taskNumber].code);
    }
}
        
        function saveAllProgress() {
            memoryStorage.pythonWorksheetTaskProgress = { ...taskProgress };
            memoryStorage.userProfile = { ...userProfile };
        }
        
        function saveSettings() {
            memoryStorage.settings = { ...settings };
        }
        
        // Update progress display
        function updateProgress() {
 const completedTasks = Object.values(taskProgress).filter(t => t.completed).length;
    const completedExtensions = Object.values(extensionProgress).filter(e => e.completed).length;
    const totalTasks = Object.keys(tasks).length;
    const totalExtensions = Object.keys(extensionProgress).length;
    
    document.getElementById('progressText').textContent = 
        `${completedTasks}/${totalTasks} lessons, ${completedExtensions}/${totalExtensions} extensions completed`;
    
    // Update progress bar to include extensions
    const totalItems = totalTasks + totalExtensions;
    const totalCompleted = completedTasks + completedExtensions;
    document.getElementById('progressBar').style.width = `${(totalCompleted / totalItems) * 100}%`;
            
            // Update status indicators
            for (let i = 1; i <= totalTasks; i++) {
                const statusElement = document.getElementById(`status${i}`);
                if (taskProgress[i] && taskProgress[i].completed) {
                    statusElement.classList.add('completed');
                    statusElement.textContent = '‚úì';
                    document.querySelectorAll('.task-item')[i - 1].classList.add('completed');
                }
            }
        }
        
        // Download progress
function downloadProgress() {
    let documentContent = `Python Programming - Section 1: Python Basics
Student: Level ${userProfile.level} (${userProfile.xp} XP)
Date: ${new Date().toLocaleDateString()}
=====================================\n\n`;
    
    // Add each task's code
    for (let i = 1; i <= Object.keys(tasks).length; i++) {
        const task = tasks[i];
        const completed = taskProgress[i] && taskProgress[i].completed;
        
        documentContent += `${task.title}${completed ? ' ‚úì' : ' (Not completed)'}\n`;
        documentContent += '-'.repeat(task.title.length + (completed ? 2 : 16)) + '\n\n';
        
        // Get the student's code
        let code = '';
        if (editors[i]) {
            code = editors[i].getValue();
        } else if (memoryStorage.pythonWorksheetProgress[i]) {
            code = memoryStorage.pythonWorksheetProgress[i].code;
        } else {
            code = task.starterCode;
        }
        
        documentContent += code + '\n\n';
        
        // Add completion info if available
        if (completed) {
            documentContent += `Completed on: ${new Date(taskProgress[i].timestamp).toLocaleDateString()}\n`;
            documentContent += `Attempts: ${taskProgress[i].attempts}\n`;
            documentContent += `Hints used: ${taskProgress[i].hintsUsed}\n`;
        }
        
        documentContent += '\n' + '='.repeat(50) + '\n\n';
    }
    
    // Add summary
    const completedCount = Object.values(taskProgress).filter(t => t.completed).length;
    documentContent += `\nSummary\n-------\n`;
    documentContent += `Tasks completed: ${completedCount}/${Object.keys(tasks).length}\n`;
    documentContent += `Total XP earned: ${userProfile.xp}\n`;
    documentContent += `Current level: ${userProfile.level}\n`;
    documentContent += `Badges earned: ${userProfile.badges.map(b => BADGES[b].name).join(', ') || 'None'}\n`;
    
    // Create and download as a text file
    const blob = new Blob([documentContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `python_section1_code_${new Date().toISOString().split('T')[0]}.txt`;
    a.click();
    URL.revokeObjectURL(url);
}
        
        // Reset section
function resetSection() {
    if (confirm('Reset all progress in this section? This cannot be undone!')) {
        // Clear localStorage
        localStorage.removeItem('pythonWorksheetProgress');
        localStorage.removeItem('pythonWorksheetTaskProgress');
        localStorage.removeItem('pythonWorksheetUserProfile');
        localStorage.removeItem('pythonWorksheetSettings');
        
        // Reset memory variables
        taskProgress = {};
        userProfile = {
            level: 1,
            xp: 0,
            xpToNextLevel: 500,
            streak: 0,
            badges: [],
            hintsUsed: {},
            attemptsBeforeSuccess: {},
            totalTime: 0,
            lastLogin: new Date().toDateString()
        };
        hintLevel = {};
        codeHistory = {};
        
        location.reload();
    }
}
        
        // Additional debug functions
        function debugRun(taskNumber) {
            debuggerState.active = false;
            document.getElementById(`debugLine${taskNumber}`).textContent = 'Debug complete';
        }
        
        function debugStop(taskNumber) {
            debuggerState.active = false;
            debuggerState.currentLine = 0;
            document.getElementById(`debugLine${taskNumber}`).textContent = 'Debugger stopped';
        }
        
        // Show notification function
        function showNotification(title, message, type = 'info') {
            // Remove any existing notifications
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-icon">
                    ${type === 'warning' ? '‚ö†Ô∏è' : type === 'success' ? '‚úÖ' : '‚ùå'}
                </div>
                <div class="notification-content">
                    <h4>${title}</h4>
                    <p>${message}</p>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Trigger animation
            setTimeout(() => notification.classList.add('show'), 10);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Disable copy/paste globally for the page
        document.addEventListener('DOMContentLoaded', function() {
            // Disable text selection on the page (except in editors where we handle it differently)
            document.addEventListener('selectstart', function(e) {
if (e.target && e.target.closest && e.target.closest('.CodeMirror')) {
                    e.preventDefault();
                }
            });
            
            // Disable copy keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Check for Ctrl+C, Ctrl+X, Ctrl+V (Windows/Linux) or Cmd+C, Cmd+X, Cmd+V (Mac)
    if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'x' || e.key === 'v')) {
        if (e.target.closest('.CodeMirror')) {
            // Handled by CodeMirror
            return;
        }
        e.preventDefault();
        return false;
    }
});
            
            // Disable right-click context menu
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
    return false;
});
        });
        
        // Initialize everything
        window.addEventListener('load', () => {
            // Load saved data
    const savedTaskProgress = localStorage.getItem('pythonWorksheetTaskProgress');
    if (savedTaskProgress) {
        taskProgress = JSON.parse(savedTaskProgress);
    }
    
    const savedUserProfile = localStorage.getItem('pythonWorksheetUserProfile');
    if (savedUserProfile) {
        userProfile = JSON.parse(savedUserProfile);
    }
    
    const savedSettings = localStorage.getItem('pythonWorksheetSettings');
    if (savedSettings) {
        settings = JSON.parse(savedSettings);
                
                // Apply settings
                if (settings.dyslexicFont) {
                    document.body.classList.add('dyslexic-font');
                    document.getElementById('dyslexicToggle').classList.add('active');
                }
                if (settings.audioEnabled) {
                    document.getElementById('audioToggle').classList.add('active');
                }
                if (!settings.syntaxCheckEnabled) {
                    document.getElementById('syntaxToggle').classList.remove('active');
                }
            }
            
            // Check daily streak
            const today = new Date().toDateString();
            if (userProfile.lastLogin !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (userProfile.lastLogin === yesterday.toDateString()) {
                    userProfile.streak++;
                    if (userProfile.streak === 5 && !userProfile.badges.includes('streak')) {
                        userProfile.badges.push('streak');
                        showAchievement('üî•', '5-Day Streak!', 'You\'ve been coding for 5 days straight!', 100);
                    }
                } else {
                    userProfile.streak = 1;
                }
                
                userProfile.lastLogin = today;
                saveAllProgress();
            }
            
            // Initialize displays
            updateProgress();
            updateUserStats();
            updateBadgeDisplay();
            
            // Initialize first task
            switchTask(1);
            
            // Initialize Pyodide
            initializePyodide();

            // Load extension progress
if (memoryStorage.extensionProgress) {
    extensionProgress = { ...memoryStorage.extensionProgress };
    // Update extension status indicators
    Object.keys(extensionProgress).forEach(topic => {
        if (extensionProgress[topic].completed) {
            updateExtensionStatus(topic);
        }
    });
}
        








        
        });
    </script>
</body>
</html>