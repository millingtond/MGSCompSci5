<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Year 9 Python Course - Section 8: IF Statements</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.min.css">

    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=OpenDyslexic:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS Variables for IF Statements Theme */
        :root {
            --primary-color: #3b82f6; /* Blue for logic/decisions */
            --primary-dark: #2563eb;
            --primary-light: #60a5fa;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --xp-color: #8b5cf6;
            --bg-primary: #eff6ff;
            --bg-secondary: white;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        body.dyslexic-font {
            font-family: 'OpenDyslexic', sans-serif;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem 0;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: 'if else elif';
            position: absolute;
            font-size: 150px;
            opacity: 0.1;
            right: -50px;
            top: -20px;
            transform: rotate(-15deg);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            font-size: 2rem;
            margin-bottom: 0.25rem;
            font-weight: 700;
        }

        .header-left p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        /* User Stats */
        .user-stats {
            display: flex;
            gap: 2rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem 1.5rem;
            border-radius: 12px;
        }

        .stat-item { text-align: center; min-width: 80px; }
        .stat-value { font-size: 1.75rem; font-weight: 700; margin-bottom: 0.25rem; }
        .stat-label { font-size: 0.875rem; opacity: 0.9; }
        .xp-bar { width: 100px; height: 6px; background: rgba(255, 255, 255, 0.3); border-radius: 3px; margin-top: 0.5rem; overflow: hidden; }
        .xp-fill { height: 100%; background: var(--xp-color); transition: width 0.5s ease; border-radius: 3px; }

        /* Progress Section */
        .progress-section { max-width: 1400px; margin: 0 auto; padding: 1.5rem 2rem 1rem 2rem; }
        .progress-bar { width: 100%; height: 10px; background: rgba(255, 255, 255, 0.2); border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; background: white; transition: width 0.5s ease; border-radius: 5px; }
        .badges-preview { display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap; }
        .badge { width: 40px; height: 40px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; transition: all 0.3s ease; filter: grayscale(100%); opacity: 0.5; }
        .badge.earned { filter: grayscale(0%); opacity: 1; background: rgba(255, 255, 255, 0.3); box-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
        .badge:hover { transform: scale(1.1); }
        
        /* Main Container */
        .main-container { max-width: 1400px; margin: 2rem auto; padding: 0 2rem; display: grid; grid-template-columns: 300px 1fr; gap: 2rem; min-height: calc(100vh - 300px); }

        /* Sidebar */
        .sidebar { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: var(--shadow-md); height: fit-content; position: sticky; top: 2rem; }
        .section-title { font-size: 1.1rem; font-weight: 600; color: var(--primary-color); margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 2px solid var(--primary-light); }
        .task-list { list-style: none; }
        .task-item { padding: 0.75rem 1rem; margin-bottom: 0.5rem; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; border: 2px solid transparent; display: flex; justify-content: space-between; align-items: center; }
        .task-item:hover { background: var(--bg-primary); border-color: var(--primary-light); }
        .task-item.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .task-item.completed { border-left: 4px solid var(--success-color); }
        .task-xp { font-size: 0.75rem; opacity: 0.7; font-weight: 500; }

        /* Content Area */
        .content { background: white; border-radius: 12px; padding: 2rem; box-shadow: var(--shadow-md); min-height: 600px; }
        .task-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid var(--border-color); }
        .task-title { font-size: 1.5rem; font-weight: 600; }
        .task-type { display: inline-block; padding: 0.25rem 1rem; border-radius: 20px; font-size: 0.875rem; font-weight: 500; text-transform: uppercase; }
        .task-type.example { background: #dbeafe; color: #1e40af; }
        .task-type.practice { background: #d1fae5; color: #065f46; }
        .task-type.challenge { background: #fef3c7; color: #92400e; }
        .task-type.assessment { background: #ede9fe; color: #5b21b6; }
        
        /* Instructions */
        .instructions { margin-bottom: 2rem; line-height: 1.8; }
        .instructions h3, .instructions h2, .instructions h4 { color: var(--primary-color); margin: 1.5rem 0 0.75rem 0; font-size: 1.2rem; }
        .instructions pre { background: #f3f4f6; padding: 1rem; border-radius: 8px; overflow-x: auto; margin: 1rem 0; border-left: 4px solid var(--primary-color); font-family: 'Courier New', monospace; }
        .instructions code { background: #f3f4f6; padding: 0.2em 0.4em; margin: 0; font-size: 85%; border-radius: 3px; font-family: 'Courier New', monospace;}
        .instructions ul, .instructions ol { margin: 0.5rem 0 0.5rem 2rem; }
        .instructions li { margin: 0.5rem 0; }
        .instructions .note { background-color: #fefce8; border-left: 4px solid #facc15; padding: 1rem; margin: 1rem 0; border-radius: 4px;}

        /* Code Editor */
        .editor-container { margin: 1.5rem 0; border-radius: 8px; overflow: hidden; box-shadow: var(--shadow-md); }
        .editor-header { background: var(--text-primary); color: white; padding: 0.75rem 1rem; display: flex; justify-content: space-between; align-items: center; }
        .editor-title { font-weight: 500; }
        .editor-actions { display: flex; gap: 0.5rem; }
        .editor-btn { background: transparent; border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 0.4rem 1rem; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; }
        .editor-btn:hover { background: rgba(255, 255, 255, 0.1); }
        .editor-btn.run { background: var(--success-color); border-color: var(--success-color); }
        .CodeMirror { height: 300px; font-size: 1rem; }

        /* Output Panel */
        .output-panel { margin-top: 1rem; border-radius: 8px; overflow: hidden; box-shadow: var(--shadow-sm); border: 1px solid var(--border-color); }
        .output-header { background: #f9fafb; padding: 0.75rem 1rem; font-weight: 500; border-bottom: 1px solid var(--border-color); }
        .output-content { padding: 1rem; font-family: 'Courier New', monospace; min-height: 100px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; }
        .output-content.error { color: var(--error-color); }

        /* Control Buttons */
        .controls { display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap; }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 0.5rem; }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-1px); box-shadow: var(--shadow-md); }
        .btn-secondary { background: #f3f4f6; color: var(--text-primary); }
        .btn-secondary:hover { background: #e5e7eb; }
        .btn-success { background: var(--success-color); color: white; }

        /* Hints */
        .hint-box { background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 1rem; margin: 1rem 0; display: none; }
        .hint-box.show { display: block; }
        .hint-header { font-weight: 600; color: #92400e; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }

        /* Checks */
        .checks-container { margin-top: 2rem; padding: 1.5rem; background: #f9fafb; border-radius: 8px; }
        .check-item { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; }
        .check-icon { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; font-weight: 600; }
        .check-icon.pending { background: #e5e7eb; color: #6b7280; }
        .check-icon.passed { background: var(--success-color); color: white; }
        .check-icon.failed { background: var(--error-color); color: white; }

        /* Achievement Notification */
        .achievement { position: fixed; top: 2rem; right: 2rem; background: white; padding: 1.5rem 2rem; border-radius: 12px; box-shadow: var(--shadow-lg); display: flex; align-items: center; gap: 1rem; opacity: 0; transform: translateX(400px); transition: all 0.5s ease; z-index: 1000; border-left: 4px solid var(--xp-color); }
        .achievement.show { opacity: 1; transform: translateX(0); }
        .achievement-icon { font-size: 2.5rem; }
        .achievement-content h3 { margin-bottom: 0.25rem; }
        .achievement-xp { color: var(--xp-color); font-weight: 600; }

        /* Worksheet Styles */
        .worksheet-section { margin-top: 2rem; }
        .worksheet-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid var(--border-color); }
        .worksheet-question { background-color: #f9fafb; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .worksheet-question h4 { margin: 0 0 1rem 0; font-weight: 600; }
        .worksheet-answer { width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; font-family: inherit; resize: vertical; }
        .worksheet-code { background: #f3f4f6; padding: 1rem; border-radius: 8px; overflow-x: auto; margin: 1rem 0; border-left: 4px solid var(--primary-light); font-family: 'Courier New', monospace; }
        
        /* Loading state */
        .loading { display: flex; align-items: center; justify-content: center; min-height: 200px; color: var(--text-secondary); }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-container { grid-template-columns: 1fr; }
            .sidebar { position: static; margin-bottom: 2rem; }
            .header-content { flex-direction: column; gap: 1.5rem; text-align: center; }
        }
    </style>
</head>
<body oncopy="return false" oncut="return false" onpaste="return false">
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <h1>Year 9 Python Programming</h1>
                <p>Section 8 - IF Statements</p>
            </div>
            <div class="user-stats">
                <div class="stat-item">
                    <div class="stat-value" id="userLevel">1</div>
                    <div class="stat-label">Level</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="userXP">0</div>
                    <div class="stat-label">XP</div>
                    <div class="xp-bar"><div class="xp-fill" id="xpFill" style="width: 0%"></div></div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="userStreak">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>
        </div>
        
        <div class="progress-section">
            <div class="progress-bar"><div class="progress-fill" id="progressBar"></div></div>
            <p style="margin: 5px 0 0 0; font-size: 14px; color: white;">
                Progress: <span id="progressText">0/17 tasks completed</span>
            </p>
            <div class="badges-preview">
                <div class="badge" id="badge-decision-maker" title="Decision Maker - Complete all basic if-else tasks">‚úîÔ∏è</div>
                <div class="badge" id="badge-logic-master" title="Logic Master - Correctly use elif statements">üîÄ</div>
                <div class="badge" id="badge-branching-expert" title="Branching Expert - Complete all nested if tasks">üå≥</div>
                <div class="badge" id="badge-code-cracker" title="Code Cracker - Complete the guessing game and final challenge without hints">üîì</div>
                <div class="badge" id="badge-flawless-victory" title="Flawless Victory - Complete 5 tasks without using hints">‚≠ê</div>
                <div class="badge" id="badge-first-try-ace" title="First-Try Ace - Complete 3 tasks on the first attempt">üéØ</div>
                <div class="badge" id="badge-section-scholar" title="Section Scholar - Complete the final assessment">üéì</div>
                <div class="badge" id="badge-section-champion" title="Section Champion - Complete all tasks">üèÜ</div>
            </div>
        </div>
    </div>

    <div class="main-container">
        <aside class="sidebar">
            <div class="section-title">Section 8 - IF Statements</div>
            <ul class="task-list" id="taskList"></ul>
        </aside>
        
        <main class="content">
            <div id="taskContent">
                <div class="loading">Loading Python environment...</div>
            </div>
        </main>
    </div>

    <div class="achievement" id="achievementPopup">
        <div class="achievement-icon" id="achievementIcon">üèÜ</div>
        <div class="achievement-content">
            <h3 id="achievementTitle">Achievement Unlocked!</h3>
            <p id="achievementMessage">You've completed a task!</p>
            <p class="achievement-xp">+<span id="achievementXP">50</span> XP</p>
        </div>
    </div>

    <script>
        // Global variables
        let pyodide = null;
        let editors = {};
        let currentTask = 1;
        let userProgress = {
            completedTasks: {},
            hintsUsed: {},
            xp: 0,
            level: 1,
            streak: 0,
            lastVisit: new Date().toDateString(),
            badges: {},
            perfectTasks: 0,
            firstTryTasks: 0,
            taskAttempts: {}
        };

        // Badge definitions
        const BADGES = {
            'decision-maker': { 
                icon: '‚úîÔ∏è', name: 'Decision Maker', desc: 'Complete all basic if-else tasks',
                check: () => [1, 2, 3, 4, 5].every(t => userProgress.completedTasks[t])
            },
            'logic-master': {
                icon: 'üîÄ', name: 'Logic Master', desc: 'Correctly use elif statements',
                check: () => [8, 9, 10, 11].every(t => userProgress.completedTasks[t])
            },
            'branching-expert': {
                icon: 'üå≥', name: 'Branching Expert', desc: 'Complete all nested if tasks',
                check: () => [13, 14, 15].every(t => userProgress.completedTasks[t])
            },
            'code-cracker': {
                icon: 'üîì', name: 'Code Cracker', desc: 'Complete the guessing game and final challenge without hints',
                check: () => (userProgress.completedTasks[15] && !userProgress.hintsUsed[15]) && (userProgress.completedTasks[16] && !userProgress.hintsUsed[16])
            },
            'flawless-victory': {
                icon: '‚≠ê', name: 'Flawless Victory', desc: 'Complete 5 tasks without using hints',
                check: () => userProgress.perfectTasks >= 5
            },
            'first-try-ace': {
                icon: 'üéØ', name: 'First-Try Ace', desc: 'Complete 3 tasks on the first attempt',
                check: () => userProgress.firstTryTasks >= 3
            },
            'section-scholar': {
                icon: 'üéì', name: 'Section Scholar', desc: 'Complete the final assessment',
                check: () => userProgress.completedTasks[17]
            },
            'section-champion': {
                icon: 'üèÜ', name: 'Section Champion', desc: 'Complete all tasks',
                check: () => Object.keys(tasks).every(t => userProgress.completedTasks[t])
            }
        };

        // Task definitions from provided files
        const tasks = {
            1: {
                id: "3c31586c-88c1-424b-bab3-c93736f28204",
                title: "8.1 if statements",
                type: "example",
                xp: 50,
                instructions: `
                    <h2><strong>if</strong> statements</h2>
                    <p>An <code>if</code> statement runs specific instructions if a certain condition is <code>True</code>.</p>
                    <h3>Task</h3>
                    <p>Change the value of <code>x</code> to something other than 1 and run the code again to see what happens.</p>
                    <div class="note">
                      <p><strong>NOTE:</strong> After the condition, there is a colon (<code>:</code>), and the instructions controlled by the <code>if</code> statement are indented.</p>
                      <p>The code <code>print("x is a variable")</code> runs regardless of what is stored in <code>x</code> because it is not inside the <code>if</code> statement's block of code (i.e., it is not indented).</p>
                    </div>`,
                starterCode: `x = 1\n\nif x == 1:\n\tprint("x is one.")\n\nprint("x is a variable")`,
                hints: [
                    "To make the condition false, change the first line.",
                    "Try setting `x` to any number other than 1, for example: `x = 5`.",
                    "When `x` is not 1, the indented line `print(\"x is one.\")` will not execute."
                ],
                checks: [
                    { name: "Code runs without errors", test: (code, output) => !output.toLowerCase().includes('error')},
                    { name: "The variable `x` is changed", test: (code, output) => !code.includes('x = 1')},
                    { name: "The final print statement always runs", test: (code, output) => output.includes('x is a variable')}
                ]
            },
            2: {
                id: "57f1137d-75a5-4331-9ed3-627a3546ffe8",
                title: "8.2 Conditions",
                type: "practice",
                xp: 75,
                instructions: `
                    <h2>Conditions</h2>
                    <p>The condition of an <code>if</code> statement can be any expression that results in <code>True</code> or <code>False</code> (a boolean value).</p>
                    <p>For example, you are on a search for buried treasure. Your map shows two paths: one by land and one by sea. We can model this scenario using <code>if</code> statements.</p>
                    <h3>Task</h3>
                    <ol>
                      <li>Change the value of <code>x</code> to 11 and run the code again. What do you notice?</li>
                      <li>Add another <code>if</code> statement that checks if the user's choice is "tree". If it is, the program should print "You climb to the treasure".</li>
                      <li>Don't forget to change the input line to ask the user to choose "land", "sea", or "tree".</li>
                    </ol>`,
                starterCode: `x = 3\n\n# if x is greater than or equal to zero and less than 10\nif x >= 0 and x < 10:\n\tprint("x has one digit")\n\t\n#Treasure\nchoice = input("land or sea?")\n\nif choice == "land":\n\tprint("You get lost.")\n\tif choice == "sea":\n\tprint("You sail to the treasure.")`,
                hints: [
                    "For the second task, you'll need a new `if` block.",
                    "The new condition should be `choice == \"tree\"`.",
                    "The final code might look like this: `choice = input(\"land, sea, or tree?\") ... if choice == \"tree\": print(\"You climb to the treasure\")`"
                ],
                checks: [
                    { name: "Asks user for 'land', 'sea', or 'tree'", test: (code, output) => code.toLowerCase().includes('tree?')} ,
                    { name: "Handles the 'land' choice", test: (code, output) => code.includes('if choice == "land":') },
                    { name: "Handles the 'sea' choice", test: (code, output) => code.includes('if choice == "sea":') },
                    { name: "Handles the 'tree' choice", test: (code, output) => code.includes('if choice == "tree":') }
                ]
            },
            3: {
                id: "6aad016a-3f90-4ae5-a68b-dfa1c5c39ba2",
                title: "8.3 Even or Odd",
                type: "practice",
                xp: 75,
                instructions: `
                    <h2>Task</h2>
                    <p>Given a number <code>x</code>, write a program that uses two <code>if</code> statements to check if <code>x</code> is even or odd.</p>
                    <ul>
                      <li>If <code>x</code> is even, it should print "even".</li>
                      <li>If <code>x</code> is odd, it should print "odd".</li>
                    </ul>
                    <h3>Hint</h3>
                    <p>Remember that the modulus operator <code>%</code> gives you the remainder of a division. An even number has a remainder of 0 when divided by 2. For example, <code>8 % 2 == 0</code> is <code>True</code>.</p>`,
                starterCode: `x = 6`,
                hints: [
                    "You will need two separate `if` statements.",
                    "To check for an even number, the condition is `x % 2 == 0`.",
                    "To check for an odd number, the condition is `x % 2 != 0` (or `x % 2 == 1`)."
                ],
                checks: [
                    { name: "Checks if the number is even", test: (code, output) => code.includes('x % 2 == 0')},
                    { name: "Checks if the number is odd", test: (code, output) => code.includes('x % 2 != 0') || code.includes('x % 2 == 1')},
                    { name: "Prints 'even' for even numbers", test: (code, output) => { if (!code.includes('input')) return output.includes('even'); return true;} },
                ]
            },
            4: {
                id: "20838183-bac9-4ea3-a748-85e271473f2c",
                title: "8.4 else statements",
                type: "example",
                xp: 50,
                instructions: `
                    <h2><strong>`+"`else`"+`</strong> statements</h2>
                    <p>An <code>else</code> statement runs a block of code if the condition of the <code>if</code> statement directly above it is <code>False</code>.</p>
                    <div class="note">
                        <p>The <code>else</code> statement represents the "otherwise" case, so it doesn't need its own condition.</p>
                    </div>
                    <h3>Password Example</h3>
                    <p>You want to password-protect your program. If the user enters the correct password, they can proceed. Otherwise, they are denied access.</p>
                    <h3>Task</h3>
                    <p>Change the password on line 5 to something different and test the code again.</p>`,
                starterCode: `#Password program\npassword = input("What is the password?")\n\nif password == "python": \n\tprint("Correct, you may proceed.")\nelse:\n\tprint("Incorrect, you may not proceed.")`,
                hints: [
                    "The string inside the quotation marks on line 4 is the password.",
                    "Change `\"python\"` to something else, like `\"secret\"`.",
                    "When you run the code, entering your new password should grant access, while entering \"python\" should deny it."
                ],
                checks: [
                    { name: "The password has been changed", test: (code, output) => !code.includes('"python"')},
                    { name: "Contains an if-else structure", test: (code, output) => code.includes('if') && code.includes('else:')}
                ]
            },
            5: {
                id: "f46d4276-4521-4a92-9d6c-92930ce08405",
                title: "8.5 Even or odd sum",
                type: "practice",
                xp: 100,
                instructions: `
                    <h2>Task</h2>
                    <p>Given two numbers, <code>a</code> and <code>b</code>, print "even" if their sum is even, otherwise print "odd".</p>
                    <p>Use a single <code>if-else</code> statement to solve this.</p>
                    <h3>Hint</h3>
                    <p>First, calculate the sum. Then, use the modulus operator <code>%</code> in your <code>if</code> condition to check if the sum is even.</p>`,
                starterCode: `a = 13\nb = 0`,
                hints: [
                    "Create a new variable for the sum, like `total = a + b`.",
                    "The condition to check if `total` is even is `total % 2 == 0`.",
                    "Your `if` block should print \"even\", and your `else` block should print \"odd\"."
                ],
                checks: [
                    { name: "Calculates the sum of a and b", test: (code, output) => code.includes('a + b') },
                    { name: "Uses a single if-else statement", test: (code, output) => (code.match(/if/g) || []).length === 1 && code.includes('else:') },
                    { name: "Uses modulus to check for evenness", test: (code, output) => code.includes('% 2 == 0') },
                    { name: "Prints 'odd' for the default values", test: (code, output) => { if (!code.includes('input')) return output.includes('odd'); return true;} }
                ]
            },
            6: {
                id: "e50e04ad-82fc-4d9c-8621-17e9c017609a",
                title: "8.6 Multiple if statements",
                type: "example",
                xp: 50,
                instructions: `
                    <h2>Multiple <strong>if</strong> statements</h2>
                    <p>When you have multiple, separate <code>if</code> statements, Python checks each condition one by one, regardless of the results of the previous ones.</p>
                    <p>The program below checks if the number 15 is divisible by 3, then it checks if it's divisible by 5, and then it checks if it's divisible by 15. Since all are true, it prints all three messages.</p>
                    <h3>Task</h3>
                    <p>Add another <code>if</code> statement to the end of the program to check if <code>x</code> is divisible by 18.</p>`,
                starterCode: `x = 15\n\nif x % 3 == 0:\n\tprint("x is divisible by 3.")\n\tif x % 5 == 0:\n\tprint("x is divisible by 5.")\n\nif x % 15 == 0:\n\tprint("x is divisible by 15.")`,
                hints: [
                    "You need to add a new `if` block at the end.",
                    "The condition for being divisible by 18 is `x % 18 == 0`.",
                    "Your new code block will look like this: `if x % 18 == 0: print(\"x is divisible by 18.\")`"
                ],
                checks: [
                    { name: "A new if statement was added", test: (code, output) => (code.match(/if/g) || []).length >= 4 },
                    { name: "Checks for divisibility by 18", test: (code, output) => code.includes('x % 18 == 0') }
                ]
            },
            7: {
                id: "914fe938-6588-46d6-adc1-ced76ca2525d",
                title: "8.7 What can't they do?",
                type: "challenge",
                xp: 125,
                instructions: `
                    <h2>Task</h2>
                    <p>Given a person's <code>age</code>, use multiple <code>if</code> statements to print out the things that person cannot do based on these rules:</p>
                    <ul>
                        <li>They have to be at least 16 years old to drive. If they can't, print <code>"cannot drive"</code>.</li>
                        <li>They have to be at least 18 years old to vote. If they can't, print <code>"cannot vote"</code>.</li>
                        <li>They have to be at least 25 years old to rent a car. If they can't, print <code>"cannot rent a car"</code>.</li>
                    </ul>
                    <p>If they are old enough to do all three things (i.e., at least 25), the program should instead print a single message: <code>"can do everything"</code>.</p>`,
                starterCode: `age = 30`,
                hints: [
                    "You'll need `if` statements with conditions like `age < 16`, `age < 18`, and `age < 25` for the restrictions.",
                    "For the 'can do everything' case, the condition should be `age >= 25`.",
                    "Make sure the 'can do everything' check comes first. If it's true, you don't want to print the other messages. An `if-else` structure might be useful here."
                ],
                checks: [
                    { name: "Checks if age is less than 16", test: (code, output) => code.includes('age < 16') },
                    { name: "Checks if age is less than 18", test: (code, output) => code.includes('age < 18') },
                    { name: "Checks if age is less than 25", test: (code, output) => code.includes('age < 25') },
                    { name: "Handles the 'can do everything' case", test: (code, output) => code.includes('age >= 25') },
                    { name: "Prints 'can do everything' for age 30", test: (code, output) => { if (!code.includes('input')) return output.includes('can do everything'); return true;} }
                ]
            },
            8: {
                id: "6280877a-6661-41ae-b4e6-aca84ed961ba",
                title: "8.8 elif statements",
                type: "example",
                xp: 75,
                instructions: `
                    <h2>The Problem with Multiple <code>if</code>s</h2>
                    <p>The first program converts your grade to a letter. Type in <code>96</code> and press enter. Why does it print out all the letters?</p>
                    <p>It's because each <code>if</code> statement is checked independently. Since 96 is greater than 90, 80, 70, and 60, all of those conditions are true!</p>
                    <h3>The Solution: <code>elif</code> statements</h3>
                    <p>An <code>elif</code> (short for "else if") statement only checks its condition if no previous <code>if</code> or <code>elif</code> condition in the chain was <code>True</code>. This allows you to check for multiple exclusive conditions.</p>
                    <h3>Task</h3>
                    <p>Run the program and type in <code>96</code> for both prompts to see the difference.</p>`,
                starterCode: `#Just ifs\ngrade = int(input("What grade did you get?"))\n\nif grade >= 90:\n\tprint("You got an A.")\n\tif grade >= 80:\n\tprint("You got a B.")\n\tif grade >= 70:\n\tprint("You got a C.")\n\tif grade >= 60:\n\tprint("You got a D.")\n\nif grade < 60:\n\tprint("You got an F.")\n\n\nprint("\\nUsing elifs below...\\n")\n#ELIFs\ngrade = int(input("What grade did you get?"))\n\nif grade >= 90:\n\tprint("You got an A.")\n\nelif grade >= 80:\n\tprint("You got a B.")\n\nelif grade >= 70:\n\tprint("You got a C.")\n\nelif grade >= 60:\n\tprint("You got a D.")\n\nelse:\n\tprint("You got an F.")`,
                hints: [
                    "This is an example to observe. No code changes are needed.",
                    "Notice how the `if-elif-else` structure only ever executes one of the `print` statements.",
                    "The `else` at the end catches any case where the grade is not 60 or greater."
                ],
                checks: [
                    { name: "Code runs without errors", test: (code, output) => !output.toLowerCase().includes('error')}
                ]
            },
            9: {
                id: "687b896c-eeec-4dfb-8433-d2b587f6748e",
                title: "8.9 if-elif-else statement",
                type: "practice",
                xp: 100,
                instructions: `
                    <h2>Task</h2>
                    <p>Modify the grading program to add a new top grade.</p>
                    <p>If a student's grade is 95 or more, they should get an "A*". Otherwise, the grading should work as before.</p>`,
                starterCode: `grade = int(input("What grade did you get?"))\n\nif grade >= 90:\n\tprint("You got an A.")\n\nelif grade >= 80:\n\tprint("You got a B.")\n\nelif grade >= 70:\n\tprint("You got a C.")\n\nelif grade >= 60:\n\tprint("You got a D.")\n\nelse:\n\tprint("You got an F.")`,
                hints: [
                    "You need to add a new condition at the very beginning of the chain.",
                    "The first line should be `if grade >= 95:`.",
                    "The original `if grade >= 90:` will need to be changed to an `elif`."
                ],
                checks: [
                    { name: "Checks for grade >= 95 first", test: (code, output) => (code.indexOf('>= 95') < code.indexOf('>= 90')) && code.indexOf('>= 95') > -1},
                    { name: "Prints 'A*' for grades >= 95", test: (code, output) => code.includes('"A*"')},
                    { name: "The check for grade >= 90 is now an elif", test: (code, output) => code.includes('elif grade >= 90') },
                ]
            },
            10: {
                id: "adbd9a22-09f7-41aa-8610-91e681e9ab43",
                title: "8.10 Is it a leap year?",
                type: "challenge",
                xp: 150,
                instructions: `
                    <h2>Leap Year Calculator</h2>
                    <p>A leap year normally occurs every 4 years, but there are exceptions.</p>
                    <h4>Rules for a leap year:</h4>
                    <ul>
                      <li>A year is a leap year if it is divisible by 4, <strong>unless...</strong></li>
                      <li>...it is also divisible by 100. In that case, it is <strong>not</strong> a leap year, <strong>unless...</strong></li>
                      <li>...it is also divisible by 400. In that case, it <strong>is</strong> a leap year.</li>
                    </ul>
                    <p>This can be simplified:</p>
                    <ol>
                        <li>If the year is divisible by 400, it is a leap year.</li>
                        <li>Else if the year is divisible by 100, it is not a leap year.</li>
                        <li>Else if the year is divisible by 4, it is a leap year.</li>
                        <li>Otherwise, it is not a leap year.</li>
                    </ol>
                    <h3>Task</h3>
                    <p>Given a <code>year</code>, print <code>"leap year"</code> if it is a leap year, and <code>"not leap year"</code> otherwise. Use an <code>if-elif-else</code> structure.</p>`,
                starterCode: `year = 2012`,
                hints: [
                    "The order of checks is very important. Start with the most specific rule: divisibility by 400.",
                    "Your first condition should be `if year % 400 == 0:`.",
                    "Next, `elif year % 100 == 0:`. This will only be checked if the year is NOT divisible by 400.",
                    "Then, `elif year % 4 == 0:`. This is the general rule for all other years.",
                    "Finally, an `else:` will handle all remaining cases (years not divisible by 4)."
                ],
                checks: [
                    { name: "Checks for divisibility by 400 first", test: (code, output) => code.indexOf('% 400') < code.indexOf('% 100') },
                    { name: "Checks for divisibility by 100 second", test: (code, output) => code.indexOf('% 100') < code.indexOf('% 4') },
                    { name: "Checks for divisibility by 4 third", test: (code, output) => code.includes('% 4') },
                    { name: "Uses an if-elif-else structure", test: (code, output) => code.includes('if') && code.includes('elif') && code.includes('else') },
                    { name: "Prints 'leap year' for 2012", test: (code, output) => { if (!code.includes('input')) return output.includes('leap year'); return true;} }
                ]
            },
            11: {
                id: "594037a7-15db-4c5e-a7a4-00270c690256",
                title: "8.11 Siblings",
                type: "challenge",
                xp: 150,
                instructions: `
                    <h2>Task</h2>
                    <p>Given the number of <code>older</code> and <code>younger</code> siblings a person has, determine their birth order. Print one of the following:</p>
                    <ul>
                        <li><code>"only child"</code> - if the person has no siblings.</li>
                        <li><code>"oldest child"</code> - if the person only has younger siblings (and no older ones).</li>
                        <li><code>"youngest child"</code> - if the person only has older siblings (and no younger ones).</li>
                        <li><code>"middle child"</code> - if the person has both younger and older siblings.</li>
                    </ul>
                    <h3>Hint</h3>
                    <p>You'll need to use the <code>and</code> operator to combine checks in your conditions.</p>`,
                starterCode: `older = 1\nyounger = 1`,
                hints: [
                    "Start with the most specific cases. What are the conditions for being a middle child or an only child?",
                    "For 'only child', the condition is `older == 0 and younger == 0`.",
                    "For 'oldest child', the condition is `older == 0 and younger > 0`.",
                    "For 'youngest child', the condition is `older > 0 and younger == 0`.",
                    "Use an `if-elif-else` structure to make sure only one message is printed."
                ],
                checks: [
                    { name: "Handles 'only child' case", test: (code, output) => code.includes('older == 0 and younger == 0')},
                    { name: "Handles 'oldest child' case", test: (code, output) => code.includes('older == 0') && code.includes('younger > 0')},
                    { name: "Handles 'youngest child' case", test: (code, output) => code.includes('older > 0') && code.includes('younger == 0')},
                    { name: "Handles 'middle child' case", test: (code, output) => code.includes('older > 0 and younger > 0') || code.includes('else:')},
                    { name: "Prints 'middle child' for the default values", test: (code, output) => { if (!code.includes('input')) return output.includes('middle child'); return true;} }
                ]
            },
            12: {
                id: "ea9ae35e-ffae-4c60-abf4-f9cd3e7dfe61",
                title: "8.12 Weekday or Weekend?",
                type: "practice",
                xp: 100,
                instructions: `
                    <h2>Task</h2>
                    <p>Given a <code>day</code> of the week, print <code>"weekday"</code> if it is a weekday, or print <code>"weekend"</code> otherwise.</p>
                    <p>Solve this problem using only a single <code>if-else</code> statement. You will need to use the <code>or</code> operator in your condition.</p>`,
                starterCode: `day = "Saturday"`,
                hints: [
                    "The condition for the `if` statement needs to check if the day is one of the two weekend days.",
                    "The condition should look like this: `day == \"Saturday\" or day == \"Sunday\"`.",
                    "The `if` block should print \"weekend\", and the `else` block will handle all other days, printing \"weekday\"."
                ],
                checks: [
                    { name: "Uses a single if-else statement", test: (code, output) => (code.match(/if/g) || []).length === 1 && code.includes('else:')},
                    { name: "Uses the 'or' operator in the condition", test: (code, output) => code.includes('or')},
                    { name: "Checks for 'Saturday' and 'Sunday'", test: (code, output) => code.includes('"Saturday"') && code.includes('"Sunday"')},
                    { name: "Prints 'weekend' for the default value", test: (code, output) => { if (!code.includes('input')) return output.includes('weekend'); return true;} }
                ]
            },
            13: {
                id: "5401bd17-a6ba-4141-a2ea-1df957625b12",
                title: "8.13 Nested if statements",
                type: "example",
                xp: 75,
                instructions: `
                    <h2>Nested <code>if</code> statements</h2>
                    <p>In Python, indentation is used to group instructions together. You can place <code>if</code> statements inside other <code>if</code> statements. This is called nesting.</p>
                    <p>A nested <code>if</code> will only be checked if the outer <code>if</code> statement's condition is true.</p>
                    <h3>Age Example</h3>
                    <p>The program below first checks if you are a teenager. Then, <em>inside</em> that check, it might perform other checks, like whether you are old enough to vote.</p>
                    <h3>Task</h3>
                    <p>Run the code and use different ages (like 10, 16, 19, 25) to trace the execution through the different parts of the code before moving on.</p>`,
                starterCode: `age = int( input("What is your age?") )\n\n# If you are a teenager\nif age > 12 and age < 20:\n\tprint("You are a teenager")\n\t\n\t# If you are old enough to vote\n\tif age >= 18:\n\t\tprint("You are a teenager that can vote.")\n\t\n# Otherwise, you are not a teenager\nelse:\n\tprint("You are not a teenager.")\n\t\n\t# If you are old enough to vote\n\tif age >= 18:\n\t\tprint("You can vote.")\n\t# Otherwise, you cannot vote\n\telse:\n\t\tprint("You cannot vote")`,
                hints: [
                    "This is an observation task. Try entering different numbers to see which `print` statements are executed.",
                    "If you enter `16`, the outer `if` is true, but the first inner `if` is false.",
                    "If you enter `25`, the outer `if` is false, so the code jumps to the `else` block. Then the inner `if` (`age >= 18`) is true."
                ],
                checks: [
                    { name: "Code runs without errors", test: (code, output) => !output.toLowerCase().includes('error') }
                ]
            },
            14: {
                id: "a913941c-955e-4c7e-85d3-5363428f3d61",
                title: "8.14 Rock Paper Scissors",
                type: "challenge",
                xp: 175,
                instructions: `
                    <h2>Task 1: Determine the Winner</h2>
                    <p>Suppose Jack and Jill are playing rock-paper-scissors. The <code>jack</code> variable has Jack's choice and the <code>jill</code> variable has Jill's choice.</p>
                    <p>Write a program that determines the winner. Print "Jack wins", "Jill wins", or "tie".</p>
                    <p><em>Example: If Jack chose "rock" and Jill chose "scissors", print "Jack wins".</em></p>
                    <hr>
                    <h2>Task 2: Play Against a Computer</h2>
                    <p>Now, let's make it interactive. Write a program that lets a user play rock-paper-scissors against the computer.</p>
                    <ol>
                        <li>First, import the <code>random</code> library.</li>
                        <li>Use <code>random.randint(1, 3)</code> to get a random number for the computer's choice.</li>
                        <li>Use an <code>if-elif-else</code> chain to assign "rock", "paper", or "scissors" to a variable based on the random number (e.g., 1=rock, 2=paper, 3=scissors).</li>
                        <li>Ask the user for their choice.</li>
                        <li>Use nested <code>if</code> statements to compare the user's choice to the computer's choice and declare a winner or a tie.</li>
                    </ol>`,
                starterCode: `jack = "scissors"\njill = "rock"`,
                hints: [
                    "For Task 1, start by checking for a tie: `if jack == jill:`.",
                    "For Jack's winning conditions, you can use `elif (jack == 'rock' and jill == 'scissors') or ...`",
                    "For Task 2, remember to get the user's input. The main logic will be a large `if-elif-else` structure based on the user's choice.",
                    "Example for Task 2: `if user_choice == 'rock':` then inside that, you need a nested if-elif-else to check the computer's choice."
                ],
                checks: [
                    { name: "Task 1: Handles a tie", test: (code, output) => code.includes('jack == jill') },
                    { name: "Task 1: Handles Jack winning", test: (code, output) => code.includes('rock') && code.includes('scissors') && code.includes('Jack wins') },
                    { name: "Task 1: Prints 'Jill wins' for the default", test: (code, output) => { if (!code.includes('input')) return output.includes('Jill wins'); return true;} },
                    { name: "Task 2 (Optional): Imports random", test: (code, output) => code.includes('import random')},
                    { name: "Task 2 (Optional): Gets user input", test: (code, output) => code.includes('input(')}
                ]
            },
            15: {
                id: "623c1c43-00db-41c5-b940-445b23d04295",
                title: "8.15 Guessing game",
                type: "challenge",
                xp: 200,
                instructions: `
                    <h2>Task 1: Simple Guess</h2>
                    <p>There is a <code>secret</code> number and a user's <code>guess</code>. Print <code>"correct"</code> if they are the same. Otherwise, print <code>"too big"</code> or <code>"too small"</code> by comparing the guess to the secret number.</p>
                    <hr>
                    <h2>Task 2: Multiple Guesses</h2>
                    <p>Now, allow the user to make three guesses. The secret number should be set by you in the code.</p>
                    <p>Use nested <code>if-else</code> statements. If they guess correctly on any try, the program should print "correct" and stop. If they use all three guesses incorrectly, it should print "game over".</p>
                    <hr>
                    <h2>Task 3: Random Secret</h2>
                    <p>For the final version, use the <code>random</code> library's <code>randint</code> function to pick a random secret number between 1 and 50 at the start of the program.</p>`,
                starterCode: `secret = 15\nguess = 14`,
                hints: [
                    "Task 1 requires a simple `if-elif-else` structure to compare `guess` with `secret`.",
                    "For Task 2, you'll need to ask for input three times. The structure will be `if guess1 == secret: ... else: (ask for guess2) if guess2 == secret: ...`",
                    "A good way to structure Task 2 is with three separate `input()` calls, each wrapped in a check.",
                    "For Task 3, start your code with `import random` and `secret = random.randint(1, 50)`."
                ],
                checks: [
                    { name: "Task 1: Compares guess to secret", test: (code, output) => code.includes('guess < secret') && code.includes('guess > secret')},
                    { name: "Task 1: Prints 'too small' for the default", test: (code, output) => { if (code.split('input').length - 1 < 2) return output.includes('too small'); return true;} },
                    { name: "Task 2 (Optional): Asks for input multiple times", test: (code, output) => code.split('input(').length - 1 > 1 },
                    { name: "Task 3 (Optional): Imports random library", test: (code, output) => code.includes('import random')}
                ]
            },
            16: {
                id: "dbb3995d-8d5e-46e1-aa62-299e26046d4d",
                title: "8.16 Challenge - Branching",
                type: "challenge",
                xp: 150,
                instructions: `
                    <h2>Task</h2>
                    <p>Write a program that acts as a simple login system.</p>
                    <ol>
                      <li>Ask the user for their username.</li>
                      <li>Ask the user for their password.</li>
                      <li>If the username is <code>'steve123'</code> AND the password is <code>'fifa321'</code>, it should print "Access granted".</li>
                      <li>Otherwise, it should print "Access denied".</li>
                    </ol>
                    <h3>Hint</h3>
                    <p>You will need to use the <code>and</code> operator in your <code>if</code> statement's condition to check both variables at the same time.</p>`,
                starterCode: ``,
                hints: [
                    "You'll need two `input()` calls to get the username and password, storing them in variables.",
                    "The `if` condition needs to check two things at once.",
                    "Your condition will look like: `if username == 'steve123' and password == 'fifa321':`"
                ],
                checks: [
                    { name: "Asks for a username", test: (code, output) => code.toLowerCase().includes('username') && code.includes('input(')},
                    { name: "Asks for a password", test: (code, output) => code.toLowerCase().includes('password') && code.includes('input(')},
                    { name: "Uses 'and' to check both conditions", test: (code, output) => code.includes('and')},
                    { name: "Checks for the correct username and password strings", test: (code, output) => code.includes("'steve123'") && code.includes("'fifa321'")},
                    { name: "Contains an else statement for denial", test: (code, output) => code.includes('else:')}
                ]
            },
            17: {
                id: "assessment-08",
                title: "Section 8 Assessment",
                type: "assessment",
                xp: 250,
                instructions: `
                    <div class="worksheet-section">
                        <h3 class="worksheet-title">üìù End of Section 8: Worksheet</h3>
                        
                        <div class="worksheet-question">
                            <h4>1. Describe the purpose of an IF statement in Python.</h4>
                            <textarea class="worksheet-answer" rows="3" placeholder="Write your answer here..."></textarea>
                        </div>
                        
                        <div class="worksheet-question">
                            <h4>2. Explain when an ‚Äòelse‚Äô statement will run.</h4>
                            <textarea class="worksheet-answer" rows="3" placeholder="Write your answer here..."></textarea>
                        </div>
                        
                        <div class="worksheet-question">
                            <h4>3. What is the key difference between using a series of separate <code>if</code> statements versus using an <code>if-elif-else</code> chain?</h4>
                            <textarea class="worksheet-answer" rows="4" placeholder="Write your answer here..."></textarea>
                        </div>

                        <div class="worksheet-question">
                            <h4>4. Explain what the following code is doing, line by line. What will it print if <code>temp</code> is 15?</h4>
                            <div class="worksheet-code">temp = 15
if temp > 25:
    print("It's hot.")
elif temp > 10:
    print("It's pleasant.")
else:
    print("It's cold.")</div>
                            <textarea class="worksheet-answer" rows="5" placeholder="Explain the code and its output here..."></textarea>
                        </div>

                        <div class="worksheet-question">
                            <h4>5. What is a nested <code>if</code> statement, and when might you use one?</h4>
                            <textarea class="worksheet-answer" rows="3" placeholder="Write your answer here..."></textarea>
                        </div>
                    </div>
                `,
                starterCode: ``,
                checks: [] 
            }
        };

        // Initialize Pyodide
        async function initializePyodide() {
            try {
                pyodide = await loadPyodide({ indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/" });
                pyodide.runPython(`
                    import sys
                    from js import prompt
                    def custom_input(prompt_text=""):
                        return prompt(prompt_text)
                    __builtins__.input = custom_input
                `);
                console.log("Pyodide loaded successfully");
                loadAllProgress();
                generateTaskList();
                switchTask(1);
            } catch (error) {
                console.error("Failed to load Pyodide:", error);
                document.getElementById('taskContent').innerHTML = `<div class="error-message"><h3>Failed to load Python environment</h3><p>Please refresh the page to try again.</p></div>`;
            }
        }

        // Initialize CodeMirror editor
        function initializeEditor(taskNumber) {
            const editorElement = document.getElementById(`editor-${taskNumber}`);
            if (!editorElement) return;
            if (editors[taskNumber]) { editors[taskNumber].toTextArea(); }
            editors[taskNumber] = CodeMirror.fromTextArea(editorElement, {
                mode: 'python', theme: 'monokai', lineNumbers: true, autoCloseBrackets: true,
                matchBrackets: true, indentUnit: 4, tabSize: 4, indentWithTabs: true,
                extraKeys: { "Ctrl-Enter": () => runCode(taskNumber), "Cmd-Enter": () => runCode(taskNumber) }
            });
            const task = tasks[taskNumber];
            const savedCode = localStorage.getItem(`if-code-${task.id}`);
            editors[taskNumber].setValue(savedCode || task.starterCode);
            editors[taskNumber].on('change', () => {
                localStorage.setItem(`if-code-${task.id}`, editors[taskNumber].getValue());
            });
        }

        // Generate task list in sidebar
        function generateTaskList() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            Object.values(tasks).forEach((task, index) => {
                const taskNum = index + 1;
                const li = document.createElement('li');
                li.className = 'task-item';
                if (userProgress.completedTasks[taskNum]) li.classList.add('completed');
                if (taskNum === currentTask) li.classList.add('active');
                li.innerHTML = `<span>${task.title}</span><span class="task-xp">${task.xp} XP</span>`;
                li.onclick = () => switchTask(taskNum);
                taskList.appendChild(li);
            });
        }

        // Switch between tasks
        function switchTask(taskNum) {
            currentTask = taskNum;
            const task = tasks[taskNum];
            document.querySelectorAll('.task-item').forEach((item, index) => {
                item.classList.toggle('active', index === taskNum - 1);
            });
            if (task.type === 'assessment') {
                renderAssessmentTask(taskNum);
            } else {
                renderRegularTask(taskNum);
            }
        }

        // Render assessment task
        function renderAssessmentTask(taskNum) {
            const task = tasks[taskNum];
            const contentDiv = document.getElementById('taskContent');
            contentDiv.innerHTML = `
                <div class="task-header">
                    <h2 class="task-title">${task.title}</h2>
                    <span class="task-type ${task.type}">${task.type}</span>
                </div>
                ${task.instructions}
                <div class="controls">
                     <button class="btn btn-success" onclick="markAssessmentComplete(${taskNum})">‚úì Mark as Complete</button>
                </div>
            `;
        }
        
        // Simple completion for assessment
        function markAssessmentComplete(taskNum) {
            if (!userProgress.completedTasks[taskNum]) {
                const task = tasks[taskNum];
                userProgress.completedTasks[taskNum] = true;
                awardXP(task.xp);
                updateProgress();
                generateTaskList();
                showAchievement('üéì', 'Assessment Complete!', `You've finished the section!`, task.xp);
                checkBadges();
            } else {
                alert("You have already completed this assessment.");
            }
        }

        // Render regular task
        function renderRegularTask(taskNum) {
            const task = tasks[taskNum];
            document.getElementById('taskContent').innerHTML = `
                <div class="task-header">
                    <h2 class="task-title">${task.title}</h2>
                    <span class="task-type ${task.type}">${task.type}</span>
                </div>
                <div class="instructions">${task.instructions}</div>
                <div class="editor-container">
                    <div class="editor-header">
                        <div class="editor-title">Python Code Editor</div>
                        <div class="editor-actions">
                            <button class="editor-btn" onclick="resetCode(${taskNum})">‚Ü∫ Reset</button>
                            <button class="editor-btn run" onclick="runCode(${taskNum})">‚ñ∂ Run Code</button>
                        </div>
                    </div>
                    <textarea id="editor-${taskNum}"></textarea>
                </div>
                <div class="output-panel">
                    <div class="output-header">Output</div>
                    <div class="output-content" id="output-${taskNum}"></div>
                </div>
                <div class="hint-box" id="hint-${taskNum}">
                    <div class="hint-header">
                        <span>üí°</span>
                        <span>Hint <span id="hintNumber-${taskNum}">1</span>/${task.hints.length}</span>
                    </div>
                    <p id="hintText-${taskNum}">${task.hints[0]}</p>
                </div>
                <div class="controls">
                    <button class="btn btn-secondary" onclick="showHint(${taskNum})">üí° Show Hint</button>
                    <button class="btn btn-success" onclick="checkCode(${taskNum})">‚úì Check Solution</button>
                    ${taskNum < Object.keys(tasks).length ? `<button class="btn btn-primary" onclick="switchTask(${taskNum + 1})">Next Task ‚Üí</button>` : ''}
                </div>
                <div class="checks-container" id="checks-${taskNum}" style="display: none;">
                    <h3>Solution Checks:</h3>
                    ${task.checks.map((check, index) => `<div class="check-item" id="check-${taskNum}-${index}"><div class="check-icon pending" id="checkIcon-${taskNum}-${index}">?</div><span>${check.name}</span></div>`).join('')}
                </div>`;
            setTimeout(() => initializeEditor(taskNum), 0);
        }

        // Run Python code
        async function runCode(taskNumber) {
            if (!pyodide || !editors[taskNumber]) return;
            const outputElement = document.getElementById(`output-${taskNumber}`);
            outputElement.textContent = 'Running...';
            outputElement.classList.remove('error');
            try {
                const code = editors[taskNumber].getValue();
                pyodide.runPython(`import sys; from io import StringIO; sys.stdout = sys.stderr = StringIO()`);
                await pyodide.runPythonAsync(code);
                const stdout = pyodide.runPython("sys.stdout.getvalue()");
                const stderr = pyodide.runPython("sys.stderr.getvalue()");
                if (stderr) {
                    outputElement.textContent = stderr;
                    outputElement.classList.add('error');
                } else {
                    outputElement.textContent = stdout || 'No output';
                }
            } catch (error) {
                outputElement.textContent = error.message;
                outputElement.classList.add('error');
            }
        }

        // Check code against criteria
        async function checkCode(taskNumber) {
            const task = tasks[taskNumber];
            const checksContainer = document.getElementById(`checks-${taskNumber}`);
            checksContainer.style.display = 'block';
            
            if (!userProgress.taskAttempts[taskNumber]) userProgress.taskAttempts[taskNumber] = 0;
            userProgress.taskAttempts[taskNumber]++;

            await runCode(taskNumber);
            
            const code = editors[taskNumber].getValue();
            const output = document.getElementById(`output-${taskNumber}`).textContent;
            let allChecksPassed = true;
            
            task.checks.forEach((check, index) => {
                const passed = check.test(code, output);
                const checkIcon = document.getElementById(`checkIcon-${taskNumber}-${index}`);
                checkIcon.textContent = passed ? '‚úì' : '‚úó';
                checkIcon.className = `check-icon ${passed ? 'passed' : 'failed'}`;
                if (!passed) allChecksPassed = false;
            });
            
            if (allChecksPassed && !userProgress.completedTasks[taskNumber]) {
                userProgress.completedTasks[taskNumber] = true;
                if (userProgress.taskAttempts[taskNumber] === 1) userProgress.firstTryTasks++;
                if (!userProgress.hintsUsed[taskNumber]) userProgress.perfectTasks++;
                awardXP(task.xp);
                updateProgress();
                generateTaskList();
                showAchievement('‚úÖ', 'Task Complete!', `${task.title} finished!`, task.xp);
                checkBadges();
            }
        }

        function showHint(taskNumber) {
            const task = tasks[taskNumber];
            const hintBox = document.getElementById(`hint-${taskNumber}`);
            const hintText = document.getElementById(`hintText-${taskNumber}`);
            const hintNumberEl = document.getElementById(`hintNumber-${taskNumber}`);
            if (!userProgress.hintsUsed[taskNumber]) userProgress.hintsUsed[taskNumber] = 0;
            const currentHintIndex = userProgress.hintsUsed[taskNumber];
            if (currentHintIndex < task.hints.length) {
                hintBox.classList.add('show');
                hintText.textContent = task.hints[currentHintIndex];
                hintNumberEl.textContent = currentHintIndex + 1;
                userProgress.hintsUsed[taskNumber]++;
                saveAllProgress();
            }
        }

        function resetCode(taskNumber) {
            if (confirm('Are you sure you want to reset your code for this task?')) {
                const task = tasks[taskNumber];
                editors[taskNumber].setValue(task.starterCode);
                localStorage.removeItem(`if-code-${task.id}`);
            }
        }

        function awardXP(amount) {
            userProgress.xp += amount;
            const newLevel = Math.floor(userProgress.xp / 500) + 1;
            if (newLevel > userProgress.level) {
                userProgress.level = newLevel;
                showAchievement('üéâ', 'Level Up!', `You've reached Level ${newLevel}!`, 0);
            }
            updateProgress();
            saveAllProgress();
        }

        function updateProgress() {
            document.getElementById('userLevel').textContent = userProgress.level;
            document.getElementById('userXP').textContent = userProgress.xp;
            document.getElementById('userStreak').textContent = userProgress.streak;
            document.getElementById('xpFill').style.width = `${(userProgress.xp % 500) / 5}%`;
            const completedCount = Object.keys(userProgress.completedTasks).length;
            const totalTasks = Object.keys(tasks).length;
            document.getElementById('progressBar').style.width = `${(completedCount / totalTasks) * 100}%`;
            document.getElementById('progressText').textContent = `${completedCount}/${totalTasks} tasks completed`;
            Object.keys(BADGES).forEach(badgeId => {
                if (userProgress.badges[badgeId]) {
                    document.getElementById(`badge-${badgeId}`).classList.add('earned');
                }
            });
        }
        
        function checkBadges() {
            Object.keys(BADGES).forEach(badgeId => {
                if (!userProgress.badges[badgeId] && BADGES[badgeId].check()) {
                    userProgress.badges[badgeId] = true;
                    const badge = BADGES[badgeId];
                    showAchievement(badge.icon, 'Badge Earned!', badge.name, 50);
                    awardXP(50);
                }
            });
        }

        function showAchievement(icon, title, message, xp) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementIcon').textContent = icon;
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementMessage').textContent = message;
            const xpElement = document.getElementById('achievementXP');
            xpElement.parentElement.style.display = xp > 0 ? 'block' : 'none';
            xpElement.textContent = xp;
            popup.classList.add('show');
            setTimeout(() => popup.classList.remove('show'), 4000);
        }

        function saveAllProgress() {
            localStorage.setItem('if-statements-progress', JSON.stringify(userProgress));
        }

        function loadAllProgress() {
            const saved = localStorage.getItem('if-statements-progress');
            if (saved) {
                userProgress = JSON.parse(saved);
                const today = new Date().toDateString();
                if (today !== userProgress.lastVisit) {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    userProgress.streak = (userProgress.lastVisit === yesterday.toDateString()) ? userProgress.streak + 1 : 1;
                    userProgress.lastVisit = today;
                }
            }
            updateProgress();
        }
        
        // Prevent text selection
        document.addEventListener('selectstart', function(e) {
            const target = e.target;
            if (target.tagName !== 'TEXTAREA' && target.tagName !== 'INPUT' && !target.closest('.CodeMirror')) {
                e.preventDefault();
            }
        });

        window.addEventListener('load', initializePyodide);
    </script>
</body>
</html>