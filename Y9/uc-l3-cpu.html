<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 3: CPU - The Brain of the Computer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            scroll-behavior: smooth;
        }

        /* Disable all text selection and copy/paste */
        * {
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
        }
        
        /* Allow copy/paste in input areas for a better user experience, but can be re-enabled if strictly needed */
        input, textarea, select {
            -webkit-user-select: text !important; /* Changed to text */
            -moz-user-select: text !important;    /* Changed to text */
            -ms-user-select: text !important;     /* Changed to text */
            user-select: text !important;         /* Changed to text */
        }
        
        .cpu-glow {
            animation: cpuGlow 2s ease-in-out infinite;
        }
        
        @keyframes cpuGlow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            }
            50% {
                box-shadow: 0 0 40px rgba(59, 130, 246, 0.8);
            }
        }
        
        .pulse {
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        .draggable {
            cursor: move;
            transition: all 0.3s ease;
            user-select: none; /* Ensure this is still effective for draggable items */
        }
        
        .draggable:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .drop-zone {
            min-height: 60px;
            transition: all 0.3s ease;
        }
        
        .drop-zone.drag-over {
            background-color: #e0f2fe !important; /* Added !important for higher specificity */
            border-color: #0ea5e9 !important;
            transform: scale(1.02);
        }
        
        @keyframes conveyor {
            from {
                transform: translateX(-100%);
            }
            to {
                transform: translateX(0);
            }
        }
        
        .conveyor-item {
            animation: conveyor 3s linear;
        }
        
        @keyframes cooking {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .cooking {
            animation: cooking 1s ease-in-out;
        }
        
        .achievement-unlock {
            animation: achievementPop 0.5s ease-out forwards; /* Added forwards to keep final state */
        }
        
        @keyframes achievementPop {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(5deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        .flip-card {
            background-color: transparent;
            width: 100%;
            height: 100%;
            perspective: 1000px;
        }
        
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        
        .flip-card-front,
        .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 12px; /* Tailwind: rounded-xl */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px; /* Tailwind: p-5 */
        }
        
        .flip-card-back {
            transform: rotateY(180deg);
        }
        
        .exam-question {
            background-color: #f3f4f6; /* Tailwind: bg-gray-100 */
            border-left: 4px solid #3b82f6; /* Tailwind: border-l-4 border-blue-500 */
            padding: 1rem; /* Tailwind: p-4 */
            margin-bottom: 1rem; /* Tailwind: mb-4 */
        }
        
        @keyframes processingFlow {
            0% {
                left: 0;
                opacity: 1;
            }
            33% {
                left: 33%;
                opacity: 0.8;
            }
            66% {
                left: 66%;
                opacity: 0.8;
            }
            100% {
                left: 100%;
                opacity: 0;
            }
        }
        
        .processing-animation {
            position: relative;
            animation: processingFlow 3s ease-in-out;
        }
        
        .timeline-step {
            transition: all 0.3s ease;
        }
        
        .timeline-step.active {
            background-color: #3b82f6; /* Tailwind: bg-blue-500 */
            color: white;
            transform: scale(1.1);
        }
        
        .timeline-step.completed {
            background-color: #10b981; /* Tailwind: bg-green-500 */
            color: white;
        }

        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 500px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        .modal-content h3 {
            font-size: 1.5rem; /* text-2xl */
            font-weight: bold;
            margin-bottom: 1rem; /* mb-4 */
            color: #374151; /* text-gray-700 */
        }
        .modal-content p {
            font-size: 1rem; /* text-base */
            color: #4b5563; /* text-gray-600 */
            margin-bottom: 1.5rem; /* mb-6 */
            line-height: 1.6;
        }
        .modal-close-btn {
            background-color: #3b82f6; /* bg-blue-500 */
            color: white;
            padding: 0.75rem 1.5rem; /* px-6 py-3 */
            border-radius: 0.5rem; /* rounded-lg */
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s ease;
        }
        .modal-close-btn:hover {
            background-color: #2563eb; /* bg-blue-600 */
        }

        /* Overclocking Simulator Styles */
        .temp-gauge-container {
            width: 60px;
            height: 200px;
            background-color: #e5e7eb; /* bg-gray-200 */
            border-radius: 0.5rem; /* rounded-lg */
            position: relative;
            overflow: hidden;
            border: 2px solid #9ca3af; /* border-gray-400 */
            margin: 0 auto; /* Center the gauge */
        }
        .temp-gauge-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%; /* Starts empty */
            background-color: #34d399; /* bg-emerald-500 (cool) */
            transition: height 0.3s ease, background-color 0.3s ease;
        }
        .cpu-visual {
            width: 100px;
            height: 100px;
            border: 3px solid #6b7280; /* border-gray-500 */
            border-radius: 0.5rem; /* rounded-lg */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem; /* text-3xl */
            transition: background-color 0.3s ease, border-color 0.3s ease;
            background-color: #d1d5db; /* bg-gray-300 */
        }
        .cpu-visual.overheating {
            animation: heatPulse 0.7s infinite; /* Faster pulse for more urgency */
        }
        @keyframes heatPulse {
            0% { box-shadow: 0 0 8px rgba(255,100,0,0.6); } /* More intense orange glow */
            50% { box-shadow: 0 0 20px rgba(255,0,0,0.9); } /* Redder, stronger glow */
            100% { box-shadow: 0 0 8px rgba(255,100,0,0.6); }
        }
        .cpu-visual.crashed {
             background-color: #ef4444; /* bg-red-500 */
             border-color: #b91c1c; /* border-red-700 */
             color: white;
        }
        /* Slider styling improvements */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #d1d5db; /* bg-gray-300 */
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6; /* bg-blue-500 */
            border-radius: 50%;
            cursor: pointer;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6; /* bg-blue-500 */
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }


    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-blue-50 to-cyan-50 min-h-screen p-4 md:p-8">
    <!-- Custom Modal -->
    <div id="customModal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modalTitle">Notification</h3>
            <p id="modalMessage">This is a custom message.</p>
            <button id="modalCloseBtn" class="modal-close-btn">Close</button>
        </div>
    </div>

    <div class="max-w-7xl mx-auto">
        <!-- Header with CPU Animation -->
        <header class="text-center mb-8 relative">
            <div class="absolute inset-0 flex justify-center items-center opacity-10">
                <div class="w-64 h-64 bg-blue-500 rounded-lg cpu-glow transform rotate-45"></div>
            </div>
            <h1 class="text-4xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-2 relative z-10">
                CPU: The Central Processing Unit 🧠
            </h1>
            <p class="text-gray-600 text-lg relative z-10">Welcome to the CPU Command Center!</p>
            
            <!-- XP and Achievement Bar -->
            <div class="mt-6 bg-white rounded-full p-2 shadow-lg max-w-md mx-auto relative z-10">
                <div class="flex items-center justify-between">
                    <span id="levelDisplay" class="text-sm font-bold text-gray-700 ml-3">Level 1 CPU Rookie</span>
                    <span class="text-sm font-bold text-blue-600 mr-3"><span id="xpPoints">0</span> XP</span>
                </div>
                <div class="bg-gray-200 rounded-full h-3 mt-2">
                    <div id="xpBar" class="bg-gradient-to-r from-blue-500 to-purple-500 h-full rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </header>

        <!-- Starter: CPU Detective -->
        <section class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-6 relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4">
                <span class="text-4xl">🔍</span>
            </div>
            <h2 class="text-2xl md:text-3xl font-bold text-purple-600 mb-4">🔍 Starter: CPU Detective</h2>
            <p class="text-gray-700 mb-6">Investigate these mysterious computer behaviors to discover what a CPU does!</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <!-- Mystery Cards -->
                <div class="flip-card h-48" onclick="flipCard(this, 'mystery1')">
                    <div class="flip-card-inner">
                        <div class="flip-card-front bg-gradient-to-br from-purple-400 to-purple-600 text-white">
                            <div class="text-3xl mb-2">🖥️</div>
                            <p class="font-bold">Mystery 1</p>
                            <p class="text-sm">Computer frozen!</p>
                        </div>
                        <div class="flip-card-back bg-purple-50 text-gray-800">
                            <p class="text-sm font-semibold mb-2">Clue Found!</p>
                            <p class="text-xs">The CPU was overloaded with too many calculations at once!</p>
                        </div>
                    </div>
                </div>
                
                <div class="flip-card h-48" onclick="flipCard(this, 'mystery2')">
                    <div class="flip-card-inner">
                        <div class="flip-card-front bg-gradient-to-br from-blue-400 to-blue-600 text-white">
                            <div class="text-3xl mb-2">🎮</div>
                            <p class="font-bold">Mystery 2</p>
                            <p class="text-sm">Game running slowly!</p>
                        </div>
                        <div class="flip-card-back bg-blue-50 text-gray-800">
                            <p class="text-sm font-semibold mb-2">Clue Found!</p>
                            <p class="text-xs">The CPU couldn't process game instructions fast enough!</p>
                        </div>
                    </div>
                </div>
                
                <div class="flip-card h-48" onclick="flipCard(this, 'mystery3')">
                    <div class="flip-card-inner">
                        <div class="flip-card-front bg-gradient-to-br from-green-400 to-green-600 text-white">
                            <div class="text-3xl mb-2">📱</div>
                            <p class="font-bold">Mystery 3</p>
                            <p class="text-sm">Phone getting hot!</p>
                        </div>
                        <div class="flip-card-back bg-green-50 text-gray-800">
                            <p class="text-sm font-semibold mb-2">Clue Found!</p>
                            <p class="text-xs">The CPU was working hard and generating heat!</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-gray-50 p-4 rounded-lg">
                <label for="cpuDefinition" class="font-semibold block mb-2">Based on your investigation, what do you think a CPU is?</label>
                <textarea id="cpuDefinition" class="w-full p-3 border-2 border-purple-200 rounded-md focus:border-purple-400 focus:outline-none h-20" 
                    placeholder="Write your definition here..."></textarea>
                <button onclick="checkDefinition()" class="mt-2 bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 transition-all">
                    Submit Definition
                </button>
                <div id="definitionFeedback" class="mt-2"></div>
            </div>
        </section>

        <!-- Task 1: F-D-E Timeline Activity -->
        <section class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-orange-600 mb-4">🔄 Task 1: Fetch-Decode-Execute Timeline</h2>
            <p class="text-gray-700 mb-6">Put these CPU instruction steps in the correct order and match them with what happens!</p>
            
            <!-- Timeline Builder -->
            <div class="bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-6 mb-6">
                <h3 class="font-bold text-lg mb-4">Build the F-D-E Timeline:</h3>
                
                <!-- Timeline Display -->
                <div class="flex justify-between items-center mb-8 relative">
                    <div class="absolute top-1/2 left-0 right-0 h-1 bg-gray-300 -translate-y-1/2"></div>
                    
                    <div id="step1" class="timeline-step relative z-10 w-32 h-32 bg-white rounded-full shadow-lg flex flex-col items-center justify-center drop-zone" data-position="1">
                        <p class="text-xs font-bold">Step 1</p>
                        <p class="text-xs text-gray-500">Drop here</p>
                    </div>
                    
                    <div id="step2" class="timeline-step relative z-10 w-32 h-32 bg-white rounded-full shadow-lg flex flex-col items-center justify-center drop-zone" data-position="2">
                        <p class="text-xs font-bold">Step 2</p>
                        <p class="text-xs text-gray-500">Drop here</p>
                    </div>
                    
                    <div id="step3" class="timeline-step relative z-10 w-32 h-32 bg-white rounded-full shadow-lg flex flex-col items-center justify-center drop-zone" data-position="3">
                        <p class="text-xs font-bold">Step 3</p>
                        <p class="text-xs text-gray-500">Drop here</p>
                    </div>
                </div>
                
                <!-- Draggable Options -->
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="draggable bg-blue-100 p-4 rounded-lg border-2 border-blue-300 text-center" draggable="true" data-stage="decode">
                        <div class="text-2xl mb-1">🧠</div>
                        <p class="font-semibold">DECODE</p>
                        <p class="text-xs">Understand instruction</p>
                    </div>
                    <div class="draggable bg-green-100 p-4 rounded-lg border-2 border-green-300 text-center" draggable="true" data-stage="execute">
                        <div class="text-2xl mb-1">⚙️</div>
                        <p class="font-semibold">EXECUTE</p>
                        <p class="text-xs">Carry out instruction</p>
                    </div>
                    <div class="draggable bg-orange-100 p-4 rounded-lg border-2 border-orange-300 text-center" draggable="true" data-stage="fetch">
                        <div class="text-2xl mb-1">📥</div>
                        <p class="font-semibold">FETCH</p>
                        <p class="text-xs">Get instruction</p>
                    </div>
                </div>
                
                <!-- What Happens Matching -->
                <h3 class="font-bold text-lg mb-4">Match what happens in each stage:</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold mb-2">Actions:</h4>
                        <div class="space-y-2">
                            <div class="draggable bg-gray-100 p-3 rounded border" draggable="true" data-action="fetch">
                                Retrieves the next instruction from RAM
                            </div>
                            <div class="draggable bg-gray-100 p-3 rounded border" draggable="true" data-action="decode">
                                Works out what the instruction means
                            </div>
                            <div class="draggable bg-gray-100 p-3 rounded border" draggable="true" data-action="execute">
                                Performs the required operation
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-2">Match to stages:</h4>
                        <div class="space-y-2">
                            <div class="drop-zone bg-orange-50 border-2 border-dashed border-orange-300 rounded p-3 min-h-[50px]" data-expects="fetch">
                                <p class="text-sm font-semibold">FETCH action:</p>
                            </div>
                            <div class="drop-zone bg-blue-50 border-2 border-dashed border-blue-300 rounded p-3 min-h-[50px]" data-expects="decode">
                                <p class="text-sm font-semibold">DECODE action:</p>
                            </div>
                            <div class="drop-zone bg-green-50 border-2 border-dashed border-green-300 rounded p-3 min-h-[50px]" data-expects="execute">
                                <p class="text-sm font-semibold">EXECUTE action:</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button onclick="checkFDETimeline()" class="mt-6 bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-all">
                    Check Timeline & Matches
                </button>
                <div id="timelineFeedback" class="mt-4"></div>
            </div>
        </section>

        <!-- Task 2: CPU Specification Decoder -->
        <section class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-blue-600 mb-4">🎮 Task 2: CPU Specification Decoder</h2>
            <p class="text-gray-700 mb-6">Decode this CPU specification and build your dream gaming PC!</p>
            
            <!-- CPU Spec Display -->
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-6 mb-6 text-center">
                <h3 class="text-2xl font-bold mb-2">Intel® Core 16 Core Processor i7-13700k (5.3GHz Turbo) 30MB Cache</h3>
                <p class="text-sm opacity-90">Click on parts of the specification to decode them!</p>
            </div>
            
            <!-- Interactive Spec Decoder -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="bg-gray-50 p-4 rounded-lg text-center cursor-pointer hover:bg-blue-50 transition-all" onclick="revealSpec('cores')">
                    <div class="text-3xl mb-2">🧮</div>
                    <h4 class="font-bold text-gray-700">Core Count</h4>
                    <div id="coresReveal" class="mt-2 hidden">
                        <p class="text-2xl font-bold text-blue-600">16 Cores</p>
                        <p class="text-sm text-gray-600">Like having 16 workers!</p>
                    </div>
                    <button class="text-sm text-blue-500 mt-2">Click to reveal</button>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg text-center cursor-pointer hover:bg-purple-50 transition-all" onclick="revealSpec('speed')">
                    <div class="text-3xl mb-2">⚡</div>
                    <h4 class="font-bold text-gray-700">Base Clock Speed</h4>
                    <div id="speedReveal" class="mt-2 hidden">
                        <p class="text-2xl font-bold text-purple-600">3.4 GHz</p>
                        <p class="text-sm text-gray-600">3.4 billion cycles/second!</p>
                    </div>
                    <button class="text-sm text-purple-500 mt-2">Click to reveal</button>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg text-center cursor-pointer hover:bg-green-50 transition-all" onclick="revealSpec('cache')">
                    <div class="text-3xl mb-2">💾</div>
                    <h4 class="font-bold text-gray-700">Cache Size</h4>
                    <div id="cacheReveal" class="mt-2 hidden">
                        <p class="text-2xl font-bold text-green-600">30MB</p>
                        <p class="text-sm text-gray-600">Super fast memory!</p>
                    </div>
                    <button class="text-sm text-green-500 mt-2">Click to reveal</button>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg text-center cursor-pointer hover:bg-orange-50 transition-all" onclick="revealSpec('turbo')">
                    <div class="text-3xl mb-2">🚀</div>
                    <h4 class="font-bold text-gray-700">Turbo Boost</h4>
                    <div id="turboReveal" class="mt-2 hidden">
                        <p class="text-2xl font-bold text-orange-600">5.3 GHz</p>
                        <p class="text-sm text-gray-600">Boosts to 5.3GHz when needed!</p>
                    </div>
                    <button class="text-sm text-orange-500 mt-2">Click to reveal</button>
                </div>
            </div>
            
            <!-- Build Your PC Challenge -->
            <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-6">
                <h3 class="font-bold text-lg mb-4">🖥️ Build Your Dream PC!</h3>
                <p class="text-sm text-gray-600 mb-4">Match the CPU to the right use case by dragging them:</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- CPUs to Choose (Randomized order) -->
                    <div>
                        <h4 class="font-semibold mb-3">Available CPUs:</h4>
                        <div id="cpuOptions" class="space-y-2">
                            <div class="draggable bg-white p-3 rounded-lg shadow border-2 border-purple-300" draggable="true" data-cpu="gaming">
                                🎮 Intel i7 - 16 cores, 5.3GHz, £400
                            </div>
                            <div class="draggable bg-white p-3 rounded-lg shadow border-2 border-green-300" draggable="true" data-cpu="workstation">
                                💪 Intel i9 - 24 cores, 6.0GHz, £600
                            </div>
                            <div class="draggable bg-white p-3 rounded-lg shadow border-2 border-blue-300" draggable="true" data-cpu="budget">
                                💰 Intel i3 - 4 cores, 3.6GHz, £150
                            </div>
                        </div>
                    </div>
                    
                    <!-- Use Cases -->
                    <div>
                        <h4 class="font-semibold mb-3">Match to Use Case:</h4>
                        <div class="space-y-2">
                            <div class="drop-zone bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg p-4" data-answer="budget">
                                <p class="font-semibold text-sm">School Computer Lab</p>
                                <p class="text-xs text-gray-600">Web browsing, documents</p>
                            </div>
                            <div class="drop-zone bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg p-4" data-answer="gaming">
                                <p class="font-semibold text-sm">Gaming Setup</p>
                                <p class="text-xs text-gray-600">Fortnite, Minecraft at 144fps</p>
                            </div>
                            <div class="drop-zone bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg p-4" data-answer="workstation">
                                <p class="font-semibold text-sm">Video Editing Studio</p>
                                <p class="text-xs text-gray-600">4K video rendering</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button onclick="checkPCBuild()" class="mt-4 bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-all">
                    Check Build
                </button>
            </div>
        </section>

        <!-- Task 3: CPU Performance Understanding -->
        <section class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-green-600 mb-4">⚡ Task 3: CPU Performance Understanding</h2>
            <p class="text-gray-700 mb-6">Test your knowledge of what affects CPU performance!</p>
            
            <!-- Performance Factors Quiz -->
            <div class="space-y-6">
                <!-- Clock Speed Question -->
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-3">🏃 Clock Speed</h3>
                    <label for="clockSpeedAnswer" class="block mb-2">What is clock speed and how does it affect performance?</label>
                    <textarea id="clockSpeedAnswer" class="w-full p-3 border-2 border-blue-200 rounded-md focus:border-blue-400 focus:outline-none h-24" 
                        placeholder="Explain clock speed and its effect on performance..."></textarea>
                    
                    <div class="mt-4">
                        <p class="font-semibold mb-2">If CPU A has 2.0 GHz and CPU B has 4.0 GHz, which is faster and why?</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="clockSpeed" value="a" class="mr-2">
                                <span>CPU A is faster</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="clockSpeed" value="b" class="mr-2">
                                <span>CPU B is faster</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="clockSpeed" value="depends" class="mr-2">
                                <span>It depends on other factors</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Core Count Question -->
                <div class="bg-green-50 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-3">🧮 CPU Cores</h3>
                    <label for="coresAnswer" class="block mb-2">What are CPU cores and why do more cores help performance?</label>
                    <textarea id="coresAnswer" class="w-full p-3 border-2 border-green-200 rounded-md focus:border-green-400 focus:outline-none h-24" 
                        placeholder="Explain CPU cores and their benefit..."></textarea>
                    
                    <div class="mt-4">
                        <p class="font-semibold mb-2">Which task would benefit most from a 16-core CPU?</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="coreTask" value="word" class="mr-2">
                                <span>Writing a document in Word</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="coreTask" value="video" class="mr-2">
                                <span>Rendering a 4K video</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="coreTask" value="browsing" class="mr-2">
                                <span>Browsing the internet</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Cache Question -->
                <div class="bg-purple-50 p-4 rounded-lg">
                    <h3 class="font-bold text-lg mb-3">💾 Cache Memory</h3>
                    <label for="cacheAnswer" class="block mb-2">What is cache and why is it important for CPU performance?</label>
                    <textarea id="cacheAnswer" class="w-full p-3 border-2 border-purple-200 rounded-md focus:border-purple-400 focus:outline-none h-24" 
                        placeholder="Explain cache and its importance..."></textarea>
                    
                    <div class="mt-4">
                        <p class="font-semibold mb-2">Why is cache faster than RAM?</p>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="cacheSpeed" value="size" class="mr-2">
                                <span>Because it's larger than RAM</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="cacheSpeed" value="location" class="mr-2">
                                <span>Because it's built into the CPU</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="cacheSpeed" value="new" class="mr-2">
                                <span>Because it's newer technology</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <button onclick="checkPerformanceAnswers()" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-all">
                    Check Answers
                </button>
                <div id="performanceFeedback" class="mt-4"></div>
            </div>
        </section>

        <!-- Task 4: Embedded Systems -->
        <section class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-purple-600 mb-4">🚗 Task 4: Embedded Systems Hunt</h2>
            <p class="text-gray-700 mb-6">Identify embedded systems in everyday objects!</p>
            
            <!-- Definition Section -->
            <div class="bg-purple-50 p-4 rounded-lg mb-6">
                <label for="embeddedDefinition" class="font-semibold block mb-2">What is an embedded system?</label>
                <textarea id="embeddedDefinition" class="w-full p-2 border-2 border-purple-200 rounded-md focus:border-purple-400 focus:outline-none h-16" 
                    placeholder="Write your definition..."></textarea>
                <button onclick="checkEmbeddedDefinition()" class="mt-2 bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 transition-all">
                    Check Definition
                </button>
                <div id="embeddedFeedback" class="mt-2"></div>
            </div>
            
            <!-- Car Embedded Systems Challenge -->
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-6">
                <h3 class="font-bold text-lg mb-4">🚗 Modern Car Embedded Systems</h3>
                <p class="text-sm text-gray-600 mb-4">List all the embedded systems you can think of in a modern car:</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="carSystemsList" class="font-semibold block mb-2">Your List of Car Embedded Systems:</label>
                        <textarea id="carSystemsList" class="w-full p-3 border-2 border-purple-200 rounded-md focus:border-purple-400 focus:outline-none h-48" 
                            placeholder="List embedded systems in a car (one per line)..."></textarea>
                    </div>
                    
                    <div>
                        <label for="carSystemsPurpose" class="font-semibold block mb-2">For each system, explain its purpose:</label>
                        <textarea id="carSystemsPurpose" class="w-full p-3 border-2 border-purple-200 rounded-md focus:border-purple-400 focus:outline-none h-48" 
                            placeholder="Explain what each system does..."></textarea>
                    </div>
                </div>
                
                <button onclick="checkCarSystems()" class="mt-4 bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-all">
                    Check Your Answers
                </button>
                <div id="carSystemsFeedback" class="mt-4"></div>
                
                <!-- Other Embedded Systems -->
                <div class="mt-6">
                    <h4 class="font-bold mb-3">📱 Other Embedded Systems Around You</h4>
                    <p class="text-sm text-gray-600 mb-3">Name embedded systems in these devices:</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div class="bg-white p-3 rounded-lg">
                            <label for="washingMachine" class="font-semibold text-sm">Washing Machine:</label>
                            <input type="text" id="washingMachine" class="w-full mt-1 p-2 border rounded" placeholder="Type here...">
                        </div>
                        <div class="bg-white p-3 rounded-lg">
                            <label for="smartTV" class="font-semibold text-sm">Smart TV:</label>
                            <input type="text" id="smartTV" class="w-full mt-1 p-2 border rounded" placeholder="Type here...">
                        </div>
                        <div class="bg-white p-3 rounded-lg">
                            <label for="microwave" class="font-semibold text-sm">Microwave:</label>
                            <input type="text" id="microwave" class="w-full mt-1 p-2 border rounded" placeholder="Type here...">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Exam Style Questions -->
        <section class="bg-gradient-to-r from-red-100 to-orange-100 rounded-xl shadow-lg p-6 md:p-8 mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-red-700 mb-4">📝 Exam Style Questions</h2>
            <p class="text-gray-700 mb-6">Answer these exam-style questions. You must write a detailed answer and self-assess before viewing the mark scheme!</p>
            
            <!-- Question 1 -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-lg font-bold text-gray-800">Question 1</h3>
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm font-semibold">[3 marks]</span>
                </div>
                <p class="text-gray-700 mb-4">Describe the three stages of the Fetch-Decode-Execute cycle.</p>
                
                <textarea id="q1-answer" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-400 focus:outline-none h-32 mb-4" 
                    placeholder="Write your answer here..."></textarea>
                
                <div class="flex gap-4 mb-4">
                    <div class="flex-1">
                        <label for="q1-marks" class="block text-sm font-semibold mb-2">How many marks do you think you earned?</label>
                        <select id="q1-marks" class="w-full p-2 border rounded">
                            <option value="">Select...</option>
                            <option value="0">0 marks</option>
                            <option value="1">1 mark</option>
                            <option value="2">2 marks</option>
                            <option value="3">3 marks</option>
                        </select>
                    </div>
                </div>
                
                <button onclick="checkExamAnswer(1)" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-all mb-4">
                    Show Mark Scheme
                </button>
                <button onclick="getWritingMetrics(1)" class="ml-3 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-all mb-4">
                    Check Writing Quality
                </button>
                
                <div id="q1-markscheme" class="hidden bg-green-50 p-4 rounded-lg">
                    <h4 class="font-bold text-green-700 mb-2">Mark Scheme:</h4>
                    <ul class="text-sm space-y-2 list-disc list-inside">
                        <li><strong>[1 mark]</strong> Fetch - The next instruction is fetched from memory/RAM</li>
                        <li><strong>[1 mark]</strong> Decode - The instruction is interpreted/understood so it can be carried out</li>
                        <li><strong>[1 mark]</strong> Execute - The instruction is carried out/performed by the CPU</li>
                    </ul>
                </div>
            </div>
            
            <!-- Question 2 -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-lg font-bold text-gray-800">Question 2</h3>
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm font-semibold">[4 marks]</span>
                </div>
                <p class="text-gray-700 mb-4">Explain two factors that affect CPU performance and how each factor improves performance.</p>
                
                <textarea id="q2-answer" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-400 focus:outline-none h-40 mb-4" 
                    placeholder="Write your answer here..."></textarea>
                
                <div class="flex gap-4 mb-4">
                    <div class="flex-1">
                        <label for="q2-marks" class="block text-sm font-semibold mb-2">How many marks do you think you earned?</label>
                        <select id="q2-marks" class="w-full p-2 border rounded">
                            <option value="">Select...</option>
                            <option value="0">0 marks</option>
                            <option value="1">1 mark</option>
                            <option value="2">2 marks</option>
                            <option value="3">3 marks</option>
                            <option value="4">4 marks</option>
                        </select>
                    </div>
                </div>
                
                <button onclick="checkExamAnswer(2)" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-all mb-4">
                    Show Mark Scheme
                </button>
                <button onclick="getWritingMetrics(2)" class="ml-3 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-all mb-4">
                    Check Writing Quality
                </button>
                
                <div id="q2-markscheme" class="hidden bg-green-50 p-4 rounded-lg">
                    <h4 class="font-bold text-green-700 mb-2">Mark Scheme:</h4>
                    <p class="text-sm font-semibold mb-2">Any two from:</p>
                    <ul class="text-sm space-y-2 list-disc list-inside">
                        <li><strong>[1 mark]</strong> Clock speed - higher clock speed means more instructions processed per second</li>
                        <li><strong>[1 mark]</strong> More FDE cycles can be performed per second</li>
                        <li><strong>[1 mark]</strong> Number of cores - multiple cores can process instructions in parallel</li>
                        <li><strong>[1 mark]</strong> Allows multitasking/multiple programs to run simultaneously</li>
                        <li><strong>[1 mark]</strong> Cache size - larger cache stores more frequently used data</li>
                        <li><strong>[1 mark]</strong> Reduces time to fetch data as it's closer to CPU than RAM</li>
                    </ul>
                </div>
            </div>
            
            <!-- Question 3 -->
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-lg font-bold text-gray-800">Question 3</h3>
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm font-semibold">[3 marks]</span>
                </div>
                <p class="text-gray-700 mb-4">What is an embedded system? Give two examples of embedded systems and explain their purpose.</p>
                
                <textarea id="q3-answer" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-400 focus:outline-none h-32 mb-4" 
                    placeholder="Write your answer here..."></textarea>
                
                <div class="flex gap-4 mb-4">
                    <div class="flex-1">
                        <label for="q3-marks" class="block text-sm font-semibold mb-2">How many marks do you think you earned?</label>
                        <select id="q3-marks" class="w-full p-2 border rounded">
                            <option value="">Select...</option>
                            <option value="0">0 marks</option>
                            <option value="1">1 mark</option>
                            <option value="2">2 marks</option>
                            <option value="3">3 marks</option>
                        </select>
                    </div>
                </div>
                
                <button onclick="checkExamAnswer(3)" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-all mb-4">
                    Show Mark Scheme
                </button>
                <button onclick="getWritingMetrics(3)" class="ml-3 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-all mb-4">
                    Check Writing Quality
                </button>
                
                <div id="q3-markscheme" class="hidden bg-green-50 p-4 rounded-lg">
                    <h4 class="font-bold text-green-700 mb-2">Mark Scheme:</h4>
                    <ul class="text-sm space-y-2 list-disc list-inside">
                        <li><strong>[1 mark]</strong> A computer system with a dedicated function within a larger system</li>
                        <li><strong>[1 mark]</strong> Example 1: e.g. Washing machine control system - controls wash cycles/temperature/spin speed</li>
                        <li><strong>[1 mark]</strong> Example 2: e.g. Car ABS system - prevents wheels from locking during braking</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Extension Activities -->
        <section class="bg-gradient-to-r from-indigo-100 to-purple-100 rounded-xl shadow-lg p-6 md:p-8 mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-indigo-700 mb-4">🚀 Extension: Beyond GCSE</h2>
            <p class="text-gray-700 mb-6">Explore advanced CPU concepts for those ready to go further!</p>
            
            <!-- Extension 1: Pipelining -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="font-bold text-lg mb-3 text-indigo-600">🔧 Extension 1: CPU Pipelining</h3>
                <p class="text-gray-700 mb-4">Modern CPUs use pipelining to improve performance. Instead of waiting for one instruction to complete all three stages, they start the next instruction while the previous is still being processed!</p>
                
                <div class="bg-indigo-50 p-4 rounded-lg mb-4">
                    <p class="font-semibold mb-2">Example Pipeline:</p>
                    <div class="grid grid-cols-4 gap-2 text-center text-xs">
                        <div class="font-semibold">Time →</div>
                        <div class="font-semibold">Clock 1</div>
                        <div class="font-semibold">Clock 2</div>
                        <div class="font-semibold">Clock 3</div>
                        
                        <div class="font-semibold">Instruction 1:</div>
                        <div class="bg-orange-200 p-1 rounded">Fetch</div>
                        <div class="bg-blue-200 p-1 rounded">Decode</div>
                        <div class="bg-green-200 p-1 rounded">Execute</div>
                        
                        <div class="font-semibold">Instruction 2:</div>
                        <div class="text-gray-400">-</div>
                        <div class="bg-orange-200 p-1 rounded">Fetch</div>
                        <div class="bg-blue-200 p-1 rounded">Decode</div>
                        
                        <div class="font-semibold">Instruction 3:</div>
                        <div class="text-gray-400">-</div>
                        <div class="text-gray-400">-</div>
                        <div class="bg-orange-200 p-1 rounded">Fetch</div>
                    </div>
                </div>
                
                <label for="pipeliningExplanation" class="font-semibold block mb-2">How does pipelining improve CPU performance?</label>
                <textarea id="pipeliningExplanation" class="w-full p-3 border-2 border-indigo-200 rounded-md focus:border-indigo-400 focus:outline-none h-24" 
                    placeholder="Explain your understanding..."></textarea>
            </div>
            
            <!-- Extension 2: Cache Levels -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="font-bold text-lg mb-3 text-purple-600">📊 Extension 2: Cache Hierarchy</h3>
                <p class="text-gray-700 mb-4">Modern CPUs have multiple levels of cache, each with different speeds and sizes:</p>
                
                <div class="space-y-3">
                    <div class="bg-purple-50 p-3 rounded-lg">
                        <h4 class="font-semibold">L1 Cache (Level 1)</h4>
                        <p class="text-sm">• Smallest (32KB - 64KB per core)</p>
                        <p class="text-sm">• Fastest (1 cycle access time)</p>
                        <p class="text-sm">• Separate instruction and data caches</p>
                    </div>
                    
                    <div class="bg-purple-100 p-3 rounded-lg">
                        <h4 class="font-semibold">L2 Cache (Level 2)</h4>
                        <p class="text-sm">• Medium size (256KB - 1MB per core)</p>
                        <p class="text-sm">• Slower than L1 (4-12 cycles)</p>
                        <p class="text-sm">• Unified cache for both instructions and data</p>
                    </div>
                    
                    <div class="bg-purple-200 p-3 rounded-lg">
                        <h4 class="font-semibold">L3 Cache (Level 3)</h4>
                        <p class="text-sm">• Largest (8MB - 32MB shared)</p>
                        <p class="text-sm">• Slowest cache (30-40 cycles)</p>
                        <p class="text-sm">• Shared between all cores</p>
                    </div>
                </div>
                
                <div class="mt-4">
                    <label for="cacheHitMiss" class="font-semibold block mb-2">Research Task: Find out about cache hit/miss rates</label>
                    <textarea id="cacheHitMiss" class="w-full p-3 border-2 border-purple-200 rounded-md focus:border-purple-400 focus:outline-none h-20" 
                        placeholder="What happens when data isn't found in cache?"></textarea>
                </div>
            </div>
            
            <!-- Extension 3: Modern CPU Architectures -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="font-bold text-lg mb-3 text-green-600">🏗️ Extension 3: Big.LITTLE Architecture</h3>
                <p class="text-gray-700 mb-4">Modern mobile processors use different types of cores for efficiency:</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-700">Performance Cores (Big)</h4>
                        <p class="text-sm mt-2">• High clock speed</p>
                        <p class="text-sm">• More power consumption</p>
                        <p class="text-sm">• Used for demanding tasks</p>
                        <p class="text-sm">• Example: Gaming, video editing</p>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-700">Efficiency Cores (LITTLE)</h4>
                        <p class="text-sm mt-2">• Lower clock speed</p>
                        <p class="text-sm">• Less power consumption</p>
                        <p class="text-sm">• Used for background tasks</p>
                        <p class="text-sm">• Example: Checking email, music</p>
                    </div>
                </div>
                
                <p class="font-semibold mb-2">Challenge Question:</p>
                <p class="text-sm text-gray-700 mb-3">Why do you think this design is particularly useful for mobile devices like smartphones?</p>
                <textarea id="bigLittleExplanation" class="w-full p-3 border-2 border-green-200 rounded-md focus:border-green-400 focus:outline-none h-20" 
                    placeholder="Think about battery life and performance needs..."></textarea>
            </div>

            <!-- Extension 4: CPU Overclocking Simulator -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="font-bold text-lg mb-3 text-red-600">⚡ Extension 4: CPU Overclocking Simulator</h3>
                <p class="text-gray-700 mb-4">
                    Overclocking means pushing your CPU beyond its default speed for more performance. It's risky and can generate a lot of heat! 
                    Try to find the highest stable overclock.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-start">
                    <!-- Controls -->
                    <div class="md:col-span-2 space-y-6 bg-gray-50 p-6 rounded-lg">
                        <div>
                            <label for="coolerType" class="block text-sm font-medium text-gray-700 mb-1">Cooling System:</label>
                            <select id="coolerType" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="stock">Stock Cooler (Basic)</option>
                                <option value="air">Tower Air Cooler (Good)</option>
                                <option value="liquid">Liquid Cooler (Excellent)</option>
                            </select>
                        </div>

                        <div>
                            <label for="clockSpeedSlider" class="block text-sm font-medium text-gray-700">Clock Speed: <span id="clockSpeedValue" class="font-bold">3.5</span> GHz</label>
                            <input type="range" id="clockSpeedSlider" min="3.0" max="5.5" step="0.1" value="3.5" class="w-full mt-1">
                        </div>

                        <div>
                            <label for="voltageSlider" class="block text-sm font-medium text-gray-700">Voltage: <span id="voltageValue" class="font-bold">1.20</span> V</label>
                            <input type="range" id="voltageSlider" min="1.10" max="1.50" step="0.01" value="1.20" class="w-full mt-1">
                        </div>
                        
                        <div class="flex space-x-3">
                            <button id="applyOverclockBtn" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                Apply Overclock & Test Stability
                            </button>
                            <button id="resetOverclockBtn" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                Reset to Default
                            </button>
                        </div>
                         <div id="overclockFeedback" class="mt-4 text-sm text-center h-10"></div>
                    </div>

                    <!-- Visuals & Stats -->
                    <div class="space-y-4 text-center bg-gray-100 p-6 rounded-lg">
                        <h4 class="font-semibold text-lg text-gray-800">System Status</h4>
                        <div class="cpu-visual mx-auto" id="cpuVisualElement">
                            🧠
                        </div>
                        <div class="temp-gauge-container">
                            <div id="tempGaugeFill" class="temp-gauge-fill"></div>
                        </div>
                        <p class="text-sm">Temperature: <span id="tempValue" class="font-bold">35</span>°C</p>
                        <p class="text-sm">Performance: <span id="performanceValue" class="font-bold text-green-600">Nominal</span></p>
                        <p class="text-sm">Stability: <span id="stabilityValue" class="font-bold text-green-600">Stable</span></p>
                    </div>
                </div>
            </div>
        </section>


        <!-- Achievement Gallery -->
        <section class="bg-gradient-to-r from-yellow-100 to-orange-100 rounded-xl shadow-lg p-6 md:p-8 mb-6">
            <h2 class="text-2xl md:text-3xl font-bold text-orange-700 mb-4">🏆 Your CPU Achievements</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div id="achieve-detective" class="bg-white p-4 rounded-lg text-center shadow opacity-50">
                    <span class="text-3xl">🔍</span>
                    <p class="font-bold text-sm mt-2">CPU Detective</p>
                    <p class="text-xs text-gray-600">Solved all mysteries</p>
                </div>
                <div id="achieve-timeline" class="bg-white p-4 rounded-lg text-center shadow opacity-50">
                    <span class="text-3xl">⏱️</span>
                    <p class="font-bold text-sm mt-2">Timeline Master</p>
                    <p class="text-xs text-gray-600">Completed F-D-E timeline</p>
                </div>
                <div id="achieve-builder" class="bg-white p-4 rounded-lg text-center shadow opacity-50">
                    <span class="text-3xl">🏗️</span>
                    <p class="font-bold text-sm mt-2">PC Builder</p>
                    <p class="text-xs text-gray-600">Built perfect PC</p>
                </div>
                <div id="achieve-performance" class="bg-white p-4 rounded-lg text-center shadow opacity-50">
                    <span class="text-3xl">⚡</span>
                    <p class="font-bold text-sm mt-2">Performance Expert</p>
                    <p class="text-xs text-gray-600">Mastered CPU performance</p>
                </div>
                 <div id="achieve-overclocker" class="bg-white p-4 rounded-lg text-center shadow opacity-50">
                    <span class="text-3xl">🚀</span>
                    <p class="font-bold text-sm mt-2">Skilled Overclocker</p>
                    <p class="text-xs text-gray-600">Achieved stable high OC</p>
                </div>
            </div>
        </section>
    </div>

    <script>
        // --- Modal Functionality ---
        const modalOverlay = document.getElementById('customModal');
        const modalTitleElem = document.getElementById('modalTitle');
        const modalMessageElem = document.getElementById('modalMessage');
        const modalCloseBtn = document.getElementById('modalCloseBtn');

        function showModal(title, message) {
            modalTitleElem.textContent = title;
            modalMessageElem.innerHTML = message; // Use innerHTML to allow basic HTML in messages
            modalOverlay.classList.add('active');
        }

        modalCloseBtn.addEventListener('click', () => {
            modalOverlay.classList.remove('active');
        });
        modalOverlay.addEventListener('click', (event) => {
            if (event.target === modalOverlay) {
                modalOverlay.classList.remove('active');
            }
        });


        // --- Disable Copy/Paste and Context Menu ---
        document.addEventListener('DOMContentLoaded', function() {
            // Disable copy
            document.addEventListener('copy', function(e) {
                if (!e.target.closest('input, textarea, [contenteditable="true"]')) {
                    const selection = window.getSelection().toString();
                    if (selection && selection.length > 0) {
                        e.preventDefault();
                        showModal('Action Disabled', 'Copying content from this page is not allowed.');
                        return false;
                    }
                }
            });
            
            document.addEventListener('cut', function(e) {
                 if (!e.target.closest('input, textarea')) {
                    e.preventDefault();
                    showModal('Action Disabled', 'Cutting content from this page is not allowed.');
                    return false;
                }
            });
            
            document.addEventListener('paste', function(e) {
                if (!e.target.closest('input, textarea')) {
                    e.preventDefault();
                    showModal('Action Disabled', 'Pasting content here is not allowed.');
                    return false;
                }
            });
            
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                showModal('Action Disabled', 'Right-click is disabled on this page.');
                return false;
            });
            
            document.addEventListener('keydown', function(e) {
                const isInputElement = e.target.closest('input, textarea');
                if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'v' || e.key === 'x')) {
                     if (!isInputElement) { 
                        e.preventDefault();
                        showModal('Action Disabled', `Keyboard shortcut (${e.ctrlKey ? 'Ctrl' : 'Cmd'}+${e.key.toUpperCase()}) is disabled here.`);
                        return false;
                    }
                }
                if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
                    if (!isInputElement) {
                        e.preventDefault();
                        showModal('Action Disabled', `Keyboard shortcut (${e.ctrlKey ? 'Ctrl' : 'Cmd'}+A) is disabled here.`);
                        return false;
                    }
                }
            });
            
            initializeDragAndDrop();
            initializeOverclockSimulator(); // Initialize the new simulator
        });

        // --- XP and Achievement System ---
        let totalXP = 0;
        const xpTracking = {
            mysteriesFlipped: [],
            definitionSubmitted: false,
            timelineCompleted: false,
            specsRevealed: [],
            pcBuildCompleted: false,
            performanceCompleted: false,
            embeddedDefinitionCompleted: false,
            carSystemsCompleted: false,
            examQuestionsViewed: [],
            overclockStableHigh: false, // For new achievement
            overclockInteracted: false
        };
        
        const achievements = {
            detective: false,
            timeline: false,
            builder: false,
            performance: false,
            overclocker: false // New achievement
        };

        function addXP(points) {
            totalXP += points;
            document.getElementById('xpPoints').textContent = totalXP;
            const xpBar = document.getElementById('xpBar');
            const percentage = Math.min((totalXP / 600) * 100, 100); // Increased max XP for bar
            xpBar.style.width = percentage + '%';
            
            if (totalXP >= 500) { // Adjusted level thresholds
                updateLevel('Level 5 CPU Overlord');
            } else if (totalXP >= 350) {
                updateLevel('Level 4 CPU Master');
            } else if (totalXP >= 200) {
                updateLevel('Level 3 CPU Expert');
            } else if (totalXP >= 100) {
                updateLevel('Level 2 CPU Apprentice');
            }
        }

        function updateLevel(level) {
            const levelDisplay = document.getElementById('levelDisplay');
            if (levelDisplay && levelDisplay.textContent !== level) {
                levelDisplay.textContent = level;
                showModal("Level Up!", `Congratulations! You've reached ${level}!`);
            }
        }

        function unlockAchievement(name) {
            if (!achievements[name]) {
                achievements[name] = true;
                const achieveElement = document.getElementById(`achieve-${name}`);
                if (achieveElement) {
                    achieveElement.classList.remove('opacity-50');
                    achieveElement.classList.add('achievement-unlock'); 
                    achieveElement.style.animation = 'none';
                    achieveElement.offsetHeight; 
                    achieveElement.style.animation = null; 
                    
                    showModal("Achievement Unlocked!", `You've earned the "${achieveElement.querySelector('p.font-bold').textContent}" achievement!`);
                    addXP(50); 
                }
            }
        }

        // --- Flip Card Function ---
        function flipCard(card, mysteryId) {
            if (!xpTracking.mysteriesFlipped.includes(mysteryId)) {
                xpTracking.mysteriesFlipped.push(mysteryId);
                addXP(10);
            }
            card.classList.toggle('flipped');
            if (xpTracking.mysteriesFlipped.length === 3 && xpTracking.definitionSubmitted) {
                 unlockAchievement('detective');
            }
        }

        // --- CPU Definition Check ---
        function checkDefinition() {
            if (xpTracking.definitionSubmitted) {
                showModal('Already Submitted', 'You have already submitted your definition!');
                return;
            }
            const definition = document.getElementById('cpuDefinition').value.trim().toLowerCase();
            const feedback = document.getElementById('definitionFeedback');
            if (definition.length < 20) {
                feedback.innerHTML = '<p class="text-orange-500">Try to write a bit more!</p>';
                return;
            }
            const goodKeywords = ['process', 'instruction', 'execute', 'carry out', 'control', 'calculate', 'perform', 'brain'];
            let score = 0;
            goodKeywords.forEach(keyword => {
                if (definition.includes(keyword)) score++;
            });
            xpTracking.definitionSubmitted = true;
            if (score >= 2) {
                feedback.innerHTML = '<p class="text-green-600 font-bold">✅ Excellent! The CPU processes instructions and controls computer operations.</p>';
                addXP(30);
                if (xpTracking.mysteriesFlipped.length === 3) {
                    unlockAchievement('detective');
                }
            } else {
                feedback.innerHTML = '<p class="text-blue-600">Good start! Try mentioning that it processes or executes instructions, or acts like the "brain".</p>';
                addXP(10);
            }
        }

        // --- Drag and Drop Functionality ---
        let draggedElement = null;
        function initializeDragAndDrop() {
            const draggables = document.querySelectorAll('.draggable');
            const dropZones = document.querySelectorAll('.drop-zone');
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.style.opacity = '0.5';
                });
                draggable.addEventListener('dragend', function() {
                    this.style.opacity = '';
                    draggedElement = null;
                });
            });
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault(); 
                    this.classList.add('drag-over');
                });
                zone.addEventListener('dragleave', function() {
                    this.classList.remove('drag-over');
                });
                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    if (draggedElement) {
                        const existingDraggable = this.querySelector('.draggable');
                        if (existingDraggable && existingDraggable !== draggedElement) {
                            existingDraggable.remove(); 
                        }
                        if (this.querySelector('.text-gray-500') || this.querySelector('p:not(.draggable)')) {
                           Array.from(this.childNodes).forEach(child => {
                                if (child.nodeType === Node.TEXT_NODE || (child.nodeType === Node.ELEMENT_NODE && !child.classList.contains('draggable'))) {
                                    child.remove();
                                }
                            });
                        }
                        this.appendChild(draggedElement.cloneNode(true)); 
                    }
                });
            });
        }
        
        // --- F-D-E Timeline Check ---
        function checkFDETimeline() {
            if (xpTracking.timelineCompleted) {
                showModal('Already Completed', 'You have already completed the timeline!');
                return;
            }
            const feedback = document.getElementById('timelineFeedback');
            let correctOrder = true;
            let correctMatches = true;
            const step1DropZone = document.getElementById('step1');
            const step2DropZone = document.getElementById('step2');
            const step3DropZone = document.getElementById('step3');
            const step1 = step1DropZone.querySelector('[data-stage]');
            const step2 = step2DropZone.querySelector('[data-stage]');
            const step3 = step3DropZone.querySelector('[data-stage]');
            if (!step1 || step1.dataset.stage !== 'fetch') correctOrder = false;
            if (!step2 || step2.dataset.stage !== 'decode') correctOrder = false;
            if (!step3 || step3.dataset.stage !== 'execute') correctOrder = false;
            const fetchActionZone = document.querySelector('.drop-zone[data-expects="fetch"]');
            const decodeActionZone = document.querySelector('.drop-zone[data-expects="decode"]');
            const executeActionZone = document.querySelector('.drop-zone[data-expects="execute"]');
            const fetchAction = fetchActionZone.querySelector('[data-action]');
            const decodeAction = decodeActionZone.querySelector('[data-action]');
            const executeAction = executeActionZone.querySelector('[data-action]');
            if (!fetchAction || fetchAction.dataset.action !== 'fetch') correctMatches = false;
            if (!decodeAction || decodeAction.dataset.action !== 'decode') correctMatches = false;
            if (!executeAction || executeAction.dataset.action !== 'execute') correctMatches = false;
            if (correctOrder && correctMatches) {
                feedback.innerHTML = '<p class="text-green-600 font-bold text-lg">🎉 Perfect! You understand the Fetch-Decode-Execute cycle!</p>';
                if (step1DropZone) step1DropZone.classList.add('completed');
                if (step2DropZone) step2DropZone.classList.add('completed');
                if (step3DropZone) step3DropZone.classList.add('completed');
                xpTracking.timelineCompleted = true;
                addXP(50);
                unlockAchievement('timeline');
            } else {
                let feedbackText = '<p class="font-bold mb-2">Not quite right. Here\'s what to fix:</p>';
                if (!correctOrder) {
                    feedbackText += '<p class="text-orange-600">• The correct order of stages is: Fetch → Decode → Execute</p>';
                }
                if (!correctMatches) {
                    feedbackText += '<p class="text-orange-600">• Make sure each action (description) matches its correct stage.</p>';
                }
                feedback.innerHTML = feedbackText;
            }
        }

        // --- CPU Specification Revealer ---
        function revealSpec(type) {
            if (!xpTracking.specsRevealed.includes(type)) {
                xpTracking.specsRevealed.push(type);
                addXP(10);
                const reveal = document.getElementById(type + 'Reveal');
                if (reveal) {
                    reveal.classList.remove('hidden');
                    const button = reveal.parentElement.querySelector('button');
                    if (button) button.style.display = 'none';
                }
            }
        }

        // --- PC Build Checker ---
        function checkPCBuild() {
            if (xpTracking.pcBuildCompleted) {
                showModal('Already Completed', 'You have already completed the PC build!');
                return;
            }
            const zones = document.querySelectorAll('.drop-zone[data-answer]');
            let correct = 0;
            zones.forEach(zone => {
                const cpu = zone.querySelector('[data-cpu]');
                if (cpu && cpu.dataset.cpu === zone.dataset.answer) {
                    correct++;
                    zone.style.backgroundColor = '#dcfce7'; 
                } else if (cpu) {
                    zone.style.backgroundColor = '#fee2e2'; 
                } else {
                    zone.style.backgroundColor = ''; 
                }
            });
            if (correct === 3) {
                xpTracking.pcBuildCompleted = true;
                addXP(50);
                unlockAchievement('builder');
                showModal('Build Complete!', 'Perfect! You matched all CPUs to their ideal use cases!');
            } else {
                showModal('Incorrect Build', `${correct}/3 correct. Think about what each use case needs! Review the specs and try again.`);
            }
        }

        // --- Performance Understanding Check ---
        function checkPerformanceAnswers() {
            if (xpTracking.performanceCompleted) {
                showModal('Already Completed', 'You have already completed the performance quiz!');
                return;
            }
            const clockSpeedAnswer = document.getElementById('clockSpeedAnswer').value.trim().toLowerCase();
            const coresAnswer = document.getElementById('coresAnswer').value.trim().toLowerCase();
            const cacheAnswer = document.getElementById('cacheAnswer').value.trim().toLowerCase();
            const clockSpeedChoice = document.querySelector('input[name="clockSpeed"]:checked');
            const coreTaskChoice = document.querySelector('input[name="coreTask"]:checked');
            const cacheSpeedChoice = document.querySelector('input[name="cacheSpeed"]:checked');
            const feedback = document.getElementById('performanceFeedback');
            let score = 0;
            let feedbackText = '<h3 class="font-bold mb-3">Your Results:</h3><ul class="list-disc list-inside space-y-1">';
            if (clockSpeedAnswer.includes('cycle') || clockSpeedAnswer.includes('instruction') || clockSpeedAnswer.includes('per second') || clockSpeedAnswer.includes('hertz') || clockSpeedAnswer.includes('ghz')) {
                score++;
                feedbackText += '<li class="text-green-600">✅ Clock speed explanation is good!</li>';
            } else {
                feedbackText += '<li class="text-orange-600">⚠️ Clock speed: Mention cycles per second (Hz/GHz) or how many instructions can be processed.</li>';
            }
            if (clockSpeedChoice && clockSpeedChoice.value === 'b') {
                score++;
                feedbackText += '<li class="text-green-600">✅ Correct! Higher clock speed generally means faster processing for relevant tasks.</li>';
            } else {
                feedbackText += '<li class="text-orange-600">⚠️ CPU B (4.0 GHz) would be faster for single-threaded tasks, assuming other factors are equal.</li>';
            }
            if (coresAnswer.includes('parallel') || coresAnswer.includes('multiple') || coresAnswer.includes('task') || coresAnswer.includes('simultaneous')) {
                score++;
                feedbackText += '<li class="text-green-600">✅ Good understanding of CPU cores!</li>';
            } else {
                feedbackText += '<li class="text-orange-600">⚠️ Cores: Mention parallel processing or handling multiple tasks simultaneously.</li>';
            }
            if (coreTaskChoice && coreTaskChoice.value === 'video') {
                score++;
                feedbackText += '<li class="text-green-600">✅ Correct! Video rendering benefits greatly from multiple cores.</li>';
            } else {
                feedbackText += '<li class="text-orange-600">⚠️ Video rendering is a task that can effectively use many cores for parallel processing.</li>';
            }
            if (cacheAnswer.includes('fast') || cacheAnswer.includes('quick') || cacheAnswer.includes('frequently') || cacheAnswer.includes('temporary') || cacheAnswer.includes('storage')) {
                score++;
                feedbackText += '<li class="text-green-600">✅ Good understanding of cache!</li>';
            } else {
                feedbackText += '<li class="text-orange-600">⚠️ Cache: Mention it\'s a small, fast memory that stores frequently used data for quick access.</li>';
            }
            if (cacheSpeedChoice && cacheSpeedChoice.value === 'location') {
                score++;
                feedbackText += '<li class="text-green-600">✅ Correct! Cache is faster because it\'s built into or very close to the CPU.</li>';
            } else {
                feedbackText += '<li class="text-orange-600">⚠️ Cache is faster primarily because it\'s physically inside or very close to the CPU chip, reducing latency.</li>';
            }
            feedbackText += '</ul>';
            if (score >= 5) { 
                feedback.innerHTML = '<p class="text-green-600 font-bold text-lg mb-2">🎉 Excellent! You understand CPU performance factors!</p>' + feedbackText;
                xpTracking.performanceCompleted = true;
                unlockAchievement('performance');
                addXP(60);
            } else {
                feedback.innerHTML = feedbackText; 
                addXP(score * 5); 
            }
        }

        // --- Embedded Systems Check ---
        function checkEmbeddedDefinition() {
            if (xpTracking.embeddedDefinitionCompleted) {
                showModal('Already Checked', 'You have already checked your definition!');
                return;
            }
            const definition = document.getElementById('embeddedDefinition').value.trim().toLowerCase();
            const feedback = document.getElementById('embeddedFeedback');
            const keywords = ['dedicated', 'specific', 'function', 'built-in', 'single purpose', 'task', 'within a larger system'];
            let score = 0;
            keywords.forEach(keyword => {
                if (definition.includes(keyword.replace(' ', ''))) score++; 
                else if (definition.includes(keyword)) score++;
            });
            xpTracking.embeddedDefinitionCompleted = true;
            if (score >= 2) {
                feedback.innerHTML = '<p class="text-green-600 font-bold">✅ Great! An embedded system is a computer system with a dedicated function, often within a larger mechanical or electrical system.</p>';
                addXP(25);
            } else {
                feedback.innerHTML = '<p class="text-blue-600">Try mentioning that it\'s a computer designed for a specific purpose or dedicated function, often as part of a larger device.</p>';
                addXP(10);
            }
        }

        function checkCarSystems() {
            if (xpTracking.carSystemsCompleted) {
                showModal('Already Checked', 'You have already checked your car systems!');
                return;
            }
            const systemsList = document.getElementById('carSystemsList').value.trim().toLowerCase();
            const feedback = document.getElementById('carSystemsFeedback');
            const commonSystems = ['engine control', 'ecu', 'abs', 'anti-lock braking', 'airbag', 'parking sensor', 'cruise control', 'climate control', 'gps', 'navigation', 'infotainment', 'entertainment', 'traction control', 'stability control', 'tpms', 'tire pressure'];
            let found = 0;
            const listedItems = systemsList.split('\n').map(item => item.trim()).filter(item => item.length > 0);
            listedItems.forEach(item => {
                if (commonSystems.some(cs => item.includes(cs))) {
                    found++;
                }
            });
            xpTracking.carSystemsCompleted = true;
            let feedbackText = '';
            if (found >= 4) {
                feedbackText = '<p class="text-green-600 font-bold">🎉 Excellent! You found many embedded systems!</p>';
                feedbackText += '<p class="mt-2 text-sm">Common car embedded systems include: Engine Control Unit (ECU), Anti-lock Braking System (ABS), Airbag control, Parking sensors, Cruise control, Climate control, Navigation system (GPS), Infotainment system, Traction control, and Electronic Stability Control (ESC).</p>';
                addXP(50);
            } else {
                feedbackText = `<p class="text-blue-600">Good start! You found ${found} systems. Try thinking about safety features (like ABS, airbags), comfort features (climate control, infotainment), and engine/vehicle management systems (ECU).</p>`;
                addXP(found * 10);
            }
            feedback.innerHTML = feedbackText;
        }

        // --- Exam Question Checking ---
        function checkExamAnswer(questionNum) {
            if (xpTracking.examQuestionsViewed.includes(questionNum)) {
                showModal('Mark Scheme Viewed', 'You have already viewed the mark scheme for this question!');
                return;
            }
            const answer = document.getElementById(`q${questionNum}-answer`).value.trim();
            const marks = document.getElementById(`q${questionNum}-marks`).value;
            const markscheme = document.getElementById(`q${questionNum}-markscheme`);
            if (answer.length < 30) { 
                showModal('Answer Too Short', 'Please write a more detailed answer before viewing the mark scheme. Aim for at least a couple of detailed sentences.');
                return;
            }
            const wordCount = answer.split(/\s+/).filter(word => word.length > 0).length;
            if (wordCount < 10) { 
                showModal('Answer Too Short', 'Your answer is too short. Please provide more detail (at least 10 words).');
                return;
            }
            const words = answer.toLowerCase().split(/\s+/);
            const uniqueWords = new Set(words);
            const repetitionRatio = uniqueWords.size / words.length;
            if (repetitionRatio < 0.3 && words.length > 10) { 
                showModal('Repetitive Text', 'Your answer appears to contain too much repetitive text. Please write a meaningful response.');
                return;
            }
            const gibberishPatterns = [
                /(.)\1{4,}/, /(asdf|qwerty|zxcv|hjkl|ghjk|dfgh|sdfg|wert|erty|rtyu|tyui|yuio|uiop)/i, 
                /^[^a-z0-9\s]{10,}$/i, /(abc|xyz|123|789|000|111|222|333|444|555|666|777|888|999)/i, 
                /^(.{1,3})\1{5,}$/i, 
            ];
            let isGibberish = false;
            for (let pattern of gibberishPatterns) {
                if (pattern.test(answer)) {
                    isGibberish = true;
                    break;
                }
            }
            const avgWordLength = answer.replace(/\s+/g, '').length / wordCount;
            if (avgWordLength > 20 && wordCount > 5) { 
                isGibberish = true;
            }
            if (isGibberish) {
                showModal('Invalid Answer', 'Please write a meaningful answer related to the question, not random text or gibberish.');
                return;
            }
            if (!marks) {
                showModal('Self-Assess First', 'Please self-assess how many marks you think you earned before viewing the mark scheme.');
                return;
            }
            markscheme.classList.remove('hidden');
            xpTracking.examQuestionsViewed.push(questionNum);
            const button = document.querySelector(`button[onclick="checkExamAnswer(${questionNum})"]`);
            if (button) {
                button.disabled = true;
                button.textContent = 'Mark Scheme Shown';
                button.classList.remove('bg-red-500', 'hover:bg-red-600');
                button.classList.add('bg-gray-400', 'cursor-not-allowed');
            }
            addXP(20);
        }

        function getWritingMetrics(questionNum) {
            const answer = document.getElementById(`q${questionNum}-answer`).value.trim();
            if (answer.length < 20) {
                showModal('Answer Too Short', 'Please write more (at least 20 characters) before checking your writing quality.');
                return;
            }
            const metrics = calculateWritingMetrics(answer);
            let metricsDiv = document.getElementById(`q${questionNum}-metrics`);
            if (!metricsDiv) {
                metricsDiv = document.createElement('div');
                metricsDiv.id = `q${questionNum}-metrics`;
                metricsDiv.className = 'mt-4 p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border border-green-200';
                const button = document.querySelector(`button[onclick="getWritingMetrics(${questionNum})"]`);
                button.insertAdjacentElement('afterend', metricsDiv);
            }
            metricsDiv.innerHTML = `
                <h4 class="font-bold text-green-700 mb-3">Writing Quality Metrics (Year 9 Level)</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white p-3 rounded shadow">
                        <p class="text-sm font-semibold text-gray-700">Word Count</p>
                        <p class="text-2xl font-bold ${metrics.wordCount >= 30 ? 'text-green-600' : 'text-orange-600'}">${metrics.wordCount}</p>
                        <p class="text-xs text-gray-500">Target: 30-100 words</p>
                    </div>
                    <div class="bg-white p-3 rounded shadow">
                        <p class="text-sm font-semibold text-gray-700">Sentence Count</p>
                        <p class="text-2xl font-bold ${metrics.sentenceCount >= 3 ? 'text-green-600' : 'text-orange-600'}">${metrics.sentenceCount}</p>
                        <p class="text-xs text-gray-500">Target: 3-6 sentences</p>
                    </div>
                    <div class="bg-white p-3 rounded shadow">
                        <p class="text-sm font-semibold text-gray-700">Avg. Sentence Length</p>
                        <p class="text-2xl font-bold ${metrics.avgSentenceLength >= 8 && metrics.avgSentenceLength <= 20 ? 'text-green-600' : 'text-orange-600'}">${metrics.avgSentenceLength}</p>
                        <p class="text-xs text-gray-500">Target: 8-20 words</p>
                    </div>
                    <div class="bg-white p-3 rounded shadow">
                        <p class="text-sm font-semibold text-gray-700">Vocabulary Variety</p>
                        <p class="text-2xl font-bold ${metrics.vocabularyScore >= 60 ? 'text-green-600' : 'text-orange-600'}">${metrics.vocabularyScore}%</p>
                        <p class="text-xs text-gray-500">Unique words used</p>
                    </div>
                </div>
                <div class="mt-4 bg-white p-3 rounded shadow">
                    <p class="text-sm font-semibold text-gray-700 mb-2">Technical Terms Used</p>
                    <div class="flex flex-wrap gap-2">
                        ${metrics.technicalTerms.length > 0 
                            ? metrics.technicalTerms.map(term => `<span class="bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-medium">${term}</span>`).join('')
                            : '<span class="text-gray-500 text-sm">No specific technical terms found.</span>'}
                    </div>
                </div>
                <div class="mt-4 bg-white p-3 rounded shadow">
                    <p class="text-sm font-semibold text-gray-700 mb-2">Overall Writing Score</p>
                    <div class="w-full bg-gray-200 rounded-full h-6 overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-green-400 to-green-600 rounded-full flex items-center justify-center text-white text-sm font-bold transition-all duration-500" style="width: ${metrics.overallScore}%">
                            ${metrics.overallScore}%
                        </div>
                    </div>
                    <p class="text-xs text-gray-600 mt-2">${metrics.feedback}</p>
                </div>
                <div class="mt-3 text-xs text-gray-600">
                    <p><strong>Tips for Year 9 writing:</strong></p>
                    <ul class="list-disc list-inside mt-1 space-y-0.5">
                        <li>Use technical vocabulary from your lessons.</li>
                        <li>Write in complete sentences with correct punctuation.</li>
                        <li>Explain your points clearly and provide examples if needed.</li>
                        <li>Aim for 3-6 well-developed sentences per answer for these types of questions.</li>
                    </ul>
                </div>`;
        }
        
        function calculateWritingMetrics(text) {
            const words = text.split(/\s+/).filter(word => word.length > 0);
            const wordCount = words.length;
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 5); 
            const sentenceCount = Math.max(1, sentences.length); 
            const avgSentenceLength = wordCount > 0 ? Math.round(wordCount / sentenceCount) : 0;
            const uniqueWords = new Set(words.map(w => w.toLowerCase().replace(/[^a-z0-9']/g, ''))); 
            const vocabularyScore = wordCount > 0 ? Math.round((uniqueWords.size / wordCount) * 100) : 0;
            const technicalKeywords = [
                'cpu', 'processor', 'fetch', 'decode', 'execute', 'cycle', 'instruction',
                'clock speed', 'ghz', 'hertz', 'core', 'cores', 'cache', 'performance', 'parallel',
                'embedded system', 'memory', 'ram', 'turbo boost', 'multitasking', 'alu', 'control unit',
                'register', 'motherboard', 'von neumann'
            ];
            const technicalTerms = [];
            const lowerText = text.toLowerCase();
            technicalKeywords.forEach(term => {
                if (lowerText.includes(term)) {
                    technicalTerms.push(term);
                }
            });
            let score = 0;
            if (wordCount >= 30 && wordCount <= 120) score += 25;
            else if (wordCount >= 15 && wordCount <= 150) score += 15;
            else if (wordCount >= 10) score += 10;
            if (sentenceCount >= 3 && sentenceCount <= 7) score += 25;
            else if (sentenceCount >= 2 && sentenceCount <= 10) score += 15;
            else if (sentenceCount >= 1) score += 10;
            if (avgSentenceLength >= 8 && avgSentenceLength <= 22) score += 25;
            else if (avgSentenceLength >= 5 && avgSentenceLength <= 28) score += 15;
            else if (avgSentenceLength > 0) score += 10;
            const techScore = Math.min(25, technicalTerms.length * 4); 
            score += techScore;
            score = Math.min(100, Math.max(0, score)); 
            let feedback = '';
            if (score >= 85) feedback = 'Excellent writing for Year 9! Well structured with strong technical vocabulary and clear explanations.';
            else if (score >= 70) feedback = 'Very good writing! Your answer is clear and uses some technical terms well. Try to expand on your points a little more.';
            else if (score >= 50) feedback = 'Good effort! Your writing is generally understandable. Focus on using more precise technical vocabulary and ensuring your sentences are well-formed.';
            else if (score >= 30) feedback = 'Keep improving! Try to write in complete sentences, use more vocabulary from the lesson, and explain your ideas more clearly.';
            else feedback = 'More practice needed. Remember to write in full sentences, use relevant keywords, and explain your points in detail.';
            return {
                wordCount, sentenceCount, avgSentenceLength, vocabularyScore,
                technicalTerms: [...new Set(technicalTerms)], 
                overallScore: score, feedback
            };
        }

        // --- Overclocking Simulator ---
        const OC_CONFIG = {
            baseClock: 3.5, 
            baseVoltage: 1.20,
            baseTemp: 35, 
            maxSafeTemp: 90, 
            criticalTemp: 100, // System crashes at or above this temp
            cooling: { 
                stock:  { capacity: 5,  efficiencyDropFactor: 0.3, name: "Stock Cooler" }, 
                air:    { capacity: 25, efficiencyDropFactor: 0.75, name: "Tower Air Cooler" },
                liquid: { capacity: 65, efficiencyDropFactor: 0.95, name: "Liquid Cooler" } 
            },
            clockHeatMultiplier: 18,  
            voltageHeatMultiplier: 60, 
            clockExponent: 1.45, 
            voltageExponent: 1.75, 

            performanceLevels: {
                3.0: "Low", 3.5: "Nominal", 4.0: "Good",
                4.5: "High", 5.0: "Extreme", 5.5: "Max Dial"
            },
            stabilityThresholds: { 
                idealTemp: 55, 
                tempPenaltyThreshold: 70, 
                tempPenaltyFactor: 0.025,  // Tuned penalty factor
                voltagePoints:  [1.10, 1.15, 1.20, 1.25, 1.30, 1.35, 1.40, 1.45, 1.50],
                maxClocksIdeal: [3.5,  3.7,  3.9,  4.1,  4.3,  4.5,  4.7,  4.9,  5.0 ], 
                coolerStabilityFactor: { 
                    stock: 0.75, 
                    air:   0.92,
                    liquid:1.0
                }
            }
        };

        let ocState = {
            currentClock: OC_CONFIG.baseClock,
            currentVoltage: OC_CONFIG.baseVoltage,
            currentTemp: OC_CONFIG.baseTemp,
            selectedCooler: 'stock',
            isStable: true,
            isCrashed: false
        };

        // DOM Elements for Overclocking Sim
        let coolerSelect, clockSlider, voltageSlider, clockValueDisp, voltageValueDisp,
            tempGaugeFill, tempValueDisp, performanceValueDisp, stabilityValueDisp,
            cpuVisual, applyBtn, resetBtn, overclockFeedbackDisp;
        
        // Function definitions moved up for clarity and to avoid potential hoisting issues
        function calculateTemperature() {
            const clockDelta = Math.max(0, ocState.currentClock - OC_CONFIG.baseClock); 
            const voltageDelta = Math.max(0, ocState.currentVoltage - OC_CONFIG.baseVoltage); 

            let heatFromClock = Math.pow(clockDelta * 10, OC_CONFIG.clockExponent) * (OC_CONFIG.clockHeatMultiplier / 10); 
            let heatFromVoltage = Math.pow(voltageDelta * 100, OC_CONFIG.voltageExponent) * (OC_CONFIG.voltageHeatMultiplier / 100);
            
            let totalRawHeat = heatFromClock + heatFromVoltage;
            
            if (ocState.selectedCooler === 'stock' && (clockDelta > 0.1 || voltageDelta > 0.02)) { // More sensitive for stock
                totalRawHeat *= 2.0; // Stock cooler really struggles with any OC
            } else if (ocState.selectedCooler === 'air' && (clockDelta > 0.5 || voltageDelta > 0.1)) {
                totalRawHeat *= 1.2; // Air cooler starts to struggle more with moderate OC
            }


            const coolerDetails = OC_CONFIG.cooling[ocState.selectedCooler];
            let effectiveCooling = coolerDetails.capacity;

            const overloadFactor = totalRawHeat / (coolerDetails.capacity + 1e-6); 
            if (overloadFactor > 1.2) { // Lowered overload threshold slightly
                effectiveCooling *= Math.max(0.05, coolerDetails.efficiencyDropFactor * (1 - (overloadFactor - 1.2))); // Steeper dropoff
            }
            
            let netHeatGain = totalRawHeat - effectiveCooling;
            ocState.currentTemp = Math.max(20, Math.round(OC_CONFIG.baseTemp + netHeatGain));
        }

        function getPerformanceLevel() {
            // Performance is N/A if crashed, or reduced if unstable even if not crashed.
            if (ocState.isCrashed) return "CRASHED";
            if (!ocState.isStable) return "Unstable"; // Performance suffers greatly if unstable

            let level = "Low";
            for (const clock in OC_CONFIG.performanceLevels) {
                if (ocState.currentClock >= parseFloat(clock)) {
                    level = OC_CONFIG.performanceLevels[clock];
                } else {
                    break;
                }
            }
            return level;
        }
        
        function updateSimulationDisplay(isFinalUpdate = false) {
            // If crashed from a previous apply, lock the display elements and show crashed state
            if (ocState.isCrashed) { 
                tempValueDisp.textContent = ocState.currentTemp; // Show final crash temp
                const tempPercentCrash = Math.min(100, Math.max(0, (ocState.currentTemp / OC_CONFIG.criticalTemp) * 100));
                tempGaugeFill.style.height = `${tempPercentCrash}%`;
                tempGaugeFill.style.backgroundColor = '#7f1d1d'; // Critical Red Darker
                
                cpuVisual.textContent = "💀";
                cpuVisual.classList.add('crashed');
                cpuVisual.classList.remove('overheating');
                
                performanceValueDisp.textContent = "CRASHED";
                performanceValueDisp.className = "font-bold text-red-700";
                stabilityValueDisp.textContent = "CRASHED!";
                stabilityValueDisp.className = "font-bold text-red-700 animate-pulse";
                overclockFeedbackDisp.textContent = "System CRASHED due to extreme conditions!";
                return; // Stop further updates if crashed
            }
            
            calculateTemperature(); // Always calculate temp first for previews

            clockValueDisp.textContent = ocState.currentClock.toFixed(1);
            voltageValueDisp.textContent = ocState.currentVoltage.toFixed(2);
            tempValueDisp.textContent = ocState.currentTemp;
            
            const tempPercent = Math.min(100, Math.max(0, (ocState.currentTemp / OC_CONFIG.criticalTemp) * 100));
            tempGaugeFill.style.height = `${tempPercent}%`;

            if (ocState.currentTemp >= OC_CONFIG.criticalTemp) {
                tempGaugeFill.style.backgroundColor = '#7f1d1d'; 
            } else if (ocState.currentTemp >= OC_CONFIG.maxSafeTemp) {
                tempGaugeFill.style.backgroundColor = '#dc2626'; 
            } else if (ocState.currentTemp >= 75) { 
                tempGaugeFill.style.backgroundColor = '#f97316'; 
            } else if (ocState.currentTemp >= 60) {
                tempGaugeFill.style.backgroundColor = '#facc15'; 
            } else {
                tempGaugeFill.style.backgroundColor = '#34d399'; 
            }

            cpuVisual.textContent = "🧠"; // Reset icon before potential update
            cpuVisual.classList.remove('crashed', 'overheating');
            if (ocState.currentTemp > 85) { 
                 cpuVisual.classList.add('overheating');
                 cpuVisual.style.backgroundColor = `rgba(255, ${Math.max(0, 150 - (ocState.currentTemp - 85) * 7)}, 0, 0.7)`; 
            } else if (ocState.currentTemp > 70) {
                 cpuVisual.style.backgroundColor = `rgba(255, ${Math.max(150, 255 - (ocState.currentTemp - 70)*5)}, 100, 0.5)`; 
            } else {
                 cpuVisual.style.backgroundColor = '#d1d5db'; 
            }

            if (isFinalUpdate) { // Called after "Apply & Test"
                const perfLevelText = getPerformanceLevel(); 
                performanceValueDisp.textContent = perfLevelText;
                if (perfLevelText === "CRASHED" || perfLevelText === "Unstable") performanceValueDisp.className = "font-bold text-red-700";
                else if (perfLevelText === "Extreme" || perfLevelText === "Max Dial") performanceValueDisp.className = "font-bold text-red-600";
                else if (perfLevelText === "High") performanceValueDisp.className = "font-bold text-orange-500";
                else performanceValueDisp.className = "font-bold text-green-600";

                if (ocState.isStable && ocState.currentTemp < OC_CONFIG.maxSafeTemp) {
                    stabilityValueDisp.textContent = "Stable";
                    stabilityValueDisp.className = "font-bold text-green-600";
                } else if (ocState.isStable && ocState.currentTemp >= OC_CONFIG.maxSafeTemp) {
                    stabilityValueDisp.textContent = "Hot but Stable";
                    stabilityValueDisp.className = "font-bold text-yellow-500";
                } else { // Unstable
                    stabilityValueDisp.textContent = "Unstable";
                    stabilityValueDisp.className = "font-bold text-orange-500";
                }
                // overclockFeedbackDisp is set by checkStability
            } else { // Preview mode (slider input)
                performanceValueDisp.textContent = "Preview...";
                performanceValueDisp.className = "font-bold text-gray-500";
                stabilityValueDisp.textContent = "Pending Test...";
                stabilityValueDisp.className = "font-bold text-gray-500";
                overclockFeedbackDisp.textContent = "Adjust settings and Apply to test.";
            }
        }

        function checkStability() {
            if (ocState.currentTemp >= OC_CONFIG.criticalTemp) {
                ocState.isStable = false;
                ocState.isCrashed = true; 
                return false; 
            }

            let voltageIndex = OC_CONFIG.stabilityThresholds.voltagePoints.findIndex(v => v >= ocState.currentVoltage);
            if (voltageIndex === -1) voltageIndex = OC_CONFIG.stabilityThresholds.voltagePoints.length - 1;
            else if (voltageIndex === 0 && ocState.currentVoltage < OC_CONFIG.stabilityThresholds.voltagePoints[0]) voltageIndex = 0;

            let maxClockForVoltage = OC_CONFIG.stabilityThresholds.maxClocksIdeal[voltageIndex];

            if (ocState.currentTemp > OC_CONFIG.stabilityThresholds.idealTemp) {
                const tempExcess = ocState.currentTemp - OC_CONFIG.stabilityThresholds.idealTemp;
                maxClockForVoltage -= tempExcess * OC_CONFIG.stabilityThresholds.tempPenaltyFactor;
            }
            
            maxClockForVoltage *= OC_CONFIG.stabilityThresholds.coolerStabilityFactor[ocState.selectedCooler];
            maxClockForVoltage = Math.max(OC_CONFIG.baseClock - 0.5, maxClockForVoltage); 

            if (ocState.currentClock > maxClockForVoltage + 0.05) { 
                ocState.isStable = false;
                overclockFeedbackDisp.textContent = "System unstable! Settings too aggressive for current setup.";
            } else if (ocState.currentTemp >= OC_CONFIG.maxSafeTemp) {
                ocState.isStable = true; 
                overclockFeedbackDisp.textContent = "Warning: CPU is VERY HOT! High risk of instability or damage.";
            } else {
                ocState.isStable = true;
                overclockFeedbackDisp.textContent = "Overclock applied. System appears stable.";
                if (ocState.currentClock >= 4.9 && ocState.selectedCooler === 'liquid' && ocState.isStable && !xpTracking.overclockStableHigh) {
                    unlockAchievement('overclocker');
                    xpTracking.overclockStableHigh = true;
                    addXP(30); 
                } else if (ocState.currentClock >= 4.3 && ocState.selectedCooler === 'air' && ocState.isStable && !xpTracking.overclockStableHigh) {
                     addXP(15); 
                     if(ocState.currentClock >= 4.5) { 
                        unlockAchievement('overclocker');
                        xpTracking.overclockStableHigh = true;
                     }
                }
            }
            return ocState.isStable;
        }
        
        function applyAndTestOverclock() {
            applyBtn.disabled = true; 
            applyBtn.classList.add('opacity-50', 'cursor-not-allowed');

            if (ocState.isCrashed) { 
                showModal("System Crashed", "Please reset the simulation before trying again.");
                applyBtn.disabled = false;
                applyBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                return;
            }
            
            calculateTemperature(); // Ensure temp is based on final slider values
            checkStability();     // Determine stability and if it crashed due to temp

            if(ocState.isCrashed) { // If checkStability led to a crash
                updateSimulationDisplay(true); // Show crashed state immediately
                showModal("SYSTEM CRASH!", "CPU CRASHED! Conditions exceeded safe limits. Resetting...");
                setTimeout(() => {
                    resetOverclockSimulation(); 
                }, 2500); 
            } else {
                // If not crashed, update the display to show the outcome of the stability test
                updateSimulationDisplay(true);
                applyBtn.disabled = false; 
                applyBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
            
            if (!xpTracking.overclockInteracted) {
                xpTracking.overclockInteracted = true;
                addXP(10); 
            } else {
                addXP(5); 
            }
        }

        function resetOverclockSimulation() {
            ocState.currentClock = OC_CONFIG.baseClock;
            ocState.currentVoltage = OC_CONFIG.baseVoltage;
            ocState.selectedCooler = 'stock'; 
            ocState.isStable = true;
            ocState.isCrashed = false; 
            applyBtn.disabled = false; 
            applyBtn.classList.remove('opacity-50', 'cursor-not-allowed');


            clockSlider.value = ocState.currentClock;
            voltageSlider.value = ocState.currentVoltage;
            coolerSelect.value = ocState.selectedCooler; 
            
            calculateTemperature(); // Calculate initial temp for base settings
            
            // Directly set stability and performance for reset state
            stabilityValueDisp.textContent = "Stable";
            stabilityValueDisp.className = "font-bold text-green-600";
            performanceValueDisp.textContent = getPerformanceLevel(); // Base performance
            performanceValueDisp.className = "font-bold text-green-600";
            overclockFeedbackDisp.textContent = "Settings reset. Choose cooler and adjust sliders.";

            updateSimulationDisplay(true); // Update all visuals
        }

        function initializeOverclockSimulator() {
            coolerSelect = document.getElementById('coolerType');
            clockSlider = document.getElementById('clockSpeedSlider');
            voltageSlider = document.getElementById('voltageSlider');
            clockValueDisp = document.getElementById('clockSpeedValue');
            voltageValueDisp = document.getElementById('voltageValue');
            tempGaugeFill = document.getElementById('tempGaugeFill');
            tempValueDisp = document.getElementById('tempValue');
            performanceValueDisp = document.getElementById('performanceValue');
            stabilityValueDisp = document.getElementById('stabilityValue');
            cpuVisual = document.getElementById('cpuVisualElement');
            applyBtn = document.getElementById('applyOverclockBtn');
            resetBtn = document.getElementById('resetOverclockBtn');
            overclockFeedbackDisp = document.getElementById('overclockFeedback');

            coolerSelect.addEventListener('change', (e) => {
                ocState.selectedCooler = e.target.value;
                if (!xpTracking.overclockInteracted) { addXP(5); xpTracking.overclockInteracted = true; }
                updateSimulationDisplay(false); 
            });
            clockSlider.addEventListener('input', (e) => {
                ocState.currentClock = parseFloat(e.target.value);
                if (!xpTracking.overclockInteracted) { addXP(5); xpTracking.overclockInteracted = true; }
                updateSimulationDisplay(false); 
            });
            voltageSlider.addEventListener('input', (e) => {
                ocState.currentVoltage = parseFloat(e.target.value);
                 if (!xpTracking.overclockInteracted) { addXP(5); xpTracking.overclockInteracted = true; }
                updateSimulationDisplay(false); 
            });
            applyBtn.addEventListener('click', applyAndTestOverclock);
            resetBtn.addEventListener('click', resetOverclockSimulation);

            resetOverclockSimulation(); 
        }
    </script>
</body>
</html>
