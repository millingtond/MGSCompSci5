<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Security Academy - Threat Defense Training</title>
    <style>
        :root {
            --primary-color: #1a1a2e;
            --secondary-color: #16213e;
            --accent-color: #e94560;
            --highlight-color: #ff6b6b;
            --text-color: #eee;
            --success-color: #27ae60;
            --warning-color: #e74c3c;
            --dark-bg: #0f3460;
            --darker-bg: #0a0a0a;
            --info-bg: #1e293b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* General Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            animation: fadeIn 0.3s;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--dark-bg);
            padding: 30px;
            border: 3px solid var(--accent-color);
            width: 90%;
            max-width: 600px;
            border-radius: 15px;
            box-shadow: 0 5px 30px rgba(233, 69, 96, 0.3);
            animation: slideIn 0.5s;
            text-align: center;
        }
        
        .modal-content h2 {
            color: var(--accent-color);
            margin-bottom: 20px;
        }

        .modal-content p {
            line-height: 1.8;
            margin-bottom: 25px;
            white-space: pre-wrap;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Header Styles */
        .header {
            background: var(--dark-bg);
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 15px rgba(233, 69, 96, 0.3);
            position: relative;
            border-bottom: 3px solid var(--accent-color);
        }

        .header h1 {
            color: var(--accent-color);
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
        }

        .header .subtitle {
            color: #aaa;
            font-size: 1.2em;
        }

        .reset-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .reset-btn:hover {
            background: #c13651;
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 0 15px rgba(233, 69, 96, 0.5);
        }

        /* Progress Bar */
        .progress-container {
            width: 90%;
            max-width: 800px;
            height: 35px;
            background: rgba(255,255,255,0.1);
            border: 2px solid var(--accent-color);
            border-radius: 20px;
            margin: 20px auto;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--highlight-color));
            width: 0%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            font-size: 1.1em;
        }

        /* Academy Container */
        .academy-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .mission {
            display: none;
            background: var(--dark-bg);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 25px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s;
            border: 2px solid var(--accent-color);
        }

        .mission.active {
            display: block;
        }

        .mission h2 {
            color: var(--accent-color);
            margin-bottom: 20px;
            font-size: 2em;
            text-shadow: 0 0 10px rgba(233, 69, 96, 0.3);
        }

        /* Malware Grid */
        .malware-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .malware-card {
            background: var(--secondary-color);
            border: 2px solid #333;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .malware-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.3);
            border-color: var(--accent-color);
        }

        .malware-card.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--highlight-color);
        }

        .malware-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .malware-details {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid rgba(255,255,255,0.2);
            text-align: left;
            font-size: 0.9em;
        }

        .malware-card.active .malware-details {
            display: block;
        }

        /* Phishing Simulator */
        .email-container {
            background: #f5f5f5;
            color: #333;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .email-header {
            border-bottom: 2px solid #ddd;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }

        .email-field { margin: 5px 0; font-size: 0.9em; }
        .email-field strong { color: #555; }
        .email-body { line-height: 1.6; margin: 20px 0; }

        .phishing-clue {
            cursor: pointer;
            padding: 2px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }
        .phishing-clue:hover {
            background-color: rgba(255, 107, 107, 0.3);
        }
        .phishing-clue.found {
            background: var(--highlight-color);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            cursor: help;
        }

        .clue-reason {
            display: inline-block;
            background: #555;
            color: white;
            padding: 4px 10px;
            border-radius: 5px;
            margin-left: 10px;
            font-size: 0.9em;
            animation: fadeIn 0.5s;
        }

        /* Password Strength Meter */
        .password-tester {
            background: var(--secondary-color);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .password-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            background: var(--dark-bg);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            color: white;
            margin-bottom: 20px;
        }

        .strength-meter {
            height: 30px;
            background: #333;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .strength-bar.weak { background: var(--warning-color); width: 33%; }
        .strength-bar.medium { background: #f39c12; width: 66%; }
        .strength-bar.strong { background: var(--success-color); width: 100%; }
        .crack-time { text-align: center; font-size: 1.2em; margin: 15px 0; color: var(--accent-color); }

        /* Network Visualization */
        .network-visual {
            background: var(--darker-bg);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            position: relative;
            min-height: 400px;
            overflow: hidden;
        }

        .server-node {
            position: absolute;
            width: 100px; height: 100px;
            background: var(--secondary-color);
            border: 3px solid var(--accent-color);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            left: 50%; top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .server-node.under-attack { animation: serverPulse 0.5s infinite; border-color: #ff0000; background: #660000; }
        @keyframes serverPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .attack-packet, .legitimate-packet {
            position: absolute;
            width: 20px; height: 20px;
            border-radius: 50%;
        }
        .attack-packet { background: #ff0000; box-shadow: 0 0 10px #ff0000; }
        .legitimate-packet { background: #00ff00; box-shadow: 0 0 10px #00ff00; }
        
        /* SQL Injection Demo */
        .sql-demo { background: var(--secondary-color); border-radius: 15px; padding: 25px; margin: 20px 0; }
        .sql-form { background: var(--dark-bg); border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .sql-input {
            width: 100%; padding: 10px; margin: 10px 0;
            background: var(--primary-color); border: 2px solid var(--accent-color);
            border-radius: 5px; color: white; font-family: 'Courier New', monospace;
        }
        .sql-query { background: #000; color: #0f0; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; margin: 15px 0; overflow-x: auto; }
        .sql-result { background: var(--darker-bg); border: 2px solid #333; border-radius: 5px; padding: 15px; margin: 15px 0; max-height: 200px; overflow-y: auto; }

        /* Question Box */
        .question-box {
            background: var(--secondary-color);
            border: 2px solid var(--accent-color);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            display: none;
        }
        .question-box h3 { color: var(--accent-color); margin-bottom: 15px; }
        .answer-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-top: 15px; }
        .answer-btn {
            background: var(--dark-bg); border: 2px solid #333; color: var(--text-color);
            padding: 15px; border-radius: 10px; cursor: pointer; transition: all 0.3s;
            font-size: 1em; font-weight: 500;
        }
        .answer-btn:hover:not(:disabled) { background: var(--accent-color); border-color: var(--accent-color); transform: scale(1.05); }
        .answer-btn.correct { background: var(--success-color); color: white; border-color: var(--success-color); animation: correctPulse 0.5s; }
        .answer-btn.incorrect { background: var(--warning-color); color: white; border-color: var(--warning-color); animation: shake 0.5s; }
        @keyframes correctPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }

        /* Achievement */
        .achievement {
            position: fixed; top: 100px; right: -400px;
            background: var(--dark-bg); padding: 20px 30px;
            border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.5);
            transition: right 0.5s; border: 2px solid var(--accent-color);
        }
        .achievement.show { right: 20px; }
        .achievement h4 { color: var(--accent-color); margin-bottom: 5px; }

        /* Button Styles */
        .btn {
            background: var(--accent-color); color: white; border: none;
            padding: 12px 30px; border-radius: 10px; cursor: pointer;
            font-size: 1.1em; font-weight: 500; transition: all 0.3s;
            margin: 10px 5px;
        }
        .btn:hover:not(:disabled) { background: #c13651; transform: scale(1.05); box-shadow: 0 5px 20px rgba(233, 69, 96, 0.3); }
        .btn:disabled { background: #555; cursor: not-allowed; transform: none; }
        .btn.secondary { background: #555; }
        .btn.secondary:hover:not(:disabled) { background: #777; }

        /* Alert & Info Box */
        .alert-box, .info-box {
            border: 2px solid var(--accent-color); border-radius: 10px;
            padding: 20px; margin: 20px 0; position: relative;
        }
        .alert-box.warning { background: #7f1d1d; border-color: #dc2626; }
        .alert-box.success { background: #14532d; border-color: #16a34a; }
        .info-box { background-color: var(--info-bg); border-color: var(--accent-color); margin-top: 30px; }
        .info-box h4 { color: var(--accent-color); margin-bottom: 10px; font-size: 1.2em; }
        .info-box p, .info-box li { color: #ccc; line-height: 1.7; }
        .info-box ul { list-style-position: inside; padding-left: 5px;}

        /* Code Display */
        .code-display {
            background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 5px;
            font-family: 'Courier New', monospace; overflow-x: auto; margin: 15px 0;
        }
        .code-highlight { color: var(--accent-color); font-weight: bold; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            .reset-btn { position: static; transform: none; margin-top: 15px; }
            .malware-grid, .answer-options { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- General Purpose Modal -->
    <div id="modal" class="modal" role="dialog" aria-labelledby="modalTitle" aria-describedby="modalDescription">
        <div class="modal-content">
            <h2 id="modalTitle">Modal Title</h2>
            <p id="modalDescription">Modal description text goes here.</p>
            <div class="modal-buttons">
                 <button class="btn" id="modalConfirmBtn">OK</button>
                 <button class="btn secondary" id="modalCancelBtn">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Achievement Notification -->
    <div id="achievement" class="achievement" role="alert" aria-live="polite">
        <h4>Achievement Unlocked!</h4>
        <p id="achievementText">Great progress!</p>
    </div>

    <!-- Header -->
    <div class="header">
        <h1>🛡️ Cyber Security Academy</h1>
        <p class="subtitle">Threat Defense Training Center</p>
        <button class="reset-btn" id="resetBtn" aria-label="Reset all progress">🔄 Reset Training</button>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
        <div id="progressBar" class="progress-bar">0%</div>
    </div>

    <!-- Academy Container -->
    <div class="academy-container">
        <!-- Mission 1: Malware Analysis Lab -->
        <div id="mission1" class="mission active">
            <h2>🦠 Mission 1: Malware Analysis Lab</h2>
            <p>Malware is software designed to disrupt computer operations or gather sensitive information. Let's analyze some common types.</p>
            <div class="info-box">
                <h4>Threat Intel Briefing</h4>
                <ul>
                    <li><strong>Virus:</strong> A program that replicates itself by embedding its code into other programs. It is designed to corrupt or delete data and requires a host file to spread.</li>
                    <li><strong>Ransomware:</strong> Software that encrypts a victim's files, making them inaccessible. The attacker then demands a ransom payment to provide the decryption key.</li>
                    <li><strong>Spyware:</strong> Gathers information from a user's computer without their knowledge, often by monitoring keystrokes or webcam activity, and relays it back to a third party.</li>
                </ul>
            </div>
            <p style="margin-top: 30px;">Click on each type of malware below to reveal more details.</p>
            <div class="malware-grid"></div>
            <div id="mission1QuestionContainer"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button id="nextBtn1" class="btn" disabled>Next Mission →</button>
            </div>
        </div>

        <!-- Mission 2: Social Engineering Simulator -->
        <div id="mission2" class="mission">
            <h2>🎭 Mission 2: Social Engineering Detection</h2>
            <div class="info-box">
                <h4>Threat Intel Briefing</h4>
                <ul>
                    <li><strong>Social Engineering:</strong> The use of deception to manipulate individuals into divulging confidential or personal information.</li>
                    <li><strong>Phishing:</strong> A common form of social engineering that uses fraudulent emails, appearing to be from reputable companies, to persuade people to reveal sensitive data like passwords or credit card numbers.</li>
                </ul>
            </div>
            <p style="margin-top:30px;">Analyze this email carefully. Click on the parts that seem suspicious to reveal the red flags. Find all 4 to proceed.</p>
            <div class="email-container" id="phishingEmail">
                <div class="email-header">
                    <div class="email-field"><strong>From:</strong> <span class="phishing-clue" data-phishing-reason="Real Amazon uses 'amazon.com', not a look-alike domain with a zero.">security@amaz0n-support.com</span></div>
                    <div class="email-field"><strong>To:</strong> valued.customer@email.com</div>
                    <div class="email-field"><strong>Subject:</strong> <span class="phishing-clue" data-phishing-reason="Attackers create urgency to make you panic and act without thinking.">URGENT: Your Account Will Be Suspended!</span></div>
                </div>
                <div class="email-body">
                    <p>Dear Valued Customer,</p>
                    <p>We have detected suspicious activity on your Amazon account. To prevent permanent suspension, you must verify your account immediately.</p>
                    <p>Click here to verify: <a href="javascript:void(0)" class="phishing-clue" data-phishing-reason="Hovering over (or long-pressing) a link reveals the true destination. Shortened URLs hide this.">http://bit.ly/amazon-verify</a></p>
                    <p>You have 24 hours to complete this verification or your account will be permanently deleted.</p>
                    <p>Thank you,<br><span class="phishing-clue" data-phishing-reason="Professional emails from large companies are almost always proofread. Simple typos are a major red flag.">Amazon Securty Team</span></p>
                </div>
            </div>
            <div id="mission2QuestionContainer"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button id="nextBtn2" class="btn" disabled>Next Mission →</button>
            </div>
        </div>

        <!-- Mission 3: Password Fortress -->
        <div id="mission3" class="mission">
            <h2>🔐 Mission 3: Password Fortress</h2>
             <div class="info-box">
                <h4>Threat Intel Briefing</h4>
                <ul>
                    <li><strong>Brute Force Attack:</strong> An attack that tries every possible password combination, often using a "dictionary" of common passwords, until the correct one is found.</li>
                    <li><strong>Prevention:</strong> Key defenses include using long, complex passwords, enabling Two-Factor Authentication (2FA), and implementing account lockouts after a certain number of failed login attempts.</li>
                </ul>
            </div>
            <p style="margin-top:30px;">Test some passwords below to see how complexity affects the time it would take a brute-force attack to crack them.</p>
            <div class="password-tester">
                <input type="text" class="password-input" id="passwordInput" placeholder="Enter a test password..." oninput="checkPasswordStrength()">
                <div class="strength-meter"><div class="strength-bar" id="strengthBar"></div></div>
                <div class="crack-time" id="crackTime">Enter a password to see its estimated crack time...</div>
            </div>
            <div id="mission3QuestionContainer"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button id="nextBtn3" class="btn" disabled>Next Mission →</button>
            </div>
        </div>

        <!-- Mission 4: Network Defense Center -->
        <div id="mission4" class="mission">
            <h2>🌐 Mission 4: Network Defense Center</h2>
            <div class="info-box">
                 <h4>Threat Intel Briefing</h4>
                <ul>
                    <li><strong>Denial of Service (DoS):</strong> An attack that floods a server with traffic from a single source to overwhelm it and make it unavailable.</li>
                    <li><strong>Distributed DoS (DDoS):</strong> A more powerful attack that uses many compromised "zombie" computers to send excessive requests to a server, causing it to crash or slow down.</li>
                     <li><strong>Data Interception:</strong> When data transmission is read by an unauthorized user, often through "packet sniffing" on insecure networks like public Wi-Fi.</li>
                </ul>
            </div>
            <p style="margin-top:30px;">Observe these network attacks in action. Watch how they try to overwhelm the server.</p>
            <div class="network-visual" id="networkVisual">
                <div class="server-node" id="server"><div style="font-size: 2em;">🖥️</div><small>Server</small></div>
            </div>
            <div style="text-align: center; margin: 20px 0;">
                <button class="btn" onclick="simulateNormalTraffic()">Normal Traffic</button>
                <button class="btn" onclick="simulateDoSAttack()">Simulate DoS Attack</button>
                <button class="btn" onclick="simulateDDoSAttack()">Simulate DDoS Attack</button>
                <button class="btn" onclick="resetNetworkSim()">Reset</button>
            </div>
            <div id="mission4QuestionContainer"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button id="nextBtn4" class="btn" disabled>Next Mission →</button>
            </div>
        </div>

        <!-- Mission 5: Database Security Lab -->
        <div id="mission5" class="mission">
            <h2>💉 Mission 5: SQL Injection Defense</h2>
            <div class="info-box">
                 <h4>Threat Intel Briefing</h4>
                <ul>
                    <li><strong>SQL Injection:</strong> An attack where a hacker inserts malicious SQL statements into an application's input fields. This can trick the database into executing unintended commands, potentially revealing or deleting sensitive data.</li>
                    <li><strong>Prevention:</strong> The best defense is <strong>Input Sanitization</strong>, which involves removing dangerous characters (like quotes and semicolons) from user input so it cannot be executed as code.</li>
                </ul>
            </div>
            <p style="margin-top:30px;">Let's try a simulated SQL Injection attack.</p>
            <div class="sql-demo">
                <h3>Vulnerable Login Form:</h3>
                <div class="sql-form">
                    <p style="margin-bottom:15px;">In a normal login, the server checks if the username AND password match. This attack uses a specially crafted password to change the logic.</p>
                    <p style="margin-bottom:15px;">Try this: for username, enter `admin`. For the password, type the following exactly: <code class="code-highlight">' OR '1'='1</code></p>
                    <input type="text" class="sql-input" id="usernameInput" placeholder="Username">
                    <input type="text" class="sql-input" id="passwordSqlInput" placeholder="Password">
                    <button class="btn" onclick="testSQLInjection()">Login</button>
                </div>
                <div class="sql-query" id="sqlQuery" style="display: none;">
                    <strong>Generated SQL Query:</strong><br>
                    <span id="queryText"></span>
                </div>
                <div class="sql-result" id="sqlResult" style="display: none;">
                    <strong>Result:</strong><br>
                    <span id="resultText"></span>
                </div>
            </div>
            <div id="mission5QuestionContainer"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button id="completeBtn" class="btn" disabled>Complete Training 🏆</button>
            </div>
        </div>
    </div>

    <script>
        'use strict';

        // --- CONFIGURATION & STATE ---
        const CONFIG = {
            TOTAL_MISSIONS: 5,
            ACHIEVEMENT_DISPLAY_TIME: 3000,
        };

        const MALWARE_DATA = [
            { id: 'virus', name: 'Virus', icon: '🦠', details: '<strong>Spreads:</strong> Hidden inside files.<br><strong>Damage:</strong> Corrupts or deletes data.<br><strong>Key trait:</strong> Needs a host file to spread.' },
            { id: 'worm', name: 'Worm', icon: '🐛', details: '<strong>Spreads:</strong> Self-replicating via networks.<br><strong>Damage:</strong> Slows systems, creates backdoors.<br><strong>Key trait:</strong> Spreads without user action.' },
            { id: 'trojan', name: 'Trojan', icon: '🐴', details: '<strong>Spreads:</strong> Disguised as legitimate software.<br><strong>Damage:</strong> Creates backdoors for hackers.<br><strong>Key trait:</strong> Tricks users into installing.' },
            { id: 'ransomware', name: 'Ransomware', icon: '�', details: '<strong>How it works:</strong> Encrypts user files.<br><strong>Damage:</strong> Denies access until ransom paid.<br><strong>Key trait:</strong> Extorts money from victims.' },
            { id: 'spyware', name: 'Spyware', icon: '👁️', details: '<strong>Spreads:</strong> Bundled with free software.<br><strong>Damage:</strong> Steals personal information.<br><strong>Key trait:</strong> Logs keystrokes and activity.' },
            { id: 'pharming', name: 'Pharming', icon: '🎣', details: '<strong>How it works:</strong> Redirects to fake websites.<br><strong>Damage:</strong> Steals login credentials.<br><strong>Key trait:</strong> Modifies DNS entries.' },
        ];
        
        const MISSION_QUESTIONS = {
             1: [
                { 
                    question: "A program disguises itself as a useful photo editor, but once installed, it gives an attacker remote control of your PC. What is this?",
                    options: {trojan: "Trojan", virus: "Virus", worm: "Worm", spyware: "Spyware"},
                    answer: "trojan"
                },
                { 
                    question: "Which type of malware is specifically designed to encrypt a user's files and demand payment for their release?",
                    options: {spyware: "Spyware", ransomware: "Ransomware", trojan: "Trojan", pharming: "Pharming"},
                    answer: "ransomware"
                },
                { 
                    question: "Some malware can spread across a network from computer to computer without any user interaction. This is a key characteristic of a...",
                    options: {virus: "Virus", worm: "Worm", trojan: "Trojan", spyware: "Spyware"},
                    answer: "worm"
                },
                { 
                    question: "You receive an email with a Word document. When you open it, a hidden script runs that corrupts your files. This is a typical delivery method for a...",
                    options: {pharming: "Pharming", ransomware: "Ransomware", virus: "Virus", worm: "Worm"},
                    answer: "virus"
                }
            ],
            2: [{
                question: "What is the primary psychological tactic used in phishing emails?",
                options: {trust: "Exploiting trust and creating a sense of urgency", logic: "Appealing to the user's logic and reason", curiosity: "Making the user curious about a hidden prize", technology: "Assuming the user doesn't understand technology"},
                answer: "trust"
            }],
            3: [{
                question: "What is the single most effective way to make a password resistant to brute-force attacks?",
                options: {long: "Making it longer", personal: "Making it personal", simple: "Making it easy to remember", reusing: "Reusing it on multiple sites"},
                answer: "long"
            }],
            4: [{
                question: "What is the main goal of a DDoS attack?",
                options: {overwhelm: "To make a service unavailable by overwhelming it", steal: "To steal user data as it travels the network", encrypt: "To encrypt server files for a ransom", spy: "To spy on the server's activity"},
                answer: "overwhelm"
            }],
            5: [{
                question: "What is the fundamental vulnerability that SQL injection exploits?",
                options: {trust: "Trusting user input and mixing it with database commands", slow: "A slow database server", password: "A weak administrator password", firewall: "A misconfigured firewall"},
                answer: "trust"
            }]
        };

        const state = {
            mission: 1,
            progress: {1: false, 2: false, 3: false, 4: false, 5: false},
            mission1: { explored: new Set(), currentQuestion: 0, correctAnswers: 0 },
            mission2: { found: new Set() },
            mission3: { tested: false },
            mission4: { observed: false },
            mission5: { tested: false },
            network: { attackActive: false, attackIntervals: [] }
        };

        // --- DOM ELEMENTS CACHE ---
        const DOMElements = {};

        // --- UTILITY FUNCTIONS ---
        function shuffle(array) {
          let currentIndex = array.length, randomIndex;
          while (currentIndex > 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
          }
          return array;
        }

        // --- MODAL DIALOG LOGIC ---
        let modalCallback = null;

        function showModal(title, description, confirmText = 'OK', cancelText = null, callback = null) {
            DOMElements.modal.style.display = 'flex';
            DOMElements.modalTitle.textContent = title;
            DOMElements.modalDescription.innerHTML = description;
            
            DOMElements.modalConfirmBtn.textContent = confirmText;
            DOMElements.modalConfirmBtn.style.display = 'block';

            if (cancelText) {
                DOMElements.modalCancelBtn.textContent = cancelText;
                DOMElements.modalCancelBtn.style.display = 'block';
            } else {
                DOMElements.modalCancelBtn.style.display = 'none';
            }
            modalCallback = callback;
        }

        function handleModalConfirm() {
            if (modalCallback) modalCallback(true);
            closeModal();
        }

        function handleModalCancel() {
            if (modalCallback) modalCallback(false);
            closeModal();
        }

        function closeModal() {
            DOMElements.modal.style.display = 'none';
            modalCallback = null;
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', initializeApp);

        function initializeApp() {
            cacheDOMElements();
            attachEventListeners();
            resetSimulation();
            showModal(
                '🛡️ Welcome to Cyber Security Academy!',
                `Your mission is to understand various cyber threats. Only by understanding these threats can we defend against them!\nComplete all 5 missions to become a Certified Cyber Security Specialist!`,
                'Begin Training'
            );
        }

        function cacheDOMElements() {
            const ids = ['modal', 'modalTitle', 'modalDescription', 'modalConfirmBtn', 'modalCancelBtn', 'achievement', 'achievementText', 'resetBtn', 'progressBar', 'phishingEmail', 'passwordInput', 'strengthBar', 'crackTime', 'networkVisual', 'server', 'usernameInput', 'passwordSqlInput', 'sqlQuery', 'queryText', 'sqlResult', 'resultText', 'completeBtn', 'mission1QuestionContainer', 'mission2QuestionContainer', 'mission3QuestionContainer', 'mission4QuestionContainer', 'mission5QuestionContainer'];
            ids.forEach(id => DOMElements[id] = document.getElementById(id));
            DOMElements.academyContainer = document.querySelector('.academy-container');
        }

        function attachEventListeners() {
            DOMElements.resetBtn.addEventListener('click', () => {
                 showModal('Reset Progress?', 'Are you sure you want to reset all training progress? This cannot be undone.', 'Yes, Reset', 'Cancel', (confirmed) => {
                    if (confirmed) resetSimulation();
                });
            });
            
            DOMElements.modalConfirmBtn.addEventListener('click', handleModalConfirm);
            DOMElements.modalCancelBtn.addEventListener('click', handleModalCancel);

            // Use event delegation for dynamic elements
            DOMElements.academyContainer.addEventListener('click', handleAcademyClick);
            DOMElements.passwordInput.addEventListener('input', checkPasswordStrength);
            DOMElements.completeBtn.addEventListener('click', completeTraining);
        }

        function handleAcademyClick(e) {
            const target = e.target;
            
            const malwareCard = target.closest('.malware-card');
            if (malwareCard) {
                exploreMalware(malwareCard);
                return;
            }

            const phishingClue = target.closest('.phishing-clue');
            if (phishingClue && !phishingClue.classList.contains('found')) {
                identifyPhishingClue(phishingClue);
                return;
            }

            const answerBtn = target.closest('.answer-btn');
            if (answerBtn && !answerBtn.disabled) {
                checkAnswer(answerBtn);
                return;
            }
            
            const navBtn = target.closest('.btn[id^="nextBtn"]');
            if(navBtn) {
                const missionNum = parseInt(navBtn.id.replace('nextBtn', '')) + 1;
                navigateToMission(missionNum);
            }
        }
        
        // --- UI & PROGRESS ---
        
        function updateProgress() {
            const completedMissions = Object.values(state.progress).filter(Boolean).length;
            const progress = (completedMissions / CONFIG.TOTAL_MISSIONS) * 100;
            DOMElements.progressBar.style.width = `${progress}%`;
            DOMElements.progressBar.textContent = `${Math.round(progress)}%`;
        }

        function showAchievement(text) {
            DOMElements.achievementText.textContent = text;
            DOMElements.achievement.classList.add('show');
            setTimeout(() => DOMElements.achievement.classList.remove('show'), CONFIG.ACHIEVEMENT_DISPLAY_TIME);
        }

        function navigateToMission(num) {
            document.querySelectorAll('.mission.active').forEach(m => m.classList.remove('active'));
            const targetMission = document.getElementById(`mission${num}`);
            if (targetMission) {
                targetMission.classList.add('active');
                state.mission = num;
                window.scrollTo(0, 0);
            }
        }
        
        // --- QUESTION LOGIC ---
        function displayMissionQuestion(missionNum) {
            const container = document.getElementById(`mission${missionNum}QuestionContainer`);
            if (!container) return;

            const questions = MISSION_QUESTIONS[missionNum];
            const questionIndex = missionNum === 1 ? state.mission1.currentQuestion : 0;
            
            if (questionIndex >= questions.length) return;

            const questionData = questions[questionIndex];
            const shuffledOptions = shuffle(Object.entries(questionData.options));
            const optionsHtml = shuffledOptions
                .map(([key, value]) => `<button class="answer-btn" data-answer="${key}">${value}</button>`)
                .join('');

            const headerText = missionNum === 1 
                ? `Knowledge Check (${questionIndex + 1}/${questions.length}):`
                : `Knowledge Check:`;
            
            const questionHtml = `
                <div class="question-box" data-mission-num="${missionNum}" data-question-index="${questionIndex}">
                    <h3>${headerText} ${questionData.question}</h3>
                    <div class="answer-options">${optionsHtml}</div>
                </div>
            `;
            container.innerHTML = questionHtml;
            container.querySelector('.question-box').style.display = 'block';
        }

        function checkAnswer(btn) {
            const answer = btn.dataset.answer;
            const questionBox = btn.closest('.question-box');
            const missionNum = parseInt(questionBox.dataset.missionNum);
            const questionIndex = parseInt(questionBox.dataset.questionIndex);

            const questionData = MISSION_QUESTIONS[missionNum][questionIndex];
            
            if (answer === questionData.answer) {
                btn.classList.add('correct');
                showAchievement('Correct!');
                btn.parentElement.querySelectorAll('.answer-btn').forEach(b => b.disabled = true);

                if (missionNum === 1) {
                    state.mission1.correctAnswers++;
                    state.mission1.currentQuestion++;
                    if (state.mission1.currentQuestion < MISSION_QUESTIONS[1].length) {
                        setTimeout(() => displayMissionQuestion(1), 1500);
                    } else {
                        showAchievement('Malware quiz complete!');
                        state.progress[1] = true;
                        updateProgress();
                        document.getElementById('nextBtn1').disabled = false;
                    }
                } else {
                    state.progress[missionNum] = true;
                    updateProgress();
                    const nextBtnId = missionNum < CONFIG.TOTAL_MISSIONS ? `nextBtn${missionNum}` : 'completeBtn';
                    document.getElementById(nextBtnId).disabled = false;
                }
            } else {
                btn.classList.add('incorrect');
                showAchievement('Not quite right. Think carefully!');
            }
        }


        // --- MISSION 1: MALWARE ---
        function populateMalwareGrid() {
            const grid = document.querySelector('#mission1 .malware-grid');
            grid.innerHTML = MALWARE_DATA.map(m => `
                <div class="malware-card" data-malware-id="${m.id}" role="button" tabindex="0">
                    <div class="malware-icon">${m.icon}</div>
                    <h3>${m.name}</h3>
                    <div class="malware-details">${m.details}</div>
                </div>
            `).join('');
        }

        function exploreMalware(card) {
            if (card.classList.contains('active')) return;
            
            card.classList.add('active');
            const malwareId = card.dataset.malwareId;
            state.mission1.explored.add(malwareId);
            
            showAchievement(`${MALWARE_DATA.find(m => m.id === malwareId).name} analyzed!`);

            if (state.mission1.explored.size === MALWARE_DATA.length) {
                showAchievement('All malware types analyzed! Time for a knowledge check.');
                displayMissionQuestion(1);
            }
        }

        // --- MISSION 2: PHISHING ---
        function identifyPhishingClue(clueElement) {
            const reason = clueElement.dataset.phishingReason;
            clueElement.classList.add('found');
            
            const reasonSpan = document.createElement('span');
            reasonSpan.className = 'clue-reason';
            reasonSpan.textContent = `🚩 ${reason}`;
            clueElement.parentNode.insertBefore(reasonSpan, clueElement.nextSibling);

            state.mission2.found.add(reason);
            showAchievement('Good catch! That\'s a red flag.');

            const totalClues = document.querySelectorAll('#phishingEmail .phishing-clue').length;
            if (state.mission2.found.size === totalClues) {
                showAchievement('All phishing clues found!');
                displayMissionQuestion(2);
            }
        }

        // --- MISSION 3: PASSWORD STRENGTH ---
        function checkPasswordStrength() {
            const password = DOMElements.passwordInput.value;
            if (!password) {
                DOMElements.strengthBar.className = 'strength-bar';
                DOMElements.crackTime.textContent = 'Enter a password to see its estimated crack time...';
                return;
            }

            let score = 0;
            if (password.length >= 8) score++;
            if (password.length >= 12) score++;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) score++;
            if (/\d/.test(password)) score++;
            if (/[^a-zA-Z0-9]/.test(password)) score++;

            let strengthClass = 'weak', strengthText = 'Weak', time = 'Instantly';
            if (score > 4) { strengthClass = 'strong'; strengthText = 'Strong'; time = 'Centuries'; } 
            else if (score > 2) { strengthClass = 'medium'; strengthText = 'Medium'; time = 'Days to Months'; }
            
            DOMElements.strengthBar.className = `strength-bar ${strengthClass}`;
            DOMElements.strengthBar.textContent = strengthText;
            DOMElements.crackTime.innerHTML = `<strong>Estimated crack time:</strong> ${time}`;

            if (!state.mission3.tested) {
                state.mission3.tested = true;
                displayMissionQuestion(3);
            }
        }

        // --- MISSION 4: NETWORK ATTACKS ---
        function simulateNormalTraffic() {
            resetNetworkSim();
            for (let i = 0; i < 3; i++) {
                setTimeout(() => createPacket('legitimate-packet', false), i * 1000);
            }
            showAchievement('Normal traffic flowing smoothly.');
            if(!state.mission4.observed) checkMission4Completion();
        }

        function simulateDoSAttack() {
            resetNetworkSim();
            state.network.attackActive = true;
            DOMElements.server.classList.add('under-attack');
            const fixedStart = { x: DOMElements.networkVisual.offsetWidth / 2, y: 10 };
            const interval = setInterval(() => {
                if (state.network.attackActive) createPacket('attack-packet', true, 0, fixedStart);
            }, 100);
            state.network.attackIntervals.push(interval);
            showAchievement('DoS Attack: Single source flooding server!');
            checkMission4Completion();
        }

        function simulateDDoSAttack() {
            resetNetworkSim();
            state.network.attackActive = true;
            DOMElements.server.classList.add('under-attack');
            for (let i = 0; i < 5; i++) {
                const interval = setInterval(() => {
                    if (state.network.attackActive) createPacket('attack-packet', true, i * 72);
                }, 150);
                state.network.attackIntervals.push(interval);
            }
            showAchievement('DDoS Attack: Multiple sources attacking!');
            checkMission4Completion();
        }
        
        function checkMission4Completion() {
            if (!state.mission4.observed) {
                state.mission4.observed = true;
                displayMissionQuestion(4);
            }
        }

        function createPacket(className, isAttack, angleOffset = 0, fixedStart = null) {
            const packet = document.createElement('div');
            packet.className = className;
            let startX, startY;

            if (fixedStart) {
                startX = fixedStart.x;
                startY = fixedStart.y;
            } else {
                const angle = (Math.random() * 360 + angleOffset) * Math.PI / 180;
                const radius = 250;
                startX = Math.cos(angle) * radius + DOMElements.networkVisual.offsetWidth / 2;
                startY = Math.sin(angle) * radius + DOMElements.networkVisual.offsetHeight / 2;
            }

            packet.style.left = `${startX}px`;
            packet.style.top = `${startY}px`;
            DOMElements.networkVisual.appendChild(packet);

            setTimeout(() => {
                packet.style.transition = 'all 1s linear';
                packet.style.left = `${DOMElements.networkVisual.offsetWidth / 2 - 10}px`;
                packet.style.top = `${DOMElements.networkVisual.offsetHeight / 2 - 10}px`;
            }, 50);
            setTimeout(() => packet.remove(), 1100);
        }

        function resetNetworkSim() {
            state.network.attackActive = false;
            state.network.attackIntervals.forEach(clearInterval);
            state.network.attackIntervals = [];
            DOMElements.server.classList.remove('under-attack');
            document.querySelectorAll('.attack-packet, .legitimate-packet').forEach(p => p.remove());
        }

        // --- MISSION 5: SQL INJECTION ---
        function testSQLInjection() {
            const username = DOMElements.usernameInput.value;
            const password = DOMElements.passwordSqlInput.value;
            const query = `SELECT * FROM users WHERE username='${username}' AND password='${password}'`;
            
            DOMElements.sqlQuery.style.display = 'block';
            DOMElements.queryText.innerHTML = query.replace(/(' OR '1'='1')/g, '<span class="code-highlight">$1</span>');

            DOMElements.sqlResult.style.display = 'block';
            if (password.includes("' OR '1'='1")) {
                DOMElements.resultText.innerHTML = `<span style="color: var(--warning-color);">⚠️ SQL Injection Successful!</span><br>The query condition became '... WHERE password='' OR '1'='1'', which is always true. This bypasses the password check completely!`;
                showAchievement('SQL Injection demonstrated!');
                if (!state.mission5.tested) {
                   state.mission5.tested = true;
                   displayMissionQuestion(5);
                }
            } else {
                DOMElements.resultText.textContent = 'Login failed. The database checked for an exact username and password match.';
            }
        }

        // --- SIMULATION RESET & COMPLETION ---
        
        function resetSimulation() {
            Object.assign(state, {
                mission: 1,
                progress: {1: false, 2: false, 3: false, 4: false, 5: false},
                mission1: { explored: new Set(), currentQuestion: 0, correctAnswers: 0 },
                mission2: { found: new Set() },
                mission3: { tested: false },
                mission4: { observed: false },
                mission5: { tested: false },
            });
            
            populateMalwareGrid();
            updateProgress();
            resetNetworkSim();
            navigateToMission(1);

            document.querySelectorAll('.malware-card.active').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.phishing-clue.found').forEach(c => c.classList.remove('found'));
            document.querySelectorAll('.clue-reason').forEach(r => r.remove());
            
            for(let i=1; i<=5; i++) {
                const container = document.getElementById(`mission${i}QuestionContainer`);
                if(container) container.innerHTML = '';
            }
            
            document.querySelectorAll('#sqlQuery, #sqlResult').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.btn[id^="nextBtn"], #completeBtn').forEach(b => b.disabled = true);
            
            [DOMElements.passwordInput, DOMElements.usernameInput, DOMElements.passwordSqlInput].forEach(i => i.value = '');
            checkPasswordStrength();

            showAchievement('Training reset - starting fresh!');
        }

        function completeTraining() {
            const message = `You have successfully completed the training!\n\n` +
                `You have demonstrated understanding of:\n` +
                `✓ Malware Behavior\n` +
                `✓ Phishing & Social Engineering\n` +
                `✓ Password Security\n` +
                `✓ Network Attacks (DoS/DDoS)\n` +
                `✓ SQL Injection\n\n` +
                `Stay vigilant!`;
            
            showModal('🏆 Congratulations! 🏆', message, 'Restart Training', null, (confirmed) => {
                if(confirmed) resetSimulation();
            });
        }
    </script>
</body>
</html>
