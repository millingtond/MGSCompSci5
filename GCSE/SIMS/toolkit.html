<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Storage & Number Systems - Interactive Learning</title>
    <style>
        :root {
            --primary: #4a90e2;
            --secondary: #52c41a;
            --danger: #ff4d4f;
            --warning: #ff9800;
            --purple: #8a2be2;
            --dark-bg: rgba(26, 26, 46, 0.9);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --border-color: rgba(74, 144, 226, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1e1e3e 50%, #0a0a1a 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(74, 144, 226, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(82, 196, 26, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 152, 0, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .calculator-warning {
            background: linear-gradient(135deg, rgba(255, 77, 79, 0.2), rgba(255, 77, 79, 0.1));
            border: 2px solid var(--danger);
            padding: 15px;
            margin: 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            animation: warningPulse 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .calculator-warning::before {
            content: '‚ö†Ô∏è';
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
        }

        @keyframes warningPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 77, 79, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 77, 79, 0.8); }
        }

        .nav-container {
            background: var(--dark-bg);
            padding: 15px;
            border-bottom: 2px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(20px);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .nav-tab {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.2), rgba(74, 144, 226, 0.1));
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 12px 24px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(74, 144, 226, 0.4), transparent);
            transition: width 0.3s, height 0.3s;
            transform: translate(-50%, -50%);
        }

        .nav-tab:hover::before {
            width: 100px;
            height: 100px;
        }

        .nav-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(74, 144, 226, 0.3);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary), #357abd);
            color: #fff;
            box-shadow: 0 5px 20px rgba(74, 144, 226, 0.5);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .module {
            display: none;
            animation: moduleSlide 0.5s ease-out;
        }

        .module.active {
            display: block;
        }

        @keyframes moduleSlide {
            from { 
                opacity: 0; 
                transform: translateY(30px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .card {
            background: linear-gradient(135deg, var(--dark-bg), rgba(26, 26, 46, 0.7));
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--warning), var(--primary));
            border-radius: 20px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s;
            background-size: 400% 400%;
            animation: gradientShift 10s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .card:hover::before {
            opacity: 0.3;
        }

        .btn {
            background: linear-gradient(135deg, var(--primary), #357abd);
            color: #fff;
            border: none;
            padding: 12px 28px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .btn:hover::after {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.6);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn.secondary {
            background: linear-gradient(135deg, var(--secondary), #389e0d);
            box-shadow: 0 4px 15px rgba(82, 196, 26, 0.4);
        }

        .btn.danger {
            background: linear-gradient(135deg, var(--danger), #cf1322);
            box-shadow: 0 4px 15px rgba(255, 77, 79, 0.4);
        }

        .instructions-box {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.1), rgba(74, 144, 226, 0.05));
            border: 1px solid var(--primary);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .instructions-box::before {
            content: 'üí°';
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 24px;
        }

        .instructions-box h3 {
            color: var(--primary);
            margin-bottom: 10px;
            padding-left: 35px;
        }

        .instructions-box ul {
            list-style: none;
            padding-left: 35px;
        }

        .instructions-box li {
            margin: 8px 0;
            position: relative;
            padding-left: 20px;
        }

        .instructions-box li::before {
            content: '‚ñ∏';
            position: absolute;
            left: 0;
            color: var(--secondary);
        }

        .score-display {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, var(--dark-bg), rgba(26, 26, 46, 0.8));
            padding: 20px 30px;
            border-radius: 20px;
            border: 2px solid var(--secondary);
            backdrop-filter: blur(20px);
            z-index: 100;
            box-shadow: 0 10px 30px rgba(82, 196, 26, 0.3);
            animation: scoreFloat 3s ease-in-out infinite;
        }

        @keyframes scoreFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .score-value {
            font-size: 32px;
            color: var(--secondary);
            font-weight: bold;
            text-shadow: 0 0 20px rgba(82, 196, 26, 0.5);
        }
        
        .canvas-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--dark-bg), rgba(26, 26, 46, 0.9));
            border: 2px solid var(--primary);
            border-radius: 20px;
            padding: 15px;
            z-index: 999;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
            resize: both;
            overflow: auto;
            min-width: 330px;
            min-height: 280px;
            max-width: 90vw;
            max-height: 80vh;
        }

        #drawingCanvas {
            background: white;
            border-radius: 10px;
            cursor: crosshair;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
            display: block;
        }

        .units-visualization {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .unit-box {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.4));
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .unit-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(74, 144, 226, 0.3), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .unit-box:hover::before {
            transform: translateX(100%);
        }

        .unit-box:hover {
            border-color: var(--primary);
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 40px rgba(74, 144, 226, 0.4);
        }

        .unit-box.selected {
            border-color: var(--secondary);
            background: linear-gradient(135deg, rgba(82, 196, 26, 0.2), rgba(82, 196, 26, 0.1));
            box-shadow: 0 10px 30px rgba(82, 196, 26, 0.4);
        }

        .binary-display {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .bit-switch {
            width: 70px;
            height: 120px;
            position: relative;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.4));
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid #333;
            overflow: hidden;
        }

        .bit-switch::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0;
            background: linear-gradient(135deg, rgba(82, 196, 26, 0.5), rgba(82, 196, 26, 0.3));
            transition: height 0.3s;
        }

        .bit-switch.on::before {
            height: 100%;
        }

        .bit-switch.on {
            border-color: var(--secondary);
            box-shadow: 0 5px 25px rgba(82, 196, 26, 0.5);
            transform: translateY(-2px);
        }

        .bit-value {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 32px;
            font-weight: bold;
            z-index: 2;
        }

        .bit-position {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            color: #888;
            z-index: 2;
        }

        .binary-addition-grid {
            background: rgba(0, 0, 0, 0.5);
            padding: 30px;
            border-radius: 15px;
            margin: 20px auto;
            max-width: 600px;
        }

        .binary-grid {
            display: grid;
            grid-template-columns: auto repeat(9, minmax(35px, 1fr));
            gap: 8px;
            align-items: center;
            font-family: monospace;
            font-size: 20px;
            justify-content: center;
        }

        .grid-label {
            font-weight: bold;
            color: var(--primary);
            text-align: right;
            padding-right: 10px;
        }

        .grid-bit {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .carry-bit {
            background: linear-gradient(135deg, rgba(100, 100, 100, 0.4), rgba(100, 100, 100, 0.3));
            border: 2px solid #666;
            color: #fff;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .carry-bit:hover {
            background: linear-gradient(135deg, rgba(100, 100, 100, 0.6), rgba(100, 100, 100, 0.5));
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(100, 100, 100, 0.6);
        }

        .static-bit {
            background: rgba(50, 50, 50, 0.5);
            color: #fff;
            border: 1px solid #444;
        }

        .input-bit {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.3), rgba(138, 43, 226, 0.2));
            border: 2px solid var(--purple);
            color: #fff;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .input-bit:hover {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.5), rgba(138, 43, 226, 0.4));
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.6);
        }

        .grid-line {
            grid-column: 2 / -1;
            height: 2px;
            background: var(--primary);
            margin: 5px 0;
        }

        .question-container {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.4));
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .question-text {
            font-size: 22px;
            margin-bottom: 25px;
            color: var(--primary);
            text-align: center;
            font-weight: 500;
        }

        .answer-options {
            display: grid;
            gap: 15px;
            margin: 25px 0;
        }

        .answer-option {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.1), rgba(74, 144, 226, 0.05));
            border: 2px solid var(--primary);
            padding: 18px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            font-size: 18px;
            position: relative;
            overflow: hidden;
        }

        .answer-option::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 0;
            height: 100%;
            background: rgba(74, 144, 226, 0.2);
            transform: translateY(-50%);
            transition: width 0.3s;
        }

        .answer-option:hover::before {
            width: 100%;
        }

        .answer-option:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(74, 144, 226, 0.3);
        }

        .answer-option.selected {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.3), rgba(74, 144, 226, 0.2));
            border-color: #fff;
            transform: translateX(5px);
        }

        .answer-option.correct {
            background: linear-gradient(135deg, rgba(82, 196, 26, 0.3), rgba(82, 196, 26, 0.2));
            border-color: var(--secondary);
            animation: correctPulse 0.6s ease;
        }

        .answer-option.incorrect {
            background: linear-gradient(135deg, rgba(255, 77, 79, 0.3), rgba(255, 77, 79, 0.2));
            border-color: var(--danger);
            animation: incorrectShake 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            display: none;
            text-align: center;
            font-size: 18px;
            font-weight: 500;
        }

        .feedback.correct {
            background: linear-gradient(135deg, rgba(82, 196, 26, 0.2), rgba(82, 196, 26, 0.1));
            border: 2px solid var(--secondary);
            color: var(--secondary);
        }

        .feedback.incorrect {
            background: linear-gradient(135deg, rgba(255, 77, 79, 0.2), rgba(255, 77, 79, 0.1));
            border: 2px solid var(--danger);
            color: var(--danger);
        }

        .feedback.show {
            display: block;
            animation: feedbackSlide 0.5s ease-out;
        }

        @keyframes feedbackSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .progress-container {
            background: rgba(0, 0, 0, 0.5);
            height: 35px;
            border-radius: 20px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--secondary), #389e0d, var(--secondary));
            background-size: 200% 100%;
            height: 100%;
            width: 0%;
            transition: width 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: bold;
            font-size: 16px;
            animation: progressShine 2s linear infinite;
        }

        @keyframes progressShine {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .theory-box {
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(255, 152, 0, 0.05));
            border: 1px solid var(--warning);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .theory-box::before {
            content: 'üìö';
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 24px;
        }

        .theory-box h4 {
            color: var(--warning);
            margin-bottom: 10px;
            padding-left: 35px;
        }

        .theory-box p {
            padding-left: 35px;
            line-height: 1.6;
        }

        .exercise-box {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(156, 39, 176, 0.05));
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid #9c27b0;
            position: relative;
        }

        .exercise-title {
            color: #9c27b0;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        input[type="text"], input[type="number"], select {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--primary);
            color: #fff;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s;
        }

        input[type="text"]:focus, input[type="number"]:focus, select:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 20px rgba(82, 196, 26, 0.4);
            background: rgba(0, 0, 0, 0.7);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-box {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.4));
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .stat-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(74, 144, 226, 0.3);
        }

        .stat-label {
            font-size: 14px;
            color: #888;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--primary);
            text-shadow: 0 0 20px rgba(74, 144, 226, 0.5);
        }

        /* --- INTEGRATED BINARY SHIFT ANIMATION STYLES --- */
        .shift-animation-container {
            perspective: 800px;
        }
        .shift-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .shift-visualizer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            overflow-x: auto;
            padding: 10px 0;
        }
        .bit-box-container {
            display: flex;
            gap: 10px;
        }
        .bit-box {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.4));
            border: 2px solid var(--border-color);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            font-family: monospace;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.6s;
            flex-shrink: 0;
        }
        .shifted-out, .shifted-in {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-family: monospace;
            opacity: 0.5;
            color: var(--warning);
            flex-shrink: 0;
        }
        .bit-box.shift-left-anim {
            animation: shiftLeftAnim 0.6s forwards;
        }
        .bit-box.shift-right-anim {
            animation: shiftRightAnim 0.6s forwards;
        }
        .bit-box.new-bit-anim {
            animation: newBitAnim 0.6s forwards;
        }
        .bit-box.dropped-bit-anim {
            animation: droppedBitAnim 0.6s forwards;
        }
        @keyframes shiftLeftAnim {
            from { transform: translateX(0); }
            to { transform: translateX(-60px); }
        }
        @keyframes shiftRightAnim {
            from { transform: translateX(0); }
            to { transform: translateX(60px); }
        }
        @keyframes newBitAnim {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes droppedBitAnim {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0.5) translateY(40px); opacity: 0; }
        }
        .shift-explanation {
            margin-top: 20px;
            font-size: 18px;
            min-height: 50px;
            color: var(--warning);
            font-weight: bold;
        }

        /* --- END OF ANIMATION STYLES --- */

        @media (max-width: 768px) {
            .score-display, .canvas-container {
                position: static;
                margin: 20px;
                width: auto;
                max-width: 100%;
                max-height: none;
                resize: none;
            }

            #drawingCanvas {
                width: 100%;
                height: 200px;
            }

            .binary-display { flex-wrap: wrap; }
            .bit-switch { width: 60px; height: 100px; }
            .binary-grid {
                grid-template-columns: auto repeat(9, minmax(28px, 1fr));
                gap: 4px;
                font-size: 14px;
            }
            .grid-bit { width: 100%; height: 35px; }
            .shortcuts-hint { display: none; }
            
            .bit-box { width: 35px; height: 35px; font-size: 18px; }
            @keyframes shiftLeftAnim { to { transform: translateX(-45px); } }
            @keyframes shiftRightAnim { to { transform: translateX(45px); } }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <!-- Achievement Notification -->
    <div id="achievement" class="achievement">
        <span id="achievementText">üèÜ Achievement Unlocked!</span>
    </div>

    <!-- Keyboard Shortcuts Hint -->
    <div class="shortcuts-hint">
        üí° Press 'N' for next question, 'R' to reset
    </div>

    <!-- Navigation -->
    <div class="nav-container glass">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showModule(event, 'units')">üìä Data Units</button>
            <button class="nav-tab" onclick="showModule(event, 'filesize')">üìÅ File Sizes</button>
            <button class="nav-tab" onclick="showModule(event, 'binary')">üíª Binary</button>
            <button class="nav-tab" onclick="showModule(event, 'hex')">üé® Hexadecimal</button>
            <button class="nav-tab" onclick="showModule(event, 'addition')">‚ûï Binary Addition</button>
            <button class="nav-tab" onclick="showModule(event, 'shifts')">‚ÜîÔ∏è Binary Shifts</button>
            <button class="nav-tab" onclick="showModule(event, 'practice')">‚úçÔ∏è Practice Mode</button>
        </div>
    </div>

    <!-- Score Display -->
    <div class="score-display glass">
        <div>‚≠ê Score: <span class="score-value" id="userScore">0</span></div>
        <div style="font-size: 14px; color: #888; margin-top: 5px;">üî• Streak: <span id="currentStreak">0</span></div>
    </div>

    <!-- Drawing Canvas -->
    <div class="canvas-container glass">
        <div class="canvas-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span style="color: var(--primary); font-weight: bold;">‚úèÔ∏è Working Area</span>
            <button class="btn" style="padding: 5px 15px; font-size: 12px;" onclick="toggleCanvas()">Hide</button>
        </div>
        <canvas id="drawingCanvas" width="300" height="200"></canvas>
        <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button class="btn secondary" style="padding: 5px 15px; font-size: 12px;" onclick="clearCanvas()">Clear</button>
            <button class="btn" style="padding: 5px 15px; font-size: 12px;" onclick="changeColor()">Color</button>
            <button class="btn danger" style="padding: 5px 15px; font-size: 12px;" onclick="eraser()">Eraser</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Calculator Warning -->
        <div class="calculator-warning">
            NO CALCULATORS IN GCSE EXAMS! All questions here can be solved by hand.
        </div>

        <!-- Data Units Module -->
        <div id="units" class="module active">
            <div class="card glass">
                <h2 class="text-center mb-30" style="color: var(--primary); font-size: 32px;">üìä Understanding Data Storage Units</h2>
                
                <div class="instructions-box">
                    <h3>How to Use This Section:</h3>
                    <ul>
                        <li>Click on any unit box below to see detailed information</li>
                        <li>Complete the interactive exercises to earn points</li>
                        <li>Use the "Practice Units" button for unlimited questions</li>
                        <li>Remember: Each unit is 1,000√ó bigger (except bits‚Üínibbles‚Üíbytes)</li>
                    </ul>
                </div>

                <div class="units-visualization" id="unitsGrid"></div>

                <div id="unitDetails" style="margin-top: 30px; display: none; padding: 20px; border-radius: 15px;" class="glass">
                    <h3 style="color: var(--secondary); margin-bottom: 15px;" id="selectedUnitName">Select a unit above</h3>
                    <div id="unitInfo"></div>
                </div>

                <div class="theory-box">
                    <h4>Key Theory: Why Binary?</h4>
                    <p>Computers use binary (0s and 1s) because electronic switches can only be ON or OFF. This makes binary the natural language for digital systems. Every piece of data - text, images, sound - must be converted to binary for processing.</p>
                </div>

                <div class="exercise-box">
                    <div class="exercise-title">üéØ Quick Conversion Exercise</div>
                    <div id="unitExercises"></div>
                </div>

                <div class="text-center mt-30">
                    <button class="btn" onclick="startUnitsQuiz()">üéÆ Practice Units</button>
                </div>
            </div>
        </div>

        <!-- File Size Module -->
        <div id="filesize" class="module">
            <div class="card glass">
                <h2 class="text-center mb-30" style="color: var(--primary); font-size: 32px;">üìÅ File Size Calculations</h2>
                <div class="instructions-box">
                    <h3>File Size Formulas:</h3>
                    <ul>
                        <li><strong>Sound:</strong> Sample Rate √ó Duration √ó Bit Depth √∑ 8 = Bytes</li>
                        <li><strong>Image:</strong> Width √ó Height √ó Color Depth √∑ 8 = Bytes</li>
                        <li><strong>Text:</strong> Number of Characters √ó Bits per Character √∑ 8 = Bytes</li>
                        <li>Then convert bytes to KB/MB by dividing by 1,000</li>
                    </ul>
                </div>
                <div class="theory-box">
                    <h4>Understanding File Sizes</h4>
                    <p>Different file types have different size calculations. Sound files depend on quality (sample rate and bit depth), images on resolution and color depth, and text files on the number of characters and encoding used.</p>
                </div>
                <div class="exercise-box">
                    <div class="exercise-title">üéØ File Size Calculation Exercises</div>
                    <div id="fileSizeExercises"></div>
                </div>
                <div class="text-center mt-30">
                    <button class="btn" onclick="startFileSizeQuiz()">üßÆ Practice Calculations</button>
                </div>
            </div>
        </div>

        <!-- Binary Module -->
        <div id="binary" class="module">
            <div class="card glass">
                <h2 class="text-center mb-30" style="color: var(--primary); font-size: 32px;">üíª Binary Number System</h2>
                <div class="instructions-box">
                    <h3>Interactive Binary Switches:</h3>
                    <ul>
                        <li>Click any switch to toggle between 0 and 1</li>
                        <li>Each position value doubles: 1, 2, 4, 8, 16, 32, 64, 128</li>
                        <li>To convert: Add up position values where bit = 1</li>
                        <li>Maximum 8-bit value = 255 (all bits set to 1)</li>
                    </ul>
                </div>
                <div class="theory-box">
                    <h4>Binary Place Values</h4>
                    <p>Each binary digit (bit) represents a power of 2. The rightmost bit is 2‚Å∞ = 1, then 2¬π = 2, 2¬≤ = 4, and so on. To convert to denary, simply add the place values where there's a 1.</p>
                </div>
                <div class="binary-display" id="binaryDisplay"></div>
                <div class="text-center mt-30">
                    <h3>Binary: <span id="binaryValue" style="font-family: monospace; color: var(--secondary); font-size: 28px;">00000000</span></h3>
                    <h3>Denary: <span id="denaryValue" style="color: var(--warning); font-size: 28px;">0</span></h3>
                    <h3>Hexadecimal: <span id="hexValue" style="color: var(--primary); font-size: 28px;">00</span></h3>
                </div>
                <div class="text-center mt-30">
                    <button class="btn" onclick="resetBinary()">üîÑ Reset</button>
                    <button class="btn secondary" onclick="randomBinary()">üé≤ Random</button>
                    <button class="btn" onclick="startBinaryQuiz()">üìù Practice Binary</button>
                </div>
            </div>
        </div>

        <!-- Hexadecimal Module -->
        <div id="hex" class="module">
            <div class="card glass">
                <h2 class="text-center mb-30" style="color: var(--primary); font-size: 32px;">üé® Hexadecimal System</h2>
                <div class="instructions-box">
                    <h3>Understanding Hexadecimal:</h3>
                    <ul>
                        <li>Base 16: Uses 0-9 and A-F (A=10, B=11, C=12, D=13, E=14, F=15)</li>
                        <li>Each hex digit = 4 bits (1 nibble)</li>
                        <li>To convert to denary: First digit √ó 16 + Second digit</li>
                        <li>Common uses: Colors (#FF0000 = Red), Memory addresses</li>
                    </ul>
                </div>
                <div class="exercise-box">
                    <div class="exercise-title">üéØ Hexadecimal Conversion Exercises</div>
                    <div id="hexExercises"></div>
                </div>
                <div class="text-center mt-30">
                    <button class="btn" onclick="startHexQuiz()">üéØ Practice Hexadecimal</button>
                </div>
            </div>
        </div>

        <!-- Binary Addition Module -->
        <div id="addition" class="module">
            <div class="card glass">
                <h2 class="text-center mb-30" style="color: var(--primary); font-size: 32px;">‚ûï Binary Addition</h2>
                <div class="instructions-box">
                    <h3>Binary Addition Rules:</h3>
                    <ul>
                        <li>0 + 0 = 0</li>
                        <li>0 + 1 = 1, 1 + 0 = 1</li>
                        <li>1 + 1 = 10 (write 0, carry 1)</li>
                        <li>1 + 1 + 1 = 11 (write 1, carry 1)</li>
                        <li>Click gray boxes for carry bits, purple boxes for sum</li>
                        <li>Watch for overflow when result > 255</li>
                    </ul>
                </div>
                <div id="binaryAdditionQuestion"></div>
                <div class="text-center mt-30">
                    <button class="btn" onclick="newAdditionQuestion()">üìù New Question</button>
                </div>
            </div>
        </div>

        <!-- Binary Shifts Module -->
        <div id="shifts" class="module">
            <div class="card glass">
                <h2 class="text-center mb-30" style="color: var(--primary); font-size: 32px;">‚ÜîÔ∏è Binary Shifts</h2>
                <div class="instructions-box">
                    <h3>Binary Shift Operations:</h3>
                    <ul>
                        <li><strong>Left Shift (<<):</strong> Multiplies by 2</li>
                        <li><strong>Right Shift (>>):</strong> Divides by 2 (integer division)</li>
                        <li>Bits that "fall off" are lost</li>
                        <li>Empty positions filled with 0s</li>
                    </ul>
                </div>
                
                <!-- INTEGRATED ANIMATION -->
                <div class="exercise-box">
                    <div class="exercise-title">‚öôÔ∏è Interactive Shift Animation</div>
                    <div id="shiftAnimationContainer">
                        <!-- Animation will be generated here by JavaScript -->
                    </div>
                </div>

                <div class="text-center mt-30">
                    <button class="btn" onclick="startShiftQuiz()">üîÑ Practice Shifts</button>
                </div>
            </div>
        </div>

        <!-- Practice Module -->
        <div id="practice" class="module">
            <div class="card glass">
                <h2 class="text-center mb-30" style="color: var(--primary); font-size: 32px;">‚úçÔ∏è Practice Mode</h2>
                
                <div class="instructions-box">
                    <h3>Unlimited Practice Questions:</h3>
                    <ul>
                        <li>All questions can be solved without a calculator</li>
                        <li>Questions increase in difficulty as you progress</li>
                        <li>Build streaks to unlock achievements</li>
                        <li>Track your accuracy and improvement</li>
                    </ul>
                </div>

                <div class="text-center" style="margin: 30px 0;">
                    <button class="btn" onclick="startPractice('mixed')">üé≤ Mixed Questions</button>
                    <button class="btn secondary" onclick="startPractice('units')">üìä Data Units</button>
                    <button class="btn secondary" onclick="startPractice('filesize')">üìÅ File Sizes</button>
                    <button class="btn secondary" onclick="startPractice('binary')">üíª Binary</button>
                    <button class="btn secondary" onclick="startPractice('hex')">üé® Hexadecimal</button>
                    <button class="btn secondary" onclick="startPractice('addition')">‚ûï Addition</button>
                    <button class="btn secondary" onclick="startPractice('shifts')">‚ÜîÔ∏è Shifts</button>
                </div>

                <div id="practiceArea" style="display: none;">
                    <div class="question-container">
                        <div class="question-text" id="practiceQuestion"></div>
                        <div id="practiceOptions" class="answer-options"></div>
                        <div id="practiceInput" style="display: none; text-align: center;">
                            <input type="text" id="practiceAnswer" style="width: 300px; margin-right: 10px;">
                            <button class="btn" onclick="checkPracticeAnswer()">Submit</button>
                        </div>
                        <div class="feedback" id="practiceFeedback"></div>
                    </div>

                    <div class="text-center mt-20">
                        <button class="btn secondary" onclick="nextPracticeQuestion()">Next Question ‚Üí</button>
                    </div>
                </div>

                <div class="progress-container mt-30">
                    <div class="progress-bar" id="practiceProgress">0%</div>
                </div>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Correct</div>
                        <div class="stat-value" id="correctCount">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Incorrect</div>
                        <div class="stat-value" id="incorrectCount">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Accuracy</div>
                        <div class="stat-value" id="accuracy">0%</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Best Streak</div>
                        <div class="stat-value" id="bestStreak">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        const state = {
            score: 0,
            currentStreak: 0,
            bestStreak: 0,
            practiceType: 'mixed',
            currentQuestion: null,
            questionsAnswered: 0,
            correctAnswers: 0,
            canvasVisible: true,
            drawingColor: '#000000',
            isErasing: false,
            achievements: { firstCorrect: false, streak10: false, streak25: false, score100: false, score500: false, perfectTen: false },
            shiftAnimation: { isAnimating: false, currentBits: [] }
        };

        // Canvas setup
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        
        const canvasContainer = document.querySelector('.canvas-container');
        if (window.ResizeObserver) {
            const observer = new ResizeObserver(entries => {
                for (const entry of entries) {
                    const tempCanvas = document.createElement('canvas');
                    const tempCtx = tempCanvas.getContext('2d');
                    tempCanvas.width = canvas.width;
                    tempCanvas.height = canvas.height;
                    tempCtx.drawImage(canvas, 0, 0);
                    const style = getComputedStyle(entry.target);
                    const newWidth = entry.contentRect.width - parseFloat(style.paddingLeft) - parseFloat(style.paddingRight);
                    const headerHeight = canvasContainer.querySelector('.canvas-header')?.offsetHeight || 0;
                    const footerHeight = canvasContainer.querySelector('div:last-child')?.offsetHeight || 0;
                    const newHeight = entry.contentRect.height - parseFloat(style.paddingTop) - parseFloat(style.paddingBottom) - headerHeight - footerHeight - 20; 
                    canvas.width = Math.max(10, newWidth);
                    canvas.height = Math.max(10, newHeight);
                    ctx.drawImage(tempCanvas, 0, 0);
                }
            });
            observer.observe(canvasContainer);
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        canvas.addEventListener('touchstart', handleTouch, { passive: false });
        canvas.addEventListener('touchmove', handleTouch, { passive: false });
        canvas.addEventListener('touchend', stopDrawing);

        function getTouchPos(touchEvent) {
            const rect = canvas.getBoundingClientRect();
            return { x: touchEvent.touches[0].clientX - rect.left, y: touchEvent.touches[0].clientY - rect.top };
        }
        
        function handleTouch(e) {
            e.preventDefault();
            const pos = getTouchPos(e);
            if (e.type === 'touchstart') {
                isDrawing = true;
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
            } else if (e.type === 'touchmove' && isDrawing) {
                ctx.lineWidth = state.isErasing ? 20 : 2;
                ctx.lineCap = 'round';
                ctx.strokeStyle = state.isErasing ? '#FFFFFF' : state.drawingColor;
                ctx.globalCompositeOperation = state.isErasing ? 'destination-out' : 'source-over';
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
            }
        }
        function startDrawing(e) { isDrawing = true; const rect = canvas.getBoundingClientRect(); ctx.beginPath(); ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top); }
        function draw(e) { if (!isDrawing) return; const rect = canvas.getBoundingClientRect(); ctx.lineWidth = state.isErasing ? 20 : 2; ctx.lineCap = 'round'; ctx.strokeStyle = state.isErasing ? '#FFFFFF' : state.drawingColor; ctx.globalCompositeOperation = state.isErasing ? 'destination-out' : 'source-over'; ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top); ctx.stroke(); }
        function stopDrawing() { isDrawing = false; }
        function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }
        function toggleCanvas() { state.canvasVisible = !state.canvasVisible; canvasContainer.style.display = state.canvasVisible ? 'block' : 'none'; }
        function changeColor() { const colors = ['#000000', '#FF0000', '#00FF00', '#0000FF', '#FFFF00']; const index = colors.indexOf(state.drawingColor); state.drawingColor = colors[(index + 1) % colors.length]; state.isErasing = false; }
        function eraser() { state.isErasing = true; }

        // Module navigation
        function showModule(event, moduleName) {
            document.querySelectorAll('.module').forEach(m => m.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(moduleName).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // Lazy load module content
            if (moduleName === 'units' && !document.getElementById('unitsGrid').hasChildNodes()) initializeUnits();
            if (moduleName === 'binary' && !document.getElementById('binaryDisplay').hasChildNodes()) initializeBinary();
            if (moduleName === 'filesize' && !document.getElementById('fileSizeExercises').hasChildNodes()) initializeFileSize();
            if (moduleName === 'hex' && !document.getElementById('hexExercises').hasChildNodes()) initializeHex();
            if (moduleName === 'addition' && !document.getElementById('binaryAdditionQuestion').hasChildNodes()) newAdditionQuestion();
            if (moduleName === 'shifts' && !document.getElementById('shiftAnimationContainer').hasChildNodes()) initializeShiftAnimation();
        }

        // Data Units Module
        function initializeUnits() {
            const units = [
                { id: 'bit', name: 'Bit', value: 'Binary Digit', detail: '0 or 1' },
                { id: 'nibble', name: 'Nibble', value: '4 bits', detail: 'Half byte' },
                { id: 'byte', name: 'Byte', value: '8 bits', detail: '1 character' },
                { id: 'kilobyte', name: 'Kilobyte', value: '1,000 bytes', detail: 'Small file' },
                { id: 'megabyte', name: 'Megabyte', value: '1,000 KB', detail: 'Photo/Song' },
                { id: 'gigabyte', name: 'Gigabyte', value: '1,000 MB', detail: 'HD Movie' },
                { id: 'terabyte', name: 'Terabyte', value: '1,000 GB', detail: 'Hard drive' },
                { id: 'petabyte', name: 'Petabyte', value: '1,000 TB', detail: 'Data center' }
            ];

            const grid = document.getElementById('unitsGrid');
            grid.innerHTML = '';
            units.forEach(unit => {
                const box = document.createElement('div');
                box.className = 'unit-box';
                box.onclick = () => selectUnit(unit.id, box);
                box.innerHTML = `<div style="font-size: 20px; font-weight: bold; color: var(--primary); margin-bottom: 10px;">${unit.name}</div><div style="font-size: 14px; color: #888;">${unit.value}</div><div style="font-size: 12px; color: var(--secondary); margin-top: 5px;">${unit.detail}</div>`;
                grid.appendChild(box);
            });

            generateUnitExercises();
        }

        function selectUnit(unit, element) {
            document.querySelectorAll('.unit-box').forEach(box => box.classList.remove('selected'));
            element.classList.add('selected');
            const unitDetails = document.getElementById('unitDetails');
            const unitName = document.getElementById('selectedUnitName');
            const unitInfo = document.getElementById('unitInfo');
            unitDetails.style.display = 'block';
            const info = {
                'bit': { name: 'Bit (Binary Digit)', info: `<p><strong>Definition:</strong> The smallest unit of data. Can be 0 or 1.</p><p><strong>Real Example:</strong> A single yes/no answer, on/off switch</p><p><strong>Conversions:</strong></p><ul style="margin-left: 20px;"><li>8 bits = 1 byte</li><li>4 bits = 1 nibble</li></ul>` },
                'nibble': { name: 'Nibble', info: `<p><strong>Definition:</strong> 4 bits, can represent one hexadecimal digit</p><p><strong>Real Example:</strong> Half a character, one hex digit (0-F)</p><p><strong>Conversions:</strong></p><ul style="margin-left: 20px;"><li>1 nibble = 4 bits</li><li>2 nibbles = 1 byte</li></ul>` },
                'byte': { name: 'Byte', info: `<p><strong>Definition:</strong> 8 bits, the basic unit for storing a character</p><p><strong>Real Example:</strong> One letter like 'A' or number like '7'</p><p><strong>Conversions:</strong></p><ul style="margin-left: 20px;"><li>1 byte = 8 bits = 2 nibbles</li><li>1,000 bytes = 1 KB</li></ul>` },
                'kilobyte': { name: 'Kilobyte (KB)', info: `<p><strong>Definition:</strong> 1,000 bytes</p><p><strong>Real Example:</strong> A 2-page essay, small text file</p><p><strong>Storage:</strong> Can hold about 500 words of text</p>` },
                'megabyte': { name: 'Megabyte (MB)', info: `<p><strong>Definition:</strong> 1,000 KB or 1,000,000 bytes</p><p><strong>Real Example:</strong> A 3-minute MP3 song, digital photo</p><p><strong>Storage:</strong> About 500 pages of text</p>` },
                'gigabyte': { name: 'Gigabyte (GB)', info: `<p><strong>Definition:</strong> 1,000 MB</p><p><strong>Real Example:</strong> HD movie, 250 songs, small game</p><p><strong>Storage:</strong> About 500,000 pages of text</p>` },
                'terabyte': { name: 'Terabyte (TB)', info: `<p><strong>Definition:</strong> 1,000 GB</p><p><strong>Real Example:</strong> Modern hard drive, 250 HD movies</p><p><strong>Storage:</strong> About 500 million pages of text</p>` },
                'petabyte': { name: 'Petabyte (PB)', info: `<p><strong>Definition:</strong> 1,000 TB</p><p><strong>Real Example:</strong> Large data center, Google processes ~20 PB/day</p><p><strong>Storage:</strong> All US academic research libraries ‚âà 2 PB</p>` }
            };
            unitName.textContent = info[unit].name;
            unitInfo.innerHTML = info[unit].info;
        }

        function generateUnitExercises() {
            createExerciseHTML('unitExercises', [
                { question: 'Convert 3 KB to bytes', answer: '3000' },
                { question: 'Convert 5 MB to KB', answer: '5000' },
                { question: 'Convert 2 bytes to bits', answer: '16' },
                { question: 'Convert 4 GB to MB', answer: '4000' }
            ]);
        }
        
        // Generic Exercise Check
        function checkGenericExercise(containerId, num, answer) {
            const input = document.getElementById(`${containerId}_Ex${num}`).value.trim().toUpperCase();
            const feedback = document.getElementById(`${containerId}_Feedback${num}`);
            if (input === answer.toUpperCase()) {
                feedback.innerHTML = ' <span style="color: var(--secondary);">‚úì Correct!</span>';
                updateScore(5);
            } else {
                feedback.innerHTML = ` <span style="color: var(--danger);">‚úó Incorrect. Answer: ${answer}</span>`;
            }
        }

        function createExerciseHTML(containerId, questions) {
            const exercises = document.getElementById(containerId);
            if (!exercises) return;
            exercises.innerHTML = '';
            questions.forEach((q, i) => {
                const p = document.createElement('p');
                p.style.margin = '10px 0';
                p.innerHTML = `${i + 1}. ${q.question}: <input type="text" id="${containerId}_Ex${i}" style="width: 150px;" onkeydown="if(event.key === 'Enter') checkGenericExercise('${containerId}', ${i}, '${q.answer}')"> <button class="btn" style="padding: 5px 15px; font-size: 14px;" onclick="checkGenericExercise('${containerId}', ${i}, '${q.answer}')">Check</button> <span id="${containerId}_Feedback${i}"></span>`;
                exercises.appendChild(p);
            });
        }

        function initializeFileSize() {
            const questions = [
                { question: "Image: 100x80px, 24-bit color. Calculate size in KB", answer: "24" },
                { question: "Sound file: 8,000Hz rate, 5s duration, 8-bit depth. Calculate size in KB", answer: "40" },
                { question: "Text file with 5,000 characters (8-bit ASCII). Calculate size in KB", answer: "5" }
            ];
            createExerciseHTML('fileSizeExercises', questions);
        }
        function initializeHex() {
            const questions = [{ question: "Convert denary 255 to hex", answer: "FF" }, { question: "Convert hex 1A to denary", answer: "26" }, { question: "Convert denary 100 to hex", answer: "64" }, { question: "Convert hex C8 to denary", answer: "200" }];
            createExerciseHTML('hexExercises', questions);
        }

        // Binary Module
        function initializeBinary() {
            const display = document.getElementById('binaryDisplay');
            display.innerHTML = '';
            for (let i = 7; i >= 0; i--) {
                const bitSwitch = document.createElement('div');
                bitSwitch.className = 'bit-switch';
                bitSwitch.onclick = () => toggleBit(i);
                bitSwitch.innerHTML = `<div class="bit-value" id="bit${i}">0</div><div class="bit-position">${Math.pow(2, i)}</div>`;
                display.appendChild(bitSwitch);
            }
            updateBinaryDisplay();
        }

        function toggleBit(position) {
            const bit = document.getElementById(`bit${position}`);
            const switchElement = bit.parentElement;
            if (bit.textContent === '0') {
                bit.textContent = '1';
                switchElement.classList.add('on');
            } else {
                bit.textContent = '0';
                switchElement.classList.remove('on');
            }
            updateBinaryDisplay();
        }

        function updateBinaryDisplay() {
            let binary = '', denary = 0;
            for (let i = 7; i >= 0; i--) {
                const bitElement = document.getElementById(`bit${i}`);
                if (bitElement) {
                    const bit = bitElement.textContent;
                    binary += bit;
                    if (bit === '1') denary += Math.pow(2, i);
                }
            }
            document.getElementById('binaryValue').textContent = binary;
            document.getElementById('denaryValue').textContent = denary;
            document.getElementById('hexValue').textContent = denary.toString(16).toUpperCase().padStart(2, '0');
        }
        function resetBinary() {
            for (let i = 0; i < 8; i++) {
                const bit = document.getElementById(`bit${i}`);
                if (bit) {
                    bit.textContent = '0';
                    bit.parentElement.classList.remove('on');
                }
            }
            updateBinaryDisplay();
        }
        function randomBinary() {
            for (let i = 0; i < 8; i++) {
                const bit = document.getElementById(`bit${i}`);
                if (bit) {
                    const random = Math.random() < 0.5 ? '0' : '1';
                    bit.textContent = random;
                    if (random === '1') {
                        bit.parentElement.classList.add('on');
                    } else {
                        bit.parentElement.classList.remove('on');
                    }
                }
            }
            updateBinaryDisplay();
        }

        // Binary Addition Module
        function newAdditionQuestion() {
            const num1 = Math.floor(Math.random() * 128);
            const num2 = Math.floor(Math.random() * 128);
            const sum = num1 + num2;
            const overflow = sum > 255 ? '1' : '0';
            const binary1 = num1.toString(2).padStart(8, '0');
            const binary2 = num2.toString(2).padStart(8, '0');
            const binarySum = (sum % 256).toString(2).padStart(8, '0');
            const container = document.getElementById('binaryAdditionQuestion');
            container.innerHTML = `
                <div class="binary-addition-grid">
                    <div class="binary-grid">
                        <div class="grid-label">C:</div>
                        ${[...Array(9)].map((_, i) => `<div class="grid-bit carry-bit" id="carry${8-i}" onclick="toggleAdditionBit(this)">0</div>`).join('')}
                        <div class="grid-label">A:</div>
                        <div class="grid-bit" style="background: transparent; border: none;"></div>
                        ${binary1.split('').map(bit => `<div class="grid-bit static-bit">${bit}</div>`).join('')}
                        <div class="grid-label">B:</div>
                        <div class="grid-bit" style="background: transparent; border: none;">+</div>
                        ${binary2.split('').map(bit => `<div class="grid-bit static-bit">${bit}</div>`).join('')}
                        <div class="grid-line" style="grid-column: 1 / -1;"></div>
                        <div class="grid-label">S:</div>
                        <div class="grid-bit input-bit" id="overflow" onclick="toggleAdditionBit(this)">0</div>
                        ${[...Array(8)].map((_, i) => `<div class="grid-bit input-bit" id="sum${7-i}" onclick="toggleAdditionBit(this)">0</div>`).join('')}
                    </div>
                    <div class="text-center mt-20">
                        <button class="btn" onclick="checkAddition('${binarySum}', '${overflow}')">Check Answer</button>
                    </div>
                    <div id="additionFeedback" style="margin-top: 20px; text-align: center;"></div>
                </div>`;
        }

        function checkAddition(expectedSum, expectedOverflow) {
            let userSum = '';
            for (let i = 7; i >= 0; i--) {
                userSum += document.getElementById(`sum${i}`).textContent;
            }
            const userOverflow = document.getElementById('overflow').textContent;
            const feedback = document.getElementById('additionFeedback');
            if (userSum === expectedSum && userOverflow === expectedOverflow) {
                feedback.innerHTML = '<div style="color: var(--secondary); font-size: 20px;">‚úì Correct! Well done!</div>';
                updateScore(15);
                setTimeout(newAdditionQuestion, 2000);
            } else {
                let carryHint = expectedOverflow === '1' ? ' (with overflow)' : '';
                feedback.innerHTML = `<div style="color: var(--danger);">‚úó Not quite. Expected: ${expectedOverflow}${expectedSum}${carryHint}</div>`;
            }
        }

        function toggleAdditionBit(element) { element.textContent = element.textContent === '0' ? '1' : '0'; }

        // --- BINARY SHIFT ANIMATION FUNCTIONS ---
        function initializeShiftAnimation() {
            const container = document.getElementById('shiftAnimationContainer');
            container.innerHTML = `
                <div class="shift-animation-container">
                    <div class="shift-controls">
                        <button class="btn" onclick="performShift('left')">‚Üê Left Shift (Multiply by 2)</button>
                        <button class="btn" onclick="performShift('right')">‚Üí Right Shift (Divide by 2)</button>
                        <button class="btn secondary" onclick="resetShiftAnimation()">Reset</button>
                    </div>
                    <div class="shift-visualizer">
                        <div class="shifted-out" id="shiftAnim-shiftedOutLeft"></div>
                        <div class="bit-box-container" id="shiftAnim-bitContainer"></div>
                        <div class="shifted-in" id="shiftAnim-shiftedInRight">0</div>
                    </div>
                    <div class="shift-explanation" id="shiftAnim-explanation"></div>
                </div>`;
            resetShiftAnimation();
        }

        function resetShiftAnimation() {
            const randomNumber = Math.floor(Math.random() * 128) + 64;
            state.shiftAnimation.currentBits = randomNumber.toString(2).padStart(8, '0').split('');
            renderShiftBits();
            updateShiftExplanation(parseInt(state.shiftAnimation.currentBits.join(''), 2));
            document.getElementById('shiftAnim-shiftedOutLeft').textContent = '';
            document.getElementById('shiftAnim-shiftedInRight').textContent = '0';
        }

        function renderShiftBits() {
            const bitContainer = document.getElementById('shiftAnim-bitContainer');
            if(!bitContainer) return;
            bitContainer.innerHTML = '';
            state.shiftAnimation.currentBits.forEach((bit, index) => {
                const bitBox = document.createElement('div');
                bitBox.className = 'bit-box';
                bitBox.id = `shiftAnim-bit-${index}`;
                bitBox.textContent = bit;
                bitContainer.appendChild(bitBox);
            });
        }

        function updateShiftExplanation(value, operation = 'Initial Value') {
            const explanationEl = document.getElementById('shiftAnim-explanation');
            if (explanationEl) explanationEl.innerHTML = `${operation}: <span style="color: white;">${value}</span>`;
        }

        function performShift(direction) {
            if (state.shiftAnimation.isAnimating) return;
            state.shiftAnimation.isAnimating = true;

            let droppedBit;
            if (direction === 'left') {
                droppedBit = state.shiftAnimation.currentBits[0];
                document.getElementById('shiftAnim-shiftedOutLeft').textContent = droppedBit;
                for (let i = 0; i < 7; i++) {
                    document.getElementById(`shiftAnim-bit-${i+1}`).classList.add('shift-left-anim');
                }
                document.getElementById('shiftAnim-bit-0').classList.add('dropped-bit-anim');

                setTimeout(() => {
                    state.shiftAnimation.currentBits.shift();
                    state.shiftAnimation.currentBits.push('0');
                    renderShiftBits();
                    document.getElementById('shiftAnim-bit-7').classList.add('new-bit-anim');
                    updateShiftExplanation(parseInt(state.shiftAnimation.currentBits.join(''), 2), `Left Shift (√ó2)`);
                    state.shiftAnimation.isAnimating = false;
                }, 600);
            } else if (direction === 'right') {
                droppedBit = state.shiftAnimation.currentBits[7];
                document.getElementById('shiftAnim-shiftedInRight').textContent = droppedBit;
                for (let i = 1; i < 8; i++) {
                    document.getElementById(`shiftAnim-bit-${i-1}`).classList.add('shift-right-anim');
                }
                document.getElementById('shiftAnim-bit-7').classList.add('dropped-bit-anim');

                setTimeout(() => {
                    state.shiftAnimation.currentBits.pop();
                    state.shiftAnimation.currentBits.unshift('0');
                    renderShiftBits();
                    document.getElementById('shiftAnim-bit-0').classList.add('new-bit-anim');
                    updateShiftExplanation(parseInt(state.shiftAnimation.currentBits.join(''), 2), `Right Shift (√∑2)`);
                    state.shiftAnimation.isAnimating = false;
                }, 600);
            }
        }
        // --- END OF SHIFT ANIMATION FUNCTIONS ---

        // Practice Module
        function startPractice(type) {
            showModule({currentTarget: document.querySelector(`.nav-tab[onclick*="'${type}'"]`) || document.querySelector('.nav-tab[onclick*="practice"]')}, 'practice');
            state.practiceType = type;
            document.getElementById('practiceArea').style.display = 'block';
            nextPracticeQuestion();
        }
        
        function generatePracticeQuestion() {
            const generators = {
                units: generateUnitQuestion, binary: generateBinaryQuestion, hex: generateHexQuestion,
                filesize: generateFileSizeQuestion, addition: generateAdditionPracticeQuestion, shifts: generateShiftQuestion
            };
            const types = Object.keys(generators);
            const randomType = state.practiceType === 'mixed' ? types[Math.floor(Math.random() * types.length)] : state.practiceType;
            return generators[randomType]();
        }

        function generateFileSizeQuestion(){ return { question: `Calculate file size: Image 100√ó100 pixels, 24-bit color depth. Answer in KB.`, type: 'input', answer: "24" }; }
        function generateAdditionPracticeQuestion(){ const num1 = Math.floor(Math.random() * 16), num2 = Math.floor(Math.random() * 16), sum = num1 + num2; return { question: `Add 4-bit binary: ${num1.toString(2).padStart(4, '0')} + ${num2.toString(2).padStart(4, '0')}`, type: 'input', answer: sum.toString(2).padStart(5, '0') }; }
        function generateShiftQuestion(){ const num = Math.floor(Math.random() * 64) + 1; return { question: `What is ${num} after a left shift?`, type: 'input', answer: (num * 2).toString() };}
        function generateBinaryQuestion() { const num = Math.floor(Math.random() * 256); if (Math.random() < 0.5) { return { question: `Convert binary ${num.toString(2).padStart(8, '0')} to denary`, type: 'input', answer: num.toString()}; } else { return { question: `Convert denary ${num} to 8-bit binary`, type: 'input', answer: num.toString(2).padStart(8, '0') }; } }
        function generateHexQuestion() { const num = Math.floor(Math.random() * 256); if (Math.random() < 0.5) { return { question: `Convert hex ${num.toString(16).toUpperCase().padStart(2, '0')} to denary`, type: 'input', answer: num.toString()}; } else { return { question: `Convert denary ${num} to hex`, type: 'input', answer: num.toString(16).toUpperCase().padStart(2, '0') }; } }
        function generateUnitQuestion() { const q = [{ q: "How many bits in a byte?", o: ["4", "8", "16", "32"], c: 1 }, { q: "How many bytes in a kilobyte?", o: ["100", "1000", "1024", "10000"], c: 1 }][Math.floor(Math.random()*2)]; return { question: q.q, type: 'multiple', options: q.o, correct: q.c }; }

        function nextPracticeQuestion() {
            state.currentQuestion = generatePracticeQuestion();
            document.getElementById('practiceQuestion').textContent = state.currentQuestion.question;
            const feedbackEl = document.getElementById('practiceFeedback');
            feedbackEl.style.display = 'none';
            feedbackEl.className = 'feedback';
            if (state.currentQuestion.type === 'multiple') {
                document.getElementById('practiceOptions').style.display = 'grid';
                document.getElementById('practiceInput').style.display = 'none';
                document.getElementById('practiceOptions').innerHTML = state.currentQuestion.options.map((option, index) => `<div class="answer-option" onclick="selectOption(${index})">${option}</div>`).join('');
            } else {
                document.getElementById('practiceOptions').style.display = 'none';
                document.getElementById('practiceInput').style.display = 'block';
                document.getElementById('practiceAnswer').value = '';
                document.getElementById('practiceAnswer').focus();
            }
        }

        function selectOption(index) {
            if(document.querySelector('.answer-option.correct, .answer-option.incorrect')) return;
            document.querySelectorAll('.answer-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelectorAll('.answer-option')[index].classList.add('selected');
            setTimeout(() => checkPracticeAnswer(index), 300);
        }

        function checkPracticeAnswer(selectedIndex) {
            const feedback = document.getElementById('practiceFeedback');
            let correct = false;
            if (state.currentQuestion.type === 'multiple') {
                correct = selectedIndex === state.currentQuestion.correct;
                document.querySelectorAll('.answer-option').forEach((opt, idx) => {
                    if (idx === state.currentQuestion.correct) opt.classList.add('correct');
                    else if (idx === selectedIndex && !correct) opt.classList.add('incorrect');
                });
            } else {
                correct = document.getElementById('practiceAnswer').value.trim().toUpperCase() === state.currentQuestion.answer.toUpperCase();
            }
            state.questionsAnswered++;
            if (correct) {
                state.correctAnswers++;
                state.currentStreak++;
                if (state.currentStreak > state.bestStreak) state.bestStreak = state.currentStreak;
                updateScore(10);
                feedback.className = 'feedback correct show';
                feedback.innerHTML = '‚úì Correct! Well done!';
                if (!state.achievements.perfectTen && state.questionsAnswered >= 10 && state.correctAnswers === state.questionsAnswered) { showAchievement('Perfect Ten! 10/10 correct answers!'); state.achievements.perfectTen = true; }
            } else {
                state.currentStreak = 0;
                feedback.className = 'feedback incorrect show';
                const correctAnswer = state.currentQuestion.answer || state.currentQuestion.options[state.currentQuestion.correct];
                feedback.innerHTML = `‚úó Incorrect. The answer is: ${correctAnswer}`;
            }
            updatePracticeStats();
        }

        function updatePracticeStats() {
            document.getElementById('correctCount').textContent = state.correctAnswers;
            document.getElementById('incorrectCount').textContent = state.questionsAnswered - state.correctAnswers;
            const accuracy = state.questionsAnswered > 0 ? Math.round((state.correctAnswers / state.questionsAnswered) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
            document.getElementById('bestStreak').textContent = state.bestStreak;
            const progress = Math.min((state.questionsAnswered / 20) * 100, 100);
            const progressBar = document.getElementById('practiceProgress');
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';
        }

        function updateScore(points) {
            state.score += points;
            document.getElementById('userScore').textContent = state.score;
            document.getElementById('currentStreak').textContent = state.currentStreak;
            if (!state.achievements.firstCorrect && state.correctAnswers === 1) { showAchievement('First Correct Answer!'); state.achievements.firstCorrect = true; }
            if (!state.achievements.streak10 && state.currentStreak >= 10) { showAchievement('10 Streak! On Fire! üî•'); state.achievements.streak10 = true; }
            if (!state.achievements.streak25 && state.currentStreak >= 25) { showAchievement('25 Streak! Unstoppable! üí™'); state.achievements.streak25 = true; }
            if (!state.achievements.score100 && state.score >= 100) { showAchievement('100 Points! Keep Going!'); state.achievements.score100 = true; }
            if (!state.achievements.score500 && state.score >= 500) { showAchievement('500 Points! Master!'); state.achievements.score500 = true; }
        }

        function showAchievement(text) {
            const achievement = document.getElementById('achievement');
            document.getElementById('achievementText').textContent = 'üèÜ ' + text;
            achievement.classList.add('show');
            setTimeout(() => { achievement.classList.remove('show'); }, 3000);
        }

        function startUnitsQuiz() { startPractice('units'); }
        function startFileSizeQuiz() { startPractice('filesize'); }
        function startBinaryQuiz() { startPractice('binary'); }
        function startHexQuiz() { startPractice('hex'); }
        function startShiftQuiz() { startPractice('shifts'); }

        document.addEventListener('keydown', (e) => {
            if (e.key.toLowerCase() === 'n' && document.getElementById('practiceArea').style.display !== 'none') nextPracticeQuestion();
            if (e.key.toLowerCase() === 'r' && document.querySelector('.module.active').id === 'binary') resetBinary();
        });

        window.onload = function() {
            initializeUnits();
            try {
                const savedState = localStorage.getItem('dataStorageSimState');
                if (savedState) {
                    const saved = JSON.parse(savedState);
                    state.score = saved.score || 0;
                    state.bestStreak = saved.bestStreak || 0;
                    state.achievements = saved.achievements || {};
                    updateScore(0);
                    updatePracticeStats();
                }
            } catch(error) {
                console.error("Could not load saved state:", error);
                localStorage.removeItem('dataStorageSimState');
            }
        };

        setInterval(() => {
            try {
                localStorage.setItem('dataStorageSimState', JSON.stringify({
                    score: state.score, bestStreak: state.bestStreak, achievements: state.achievements 
                }));
            } catch (error) { console.error("Could not save state:", error); }
        }, 5000);

        window.addEventListener('DOMContentLoaded', () => {
    const defaultTab = document.querySelector('.nav-tab[onclick*="shifts"]');
    if (defaultTab) {
        defaultTab.click();
    }
});

    </script>
</body>
</html>
