<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Compression Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #9b59b6;
            --primary-dark: #8e44ad;
            --secondary: #e74c3c;
            --accent: #3498db;
            --success: #2ecc71;
            --warning: #f39c12;
            --bg-dark: #1a1a2e;
            --bg-medium: #16213e;
            --bg-light: #0f3460;
            --text-primary: #ffffff;
            --text-secondary: #bdc3c7;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 50%, var(--bg-light) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 0;
            animation: fadeInDown 0.8s ease;
        }

        h1 {
            font-size: clamp(2em, 5vw, 3em);
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .subtitle {
            font-size: 1.2em;
            color: var(--text-secondary);
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 10px;
            padding: 0 20px;
        }

        .tab {
            padding: 12px 24px;
            background: var(--glass);
            border: 2px solid transparent;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            font-family: inherit;
            font-size: inherit;
        }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .tab:hover::before {
            left: 100%;
        }

        .tab:hover, .tab:focus {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            outline: none;
        }

        .tab.active {
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            box-shadow: 0 4px 20px rgba(155, 89, 182, 0.4);
            transform: translateY(-2px);
        }

        .section {
            display: none;
            background: var(--glass);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .section.active {
            display: block;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: var(--glass);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            border-radius: 15px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s;
        }

        .card:hover::before {
            opacity: 0.3;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .info-card {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1) 0%, rgba(231, 76, 60, 0.1) 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .info-card > * {
            position: relative;
            z-index: 1;
        }
        
        .info-card p {
            line-height: 1.6;
        }

        .info-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(155, 89, 182, 0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
            z-index: 0; /* Ensures background effect is behind content */
        }

        @keyframes pulse {
            0%, 100% { transform: scale(0.8) rotate(0deg); opacity: 0.5; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.8; }
        }

        .button {
            padding: 12px 30px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 10px 5px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .button:active::after {
            width: 300px;
            height: 300px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(155, 89, 182, 0.4);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--glass);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: translateX(-100%);
            transition: transform 0.3s;
        }

        .stat-card:hover::before {
            transform: translateX(0);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stat-value {
            font-size: clamp(1.5em, 3vw, 2em);
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .comparison-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .compression-type {
            background: var(--glass);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .compression-type::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(255,255,255,0.05));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .compression-type:hover::before {
            opacity: 1;
        }

        .compression-type.lossy {
            border-color: var(--secondary);
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.1);
        }

        .compression-type.lossless {
            border-color: var(--success);
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.1);
        }

        .file-visual {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
            flex-wrap: wrap; /* Added for storage visualization */
            padding: 10px; /* Added for storage visualization */
        }

        .file-block {
            width: 24px;
            height: 24px;
            margin: 3px;
            border-radius: 5px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-block;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .file-block.small {
             width: 12px;
             height: 12px;
             margin: 2px;
        }

        .file-block:hover {
            transform: scale(1.2) rotate(5deg);
            z-index: 10;
        }

        .original-block {
            background: linear-gradient(135deg, var(--accent), var(--primary));
        }

        .compressed-block {
            background: linear-gradient(135deg, var(--success), var(--primary));
        }

        .removed-block {
            background: transparent;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            box-shadow: none;
        }

        .slider-container {
            margin: 20px 0;
        }

        .slider-container label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--primary);
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.5);
            transition: all 0.2s;
            border: 2px solid white;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 30px rgba(155, 89, 182, 0.7);
        }

        .scenario-card {
            background: var(--glass);
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .scenario-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(155, 89, 182, 0.1), transparent);
            transition: left 0.8s;
        }

        .scenario-card:hover::before {
            left: 100%;
        }

        .scenario-card:hover {
            transform: translateX(10px);
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .scenario-card.selected {
            border-color: var(--primary);
            background: rgba(155, 89, 182, 0.1);
            transform: translateX(5px);
        }

        .demo-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(155, 89, 182, 0.5);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: var(--primary);
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%) scale(0.9);
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            white-space: nowrap;
            font-size: 14px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tooltip:hover::after {
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }

        .algorithm-visual {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
            position: relative;
        }

        .algorithm-visual::before {
            content: 'ALGORITHM';
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 10px;
            color: rgba(255,255,255,0.3);
            letter-spacing: 2px;
        }

        .highlight {
            background: rgba(155, 89, 182, 0.3);
            padding: 2px 4px;
            border-radius: 3px;
            box-shadow: 0 0 4px rgba(155, 89, 182, 0.5);
        }

        canvas {
            display: block;
            margin: 20px auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .interactive-element {
            position: relative;
            display: inline-block;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .interactive-element:hover {
            transform: scale(1.05);
        }

        .drag-drop-area {
            border: 3px dashed rgba(155, 89, 182, 0.5);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            background: rgba(155, 89, 182, 0.05);
        }

        .drag-drop-area:hover {
            border-color: var(--primary);
            background: rgba(155, 89, 182, 0.1);
        }

        .drag-drop-area.dragover {
            border-color: var(--success);
            background: rgba(46, 204, 113, 0.1);
            transform: scale(1.02);
        }

        .audio-visualizer {
            height: 100px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
            display: flex;
            align-items: flex-end;
            padding: 0 5px;
        }

        .audio-bar {
            flex-grow: 1;
            background: linear-gradient(to top, var(--primary), var(--secondary));
            transition: height 0.1s, opacity 0.3s;
            margin: 0 1px;
        }

        select {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            outline: none;
        }

        select:focus {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.2);
        }

        select option {
            background: var(--bg-dark);
            color: white;
        }

        textarea {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-family: 'Courier New', monospace;
            resize: vertical;
            transition: all 0.3s;
            outline: none;
        }

        textarea:focus {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.2);
        }

        .quiz-option {
            padding: 15px;
            background: var(--glass);
            border: 2px solid transparent;
            border-radius: 10px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .quiz-option::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 0;
            height: 100%;
            background: rgba(155, 89, 182, 0.1);
            transform: translateY(-50%);
            transition: width 0.3s;
        }

        .quiz-option:hover::before {
            width: 100%;
        }

        .quiz-option:hover {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .quiz-option.correct {
            background: rgba(46, 204, 113, 0.2);
            border-color: var(--success);
        }

        .quiz-option.incorrect {
            background: rgba(231, 76, 60, 0.2);
            border-color: var(--secondary);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .section {
                padding: 20px;
            }
            
            .tabs {
                padding: 0 10px;
            }
            
            .tab {
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .scenario-card:hover {
                transform: translateX(0) scale(1.02);
            }
            
            .scenario-card.selected {
                transform: translateX(0) scale(1.02);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
            
            .progress-fill::after {
                display: none;
            }
        }

        /* Dark mode optimizations */
        @media (prefers-color-scheme: light) {
            :root {
                --bg-dark: #f0f0f0;
                --bg-medium: #e0e0e0;
                --bg-light: #d0d0d0;
                --text-primary: #333333;
                --text-secondary: #666666;
                --glass: rgba(0, 0, 0, 0.05);
                --glass-border: rgba(0, 0, 0, 0.1);
            }
            
            .algorithm-visual {
                background: rgba(0, 0, 0, 0.1);
                color: #333333;
            }
            
            select option {
                background: white;
                color: #333333;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Data Compression</h1>
            <p class="subtitle">Understanding how files get smaller</p>
        </header>

        <div class="tabs">
            <button class="tab active" data-section="why">Why Compress?</button>
            <button class="tab" data-section="types">Compression Types</button>
            <button class="tab" data-section="comparison">Lossy vs Lossless</button>
            <button class="tab" data-section="scenarios">Use Cases</button>
            <button class="tab" data-section="demo">Interactive Demo</button>
            <button class="tab" data-section="advanced">Advanced</button>
            <button class="tab" data-section="quiz">Quiz</button>
        </div>

        <div class="content">
            <!-- Why Compress Section -->
            <div id="why" class="section active">
                <h2>Why Do We Need Compression?</h2>
                <p style="margin-bottom: 20px;">Explore the reasons why compression is essential in the digital world</p>
                
                <div class="grid-container">
                    <div class="card">
                        <h3>💾 Storage Space</h3>
                        <div id="storageVisual" class="file-visual">
                           <!-- JS will populate this -->
                        </div>
                        <p>Storage is limited and expensive. Compression helps fit more data in the same space.</p>
                        <div class="stats">
                            <div class="stat-card">
                                <div class="stat-value">10x</div>
                                <p>More Files</p>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">90%</div>
                                <p>Space Saved</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>🌐 Bandwidth</h3>
                        <div class="file-visual">
                            <canvas id="bandwidthCanvas" width="300" height="180"></canvas>
                        </div>
                        <p>Internet connections have limited speed. Compression reduces download/upload times.</p>
                        <div class="stats">
                            <div class="stat-card">
                                <div class="stat-value">5x</div>
                                <p>Faster</p>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">80%</div>
                                <p>Less Data</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>💰 Cost</h3>
                        <div class="file-visual">
                            <canvas id="costCanvas" width="300" height="180"></canvas>
                        </div>
                        <p>Data storage and transfer cost money. Compression reduces these expenses.</p>
                        <div class="stats">
                            <div class="stat-card">
                                <div class="stat-value">$$$</div>
                                <p>Saved</p>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">ROI</div>
                                <p>High</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>📊 Real-World Impact</h3>
                    <div class="demo-container">
                        <h4>Live Compression Calculator</h4>
                        <div class="grid-container">
                            <div>
                                <label for="contentType">Content Type:</label>
                                <select id="contentType">
                                    <option value="netflix">Netflix (Monthly)</option>
                                    <option value="photos">Photo Collection (1000 photos)</option>
                                    <option value="music">Music Library (500 songs)</option>
                                    <option value="backup">System Backup</option>
                                    <option value="website">Website Assets</option>
                                </select>
                                
                                <label for="userCount" style="margin-top: 15px;">Users/Devices:</label>
                                <input type="range" id="userCount" min="1" max="1000000" value="1000">
                                <p>Count: <span id="userCountDisplay">1,000</span></p>
                            </div>
                            <div>
                                <h4>Impact Analysis</h4>
                                <p><strong>Without Compression:</strong></p>
                                <p>Storage: <span id="uncompressedStorage" class="stat-value">100 TB</span></p>
                                <p>Bandwidth: <span id="uncompressedBandwidth" class="stat-value">50 Gbps</span></p>
                                <p>Cost: <span id="uncompressedCost" class="stat-value">$10,000/mo</span></p>
                                
                                <p style="margin-top: 15px;"><strong>With Compression:</strong></p>
                                <p>Storage: <span id="compressedStorage" class="stat-value" style="color: var(--success);">10 TB</span></p>
                                <p>Bandwidth: <span id="compressedBandwidth" class="stat-value" style="color: var(--success);">5 Gbps</span></p>
                                <p>Cost: <span id="compressedCost" class="stat-value" style="color: var(--success);">$1,000/mo</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Compression Types Section -->
            <div id="types" class="section">
                <h2>Types of Compression</h2>
                <p style="margin-bottom: 20px;">Two main approaches to making files smaller</p>
                
                <div class="comparison-container">
                    <div class="compression-type lossless">
                        <h3>🔒 Lossless Compression</h3>
                        <p style="color: var(--success); margin-bottom: 15px;">Perfect reconstruction possible</p>
                        
                        <div class="file-visual">
                            <canvas id="losslessCanvas" width="350" height="180"></canvas>
                        </div>
                        
                        <h4>How it works:</h4>
                        <ul style="list-style: none; padding: 10px;">
                            <li>• Finds patterns and redundancy</li>
                            <li>• Stores data more efficiently</li>
                            <li>• No information is lost</li>
                            <li>• Original can be perfectly restored</li>
                        </ul>
                        
                        <div class="demo-container" style="margin-top: 20px;">
                            <h4>Try It:</h4>
                            <label for="losslessInput">Enter repeating text:</label>
                            <input type="text" id="losslessInput" placeholder="Type repeating text..." 
                                   value="AAABBBCCC">
                            <p>Result: <span id="losslessResult" class="highlight">3A3B3C</span></p>
                        </div>
                        
                        <h4>Common Formats:</h4>
                        <div class="stats">
                            <div class="stat-card">
                                <div class="stat-value">ZIP</div>
                                <p>General</p>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">PNG</div>
                                <p>Images</p>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">FLAC</div>
                                <p>Audio</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="compression-type lossy">
                        <h3>🎯 Lossy Compression</h3>
                        <p style="color: var(--secondary); margin-bottom: 15px;">Some data is permanently removed</p>
                        
                        <div class="file-visual">
                            <canvas id="lossyCanvas" width="350" height="180"></canvas>
                        </div>
                        
                        <h4>How it works:</h4>
                        <ul style="list-style: none; padding: 10px;">
                            <li>• Removes "unnecessary" data</li>
                            <li>• Keeps perceptually important info</li>
                            <li>• Much smaller file sizes</li>
                            <li>• Cannot recover original exactly</li>
                        </ul>
                        
                        <div class="demo-container" style="margin-top: 20px;">
                            <h4>Quality Control:</h4>
                            <label for="lossyQuality">Adjust Quality:</label>
                            <input type="range" id="lossyQuality" min="0" max="100" value="90">
                            <p>Quality: <span id="lossyQualityDisplay">90%</span></p>
                        </div>
                        
                        <h4>Common Formats:</h4>
                        <div class="stats">
                            <div class="stat-card">
                                <div class="stat-value">JPEG</div>
                                <p>Photos</p>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">MP3</div>
                                <p>Music</p>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">MP4</div>
                                <p>Video</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>🔍 Compression Algorithms Visualized</h3>
                    <div class="grid-container">
                        <div class="algorithm-visual">
                            <h4>Lossless - Dictionary Compression:</h4>
                            <p>Original text: <span class="highlight">the cat in the hat</span></p>
                            <p>Dictionary: {1: "the", 2: "cat", 3: "in", 4: "hat"}</p>
                            <p>Compressed: <span class="highlight">1 2 3 1 4</span></p>
                            <p style="color: var(--success);">✓ Saves 72% space</p>
                        </div>
                        
                        <div class="algorithm-visual">
                            <h4>Lossy - Frequency Removal:</h4>
                            <p>Audio spectrum: <span class="highlight">[20Hz ████████ 20kHz]</span></p>
                            <p>After MP3: <span class="highlight">[20Hz ████░░░░ 16kHz]</span></p>
                            <p style="color: var(--secondary);">✗ High frequencies removed</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comparison Section -->
            <div id="comparison" class="section">
                <h2>Detailed Comparison</h2>
                <p style="margin-bottom: 20px;">Understanding the trade-offs between compression types</p>
                
                <div class="demo-container">
                    <h3>Interactive Image Compression</h3>
                    <div class="drag-drop-area" id="dropArea">
                        <p>📸 Drag & drop an image here or click to upload</p>
                        <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                    </div>
                    
                    <div id="compressionDemo" style="display: none;">
                        <div class="slider-container">
                            <label for="compressionSlider">Compression Level: <span id="compressionLevel">50</span>%</label>
                            <input type="range" id="compressionSlider" min="0" max="100" value="50">
                        </div>
                        
                        <div class="grid-container">
                            <div>
                                <h4>Original</h4>
                                <canvas id="originalImage" width="400" height="300"></canvas>
                                <div class="stats">
                                    <div class="stat-card">
                                        <div class="stat-value" id="originalSize">-</div>
                                        <p>Size</p>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value">100%</div>
                                        <p>Quality</p>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 id="compressedTitle">Compressed</h4>
                                <canvas id="compressedImage" width="400" height="300"></canvas>
                                <div class="stats">
                                    <div class="stat-card">
                                        <div class="stat-value" id="compressedSize">-</div>
                                        <p>Size</p>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value" id="compressedQuality">-</div>
                                        <p>Quality</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card" style="margin-top: 20px;">
                            <h4>Compression Analysis</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" id="compressionRatio" style="width: 50%;"></div>
                            </div>
                            <p>Space Saved: <span id="spaceSavedPercent">50%</span></p>
                            <p>Compression Type: <span id="compressionType">Lossy (JPEG)</span></p>
                        </div>
                    </div>
                </div>

                <div class="grid-container" style="margin-top: 30px;">
                    <div class="card">
                        <h3>🎯 When to Use Each Type</h3>
                        <div class="comparison-container">
                            <div>
                                <h4 style="color: var(--success);">Use Lossless For:</h4>
                                <ul style="list-style: none; padding: 10px;">
                                    <li>📄 Documents & Text</li>
                                    <li>💾 Software & Code</li>
                                    <li>🎨 Graphics with Text</li>
                                    <li>📊 Spreadsheets</li>
                                    <li>🔒 Archives</li>
                                </ul>
                            </div>
                            <div>
                                <h4 style="color: var(--secondary);">Use Lossy For:</h4>
                                <ul style="list-style: none; padding: 10px;">
                                    <li>📸 Photographs</li>
                                    <li>🎵 Music Streaming</li>
                                    <li>📹 Video Content</li>
                                    <li>🌐 Web Media</li>
                                    <li>📱 Mobile Apps</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scenarios Section -->
            <div id="scenarios" class="section">
                <h2>Real-World Scenarios</h2>
                <p style="margin-bottom: 20px;">Common situations where compression is essential</p>
                
                <div id="scenarioGrid">
                    <!-- Scenarios will be populated by JavaScript -->
                </div>

                <div id="scenarioDetails" class="info-card" style="display: none;">
                    <h3 id="scenarioTitle">Scenario Details</h3>
                    <div id="scenarioContent"></div>
                    <div class="demo-container" style="margin-top: 20px;">
                        <h4>Try It Yourself:</h4>
                        <div id="scenarioDemo"></div>
                    </div>
                </div>
            </div>

            <!-- Interactive Demo Section -->
            <div id="demo" class="section">
                <h2>Hands-On Compression Lab</h2>
                <p style="margin-bottom: 20px;">Experiment with different compression techniques</p>
                
                <div class="demo-container">
                    <h3>🔤 Text Compression Playground</h3>
                    <div class="grid-container">
                        <div>
                            <label for="textInput">Input Text:</label>
                            <textarea id="textInput" rows="6">AAAAABBBBBCCCCCDDDDD abcabcabc</textarea>
                            <p>Size: <span id="originalTextSize">-</span> bytes</p>
                            
                            <div style="margin-top: 20px;">
                                <label for="compressionMethod">Compression Method:</label>
                                <select id="compressionMethod">
                                    <option value="rle">Run-Length Encoding</option>
                                    <option value="huffman">Huffman Coding (Simulation)</option>
                                    <option value="dictionary">Dictionary Compression</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label>Compressed Output:</label>
                            <div class="algorithm-visual" id="compressedOutput" style="min-height: 100px;">
                                <!-- Compressed result will appear here -->
                            </div>
                            <p>Size: <span id="compressedTextSize">-</span> bytes</p>
                            <p>Compression Ratio: <span id="textCompressionRatio">-</span></p>
                            
                            <div class="progress-bar" style="margin-top: 20px;">
                                <div class="progress-fill" id="textCompressionBar" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="demo-container" style="margin-top: 30px;">
                    <h3>🎵 Audio Compression Simulator</h3>
                    <div class="audio-visualizer" id="audioVisualizer">
                        <!-- Audio bars will be generated here -->
                    </div>
                    <div class="slider-container">
                        <label for="bitrateSlider">Bitrate: <span id="bitrateValue">320</span> kbps</label>
                        <input type="range" id="bitrateSlider" min="32" max="320" value="320" step="32">
                    </div>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-value" id="audioFileSize">10 MB</div>
                            <p>File Size</p>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="audioQuality">Excellent</div>
                            <p>Quality</p>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="audioFrequency">20 kHz</div>
                            <p>Max Frequency</p>
                        </div>
                    </div>
                </div>

                <div class="demo-container" style="margin-top: 30px;">
                    <h3>🎨 Color Depth Reduction</h3>
                    <div class="grid-container">
                        <div>
                            <canvas id="colorCanvas" width="400" height="300"></canvas>
                        </div>
                        <div>
                            <label for="colorBits">Color Bits:</label>
                            <select id="colorBits">
                                <option value="24">24-bit (16.7M colors)</option>
                                <option value="16">16-bit (65K colors)</option>
                                <option value="8">8-bit (256 colors)</option>
                                <option value="4">4-bit (16 colors)</option>
                                <option value="1">1-bit (2 colors)</option>
                            </select>
                            
                            <div class="stats" style="margin-top: 20px;">
                                <div class="stat-card">
                                    <div class="stat-value" id="colorCount">16.7M</div>
                                    <p>Colors</p>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="colorFileSize">360 KB</div>
                                    <p>File Size</p>
                                </div>
                            </div>
                            
                            <div class="info-card" style="margin-top: 20px;">
                                <h4>Dithering Options:</h4>
                                <label for="ditheringEnabled">
                                    <input type="checkbox" id="ditheringEnabled">
                                    Enable Dithering
                                </label>
                                <p style="font-size: 12px; margin-top: 10px;">
                                    Dithering creates the illusion of more colors by mixing pixels
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Section -->
            <div id="advanced" class="section">
                <h2>Advanced Compression Concepts</h2>
                <p style="margin-bottom: 20px;">Deeper insights into compression technology</p>
                
                <div class="grid-container">
                    <div class="card">
                        <h3>🧮 Compression Mathematics</h3>
                        <div class="algorithm-visual">
                            <h4>Shannon's Information Theory</h4>
                            <p>Entropy = -Σ p(x) × log₂(p(x))</p>
                        </div>
                        <div class="demo-container" style="margin-top: 20px;">
                            <label for="entropyInput">Calculate entropy of text:</label>
                            <input type="text" id="entropyInput" value="AABBCCDD">
                            <p>Entropy: <span id="entropyValue">-</span> bits/symbol</p>
                            <p>Min bits needed: <span id="minBits">-</span></p>
                            <p id="entropyExplanation" style="margin-top: 10px; color: var(--text-secondary);"></p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>🔮 Future of Compression</h3>
                        <ul style="list-style: none; padding: 10px;">
                            <li>🤖 <strong>AI-Based Compression:</strong> Neural networks learning optimal compression</li>
                            <li>🧬 <strong>DNA Storage:</strong> Using compression for biological data storage</li>
                            <li>⚛️ <strong>Quantum Compression:</strong> Leveraging quantum properties</li>
                            <li>🌐 <strong>Semantic Compression:</strong> Compressing meaning, not just data</li>
                        </ul>
                    </div>
                </div>

                <div class="info-card">
                    <h3>🏆 Compression Hall of Fame</h3>
                    <div class="grid-container">
                        <div class="stat-card">
                            <h4>ZIP (1989)</h4>
                            <p>Phil Katz</p>
                            <p style="font-size: 12px;">Universal file compression</p>
                        </div>
                        <div class="stat-card">
                            <h4>MP3 (1993)</h4>
                            <p>Fraunhofer IIS</p>
                            <p style="font-size: 12px;">Revolutionized music</p>
                        </div>
                        <div class="stat-card">
                            <h4>JPEG (1992)</h4>
                            <p>Joint Committee</p>
                            <p style="font-size: 12px;">Made digital photos practical</p>
                        </div>
                        <div class="stat-card">
                            <h4>H.264 (2003)</h4>
                            <p>ITU-T & ISO</p>
                            <p style="font-size: 12px;">Enabled HD streaming</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz Section -->
            <div id="quiz" class="section">
                <h2>Test Your Knowledge</h2>
                <p style="margin-bottom: 20px;">Check your understanding of compression concepts!</p>
                
                <div class="card" id="quizContainer">
                    <!-- Quiz will be generated by JavaScript -->
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="button" id="startQuiz">🎯 Start Quiz</button>
                    <button class="button" id="submitQuiz" style="display: none;">📊 Submit Quiz</button>
                </div>
                
                <div class="card" id="quizResults" style="display: none;">
                    <h3>Quiz Results</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="scoreBar" style="width: 0%"></div>
                    </div>
                    <p style="text-align: center; font-size: 1.5em; margin: 20px 0;">
                        Score: <span id="quizScore">0</span>%
                    </p>
                    <div id="quizFeedback"></div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="button" id="retryQuiz">Try Again</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Global variables and state ---
            let currentSection = 'why';
            let uploadedImage = null;
            let animationFrames = {};
            let quizQuestions = [];
            let quizAnswers = {};

            // --- DOM Element Caching ---
            const dom = {
                tabs: document.querySelectorAll('.tab'),
                sections: document.querySelectorAll('.section'),
                // 'Why' Section
                storageVisual: document.getElementById('storageVisual'),
                bandwidthCanvas: document.getElementById('bandwidthCanvas'),
                costCanvas: document.getElementById('costCanvas'),
                contentType: document.getElementById('contentType'),
                userCount: document.getElementById('userCount'),
                userCountDisplay: document.getElementById('userCountDisplay'),
                uncompressedStorage: document.getElementById('uncompressedStorage'),
                uncompressedBandwidth: document.getElementById('uncompressedBandwidth'),
                uncompressedCost: document.getElementById('uncompressedCost'),
                compressedStorage: document.getElementById('compressedStorage'),
                compressedBandwidth: document.getElementById('compressedBandwidth'),
                compressedCost: document.getElementById('compressedCost'),
                // 'Types' Section
                losslessInput: document.getElementById('losslessInput'),
                losslessResult: document.getElementById('losslessResult'),
                lossyQuality: document.getElementById('lossyQuality'),
                lossyQualityDisplay: document.getElementById('lossyQualityDisplay'),
                lossyCanvas: document.getElementById('lossyCanvas'),
                losslessCanvas: document.getElementById('losslessCanvas'),
                // 'Comparison' Section
                dropArea: document.getElementById('dropArea'),
                imageUpload: document.getElementById('imageUpload'),
                compressionDemo: document.getElementById('compressionDemo'),
                compressionSlider: document.getElementById('compressionSlider'),
                compressionLevel: document.getElementById('compressionLevel'),
                originalImage: document.getElementById('originalImage'),
                compressedImage: document.getElementById('compressedImage'),
                originalSize: document.getElementById('originalSize'),
                compressedSize: document.getElementById('compressedSize'),
                compressedQuality: document.getElementById('compressedQuality'),
                compressedTitle: document.getElementById('compressedTitle'),
                compressionRatio: document.getElementById('compressionRatio'),
                spaceSavedPercent: document.getElementById('spaceSavedPercent'),
                compressionType: document.getElementById('compressionType'),
                // 'Scenarios' Section
                scenarioGrid: document.getElementById('scenarioGrid'),
                scenarioDetails: document.getElementById('scenarioDetails'),
                scenarioTitle: document.getElementById('scenarioTitle'),
                scenarioContent: document.getElementById('scenarioContent'),
                scenarioDemo: document.getElementById('scenarioDemo'),
                // 'Demo' Section
                textInput: document.getElementById('textInput'),
                originalTextSize: document.getElementById('originalTextSize'),
                compressionMethod: document.getElementById('compressionMethod'),
                compressedOutput: document.getElementById('compressedOutput'),
                compressedTextSize: document.getElementById('compressedTextSize'),
                textCompressionRatio: document.getElementById('textCompressionRatio'),
                textCompressionBar: document.getElementById('textCompressionBar'),
                audioVisualizer: document.getElementById('audioVisualizer'),
                bitrateSlider: document.getElementById('bitrateSlider'),
                bitrateValue: document.getElementById('bitrateValue'),
                audioFileSize: document.getElementById('audioFileSize'),
                audioQuality: document.getElementById('audioQuality'),
                audioFrequency: document.getElementById('audioFrequency'),
                colorCanvas: document.getElementById('colorCanvas'),
                colorBits: document.getElementById('colorBits'),
                ditheringEnabled: document.getElementById('ditheringEnabled'),
                colorCount: document.getElementById('colorCount'),
                colorFileSize: document.getElementById('colorFileSize'),
                // 'Advanced' Section
                entropyInput: document.getElementById('entropyInput'),
                entropyValue: document.getElementById('entropyValue'),
                minBits: document.getElementById('minBits'),
                entropyExplanation: document.getElementById('entropyExplanation'),
                // 'Quiz' Section
                quizContainer: document.getElementById('quizContainer'),
                startQuiz: document.getElementById('startQuiz'),
                submitQuiz: document.getElementById('submitQuiz'),
                quizResults: document.getElementById('quizResults'),
                scoreBar: document.getElementById('scoreBar'),
                quizScore: document.getElementById('quizScore'),
                quizFeedback: document.getElementById('quizFeedback'),
                retryQuiz: document.getElementById('retryQuiz')
            };

            // --- Utility Functions ---
            const debounce = (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            };
            
            // --- Event Listeners ---
            const setupEventListeners = () => {
                dom.tabs.forEach(tab => {
                    tab.addEventListener('click', (event) => {
                        const sectionId = event.currentTarget.dataset.section;
                        showSection(sectionId, event);
                    });
                });

                if(dom.contentType) dom.contentType.addEventListener('change', calculateSavings);
                if(dom.userCount) dom.userCount.addEventListener('input', calculateSavings);
                if(dom.losslessInput) dom.losslessInput.addEventListener('input', updateLosslessDemo);
                if(dom.lossyQuality) dom.lossyQuality.addEventListener('input', updateLossyDemo);
                if(dom.dropArea) {
                    dom.dropArea.addEventListener('click', () => dom.imageUpload.click());
                    dom.dropArea.addEventListener('dragover', handleDragOver);
                    dom.dropArea.addEventListener('dragleave', (e) => e.currentTarget.classList.remove('dragover'));
                    dom.dropArea.addEventListener('drop', handleDrop);
                }
                if(dom.imageUpload) dom.imageUpload.addEventListener('change', handleFileSelect);
                if(dom.compressionSlider) dom.compressionSlider.addEventListener('input', updateImageCompression);
                if(dom.textInput) dom.textInput.addEventListener('input', compressText);
                if(dom.compressionMethod) dom.compressionMethod.addEventListener('change', compressText);
                if(dom.bitrateSlider) dom.bitrateSlider.addEventListener('input', updateAudioCompression);
                if(dom.colorBits) dom.colorBits.addEventListener('change', updateColorDepth);
                if(dom.ditheringEnabled) dom.ditheringEnabled.addEventListener('change', updateColorDepth);
                if(dom.entropyInput) dom.entropyInput.addEventListener('input', calculateEntropy);
                if(dom.startQuiz) dom.startQuiz.addEventListener('click', startQuiz);
                if(dom.submitQuiz) dom.submitQuiz.addEventListener('click', showQuizResults);
                if(dom.retryQuiz) dom.retryQuiz.addEventListener('click', retryQuiz);
            };

            // --- Core Application Logic ---
            function showSection(sectionId, event) {
                if (currentSection === sectionId) return;

                Object.values(animationFrames).forEach(frame => cancelAnimationFrame(frame));
                animationFrames = {};
                
                dom.tabs.forEach(tab => tab.classList.remove('active'));
                if (event && event.currentTarget) {
                    event.currentTarget.classList.add('active');
                }

                dom.sections.forEach(section => section.classList.remove('active'));
                const newSection = document.getElementById(sectionId);
                if (newSection) {
                    newSection.classList.add('active');
                }
                
                currentSection = sectionId;
                
                // Initialize section-specific content
                const initFunctions = {
                    'why': initWhySection,
                    'types': initTypesSection,
                    'comparison': initComparisonSection,
                    'scenarios': initScenariosSection,
                    'demo': initDemoSection,
                    'advanced': initAdvancedSection,
                    'quiz': initQuiz,
                };

                if (initFunctions[sectionId]) {
                    initFunctions[sectionId]();
                }
            }

            // --- Section Initializers ---
            function initWhySection() {
                drawStorageVisualization();
                drawBandwidthVisualization();
                drawCostVisualization();
                calculateSavings();
            }

            function initTypesSection() {
                drawLosslessVisualization();
                updateLossyDemo(); // Now linked to the slider
            }

            function initComparisonSection() {
                loadDefaultImage();
            }
            
            function initScenariosSection() {
                const scenarios = [
                    { id: 'email', icon: '📧', title: 'Email Attachments', problem: 'Email services limit attachment sizes (usually 25 MB)', solution: 'Compress files before attaching', type: 'Lossless (ZIP)', details: { approach: 'Use ZIP compression for documents', tips: ['Compress images to JPEG before zipping', 'Split large files if needed', 'Consider cloud storage links for very large files'], expected: '30-70% size reduction' } },
                    { id: 'web', icon: '🌐', title: 'Website Images', problem: 'Large images slow down page loading', solution: 'Optimize images for web', type: 'Lossy (JPEG/WebP)', details: { approach: 'Balance quality and file size', tips: ['Use JPEG for photos (quality 75-85%)', 'Use PNG for logos with transparency', 'Consider WebP for modern browsers', 'Implement lazy loading'], expected: 'Images under 200KB' } },
                    { id: 'backup', icon: '💾', title: 'Data Backup', problem: 'Limited backup storage space', solution: 'Compress backup files', type: 'Lossless (ZIP/RAR)', details: { approach: 'Preserve all data integrity', tips: ['Always use lossless compression', 'Test restore process regularly', 'Keep multiple backup copies', 'Document compression settings'], expected: 'Never use lossy for backups!' } },
                    { id: 'streaming', icon: '📺', title: 'Video Streaming', problem: 'Bandwidth limitations', solution: 'Adaptive bitrate streaming', type: 'Lossy (H.264/H.265)', details: { approach: 'Multiple quality versions', tips: ['Create 360p, 720p, 1080p, 4K versions', 'Use adaptive bitrate', 'H.265 for better efficiency', 'Buffer management'], expected: '1-25 Mbps depending on quality' } },
                    { id: 'mobile', icon: '📱', title: 'Mobile Apps', problem: 'Limited device storage', solution: 'Optimize all resources', type: 'Mixed', details: { approach: 'Compress everything appropriately', tips: ['Compress images (multiple resolutions)', 'Minify code', 'Use vector graphics', 'Download content on-demand'], expected: 'Keep app under 100MB' } },
                    { id: 'gaming', icon: '🎮', title: 'Game Assets', problem: 'Large textures and audio', solution: 'Smart asset compression', type: 'Mixed', details: { approach: 'Balance quality and performance', tips: ['Texture compression (DXT/ETC)', 'Audio compression (Ogg Vorbis)', 'Level-of-detail systems', 'Streaming large assets'], expected: '50-80% size reduction' } }
                ];
                
                dom.scenarioGrid.innerHTML = '';
                
                scenarios.forEach(scenario => {
                    const card = document.createElement('div');
                    card.className = 'scenario-card';
                    card.innerHTML = `
                        <h3>${scenario.icon} ${scenario.title}</h3>
                        <p><strong>Problem:</strong> ${scenario.problem}</p>
                        <p><strong>Solution:</strong> ${scenario.solution}</p>
                        <p><strong>Best Type:</strong> <span style="color: ${scenario.type.includes('Lossless') ? 'var(--success)' : 'var(--secondary)'};">${scenario.type}</span></p>
                    `;
                    card.addEventListener('click', (event) => selectScenario(scenario, event));
                    dom.scenarioGrid.appendChild(card);
                });
            }

            function initDemoSection() {
                compressText();
                initAudioVisualizer();
                drawColorCanvas();
            }
            
            function initAdvancedSection() {
                calculateEntropy();
            }

            function initQuiz() {
                quizQuestions = [
                    { question: "Which compression type can perfectly restore the original file?", options: ["Lossy", "Lossless", "Both", "Neither"], correct: 1, explanation: "Lossless compression preserves all data and can perfectly restore the original." },
                    { question: "Which format uses lossy compression?", options: ["ZIP", "PNG", "JPEG", "GIF"], correct: 2, explanation: "JPEG uses lossy compression to achieve smaller file sizes for photos." },
                    { question: "What is the main advantage of lossy compression?", options: ["Perfect quality", "Much smaller file sizes", "Reversible", "No data loss"], correct: 1, explanation: "Lossy compression achieves much smaller file sizes by removing some data." },
                    { question: "When should you NOT use lossy compression?", options: ["Streaming video", "Web images", "Data backups", "Music files"], correct: 2, explanation: "Data backups require lossless compression to preserve all information." },
                    { question: "What happens with generation loss?", options: ["File size increases", "Quality improves", "Quality degrades with each save", "Nothing changes"], correct: 2, explanation: "Each time a lossy file is edited and saved, quality degrades further." },
                    { question: "Which scenario benefits most from compression?", options: ["Local file storage", "Internet file transfer", "File editing", "File creation"], correct: 1, explanation: "Internet transfers benefit most due to bandwidth limitations." },
                    { question: "What does MP3 compression remove?", options: ["Low frequencies", "High frequencies humans can't hear well", "All frequencies equally", "No frequencies"], correct: 1, explanation: "MP3 uses psychoacoustic models to remove frequencies humans don't perceive well." },
                    { question: "Why do we need compression?", options: ["Only for old computers", "Storage, bandwidth, and cost savings", "To make files harder to read", "Just for fun"], correct: 1, explanation: "Compression addresses real constraints in storage, bandwidth, and costs." }
                ];
                dom.startQuiz.style.display = 'inline-block';
                dom.submitQuiz.style.display = 'none';
                dom.quizResults.style.display = 'none';
                dom.quizContainer.innerHTML = '<p>Click "Start Quiz" to begin!</p>';
            }
            
            // --- Specific Feature Functions ---

            // 'Why' Section
            function drawStorageVisualization() {
                const visual = dom.storageVisual;
                visual.innerHTML = ''; // Clear previous
                const uncompressedContainer = document.createElement('div');
                const compressedContainer = document.createElement('div');

                for(let i=0; i < 10; i++) {
                    const block = document.createElement('div');
                    block.className = 'file-block original-block';
                    uncompressedContainer.appendChild(block);
                }

                for(let i=0; i < 100; i++) {
                    const block = document.createElement('div');
                    block.className = 'file-block compressed-block small';
                    compressedContainer.appendChild(block);
                }
                visual.appendChild(uncompressedContainer);
                visual.appendChild(compressedContainer);
            }

            function drawBandwidthVisualization() {
                const canvas = dom.bandwidthCanvas;
                const ctx = canvas.getContext('2d');
                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    const time = Date.now() / 500; // Increased overall speed
                    ctx.strokeStyle = '#34495e';
                    ctx.lineWidth = 30;
                    ctx.beginPath(); ctx.moveTo(20, 50); ctx.lineTo(canvas.width - 20, 50); ctx.stroke();
                    ctx.beginPath(); ctx.moveTo(20, 130); ctx.lineTo(canvas.width - 20, 130); ctx.stroke();
                    for (let i = 0; i < 5; i++) {
                        // Uncompressed packets move at base speed
                        const x_slow = ((time * 20 + i * 60) % (canvas.width + 40)) - 20;
                        ctx.fillStyle = '#e74c3c'; ctx.fillRect(x_slow, 40, 20, 20);
                        
                        // Compressed packets move 2.5x faster
                        const x_fast = ((time * 50 + i * 60) % (canvas.width + 40)) - 20;
                        ctx.fillStyle = '#2ecc71'; ctx.fillRect(x_fast, 120, 10, 20);
                    }
                    ctx.fillStyle = '#fff'; ctx.font = '12px Arial';
                    ctx.fillText('Slow', 10, 30); ctx.fillText('Fast', 10, 110);
                    animationFrames.bandwidth = requestAnimationFrame(animate);
                };
                animate();
            }
            
            function drawCostVisualization() {
                const canvas = dom.costCanvas;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const barWidth = 80, maxHeight = canvas.height - 60;
                ctx.fillStyle = '#e74c3c'; ctx.fillRect(50, 40, barWidth, maxHeight * 0.9);
                ctx.fillStyle = '#2ecc71'; ctx.fillRect(170, 40 + maxHeight * 0.8, barWidth, maxHeight * 0.1);
                ctx.fillStyle = '#fff'; ctx.font = '14px Arial'; ctx.textAlign = 'center';
                ctx.fillText('$$$$$', 90, 30); ctx.fillText('$', 210, 30);
                ctx.fillText('Uncompressed', 90, canvas.height - 10); ctx.fillText('Compressed', 210, canvas.height - 10);
            }

            function calculateSavings() {
                const contentType = dom.contentType.value;
                const userCount = parseInt(dom.userCount.value);
                dom.userCountDisplay.textContent = userCount.toLocaleString();

                const dataProfiles = {
                    netflix: { baseUncompressed: 40, baseCompressed: 8, bandwidthFactor: 0.025, unit: 'GB' },
                    photos: { baseUncompressed: 5, baseCompressed: 0.5, bandwidthFactor: 0.0005, unit: 'GB' },
                    music: { baseUncompressed: 2.5, baseCompressed: 0.25, bandwidthFactor: 0.0002, unit: 'GB' },
                    backup: { baseUncompressed: 250, baseCompressed: 125, bandwidthFactor: 0.01, unit: 'GB' },
                    website: { baseUncompressed: 0.5, baseCompressed: 0.1, bandwidthFactor: 0.0001, unit: 'GB' }
                };

                const profile = dataProfiles[contentType];
                
                let scaleFactor = 1;
                if (contentType === 'photos' || contentType === 'music' || contentType === 'website' || contentType === 'backup') {
                    // These are per device/collection, not per user/month like Netflix
                    scaleFactor = 1; 
                }
                
                const totalUncompressed = profile.baseUncompressed * userCount * scaleFactor;
                const totalCompressed = profile.baseCompressed * userCount * scaleFactor;
                const totalBandwidth = profile.bandwidthFactor * userCount;

                const formatSize = (sizeInGB) => {
                    if (sizeInGB < 1) return `${(sizeInGB * 1024).toFixed(1)} MB`;
                    if (sizeInGB < 1024) return `${sizeInGB.toFixed(1)} GB`;
                    const tb = sizeInGB / 1024;
                    if (tb < 1024) return `${tb.toFixed(1)} TB`;
                    return `${(tb / 1024).toFixed(1)} PB`;
                };

                const formatBandwidth = (gbps) => {
                    if (gbps < 1) return `${(gbps * 1000).toFixed(0)} Mbps`;
                    return `${gbps.toFixed(1)} Gbps`;
                };
                
                const costPerGB = 0.023;
                const uncompressedCost = totalUncompressed * costPerGB;
                const compressedCost = totalCompressed * costPerGB;
                
                dom.uncompressedStorage.textContent = formatSize(totalUncompressed);
                dom.compressedStorage.textContent = formatSize(totalCompressed);
                dom.uncompressedBandwidth.textContent = formatBandwidth(totalBandwidth * 6);
                dom.compressedBandwidth.textContent = formatBandwidth(totalBandwidth);
                dom.uncompressedCost.textContent = `$${uncompressedCost.toLocaleString('en-US', {maximumFractionDigits: 0})}/mo`;
                dom.compressedCost.textContent = `$${compressedCost.toLocaleString('en-US', {maximumFractionDigits: 0})}/mo`;
            }

            // 'Types' Section
            function drawLosslessVisualization() {
                const canvas = dom.losslessCanvas;
                const ctx = canvas.getContext('2d');
                let frame = 0;
                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    const progress = (frame % 120) / 120;
                    const text = 'AAABBBCCC', compressed = '3A3B3C';
                    ctx.font = '20px monospace';
                    if (progress < 0.5) {
                        ctx.fillStyle = '#3498db'; ctx.fillText(text, 50, canvas.height / 2);
                    } else {
                        ctx.fillStyle = '#2ecc71'; ctx.fillText(compressed, 50, canvas.height / 2);
                        if (progress > 0.75) {
                            ctx.fillStyle = '#fff'; ctx.fillText('→', 150, canvas.height / 2);
                            ctx.fillStyle = '#3498db'; ctx.fillText(text, 180, canvas.height / 2);
                        }
                    }
                    frame++;
                    animationFrames.lossless = requestAnimationFrame(animate);
                };
                animate();
            }

            const updateLosslessDemo = debounce(() => {
                const input = dom.losslessInput.value;
                let compressed = '', i = 0;
                while (i < input.length) {
                    let count = 1;
                    const char = input[i];
                    while (i + count < input.length && input[i + count] === char) count++;
                    compressed += count > 1 ? count + char : char;
                    i += count;
                }
                dom.losslessResult.textContent = compressed;
            }, 300);

            function updateLossyDemo() {
                const quality = parseInt(dom.lossyQuality.value);
                dom.lossyQualityDisplay.textContent = quality + '%';
                const canvas = dom.lossyCanvas;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw a base gradient
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
                gradient.addColorStop(0, "magenta");
                gradient.addColorStop(0.5, "yellow");
                gradient.addColorStop(1, "cyan");
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Add blocky artifacts based on quality
                if (quality < 100) {
                    const blockSize = Math.max(2, 40 - quality * 0.38);
                    for (let y = 0; y < canvas.height; y += blockSize) {
                        for (let x = 0; x < canvas.width; x += blockSize) {
                            // Get average color of the block
                            const r = (Math.sin(x * 0.1) + 1) * 127;
                            const g = (Math.cos(y * 0.1) + 1) * 127;
                            const b = (Math.sin(x * 0.05 + y * 0.05) + 1) * 127;
                            ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${(100 - quality) / 100 * 0.5})`;
                            ctx.fillRect(x, y, blockSize, blockSize);
                        }
                    }
                }
            }
            
            // 'Comparison' Section
            function handleDragOver(e) { e.preventDefault(); e.currentTarget.classList.add('dragover'); }
            function handleDrop(e) { e.preventDefault(); e.currentTarget.classList.remove('dragover'); const file = e.dataTransfer.files[0]; if (file && file.type.startsWith('image/')) processImage(file); }
            function handleFileSelect(e) { const file = e.target.files[0]; if (file) processImage(file); }
            
            function processImage(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        uploadedImage = img;
                        dom.originalSize.textContent = formatFileSize(file.size);
                        dom.compressionDemo.style.display = 'block';
                        updateImageCompression();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }

            function loadDefaultImage() {
                const canvas = dom.originalImage;
                const ctx = canvas.getContext('2d');
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#9b59b6'); gradient.addColorStop(0.5, '#e74c3c'); gradient.addColorStop(1, '#3498db');
                ctx.fillStyle = gradient; ctx.fillRect(0, 0, canvas.width, canvas.height);
                for (let i = 0; i < 50; i++) {
                    ctx.fillStyle = `rgba(255, 255, 255, ${Math.random() * 0.5})`;
                    ctx.beginPath(); ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, Math.random() * 30 + 10, 0, Math.PI * 2); ctx.fill();
                }
                uploadedImage = canvas;
                dom.originalSize.textContent = '1.2 MB';
                dom.compressionDemo.style.display = 'block';
                updateImageCompression();
            }

            const updateImageCompression = debounce(() => {
                if (!uploadedImage) return;
                const level = parseInt(dom.compressionSlider.value);
                dom.compressionLevel.textContent = level;
                const origCtx = dom.originalImage.getContext('2d');
                const compCtx = dom.compressedImage.getContext('2d');
                if (uploadedImage instanceof HTMLImageElement) origCtx.drawImage(uploadedImage, 0, 0, dom.originalImage.width, dom.originalImage.height);
                else origCtx.drawImage(uploadedImage, 0, 0);
                
                compCtx.drawImage(dom.originalImage, 0, 0);
                
                if (level > 0) {
                    const imageData = compCtx.getImageData(0, 0, dom.compressedImage.width, dom.compressedImage.height);
                    const data = imageData.data;
                    const blockSize = Math.max(2, Math.floor(level / 10));
                    for (let y = 0; y < dom.compressedImage.height; y += blockSize) {
                        for (let x = 0; x < dom.compressedImage.width; x += blockSize) {
                            let r = 0, g = 0, b = 0, count = 0;
                            for (let by = 0; by < blockSize && y + by < dom.compressedImage.height; by++) {
                                for (let bx = 0; bx < blockSize && x + bx < dom.compressedImage.width; bx++) {
                                    const i = ((y + by) * dom.compressedImage.width + (x + bx)) * 4;
                                    r += data[i]; g += data[i + 1]; b += data[i + 2]; count++;
                                }
                            }
                            if (count > 0) {
                                r /= count; g /= count; b /= count;
                                for (let by = 0; by < blockSize && y + by < dom.compressedImage.height; by++) {
                                    for (let bx = 0; bx < blockSize && x + bx < dom.compressedImage.width; bx++) {
                                        const i = ((y + by) * dom.compressedImage.width + (x + bx)) * 4;
                                        data[i] = r; data[i + 1] = g; data[i + 2] = b;
                                    }
                                }
                            }
                        }
                    }
                    compCtx.putImageData(imageData, 0, 0);
                }
                const originalSize = 1.2 * 1024 * 1024;
                const compressedSize = originalSize * (1 - level / 110);
                const quality = 100 - level;
                dom.compressedSize.textContent = formatFileSize(compressedSize);
                dom.compressedQuality.textContent = quality.toFixed(0) + '%';
                dom.compressionRatio.style.width = `${100 - (compressedSize / originalSize * 100)}%`;
                dom.spaceSavedPercent.textContent = (100 - (compressedSize / originalSize * 100)).toFixed(0) + '%';
                const type = level < 10 ? 'Near-Lossless' : 'Lossy (JPEG)';
                dom.compressionType.textContent = type;
                dom.compressedTitle.textContent = level > 70 ? 'Heavily Compressed' : 'Compressed';
            }, 100);

            function formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' B';
                if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
                return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            }

            // 'Scenarios' Section
            function selectScenario(scenario, event) {
                document.querySelectorAll('.scenario-card').forEach(card => card.classList.remove('selected'));
                event.currentTarget.classList.add('selected');
                dom.scenarioDetails.style.display = 'block';
                dom.scenarioTitle.textContent = `${scenario.icon} ${scenario.title} - Detailed Strategy`;
                dom.scenarioContent.innerHTML = `<p><strong>Recommended Approach:</strong> ${scenario.details.approach}</p><ul style="list-style: none; padding: 10px;">${scenario.details.tips.map(tip => `<li>• ${tip}</li>`).join('')}</ul><p><strong>Expected Results:</strong> ${scenario.details.expected}</p>`;
                dom.scenarioDemo.innerHTML = createScenarioDemo(scenario.id);
                attachScenarioListeners(scenario.id);
            }

            function createScenarioDemo(id) {
                switch(id) {
                    case 'email': return `<label for="emailFileSize">File Size (MB):</label><input type="range" id="emailFileSize" min="1" max="100" value="50"><p>Original Size: <span id="emailOriginal">50</span> MB</p><p>After ZIP: ~<span id="emailCompressed">25</span> MB</p><p id="emailStatus" style="color: var(--success);">✓ Can be emailed</p>`;
                    case 'web': return `<p>Image Optimization Preview:</p><canvas id="webOptCanvas" width="300" height="150"></canvas><label for="webQuality">Quality:</label><input type="range" id="webQuality" min="10" max="100" value="85"><p>Quality: <span id="webQualityValue">85%</span></p><p>File Size: <span id="webFileSize">180 KB</span></p>`;
                    case 'backup': return `<label for="backupType">File Type Mix:</label><input type="range" id="backupType" min="0" max="100" value="50"><p>Text/Docs: <span id="backupTextPercent">50</span>% | Media: <span id="backupMediaPercent">50</span>%</p><p>Estimated Compression: <span id="backupRatio" class="highlight">~60%</span> reduction</p>`;
                    case 'streaming': return `<label for="streamQuality">Select Quality:</label><select id="streamQuality"><option value="4k">4K (20 Mbps)</option><option value="1080p" selected>1080p (5 Mbps)</option><option value="720p">720p (2.5 Mbps)</option><option value="360p">360p (1 Mbps)</option></select><p>Data per hour: <span id="streamData" class="highlight">2.25 GB</span></p>`;
                    case 'mobile': return `<p>Total App Size: <span id="mobileSize" class="highlight">50 MB</span></p><label for="mobileOptimize">Optimization Level:</label><input type="range" id="mobileOptimize" min="0" max="100" value="50"><p id="mobileStatus" style="color:var(--success)">✓ Good size</p>`;
                    case 'gaming': return `<label for="textureSize">Texture Resolution:</label><select id="textureSize"><option value="4k">4K Textures (High VRAM)</option><option value="2k" selected>2K Textures (Standard)</option><option value="1k">1K Textures (Performance)</option></select><p>Asset Size: <span id="gameAssetSize" class="highlight">~250 MB</span></p>`;
                    default: return '<p>Interactive demo for this scenario coming soon!</p>';
                }
            }

            function attachScenarioListeners(id) {
                const emailSlider = document.getElementById('emailFileSize');
                if (emailSlider) emailSlider.addEventListener('input', e => {
                    const size = parseInt(e.target.value);
                    document.getElementById('emailOriginal').textContent = size;
                    const compressed = size * 0.5;
                    document.getElementById('emailCompressed').textContent = compressed.toFixed(0);
                    const status = document.getElementById('emailStatus');
                    status.textContent = compressed <= 25 ? '✓ Can be emailed' : '✗ Too large for email';
                    status.style.color = compressed <= 25 ? 'var(--success)' : 'var(--secondary)';
                });

                const webSlider = document.getElementById('webQuality');
                if (webSlider) {
                    const handler = e => {
                        const quality = parseInt(e.target.value);
                        document.getElementById('webQualityValue').textContent = quality + '%';
                        document.getElementById('webFileSize').textContent = (20 + (380 * (quality / 100))).toFixed(0) + ' KB';
                        const canvas = document.getElementById('webOptCanvas');
                        const ctx = canvas.getContext('2d');
                        ctx.clearRect(0,0, canvas.width, canvas.height);
                        
                        const gradient = ctx.createLinearGradient(0,0,canvas.width,0);
                        gradient.addColorStop(0, '#ff0000'); gradient.addColorStop(1, '#00ff00');
                        ctx.fillStyle = gradient; ctx.fillRect(0,0,canvas.width,canvas.height);

                        const blockSize = Math.max(1, 40 - quality * 0.39);
                        if (quality < 100) {
                            for (let y = 0; y < canvas.height; y += blockSize) {
                                for (let x = 0; x < canvas.width; x += blockSize) {
                                    const r = (Math.sin(x * 0.1) + 1) * 127;
                                    const g = (Math.cos(y * 0.1) + 1) * 127;
                                    const b = (Math.sin(x * 0.05 + y * 0.05) + 1) * 127;
                                    ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
                                    ctx.fillRect(x, y, blockSize, blockSize);
                                }
                            }
                        }
                    };
                    webSlider.addEventListener('input', handler);
                    handler({target: webSlider});
                }
                
                const backupSlider = document.getElementById('backupType');
                if (backupSlider) backupSlider.addEventListener('input', e => {
                    const textPercent = parseInt(e.target.value);
                    const mediaPercent = 100 - textPercent;
                    document.getElementById('backupTextPercent').textContent = textPercent;
                    document.getElementById('backupMediaPercent').textContent = mediaPercent;
                    const ratio = (textPercent * 0.75 + mediaPercent * 0.2) / 100; // Text compresses better
                    document.getElementById('backupRatio').textContent = `~${(ratio * 100).toFixed(0)}% reduction`;
                });

                const streamSelect = document.getElementById('streamQuality');
                if(streamSelect) streamSelect.addEventListener('change', e => {
                    const values = {'4k': 20, '1080p': 5, '720p': 2.5, '360p': 1};
                    const data = values[e.target.value] * 3600 / 8 / 1000; // Mbps to GB/hr
                    document.getElementById('streamData').textContent = `${data.toFixed(2)} GB`;
                });

                const mobileSlider = document.getElementById('mobileOptimize');
                if(mobileSlider) mobileSlider.addEventListener('input', e => {
                    const size = 100 - parseInt(e.target.value) * 0.8; // 100MB down to 20MB
                    document.getElementById('mobileSize').textContent = `${size.toFixed(0)} MB`;
                     const status = document.getElementById('mobileStatus');
                    status.textContent = size <= 50 ? '✓ Good size' : '✗ May be too large';
                    status.style.color = size <= 50 ? 'var(--success)' : 'var(--warning)';
                });

                 const textureSelect = document.getElementById('textureSize');
                 if(textureSelect) textureSelect.addEventListener('change', e => {
                     const sizes = {'4k': '1 GB', '2k': '~250 MB', '1k': '~60 MB'};
                     document.getElementById('gameAssetSize').textContent = sizes[e.target.value];
                 });
            }

            // 'Demo' Section
            const compressText = debounce(() => {
                const input = dom.textInput.value;
                const method = dom.compressionMethod.value;
                let compressed = '';
                if (method === 'rle') compressed = runLengthEncode(input);
                else if (method === 'huffman') compressed = simulateHuffman(input);
                else if (method === 'dictionary') compressed = dictionaryCompress(input);
                
                const originalSize = new Blob([input]).size;
                const compressedSize = new Blob([compressed]).size;
                const compressionRatio = originalSize > 0 && compressedSize > 0 ? originalSize / compressedSize : 1;
                
                dom.originalTextSize.textContent = originalSize;
                dom.compressedTextSize.textContent = compressedSize;
                dom.textCompressionRatio.textContent = `${compressionRatio.toFixed(2)}:1`;
                
                const pre = document.createElement('pre');
                pre.textContent = compressed;
                dom.compressedOutput.innerHTML = '';
                dom.compressedOutput.appendChild(pre);
                
                const percentage = originalSize > 0 ? ((originalSize - compressedSize) / originalSize * 100) : 0;
                dom.textCompressionBar.style.width = `${Math.max(0, Math.min(100, percentage))}%`;
            }, 300);

            function runLengthEncode(input) {
                return input.replace(/(.)\1+/g, (match, char) => `${char}${match.length}`);
            }

            function simulateHuffman(input) {
                const freq = {};
                for (let char of input) freq[char] = (freq[char] || 0) + 1;
                const codes = {}, sorted = Object.entries(freq).sort((a, b) => b[1] - a[1]);
                sorted.forEach((entry, index) => { codes[entry[0]] = index.toString(2); });
                let result = 'Huffman Codes (Simulation):\n';
                for (let [char, code] of Object.entries(codes)) result += `'${char}' -> ${code}\n`;
                return result;
            }

            function dictionaryCompress(input) {
                const words = input.split(/(\s+)/);
                const dictionary = {}; let dictIndex = 1;
                const compressed = words.map(word => {
                    if (!/\s+/.test(word) && word.length > 2) {
                        if (!dictionary[word]) dictionary[word] = dictIndex++;
                        return `[${dictionary[word]}]`;
                    }
                    return word;
                }).join('');
                let dictString = 'Dictionary: ';
                for(const [key, val] of Object.entries(dictionary)){ dictString += `[${val}:${key}] `}
                return `${dictString}\n\n${compressed}`;
            }

            function initAudioVisualizer() {
                const barCount = 64;
                dom.audioVisualizer.innerHTML = '';
                for (let i = 0; i < barCount; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'audio-bar';
                    dom.audioVisualizer.appendChild(bar);
                }
                updateAudioCompression();
            }

            function updateAudioCompression() {
                const bitrate = parseInt(dom.bitrateSlider.value);
                dom.bitrateValue.textContent = bitrate;
                const bars = dom.audioVisualizer.querySelectorAll('.audio-bar');
                const maxFreqIndex = Math.floor(bitrate / 320 * bars.length);
                
                bars.forEach((bar, index) => {
                    if (index < maxFreqIndex) {
                        const baseHeight = (Math.sin(index / 10) ** 2) * 70 + (Math.cos(index / 3) ** 2) * 30;
                        const distortion = (1 - bitrate / 320) * (Math.random() - 0.5) * 30;
                        bar.style.height = `${Math.max(0, baseHeight + distortion)}%`;
                        bar.style.opacity = '1';
                    } else {
                        bar.style.height = '0%'; bar.style.opacity = '0.3';
                    }
                });
                
                const fileSize = (3 * 60 * bitrate / 8 / 1024).toFixed(1);
                dom.audioFileSize.textContent = `${fileSize} MB`;
                let quality = 'Poor';
                if (bitrate >= 256) quality = 'Excellent';
                else if (bitrate >= 192) quality = 'Very Good';
                else if (bitrate >= 128) quality = 'Good';
                else if (bitrate >= 96) quality = 'Acceptable';
                dom.audioQuality.textContent = quality;
                dom.audioFrequency.textContent = `${Math.min(20, bitrate / 16 + 4).toFixed(1)} kHz`;
            }

            function drawColorCanvas() {
                const ctx = dom.colorCanvas.getContext('2d');
                const gradient = ctx.createLinearGradient(0, 0, dom.colorCanvas.width, dom.colorCanvas.height);
                gradient.addColorStop(0, '#ff0000'); gradient.addColorStop(0.15, '#ffff00');
                gradient.addColorStop(0.33, '#00ff00'); gradient.addColorStop(0.5, '#00ffff');
                gradient.addColorStop(0.66, '#0000ff'); gradient.addColorStop(0.85, '#ff00ff');
                gradient.addColorStop(1, '#ff0000');
                ctx.fillStyle = gradient; ctx.fillRect(0, 0, dom.colorCanvas.width, dom.colorCanvas.height);
                updateColorDepth();
            }

            function updateColorDepth() {
                const ctx = dom.colorCanvas.getContext('2d');
                const bits = parseInt(dom.colorBits.value);
                const dithering = dom.ditheringEnabled.checked;
                
                // Redraw base image
                const gradient = ctx.createLinearGradient(0, 0, dom.colorCanvas.width, dom.colorCanvas.height);
                gradient.addColorStop(0, '#ff0000'); gradient.addColorStop(0.15, '#ffff00');
                gradient.addColorStop(0.33, '#00ff00'); gradient.addColorStop(0.5, '#00ffff');
                gradient.addColorStop(0.66, '#0000ff'); gradient.addColorStop(0.85, '#ff00ff');
                gradient.addColorStop(1, '#ff0000');
                ctx.fillStyle = gradient; ctx.fillRect(0, 0, dom.colorCanvas.width, dom.colorCanvas.height);

                const imageData = ctx.getImageData(0, 0, dom.colorCanvas.width, dom.colorCanvas.height);
                if (bits < 24) reduceColorDepth(imageData.data, bits, dom.colorCanvas.width, dom.colorCanvas.height, dithering);
                ctx.putImageData(imageData, 0, 0);
                
                const stats = { '24': ['16.7M', '360 KB'], '16': ['65K', '240 KB'], '8': ['256', '120 KB'], '4': ['16', '60 KB'], '1': ['2', '15 KB'] };
                const [colors, fileSize] = stats[bits];
                dom.colorCount.textContent = colors;
                dom.colorFileSize.textContent = fileSize;
            }

            function reduceColorDepth(data, bits, width, height, useDithering) {
                const R_BITS = Math.ceil(bits / 3);
                const G_BITS = Math.floor(bits / 3);
                const B_BITS = Math.round(bits / 3);
                const R_LEVELS = 1 << R_BITS;
                const G_LEVELS = 1 << G_BITS;
                const B_LEVELS = 1 << B_BITS;
                const R_FACTOR = 255 / (R_LEVELS - 1);
                const G_FACTOR = 255 / (G_LEVELS - 1);
                const B_FACTOR = 255 / (B_LEVELS - 1);

                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        const i = (y * width + x) * 4;
                        const oldR = data[i], oldG = data[i+1], oldB = data[i+2];
                        const newR = Math.round(oldR / R_FACTOR) * R_FACTOR;
                        const newG = Math.round(oldG / G_FACTOR) * G_FACTOR;
                        const newB = Math.round(oldB / B_FACTOR) * B_FACTOR;
                        data[i] = newR; data[i+1] = newG; data[i+2] = newB;

                        if (useDithering) {
                            const errR = oldR - newR, errG = oldG - newG, errB = oldB - newB;
                            const dither = (dx, dy, factor) => {
                                const ni = ((y + dy) * width + (x + dx)) * 4;
                                if(data[ni] === undefined) return;
                                data[ni]   += errR * factor;
                                data[ni+1] += errG * factor;
                                data[ni+2] += errB * factor;
                            };
                            dither(1, 0, 7/16);
                            dither(-1, 1, 3/16);
                            dither(0, 1, 5/16);
                            dither(1, 1, 1/16);
                        }
                    }
                }
            }
            
            // 'Advanced' Section
            function calculateEntropy() {
                const input = dom.entropyInput.value;
                if (!input) { dom.entropyValue.textContent = '-'; dom.minBits.textContent = '-'; dom.entropyExplanation.textContent = ''; return; }
                const freq = {};
                for (let char of input) freq[char] = (freq[char] || 0) + 1;
                let entropy = 0;
                const len = input.length;
                for (let count of Object.values(freq)) {
                    const p = count / len;
                    if (p > 0) entropy -= p * Math.log2(p);
                }
                dom.entropyValue.textContent = entropy.toFixed(3);
                dom.minBits.textContent = (entropy * len).toFixed(0);
                dom.entropyExplanation.textContent = `On average, each character in this text needs at least ${entropy.toFixed(2)} bits to be represented. Lower entropy means more redundancy and better compressibility.`;
            }

            // 'Quiz' Section
            function startQuiz() {
                dom.quizContainer.innerHTML = '';
                quizAnswers = {};
                quizQuestions.forEach((q, index) => {
                    const qDiv = document.createElement('div');
                    qDiv.style.marginBottom = '30px';
                    const qTitle = document.createElement('h3');
                    qTitle.textContent = `Question ${index + 1}`;
                    const qText = document.createElement('p');
                    qText.style.margin = '15px 0';
                    qText.textContent = q.question;
                    qDiv.appendChild(qTitle);
                    qDiv.appendChild(qText);
                    const optionsDiv = document.createElement('div');
                    optionsDiv.id = `question${index}`;
                    q.options.forEach((opt, i) => {
                        const optDiv = document.createElement('div');
                        optDiv.className = 'quiz-option';
                        optDiv.textContent = opt;
                        optDiv.addEventListener('click', () => selectQuizAnswer(index, i));
                        optionsDiv.appendChild(optDiv);
                    });
                    qDiv.appendChild(optionsDiv);
                    dom.quizContainer.appendChild(qDiv);
                });
                dom.submitQuiz.style.display = 'inline-block';
                dom.startQuiz.style.display = 'none';
                dom.quizResults.style.display = 'none';
            }

            function selectQuizAnswer(questionIndex, optionIndex) {
                quizAnswers[questionIndex] = optionIndex;
                const options = document.querySelectorAll(`#question${questionIndex} .quiz-option`);
                options.forEach((opt, i) => {
                    opt.style.background = '';
                    opt.style.borderColor = '';
                    if (i === optionIndex) {
                        opt.style.background = 'rgba(155, 89, 182, 0.2)';
                        opt.style.borderColor = 'var(--primary)';
                    }
                });
            }

            function showQuizResults() {
                let correct = 0;
                dom.quizFeedback.innerHTML = '<h4>Detailed Results:</h4>';
                quizQuestions.forEach((q, index) => {
                    const userAnswer = quizAnswers[index];
                    const isCorrect = userAnswer === q.correct;
                    if (isCorrect) correct++;
                    const options = document.querySelectorAll(`#question${index} .quiz-option`);
                    options.forEach((opt, i) => {
                        if (i === q.correct) opt.classList.add('correct');
                        else if (i === userAnswer && !isCorrect) opt.classList.add('incorrect');
                    });
                    const feedbackP = document.createElement('p');
                    feedbackP.innerHTML = `<strong>Q${index + 1}:</strong> ${isCorrect ? '✅ Correct' : '❌ Incorrect'}<br><small style="color: var(--text-secondary);">${q.explanation}</small>`;
                    dom.quizFeedback.appendChild(feedbackP);
                });
                const score = quizQuestions.length > 0 ? Math.round((correct / quizQuestions.length) * 100) : 0;
                dom.quizScore.textContent = score;
                dom.scoreBar.style.width = `${score}%`;
                dom.quizResults.style.display = 'block';
                dom.quizResults.scrollIntoView({ behavior: 'smooth' });
            }

            function retryQuiz() {
                initQuiz();
                startQuiz();
            }

            // --- Initializer ---
            const initializeApp = () => {
                setupEventListeners();
                initWhySection();
            };

            initializeApp();
        });
    </script>
</body>
</html>
