<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Connection Modes - Interactive Learning Lab</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        :root {
            --primary-bg: #0a0e27;
            --secondary-bg: #1a1f3a;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-purple: #8b5cf6;
            --accent-orange: #f59e0b;
            --error-red: #ef4444;
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --ethernet-color: #10b981;
            --wifi-color: #3b82f6;
            --bluetooth-color: #8b5cf6;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--primary-bg) 0%, var(--secondary-bg) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease-out;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .score-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(26, 31, 58, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            min-width: 200px;
            z-index: 100;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .score-value {
            color: var(--accent-green);
            font-weight: bold;
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .nav-tab {
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-tab:hover:not(:disabled) {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }
        
        .nav-tab.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: white;
        }
        
        .nav-tab:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .content-section {
            background: rgba(26, 31, 58, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            animation: fadeIn 0.5s ease-out;
        }
        
        .simulation-area {
            background: rgba(10, 14, 39, 0.8);
            border-radius: 12px;
            padding: 30px;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }
        
        .device-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 30px;
            margin: 30px 0;
        }
        
        .device {
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .device:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .device.selected {
            border-color: var(--accent-green);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }
        
        .network-device {
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
            position: relative;
        }
        
        .device-card {
            background: var(--secondary-bg);
            border: 3px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            min-width: 120px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .network-device.selected .device-card {
            border-color: var(--accent-green);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
            transform: scale(1.05);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .network-device.connected .device-card {
            border-color: var(--accent-blue);
        }
        
        .network-device.source .device-card {
            border-color: var(--accent-orange);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);
        }
        
        .device-status {
            font-size: 0.85rem;
            margin-top: 5px;
            padding: 2px 8px;
            border-radius: 12px;
            background: rgba(239, 68, 68, 0.2);
            color: var(--error-red);
        }
        
        .device-status.online {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
        }
        
        .device-ports {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .port {
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .connection-tutorial {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid var(--accent-blue);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .connection-tutorial h3 {
            margin-bottom: 10px;
            color: var(--accent-blue);
        }
        
        .connection-tutorial ol {
            margin-left: 20px;
            color: var(--text-secondary);
        }
        
        .connection-tutorial li {
            margin: 5px 0;
        }
        
        .connection-modal {
            position: absolute;
            background: var(--secondary-bg);
            border: 2px solid var(--accent-blue);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            min-width: 300px;
        }
        
        .connection-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .connection-option {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid var(--border-color);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .connection-option:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--accent-blue);
            transform: translateX(5px);
        }
        
        .connection-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .connection-option.disabled:hover {
            transform: none;
            background: rgba(59, 130, 246, 0.1);
        }
        
        .active-connections-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .connection-item {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .connection-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .connection-quality {
            display: flex;
            gap: 5px;
        }
        
        .quality-bar {
            width: 4px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }
        
        .quality-bar.active {
            background: var(--accent-green);
        }
        
        .quality-bar.medium {
            background: var(--accent-orange);
        }
        
        .quality-bar.poor {
            background: var(--error-red);
        }
        
        .connection-details {
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .detail-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .detail-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-blue);
        }
        
        .educational-panel {
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid var(--accent-orange);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .learning-content {
            margin-top: 10px;
            line-height: 1.6;
        }
        
        .learning-content ul {
            margin: 10px 0 10px 20px;
        }
        
        .learning-content li {
            margin: 5px 0;
        }
        
        .connection-animation {
            position: absolute;
            pointer-events: none;
            z-index: 50;
        }
        
        .data-flow {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--accent-orange);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--accent-orange);
            animation: dataFlow 2s linear infinite;
        }
        
        @keyframes dataFlow {
            0% { opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .connection-line {
            position: absolute;
            height: 3px;
            transform-origin: left center;
            pointer-events: none;
            z-index: 1;
        }
        
        .connection-line.ethernet {
            background: var(--ethernet-color);
            height: 4px;
        }
        
        .connection-line.wifi {
            background: repeating-linear-gradient(
                90deg,
                var(--wifi-color),
                var(--wifi-color) 10px,
                transparent 10px,
                transparent 20px
            );
            animation: wifiPulse 2s linear infinite;
        }
        .device-icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }
        
        .router-position .device-icon,
        .test-device .device-icon,
        .central-router .device-icon {
            font-size: 3rem;
        }
        
        .device-name {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .device-info {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        @keyframes wifiPulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        @keyframes bluetoothPulse {
            0% { background-position: 0 0; }
            100% { background-position: 20px 0; }
        }
        
        .device-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .device-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .device-info {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-card {
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .comparison-card h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .feature-list {
            list-style: none;
        }
        
        .feature-list li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .feature-list .pro {
            color: var(--accent-green);
        }
        
        .feature-list .con {
            color: var(--error-red);
        }
        
        .scenario-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
            border: 2px solid var(--accent-blue);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .scenario-requirements {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .scenario-requirements li {
            padding: 5px 0;
            color: var(--text-secondary);
        }
        
        .choice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .choice-btn {
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            padding: 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            color: white;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .choice-btn:hover:not(:disabled) {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }
        
        .choice-btn.correct {
            background: rgba(16, 185, 129, 0.2);
            border-color: var(--accent-green);
            animation: correctPulse 0.5s ease-out;
        }
        
        .choice-btn.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--error-red);
            animation: shake 0.5s ease-out;
        }
        
        .choice-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .quiz-container {
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .quiz-question {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--accent-green);
        }
        
        .speed-meter {
            position: relative;
            height: 150px;
            margin: 20px 0;
        }
        
        .speed-bar {
            position: absolute;
            bottom: 0;
            width: 60px;
            background: linear-gradient(to top, var(--accent-blue), var(--accent-green));
            border-radius: 4px;
            transition: height 0.5s ease-out;
        }
        
        .speed-label {
            position: absolute;
            bottom: -25px;
            width: 60px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .interactive-demo {
            background: rgba(10, 14, 39, 0.6);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .network-canvas {
            position: relative;
            min-height: 500px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            margin: 20px 0;
            overflow: visible;
        }
        
        .data-packet {
            position: absolute;
            width: 16px;
            height: 16px;
            background: radial-gradient(circle, #fbbf24, #f59e0b);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.8);
            z-index: 15;
            pointer-events: none;
            transition: none;
        }
        
        .signal-wave {
            position: absolute;
            border: 2px solid var(--wifi-color);
            border-radius: 50%;
            opacity: 0;
            animation: signalWave 2s infinite;
        }
        
        @keyframes signalWave {
            0% {
                width: 20px;
                height: 20px;
                opacity: 1;
            }
            100% {
                width: 100px;
                height: 100px;
                opacity: 0;
            }
        }
        
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: -400px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #000;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: right 0.5s ease-out;
            z-index: 1000;
            max-width: 350px;
        }
        
        .achievement-popup.show {
            right: 20px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-blue);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            height: 8px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-green));
            transition: width 0.5s ease-out;
        }
        
        .hint-box {
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid var(--accent-orange);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }
        
        .hint-box.show {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }
        
        .btn {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover:not(:disabled) {
            background: var(--accent-green);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn:focus {
            outline: 3px solid rgba(59, 130, 246, 0.5);
            outline-offset: 2px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-blue);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .lab-experiment-selector {
            margin-bottom: 30px;
        }
        
        .experiment-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .experiment-card {
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .experiment-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-blue);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .experiment-card.active {
            border-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .experiment-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .experiment-status {
            margin-top: 10px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            background: var(--accent-blue);
            color: white;
        }
        
        .experiment-area {
            margin-top: 30px;
        }
        
        .experiment-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
        }
        
        .experiment-header {
            margin-bottom: 30px;
        }
        
        .experiment-setup {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid var(--accent-blue);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .hypothesis-box {
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid var(--accent-orange);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .ranking-inputs {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }
        
        .rank-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .rank-item span {
            min-width: 120px;
        }
        
        .rank-item select {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            color: white;
        }
        
        .experiment-workspace {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
        }
        
        .test-devices {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: center;
            margin: 30px 0;
        }
        
        .test-device {
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .test-device .device-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .file-icon {
            margin-top: 10px;
            font-size: 1.2rem;
            color: var(--accent-orange);
        }
        
        .connection-area {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 150px;
        }
        
        .connection-placeholder {
            text-align: center;
        }
        
        .connection-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .active-connection {
            position: relative;
            width: 100%;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .connection-visual {
            position: absolute;
            width: 100%;
            height: 4px;
            background: var(--accent-blue);
        }
        
        .connection-visual.ethernet {
            background: var(--ethernet-color);
            height: 6px;
        }
        
        .connection-visual.wifi::after {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            border: 3px solid var(--wifi-color);
            border-radius: 50%;
            animation: wifiPulse 2s infinite;
        }
        
        .connection-visual.bluetooth::after {
            content: '🔷';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            animation: bluetoothPulse 1s infinite;
        }
        
        @keyframes bluetoothPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .transfer-animation {
            margin-top: 20px;
        }
        
        .transfer-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .results-area {
            margin-top: 30px;
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--accent-green);
            border-radius: 12px;
            padding: 20px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .result-card {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
        }
        
        .result-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .result-stats div {
            padding: 3px 0;
            font-size: 0.9rem;
        }
        
        .experiment-conclusion {
            margin-top: 30px;
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid var(--accent-orange);
            border-radius: 12px;
            padding: 20px;
        }
        
        .conclusion-results {
            margin: 20px 0;
        }
        
        .hypothesis-result {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .hypothesis-result.correct {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid var(--accent-green);
            color: var(--accent-green);
        }
        
        .hypothesis-result.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid var(--error-red);
            color: var(--error-red);
        }
        
        .key-learnings {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .range-test-area {
            position: relative;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
        }
        
        .range-grid {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        .router-position {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            text-align: center;
        }
        
        .range-rings {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        
        .range-ring {
            position: absolute;
            border: 2px dashed rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }
        
        .test-device-movable {
            position: absolute;
            transform: translate(-50%, -50%);
            text-align: center;
            transition: all 0.5s ease;
            z-index: 10;
        }
        
        .signal-strength {
            display: flex;
            gap: 3px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .signal-bar {
            width: 4px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        
        .signal-bar.active {
            background: var(--accent-green);
        }
        
        .range-controls {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .distance-slider {
            margin: 20px 0;
        }
        
        .distance-slider input {
            width: 100%;
        }
        
        .distance-label {
            text-align: center;
            margin-top: 10px;
        }
        
        .connection-selector {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .connection-selector label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .range-results {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
        }
        
        .finding-item {
            padding: 10px;
            margin: 5px 0;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .interference-test-area {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
        }
        
        .device-pair {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            align-items: center;
            margin: 30px 0;
        }
        
        .obstacle-zone {
            border: 3px dashed rgba(245, 158, 11, 0.5);
            border-radius: 12px;
            min-height: 150px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
            align-items: center;
            justify-content: center;
        }
        
        .obstacle {
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            position: relative;
            animation: fadeIn 0.3s ease;
        }
        
        .remove-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--error-red);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
        }
        
        .signal-meter {
            margin: 30px 0;
            text-align: center;
        }
        
        .quality-display {
            margin-top: 15px;
        }
        
        .quality-percentage {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .quality-bar-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 30px;
            overflow: hidden;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .quality-bar-fill {
            height: 100%;
            background: var(--accent-green);
            transition: all 0.5s ease;
        }
        
        .obstacle-selector {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .obstacle-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .obstacle-btn {
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            color: white;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .obstacle-btn:hover {
            background: rgba(245, 158, 11, 0.2);
            border-color: var(--accent-orange);
        }
        
        .interference-results {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
        }
        
        .log-entry {
            padding: 8px;
            margin: 5px 0;
            background: rgba(245, 158, 11, 0.1);
            border-radius: 6px;
            animation: fadeIn 0.3s ease;
        }
        
        .load-test-area {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
        }
        
        .network-diagram {
            position: relative;
            height: 300px;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }
        
        .central-router {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
        }
        
        .router-stats {
            margin-top: 10px;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px;
            border-radius: 6px;
        }
        
        .connected-devices {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .load-test-device {
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            width: 80px;
        }
        
        .load-controls {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .device-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .performance-metrics {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-blue);
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .score-panel {
                position: static;
                margin-bottom: 20px;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
            
            .device-container {
                grid-template-columns: 1fr;
            }
            
            .experiment-cards {
                grid-template-columns: 1fr;
            }
            
            .test-devices {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .device-pair {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🌐 Network Connection Modes Lab</h1>
            <p>Master Ethernet, Wi-Fi, and Bluetooth Technologies!</p>
        </header>
        
        <aside class="score-panel" role="complementary" aria-label="Score panel">
            <div class="score-item">
                <span>⭐ Score</span>
                <span class="score-value" id="score">0</span>
            </div>
            <div class="score-item">
                <span>🎯 Level</span>
                <span class="score-value" id="level">1</span>
            </div>
            <div class="score-item">
                <span>🏆 Achievements</span>
                <span class="score-value" id="achievements">0</span>
            </div>
            <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                <div class="progress-fill" id="progress" style="width: 0%"></div>
            </div>
        </aside>
        
        <nav class="nav-tabs" role="tablist">
            <button class="nav-tab active" role="tab" aria-selected="true" data-mode="explore">
                🔍 Explore
            </button>
            <button class="nav-tab" role="tab" aria-selected="false" data-mode="compare">
                ⚖️ Compare
            </button>
            <button class="nav-tab" role="tab" aria-selected="false" data-mode="scenarios">
                🎯 Scenarios
            </button>
            <button class="nav-tab" role="tab" aria-selected="false" data-mode="quiz">
                ❓ Quiz
            </button>
            <button class="nav-tab" role="tab" aria-selected="false" data-mode="lab">
                🧪 Lab
            </button>
            <button class="nav-tab" role="tab" aria-selected="false" data-mode="challenge">
                🏆 Challenge
            </button>
        </nav>
        
        <main id="content" class="content-section" role="main">
            <!-- Dynamic content will be loaded here -->
        </main>
        
        <div class="achievement-popup" id="achievementPopup" role="alert" aria-live="assertive">
            <h3>🏆 Achievement Unlocked!</h3>
            <p id="achievementText"></p>
        </div>
    </div>
    
    <script>
        'use strict';
        
        // Constants
        const CONFIG = Object.freeze({
            ANIMATION_DURATION: 1000,
            PACKET_SPEED: 2,
            WIFI_RANGE: 300,
            BLUETOOTH_RANGE: 100,
            ACHIEVEMENT_DISPLAY_TIME: 5000,
            DEBOUNCE_DELAY: 250,
            MAX_DEVICES: 6,
            SIGNAL_INTERVAL: 2000
        });
        
        const CONNECTION_TYPES = Object.freeze({
            ETHERNET: 'ethernet',
            WIFI: 'wifi',
            BLUETOOTH: 'bluetooth'
        });
        
        const CONNECTION_SPECS = Object.freeze({
            [CONNECTION_TYPES.ETHERNET]: {
                name: 'Ethernet',
                icon: '🔌',
                color: '#10b981',
                speed: 1000, // Mbps
                range: 'Unlimited (cable length)',
                latency: 1, // ms
                reliability: 99.9,
                security: 'High',
                cost: 'Medium',
                setup: 'Easy',
                mobility: 'None'
            },
            [CONNECTION_TYPES.WIFI]: {
                name: 'Wi-Fi',
                icon: '📶',
                color: '#3b82f6',
                speed: 600, // Mbps (Wi-Fi 6)
                range: '50-100m',
                latency: 5, // ms
                reliability: 95,
                security: 'Medium',
                cost: 'Low',
                setup: 'Easy',
                mobility: 'High'
            },
            [CONNECTION_TYPES.BLUETOOTH]: {
                name: 'Bluetooth',
                icon: '🔷',
                color: '#8b5cf6',
                speed: 3, // Mbps (Bluetooth 5)
                range: '10-30m',
                latency: 40, // ms
                reliability: 90,
                security: 'Medium',
                cost: 'Very Low',
                setup: 'Very Easy',
                mobility: 'Very High'
            }
        });
        
        const SCENARIOS = Object.freeze([
            {
                id: 'office',
                title: 'Office Network Setup',
                description: 'You need to connect 50 desktop computers in an office building.',
                requirements: [
                    'High speed and reliability required',
                    'Security is critical',
                    'Devices rarely move',
                    'Budget is moderate'
                ],
                bestChoice: CONNECTION_TYPES.ETHERNET,
                explanation: 'Ethernet is ideal for offices: maximum speed, security, and reliability for stationary devices.'
            },
            {
                id: 'cafe',
                title: 'Coffee Shop Internet',
                description: 'Provide internet access for customers with laptops and phones.',
                requirements: [
                    'Easy connection for guests',
                    'Devices constantly changing',
                    'Coverage throughout the space',
                    'Simple management'
                ],
                bestChoice: CONNECTION_TYPES.WIFI,
                explanation: 'Wi-Fi is perfect for public spaces: easy guest access and good mobility.'
            },
            {
                id: 'fitness',
                title: 'Fitness Tracker Sync',
                description: 'Connect a fitness tracker to a smartphone.',
                requirements: [
                    'Very low power consumption',
                    'Short range is fine',
                    'Automatic connection',
                    'Small data transfers'
                ],
                bestChoice: CONNECTION_TYPES.BLUETOOTH,
                explanation: 'Bluetooth excels at low-power, short-range connections between personal devices.'
            },
            {
                id: 'gaming',
                title: 'Gaming Setup',
                description: 'Connect a gaming console for online multiplayer.',
                requirements: [
                    'Lowest possible latency',
                    'Stable connection crucial',
                    'High bandwidth for downloads',
                    'No interference'
                ],
                bestChoice: CONNECTION_TYPES.ETHERNET,
                explanation: 'Ethernet provides the low latency and stability essential for competitive gaming.'
            },
            {
                id: 'smart-home',
                title: 'Smart Home Devices',
                description: 'Connect various IoT devices throughout your home.',
                requirements: [
                    'Many devices to connect',
                    'Whole house coverage',
                    'Easy to add new devices',
                    'Reasonable speed'
                ],
                bestChoice: CONNECTION_TYPES.WIFI,
                explanation: 'Wi-Fi offers the range and flexibility needed for smart home devices.'
            }
        ]);
        
        const QUIZ_QUESTIONS = Object.freeze([
            {
                question: "Which connection type offers the highest speed?",
                options: ['Ethernet', 'Wi-Fi', 'Bluetooth', 'All are equal'],
                correct: 0,
                explanation: "Ethernet typically offers speeds up to 1000 Mbps or more, faster than Wi-Fi or Bluetooth.",
                points: 10
            },
            {
                question: "What is the typical range of Bluetooth?",
                options: ['1-5 meters', '10-30 meters', '50-100 meters', 'Unlimited'],
                correct: 1,
                explanation: "Bluetooth typically works within 10-30 meters, though walls and obstacles reduce this.",
                points: 10
            },
            {
                question: "Which connection is most secure by default?",
                options: ['Wi-Fi', 'Bluetooth', 'Ethernet', 'All equally secure'],
                correct: 2,
                explanation: "Ethernet is most secure as it requires physical access to the cable to intercept data.",
                points: 15
            },
            {
                question: "What is a major advantage of wireless connections?",
                options: ['Higher speed', 'Better security', 'Mobility', 'Lower latency'],
                correct: 2,
                explanation: "Mobility is the key advantage - you can move devices without losing connection.",
                points: 10
            },
            {
                question: "Which connection type has the lowest latency?",
                options: ['Ethernet', 'Wi-Fi 6', 'Bluetooth 5', 'All the same'],
                correct: 0,
                explanation: "Ethernet has the lowest latency (~1ms) compared to Wi-Fi (~5ms) or Bluetooth (~40ms).",
                points: 15
            },
            {
                question: "When would Bluetooth be the best choice?",
                options: [
                    'Connecting office computers',
                    'Streaming 4K video',
                    'Connecting wireless headphones',
                    'Online gaming'
                ],
                correct: 2,
                explanation: "Bluetooth is ideal for personal accessories like headphones - low power, short range.",
                points: 10
            }
        ]);
        
        // Utility functions
        class Utils {
            static getElementPosition(element) {
                const rect = element.getBoundingClientRect();
                return {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };
            }
            
            static calculateDistance(p1, p2) {
                const dx = p2.x - p1.x;
                const dy = p2.y - p1.y;
                return Math.sqrt(dx * dx + dy * dy);
            }
            
            static debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
            
            static sanitizeHTML(str) {
                const temp = document.createElement('div');
                temp.textContent = str;
                return temp.innerHTML;
            }
            
            static formatNumber(num) {
                return new Intl.NumberFormat('en-US').format(num);
            }
            
            static lerp(start, end, t) {
                return start + (end - start) * t;
            }
        }
        
        // Event System
        class EventEmitter {
            constructor() {
                this.events = new Map();
            }
            
            on(event, callback) {
                if (!this.events.has(event)) {
                    this.events.set(event, new Set());
                }
                this.events.get(event).add(callback);
                
                return () => this.off(event, callback);
            }
            
            off(event, callback) {
                if (this.events.has(event)) {
                    this.events.get(event).delete(callback);
                }
            }
            
            emit(event, data) {
                if (this.events.has(event)) {
                    this.events.get(event).forEach(callback => {
                        try {
                            callback(data);
                        } catch (error) {
                            console.error(`Error in event listener for ${event}:`, error);
                        }
                    });
                }
            }
            
            removeAllListeners() {
                this.events.clear();
            }
        }
        
        // State Management
        class StateManager extends EventEmitter {
            constructor(initialState = {}) {
                super();
                this.state = { ...initialState };
                this.history = [];
                this.maxHistory = 50;
            }
            
            getState() {
                return { ...this.state };
            }
            
            setState(updates) {
                const oldState = this.getState();
                this.state = { ...this.state, ...updates };
                
                this.history.push({
                    timestamp: Date.now(),
                    changes: updates,
                    oldState
                });
                
                if (this.history.length > this.maxHistory) {
                    this.history.shift();
                }
                
                this.emit('stateChange', { oldState, newState: this.state, changes: updates });
            }
            
            reset() {
                const initialState = this.history[0]?.oldState || {};
                this.setState(initialState);
            }
        }
        
        // Connection Model
        class Connection {
            constructor(type, from, to) {
                this.id = `${type}_${Date.now()}`;
                this.type = type;
                this.from = from;
                this.to = to;
                this.active = false;
                this.quality = 100;
                this.packets = [];
            }
            
            getSpecs() {
                return CONNECTION_SPECS[this.type];
            }
            
            calculateQuality(distance) {
                const specs = this.getSpecs();
                
                if (this.type === CONNECTION_TYPES.ETHERNET) {
                    return 100; // Always perfect for wired
                }
                
                const maxRange = this.type === CONNECTION_TYPES.WIFI ? CONFIG.WIFI_RANGE : CONFIG.BLUETOOTH_RANGE;
                const quality = Math.max(0, 100 - (distance / maxRange) * 100);
                
                return Math.round(quality);
            }
            
            canConnect(distance) {
                if (this.type === CONNECTION_TYPES.ETHERNET) {
                    return true; // No distance limit for wired
                }
                
                const maxRange = this.type === CONNECTION_TYPES.WIFI ? CONFIG.WIFI_RANGE : CONFIG.BLUETOOTH_RANGE;
                return distance <= maxRange;
            }
        }
        
        // Device Model
        class Device {
            constructor(id, name, type, position = { x: 0, y: 0 }) {
                this.id = id;
                this.name = name;
                this.type = type;
                this.position = position;
                this.connections = new Map();
                this.element = null;
            }
            
            addConnection(connection) {
                this.connections.set(connection.id, connection);
            }
            
            removeConnection(connectionId) {
                this.connections.delete(connectionId);
            }
            
            getActiveConnections() {
                return Array.from(this.connections.values()).filter(conn => conn.active);
            }
        }
        
        // Animation Manager
        class AnimationManager {
            constructor() {
                this.animations = new Map();
                this.rafId = null;
                this.isRunning = false;
            }
            
            start() {
                if (this.isRunning) return;
                this.isRunning = true;
                this.animate();
            }
            
            stop() {
                this.isRunning = false;
                if (this.rafId) {
                    cancelAnimationFrame(this.rafId);
                    this.rafId = null;
                }
            }
            
            animate = () => {
                if (!this.isRunning) return;
                
                const now = performance.now();
                
                this.animations.forEach((animation, id) => {
                    if (animation.update(now)) {
                        this.animations.delete(id);
                    }
                });
                
                this.rafId = requestAnimationFrame(this.animate);
            }
            
            addAnimation(animation) {
                animation.startTime = performance.now();
                this.animations.set(animation.id, animation);
                
                if (!this.isRunning) {
                    this.start();
                }
            }
            
            createPacketAnimation(from, to, duration = CONFIG.ANIMATION_DURATION) {
                const packet = document.createElement('div');
                packet.className = 'data-packet';
                packet.style.position = 'absolute';
                
                // Find the container
                const container = document.getElementById('networkCanvas');
                if (!container) {
                    // Fallback to body if no container
                    document.body.appendChild(packet);
                } else {
                    container.appendChild(packet);
                    
                    // Adjust coordinates to be relative to container
                    const containerRect = container.getBoundingClientRect();
                    from = {
                        x: from.x - containerRect.left,
                        y: from.y - containerRect.top
                    };
                    to = {
                        x: to.x - containerRect.left,
                        y: to.y - containerRect.top
                    };
                }
                
                const animation = {
                    id: `packet_${Date.now()}`,
                    packet,
                    from,
                    to,
                    duration,
                    startTime: 0,
                    update: (now) => {
                        const elapsed = now - animation.startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        
                        const x = Utils.lerp(from.x, to.x, progress);
                        const y = Utils.lerp(from.y, to.y, progress);
                        
                        packet.style.left = `${x - 8}px`;
                        packet.style.top = `${y - 8}px`;
                        
                        if (progress >= 1) {
                            packet.remove();
                            return true;
                        }
                        
                        return false;
                    }
                };
                
                this.addAnimation(animation);
                return animation;
            }
            
            createSignalAnimation(element, type) {
                const wave = document.createElement('div');
                wave.className = 'signal-wave';
                element.appendChild(wave);
                
                const animation = {
                    id: `signal_${Date.now()}`,
                    element: wave,
                    type,
                    startTime: 0,
                    update: () => {
                        // CSS handles the animation
                        setTimeout(() => wave.remove(), 2000);
                        return true;
                    }
                };
                
                this.addAnimation(animation);
                return animation;
            }
        }
        
        // UI Manager
        class UIManager extends EventEmitter {
            constructor() {
                super();
                this.elements = this.cacheElements();
                this.setupEventListeners();
            }
            
            cacheElements() {
                return {
                    score: document.getElementById('score'),
                    level: document.getElementById('level'),
                    achievements: document.getElementById('achievements'),
                    progress: document.getElementById('progress'),
                    content: document.getElementById('content'),
                    achievementPopup: document.getElementById('achievementPopup'),
                    achievementText: document.getElementById('achievementText'),
                    navTabs: document.querySelectorAll('.nav-tab')
                };
            }
            
            setupEventListeners() {
                this.elements.navTabs.forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const mode = e.target.dataset.mode;
                        this.setActiveTab(mode);
                        this.emit('modeChange', mode);
                    });
                    
                    tab.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            e.target.click();
                        }
                    });
                });
            }
            
            setActiveTab(mode) {
                this.elements.navTabs.forEach(tab => {
                    const isActive = tab.dataset.mode === mode;
                    tab.classList.toggle('active', isActive);
                    tab.setAttribute('aria-selected', isActive);
                });
            }
            
            updateScore(score) {
                if (this.elements.score) {
                    this.elements.score.textContent = Utils.formatNumber(score);
                }
            }
            
            updateLevel(level) {
                if (this.elements.level) {
                    this.elements.level.textContent = level;
                }
            }
            
            updateAchievements(count) {
                if (this.elements.achievements) {
                    this.elements.achievements.textContent = count;
                }
            }
            
            updateProgress(progress) {
                if (this.elements.progress) {
                    this.elements.progress.style.width = `${progress}%`;
                    this.elements.progress.parentElement.setAttribute('aria-valuenow', progress);
                }
            }
            
            showAchievement(title, description) {
                if (this.elements.achievementPopup && this.elements.achievementText) {
                    this.elements.achievementText.textContent = description;
                    this.elements.achievementPopup.classList.add('show');
                    
                    setTimeout(() => {
                        this.elements.achievementPopup.classList.remove('show');
                    }, CONFIG.ACHIEVEMENT_DISPLAY_TIME);
                }
            }
            
            loadContent(content) {
                if (this.elements.content) {
                    this.elements.content.innerHTML = '';
                    
                    if (typeof content === 'string') {
                        this.elements.content.innerHTML = content;
                    } else if (content instanceof HTMLElement) {
                        this.elements.content.appendChild(content);
                    }
                    
                    // Re-bind any new event listeners
                    this.emit('contentLoaded');
                }
            }
            
            createDeviceElement(device, icon) {
                const element = document.createElement('div');
                element.className = 'device';
                element.id = `device-${device.id}`;
                element.innerHTML = `
                    <div class="device-icon">${icon}</div>
                    <div class="device-name">${Utils.sanitizeHTML(device.name)}</div>
                    <div class="device-info">${Utils.sanitizeHTML(device.type)}</div>
                `;
                
                element.addEventListener('click', () => {
                    this.emit('deviceClick', device);
                });
                
                return element;
            }
            
            createConnectionLine(from, to, type) {
                const line = document.createElement('div');
                line.className = `connection-line ${type}`;
                
                // Get the container that holds the devices
                const container = document.getElementById('networkCanvas');
                if (!container) return null;
                
                // Get positions relative to the container
                const containerRect = container.getBoundingClientRect();
                const fromRect = from.getBoundingClientRect();
                const toRect = to.getBoundingClientRect();
                
                // Calculate center points relative to container
                const fromX = fromRect.left + fromRect.width / 2 - containerRect.left;
                const fromY = fromRect.top + fromRect.height / 2 - containerRect.top;
                const toX = toRect.left + toRect.width / 2 - containerRect.left;
                const toY = toRect.top + toRect.height / 2 - containerRect.top;
                
                // Calculate line properties
                const distance = Math.sqrt(Math.pow(toX - fromX, 2) + Math.pow(toY - fromY, 2));
                const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;
                
                // Set line styles
                line.style.position = 'absolute';
                line.style.width = `${distance}px`;
                line.style.left = `${fromX}px`;
                line.style.top = `${fromY}px`;
                line.style.transform = `rotate(${angle}deg)`;
                line.style.transformOrigin = '0 50%';
                line.style.zIndex = '1';
                
                // Add to container, not body
                container.appendChild(line);
                
                return line;
            }
        }
        
        // Quiz Manager
        class QuizManager extends EventEmitter {
            constructor(questions) {
                super();
                this.questions = [...questions];
                this.currentIndex = 0;
                this.score = 0;
                this.answers = [];
            }
            
            getCurrentQuestion() {
                return this.questions[this.currentIndex];
            }
            
            submitAnswer(answerIndex) {
                const question = this.getCurrentQuestion();
                const correct = answerIndex === question.correct;
                
                this.answers.push({
                    questionIndex: this.currentIndex,
                    answerIndex,
                    correct,
                    points: correct ? question.points : 0
                });
                
                if (correct) {
                    this.score += question.points;
                }
                
                this.emit('answerSubmitted', {
                    correct,
                    explanation: question.explanation,
                    points: question.points
                });
                
                return correct;
            }
            
            nextQuestion() {
                if (this.currentIndex < this.questions.length - 1) {
                    this.currentIndex++;
                    return true;
                }
                return false;
            }
            
            getResults() {
                const total = this.questions.reduce((sum, q) => sum + q.points, 0);
                const percentage = Math.round((this.score / total) * 100);
                const correct = this.answers.filter(a => a.correct).length;
                
                return {
                    score: this.score,
                    total,
                    percentage,
                    correct,
                    totalQuestions: this.questions.length
                };
            }
            
            reset() {
                this.currentIndex = 0;
                this.score = 0;
                this.answers = [];
            }
        }
        
        // Main Application
        class ConnectionModesSimulator extends EventEmitter {
            constructor() {
                super();
                
                this.state = new StateManager({
                    mode: 'explore',
                    score: 0,
                    level: 1,
                    achievements: [],
                    progress: 0,
                    connectionsExplored: {
                        ethernet: false,
                        wifi: false,
                        bluetooth: false
                    }
                });
                
                this.ui = new UIManager();
                this.animationManager = new AnimationManager();
                this.quizManager = new QuizManager(QUIZ_QUESTIONS);
                this.devices = new Map();
                this.connections = new Map();
                
                // Lab experiment state
                this.currentExperiment = null;
                this.speedTestResults = {};
                this.speedHypothesis = {};
                this.rangeTestResults = { wifi: [], bluetooth: [] };
                this.currentRangeTest = 'wifi';
                this.obstacles = [];
                this.baseSignalQuality = 100;
                this.loadTestDevices = [];
                this.loadTestResults = [];
                
                this.initialize();
            }
            
            initialize() {
                this.setupEventListeners();
                this.loadMode('explore');
                this.updateUI();
                this.animationManager.start();
            }
            
            setupEventListeners() {
                // UI Events
                this.ui.on('modeChange', (mode) => this.loadMode(mode));
                this.ui.on('deviceClick', (device) => this.handleDeviceClick(device));
                this.ui.on('contentLoaded', () => this.onContentLoaded());
                
                // State Events
                this.state.on('stateChange', ({ newState }) => {
                    this.updateUI();
                    this.checkAchievements(newState);
                });
                
                // Quiz Events
                this.quizManager.on('answerSubmitted', (result) => {
                    this.handleQuizAnswer(result);
                });
                
                // Window resize
                const debouncedResize = Utils.debounce(() => {
                    this.updateConnectionLines();
                }, CONFIG.DEBOUNCE_DELAY);
                
                window.addEventListener('resize', debouncedResize);
            }
            
            loadMode(mode) {
                // Clean up any existing connections from previous mode
                if (this.activeConnections) {
                    this.activeConnections.forEach(conn => {
                        if (conn.element) conn.element.remove();
                    });
                    this.activeConnections.clear();
                }
                
                // Clean up any stray connection lines
                document.querySelectorAll('.connection-line').forEach(line => line.remove());
                document.querySelectorAll('.data-packet').forEach(packet => packet.remove());
                
                this.state.setState({ mode });
                
                switch (mode) {
                    case 'explore':
                        this.loadExploreMode();
                        break;
                    case 'compare':
                        this.loadCompareMode();
                        break;
                    case 'scenarios':
                        this.loadScenariosMode();
                        break;
                    case 'quiz':
                        this.loadQuizMode();
                        break;
                    case 'lab':
                        this.loadLabMode();
                        break;
                    case 'challenge':
                        this.loadChallengeMode();
                        break;
                }
            }
            
            loadExploreMode() {
                const content = `
                    <h2>🔍 Explore Connection Types</h2>
                    <p>Connect devices to see how different network technologies work!</p>
                    
                    <div class="simulation-area">
                        <div class="connection-tutorial">
                            <h3>How to Connect:</h3>
                            <ol>
                                <li>Click a device to select it (it will glow)</li>
                                <li>Click another device to select destination</li>
                                <li>Choose a connection type from the popup</li>
                                <li>Watch the data flow and see the stats!</li>
                            </ol>
                        </div>
                        
                        <div class="network-canvas" id="networkCanvas" style="position: relative; min-height: 500px; background: rgba(0,0,0,0.2); border-radius: 12px; margin: 20px 0;">
                            <!-- Devices positioned in network -->
                            <div class="network-device" data-device-id="router" style="position: absolute; left: 50%; top: 30%; transform: translate(-50%, -50%);">
                                <div class="device-card">
                                    <div class="device-icon">📡</div>
                                    <div class="device-name">Wi-Fi Router</div>
                                    <div class="device-status">Ready</div>
                                    <div class="device-ports">
                                        <span class="port ethernet">🔌 4 Ports</span>
                                        <span class="port wifi">📶 Active</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="network-device" data-device-id="desktop" style="position: absolute; left: 20%; top: 60%;">
                                <div class="device-card">
                                    <div class="device-icon">🖥️</div>
                                    <div class="device-name">Desktop PC</div>
                                    <div class="device-status">Offline</div>
                                    <div class="device-ports">
                                        <span class="port ethernet">🔌 Yes</span>
                                        <span class="port wifi">📶 No</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="network-device" data-device-id="laptop" style="position: absolute; left: 50%; top: 70%;">
                                <div class="device-card">
                                    <div class="device-icon">💻</div>
                                    <div class="device-name">Laptop</div>
                                    <div class="device-status">Offline</div>
                                    <div class="device-ports">
                                        <span class="port ethernet">🔌 Yes</span>
                                        <span class="port wifi">📶 Yes</span>
                                        <span class="port bluetooth">🔷 Yes</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="network-device" data-device-id="phone" style="position: absolute; left: 80%; top: 60%;">
                                <div class="device-card">
                                    <div class="device-icon">📱</div>
                                    <div class="device-name">Smartphone</div>
                                    <div class="device-status">Offline</div>
                                    <div class="device-ports">
                                        <span class="port wifi">📶 Yes</span>
                                        <span class="port bluetooth">🔷 Yes</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="network-device" data-device-id="printer" style="position: absolute; left: 20%; top: 30%;">
                                <div class="device-card">
                                    <div class="device-icon">🖨️</div>
                                    <div class="device-name">Printer</div>
                                    <div class="device-status">Offline</div>
                                    <div class="device-ports">
                                        <span class="port ethernet">🔌 Yes</span>
                                        <span class="port wifi">📶 Yes</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="network-device" data-device-id="speaker" style="position: absolute; left: 80%; top: 30%;">
                                <div class="device-card">
                                    <div class="device-icon">🔊</div>
                                    <div class="device-name">Smart Speaker</div>
                                    <div class="device-status">Offline</div>
                                    <div class="device-ports">
                                        <span class="port wifi">📶 Yes</span>
                                        <span class="port bluetooth">🔷 Yes</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Connection modal -->
                            <div class="connection-modal" id="connectionModal" style="display: none;">
                                <h4>Choose Connection Type:</h4>
                                <div class="connection-options" id="connectionOptions">
                                    <!-- Options will be populated dynamically -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="active-connections-panel">
                            <h3>Active Connections:</h3>
                            <div id="activeConnectionsList">
                                <p style="color: var(--text-secondary);">No connections yet. Click devices to connect them!</p>
                            </div>
                        </div>
                        
                        <div class="connection-details" id="connectionDetails" style="display: none;">
                            <h3>Connection Details:</h3>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Type:</span>
                                    <span class="detail-value" id="detailType">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Speed:</span>
                                    <span class="detail-value" id="detailSpeed">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Latency:</span>
                                    <span class="detail-value" id="detailLatency">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Status:</span>
                                    <span class="detail-value" id="detailStatus">-</span>
                                </div>
                            </div>
                            <button class="btn" onclick="app.testConnection()">📊 Test Connection</button>
                            <button class="btn" onclick="app.disconnectCurrent()">❌ Disconnect</button>
                        </div>
                    </div>
                    
                    <div class="educational-panel">
                        <h3>📚 What You're Learning:</h3>
                        <div id="learningInfo" class="learning-content">
                            <p>Select devices to learn about different connection types and their capabilities!</p>
                        </div>
                    </div>
                `;
                
                this.ui.loadContent(content);
                this.setupInteractiveExplore();
            }
            
            loadCompareMode() {
                const content = `
                    <h2>⚖️ Compare Connection Types</h2>
                    <p>Understand the advantages and disadvantages of each connection method.</p>
                    
                    <div class="comparison-grid">
                        ${Object.entries(CONNECTION_SPECS).map(([type, specs]) => `
                            <div class="comparison-card">
                                <h3>
                                    <span style="font-size: 2rem;">${specs.icon}</span>
                                    ${specs.name}
                                </h3>
                                <ul class="feature-list">
                                    <li class="pro">✅ Speed: ${specs.speed} Mbps</li>
                                    <li class="${specs.latency <= 5 ? 'pro' : 'con'}">
                                        ${specs.latency <= 5 ? '✅' : '⚠️'} Latency: ${specs.latency}ms
                                    </li>
                                    <li class="pro">✅ Range: ${specs.range}</li>
                                    <li class="${specs.reliability >= 95 ? 'pro' : 'con'}">
                                        ${specs.reliability >= 95 ? '✅' : '⚠️'} Reliability: ${specs.reliability}%
                                    </li>
                                    <li>🔒 Security: ${specs.security}</li>
                                    <li>💰 Cost: ${specs.cost}</li>
                                    <li>⚙️ Setup: ${specs.setup}</li>
                                    <li class="${specs.mobility === 'None' ? 'con' : 'pro'}">
                                        ${specs.mobility === 'None' ? '❌' : '✅'} Mobility: ${specs.mobility}
                                    </li>
                                </ul>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="interactive-demo">
                        <h3>Speed Comparison</h3>
                        <div class="speed-meter">
                            ${Object.entries(CONNECTION_SPECS).map(([type, specs], index) => `
                                <div class="speed-bar" style="
                                    left: ${index * 80 + 20}px;
                                    height: ${Math.log10(specs.speed) * 40}px;
                                    background: ${specs.color};
                                "></div>
                                <div class="speed-label" style="left: ${index * 80 + 20}px;">
                                    ${specs.name}<br>${specs.speed} Mbps
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="quiz-container">
                        <h3>Quick Check!</h3>
                        <p class="quiz-question">Which connection would you choose for a security camera that needs constant uptime?</p>
                        <div class="choice-grid">
                            <button class="choice-btn" onclick="app.checkAnswer('ethernet', 0)">
                                🔌 Ethernet
                            </button>
                            <button class="choice-btn" onclick="app.checkAnswer('wifi', 1)">
                                📶 Wi-Fi
                            </button>
                            <button class="choice-btn" onclick="app.checkAnswer('bluetooth', 2)">
                                🔷 Bluetooth
                            </button>
                        </div>
                    </div>
                `;
                
                this.ui.loadContent(content);
            }
            
            loadScenariosMode() {
                this.currentScenarioIndex = 0;
                this.loadScenario(0);
            }
            
            loadScenario(index) {
                const scenario = SCENARIOS[index];
                
                const content = `
                    <h2>🎯 Real-World Scenarios</h2>
                    <p>Choose the best connection type for each situation!</p>
                    
                    <div class="scenario-card">
                        <h3>${scenario.title}</h3>
                        <p>${scenario.description}</p>
                        
                        <div class="scenario-requirements">
                            <h4>Requirements:</h4>
                            <ul>
                                ${scenario.requirements.map(req => `<li>${req}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <h4>Choose the best connection type:</h4>
                        <div class="choice-grid">
                            ${Object.entries(CONNECTION_SPECS).map(([type, specs]) => `
                                <button class="choice-btn" onclick="app.submitScenarioAnswer('${type}', '${scenario.id}')">
                                    ${specs.icon} ${specs.name}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${((index + 1) / SCENARIOS.length) * 100}%"></div>
                    </div>
                    <p style="text-align: center; margin-top: 10px;">
                        Scenario ${index + 1} of ${SCENARIOS.length}
                    </p>
                `;
                
                this.ui.loadContent(content);
            }
            
            loadQuizMode() {
                this.quizManager.reset();
                this.loadQuizQuestion();
            }
            
            loadQuizQuestion() {
                const question = this.quizManager.getCurrentQuestion();
                const questionNum = this.quizManager.currentIndex + 1;
                const totalQuestions = this.quizManager.questions.length;
                
                const content = `
                    <h2>❓ Connection Knowledge Quiz</h2>
                    <p>Test your understanding of network connections!</p>
                    
                    <div class="quiz-container">
                        <h3>Question ${questionNum} of ${totalQuestions}</h3>
                        <p class="quiz-question">${question.question}</p>
                        
                        <div class="choice-grid">
                            ${question.options.map((option, index) => `
                                <button class="choice-btn" id="quiz-option-${index}" 
                                        onclick="app.submitQuizAnswer(${index})">
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                        
                        <div class="progress-bar" style="margin-top: 30px;">
                            <div class="progress-fill" style="width: ${(questionNum / totalQuestions) * 100}%"></div>
                        </div>
                    </div>
                `;
                
                this.ui.loadContent(content);
            }
            
            loadLabMode() {
                const content = `
                    <h2>🧪 Connection Testing Lab</h2>
                    <p>Experiment with different connection scenarios and see real-time performance!</p>
                    
                    <div class="simulation-area">
                        <h3>Network Simulation</h3>
                        <div id="labContainer" style="position: relative; height: 400px; background: rgba(0,0,0,0.3); border-radius: 12px;">
                            <!-- Devices will be added here -->
                        </div>
                        
                        <div class="interactive-demo">
                            <h3>Lab Controls:</h3>
                            <div class="btn-group" style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn" onclick="app.addLabDevice('laptop')">
                                    ➕ Add Laptop
                                </button>
                                <button class="btn" onclick="app.addLabDevice('phone')">
                                    ➕ Add Phone
                                </button>
                                <button class="btn" onclick="app.addLabDevice('iot')">
                                    ➕ Add IoT Device
                                </button>
                                <button class="btn" onclick="app.simulateInterference()">
                                    📡 Add Interference
                                </button>
                                <button class="btn" onclick="app.clearLab()">
                                    🗑️ Clear All
                                </button>
                            </div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="activeDevices">0</div>
                                <div class="stat-label">Active Devices</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="networkLoad">0%</div>
                                <div class="stat-label">Network Load</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="avgLatency">0ms</div>
                                <div class="stat-label">Avg Latency</div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.ui.loadContent(content);
                this.initializeLab();
            }
            
            loadChallengeMode() {
                const content = `
                    <h2>🏆 Network Challenge Mode</h2>
                    <p>Complete timed challenges to prove your networking expertise!</p>
                    
                    <div class="scenario-card">
                        <h3>Challenge: Network Crisis!</h3>
                        <p>The office network is down! You have 60 seconds to:</p>
                        <ul>
                            <li>✓ Connect all devices to the network</li>
                            <li>✓ Ensure maximum reliability</li>
                            <li>✓ Minimize latency for critical systems</li>
                            <li>✓ Stay within budget</li>
                        </ul>
                        
                        <div style="text-align: center; margin: 30px 0;">
                            <button class="btn" onclick="app.startChallenge()" style="font-size: 1.2rem; padding: 15px 30px;">
                                🚀 Start Challenge
                            </button>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value">🥇 2500</div>
                                <div class="stat-label">High Score</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">⏱️ 45s</div>
                                <div class="stat-label">Best Time</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">📈 Level 5</div>
                                <div class="stat-label">Required</div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.ui.loadContent(content);
            }
            
            setupInteractiveExplore() {
                // Clear previous state
                this.selectedDevice = null;
                this.activeConnections = new Map();
                
                // Set up device click handlers
                const devices = document.querySelectorAll('.network-device');
                devices.forEach(device => {
                    device.addEventListener('click', (e) => this.handleDeviceSelection(e.currentTarget));
                });
                
                // Close modal when clicking outside
                document.addEventListener('click', (e) => {
                    const modal = document.getElementById('connectionModal');
                    if (modal && modal.style.display !== 'none' && !modal.contains(e.target) && !e.target.closest('.network-device')) {
                        modal.style.display = 'none';
                    }
                });
            }
            
            handleDeviceSelection(deviceElement) {
                const deviceId = deviceElement.dataset.deviceId;
                
                // If no device selected yet, select this one
                if (!this.selectedDevice) {
                    this.selectedDevice = deviceElement;
                    deviceElement.classList.add('selected', 'source');
                    this.updateLearningInfo('device-selected', deviceId);
                    return;
                }
                
                // If clicking the same device, deselect
                if (this.selectedDevice === deviceElement) {
                    this.clearSelection();
                    return;
                }
                
                // If different device, show connection options
                this.showConnectionOptions(this.selectedDevice, deviceElement);
            }
            
            clearSelection() {
                document.querySelectorAll('.network-device').forEach(device => {
                    device.classList.remove('selected', 'source');
                });
                this.selectedDevice = null;
                document.getElementById('connectionModal').style.display = 'none';
            }
            
            showConnectionOptions(fromDevice, toDevice) {
                const modal = document.getElementById('connectionModal');
                const optionsContainer = document.getElementById('connectionOptions');
                
                const fromId = fromDevice.dataset.deviceId;
                const toId = toDevice.dataset.deviceId;
                
                // Determine available connection types based on device capabilities
                const availableConnections = this.getAvailableConnections(fromId, toId);
                
                optionsContainer.innerHTML = '';
                
                Object.entries(availableConnections).forEach(([type, available]) => {
                    const option = document.createElement('div');
                    option.className = `connection-option ${!available.possible ? 'disabled' : ''}`;
                    
                    const specs = CONNECTION_SPECS[type];
                    option.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 2rem;">${specs.icon}</span>
                            <div>
                                <strong>${specs.name}</strong>
                                <div style="font-size: 0.9rem; color: var(--text-secondary);">
                                    ${available.possible ? `${specs.speed} Mbps • ${specs.latency}ms latency` : available.reason}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    if (available.possible) {
                        option.addEventListener('click', () => {
                            this.createInteractiveConnection(fromDevice, toDevice, type);
                            modal.style.display = 'none';
                        });
                    }
                    
                    optionsContainer.appendChild(option);
                });
                
                // Position modal
                const rect = toDevice.getBoundingClientRect();
                modal.style.display = 'block';
            }
            
            getAvailableConnections(fromId, toId) {
                const deviceCapabilities = {
                    router: { ethernet: true, wifi: true, bluetooth: false },
                    desktop: { ethernet: true, wifi: false, bluetooth: false },
                    laptop: { ethernet: true, wifi: true, bluetooth: true },
                    phone: { ethernet: false, wifi: true, bluetooth: true },
                    printer: { ethernet: true, wifi: true, bluetooth: false },
                    speaker: { ethernet: false, wifi: true, bluetooth: true }
                };
                
                const from = deviceCapabilities[fromId];
                const to = deviceCapabilities[toId];
                
                return {
                    ethernet: {
                        possible: from.ethernet && to.ethernet,
                        reason: !from.ethernet || !to.ethernet ? 'One or both devices lack Ethernet ports' : ''
                    },
                    wifi: {
                        possible: from.wifi && to.wifi && (fromId === 'router' || toId === 'router'),
                        reason: !from.wifi || !to.wifi ? 'One or both devices lack Wi-Fi' : 
                                (fromId !== 'router' && toId !== 'router' ? 'Wi-Fi requires a router' : '')
                    },
                    bluetooth: {
                        possible: from.bluetooth && to.bluetooth && fromId !== 'router' && toId !== 'router',
                        reason: !from.bluetooth || !to.bluetooth ? 'One or both devices lack Bluetooth' :
                                (fromId === 'router' || toId === 'router' ? 'Routers don\'t use Bluetooth' : '')
                    }
                };
            }
            
            createInteractiveConnection(fromDevice, toDevice, type) {
                const fromId = fromDevice.dataset.deviceId;
                const toId = toDevice.dataset.deviceId;
                const connectionId = `${fromId}-${toId}-${type}`;
                
                // Check if connection already exists
                if (this.activeConnections.has(connectionId)) {
                    this.showMessage('This connection already exists!');
                    this.clearSelection();
                    return;
                }
                
                // Create visual connection - find the device cards within the device containers
                const fromCard = fromDevice.querySelector('.device-card');
                const toCard = toDevice.querySelector('.device-card');
                const line = this.ui.createConnectionLine(fromCard || fromDevice, toCard || toDevice, type);
                
                // Store connection
                const connection = {
                    id: connectionId,
                    from: fromId,
                    to: toId,
                    type: type,
                    element: line,
                    quality: 100,
                    dataTransferred: 0
                };
                
                this.activeConnections.set(connectionId, connection);
                
                // Update device status
                fromDevice.querySelector('.device-status').textContent = 'Online';
                fromDevice.querySelector('.device-status').classList.add('online');
                toDevice.querySelector('.device-status').textContent = 'Online';
                toDevice.querySelector('.device-status').classList.add('online');
                
                fromDevice.classList.add('connected');
                toDevice.classList.add('connected');
                
                // Clear selection
                this.clearSelection();
                
                // Update UI
                this.updateActiveConnectionsList();
                this.updateLearningInfo('connection-created', type);
                
                // Start data animation
                this.startDataAnimation(fromDevice, toDevice, line, type);
                
                // Update stats
                this.updateExploreStats();
                
                // Add score
                this.addScore(50);
                
                // Mark as explored
                const explored = { ...this.state.getState().connectionsExplored };
                explored[type] = true;
                this.state.setState({ connectionsExplored: explored });
            }
            
            updateActiveConnectionsList() {
                const listContainer = document.getElementById('activeConnectionsList');
                
                if (this.activeConnections.size === 0) {
                    listContainer.innerHTML = '<p style="color: var(--text-secondary);">No connections yet. Click devices to connect them!</p>';
                    return;
                }
                
                listContainer.innerHTML = '';
                
                this.activeConnections.forEach(connection => {
                    const specs = CONNECTION_SPECS[connection.type];
                    const item = document.createElement('div');
                    item.className = 'connection-item';
                    
                    item.innerHTML = `
                        <div class="connection-info">
                            <span style="font-size: 1.5rem;">${specs.icon}</span>
                            <div>
                                <strong>${this.getDeviceName(connection.from)} → ${this.getDeviceName(connection.to)}</strong>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                    ${specs.name} • ${specs.speed} Mbps
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div class="connection-quality">
                                <div class="quality-bar active"></div>
                                <div class="quality-bar active"></div>
                                <div class="quality-bar active"></div>
                                <div class="quality-bar ${connection.quality > 66 ? 'active' : ''}"></div>
                                <div class="quality-bar ${connection.quality > 90 ? 'active' : ''}"></div>
                            </div>
                            <button class="btn" style="padding: 5px 10px;" onclick="app.selectConnection('${connection.id}')">
                                View
                            </button>
                        </div>
                    `;
                    
                    listContainer.appendChild(item);
                });
            }
            
            getDeviceName(deviceId) {
                const names = {
                    router: 'Wi-Fi Router',
                    desktop: 'Desktop PC',
                    laptop: 'Laptop',
                    phone: 'Smartphone',
                    printer: 'Printer',
                    speaker: 'Smart Speaker'
                };
                return names[deviceId] || deviceId;
            }
            
            selectConnection(connectionId) {
                const connection = this.activeConnections.get(connectionId);
                if (!connection) return;
                
                const details = document.getElementById('connectionDetails');
                const specs = CONNECTION_SPECS[connection.type];
                
                document.getElementById('detailType').textContent = specs.name;
                document.getElementById('detailSpeed').textContent = `${specs.speed} Mbps`;
                document.getElementById('detailLatency').textContent = `${specs.latency} ms`;
                document.getElementById('detailStatus').textContent = 'Connected';
                
                details.style.display = 'block';
                this.currentConnection = connection;
                
                // Highlight the connection
                document.querySelectorAll('.connection-line').forEach(line => {
                    line.style.opacity = '0.3';
                });
                connection.element.style.opacity = '1';
            }
            
            testConnection() {
                if (!this.currentConnection) return;
                
                const specs = CONNECTION_SPECS[this.currentConnection.type];
                const messages = {
                    ethernet: 'Testing Ethernet... Excellent! Stable connection with maximum speed.',
                    wifi: 'Testing Wi-Fi... Good signal strength. Some interference detected.',
                    bluetooth: 'Testing Bluetooth... Connected. Limited range but perfect for personal devices.'
                };
                
                this.showMessage(messages[this.currentConnection.type]);
                
                // Animate test
                const fromDevice = document.querySelector(`[data-device-id="${this.currentConnection.from}"]`);
                const toDevice = document.querySelector(`[data-device-id="${this.currentConnection.to}"]`);
                
                if (fromDevice && toDevice) {
                    for (let i = 0; i < 5; i++) {
                        setTimeout(() => {
                            this.animateDataTransfer(fromDevice, toDevice);
                        }, i * 200);
                    }
                }
                
                this.addScore(25);
            }
            
            disconnectCurrent() {
                if (!this.currentConnection) return;
                
                const connection = this.currentConnection;
                
                // Remove visual connection
                if (connection.element) {
                    connection.element.remove();
                }
                
                // Update device status if no other connections
                const fromDevice = document.querySelector(`[data-device-id="${connection.from}"]`);
                const toDevice = document.querySelector(`[data-device-id="${connection.to}"]`);
                
                // Check if devices have other connections
                let fromHasOthers = false;
                let toHasOthers = false;
                
                this.activeConnections.forEach((conn, id) => {
                    if (id !== connection.id) {
                        if (conn.from === connection.from || conn.to === connection.from) fromHasOthers = true;
                        if (conn.from === connection.to || conn.to === connection.to) toHasOthers = true;
                    }
                });
                
                if (!fromHasOthers && fromDevice) {
                    const status = fromDevice.querySelector('.device-status');
                    if (status) {
                        status.textContent = 'Offline';
                        status.classList.remove('online');
                    }
                    fromDevice.classList.remove('connected');
                }
                
                if (!toHasOthers && toDevice) {
                    const status = toDevice.querySelector('.device-status');
                    if (status) {
                        status.textContent = 'Offline';
                        status.classList.remove('online');
                    }
                    toDevice.classList.remove('connected');
                }
                
                // Remove from active connections
                this.activeConnections.delete(connection.id);
                
                // Update UI
                this.updateActiveConnectionsList();
                document.getElementById('connectionDetails').style.display = 'none';
                
                // Reset line opacity
                document.querySelectorAll('.connection-line').forEach(line => {
                    line.style.opacity = '1';
                });
                
                this.currentConnection = null;
                this.updateExploreStats();
            }
            
            startDataAnimation(fromDevice, toDevice, line, type) {
                // Create recurring data packets
                const animateData = () => {
                    const connectionId = `${fromDevice.dataset.deviceId}-${toDevice.dataset.deviceId}-${type}`;
                    if (!this.activeConnections.has(connectionId)) {
                        return; // Stop if connection removed
                    }
                    
                    this.animateDataTransfer(fromDevice, toDevice);
                    
                    // Random interval based on connection type
                    const intervals = {
                        ethernet: 1000,
                        wifi: 1500,
                        bluetooth: 2500
                    };
                    
                    setTimeout(animateData, intervals[type] + Math.random() * 1000);
                };
                
                // Start animation after a short delay
                setTimeout(animateData, 500);
            }
            
            updateExploreStats() {
                // Update connection count
                const connectionCountEl = document.getElementById('connectionCount');
                if (connectionCountEl) {
                    connectionCountEl.textContent = this.activeConnections.size;
                }
                
                // Find best speed
                let bestSpeed = 0;
                this.activeConnections.forEach(conn => {
                    const specs = CONNECTION_SPECS[conn.type];
                    if (specs.speed > bestSpeed) {
                        bestSpeed = specs.speed;
                    }
                });
                
                const bestSpeedEl = document.getElementById('bestSpeed');
                if (bestSpeedEl) {
                    bestSpeedEl.textContent = bestSpeed;
                }
            }
            
            updateLearningInfo(event, data) {
                const learningInfo = document.getElementById('learningInfo');
                if (!learningInfo) return;
                
                const content = {
                    'device-selected': {
                        router: `<h4>📡 Wi-Fi Router Selected</h4>
                                <ul>
                                    <li>Central hub for network connections</li>
                                    <li>Provides internet access to all devices</li>
                                    <li>Supports both wired (Ethernet) and wireless (Wi-Fi) connections</li>
                                    <li>Typical range: 50-100 meters for Wi-Fi</li>
                                </ul>`,
                        desktop: `<h4>🖥️ Desktop PC Selected</h4>
                                 <ul>
                                     <li>Usually connects via Ethernet for best performance</li>
                                     <li>No built-in Wi-Fi (needs adapter)</li>
                                     <li>Best for gaming and high-bandwidth tasks</li>
                                     <li>Stationary - doesn't need wireless</li>
                                 </ul>`,
                        laptop: `<h4>💻 Laptop Selected</h4>
                                <ul>
                                    <li>Supports all connection types</li>
                                    <li>Wi-Fi for mobility, Ethernet for speed</li>
                                    <li>Bluetooth for accessories</li>
                                    <li>Versatile connectivity options</li>
                                </ul>`,
                        phone: `<h4>📱 Smartphone Selected</h4>
                               <ul>
                                   <li>Wireless only - no Ethernet port</li>
                                   <li>Wi-Fi for internet access</li>
                                   <li>Bluetooth for headphones, speakers, wearables</li>
                                   <li>Designed for maximum mobility</li>
                               </ul>`,
                        printer: `<h4>🖨️ Printer Selected</h4>
                                 <ul>
                                     <li>Can connect via Ethernet or Wi-Fi</li>
                                     <li>Network printing allows sharing between devices</li>
                                     <li>Wi-Fi enables placement anywhere</li>
                                     <li>Ethernet provides reliable connection</li>
                                 </ul>`,
                        speaker: `<h4>🔊 Smart Speaker Selected</h4>
                                 <ul>
                                     <li>Primarily uses Wi-Fi for internet/streaming</li>
                                     <li>Bluetooth for direct device connection</li>
                                     <li>No Ethernet - designed for flexibility</li>
                                     <li>Can act as smart home hub</li>
                                 </ul>`
                    },
                    'connection-created': {
                        ethernet: `<h4>🔌 Ethernet Connection Created!</h4>
                                  <ul>
                                      <li><strong>Speed:</strong> Up to 1000 Mbps (1 Gbps)</li>
                                      <li><strong>Latency:</strong> ~1ms (excellent for gaming)</li>
                                      <li><strong>Reliability:</strong> 99.9% - no interference</li>
                                      <li><strong>Best for:</strong> Desktops, servers, gaming consoles</li>
                                      <li><strong>Limitation:</strong> Requires physical cable</li>
                                  </ul>`,
                        wifi: `<h4>📶 Wi-Fi Connection Created!</h4>
                              <ul>
                                  <li><strong>Speed:</strong> Up to 600 Mbps (Wi-Fi 6)</li>
                                  <li><strong>Latency:</strong> ~5ms (good for most uses)</li>
                                  <li><strong>Range:</strong> 50-100 meters</li>
                                  <li><strong>Best for:</strong> Mobile devices, convenience</li>
                                  <li><strong>Note:</strong> Can be affected by walls, interference</li>
                              </ul>`,
                        bluetooth: `<h4>🔷 Bluetooth Connection Created!</h4>
                                   <ul>
                                       <li><strong>Speed:</strong> Up to 3 Mbps (Bluetooth 5)</li>
                                       <li><strong>Latency:</strong> ~40ms (fine for audio)</li>
                                       <li><strong>Range:</strong> 10-30 meters</li>
                                       <li><strong>Best for:</strong> Headphones, keyboards, IoT devices</li>
                                       <li><strong>Advantage:</strong> Very low power consumption</li>
                                   </ul>`
                    }
                };
                
                if (content[event] && content[event][data]) {
                    learningInfo.innerHTML = content[event][data];
                }
            }
            
            animateDataTransfer(fromEl, toEl) {
                // Get positions relative to the viewport first
                const fromRect = fromEl.getBoundingClientRect();
                const toRect = toEl.getBoundingClientRect();
                
                const fromPos = {
                    x: fromRect.left + fromRect.width / 2,
                    y: fromRect.top + fromRect.height / 2
                };
                
                const toPos = {
                    x: toRect.left + toRect.width / 2,
                    y: toRect.top + toRect.height / 2
                };
                
                this.animationManager.createPacketAnimation(fromPos, toPos);
                
                // Update data transferred stat
                const dataEl = document.getElementById('dataTransferred');
                if (dataEl) {
                    const current = parseInt(dataEl.textContent) || 0;
                    dataEl.textContent = current + 1;
                }
            }
            
            checkAnswer(type, buttonIndex) {
                const buttons = document.querySelectorAll('.choice-btn');
                const button = buttons[buttonIndex];
                
                if (type === CONNECTION_TYPES.ETHERNET) {
                    button.classList.add('correct');
                    this.addScore(20);
                    this.showMessage('Correct! Ethernet provides the best reliability for security cameras.');
                } else {
                    button.classList.add('incorrect');
                    buttons[0].classList.add('correct');
                    this.showMessage('Ethernet would be better - it provides constant, reliable connection.');
                }
                
                // Disable all buttons
                buttons.forEach(btn => btn.disabled = true);
            }
            
            submitScenarioAnswer(type, scenarioId) {
                const scenario = SCENARIOS.find(s => s.id === scenarioId);
                const buttons = document.querySelectorAll('.choice-btn');
                
                buttons.forEach(btn => {
                    btn.disabled = true;
                    if (btn.textContent.toLowerCase().includes(type)) {
                        if (type === scenario.bestChoice) {
                            btn.classList.add('correct');
                        } else {
                            btn.classList.add('incorrect');
                        }
                    } else if (btn.textContent.toLowerCase().includes(scenario.bestChoice)) {
                        btn.classList.add('correct');
                    }
                });
                
                if (type === scenario.bestChoice) {
                    this.addScore(100);
                    this.showMessage(`Excellent! ${scenario.explanation}`);
                } else {
                    this.addScore(25);
                    this.showMessage(`Not quite. ${scenario.explanation}`);
                }
                
                // Load next scenario after delay
                setTimeout(() => {
                    this.currentScenarioIndex++;
                    if (this.currentScenarioIndex < SCENARIOS.length) {
                        this.loadScenario(this.currentScenarioIndex);
                    } else {
                        this.showScenariosComplete();
                    }
                }, 3000);
            }
            
            showScenariosComplete() {
                const content = `
                    <h2>🎉 Scenarios Complete!</h2>
                    <div class="scenario-card">
                        <h3>Great job!</h3>
                        <p>You've completed all the real-world scenarios!</p>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value">${this.state.getState().score}</div>
                                <div class="stat-label">Total Score</div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn" onclick="app.loadMode('quiz')">
                                Try the Quiz Next →
                            </button>
                        </div>
                    </div>
                `;
                
                this.ui.loadContent(content);
            }
            
            submitQuizAnswer(answerIndex) {
                const buttons = document.querySelectorAll('.choice-btn');
                buttons.forEach(btn => btn.disabled = true);
                
                const correct = this.quizManager.submitAnswer(answerIndex);
                
                buttons[answerIndex].classList.add(correct ? 'correct' : 'incorrect');
                if (!correct) {
                    const correctIndex = this.quizManager.getCurrentQuestion().correct;
                    buttons[correctIndex].classList.add('correct');
                }
            }
            
            handleQuizAnswer(result) {
                if (result.correct) {
                    this.addScore(result.points);
                    this.showMessage(`Correct! ${result.explanation}`);
                } else {
                    this.showMessage(result.explanation);
                }
                
                setTimeout(() => {
                    if (this.quizManager.nextQuestion()) {
                        this.loadQuizQuestion();
                    } else {
                        this.showQuizResults();
                    }
                }, 2000);
            }
            
            showQuizResults() {
                const results = this.quizManager.getResults();
                
                const content = `
                    <h2>📊 Quiz Results</h2>
                    <div class="quiz-container">
                        <h3>Your Performance:</h3>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value">${results.percentage}%</div>
                                <div class="stat-label">Accuracy</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${results.correct}/${results.totalQuestions}</div>
                                <div class="stat-label">Correct Answers</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${results.score}</div>
                                <div class="stat-label">Points Earned</div>
                            </div>
                        </div>
                        
                        ${results.percentage >= 80 ? `
                            <div class="achievement-popup show" style="position: static; margin: 20px auto;">
                                <h3>🏆 Quiz Master!</h3>
                                <p>You scored 80% or higher!</p>
                            </div>
                        ` : ''}
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn" onclick="app.loadMode('lab')">
                                Try the Lab Next →
                            </button>
                        </div>
                    </div>
                `;
                
                this.ui.loadContent(content);
                
                if (results.percentage >= 80) {
                    this.unlockAchievement('Quiz Master', 'Score 80% or higher on the connection quiz!');
                }
            }
            
            initializeLab() {
                this.labDevices = [];
                this.labConnections = [];
                this.updateLabStats();
            }
            
            addLabDevice(type) {
                const container = document.getElementById('labContainer');
                if (!container || this.labDevices.length >= CONFIG.MAX_DEVICES) return;
                
                const device = document.createElement('div');
                device.className = 'device';
                device.style.position = 'absolute';
                device.style.left = `${Math.random() * (container.offsetWidth - 100)}px`;
                device.style.top = `${Math.random() * (container.offsetHeight - 100)}px`;
                
                const icons = {
                    laptop: '💻',
                    phone: '📱',
                    iot: '🔌'
                };
                
                device.innerHTML = `
                    <div class="device-icon">${icons[type]}</div>
                    <div class="device-name">${type}</div>
                `;
                
                container.appendChild(device);
                this.labDevices.push({ element: device, type });
                
                // Make draggable
                this.makeDraggable(device);
                
                this.updateLabStats();
                this.addScore(10);
            }
            
            makeDraggable(element) {
                let isDragging = false;
                let startX, startY, initialX, initialY;
                
                element.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    initialX = element.offsetLeft;
                    initialY = element.offsetTop;
                    element.style.zIndex = 1000;
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;
                    
                    element.style.left = `${initialX + dx}px`;
                    element.style.top = `${initialY + dy}px`;
                });
                
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                    if (element) {
                        element.style.zIndex = '';
                    }
                });
            }
            
            simulateInterference() {
                // Add visual interference effect
                const container = document.getElementById('labContainer');
                if (!container) return;
                
                const interference = document.createElement('div');
                interference.style.cssText = `
                    position: absolute;
                    width: 100px;
                    height: 100px;
                    background: radial-gradient(circle, rgba(255,0,0,0.3), transparent);
                    border-radius: 50%;
                    left: ${Math.random() * (container.offsetWidth - 100)}px;
                    top: ${Math.random() * (container.offsetHeight - 100)}px;
                    animation: pulse 2s infinite;
                `;
                
                container.appendChild(interference);
                
                // Update network load
                const loadEl = document.getElementById('networkLoad');
                if (loadEl) {
                    const currentLoad = parseInt(loadEl.textContent) || 0;
                    loadEl.textContent = `${Math.min(100, currentLoad + 20)}%`;
                }
                
                // Update latency
                const latencyEl = document.getElementById('avgLatency');
                if (latencyEl) {
                    const currentLatency = parseInt(latencyEl.textContent) || 0;
                    latencyEl.textContent = `${currentLatency + 15}ms`;
                }
                
                setTimeout(() => interference.remove(), 5000);
            }
            
            clearLab() {
                const container = document.getElementById('labContainer');
                if (container) {
                    container.innerHTML = '';
                }
                
                this.labDevices = [];
                this.labConnections = [];
                this.updateLabStats();
            }
            
            updateLabStats() {
                const devicesEl = document.getElementById('activeDevices');
                if (devicesEl) {
                    devicesEl.textContent = this.labDevices.length;
                }
                
                const loadEl = document.getElementById('networkLoad');
                if (loadEl) {
                    const load = Math.min(100, this.labDevices.length * 15);
                    loadEl.textContent = `${load}%`;
                }
                
                const latencyEl = document.getElementById('avgLatency');
                if (latencyEl) {
                    const baseLatency = 5;
                    const additionalLatency = this.labDevices.length * 2;
                    latencyEl.textContent = `${baseLatency + additionalLatency}ms`;
                }
            }
            
            startChallenge() {
                // Challenge implementation would go here
                this.showMessage('Challenge mode coming soon! Keep exploring other modes to level up.');
            }
            
            addScore(points) {
                const currentState = this.state.getState();
                const newScore = currentState.score + points;
                const newLevel = Math.floor(newScore / 500) + 1;
                
                this.state.setState({
                    score: newScore,
                    level: newLevel,
                    progress: (newScore % 500) / 5
                });
                
                if (newLevel > currentState.level) {
                    this.showMessage(`Level Up! You're now level ${newLevel}!`);
                    this.unlockAchievement('Level Up', `Reached level ${newLevel}`);
                }
            }
            
            updateUI() {
                const state = this.state.getState();
                this.ui.updateScore(state.score);
                this.ui.updateLevel(state.level);
                this.ui.updateAchievements(state.achievements.length);
                this.ui.updateProgress(state.progress);
            }
            
            checkAchievements(state) {
                const achievements = [
                    {
                        id: 'first_connection',
                        name: 'First Connection',
                        description: 'Create your first network connection',
                        condition: () => this.connections.size > 0
                    },
                    {
                        id: 'all_types',
                        name: 'Connection Expert',
                        description: 'Try all three connection types',
                        condition: () => {
                            const explored = state.connectionsExplored;
                            return explored.ethernet && explored.wifi && explored.bluetooth;
                        }
                    },
                    {
                        id: 'scenario_master',
                        name: 'Scenario Master',
                        description: 'Complete all scenarios',
                        condition: () => this.currentScenarioIndex >= SCENARIOS.length
                    }
                ];
                
                achievements.forEach(achievement => {
                    if (!state.achievements.includes(achievement.id) && achievement.condition()) {
                        this.unlockAchievement(achievement.name, achievement.description);
                    }
                });
            }
            
            unlockAchievement(name, description) {
                const state = this.state.getState();
                if (!state.achievements.includes(name)) {
                    this.state.setState({
                        achievements: [...state.achievements, name]
                    });
                    this.ui.showAchievement(name, description);
                    this.addScore(100);
                }
            }
            
            showMessage(message) {
                // Create temporary message element
                const msgEl = document.createElement('div');
                msgEl.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: var(--secondary-bg);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 8px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                    z-index: 1000;
                    animation: fadeIn 0.3s ease-out;
                `;
                msgEl.textContent = message;
                document.body.appendChild(msgEl);
                
                setTimeout(() => {
                    msgEl.style.animation = 'fadeOut 0.3s ease-out';
                    setTimeout(() => msgEl.remove(), 300);
                }, 3000);
            }
            
            updateConnectionLines() {
                // Update all active connection line positions
                if (this.activeConnections && this.activeConnections.size > 0) {
                    this.activeConnections.forEach(connection => {
                        if (connection.element) {
                            connection.element.remove();
                            
                            const fromEl = document.querySelector(`[data-device-id="${connection.from}"]`);
                            const toEl = document.querySelector(`[data-device-id="${connection.to}"]`);
                            
                            if (fromEl && toEl) {
                                const fromCard = fromEl.querySelector('.device-card');
                                const toCard = toEl.querySelector('.device-card');
                                connection.element = this.ui.createConnectionLine(
                                    fromCard || fromEl, 
                                    toCard || toEl, 
                                    connection.type
                                );
                            }
                        }
                    });
                } else if (this.connections && this.connections.size > 0) {
                    // Fallback for other modes
                    this.connections.forEach(connection => {
                        if (connection.element) {
                            connection.element.remove();
                            
                            const fromEl = document.getElementById(`device-${connection.from.id}`);
                            const toEl = document.getElementById(`device-${connection.to.id}`);
                            
                            if (fromEl && toEl) {
                                connection.element = this.ui.createConnectionLine(fromEl, toEl, connection.type);
                            }
                        }
                    });
                }
            }
            
            onContentLoaded() {
                // Re-bind any dynamic event handlers after content loads
                // This is handled by inline onclick for simplicity in this demo
            }
            
            destroy() {
                this.animationManager.stop();
                this.ui.removeAllListeners();
                this.state.removeAllListeners();
                this.removeAllListeners();
            }
        }
        
        // Global app instance
        let app;
        
        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', () => {
            app = new ConnectionModesSimulator();
            
            // Make app methods available globally for onclick handlers
            window.app = app;
        });
        
        // Cleanup on unload
        window.addEventListener('beforeunload', () => {
            if (app) {
                app.destroy();
            }
        });
        
        // Add fade out animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
            
            @keyframes pulse {
                0%, 100% { opacity: 0.3; }
                50% { opacity: 0.6; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>