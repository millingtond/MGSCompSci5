<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OS: Peripheral Management Simulation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .gradient-background { background: linear-gradient(135deg, #e0f2fe 0%, #fce7f3 100%); }
        .card { background-color: white; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        canvas { background-color: #f8fafc; border-radius: 0.5rem; border: 1px solid #e2e8f0; width: 100%; }
        .action-button { transition: all 0.2s ease-in-out; }
        .action-button:hover:not(:disabled) { transform: scale(1.05); filter: brightness(1.1); }
        .action-button:disabled { background-color: #9ca3af; cursor: not-allowed; opacity: 0.8; }
        .quiz-option { cursor: pointer; transition: background-color 0.3s, transform 0.2s; }
        .quiz-option:hover { background-color: #f0f4f8; transform: scale(1.02); }
        .quiz-option.correct { background-color: #dcfce7; border-color: #22c55e; color: #166534; font-weight: 600; }
        .quiz-option.incorrect { background-color: #fee2e2; border-color: #ef4444; color: #991b1b; }
        .disabled { pointer-events: none; opacity: 0.7; }
    </style>
</head>
<body class="gradient-background text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Operating System Simulation</h1>
            <p class="mt-2 text-lg text-gray-600">Peripheral Management, Drivers, Buffers & Interrupts (OCR J277)</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="card p-6">
                <h2 class="text-2xl font-bold mb-2 text-center">Computer System</h2>
                <canvas id="simulationCanvas"></canvas>
                <div id="info-panel" class="mt-4 p-3 bg-indigo-100 border border-indigo-200 rounded-lg min-h-[80px]">
                    <h4 class="font-bold text-indigo-800">System Status:</h4>
                    <p id="info-text" class="text-sm text-indigo-700">Connect a peripheral to begin.</p>
                </div>
            </div>

            <div class="space-y-8">
                 <div class="card p-6">
                     <h2 class="text-2xl font-bold mb-4 text-center">Connect & Use Peripherals</h2>
                     <div id="workflow-section" class="mb-4 hidden">
                         <h3 class="font-bold text-center text-lg mb-2">Workflow: Print a Document</h3>
                         <div class="flex justify-center gap-2">
                            <button id="task-type" class="action-button text-sm bg-cyan-500 text-white font-bold py-2 px-4 rounded-md shadow-md">1. Type Document</button>
                            <button id="task-print" class="action-button text-sm bg-gray-400 text-white font-bold py-2 px-4 rounded-md shadow-md" disabled>2. Print Document</button>
                         </div>
                     </div>
                     <div id="controls-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                        <!-- Buttons will be generated by JS -->
                     </div>
                     <div class="text-center mt-6">
                         <button id="resetSimBtn" class="action-button bg-gray-500 text-white font-bold py-2 px-6 rounded-lg shadow-md text-lg">Reset All</button>
                     </div>
                 </div>

                 <div class="card p-6">
                     <h2 class="text-2xl font-bold mb-4 text-center">Knowledge Check</h2>
                     <div id="quiz-content">
                        <p id="question" class="text-lg font-semibold mb-4"></p>
                        <div id="options" class="space-y-3"></div>
                     </div>
                     <div id="feedback" class="mt-4 text-center font-semibold min-h-[40px]"></div>
                 </div>
            </div>
        </main>
    </div>

    <script>
        // --- GLOBAL STATE & CONFIG ---
        const canvas = document.getElementById('simulationCanvas'); const ctx = canvas.getContext('2d');
        const infoText = document.getElementById('info-text');
        const controlsGrid = document.getElementById('controls-grid');
        const resetSimBtn = document.getElementById('resetSimBtn');
        const workflowSection = document.getElementById('workflow-section');
        const taskTypeBtn = document.getElementById('task-type');
        const taskPrintBtn = document.getElementById('task-print');

        let peripherals = {}, packets = [], dataBuffer = [], interrupts = [];
        let hasDocument = false;
        let cpuPos = { x: 400, y: 225 };
        let bufferPos = { x: 250, y: 225 };
        let peripheralPositions = {};


        const peripheralData = {
            keyboard: { name: 'Keyboard', icon: '‚å®Ô∏è', type: 'input' },
            mouse:    { name: 'Mouse', icon: 'üñ±Ô∏è', type: 'input' },
            mic:      { name: 'Microphone', icon: 'üé§', type: 'input' },
            printer:  { name: 'Printer', icon: 'üñ®Ô∏è', type: 'output' },
            webcam:   { name: 'Webcam', icon: 'ÔøΩ', type: 'input' },
            speakers: { name: 'Speakers', icon: 'üîä', type: 'output' },
        };

        // --- CLASSES ---
        class Peripheral {
            constructor(id, data) { this.id = id; this.name = data.name; this.icon = data.icon; this.pos = peripheralPositions[id]; this.type = data.type; this.connected = false; this.driverInstalled = false; }
            draw() { ctx.fillStyle = this.connected ? '#fff' : '#e2e8f0'; ctx.strokeStyle = this.driverInstalled ? '#22c55e' : (this.connected ? '#f59e0b' : '#9ca3af'); ctx.lineWidth = 4; ctx.beginPath(); ctx.arc(this.pos.x, this.pos.y, 40, 0, Math.PI * 2); ctx.fill(); ctx.stroke(); ctx.font = '30px sans-serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText(this.icon, this.pos.x, this.pos.y); ctx.font = 'bold 12px Inter'; ctx.fillStyle = '#1e293b'; ctx.fillText(this.name, this.pos.x, this.pos.y + 55); if (this.connected) { ctx.beginPath(); ctx.moveTo(this.pos.x, this.pos.y); ctx.lineTo(cpuPos.x, cpuPos.y); ctx.strokeStyle = '#9ca3af'; ctx.lineWidth = 2; ctx.stroke(); } if(this.connected && !this.driverInstalled) { ctx.font = '24px sans-serif'; ctx.fillStyle = '#ef4444'; ctx.fillText('‚ùì', this.pos.x + 25, this.pos.y - 25); } }
        }
        class Packet {
            constructor(startX, startY, endX, endY, color, isDriver = false, hasDoc = false) { this.x = startX; this.y = startY; this.endX = endX; this.endY = endY; this.color = color; this.isDriver = isDriver; this.hasDoc = hasDoc; this.opacity = 1; const dx = endX - startX, dy = endY - startY, dist = Math.sqrt(dx * dx + dy * dy) || 1; this.vx = (dx / dist) * 2; this.vy = (dy / dist) * 2; }
            draw() { ctx.globalAlpha = this.opacity; ctx.fillStyle = this.color; if (this.isDriver) { ctx.fillRect(this.x - 8, this.y - 8, 16, 16); } else { ctx.beginPath(); ctx.arc(this.x, this.y, 5, 0, Math.PI * 2); ctx.fill(); } if (this.hasDoc) { ctx.font = '12px sans-serif'; ctx.fillText('üìÑ', this.x, this.y + 1); } ctx.globalAlpha = 1; }
            update() { this.x += this.vx; this.y += this.vy; const distToEnd = Math.sqrt(Math.pow(this.endX - this.x, 2) + Math.pow(this.endY - this.y, 2)); if (distToEnd < 5) { this.opacity = 0; if (this.hasDoc) { hasDocument = true; } } this.draw(); }
        }
        class Interrupt {
            constructor(x, y) { this.x = x; this.y = y; this.opacity = 1; this.scale = 0; }
            draw() { ctx.globalAlpha = this.opacity; ctx.fillStyle = '#f59e0b'; ctx.font = `${20 * this.scale}px sans-serif`; ctx.fillText('‚ö°', this.x, this.y); ctx.globalAlpha = 1; }
            update() { if(this.scale < 1) this.scale += 0.1; this.opacity -= 0.02; this.draw(); }
        }

        // --- DRAWING & SIM LOGIC ---
        function drawCPU() { ctx.fillStyle = '#fff'; ctx.strokeStyle = '#6366f1'; ctx.lineWidth = 6; ctx.fillRect(cpuPos.x - 60, cpuPos.y - 60, 120, 120); ctx.strokeRect(cpuPos.x - 60, cpuPos.y - 60, 120, 120); ctx.font = 'bold 16px Inter'; ctx.fillStyle = '#4338ca'; ctx.textAlign = 'center'; ctx.fillText('Operating', cpuPos.x, cpuPos.y - 10); ctx.fillText('System / CPU', cpuPos.x, cpuPos.y + 10); if(hasDocument) {ctx.font = '30px sans-serif'; ctx.fillText('üìÑ', cpuPos.x, cpuPos.y + 50);}}
        function drawBuffer() { ctx.strokeStyle = '#9ca3af'; ctx.lineWidth = 2; ctx.strokeRect(bufferPos.x - 30, bufferPos.y - 100, 60, 200); ctx.font = 'bold 12px Inter'; ctx.fillText('Buffer', bufferPos.x, bufferPos.y - 110); dataBuffer.forEach((packet, i) => { const yPos = bufferPos.y + 90 - (i * 20); ctx.fillStyle = packet.color; ctx.beginPath(); ctx.arc(bufferPos.x, yPos, 5, 0, Math.PI * 2); ctx.fill(); }); }

        function processBuffer() { if(dataBuffer.length > 0) { const packet = dataBuffer.shift(); packets.push(new Packet(bufferPos.x, bufferPos.y, cpuPos.x, cpuPos.y, packet.color, false, packet.hasDoc)); } }
        
        let processInterval = setInterval(processBuffer, 1000);

        function animate() { ctx.clearRect(0, 0, canvas.width, canvas.height); drawCPU(); drawBuffer(); for(const key in peripherals) { peripherals[key].draw(); } packets = packets.filter(p => p.opacity > 0); packets.forEach(p => p.update()); interrupts = interrupts.filter(i => i.opacity > 0); interrupts.forEach(i => i.update()); requestAnimationFrame(animate); }

        function generateControls() {
            controlsGrid.innerHTML = '';
            for(const id in peripherals) {
                const p = peripherals[id];
                const group = document.createElement('div');
                group.className = 'flex flex-col gap-2 items-center justify-center p-2 border rounded-lg bg-gray-50 h-28 shadow-sm';
                
                let html = `<h3 class="font-bold text-center text-gray-700">${p.name}</h3>`;
                if (!p.connected) {
                    html += `<button data-id="${id}" class="connect-btn action-button text-xs bg-blue-500 text-white font-bold py-2 px-3 rounded-md shadow-md">Connect</button>`;
                } else if (!p.driverInstalled) {
                    html += `<button data-id="${id}" class="driver-btn action-button text-xs bg-yellow-500 text-white font-bold py-2 px-3 rounded-md shadow-md">Install Driver</button>`;
                } else {
                    const actionText = p.type === 'input' ? 'Send Input' : 'Send Output';
                    html += `<button data-id="${id}" class="use-btn action-button text-xs bg-green-500 text-white font-bold py-2 px-3 rounded-md shadow-md">${actionText}</button>`;
                }
                group.innerHTML = html;
                controlsGrid.appendChild(group);
            }
            addControlListeners();
        }

        function addControlListeners() {
            document.querySelectorAll('.connect-btn').forEach(btn => btn.onclick = () => { const p = peripherals[btn.dataset.id]; p.connected = true; infoText.textContent = `OS has detected a new peripheral: ${p.name}. It needs a DRIVER to understand its signals.`; generateControls(); });
            document.querySelectorAll('.driver-btn').forEach(btn => btn.onclick = () => { const p = peripherals[btn.dataset.id]; packets.push(new Packet(p.pos.x, p.pos.y, cpuPos.x, cpuPos.y, '#f59e0b', true)); infoText.textContent = `Installing driver for ${p.name}. The driver translates the device's signals for the OS.`; setTimeout(() => { p.driverInstalled = true; infoText.textContent = `Driver for ${p.name} installed! The device is ready.`; generateControls(); if(peripherals.keyboard.driverInstalled && peripherals.printer.driverInstalled) { workflowSection.classList.remove('hidden');} }, 1000); });
             document.querySelectorAll('.use-btn').forEach(btn => btn.onclick = () => {
                const p = peripherals[btn.dataset.id];
                if(p.type === 'input') {
                    interrupts.push(new Interrupt(p.pos.x, p.pos.y));
                    setTimeout(() => {
                        dataBuffer.push({ color: '#3b82f6' });
                        infoText.textContent = `${p.name} sent an INTERRUPT. Its data is now in the BUFFER waiting for the CPU.`;
                    }, 500);
                } else {
                    interrupts.push(new Interrupt(cpuPos.x, cpuPos.y));
                    setTimeout(() => {
                        packets.push(new Packet(cpuPos.x, cpuPos.y, p.pos.x, p.pos.y, '#ef4444'));
                        infoText.textContent = `OS sends an INTERRUPT to use the ${p.name}, managing the OUTPUT of data.`;
                    }, 500);
                }
            });
        }
        
        function resizeCanvas() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientWidth * 0.5625; // 16:9 aspect ratio

            cpuPos = { x: canvas.width / 2, y: canvas.height / 2 };
            bufferPos = { x: canvas.width * 0.3, y: canvas.height / 2 };
            peripheralPositions = {
                keyboard: { x: canvas.width * 0.125, y: canvas.height * 0.16 },
                mouse:    { x: canvas.width * 0.125, y: canvas.height * 0.5 },
                mic:      { x: canvas.width * 0.125, y: canvas.height * 0.84 },
                printer:  { x: canvas.width * 0.875, y: canvas.height * 0.16 },
                webcam:   { x: canvas.width * 0.875, y: canvas.height * 0.5 },
                speakers: { x: canvas.width * 0.875, y: canvas.height * 0.84 },
            };
        }
        
        function setupSim() {
            peripherals = {};
            for(const id in peripheralData) { peripherals[id] = new Peripheral(id, peripheralData[id]); }
            packets = []; dataBuffer = []; interrupts = []; hasDocument = false;
            infoText.textContent = 'Connect a peripheral to begin.';
            workflowSection.classList.add('hidden');
            taskTypeBtn.disabled = false; taskTypeBtn.classList.replace('bg-gray-400', 'bg-cyan-500');
            taskPrintBtn.disabled = true; taskPrintBtn.classList.replace('bg-cyan-500', 'bg-gray-400');
            generateControls();
        }
        
        resetSimBtn.addEventListener('click', setupSim);
        taskTypeBtn.addEventListener('click', () => {
            if(!peripherals.keyboard.driverInstalled) { infoText.textContent = 'Connect the keyboard and install its driver first!'; return; }
            interrupts.push(new Interrupt(peripherals.keyboard.pos.x, peripherals.keyboard.pos.y));
            setTimeout(() => {
                dataBuffer.push({ color: '#3b82f6', hasDoc: true });
                infoText.textContent = `Keyboard data sent to BUFFER. The CPU will process it to create a document.`;
                taskTypeBtn.disabled = true; taskTypeBtn.classList.replace('bg-cyan-500', 'bg-gray-400');
                 setTimeout(() => { if(hasDocument) { taskPrintBtn.disabled = false; taskPrintBtn.classList.replace('bg-gray-400', 'bg-cyan-500'); infoText.textContent = 'Document created! Now you can send it to the printer.' }}, 1500);
            }, 500);
        });
        taskPrintBtn.addEventListener('click', () => {
             if(!peripherals.printer.driverInstalled) { infoText.textContent = 'Connect the printer and install its driver first!'; return; }
             hasDocument = false;
             interrupts.push(new Interrupt(cpuPos.x, cpuPos.y));
             setTimeout(() => {
                packets.push(new Packet(cpuPos.x, cpuPos.y, peripherals.printer.pos.x, peripherals.printer.pos.y, '#ef4444', false, true));
                infoText.textContent = `OS sends the document data to the printer for OUTPUT.`;
                taskPrintBtn.disabled = true; taskPrintBtn.classList.replace('bg-cyan-500', 'bg-gray-400');
             }, 500);
        });
        
        // --- QUIZ LOGIC ---
        const quizData = [
            { question: "What is the role of a device driver?", options: ["To provide power to the device", "To translate signals between the OS and the device", "To physically connect the device", "To store user data"], answer: 1},
            { question: "When you type very fast, what does the OS use to store keystrokes so they aren't lost?", options: ["A driver", "An interrupt", "A data buffer", "The power supply"], answer: 2},
            { question: "What is an 'interrupt'?", options: ["A power cut", "A signal from a peripheral seeking the CPU's attention", "A type of computer virus", "A computer shutting down"], answer: 1},
            { question: "Which of these is primarily an OUTPUT device?", options: ["Mouse", "Webcam", "Keyboard", "Speakers"], answer: 3}
        ];
        const questionEl = document.getElementById('question'), optionsEl = document.getElementById('options'), feedbackEl = document.getElementById('feedback');
        let currentQuizIndex = 0;
        
        function loadQuiz() {
            feedbackEl.textContent = '';
            const q = quizData[currentQuizIndex];
            questionEl.textContent = q.question;
            optionsEl.innerHTML = '';
            q.options.forEach((opt, i) => {
                const el = document.createElement('div');
                el.textContent = opt;
                el.classList.add('p-3', 'border', 'rounded-lg', 'quiz-option', 'border-gray-300', 'text-sm');
                el.addEventListener('click', () => selectAnswer(i, q.answer));
                optionsEl.appendChild(el);
            });
        }
        function selectAnswer(selectedIndex, correctIndex) {
            const opts = optionsEl.childNodes;
            if(selectedIndex === correctIndex) {
                opts[selectedIndex].classList.add('correct');
                feedbackEl.textContent = 'Correct! Moving to the next question...';
                feedbackEl.style.color = '#15803d';
            } else {
                 opts[selectedIndex].classList.add('incorrect');
                 opts[correctIndex].classList.add('correct');
                 feedbackEl.textContent = 'Not quite. The correct answer is highlighted.';
                 feedbackEl.style.color = '#b91c1c';
            }
            currentQuizIndex = (currentQuizIndex + 1) % quizData.length;
            setTimeout(loadQuiz, 2500);
        }
        
        // --- INITIAL LOAD ---
        window.onload = () => { 
            resizeCanvas();
            setupSim();
            animate();
            loadQuiz();
            window.addEventListener('resize', resizeCanvas);
        };
    </script>
</body>
</html>
ÔøΩ