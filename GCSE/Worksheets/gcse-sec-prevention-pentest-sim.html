<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PenTest Academy - Learn Ethical Hacking</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Matrix Background Effect */
        #matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid #00ff00;
            margin-bottom: 30px;
            position: relative;
        }

        h1 {
            font-size: 3em;
            text-shadow: 0 0 20px #00ff00;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px #00ff00; }
            to { text-shadow: 0 0 30px #00ff00, 0 0 40px #00ff00; }
        }

        /* Game Layout */
        .game-layout {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Mission Panel */
        .mission-panel {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            height: fit-content;
        }

        .mission-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #00ffff;
        }

        .mission-objectives {
            list-style: none;
        }

        .mission-objectives li {
            padding: 8px 0;
            display: flex;
            align-items: center;
        }

        .mission-objectives li:before {
            content: '‚ñ∂ ';
            margin-right: 10px;
            color: #ffff00;
        }

        .mission-objectives li.completed:before {
            content: '‚úì ';
            color: #00ff00;
        }

        /* Network Map */
        .network-map {
            background: rgba(0, 20, 40, 0.9);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            min-height: 400px;
        }

        .network-node {
            position: absolute;
            width: 80px;
            height: 80px;
            border: 2px solid #00ffff;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0, 50, 100, 0.8);
        }

        .network-node:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px #00ffff;
        }

        .network-node.vulnerable {
            border-color: #ff0000;
            box-shadow: 0 0 10px #ff0000;
        }

        .network-node.secured {
            border-color: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }

        .network-node .icon {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .network-node .label {
            font-size: 0.8em;
            text-align: center;
        }

        /* Tools Panel */
        .tools-panel {
            background: rgba(255, 255, 0, 0.1);
            border: 2px solid #ffff00;
            border-radius: 10px;
            padding: 20px;
        }

        .tool-item {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ffff00;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tool-item:hover {
            background: rgba(255, 255, 0, 0.2);
            transform: translateX(5px);
        }

        .tool-item.active {
            background: rgba(255, 255, 0, 0.3);
            box-shadow: 0 0 10px #ffff00;
        }

        /* Terminal */
        .terminal {
            background: #000;
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            height: 300px;
            overflow-y: auto;
        }

        .terminal-header {
            color: #00ffff;
            margin-bottom: 10px;
        }

        .terminal-output {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .terminal-input-line {
            display: flex;
            align-items: center;
        }

        .terminal-prompt {
            color: #00ff00;
            margin-right: 10px;
        }

        .terminal-input {
            background: transparent;
            border: none;
            color: #00ff00;
            flex: 1;
            font-family: inherit;
            font-size: inherit;
            outline: none;
        }

        /* HUD */
        .hud {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            border-radius: 5px;
        }

        .hud-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hud-label {
            color: #00ffff;
        }

        .hud-value {
            font-size: 1.2em;
            font-weight: bold;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #0a0a0a;
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 2em;
            margin-bottom: 20px;
            color: #00ffff;
        }

        .modal-close {
            float: right;
            font-size: 1.5em;
            cursor: pointer;
            color: #ff0000;
        }

        .modal-close:hover {
            color: #ff5555;
        }

        /* Buttons */
        .btn {
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1em;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: rgba(0, 255, 0, 0.3);
            box-shadow: 0 0 10px #00ff00;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
            color: #00ffff;
        }

        .btn-primary:hover {
            background: rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 10px #00ffff;
        }

        /* Achievements */
        .achievement {
            position: fixed;
            top: 20px;
            right: -400px;
            background: rgba(255, 215, 0, 0.9);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            color: #000;
            transition: right 0.5s ease;
            z-index: 2000;
        }

        .achievement.show {
            right: 20px;
        }

        .achievement-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .loading-text {
            font-size: 2em;
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .game-layout {
                grid-template-columns: 1fr;
            }
            
            .network-map {
                min-height: 300px;
            }
        }

        /* Animations */
        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(100%); }
        }

        .scanning {
            position: relative;
            overflow: hidden;
        }

        .scanning::after {
            content: '';
            position: absolute;
            top: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(transparent, rgba(0, 255, 0, 0.4), transparent);
            animation: scanline 2s linear infinite;
        }

        /* Glossary */
        .glossary-term {
            cursor: help;
            border-bottom: 1px dotted #00ffff;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00ffff;
            border-radius: 5px;
            padding: 10px;
            max-width: 300px;
            z-index: 100;
            display: none;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff00;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #00ffff);
            transition: width 0.5s ease;
        }

        /* Mini-game Styles */
        .minigame-container {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .password-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .password-cell {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .password-cell:hover {
            background: rgba(0, 255, 0, 0.3);
            transform: scale(1.05);
        }

        .password-cell.selected {
            background: rgba(255, 255, 0, 0.3);
            border-color: #ffff00;
        }

        .password-cell.correct {
            background: rgba(0, 255, 0, 0.5);
            animation: correctFlash 0.5s ease;
        }

        @keyframes correctFlash {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Matrix Background Effect -->
    <canvas id="matrix-bg"></canvas>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-text">INITIALIZING PENTEST ACADEMY...</div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <header>
            <h1>PENTEST ACADEMY</h1>
            <p>Learn Ethical Hacking Through Interactive Missions</p>
        </header>

        <!-- HUD -->
        <div class="hud">
            <div class="hud-item">
                <span class="hud-label">SCORE:</span>
                <span class="hud-value" id="score">0</span>
            </div>
            <div class="hud-item">
                <span class="hud-label">LEVEL:</span>
                <span class="hud-value" id="level">1</span>
            </div>
            <div class="hud-item">
                <span class="hud-label">MISSION:</span>
                <span class="hud-value" id="missionName">Network Discovery</span>
            </div>
            <div class="hud-item">
                <button class="btn btn-primary" onclick="showGlossary()">üìö Glossary</button>
                <button class="btn btn-primary" onclick="showProgress()">üìä Progress</button>
            </div>
        </div>

        <!-- Game Layout -->
        <div class="game-layout">
            <!-- Mission Panel -->
            <div class="mission-panel">
                <h2 class="mission-title">Mission Objectives</h2>
                <ul class="mission-objectives" id="objectives">
                    <li id="obj1">Scan the network</li>
                    <li id="obj2">Identify all devices</li>
                    <li id="obj3">Find vulnerable systems</li>
                </ul>
                <div style="margin-top: 20px;">
                    <h3 style="color: #ffff00; margin-bottom: 10px;">Mission Brief:</h3>
                    <p id="missionBrief" style="font-size: 0.9em; line-height: 1.4;">
                        Welcome, recruit! TechCorp has hired you to test their network security. 
                        Your first task is to discover all devices on their network and identify 
                        potential vulnerabilities. Use your tools wisely!
                    </p>
                </div>
            </div>

            <!-- Network Map -->
            <div class="network-map" id="networkMap">
                <h3 style="color: #00ffff; margin-bottom: 15px;">Network Visualization</h3>
                <!-- Network nodes will be dynamically added here -->
            </div>

            <!-- Tools Panel -->
            <div class="tools-panel">
                <h2 class="mission-title" style="color: #ffff00;">Toolkit</h2>
                <div class="tool-item" onclick="selectTool('scanner')" id="tool-scanner">
                    <strong>üîç Network Scanner</strong>
                    <p style="font-size: 0.8em; margin-top: 5px;">Discover devices on the network</p>
                </div>
                <div class="tool-item" onclick="selectTool('probe')" id="tool-probe">
                    <strong>üì° Port Probe</strong>
                    <p style="font-size: 0.8em; margin-top: 5px;">Check for open ports</p>
                </div>
                <div class="tool-item" onclick="selectTool('analyzer')" id="tool-analyzer">
                    <strong>üîê Vulnerability Analyzer</strong>
                    <p style="font-size: 0.8em; margin-top: 5px;">Identify security weaknesses</p>
                </div>
                <div class="tool-item" onclick="selectTool('cracker')" id="tool-cracker" style="opacity: 0.5;">
                    <strong>üîì Password Tester</strong>
                    <p style="font-size: 0.8em; margin-top: 5px;">Locked - Complete Mission 1</p>
                </div>
                <div class="tool-item" onclick="selectTool('sql')" id="tool-sql" style="opacity: 0.5;">
                    <strong>üíâ SQL Injector</strong>
                    <p style="font-size: 0.8em; margin-top: 5px;">Locked - Complete Mission 2</p>
                </div>
                <div class="tool-item" onclick="selectTool('exploit')" id="tool-exploit" style="opacity: 0.5;">
                    <strong>üï∑Ô∏è Web Exploit</strong>
                    <p style="font-size: 0.8em; margin-top: 5px;">Locked - Complete Mission 3</p>
                </div>
                <div class="tool-item" onclick="selectTool('hijacker')" id="tool-hijacker" style="opacity: 0.5;">
                    <strong>üéØ Device Hijacker</strong>
                    <p style="font-size: 0.8em; margin-top: 5px;">Locked - Complete Mission 4</p>
                </div>
            </div>
        </div>

        <!-- Terminal -->
        <div class="terminal">
            <div class="terminal-header">root@pentest-academy:~#</div>
            <div id="terminalOutput" class="terminal-output">
                <div>Welcome to PenTest Academy Terminal v1.0</div>
                <div>Type 'help' for available commands or use the tools above.</div>
                <div style="color: #ffff00;">Remember: This is a safe learning environment!</div>
            </div>
            <div class="terminal-input-line">
                <span class="terminal-prompt">></span>
                <input type="text" class="terminal-input" id="terminalInput" 
                       placeholder="Type command here..." 
                       onkeypress="handleTerminalInput(event)">
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Welcome Modal -->
    <div class="modal active" id="welcomeModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('welcomeModal')">√ó</span>
            <h2 class="modal-header">Welcome to PenTest Academy!</h2>
            <p style="margin-bottom: 15px;">
                You're about to embark on an exciting journey into the world of ethical hacking 
                and cybersecurity. In this simulator, you'll learn:
            </p>
            <ul style="color: #00ffff; margin: 20px 0;">
                <li>Network scanning and discovery</li>
                <li>Vulnerability identification</li>
                <li>Security best practices</li>
                <li>Ethical hacking principles</li>
                <li>Real-world security concepts</li>
            </ul>
            <p style="color: #ffff00; margin: 20px 0;">
                ‚ö†Ô∏è Important: This is a safe, educational environment. All hacking activities 
                are simulated. Always remember: use these skills ethically and legally!
            </p>
            <button class="btn btn-primary" onclick="startGame()">Start Your Journey</button>
        </div>
    </div>

    <!-- Glossary Modal -->
    <div class="modal" id="glossaryModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('glossaryModal')">√ó</span>
            <h2 class="modal-header">Cybersecurity Glossary</h2>
            <div id="glossaryContent">
                <!-- Glossary terms will be added dynamically -->
            </div>
        </div>
    </div>

    <!-- Progress Modal -->
    <div class="modal" id="progressModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('progressModal')">√ó</span>
            <h2 class="modal-header">Your Progress</h2>
            <div id="progressContent">
                <!-- Progress will be shown here -->
            </div>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="achievement" id="achievementPopup">
        <div class="achievement-title" id="achievementTitle">Achievement Unlocked!</div>
        <div id="achievementText">Description</div>
    </div>

    <script>
        // Game State
        let gameState = {
            score: 0,
            level: 1,
            currentMission: 1,
            selectedTool: null,
            discoveredNodes: [],
            completedObjectives: [],
            achievements: [],
            terminalHistory: [],
            tutorialMode: true
        };

        // Network Nodes Data
        const networkNodes = [
            { id: 'router', label: 'Router', icon: 'üåê', x: 50, y: 50, type: 'router', vulnerable: false },
            { id: 'server1', label: 'Web Server', icon: 'üñ•Ô∏è', x: 70, y: 30, type: 'server', vulnerable: true, hidden: true },
            { id: 'server2', label: 'Database', icon: 'üóÑÔ∏è', x: 30, y: 30, type: 'database', vulnerable: true, hidden: true },
            { id: 'workstation1', label: 'Workstation', icon: 'üíª', x: 20, y: 70, type: 'workstation', vulnerable: false, hidden: true },
            { id: 'workstation2', label: 'Admin PC', icon: 'üíª', x: 80, y: 70, type: 'workstation', vulnerable: true, hidden: true },
            { id: 'printer', label: 'Printer', icon: 'üñ®Ô∏è', x: 50, y: 80, type: 'device', vulnerable: true, hidden: true }
        ];

        // Missions Data
        const missions = [
            {
                id: 1,
                name: "Network Discovery",
                brief: "Welcome, recruit! TechCorp has hired you to test their network security. Your first task is to discover all devices on their network and identify potential vulnerabilities. Use your tools wisely!",
                objectives: [
                    { id: 'obj1', text: 'Scan the network', points: 100 },
                    { id: 'obj2', text: 'Identify all devices', points: 200 },
                    { id: 'obj3', text: 'Find vulnerable systems', points: 300 }
                ]
            },
            {
                id: 2,
                name: "Weak Password Attack",
                brief: "You've discovered the Admin PC has weak password protection. Your mission is to demonstrate this vulnerability by cracking the password and securing it.",
                objectives: [
                    { id: 'obj1', text: 'Select the Password Tester tool', points: 100 },
                    { id: 'obj2', text: 'Target the Admin PC', points: 100 },
                    { id: 'obj3', text: 'Crack the weak password', points: 300 }
                ],
                targetDevice: 'workstation2'
            },
            {
                id: 3,
                name: "SQL Injection Attack",
                brief: "The database server has a vulnerable login form! Your mission is to demonstrate SQL injection by bypassing the login authentication.",
                objectives: [
                    { id: 'obj1', text: 'Select the SQL Injector tool', points: 100 },
                    { id: 'obj2', text: 'Target the Database server', points: 100 },
                    { id: 'obj3', text: 'Perform SQL injection attack', points: 300 }
                ],
                targetDevice: 'server2'
            },
            {
                id: 4,
                name: "Web Server Exploitation",
                brief: "The web server is running outdated software with known vulnerabilities. Your mission is to exploit this weakness and patch it.",
                objectives: [
                    { id: 'obj1', text: 'Select the Web Exploit tool', points: 100 },
                    { id: 'obj2', text: 'Target the Web Server', points: 100 },
                    { id: 'obj3', text: 'Exploit the outdated Apache version', points: 300 }
                ],
                targetDevice: 'server1'
            },
            {
                id: 5,
                name: "Printer Hijacking",
                brief: "The network printer has no authentication! Your final mission is to demonstrate how this could be abused and secure it.",
                objectives: [
                    { id: 'obj1', text: 'Select the Device Hijacker tool', points: 100 },
                    { id: 'obj2', text: 'Target the Printer', points: 100 },
                    { id: 'obj3', text: 'Access the printer admin panel', points: 300 }
                ],
                targetDevice: 'printer'
            }
        ];

        // Glossary Terms
        const glossaryTerms = {
            'IP Address': 'A unique identifier for devices on a network (e.g., 192.168.1.1)',
            'Port': 'A communication endpoint for services (e.g., port 80 for web traffic)',
            'Vulnerability': 'A weakness in a system that could be exploited',
            'Firewall': 'A security system that monitors and controls network traffic',
            'Encryption': 'The process of encoding data to prevent unauthorized access',
            'Penetration Testing': 'Authorized simulated cyberattacks to test security',
            'Network Scanning': 'The process of discovering devices on a network',
            'SSH': 'Secure Shell - A protocol for secure remote access',
            'HTTP/HTTPS': 'Protocols for web communication (S = Secure)',
            'SQL Injection': 'A code injection technique to attack databases',
            'Social Engineering': 'Manipulating people to divulge confidential information',
            'Two-Factor Authentication': 'Security method requiring two forms of identification'
        };

        // Initialize Game
        function initGame() {
            // Load saved progress
            loadProgress();
            
            // Initialize network map
            renderNetworkMap();
            
            // Initialize terminal
            initTerminal();
            
            // Start matrix effect
            startMatrixEffect();
            
            // Hide loading screen after initialization
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                // Ensure welcome modal is visible
                document.getElementById('welcomeModal').style.display = 'flex';
            }, 1000);
        }

        // Start Game
        function startGame() {
            document.getElementById('welcomeModal').classList.remove('active');
            document.getElementById('welcomeModal').style.display = 'none';
            showAchievement('First Steps', 'Welcome to PenTest Academy!');
            
            // Show tutorial hint
            if (gameState.tutorialMode) {
                addTerminalOutput('üí° Tutorial: Click on the Network Scanner tool to begin discovering devices!', '#ffff00');
                
                // Add visual indicator to the scanner tool
                const scannerTool = document.getElementById('tool-scanner');
                scannerTool.style.animation = 'pulse 2s infinite';
                scannerTool.style.border = '2px solid #00ff00';
                
                // Show step-by-step guide
                showStepByStepGuide();
            }
        }
        
        // Step-by-step guide
        function showStepByStepGuide() {
            const guide = document.createElement('div');
            guide.id = 'stepGuide';
            guide.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 255, 255, 0.9);
                color: #000;
                padding: 20px;
                border-radius: 10px;
                font-size: 1.2em;
                font-weight: bold;
                z-index: 1000;
                max-width: 600px;
                text-align: center;
                box-shadow: 0 0 20px #00ffff;
            `;
            guide.innerHTML = `
                <div>üìã STEP 1: Click on the "üîç Network Scanner" tool in the yellow box on the right</div>
                <button onclick="this.parentElement.remove()" style="margin-top: 10px; padding: 5px 15px; background: #000; color: #fff; border: none; border-radius: 5px; cursor: pointer;">Got it!</button>
            `;
            document.body.appendChild(guide);
        }

        // Render Network Map
        function renderNetworkMap() {
            const networkMap = document.getElementById('networkMap');
            
            // Clear existing nodes
            const existingNodes = networkMap.querySelectorAll('.network-node');
            existingNodes.forEach(node => node.remove());
            
            // Add nodes
            networkNodes.forEach(node => {
                if (!node.hidden || gameState.discoveredNodes.includes(node.id)) {
                    const nodeElement = createNetworkNode(node);
                    networkMap.appendChild(nodeElement);
                }
            });
        }

        // Create Network Node Element
        function createNetworkNode(nodeData) {
            const node = document.createElement('div');
            node.className = 'network-node';
            node.id = `node-${nodeData.id}`;
            node.style.left = `${nodeData.x}%`;
            node.style.top = `${nodeData.y}%`;
            
            if (nodeData.vulnerable) {
                node.classList.add('vulnerable');
            }
            
            node.innerHTML = `
                <div class="icon">${nodeData.icon}</div>
                <div class="label">${nodeData.label}</div>
            `;
            
            node.onclick = () => interactWithNode(nodeData);
            
            return node;
        }

        // Tool Selection
        function selectTool(toolName) {
            // Check if tool is locked
            const lockMessages = {
                'cracker': 'Complete Mission 1 first!',
                'sql': 'Complete Mission 2 first!',
                'exploit': 'Complete Mission 3 first!',
                'hijacker': 'Complete Mission 4 first!'
            };
            
            if (lockMessages[toolName] && document.getElementById(`tool-${toolName}`).style.opacity === '0.5') {
                addTerminalOutput(`‚ö†Ô∏è This tool is locked. ${lockMessages[toolName]}`, '#ff0000');
                return;
            }
            
            // Deselect previous tool
            document.querySelectorAll('.tool-item').forEach(tool => {
                tool.classList.remove('active');
                tool.style.animation = '';
                tool.style.border = '';
                tool.style.boxShadow = '';
            });
            
            // Select new tool
            const selectedTool = document.getElementById(`tool-${toolName}`);
            selectedTool.classList.add('active');
            gameState.selectedTool = toolName;
            
            // Provide feedback
            const toolMessages = {
                'scanner': 'Network Scanner selected. Click on the router to start scanning!',
                'probe': 'Port Probe selected. Click on a discovered device to probe its ports!',
                'analyzer': 'Vulnerability Analyzer selected. Click on a device to analyze vulnerabilities!',
                'cracker': 'Password Tester selected. Target the Admin PC!',
                'sql': 'SQL Injector selected. Target the Database server!',
                'exploit': 'Web Exploit selected. Target the Web Server!',
                'hijacker': 'Device Hijacker selected. Target the Printer!'
            };
            
            addTerminalOutput(`üîß ${toolMessages[toolName]}`, '#00ffff');
            
            // Mission-specific guidance
            if (gameState.currentMission > 1) {
                const mission = missions[gameState.currentMission - 1];
                if (mission.targetDevice) {
                    // Highlight the target device
                    const targetNode = document.getElementById(`node-${mission.targetDevice}`);
                    if (targetNode) {
                        targetNode.style.animation = 'pulse 2s infinite';
                        targetNode.style.boxShadow = '0 0 30px #ff00ff';
                        
                        // Mark tool selection objective complete
                        if (!gameState.completedObjectives.includes('obj1')) {
                            completeObjective('obj1');
                        }
                        
                        const targetInfo = networkNodes.find(n => n.id === mission.targetDevice);
                        addTerminalOutput(`üí° Step 2: Now click on the ${targetInfo.icon} ${targetInfo.label}!`, '#ff00ff');
                    }
                }
            }
            
            // Show next step for scanner
            if (toolName === 'scanner' && gameState.tutorialMode && gameState.currentMission === 1) {
                // Remove previous guide
                const oldGuide = document.getElementById('stepGuide');
                if (oldGuide) oldGuide.remove();
                
                // Highlight the router
                const router = document.getElementById('node-router');
                if (router) {
                    router.style.animation = 'pulse 2s infinite';
                    router.style.boxShadow = '0 0 30px #00ff00';
                }
                
                // Show step 2
                const guide = document.createElement('div');
                guide.id = 'stepGuide';
                guide.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(0, 255, 255, 0.9);
                    color: #000;
                    padding: 20px;
                    border-radius: 10px;
                    font-size: 1.2em;
                    font-weight: bold;
                    z-index: 1000;
                    max-width: 600px;
                    text-align: center;
                    box-shadow: 0 0 20px #00ffff;
                `;
                guide.innerHTML = `
                    <div>üìã STEP 2: Now click on the Router (üåê) in the blue Network Map</div>
                    <div style="font-size: 0.8em; margin-top: 10px;">The router is the glowing device in the center!</div>
                    <button onclick="this.parentElement.remove()" style="margin-top: 10px; padding: 5px 15px; background: #000; color: #fff; border: none; border-radius: 5px; cursor: pointer;">Got it!</button>
                `;
                document.body.appendChild(guide);
            }
        }

        // Interact with Network Node
        function interactWithNode(nodeData) {
            if (!gameState.selectedTool) {
                addTerminalOutput('‚ö†Ô∏è Select a tool first!', '#ffff00');
                return;
            }
            
            const node = document.getElementById(`node-${nodeData.id}`);
            
            // Mission-specific interaction
            if (gameState.currentMission > 1) {
                const mission = missions[gameState.currentMission - 1];
                
                // Check if this is the target device for the current mission
                if (mission.targetDevice && nodeData.id === mission.targetDevice) {
                    // Mark targeting objective complete
                    if (!gameState.completedObjectives.includes('obj2')) {
                        completeObjective('obj2');
                    }
                    
                    // Remove highlight
                    node.style.animation = '';
                    node.style.boxShadow = '';
                }
            }
            
            switch (gameState.selectedTool) {
                case 'scanner':
                    if (nodeData.id === 'router') {
                        performNetworkScan();
                    } else {
                        addTerminalOutput('üí° Hint: Start by scanning from the router!', '#ffff00');
                    }
                    break;
                    
                case 'probe':
                    if (gameState.discoveredNodes.includes(nodeData.id)) {
                        performPortProbe(nodeData);
                    } else {
                        addTerminalOutput('‚ö†Ô∏è Device not discovered yet!', '#ff0000');
                    }
                    break;
                    
                case 'analyzer':
                    if (gameState.discoveredNodes.includes(nodeData.id)) {
                        performVulnerabilityAnalysis(nodeData);
                    } else {
                        addTerminalOutput('‚ö†Ô∏è Device not discovered yet!', '#ff0000');
                    }
                    break;
                    
                case 'cracker':
                    if (nodeData.id === 'workstation2' && gameState.currentMission === 2) {
                        startPasswordMinigame(nodeData);
                    } else {
                        addTerminalOutput('üí° This tool only works on the Admin PC!', '#ffff00');
                    }
                    break;
                    
                case 'sql':
                    if (nodeData.id === 'server2' && gameState.currentMission === 3) {
                        startSQLChallenge(nodeData);
                    } else {
                        addTerminalOutput('üí° This tool only works on the Database server!', '#ffff00');
                    }
                    break;
                    
                case 'exploit':
                    if (nodeData.id === 'server1' && gameState.currentMission === 4) {
                        startWebExploit(nodeData);
                    } else {
                        addTerminalOutput('üí° This tool only works on the Web Server!', '#ffff00');
                    }
                    break;
                    
                case 'hijacker':
                    if (nodeData.id === 'printer' && gameState.currentMission === 5) {
                        startPrinterHijack(nodeData);
                    } else {
                        addTerminalOutput('üí° This tool only works on the Printer!', '#ffff00');
                    }
                    break;
            }
        }
        
        // SQL Challenge
        function startSQLChallenge(nodeData) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <span class="modal-close" onclick="this.parentElement.parentElement.remove()">√ó</span>
                    <h2 class="modal-header">SQL Injection Attack</h2>
                    <p>This login form might be vulnerable to SQL injection. Try to bypass the login!</p>
                    <div class="minigame-container">
                        <div style="background: #fff; color: #000; padding: 20px; border-radius: 5px; margin: 20px 0;">
                            <h3 style="color: #0066cc;">Database Login Portal</h3>
                            <div style="margin: 20px 0;">
                                <label style="display: block; margin-bottom: 10px; color: #333;">Username:</label>
                                <input type="text" id="sqlUsername" style="width: 100%; padding: 10px; border: 1px solid #ccc;" placeholder="Enter username">
                            </div>
                            <div style="margin: 20px 0;">
                                <label style="display: block; margin-bottom: 10px; color: #333;">Password:</label>
                                <input type="password" id="sqlPassword" style="width: 100%; padding: 10px; border: 1px solid #ccc;" placeholder="Enter password">
                            </div>
                            <button onclick="checkSQLInjection()" style="padding: 10px 30px; background: #0066cc; color: white; border: none; cursor: pointer;">Login</button>
                        </div>
                        <div style="background: rgba(0,255,0,0.1); padding: 15px; border-radius: 5px; margin: 20px 0;">
                            <p style="color: #ffff00; font-weight: bold;">üí° SQL Injection Hint:</p>
                            <p style="color: #00ff00; font-family: monospace;">In SQL, the characters ' OR '1'='1 can trick badly written code</p>
                            <p style="color: #00ffff; font-size: 0.9em;">Try typing this in the username field: <strong>admin' OR '1'='1</strong></p>
                            <p style="color: #00ffff; font-size: 0.9em;">Leave the password field empty!</p>
                        </div>
                        <div id="sqlResult" style="margin-top: 20px;"></div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function checkSQLInjection() {
            const username = document.getElementById('sqlUsername').value;
            const password = document.getElementById('sqlPassword').value;
            const result = document.getElementById('sqlResult');
            
            // Check for SQL injection patterns
            if (username.includes("' OR '1'='1") || username.includes("' OR 1=1") || 
                username.includes("'; DROP TABLE") || username.includes("admin'--")) {
                result.innerHTML = `
                    <p style="color: #00ff00;">‚úì SQL Injection successful! You bypassed the login!</p>
                    <p style="color: #ffff00;">The system tried to run: SELECT * FROM users WHERE username='${username}' AND password='${password}'</p>
                    <p style="color: #ff0000;">This is why input validation is critical!</p>
                `;
                setTimeout(() => {
                    document.querySelector('.modal.active').remove();
                    addTerminalOutput('‚úì SQL Injection attack successful!', '#00ff00');
                    addTerminalOutput('üí° The injection made the query always return true, bypassing authentication!', '#ffff00');
                    completeObjective('obj3');
                    updateScore(300);
                    checkMissionComplete();
                }, 3000);
            } else if (username === 'admin' && password === 'password') {
                result.innerHTML = '<p style="color: #ffff00;">That would work with the right password, but try SQL injection instead!</p>';
            } else {
                result.innerHTML = '<p style="color: #ff0000;">‚úó Login failed. Check the hint and try the SQL injection command!</p>';
            }
        }
        
        // Web Exploit Challenge
        function startWebExploit(nodeData) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <span class="modal-close" onclick="this.parentElement.parentElement.remove()">√ó</span>
                    <h2 class="modal-header">Web Server Exploit</h2>
                    <p>The server is running outdated software. Let's check for vulnerabilities!</p>
                    <div class="minigame-container">
                        <div style="background: #000; border: 1px solid #00ff00; padding: 20px; margin: 20px 0; font-family: monospace;">
                            <p style="color: #00ff00;">$ Check server version...</p>
                            <p style="color: #00ffff;">Server: Apache/2.2.8 (Ubuntu)</p>
                            <p style="color: #ffff00;">‚ö†Ô∏è This version is from 2008 - very outdated!</p>
                        </div>
                        
                        <div style="background: rgba(255,255,0,0.1); padding: 15px; border-radius: 5px; margin: 20px 0;">
                            <p style="color: #ffff00; font-weight: bold;">üìö What you need to know:</p>
                            <ul style="color: #00ffff; margin: 10px 0; padding-left: 20px;">
                                <li><strong>CVE</strong> = Common Vulnerabilities and Exposures (a list of known security flaws)</li>
                                <li><strong>DoS</strong> = Denial of Service (makes a service unavailable)</li>
                                <li><strong>Buffer Overflow</strong> = Sending too much data to crash a program</li>
                                <li>Outdated software often has known security holes!</li>
                            </ul>
                        </div>
                        
                        <p>Which security check should we run?</p>
                        <div class="password-grid" style="grid-template-columns: 1fr;">
                            <div class="password-cell" onclick="runSecurityCheck('update', this)">
                                <strong>Check for Updates</strong>
                                <p style="font-size: 0.8em; margin-top: 5px;">See if newer versions are available</p>
                            </div>
                            <div class="password-cell" onclick="runSecurityCheck('patch', this)">
                                <strong>Apply Security Patches</strong>
                                <p style="font-size: 0.8em; margin-top: 5px;">Install the latest security fixes</p>
                            </div>
                            <div class="password-cell" onclick="runSecurityCheck('scan', this)">
                                <strong>Run Vulnerability Scanner</strong>
                                <p style="font-size: 0.8em; margin-top: 5px;">Check for known security issues</p>
                            </div>
                        </div>
                        <div id="exploitResult" style="margin-top: 20px;"></div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function runSecurityCheck(action, element) {
            document.querySelectorAll('.password-cell').forEach(cell => cell.classList.remove('selected'));
            element.classList.add('selected');
            const result = document.getElementById('exploitResult');
            
            if (action === 'scan') {
                result.innerHTML = `
                    <p style="color: #ff0000;">‚ö†Ô∏è CRITICAL: 23 vulnerabilities found in Apache 2.2.8!</p>
                    <p style="color: #ffff00;">Including: CVE-2011-3192, CVE-2010-0425, CVE-2009-1891</p>
                `;
                element.classList.add('correct');
                setTimeout(() => {
                    document.querySelector('.modal.active').remove();
                    addTerminalOutput('‚úì Vulnerability scan complete! Multiple security issues found!', '#ff0000');
                    addTerminalOutput('üí° This old version has 23 known vulnerabilities that hackers could exploit!', '#ffff00');
                    addTerminalOutput('‚úÖ Recommendation: Update Apache immediately to patch these security holes!', '#00ff00');
                    completeObjective('obj3');
                    updateScore(300);
                    checkMissionComplete();
                }, 3000);
            } else if (action === 'update') {
                result.innerHTML = '<p style="color: #00ffff;">Good idea! But first, let\'s scan to see what vulnerabilities exist.</p>';
            } else {
                result.innerHTML = '<p style="color: #00ffff;">That would help, but let\'s first scan to identify the problems!</p>';
            }
        }
        
        // Printer Hijack Challenge
        function startPrinterHijack(nodeData) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <span class="modal-close" onclick="this.parentElement.parentElement.remove()">√ó</span>
                    <h2 class="modal-header">Printer Admin Panel</h2>
                    <p>You've accessed the printer's web interface. It has no authentication!</p>
                    <div class="minigame-container">
                        <div style="background: #fff; color: #000; padding: 20px; border-radius: 5px; margin: 20px 0;">
                            <h3 style="color: #0066cc;">PrinterCorp 5000 - Admin Panel</h3>
                            <p style="margin: 10px 0;">Status: Online</p>
                            <p style="margin: 10px 0;">Pages Printed: 45,231</p>
                            <p style="margin: 10px 0;">Toner Level: 67%</p>
                            <div style="margin-top: 20px;">
                                <button onclick="printerAction('print')" style="margin: 5px; padding: 10px 20px; background: #0066cc; color: white; border: none; cursor: pointer;">Print Test Page</button>
                                <button onclick="printerAction('settings')" style="margin: 5px; padding: 10px 20px; background: #ff6600; color: white; border: none; cursor: pointer;">Change Settings</button>
                                <button onclick="printerAction('secure')" style="margin: 5px; padding: 10px 20px; background: #00cc00; color: white; border: none; cursor: pointer;">Enable Security</button>
                            </div>
                        </div>
                        <p style="color: #ffff00;">üí° You have full admin access! Click "Enable Security" to fix this vulnerability.</p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function printerAction(action) {
            if (action === 'secure') {
                document.querySelector('.modal.active').remove();
                addTerminalOutput('‚úì Printer security enabled! Admin panel now requires authentication!', '#00ff00');
                addTerminalOutput('üéØ Final vulnerability secured!', '#ffff00');
                completeObjective('obj3');
                updateScore(300);
                
                // Mark printer as secured
                const printer = document.getElementById('node-printer');
                printer.classList.add('secured');
                printer.classList.remove('vulnerable');
                
                checkMissionComplete();
            } else if (action === 'print') {
                addTerminalOutput('üìÑ Test page sent to printer...', '#00ffff');
            } else if (action === 'settings') {
                addTerminalOutput('‚öôÔ∏è You could change any settings without authorization!', '#ff0000');
            }
        }

        // Perform Network Scan
        function performNetworkScan() {
            addTerminalOutput('üîç Initiating network scan...', '#00ff00');
            
            // Remove step guide
            const guide = document.getElementById('stepGuide');
            if (guide) guide.remove();
            
            // Remove router highlight
            const router = document.getElementById('node-router');
            if (router) {
                router.style.animation = '';
                router.style.boxShadow = '';
            }
            
            // Add scanning animation to network map
            const networkMap = document.getElementById('networkMap');
            networkMap.classList.add('scanning');
            
            // Simulate scan progress
            let progress = 0;
            const scanInterval = setInterval(() => {
                progress += 10;
                addTerminalOutput(`Scanning... ${progress}%`, '#00ff00');
                
                if (progress >= 100) {
                    clearInterval(scanInterval);
                    networkMap.classList.remove('scanning');
                    
                    // Discover all hidden nodes
                    networkNodes.forEach(node => {
                        if (node.hidden && !gameState.discoveredNodes.includes(node.id)) {
                            gameState.discoveredNodes.push(node.id);
                            addTerminalOutput(`‚úì Discovered: ${node.label} [${node.type}]`, '#00ffff');
                        }
                    });
                    
                    // Update objectives
                    completeObjective('obj1');
                    
                    if (gameState.discoveredNodes.length >= 5) {
                        completeObjective('obj2');
                    }
                    
                    // Re-render network map
                    renderNetworkMap();
                    
                    addTerminalOutput('üéØ Network scan complete!', '#00ff00');
                    updateScore(100);
                    
                    // Show next steps
                    showNextStepGuide();
                }
            }, 500);
        }
        
        function showNextStepGuide() {
            const guide = document.createElement('div');
            guide.id = 'stepGuide';
            guide.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(255, 255, 0, 0.9);
                color: #000;
                padding: 20px;
                border-radius: 10px;
                font-size: 1.2em;
                font-weight: bold;
                z-index: 1000;
                max-width: 700px;
                text-align: center;
                box-shadow: 0 0 20px #ffff00;
            `;
            guide.innerHTML = `
                <div>üéâ Great job! You've discovered all the devices on the network!</div>
                <div style="font-size: 0.9em; margin-top: 10px;">
                    üìã STEP 3: Now select the "üì° Port Probe" tool and click on each device to see what services they're running
                </div>
                <div style="font-size: 0.8em; margin-top: 10px; color: #666;">
                    This helps us understand what each device does before we check for vulnerabilities!
                </div>
                <button onclick="this.parentElement.remove()" style="margin-top: 10px; padding: 5px 15px; background: #000; color: #fff; border: none; border-radius: 5px; cursor: pointer;">Let's probe!</button>
            `;
            document.body.appendChild(guide);
            
            // Highlight the port probe tool
            const probeTool = document.getElementById('tool-probe');
            probeTool.style.animation = 'pulse 2s infinite';
            probeTool.style.border = '2px solid #ffff00';
        }

        // Perform Port Probe
        function performPortProbe(nodeData) {
            addTerminalOutput(`üì° Probing ports on ${nodeData.label}...`, '#00ff00');
            
            // Track probed nodes
            if (!gameState.probedNodes) {
                gameState.probedNodes = [];
            }
            
            // Remove probe tool highlight on first use
            if (gameState.probedNodes.length === 0) {
                const probeTool = document.getElementById('tool-probe');
                probeTool.style.animation = '';
                probeTool.style.border = '';
            }
            
            const ports = {
                'server': ['22 (SSH)', '80 (HTTP)', '443 (HTTPS)', '3306 (MySQL)'],
                'database': ['3306 (MySQL)', '5432 (PostgreSQL)'],
                'workstation': ['135 (RPC)', '445 (SMB)', '3389 (RDP)'],
                'router': ['22 (SSH)', '80 (HTTP)', '443 (HTTPS)'],
                'device': ['9100 (Printer)', '80 (HTTP)']
            };
            
            setTimeout(() => {
                const nodePorts = ports[nodeData.type] || ['Unknown'];
                addTerminalOutput(`Open ports on ${nodeData.label}:`, '#00ffff');
                nodePorts.forEach(port => {
                    addTerminalOutput(`  ‚úì Port ${port}`, '#00ff00');
                });
                
                // Track this node as probed
                if (!gameState.probedNodes.includes(nodeData.id)) {
                    gameState.probedNodes.push(nodeData.id);
                    updateScore(50);
                }
                
                // Check if all nodes have been probed
                if (gameState.probedNodes.length >= gameState.discoveredNodes.length) {
                    // All nodes probed, show next step
                    setTimeout(() => {
                        showVulnerabilityGuide();
                    }, 1000);
                } else {
                    const remaining = gameState.discoveredNodes.length - gameState.probedNodes.length;
                    addTerminalOutput(`üí° ${remaining} more device(s) to probe!`, '#ffff00');
                }
            }, 1500);
        }
        
        function showVulnerabilityGuide() {
            const guide = document.createElement('div');
            guide.id = 'stepGuide';
            guide.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(255, 0, 0, 0.9);
                color: #fff;
                padding: 20px;
                border-radius: 10px;
                font-size: 1.2em;
                font-weight: bold;
                z-index: 1000;
                max-width: 700px;
                text-align: center;
                box-shadow: 0 0 20px #ff0000;
            `;
            guide.innerHTML = `
                <div>üìä Excellent! You now know what services are running on each device!</div>
                <div style="font-size: 0.9em; margin-top: 10px;">
                    üìã STEP 4: Time to check for vulnerabilities! Select the "üîê Vulnerability Analyzer" and click on the RED devices
                </div>
                <div style="font-size: 0.8em; margin-top: 10px;">
                    Now that we know what's running, we can check if any services have security problems!
                </div>
                <button onclick="this.parentElement.remove()" style="margin-top: 10px; padding: 5px 15px; background: #fff; color: #000; border: none; border-radius: 5px; cursor: pointer;">Find vulnerabilities!</button>
            `;
            document.body.appendChild(guide);
            
            // Highlight the analyzer tool
            const analyzerTool = document.getElementById('tool-analyzer');
            analyzerTool.style.animation = 'pulse 2s infinite';
            analyzerTool.style.border = '2px solid #ff0000';
        }

        // Perform Vulnerability Analysis
        function performVulnerabilityAnalysis(nodeData) {
            addTerminalOutput(`üîê Analyzing ${nodeData.label} for vulnerabilities...`, '#00ff00');
            
            // Remove analyzer tool highlight if this is the first vulnerability check
            if (!gameState.analyzedNodes) {
                gameState.analyzedNodes = [];
                const analyzerTool = document.getElementById('tool-analyzer');
                analyzerTool.style.animation = '';
                analyzerTool.style.border = '';
            }
            
            setTimeout(() => {
                if (nodeData.vulnerable) {
                    addTerminalOutput(`‚ö†Ô∏è VULNERABILITY FOUND on ${nodeData.label}!`, '#ff0000');
                    
                    const vulnerabilities = {
                        'server1': 'Outdated Apache version with known exploits',
                        'server2': 'Default database credentials detected',
                        'workstation2': 'Weak password policy - admin/admin',
                        'printer': 'Open admin interface without authentication'
                    };
                    
                    addTerminalOutput(`Details: ${vulnerabilities[nodeData.id] || 'Security misconfiguration'}`, '#ffff00');
                    
                    // Mark as secured (for demo purposes)
                    const node = document.getElementById(`node-${nodeData.id}`);
                    node.classList.add('secured');
                    node.classList.remove('vulnerable');
                    
                    updateScore(200);
                    
                    // Track analyzed vulnerable nodes
                    if (!gameState.analyzedNodes.includes(nodeData.id)) {
                        gameState.analyzedNodes.push(nodeData.id);
                    }
                    
                    // Check if all vulnerabilities found
                    const vulnerableNodes = networkNodes.filter(n => n.vulnerable);
                    if (gameState.analyzedNodes.length >= vulnerableNodes.length) {
                        completeObjective('obj3');
                        checkMissionComplete();
                    } else {
                        // Show hint about remaining vulnerable devices
                        const remaining = vulnerableNodes.length - gameState.analyzedNodes.length;
                        addTerminalOutput(`üí° ${remaining} more vulnerable device(s) to find!`, '#ffff00');
                    }
                } else {
                    addTerminalOutput(`‚úì ${nodeData.label} appears secure`, '#00ff00');
                    updateScore(50);
                }
            }, 2000);
        }

        // Password Minigame
        function startPasswordMinigame(nodeData) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="modal-close" onclick="this.parentElement.parentElement.remove()">√ó</span>
                    <h2 class="modal-header">Password Cracking Challenge</h2>
                    <p>Crack the password for ${nodeData.label}</p>
                    <div class="minigame-container">
                        <p>Find the correct password combination:</p>
                        <div class="password-grid" id="passwordGrid">
                            ${generatePasswordCells()}
                        </div>
                        <p id="passwordHint">Hint: Common passwords are often simple...</p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function generatePasswordCells() {
            const passwords = ['qwerty123', 'letmein', 'sunshine', 'princess', 'whatever', '12345678', 
                             'iloveyou', 'trustno1', 'monkey123', 'dragon', 'football', 
                             'baseball', 'master', 'michael', 'shadow', 'ashley'];
            
            // Shuffle array to randomize password positions
            for (let i = passwords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [passwords[i], passwords[j]] = [passwords[j], passwords[i]];
            }
            
            // Ensure 'monkey123' is somewhere in the middle rows
            const monkeyIndex = passwords.indexOf('monkey123');
            if (monkeyIndex !== -1 && (monkeyIndex < 4 || monkeyIndex > 11)) {
                // Move it to a middle position
                passwords.splice(monkeyIndex, 1);
                passwords.splice(8, 0, 'monkey123');
            }
            
            return passwords.map((pwd, index) => 
                `<div class="password-cell" onclick="checkPassword('${pwd}', this)">${pwd}</div>`
            ).join('');
        }

        function checkPassword(password, element) {
            element.classList.add('selected');
            
            if (password === 'monkey123') {
                element.classList.add('correct');
                setTimeout(() => {
                    addTerminalOutput(`‚úì Password cracked! The password was: ${password}`, '#00ff00');
                    addTerminalOutput('‚ö†Ô∏è This demonstrates why strong passwords are important!', '#ffff00');
                    updateScore(300);
                    element.parentElement.parentElement.parentElement.parentElement.remove();
                    
                    // Complete objective for Mission 2
                    if (gameState.currentMission === 2) {
                        completeObjective('obj3');
                        checkMissionComplete();
                    }
                }, 500);
            } else {
                setTimeout(() => {
                    element.classList.remove('selected');
                    addTerminalOutput('‚úó Wrong password, try another one!', '#ff0000');
                }, 500);
            }
        }

        // Terminal Functions
        function initTerminal() {
            const terminalInput = document.getElementById('terminalInput');
            terminalInput.focus();
            
            // Auto-complete commands
            const commands = ['help', 'scan', 'probe', 'analyze', 'clear', 'hint', 'score', 'mission'];
            
            terminalInput.addEventListener('input', (e) => {
                // Simple auto-complete (could be enhanced)
                const value = e.target.value.toLowerCase();
                const matches = commands.filter(cmd => cmd.startsWith(value));
                if (matches.length === 1 && value.length > 1) {
                    // Could show suggestion
                }
            });
        }

        function handleTerminalInput(event) {
            if (event.key === 'Enter') {
                const input = event.target;
                const command = input.value.trim().toLowerCase();
                
                if (command) {
                    addTerminalOutput(`> ${command}`, '#00ff00');
                    processCommand(command);
                    gameState.terminalHistory.push(command);
                    input.value = '';
                }
            }
        }

        function processCommand(command) {
            const commands = {
                'help': () => {
                    addTerminalOutput('Available commands:', '#00ffff');
                    addTerminalOutput('  help     - Show this help message', '#00ff00');
                    addTerminalOutput('  scan     - Start network scan', '#00ff00');
                    addTerminalOutput('  probe    - Probe device ports', '#00ff00');
                    addTerminalOutput('  analyze  - Analyze vulnerabilities', '#00ff00');
                    addTerminalOutput('  clear    - Clear terminal', '#00ff00');
                    addTerminalOutput('  hint     - Get a hint', '#00ff00');
                    addTerminalOutput('  score    - Show current score', '#00ff00');
                    addTerminalOutput('  mission  - Show mission info', '#00ff00');
                },
                'scan': () => {
                    selectTool('scanner');
                    addTerminalOutput('üí° Click on the router to start scanning!', '#ffff00');
                },
                'probe': () => {
                    selectTool('probe');
                },
                'analyze': () => {
                    selectTool('analyzer');
                },
                'clear': () => {
                    document.getElementById('terminalOutput').innerHTML = '';
                },
                'hint': () => {
                    provideHint();
                },
                'score': () => {
                    addTerminalOutput(`Current score: ${gameState.score}`, '#00ffff');
                },
                'mission': () => {
                    const mission = missions[gameState.currentMission - 1];
                    addTerminalOutput(`Mission ${mission.id}: ${mission.name}`, '#00ffff');
                    addTerminalOutput(mission.brief, '#00ff00');
                }
            };
            
            if (commands[command]) {
                commands[command]();
            } else {
                addTerminalOutput(`Command not found: ${command}`, '#ff0000');
                addTerminalOutput('Type "help" for available commands', '#ffff00');
            }
        }

        function addTerminalOutput(text, color = '#00ff00') {
            const output = document.getElementById('terminalOutput');
            const line = document.createElement('div');
            line.style.color = color;
            line.textContent = text;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        // Objectives and Progress
        function completeObjective(objectiveId) {
            if (!gameState.completedObjectives.includes(objectiveId)) {
                gameState.completedObjectives.push(objectiveId);
                document.getElementById(objectiveId).classList.add('completed');
                
                const objective = missions[gameState.currentMission - 1].objectives.find(o => o.id === objectiveId);
                if (objective) {
                    updateScore(objective.points);
                    addTerminalOutput(`‚úì Objective completed: ${objective.text}`, '#00ff00');
                }
            }
        }

        function checkMissionComplete() {
            const currentMissionObj = missions[gameState.currentMission - 1];
            const allObjectivesComplete = currentMissionObj.objectives.every(obj => 
                gameState.completedObjectives.includes(obj.id)
            );
            
            if (allObjectivesComplete) {
                // Remove any existing guides
                const guide = document.getElementById('stepGuide');
                if (guide) guide.remove();
                
                // Show completion message
                const completionGuide = document.createElement('div');
                completionGuide.id = 'missionCompleteGuide';
                completionGuide.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 255, 0, 0.95);
                    color: #000;
                    padding: 40px;
                    border-radius: 20px;
                    font-size: 1.5em;
                    font-weight: bold;
                    z-index: 2000;
                    text-align: center;
                    box-shadow: 0 0 50px #00ff00;
                    max-width: 600px;
                `;
                
                if (gameState.currentMission === 1) {
                    completionGuide.innerHTML = `
                        <div style="font-size: 2em; margin-bottom: 20px;">üéâ MISSION 1 COMPLETE! üéâ</div>
                        <div>Great job discovering the network!</div>
                        <div style="font-size: 0.9em; margin: 20px 0;">You found 4 vulnerable devices that need to be secured:</div>
                        <ul style="text-align: left; margin: 20px 0; font-size: 0.8em;">
                            <li>üíª Admin PC - Weak password</li>
                            <li>üóÑÔ∏è Database - Default credentials</li>
                            <li>üñ•Ô∏è Web Server - Outdated software</li>
                            <li>üñ®Ô∏è Printer - No authentication</li>
                        </ul>
                        <div style="font-size: 0.9em; color: #006600;">Now you'll learn to attack and secure each one!</div>
                        <button onclick="nextMission()" style="margin-top: 20px; padding: 15px 30px; background: #000; color: #00ff00; border: 2px solid #00ff00; border-radius: 10px; cursor: pointer; font-size: 1em;">Start Mission 2: Attack Admin PC ‚Üí</button>
                    `;
                } else {
                    const nextMission = gameState.currentMission < missions.length ? missions[gameState.currentMission] : null;
                    completionGuide.innerHTML = `
                        <div style="font-size: 2em; margin-bottom: 20px;">üéâ MISSION ${gameState.currentMission} COMPLETE! üéâ</div>
                        <div>Excellent work! You've successfully:</div>
                        <div style="font-size: 0.9em; margin: 20px 0;">${currentMissionObj.objectives[2].text}</div>
                        ${nextMission ? `
                            <div style="font-size: 0.9em; color: #006600;">Ready for the next challenge?</div>
                            <button onclick="nextMission()" style="margin-top: 20px; padding: 15px 30px; background: #000; color: #00ff00; border: 2px solid #00ff00; border-radius: 10px; cursor: pointer; font-size: 1em;">Start Mission ${gameState.currentMission + 1}: ${nextMission.name} ‚Üí</button>
                        ` : ''}
                    `;
                }
                
                document.body.appendChild(completionGuide);
                showAchievement('Mission Complete!', `You've completed ${currentMissionObj.name}`);
                
                // If this was the last mission, show game complete after a delay
                if (gameState.currentMission === missions.length) {
                    setTimeout(() => {
                        completionGuide.remove();
                        showGameCompleteScreen();
                    }, 5000);
                }
            }
        }
        
        function nextMission() {
            // Remove completion guide
            const guide = document.getElementById('missionCompleteGuide');
            if (guide) guide.remove();
            
            // Check if there are more missions
            if (gameState.currentMission < missions.length) {
                gameState.currentMission++;
                loadMission(gameState.currentMission);
            } else {
                // All missions complete - show final screen
                showGameCompleteScreen();
            }
        }
        
        function showGameCompleteScreen() {
            // Create full-screen completion overlay
            const completeScreen = document.createElement('div');
            completeScreen.id = 'gameCompleteScreen';
            completeScreen.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.95);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 3000;
            `;
            
            completeScreen.innerHTML = `
                <div style="text-align: center; max-width: 800px; padding: 40px;">
                    <h1 style="font-size: 4em; color: #00ff00; text-shadow: 0 0 30px #00ff00; margin-bottom: 30px;">
                        üèÜ CONGRATULATIONS! üèÜ
                    </h1>
                    <h2 style="font-size: 2em; color: #00ffff; margin-bottom: 30px;">
                        You've Completed PenTest Academy!
                    </h2>
                    
                    <div style="background: rgba(0, 255, 0, 0.1); border: 2px solid #00ff00; border-radius: 20px; padding: 30px; margin: 30px 0;">
                        <h3 style="color: #ffff00; font-size: 1.5em; margin-bottom: 20px;">Your Achievements:</h3>
                        <div style="font-size: 1.2em; line-height: 2;">
                            <div>‚úÖ Learned Network Scanning</div>
                            <div>‚úÖ Discovered Hidden Devices</div>
                            <div>‚úÖ Identified Vulnerabilities</div>
                            <div>‚úÖ Understood Security Concepts</div>
                            <div>‚úÖ Total Score: <span style="color: #00ff00; font-size: 1.5em;">${gameState.score}</span></div>
                        </div>
                    </div>
                    
                    <div style="color: #ffff00; font-size: 1.3em; margin: 30px 0; line-height: 1.6;">
                        üéì You're now ready to learn more about cybersecurity!<br>
                        Remember: Always use these skills ethically and legally.
                    </div>
                    
                    <div style="margin-top: 40px;">
                        <button onclick="showCertificate()" style="padding: 20px 40px; margin: 10px; background: #00ff00; color: #000; border: none; border-radius: 10px; cursor: pointer; font-size: 1.2em; font-weight: bold;">
                            üìú Get Your Certificate!
                        </button>
                        <button onclick="resetGame()" style="padding: 20px 40px; margin: 10px; background: #00ffff; color: #000; border: none; border-radius: 10px; cursor: pointer; font-size: 1.2em; font-weight: bold;">
                            üîÑ Play Again
                        </button>
                    </div>
                    
                    <div style="margin-top: 40px; font-size: 2em;">
                        <span style="animation: pulse 1s infinite;">üåü</span>
                        <span style="animation: pulse 1s infinite 0.2s;">üåü</span>
                        <span style="animation: pulse 1s infinite 0.4s;">üåü</span>
                        <span style="animation: pulse 1s infinite 0.6s;">üåü</span>
                        <span style="animation: pulse 1s infinite 0.8s;">üåü</span>
                    </div>
                </div>
            `;
            
            document.body.appendChild(completeScreen);
            showAchievement('Master Hacker!', 'You\'ve completed all missions!');
        }
        
        function showCertificate() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.style.zIndex = '3100';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <span class="modal-close" onclick="this.parentElement.parentElement.remove()">√ó</span>
                    <h2 class="modal-header">Create Your Certificate</h2>
                    <div style="margin: 20px 0;">
                        <label style="display: block; margin-bottom: 10px;">Enter your name:</label>
                        <input type="text" id="studentName" style="width: 100%; padding: 10px; background: rgba(0,255,0,0.1); border: 1px solid #00ff00; color: #00ff00; font-family: inherit; font-size: 1.2em;" placeholder="Your Name">
                    </div>
                    <button class="btn btn-primary" onclick="generateCertificate()">Generate Certificate</button>
                </div>
            `;
            document.body.appendChild(modal);
            document.getElementById('studentName').focus();
        }
        
        function generateCertificate() {
            const name = document.getElementById('studentName').value || 'Cyber Security Student';
            const date = new Date().toLocaleDateString();
            
            // Close name input modal
            document.querySelector('.modal.active').remove();
            
            const certificate = document.createElement('div');
            certificate.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: #fff;
                color: #000;
                padding: 50px;
                border-radius: 20px;
                box-shadow: 0 0 50px rgba(0, 255, 0, 0.5);
                z-index: 3100;
                text-align: center;
                max-width: 600px;
            `;
            
            certificate.innerHTML = `
                <div style="border: 5px solid #00ff00; padding: 40px; border-radius: 15px;">
                    <h1 style="color: #00ff00; font-size: 2.5em; margin-bottom: 20px;">Certificate of Completion</h1>
                    <p style="font-size: 1.2em; margin: 20px 0;">This certifies that</p>
                    <h2 style="color: #0066cc; font-size: 2em; margin: 20px 0;">${name}</h2>
                    <p style="font-size: 1.2em; margin: 20px 0;">has successfully completed</p>
                    <h3 style="color: #00ff00; font-size: 1.8em; margin: 20px 0;">PenTest Academy</h3>
                    <p style="margin: 20px 0;">Demonstrating knowledge in ethical hacking and cybersecurity</p>
                    <p style="margin-top: 30px;">Score: ${gameState.score} points</p>
                    <p style="margin-top: 10px;">Date: ${date}</p>
                    <div style="margin-top: 40px; font-size: 2em;">üèÜ</div>
                </div>
                <button onclick="this.parentElement.remove()" style="margin-top: 20px; padding: 10px 30px; background: #00ff00; color: #000; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">Close</button>
            `;
            
            document.body.appendChild(certificate);
        }
        
        function resetGame() {
            // Reset game state
            gameState = {
                score: 0,
                level: 1,
                currentMission: 1,
                selectedTool: null,
                discoveredNodes: [],
                completedObjectives: [],
                achievements: [],
                terminalHistory: [],
                tutorialMode: true,
                analyzedNodes: [],
                probedNodes: []
            };
            
            // Reload the page to start fresh
            location.reload();
        }

        function loadMission(missionId) {
            const mission = missions[missionId - 1];
            
            // Update UI
            document.getElementById('missionName').textContent = mission.name;
            document.getElementById('missionBrief').textContent = mission.brief;
            
            // Update objectives
            const objectivesList = document.getElementById('objectives');
            objectivesList.innerHTML = '';
            mission.objectives.forEach(obj => {
                const li = document.createElement('li');
                li.id = obj.id;
                li.textContent = obj.text;
                objectivesList.appendChild(li);
            });
            
            // Reset objectives for new mission
            gameState.completedObjectives = [];
            
            // Clear any device highlights
            document.querySelectorAll('.network-node').forEach(node => {
                node.style.animation = '';
                node.style.boxShadow = '';
            });
            
            // Handle mission-specific setup
            if (missionId === 2) {
                // Unlock password cracker
                document.getElementById('tool-cracker').style.opacity = '1';
                addTerminalOutput('üîì New tool unlocked: Password Tester!', '#ffff00');
                showMissionStartGuide(mission);
            } else if (missionId === 3) {
                // Unlock SQL injector
                document.getElementById('tool-sql').style.opacity = '1';
                addTerminalOutput('üíâ New tool unlocked: SQL Injector!', '#ffff00');
                showMissionStartGuide(mission);
            } else if (missionId === 4) {
                // Unlock web exploit
                document.getElementById('tool-exploit').style.opacity = '1';
                addTerminalOutput('üï∑Ô∏è New tool unlocked: Web Exploit!', '#ffff00');
                showMissionStartGuide(mission);
            } else if (missionId === 5) {
                // Unlock device hijacker
                document.getElementById('tool-hijacker').style.opacity = '1';
                addTerminalOutput('üéØ New tool unlocked: Device Hijacker!', '#ffff00');
                showMissionStartGuide(mission);
            }
        }
        
        function showMissionStartGuide(mission) {
            const targetNode = networkNodes.find(n => n.id === mission.targetDevice);
            const toolMap = {
                2: { id: 'cracker', name: 'Password Tester', icon: 'üîì' },
                3: { id: 'sql', name: 'SQL Injector', icon: 'üíâ' },
                4: { id: 'exploit', name: 'Web Exploit', icon: 'üï∑Ô∏è' },
                5: { id: 'hijacker', name: 'Device Hijacker', icon: 'üéØ' }
            };
            
            const tool = toolMap[mission.id];
            
            setTimeout(() => {
                const guide = document.createElement('div');
                guide.id = 'missionStartGuide';
                guide.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(255, 0, 255, 0.95);
                    color: #fff;
                    padding: 40px;
                    border-radius: 20px;
                    font-size: 1.3em;
                    font-weight: bold;
                    z-index: 2000;
                    max-width: 700px;
                    text-align: center;
                    box-shadow: 0 0 50px #ff00ff;
                `;
                guide.innerHTML = `
                    <div style="font-size: 1.5em; margin-bottom: 20px;">üéØ MISSION ${mission.id}: ${mission.name}</div>
                    <div style="font-size: 0.9em; margin-bottom: 20px; line-height: 1.5;">${mission.brief}</div>
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <div style="font-size: 1.1em; margin-bottom: 15px;">üìã Your Instructions:</div>
                        <ol style="text-align: left; font-size: 0.9em; line-height: 2;">
                            <li>Click the "${tool.icon} ${tool.name}" tool in the yellow box</li>
                            <li>Click on the "${targetNode.icon} ${targetNode.label}" in the network map</li>
                            <li>Complete the security challenge that appears</li>
                        </ol>
                    </div>
                    <button onclick="startMissionWithHighlights(${mission.id})" style="margin-top: 20px; padding: 15px 30px; background: #fff; color: #ff00ff; border: none; border-radius: 10px; cursor: pointer; font-size: 1em;">I'm Ready! Start Mission!</button>
                `;
                document.body.appendChild(guide);
            }, 1000);
        }
        
        function startMissionWithHighlights(missionId) {
            // Remove the guide
            const guide = document.getElementById('missionStartGuide');
            if (guide) guide.remove();
            
            const mission = missions[missionId - 1];
            const toolMap = {
                2: 'cracker',
                3: 'sql',
                4: 'exploit',
                5: 'hijacker'
            };
            
            // Highlight the tool
            const toolId = toolMap[missionId];
            const toolElement = document.getElementById(`tool-${toolId}`);
            if (toolElement) {
                toolElement.style.animation = 'pulse 2s infinite';
                toolElement.style.border = '2px solid #ff00ff';
                toolElement.style.boxShadow = '0 0 20px #ff00ff';
            }
            
            // Mark first objective complete
            completeObjective('obj1');
            
            // Show helper text
            addTerminalOutput(`üí° Step 1: Click the ${toolElement.querySelector('strong').textContent} tool!`, '#ff00ff');
        }

        // Hints System
        function provideHint() {
            const hints = {
                1: [
                    'Start by selecting the Network Scanner tool',
                    'Click on the router to begin scanning',
                    'After scanning, use the Vulnerability Analyzer on discovered devices'
                ],
                2: [
                    'Use the Port Probe to discover services',
                    'Try the Password Tester on vulnerable systems',
                    'Look for devices with weak authentication'
                ]
            };
            
            const missionHints = hints[gameState.currentMission] || ['No hints available'];
            const hint = missionHints[Math.floor(Math.random() * missionHints.length)];
            addTerminalOutput(`üí° Hint: ${hint}`, '#ffff00');
        }

        // Score and Achievements
        function updateScore(points) {
            gameState.score += points;
            document.getElementById('score').textContent = gameState.score;
            
            // Check for score-based achievements
            if (gameState.score >= 1000 && !gameState.achievements.includes('scorer')) {
                gameState.achievements.push('scorer');
                showAchievement('High Scorer!', 'Reached 1000 points!');
            }
        }

        function showAchievement(title, text) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementText').textContent = text;
            
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 5000);
        }

        // Modals
        function showGlossary() {
            const content = document.getElementById('glossaryContent');
            content.innerHTML = '';
            
            Object.entries(glossaryTerms).forEach(([term, definition]) => {
                const entry = document.createElement('div');
                entry.style.marginBottom = '15px';
                entry.innerHTML = `
                    <strong style="color: #00ffff;">${term}:</strong>
                    <p style="margin-top: 5px;">${definition}</p>
                `;
                content.appendChild(entry);
            });
            
            document.getElementById('glossaryModal').classList.add('active');
        }

        function showProgress() {
            const content = document.getElementById('progressContent');
            
            const completionRate = Math.round((gameState.completedObjectives.length / 6) * 100);
            
            content.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #00ffff;">Overall Progress</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${completionRate}%"></div>
                    </div>
                    <p>${completionRate}% Complete</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #00ffff;">Statistics</h3>
                    <p>Score: ${gameState.score}</p>
                    <p>Current Mission: ${gameState.currentMission}</p>
                    <p>Devices Discovered: ${gameState.discoveredNodes.length}</p>
                    <p>Achievements: ${gameState.achievements.length}</p>
                </div>
                
                <div>
                    <h3 style="color: #00ffff;">Achievements</h3>
                    ${gameState.achievements.map(achievement => 
                        `<p style="color: #ffd700;">üèÜ ${achievement}</p>`
                    ).join('') || '<p>No achievements yet</p>'}
                </div>
            `;
            
            document.getElementById('progressModal').classList.add('active');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
            modal.style.display = 'none';
        }

        // Save/Load Progress (In-memory only for sandboxed environment)
        function saveProgress() {
            // Progress is maintained in gameState object during session
            console.log('Progress saved in memory');
        }

        function loadProgress() {
            // Initialize with default state
            console.log('Starting fresh session');
        }

        // Matrix Background Effect
        function startMatrixEffect() {
            const canvas = document.getElementById('matrix-bg');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const matrix = "ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*()*&^%+-/~{[|`]}";
            const matrixArray = matrix.split("");
            
            const fontSize = 10;
            const columns = canvas.width / fontSize;
            
            const drops = [];
            for (let x = 0; x < columns; x++) {
                drops[x] = 1;
            }
            
            function draw() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.04)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#0F0';
                ctx.font = fontSize + 'px monospace';
                
                for (let i = 0; i < drops.length; i++) {
                    const text = matrixArray[Math.floor(Math.random() * matrixArray.length)];
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    
                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }
            }
            
            setInterval(draw, 35);
        }

        // Window resize handler
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('matrix-bg');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // Auto-save progress
        setInterval(saveProgress, 30000); // Save every 30 seconds

        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>