<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Properties: Bit Depth, Resolution & Metadata</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            text-align: center;
            color: #5a67d8;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
        }

        h2 {
            color: #4a5568;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            width: 30px;
            height: 30px;
            background: #5a67d8;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .demo-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .image-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .image-container {
            position: relative;
            display: inline-block;
            max-width: 100%;
            overflow: hidden;
        }

        canvas {
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            max-width: 100%;
            height: auto;
            transition: all 0.3s ease;
            display: block;
        }

        .image-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .image-option {
            padding: 8px 16px;
            background: #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .image-option:hover {
            background: #cbd5e0;
        }

        .image-option.active {
            background: #5a67d8;
            color: white;
        }

        input[type="range"] {
            width: 100%;
            margin: 10px 0;
            height: 8px;
            border-radius: 5px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #5a67d8;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: #4c51bf;
        }

        .info-box {
            background: #edf2f7;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #5a67d8;
        }

        .calculation {
            font-family: 'Courier New', monospace;
            background: #2d3748;
            color: #48bb78;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            overflow-x: auto;
        }

        .preset-buttons {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: 6px 12px;
            background: #e2e8f0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .preset-btn:hover {
            background: #cbd5e0;
            transform: translateY(-1px);
        }

        .metadata-editor {
            display: grid;
            gap: 15px;
        }

        .metadata-item {
            display: grid;
            grid-template-columns: 150px 1fr;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .metadata-item:hover {
            background: #f7fafc;
            transform: translateX(5px);
        }

        .metadata-label {
            font-weight: bold;
            color: #4a5568;
        }

        .metadata-value {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metadata-value input {
            flex: 1;
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .metadata-value input:focus {
            outline: none;
            border-color: #5a67d8;
        }

        .edit-icon {
            cursor: pointer;
            color: #5a67d8;
            font-size: 18px;
            transition: transform 0.3s ease;
        }

        .edit-icon:hover {
            transform: scale(1.2);
        }

        .metadata-preview {
            background: #1a202c;
            color: #48bb78;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            overflow-x: auto;
            margin-top: 15px;
        }

        .comparison-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .comparison-image {
            text-align: center;
        }

        .comparison-image h4 {
            margin-bottom: 10px;
            color: #4a5568;
        }

        .quiz-section {
            background: #f0f4f8;
            padding: 30px;
            border-radius: 10px;
            margin-top: 40px;
        }

        .question {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .question:hover {
            transform: translateY(-2px);
        }

        .options {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }

        .option {
            padding: 12px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: #e2e8f0;
            border-color: #5a67d8;
        }

        .option.selected {
            background: #5a67d8;
            color: white;
            border-color: #5a67d8;
        }

        .option.correct {
            background: #48bb78;
            color: white;
            border-color: #48bb78;
            animation: pulse 0.5s ease;
        }

        .option.incorrect {
            background: #f56565;
            color: white;
            border-color: #f56565;
            animation: shake 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: bold;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .feedback.correct {
            background: #c6f6d5;
            color: #276749;
            border: 2px solid #48bb78;
        }

        .feedback.incorrect {
            background: #fed7d7;
            color: #742a2a;
            border: 2px solid #f56565;
        }

        button {
            background: #5a67d8;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        button:hover {
            background: #4c51bf;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(90, 103, 216, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .score-display {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #5a67d8;
            margin: 20px 0;
        }

        .loading {
            text-align: center;
            color: #5a67d8;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .demo-area {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8em;
            }

            .comparison-view {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ Image Properties: Bit Depth, Resolution & Metadata</h1>

        <!-- Bit Depth Section -->
        <div class="section">
            <h2><span class="icon">1</span> Colour Depth / Bit Depth</h2>
            
            <div class="image-selector">
                <div class="image-option active" onclick="selectImage('landscape')">üèîÔ∏è Landscape</div>
                <div class="image-option" onclick="selectImage('portrait')">üë§ Portrait</div>
                <div class="image-option" onclick="selectImage('colorful')">üé® Colorful</div>
            </div>

            <div class="demo-area">
                <div class="control-panel">
                    <h3>Control Panel</h3>
                    <label for="bitDepth">Bit Depth: <span id="bitDepthValue">24</span> bits</label>
                    <input type="range" id="bitDepth" min="1" max="24" value="24">
                    
                    <div class="preset-buttons">
                        <button class="preset-btn" onclick="setBitDepth(1)">1-bit B&W</button>
                        <button class="preset-btn" onclick="setBitDepth(4)">4-bit (16 colors)</button>
                        <button class="preset-btn" onclick="setBitDepth(8)">8-bit (256 colors)</button>
                        <button class="preset-btn" onclick="setBitDepth(16)">16-bit (65K colors)</button>
                        <button class="preset-btn" onclick="setBitDepth(24)">24-bit True Color</button>
                    </div>
                    
                    <div class="info-box">
                        <strong>Current Settings:</strong><br>
                        Bits per pixel: <span id="bitsPerPixel">24</span><br>
                        Possible colours: <span id="possibleColors">16,777,216</span><br>
                        <div class="calculation" id="colorCalculation">
                            2^24 = 16,777,216 colours
                        </div>
                    </div>

                    <div class="info-box">
                        <strong>Key Concept:</strong><br>
                        ‚Ä¢ 1-bit = Black & White only<br>
                        ‚Ä¢ 8-bit = 256 colors (old games/GIFs)<br>
                        ‚Ä¢ 24-bit = True color (8 bits each for R,G,B)<br>
                        ‚Ä¢ Lower bit depth = Smaller file size
                    </div>
                </div>
                <div class="image-display">
                    <h3>Visual Demo</h3>
                    <div class="image-container">
                        <canvas id="bitDepthCanvas" width="400" height="300"></canvas>
                    </div>
                    <div class="comparison-view">
                        <div class="comparison-image">
                            <h4>Original (24-bit)</h4>
                            <canvas id="originalCanvas" width="190" height="142"></canvas>
                        </div>
                        <div class="comparison-image">
                            <h4>Current (<span id="currentBitLabel">24</span>-bit)</h4>
                            <canvas id="currentCanvas" width="190" height="142"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resolution Section -->
        <div class="section">
            <h2><span class="icon">2</span> Resolution</h2>
            <div class="demo-area">
                <div class="control-panel">
                    <h3>Control Panel</h3>
                    <label for="resolution">Resolution: <span id="resolutionValue">400√ó300</span></label>
                    <input type="range" id="resolution" min="1" max="10" value="10">
                    
                    <div class="preset-buttons">
                        <button class="preset-btn" onclick="setResolution(1)">40√ó30 (Tiny)</button>
                        <button class="preset-btn" onclick="setResolution(3)">120√ó90 (Low)</button>
                        <button class="preset-btn" onclick="setResolution(5)">200√ó150 (Medium)</button>
                        <button class="preset-btn" onclick="setResolution(10)">400√ó300 (Full)</button>
                    </div>

                    <h4>Common Resolutions Reference:</h4>
                    <div class="info-box">
                        ‚Ä¢ 640√ó480 - VGA (old monitors)<br>
                        ‚Ä¢ 1280√ó720 - HD (720p)<br>
                        ‚Ä¢ 1920√ó1080 - Full HD (1080p)<br>
                        ‚Ä¢ 3840√ó2160 - 4K Ultra HD<br>
                        ‚Ä¢ 7680√ó4320 - 8K Ultra HD
                    </div>
                    
                    <div class="info-box">
                        <strong>Current Resolution:</strong><br>
                        Width: <span id="resWidth">400</span> pixels<br>
                        Height: <span id="resHeight">300</span> pixels<br>
                        Total pixels: <span id="totalPixels">120,000</span><br>
                        <div class="calculation" id="resCalculation">
                            400 √ó 300 = 120,000 pixels
                        </div>
                    </div>

                    <div class="info-box">
                        <strong>File Size Impact:</strong><br>
                        Uncompressed size: <span id="fileSize">351.6 KB</span><br>
                        <div class="calculation" id="sizeCalculation">
                            (400 √ó 300 √ó 24) √∑ 8 √∑ 1024 = 351.6 KB
                        </div>
                    </div>
                </div>
                <div class="image-display">
                    <h3>Visual Demo - Notice the Pixelation!</h3>
                    <div class="image-container">
                        <canvas id="resolutionCanvas" width="400" height="300"></canvas>
                    </div>
                    <p style="margin-top: 10px; color: #718096; font-size: 14px;">
                        üí° Tip: Lower resolution = fewer pixels = less detail but smaller file size
                    </p>
                </div>
            </div>
        </div>

        <!-- Metadata Section -->
        <div class="section">
            <h2><span class="icon">3</span> Metadata - The Hidden Information</h2>
            <div class="info-box">
                <strong>What is Metadata?</strong><br>
                Information stored about the image/data file that helps software understand and manage it.
                Metadata can reveal secrets, prove authenticity, or be manipulated!
            </div>

            <!-- Game Mode Selector -->
            <div class="game-mode-selector">
                <button class="mode-btn active" onclick="setMetadataMode('detective')">üîç Detective Mode</button>
                <button class="mode-btn" onclick="setMetadataMode('manipulation')">üõ†Ô∏è Manipulation Mode</button>
                <button class="mode-btn" onclick="setMetadataMode('learn')">üìö Learn Mode</button>
            </div>

            <!-- Detective Mode -->
            <div id="detectiveMode" class="metadata-mode">
                <h3>üîç Metadata Detective: Solve the Case!</h3>
                <div class="case-selector">
                    <label>Select a case:</label>
                    <select id="caseSelect" onchange="loadCase()">
                        <option value="0">Case 1: The Missing Tourist</option>
                        <option value="1">Case 2: The Art Forgery</option>
                        <option value="2">Case 3: The Alibi</option>
                        <option value="3">Case 4: The Leaked Photo</option>
                    </select>
                </div>

                <div id="caseDescription" class="case-description"></div>

                <div class="evidence-photos">
                    <h4>Evidence Photos:</h4>
                    <div id="evidenceContainer" class="evidence-container"></div>
                </div>

                <div class="detective-questions" id="detectiveQuestions"></div>

                <button class="check-answer-btn" onclick="checkDetectiveAnswer()">Submit Answer</button>
                <div id="detectiveFeedback"></div>
            </div>

            <!-- Manipulation Mode -->
            <div id="manipulationMode" class="metadata-mode" style="display: none;">
                <h3>üõ†Ô∏è Metadata Manipulation Challenge</h3>
                <div class="challenge-selector">
                    <label>Select a challenge:</label>
                    <select id="challengeSelect" onchange="loadChallenge()">
                        <option value="0">Challenge 1: Fake Location - Paris</option>
                        <option value="1">Challenge 2: Time Travel - Backdate Photo</option>
                        <option value="2">Challenge 3: Privacy Mode - Remove All Info</option>
                        <option value="3">Challenge 4: Professional Touch</option>
                    </select>
                </div>

                <div id="challengeDescription" class="challenge-description"></div>

                <div class="manipulation-editor">
                    <h4>Edit Metadata:</h4>
                    <div class="metadata-item">
                        <div class="metadata-label">üìÅ File Name:</div>
                        <div class="metadata-value">
                            <input type="text" id="manipFileName" value="IMG_2025.jpg">
                        </div>
                    </div>
                    <div class="metadata-item">
                        <div class="metadata-label">üì∑ Camera:</div>
                        <div class="metadata-value">
                            <input type="text" id="manipCamera" value="Phone Camera">
                        </div>
                    </div>
                    <div class="metadata-item">
                        <div class="metadata-label">üìÖ Date/Time:</div>
                        <div class="metadata-value">
                            <input type="datetime-local" id="manipDateTime" value="2025-01-23T14:30">
                        </div>
                    </div>
                    <div class="metadata-item">
                        <div class="metadata-label">üìç GPS Location:</div>
                        <div class="metadata-value">
                            <input type="text" id="manipGPS" value="51.5074¬∞ N, 0.1278¬∞ W" placeholder="Latitude, Longitude">
                            <button class="location-helper-btn" onclick="showLocationHelper()">üìç</button>
                        </div>
                    </div>
                    <div class="metadata-item">
                        <div class="metadata-label">üìù Description:</div>
                        <div class="metadata-value">
                            <input type="text" id="manipDescription" value="A photo">
                        </div>
                    </div>
                    <div class="metadata-item">
                        <div class="metadata-label">üë§ Copyright:</div>
                        <div class="metadata-value">
                            <input type="text" id="manipCopyright" value="">
                        </div>
                    </div>
                </div>

                <button class="check-answer-btn" onclick="checkManipulationChallenge()">Check Solution</button>
                <div id="manipulationFeedback"></div>

                <div class="warning-box">
                    <strong>‚ö†Ô∏è Real World Warning:</strong><br>
                    Manipulating metadata can have serious consequences:
                    ‚Ä¢ Fake news and misinformation
                    ‚Ä¢ Legal evidence tampering
                    ‚Ä¢ Copyright fraud
                    ‚Ä¢ Privacy violations
                </div>
            </div>

            <!-- Learn Mode -->
            <div id="learnMode" class="metadata-mode" style="display: none;">
                <h3>üìö Interactive Metadata Explorer</h3>
                <div class="metadata-editor">
                    <div class="metadata-item">
                        <div class="metadata-label">üìÅ File Name:</div>
                        <div class="metadata-value">
                            <input type="text" id="metaFileName" value="my_photo.png">
                        </div>
                    </div>
                    <div class="metadata-item">
                        <div class="metadata-label">üìê Dimensions:</div>
                        <div class="metadata-value">
                            <input type="text" id="metaDimensions" value="400 √ó 300 pixels" readonly style="background: #f7fafc;">
                        </div>
                    </div>
                    <div class="metadata-item">
                        <div class="metadata-label">üé® Bit Depth:</div>
                        <div class="metadata-value">
                            <input type="text" id="metaBitDepth" value="24 bits (True Color)" readonly style="background: #f7fafc;">
                        </div>
                    </div>
                    <div class="metadata-item">
                        <div class="metadata-label">üì∑ Camera:</div>
                        <div class="metadata-value">
                            <input type="text" id="metaCamera" value="Canon EOS R5">
                        </div>
                    </div>
                    <div class="metadata-item">
                        <div class="metadata-label">üìÖ Date Taken:</div>
                        <div class="metadata-value">
                            <input type="date" id="metaDate" value="2025-01-23">
                        </div>
                    </div>
                    <div class="metadata-item">
                        <div class="metadata-label">üìç GPS Location:</div>
                        <div class="metadata-value">
                            <input type="text" id="metaGPS" value="52.4862¬∞ N, 1.8904¬∞ W (Birmingham, UK)">
                        </div>
                    </div>
                    <div class="metadata-item">
                        <div class="metadata-label">üîß ISO Speed:</div>
                        <div class="metadata-value">
                            <input type="text" id="metaISO" value="ISO 400">
                        </div>
                    </div>
                    <div class="metadata-item">
                        <div class="metadata-label">‚ö° Flash:</div>
                        <div class="metadata-value">
                            <select id="metaFlash" style="flex: 1; padding: 8px; border: 2px solid #e2e8f0; border-radius: 6px;">
                                <option>Flash did not fire</option>
                                <option>Flash fired</option>
                                <option>Flash fired, red-eye reduction</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="metadata-preview">
                    <strong>// EXIF Metadata Preview (How it's stored in the file)</strong><br>
                    <pre id="metadataPreview">{
  "FileName": "my_photo.png",
  "ImageWidth": 400,
  "ImageHeight": 300,
  "BitsPerSample": 24,
  "ColorType": "RGB",
  "Make": "Canon",
  "Model": "EOS R5",
  "DateTime": "2025-01-23T10:30:00",
  "GPS": {
    "Latitude": "52.4862¬∞ N",
    "Longitude": "1.8904¬∞ W",
    "Location": "Birmingham, UK"
  },
  "ISOSpeedRatings": 400,
  "Flash": "Flash did not fire",
  "Software": "GCSE Computer Science Simulator"
}</pre>
                </div>
            </div>

            <div class="info-box" style="margin-top: 20px;">
                <strong>ü§î Did you know?</strong><br>
                ‚Ä¢ Photos from your phone contain GPS coordinates (privacy concern!)<br>
                ‚Ä¢ Metadata can reveal when/where a photo was taken<br>
                ‚Ä¢ Some social media sites remove metadata for privacy<br>
                ‚Ä¢ Metadata is often used as evidence in legal cases
            </div>
        </div>

        <!-- Quiz Section -->
        <div class="quiz-section">
            <h2><span class="icon">Q</span> Quiz Time!</h2>
            <div id="quizContainer"></div>
            <div class="score-display" id="scoreDisplay" style="display:none;"></div>
            <button onclick="resetQuiz()">Reset Quiz</button>
        </div>
    </div>

    <script>
        // Image data storage
        const images = {
            landscape: null,
            portrait: null,
            colorful: null,
            current: 'landscape'
        };

        // Create sample images
        function createSampleImages() {
            // Landscape image
            const landscapeCanvas = document.createElement('canvas');
            landscapeCanvas.width = 400;
            landscapeCanvas.height = 300;
            const lctx = landscapeCanvas.getContext('2d');
            
            // Sky gradient
            const skyGradient = lctx.createLinearGradient(0, 0, 0, 150);
            skyGradient.addColorStop(0, '#87CEEB');
            skyGradient.addColorStop(1, '#E0F6FF');
            lctx.fillStyle = skyGradient;
            lctx.fillRect(0, 0, 400, 150);
            
            // Sun
            lctx.fillStyle = '#FFD700';
            lctx.beginPath();
            lctx.arc(320, 50, 30, 0, Math.PI * 2);
            lctx.fill();
            
            // Mountains
            lctx.fillStyle = '#4A5568';
            lctx.beginPath();
            lctx.moveTo(0, 150);
            lctx.lineTo(150, 50);
            lctx.lineTo(300, 150);
            lctx.closePath();
            lctx.fill();
            
            lctx.fillStyle = '#2D3748';
            lctx.beginPath();
            lctx.moveTo(200, 150);
            lctx.lineTo(350, 80);
            lctx.lineTo(400, 150);
            lctx.closePath();
            lctx.fill();
            
            // Ground
            lctx.fillStyle = '#48BB78';
            lctx.fillRect(0, 150, 400, 150);
            
            // Trees
            for (let i = 0; i < 5; i++) {
                const x = 50 + i * 80;
                const y = 180;
                // Tree trunk
                lctx.fillStyle = '#8B4513';
                lctx.fillRect(x - 5, y, 10, 30);
                // Tree top
                lctx.fillStyle = '#228B22';
                lctx.beginPath();
                lctx.moveTo(x - 20, y);
                lctx.lineTo(x, y - 40);
                lctx.lineTo(x + 20, y);
                lctx.closePath();
                lctx.fill();
            }
            
            images.landscape = lctx.getImageData(0, 0, 400, 300);
            
            // Portrait image
            const portraitCanvas = document.createElement('canvas');
            portraitCanvas.width = 400;
            portraitCanvas.height = 300;
            const pctx = portraitCanvas.getContext('2d');
            
            // Background
            pctx.fillStyle = '#E2E8F0';
            pctx.fillRect(0, 0, 400, 300);
            
            // Face
            pctx.fillStyle = '#FDBCB4';
            pctx.beginPath();
            pctx.arc(200, 120, 60, 0, Math.PI * 2);
            pctx.fill();
            
            // Hair
            pctx.fillStyle = '#4A4A4A';
            pctx.beginPath();
            pctx.arc(200, 100, 65, Math.PI, 0);
            pctx.fill();
            
            // Eyes
            pctx.fillStyle = '#2C3E50';
            pctx.beginPath();
            pctx.arc(180, 110, 8, 0, Math.PI * 2);
            pctx.arc(220, 110, 8, 0, Math.PI * 2);
            pctx.fill();
            
            // Smile
            pctx.strokeStyle = '#E74C3C';
            pctx.lineWidth = 3;
            pctx.beginPath();
            pctx.arc(200, 130, 20, 0, Math.PI);
            pctx.stroke();
            
            // Body
            pctx.fillStyle = '#3498DB';
            pctx.fillRect(150, 180, 100, 120);
            
            images.portrait = pctx.getImageData(0, 0, 400, 300);
            
            // Colorful abstract image
            const colorfulCanvas = document.createElement('canvas');
            colorfulCanvas.width = 400;
            colorfulCanvas.height = 300;
            const cctx = colorfulCanvas.getContext('2d');
            
            // Create colorful pattern
            for (let i = 0; i < 10; i++) {
                for (let j = 0; j < 10; j++) {
                    const hue = (i * 36 + j * 36) % 360;
                    cctx.fillStyle = `hsl(${hue}, 70%, 50%)`;
                    cctx.fillRect(i * 40, j * 30, 40, 30);
                }
            }
            
            // Add some circles
            for (let i = 0; i < 15; i++) {
                const x = Math.random() * 400;
                const y = Math.random() * 300;
                const r = Math.random() * 30 + 10;
                const hue = Math.random() * 360;
                
                cctx.fillStyle = `hsla(${hue}, 80%, 60%, 0.7)`;
                cctx.beginPath();
                cctx.arc(x, y, r, 0, Math.PI * 2);
                cctx.fill();
            }
            
            images.colorful = cctx.getImageData(0, 0, 400, 300);
        }

        // Select image
        function selectImage(type) {
            images.current = type;
            document.querySelectorAll('.image-option').forEach(opt => opt.classList.remove('active'));
            event.target.classList.add('active');
            updateBitDepth(parseInt(document.getElementById('bitDepth').value));
            updateResolution(parseInt(document.getElementById('resolution').value));
        }

        // Set bit depth preset
        function setBitDepth(bits) {
            document.getElementById('bitDepth').value = bits;
            updateBitDepth(bits);
        }

        // Set resolution preset
        function setResolution(scale) {
            document.getElementById('resolution').value = scale;
            updateResolution(scale);
        }

        // Update bit depth display
        function updateBitDepth(bits) {
            const colors = Math.pow(2, bits);
            document.getElementById('bitDepthValue').textContent = bits;
            document.getElementById('bitsPerPixel').textContent = bits;
            document.getElementById('possibleColors').textContent = colors.toLocaleString();
            document.getElementById('colorCalculation').textContent = `2^${bits} = ${colors.toLocaleString()} colours`;
            document.getElementById('currentBitLabel').textContent = bits;
            
            // Update metadata
            let bitDepthText = `${bits} bits`;
            if (bits === 1) bitDepthText += ' (Black & White)';
            else if (bits === 8) bitDepthText += ' (256 colors)';
            else if (bits === 16) bitDepthText += ' (65K colors)';
            else if (bits === 24) bitDepthText += ' (True Color)';
            document.getElementById('metaBitDepth').value = bitDepthText;

            // Get current image
            const sourceImage = images[images.current];
            if (!sourceImage) return;

            const canvas = document.getElementById('bitDepthCanvas');
            const ctx = canvas.getContext('2d');
            const currentCanvas = document.getElementById('currentCanvas');
            const currentCtx = currentCanvas.getContext('2d');
            const originalCanvas = document.getElementById('originalCanvas');
            const originalCtx = originalCanvas.getContext('2d');

            // Show original
            originalCtx.putImageData(sourceImage, 0, 0, 0, 0, 190, 142);

            // Process image with reduced bit depth
            const imageDataCopy = new ImageData(
                new Uint8ClampedArray(sourceImage.data),
                400,
                300
            );

            if (bits === 1) {
                // Black and white
                for (let i = 0; i < imageDataCopy.data.length; i += 4) {
                    const gray = (imageDataCopy.data[i] + imageDataCopy.data[i + 1] + imageDataCopy.data[i + 2]) / 3;
                    const bw = gray > 128 ? 255 : 0;
                    imageDataCopy.data[i] = bw;
                    imageDataCopy.data[i + 1] = bw;
                    imageDataCopy.data[i + 2] = bw;
                }
            } else if (bits <= 8) {
                // Limited colors
                const levels = Math.ceil(Math.pow(colors, 1/3));
                const step = 255 / (levels - 1);
                
                for (let i = 0; i < imageDataCopy.data.length; i += 4) {
                    imageDataCopy.data[i] = Math.round(imageDataCopy.data[i] / step) * step;
                    imageDataCopy.data[i + 1] = Math.round(imageDataCopy.data[i + 1] / step) * step;
                    imageDataCopy.data[i + 2] = Math.round(imageDataCopy.data[i + 2] / step) * step;
                }
            } else if (bits < 24) {
                // Reduce color precision
                const shift = 8 - Math.floor(bits / 3);
                const mask = (0xFF << shift) & 0xFF;
                
                for (let i = 0; i < imageDataCopy.data.length; i += 4) {
                    imageDataCopy.data[i] = imageDataCopy.data[i] & mask;
                    imageDataCopy.data[i + 1] = imageDataCopy.data[i + 1] & mask;
                    imageDataCopy.data[i + 2] = imageDataCopy.data[i + 2] & mask;
                }
            }

            ctx.putImageData(imageDataCopy, 0, 0);
            currentCtx.putImageData(imageDataCopy, 0, 0, 0, 0, 190, 142);
            updateFileSize();
        }

        // Update resolution display
        function updateResolution(scale) {
            const baseWidth = 400;
            const baseHeight = 300;
            const newWidth = Math.floor(baseWidth * scale / 10);
            const newHeight = Math.floor(baseHeight * scale / 10);

            document.getElementById('resolutionValue').textContent = `${newWidth}√ó${newHeight}`;
            document.getElementById('resWidth').textContent = newWidth;
            document.getElementById('resHeight').textContent = newHeight;
            document.getElementById('totalPixels').textContent = (newWidth * newHeight).toLocaleString();
            document.getElementById('resCalculation').textContent = 
                `${newWidth} √ó ${newHeight} = ${(newWidth * newHeight).toLocaleString()} pixels`;
            document.getElementById('metaDimensions').value = `${newWidth} √ó ${newHeight} pixels`;

            const canvas = document.getElementById('resolutionCanvas');
            const ctx = canvas.getContext('2d');

            // Get processed image from bit depth canvas
            const sourceCanvas = document.getElementById('bitDepthCanvas');
            
            // Create scaled version
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = newWidth;
            tempCanvas.height = newHeight;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.imageSmoothingEnabled = false;
            tempCtx.drawImage(sourceCanvas, 0, 0, newWidth, newHeight);

            // Clear and draw pixelated version
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(0, 0, 400, 300);
            ctx.imageSmoothingEnabled = false;
            ctx.drawImage(tempCanvas, 0, 0, 400, 300);

            updateFileSize();
            updateMetadataPreview();
        }

        // Calculate and update file size
        function updateFileSize() {
            const bits = parseInt(document.getElementById('bitDepth').value);
            const scale = parseInt(document.getElementById('resolution').value);
            const width = Math.floor(400 * scale / 10);
            const height = Math.floor(300 * scale / 10);
            
            const totalBits = width * height * bits;
            const bytes = totalBits / 8;
            const kb = bytes / 1024;

            document.getElementById('fileSize').textContent = kb.toFixed(1) + ' KB';
            document.getElementById('sizeCalculation').textContent = 
                `(${width} √ó ${height} √ó ${bits}) √∑ 8 √∑ 1024 = ${kb.toFixed(1)} KB`;
        }

        // Update metadata preview
        function updateMetadataPreview() {
            const preview = {
                "FileName": document.getElementById('metaFileName').value,
                "ImageWidth": parseInt(document.getElementById('resWidth').textContent),
                "ImageHeight": parseInt(document.getElementById('resHeight').textContent),
                "BitsPerSample": parseInt(document.getElementById('bitDepth').value),
                "ColorType": "RGB",
                "Make": document.getElementById('metaCamera').value.split(' ')[0],
                "Model": document.getElementById('metaCamera').value,
                "DateTime": document.getElementById('metaDate').value + "T10:30:00",
                "GPS": {
                    "Latitude": document.getElementById('metaGPS').value.split(',')[0].trim(),
                    "Longitude": document.getElementById('metaGPS').value.split(',')[1]?.split('(')[0].trim() || "",
                    "Location": document.getElementById('metaGPS').value.match(/\((.*?)\)/)?.[1] || ""
                },
                "ISOSpeedRatings": parseInt(document.getElementById('metaISO').value.replace('ISO ', '')),
                "Flash": document.getElementById('metaFlash').value,
                "Software": "GCSE Computer Science Simulator"
            };

            document.getElementById('metadataPreview').textContent = JSON.stringify(preview, null, 2);
        }

        // Quiz questions
        const quizQuestions = [
            {
                question: "What is colour depth/bit depth?",
                options: [
                    "The size of an image file",
                    "The number of bits used to store the colour for each pixel",
                    "The number of pixels in an image",
                    "The brightness of an image"
                ],
                correct: 1,
                feedback: "Colour depth is the number of bits used to store the colour for each pixel."
            },
            {
                question: "If an image uses 4 bits per pixel, how many different colours can it display?",
                options: [
                    "4 colours",
                    "8 colours",
                    "16 colours",
                    "32 colours"
                ],
                correct: 2,
                feedback: "With 4 bits per pixel, you can display 2^4 = 16 different colours."
            },
            {
                question: "Why does reducing the number of colours in an image reduce its file size?",
                options: [
                    "It makes the image smaller in dimensions",
                    "It removes metadata",
                    "Fewer bits are needed per pixel",
                    "It compresses the image"
                ],
                correct: 2,
                feedback: "Fewer colours means fewer bits are needed to represent each pixel, reducing file size."
            },
            {
                question: "What is image resolution?",
                options: [
                    "The brightness of the image",
                    "The number of colours in the image",
                    "The number of pixels in an image",
                    "The file format of the image"
                ],
                correct: 2,
                feedback: "Resolution is the number of pixels in an image, usually expressed as width √ó height."
            },
            {
                question: "An image has a resolution of 1920√ó1080. How many total pixels does it have?",
                options: [
                    "3,000 pixels",
                    "207,360 pixels",
                    "2,073,600 pixels",
                    "20,736,000 pixels"
                ],
                correct: 2,
                feedback: "Total pixels = 1920 √ó 1080 = 2,073,600 pixels."
            },
            {
                question: "Which of these is NOT typically stored in image metadata?",
                options: [
                    "The actual pixel colour values",
                    "Date the photo was taken",
                    "Camera model",
                    "GPS location"
                ],
                correct: 0,
                feedback: "Metadata stores information ABOUT the image, not the actual pixel data itself."
            },
            {
                question: "If an image is 100√ó100 pixels with 8 bits per pixel, what is its uncompressed size in bytes?",
                options: [
                    "800 bytes",
                    "1,000 bytes",
                    "8,000 bytes",
                    "10,000 bytes"
                ],
                correct: 3,
                feedback: "Size = (100 √ó 100 √ó 8) √∑ 8 = 10,000 bytes. (Divide by 8 to convert bits to bytes)"
            },
            {
                question: "What happens to image quality when you increase the bit depth?",
                options: [
                    "Quality decreases",
                    "More colour variety becomes available",
                    "The image becomes smaller",
                    "Resolution increases"
                ],
                correct: 1,
                feedback: "Higher bit depth means more bits per pixel, allowing for more colour variety and better quality."
            },
            {
                question: "Which statement about resolution is TRUE?",
                options: [
                    "Lower resolution always means worse quality",
                    "Resolution only affects file size, not quality",
                    "Higher resolution means more detail but larger file size",
                    "Resolution and bit depth are the same thing"
                ],
                correct: 2,
                feedback: "Higher resolution means more pixels, providing more detail but requiring more storage space."
            },
            {
                question: "What is 24-bit colour also known as?",
                options: [
                    "Black and white",
                    "256 colours",
                    "True colour",
                    "High colour"
                ],
                correct: 2,
                feedback: "24-bit colour is known as 'True Colour' because it can display over 16 million colours (8 bits each for Red, Green, and Blue)."
            },
            {
                question: "Why might someone want to remove GPS metadata from their photos before sharing online?",
                options: [
                    "To reduce file size",
                    "To protect their privacy and location",
                    "To improve image quality",
                    "To change the colours"
                ],
                correct: 1,
                feedback: "GPS metadata reveals exactly where a photo was taken, which could compromise privacy and security."
            },
            {
                question: "A 4K image (3840√ó2160) with 24-bit colour depth has approximately how many megabytes uncompressed?",
                options: [
                    "2.4 MB",
                    "8.3 MB",
                    "23.7 MB",
                    "95.4 MB"
                ],
                correct: 2,
                feedback: "(3840 √ó 2160 √ó 24) √∑ 8 √∑ 1024 √∑ 1024 = 23.7 MB uncompressed."
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let quizCompleted = false;

        // Initialize quiz
        function initQuiz() {
            displayQuestion();
        }

        // Display current question
        function displayQuestion() {
            if (currentQuestion >= quizQuestions.length) {
                showFinalScore();
                return;
            }

            const question = quizQuestions[currentQuestion];
            const container = document.getElementById('quizContainer');
            
            container.innerHTML = `
                <div class="question">
                    <h3>Question ${currentQuestion + 1} of ${quizQuestions.length}</h3>
                    <p>${question.question}</p>
                    <div class="options">
                        ${question.options.map((option, index) => `
                            <div class="option" onclick="selectOption(${index})">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    <div id="feedbackArea"></div>
                </div>
            `;
        }

        // Handle option selection
        function selectOption(index) {
            if (quizCompleted) return;

            const options = document.querySelectorAll('.option');
            const question = quizQuestions[currentQuestion];
            const feedbackArea = document.getElementById('feedbackArea');

            // Disable all options
            options.forEach(option => {
                option.style.pointerEvents = 'none';
            });

            // Mark selected option
            options[index].classList.add('selected');

            // Check answer
            if (index === question.correct) {
                options[index].classList.add('correct');
                score++;
                feedbackArea.innerHTML = `
                    <div class="feedback correct">
                        ‚úì Correct! ${question.feedback}
                    </div>
                `;
            } else {
                options[index].classList.add('incorrect');
                options[question.correct].classList.add('correct');
                feedbackArea.innerHTML = `
                    <div class="feedback incorrect">
                        ‚úó Incorrect. ${question.feedback}
                    </div>
                `;
            }

            // Move to next question after delay
            setTimeout(() => {
                currentQuestion++;
                displayQuestion();
            }, 3000);
        }

        // Show final score
        function showFinalScore() {
            quizCompleted = true;
            const container = document.getElementById('quizContainer');
            const scoreDisplay = document.getElementById('scoreDisplay');
            
            container.innerHTML = `
                <div class="question">
                    <h3>Quiz Complete!</h3>
                    <p>Great job! You've completed all the questions.</p>
                </div>
            `;
            
            const percentage = Math.round((score / quizQuestions.length) * 100);
            scoreDisplay.style.display = 'block';
            scoreDisplay.innerHTML = `
                Your Score: ${score} / ${quizQuestions.length} (${percentage}%)
                ${percentage >= 80 ? 'üåü Excellent!' : percentage >= 60 ? 'üëç Good job!' : 'üìö Keep studying!'}
            `;
        }

        // Reset quiz
        function resetQuiz() {
            currentQuestion = 0;
            score = 0;
            quizCompleted = false;
            document.getElementById('scoreDisplay').style.display = 'none';
            initQuiz();
        }

        // Event listeners
        document.getElementById('bitDepth').addEventListener('input', (e) => {
            updateBitDepth(parseInt(e.target.value));
        });

        document.getElementById('resolution').addEventListener('input', (e) => {
            updateResolution(parseInt(e.target.value));
        });

        // Metadata input listeners
        ['metaFileName', 'metaCamera', 'metaDate', 'metaGPS', 'metaISO', 'metaFlash'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateMetadataPreview);
        });

        // Set today's date
        document.getElementById('metaDate').value = new Date().toISOString().split('T')[0];

        // Initialize everything
        createSampleImages();
        updateBitDepth(24);
        updateResolution(10);
        updateMetadataPreview();
        initQuiz();

        // Metadata Game Data
        const detectiveCases = [
            {
                title: "The Missing Tourist",
                description: "Sarah went missing during her European vacation. Her family found her camera with these photos. Can you determine where she was last seen?",
                photos: [
                    {
                        id: "photo1",
                        thumbnail: "üèõÔ∏è Historic Building",
                        metadata: {
                            fileName: "DSC_0142.jpg",
                            date: "2025-01-20 14:32:18",
                            location: "48.8584¬∞ N, 2.2945¬∞ E",
                            camera: "Nikon D750",
                            description: "Beautiful architecture"
                        }
                    },
                    {
                        id: "photo2",
                        thumbnail: "üåâ Bridge at Night",
                        metadata: {
                            fileName: "DSC_0156.jpg",
                            date: "2025-01-21 20:15:42",
                            location: "51.5055¬∞ N, 0.0754¬∞ W",
                            camera: "Nikon D750",
                            description: "Night photography"
                        }
                    },
                    {
                        id: "photo3",
                        thumbnail: "‚òï Caf√© Scene",
                        metadata: {
                            fileName: "DSC_0171.jpg",
                            date: "2025-01-22 09:45:33",
                            location: "52.5200¬∞ N, 13.4050¬∞ E",
                            camera: "Nikon D750",
                            description: "Morning coffee"
                        }
                    }
                ],
                questions: [
                    {
                        text: "In which city was Sarah's last photo taken?",
                        type: "select",
                        options: ["Paris", "London", "Berlin", "Rome"],
                        answer: "Berlin"
                    },
                    {
                        text: "What time was the last photo taken?",
                        type: "text",
                        answer: "09:45"
                    }
                ]
            },
            {
                title: "The Art Forgery",
                description: "A famous painting was stolen and replaced with a forgery. The museum has photos of the 'original' from different dates. Which photo shows the fake?",
                photos: [
                    {
                        id: "photo1",
                        thumbnail: "üñºÔ∏è Museum Display A",
                        metadata: {
                            fileName: "inventory_2024.jpg",
                            date: "2024-06-15 11:20:00",
                            camera: "Canon EOS R",
                            copyright: "City Museum ¬© 2024",
                            software: "Adobe Photoshop 2024"
                        }
                    },
                    {
                        id: "photo2",
                        thumbnail: "üñºÔ∏è Museum Display B",
                        metadata: {
                            fileName: "painting_doc.jpg",
                            date: "2025-01-10 15:45:00",
                            camera: "iPhone 15 Pro",
                            copyright: "Museum Staff",
                            software: "iOS 17.2"
                        }
                    },
                    {
                        id: "photo3",
                        thumbnail: "üñºÔ∏è Museum Display C",
                        metadata: {
                            fileName: "authentic_piece.jpg",
                            date: "2023-01-10 14:30:00",
                            camera: "Hasselblad X2D",
                            copyright: "City Museum ¬© 2025",
                            software: "Capture One 23"
                        }
                    }
                ],
                questions: [
                    {
                        text: "Which photo likely shows the forgery?",
                        type: "select",
                        options: ["Photo A", "Photo B", "Photo C"],
                        answer: "Photo C"
                    },
                    {
                        text: "What metadata inconsistency reveals the forgery?",
                        type: "select",
                        options: ["Camera model", "Copyright date mismatch", "File format", "Resolution"],
                        answer: "Copyright date mismatch"
                    }
                ]
            },
            {
                title: "The Alibi",
                description: "James claims he was at a conference in Manchester on January 18th, not at the crime scene in London. His phone has this photo as proof. Is his alibi valid?",
                photos: [
                    {
                        id: "photo1",
                        thumbnail: "üì± Conference Badge",
                        metadata: {
                            fileName: "IMG_9823.HEIC",
                            date: "2025-01-18 10:30:00",
                            location: "53.4808¬∞ N, 2.2426¬∞ W",
                            camera: "iPhone 14",
                            flash: "Flash did not fire",
                            software: "iOS 17.2"
                        }
                    },
                    {
                        id: "photo2",
                        thumbnail: "üé§ Conference Stage",
                        metadata: {
                            fileName: "IMG_9824.HEIC",
                            date: "2025-01-17 14:15:00",
                            location: "51.5074¬∞ N, 0.1278¬∞ W",
                            camera: "iPhone 14",
                            flash: "Flash fired",
                            software: "GIMP 2.10"
                        }
                    }
                ],
                questions: [
                    {
                        text: "Is James's alibi valid?",
                        type: "select",
                        options: ["Yes, he was in Manchester", "No, metadata shows London", "Cannot determine"],
                        answer: "No, metadata shows London"
                    },
                    {
                        text: "What suspicious metadata indicates tampering?",
                        type: "select",
                        options: ["Wrong date", "Edited with GIMP", "Flash settings", "File format"],
                        answer: "Edited with GIMP"
                    }
                ]
            },
            {
                title: "The Leaked Photo",
                description: "A confidential photo was leaked from a company. Three employees had access. Who took the leaked photo based on the metadata?",
                photos: [
                    {
                        id: "photo1",
                        thumbnail: "üíº Leaked Document",
                        metadata: {
                            fileName: "confidential.jpg",
                            date: "2025-01-15 16:45:23",
                            camera: "Samsung Galaxy S24",
                            author: "Unknown",
                            company: "TechCorp Ltd",
                            originalDate: "2025-01-15 16:45:23",
                            modifyDate: "2025-01-16 09:12:45"
                        }
                    },
                    {
                        id: "photo2",
                        thumbnail: "üì± Employee A's Phone",
                        metadata: {
                            device: "iPhone 15 Pro",
                            owner: "Alice Johnson",
                            lastPhoto: "2025-01-15 12:30:00"
                        }
                    },
                    {
                        id: "photo3",
                        thumbnail: "üì± Employee B's Phone",
                        metadata: {
                            device: "Samsung Galaxy S24",
                            owner: "Bob Smith",
                            lastPhoto: "2025-01-15 17:00:00"
                        }
                    }
                ],
                questions: [
                    {
                        text: "Which employee likely took the leaked photo?",
                        type: "select",
                        options: ["Alice Johnson", "Bob Smith", "Cannot determine"],
                        answer: "Bob Smith"
                    },
                    {
                        text: "What metadata field was modified to hide identity?",
                        type: "select",
                        options: ["Camera model", "Author field", "Date taken", "Company name"],
                        answer: "Author field"
                    }
                ]
            }
        ];

        const manipulationChallenges = [
            {
                title: "Fake Location - Paris",
                description: "Your task: Make this photo appear to have been taken at the Eiffel Tower in Paris. Change the GPS coordinates and any other relevant metadata.",
                targetMetadata: {
                    location: "48.8584¬∞ N, 2.2945¬∞ E",
                    locationName: "Paris",
                    description: ["Eiffel Tower", "Paris", "Tour Eiffel"]
                },
                hints: "The Eiffel Tower is located at approximately 48.8584¬∞ N, 2.2945¬∞ E"
            },
            {
                title: "Time Travel - Backdate Photo",
                description: "Your task: Make this photo appear to have been taken on New Year's Eve 1999 (Dec 31, 1999) at 23:45. Perfect for that 'vintage' look!",
                targetMetadata: {
                    date: "1999-12-31T23:45",
                    camera: ["Film camera", "Kodak", "Canon AE-1", "Nikon FM2"],
                    fileName: ["NYE", "1999", "millennium"]
                },
                hints: "Don't forget to change the camera model - modern phones didn't exist in 1999!"
            },
            {
                title: "Privacy Mode - Remove All Info",
                description: "Your task: Remove all identifying information from this photo's metadata. Make it completely anonymous - no location, no camera info, generic filename.",
                targetMetadata: {
                    location: ["", "0, 0", "Unknown"],
                    camera: ["", "Unknown"],
                    fileName: ["image", "photo", "untitled"],
                    description: ["", "No description"],
                    copyright: ["", "Public Domain"]
                },
                hints: "Clear or genericize all fields that could identify the photographer or location."
            },
            {
                title: "Professional Touch",
                description: "Your task: Make this photo appear to be taken by a professional photographer. Add copyright, professional camera model, and artistic description.",
                targetMetadata: {
                    camera: ["Canon EOS R5", "Nikon Z9", "Sony A7R V", "Hasselblad"],
                    copyright: ["¬©", "All rights reserved", "Photography"],
                    description: ["professional", "artistic", "commercial", "portfolio"]
                },
                hints: "Professional photos always include copyright information and use high-end camera models."
            }
        ];

        let currentCase = 0;
        let currentChallenge = 0;
        let selectedPhoto = null;

        // Set metadata game mode
        function setMetadataMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.metadata-mode').forEach(m => m.style.display = 'none');
            
            event.target.classList.add('active');
            document.getElementById(mode + 'Mode').style.display = 'block';
            
            if (mode === 'detective') {
                loadCase();
            } else if (mode === 'manipulation') {
                loadChallenge();
            }
        }

        // Load detective case
        function loadCase() {
            currentCase = parseInt(document.getElementById('caseSelect').value);
            const caseData = detectiveCases[currentCase];
            
            document.getElementById('caseDescription').innerHTML = `
                <h4>${caseData.title}</h4>
                <p>${caseData.description}</p>
            `;
            
            // Display evidence photos
            const container = document.getElementById('evidenceContainer');
            container.innerHTML = caseData.photos.map((photo, index) => `
                <div class="evidence-photo" onclick="selectEvidence(${index})">
                    <div style="font-size: 48px; margin-bottom: 10px;">${photo.thumbnail}</div>
                    <h5>Evidence ${index + 1}</h5>
                    <div class="metadata-display" id="metadata-${index}" style="display: none;">
                        ${formatMetadata(photo.metadata)}
                    </div>
                </div>
            `).join('');
            
            // Display questions
            const questionsContainer = document.getElementById('detectiveQuestions');
            questionsContainer.innerHTML = '<h4>Answer these questions:</h4>' + 
                caseData.questions.map((q, index) => `
                    <div class="question-group">
                        <label>${q.text}</label>
                        ${q.type === 'select' ? 
                            `<select id="answer-${index}">
                                <option value="">Select an answer...</option>
                                ${q.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
                            </select>` :
                            `<input type="text" id="answer-${index}" placeholder="Type your answer...">`
                        }
                    </div>
                `).join('');
            
            document.getElementById('detectiveFeedback').innerHTML = '';
        }

        // Select evidence photo
        function selectEvidence(index) {
            document.querySelectorAll('.evidence-photo').forEach(photo => {
                photo.classList.remove('selected');
                photo.querySelector('.metadata-display').style.display = 'none';
            });
            
            const selected = document.querySelectorAll('.evidence-photo')[index];
            selected.classList.add('selected');
            selected.querySelector('.metadata-display').style.display = 'block';
        }

        // Format metadata for display
        function formatMetadata(metadata) {
            return Object.entries(metadata).map(([key, value]) => 
                `${key}: ${value}`
            ).join('\n');
        }

        // Check detective answer
        function checkDetectiveAnswer() {
            const caseData = detectiveCases[currentCase];
            let correct = 0;
            
            caseData.questions.forEach((q, index) => {
                const userAnswer = document.getElementById(`answer-${index}`).value;
                if (userAnswer.toLowerCase().includes(q.answer.toLowerCase())) {
                    correct++;
                }
            });
            
            const feedback = document.getElementById('detectiveFeedback');
            if (correct === caseData.questions.length) {
                feedback.className = 'success-feedback';
                feedback.innerHTML = `üéâ Excellent detective work! You solved the case!<br>
                    All ${correct}/${caseData.questions.length} answers correct!`;
            } else {
                feedback.className = 'error-feedback';
                feedback.innerHTML = `üîç Not quite right. You got ${correct}/${caseData.questions.length} correct.<br>
                    Look at the metadata more carefully!`;
            }
        }

        // Load manipulation challenge
        function loadChallenge() {
            currentChallenge = parseInt(document.getElementById('challengeSelect').value);
            const challenge = manipulationChallenges[currentChallenge];
            
            document.getElementById('challengeDescription').innerHTML = `
                <h4>${challenge.title}</h4>
                <p>${challenge.description}</p>
                <p><strong>üí° Hint:</strong> ${challenge.hints}</p>
            `;
            
            document.getElementById('manipulationFeedback').innerHTML = '';
            
            // Reset fields for new challenge
            if (currentChallenge === 2) { // Privacy mode
                document.getElementById('manipFileName').value = 'private_photo.jpg';
                document.getElementById('manipCamera').value = 'Phone Camera';
                document.getElementById('manipGPS').value = '51.5074¬∞ N, 0.1278¬∞ W';
                document.getElementById('manipDescription').value = 'My vacation photo';
                document.getElementById('manipCopyright').value = 'John Doe ¬© 2025';
            } else {
                document.getElementById('manipFileName').value = 'IMG_2025.jpg';
                document.getElementById('manipCamera').value = 'iPhone 15';
                document.getElementById('manipGPS').value = '51.5074¬∞ N, 0.1278¬∞ W';
                document.getElementById('manipDescription').value = 'London Bridge';
                document.getElementById('manipCopyright').value = '';
            }
        }

        // Check manipulation challenge
        function checkManipulationChallenge() {
            const challenge = manipulationChallenges[currentChallenge];
            const feedback = document.getElementById('manipulationFeedback');
            let success = true;
            let hints = [];
            
            // Check each target metadata field
            if (challenge.targetMetadata.location) {
                const gps = document.getElementById('manipGPS').value.toLowerCase();
                const valid = Array.isArray(challenge.targetMetadata.location) ?
                    challenge.targetMetadata.location.some(loc => gps.includes(loc.toLowerCase())) :
                    gps.includes(challenge.targetMetadata.location.toLowerCase());
                
                if (!valid) {
                    success = false;
                    hints.push("GPS location needs adjustment");
                }
            }
            
            if (challenge.targetMetadata.date) {
                const date = document.getElementById('manipDateTime').value;
                if (!date.includes(challenge.targetMetadata.date)) {
                    success = false;
                    hints.push("Date/time doesn't match the requirement");
                }
            }
            
            if (challenge.targetMetadata.camera) {
                const camera = document.getElementById('manipCamera').value.toLowerCase();
                const valid = challenge.targetMetadata.camera.some(cam => 
                    camera.includes(cam.toLowerCase()));
                
                if (!valid) {
                    success = false;
                    hints.push("Camera model needs to be appropriate");
                }
            }
            
            if (challenge.targetMetadata.fileName) {
                const fileName = document.getElementById('manipFileName').value.toLowerCase();
                const valid = challenge.targetMetadata.fileName.some(name => 
                    fileName.includes(name.toLowerCase()));
                
                if (!valid) {
                    success = false;
                    hints.push("Filename could be more convincing");
                }
            }
            
            if (challenge.targetMetadata.copyright) {
                const copyright = document.getElementById('manipCopyright').value.toLowerCase();
                const valid = challenge.targetMetadata.copyright.some(cr => 
                    copyright.includes(cr.toLowerCase()));
                
                if (!valid) {
                    success = false;
                    hints.push("Copyright information needed");
                }
            }
            
            if (success) {
                feedback.className = 'success-feedback';
                feedback.innerHTML = `üéâ Perfect! You successfully completed the manipulation challenge!<br>
                    Remember: In the real world, this kind of manipulation can have serious consequences.`;
            } else {
                feedback.className = 'error-feedback';
                feedback.innerHTML = `‚ùå Not quite right. Here's what needs work:<br>
                    ${hints.map(h => `‚Ä¢ ${h}`).join('<br>')}`;
            }
        }

        // Show location helper
        function showLocationHelper() {
            const locations = [
                { name: "Paris - Eiffel Tower", coords: "48.8584¬∞ N, 2.2945¬∞ E" },
                { name: "London - Big Ben", coords: "51.5074¬∞ N, 0.1278¬∞ W" },
                { name: "New York - Times Square", coords: "40.7580¬∞ N, 73.9855¬∞ W" },
                { name: "Tokyo - Tokyo Tower", coords: "35.6586¬∞ N, 139.7454¬∞ E" },
                { name: "Sydney - Opera House", coords: "33.8568¬∞ S, 151.2153¬∞ E" },
                { name: "Berlin - Brandenburg Gate", coords: "52.5163¬∞ N, 13.3777¬∞ E" },
                { name: "Rome - Colosseum", coords: "41.8902¬∞ N, 12.4922¬∞ E" },
                { name: "Dubai - Burj Khalifa", coords: "25.1972¬∞ N, 55.2744¬∞ E" }
            ];
            
            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            overlay.onclick = () => overlay.remove();
            
            const popup = document.createElement('div');
            popup.className = 'location-popup';
            popup.innerHTML = `
                <h4>üìç Quick Location Selector</h4>
                <div class="location-list">
                    ${locations.map(loc => `
                        <div class="location-item" onclick="setLocation('${loc.coords}'); document.querySelector('.overlay').remove();">
                            <strong>${loc.name}</strong><br>
                            <small>${loc.coords}</small>
                        </div>
                    `).join('')}
                </div>
            `;
            
            overlay.appendChild(popup);
            document.body.appendChild(overlay);
        }

        // Set location from helper
        function setLocation(coords) {
            document.getElementById('manipGPS').value = coords;
        }
    </script>
</body>
</html>