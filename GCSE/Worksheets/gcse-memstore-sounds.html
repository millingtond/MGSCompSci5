<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Sound Sampling - GCSE Computer Science Interactive Worksheet</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #4caf50;
            --error: #f44336;
            --warning: #ffc107;
            --info: #2196f3;
            --dark: #333;
            --light: #f7f7f7;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            color: var(--dark);
            position: relative;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            opacity: 0.1;
            pointer-events: none;
        }

        .wave-bg {
            position: absolute;
            width: 200%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 50px,
                rgba(255,255,255,0.1) 50px,
                rgba(255,255,255,0.1) 100px
            );
            animation: wave-move 20s linear infinite;
        }

        @keyframes wave-move {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100px); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .main-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
            min-height: 600px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Enhanced Navigation */
        .nav-container {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .nav-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-btn:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .nav-btn:hover:before {
            width: 300px;
            height: 300px;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .nav-btn.active {
            background: var(--secondary);
            box-shadow: inset 0 3px 5px rgba(0,0,0,0.2);
        }

        .nav-btn.locked {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .nav-btn.completed {
            background: var(--success);
        }

        /* Progress Indicator */
        .progress-indicator {
            width: 100%;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255,255,255,0.3),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Enhanced Headers */
        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 30px;
            font-size: 3em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            position: relative;
            display: inline-block;
            width: 100%;
        }

        h1:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }

        h2 {
            color: var(--secondary);
            margin-bottom: 25px;
            font-size: 2.2em;
            position: relative;
            padding-left: 30px;
        }

        h2:before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translateY(-50%) scale(1); opacity: 1; }
            50% { transform: translateY(-50%) scale(1.1); opacity: 0.8; }
        }

        /* Enhanced Stats Container */
        .stats-container {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            min-width: 250px;
            transition: all 0.3s ease;
        }

        .stats-container:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .level-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(102, 126, 234, 0.5); }
            50% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.8); }
        }

        .xp-bar {
            width: 100%;
            height: 25px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 15px;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .xp-fill:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.1) 20px
            );
            animation: xp-stripes 1s linear infinite;
        }

        @keyframes xp-stripes {
            0% { transform: translateX(0); }
            100% { transform: translateX(20px); }
        }

        .xp-text {
            position: absolute;
            width: 100%;
            text-align: center;
            line-height: 25px;
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        /* Badge System */
        .badge-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .badge.earned {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            animation: badge-pop 0.5s ease;
        }

        @keyframes badge-pop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .badge:hover {
            transform: scale(1.1);
        }

        .badge-tooltip {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .badge:hover .badge-tooltip {
            opacity: 1;
        }

        /* Enhanced Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.5s ease;
            z-index: 2000;
            max-width: 350px;
            border-left: 5px solid var(--primary);
        }

        .achievement-popup.show {
            transform: translateX(0);
            animation: achievement-shake 0.5s ease;
        }

        @keyframes achievement-shake {
            0%, 100% { transform: translateX(0) rotate(0); }
            25% { transform: translateX(-5px) rotate(-1deg); }
            75% { transform: translateX(5px) rotate(1deg); }
        }

        .achievement-icon {
            font-size: 50px;
            text-align: center;
            margin-bottom: 10px;
            animation: achievement-spin 1s ease;
        }

        @keyframes achievement-spin {
            0% { transform: rotate(0); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced Task Styles */
        .task {
            background: var(--light);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .task:before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 20px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }

        .task:hover:before {
            opacity: 1;
        }

        .task:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .task-complete {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }

        .task.completed .task-complete {
            opacity: 1;
            transform: scale(1);
        }

        /* Enhanced Interactive Elements */
        input[type="text"], input[type="number"], textarea {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            width: 100%;
            margin: 8px 0;
            transition: all 0.3s ease;
            background: white;
        }

        input[type="text"]:focus, input[type="number"]:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            position: relative;
            overflow: hidden;
        }

        button:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        button:hover:before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }

        .btn-error {
            background: var(--error);
        }

        .btn-info {
            background: var(--info);
        }

        /* Enhanced Drag and Drop */
        .drag-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin: 30px 0;
        }

        .drag-column {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .draggable {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: move;
            transition: all 0.3s ease;
            user-select: none;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .draggable:before {
            content: '⋮⋮';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.5;
        }

        .draggable:hover {
            transform: scale(1.05) rotate(2deg);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .draggable.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            cursor: grabbing;
        }

        .drop-zone {
            border: 3px dashed var(--primary);
            border-radius: 15px;
            padding: 25px;
            min-height: 70px;
            background: rgba(102, 126, 234, 0.05);
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
            position: relative;
        }

        .drop-zone:before {
            content: '📥';
            position: absolute;
            font-size: 30px;
            opacity: 0.2;
        }

        .drop-zone.drag-over {
            background: rgba(102, 126, 234, 0.2);
            border-color: var(--secondary);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .drop-zone.filled {
            background: rgba(76, 175, 80, 0.1);
            border-color: var(--success);
            border-style: solid;
        }

        .drop-zone.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: var(--error);
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Enhanced Canvas Styles */
        .canvas-container {
            border: 3px solid var(--primary);
            border-radius: 15px;
            overflow: hidden;
            margin: 25px 0;
            position: relative;
            background: white;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .canvas-toolbar {
            background: var(--light);
            padding: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            border-bottom: 1px solid #ddd;
        }

        .color-picker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .color-picker:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        .color-picker.active {
            box-shadow: 0 0 0 3px var(--primary);
        }

        canvas {
            display: block;
            cursor: crosshair;
            touch-action: none;
        }

        /* Sound Visualizer */
        .sound-player {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .play-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .play-button:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .play-button.playing {
            animation: play-pulse 1s infinite;
        }

        @keyframes play-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .waveform-container {
            height: 150px;
            background: white;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }

        /* Enhanced Quiz Styles */
        .quiz-container {
            background: var(--light);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .quiz-option {
            display: block;
            background: white;
            padding: 18px;
            margin: 12px 0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .quiz-option:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .quiz-option:hover:before {
            left: 100%;
        }

        .quiz-option:hover {
            background: rgba(102, 126, 234, 0.05);
            border-color: var(--primary);
            transform: translateX(10px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .quiz-option.selected {
            background: rgba(102, 126, 234, 0.1);
            border-color: var(--primary);
            padding-left: 40px;
        }

        .quiz-option.selected:before {
            content: '✓';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 20px;
            font-weight: bold;
        }

        .quiz-option.correct {
            background: rgba(76, 175, 80, 0.1);
            border-color: var(--success);
            animation: correct-bounce 0.5s ease;
        }

        @keyframes correct-bounce {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .quiz-option.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border-color: var(--error);
            animation: shake 0.5s ease;
        }

        /* Enhanced Feedback Styles */
        .feedback {
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-weight: bold;
            animation: slideIn 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .feedback:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: currentColor;
        }

        .feedback.correct {
            background: rgba(76, 175, 80, 0.1);
            color: #2e7d32;
            border: 2px solid var(--success);
        }

        .feedback.correct:after {
            content: '✓';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 30px;
            opacity: 0.2;
        }

        .feedback.incorrect {
            background: rgba(244, 67, 54, 0.1);
            color: #c62828;
            border: 2px solid var(--error);
        }

        .feedback.incorrect:after {
            content: '✗';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 30px;
            opacity: 0.2;
        }

        /* Simulation Container */
        .simulation-container {
            background: var(--light);
            border-radius: 20px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .simulation-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .control-group {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .slider-container {
            margin: 20px 0;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4);
        }

        .value-display {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
            min-width: 80px;
            text-align: center;
        }

        /* Interactive Waveform */
        .waveform {
            width: 100%;
            height: 200px;
            background: white;
            border: 2px solid var(--primary);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            margin: 20px 0;
        }

        .waveform-path {
            stroke: var(--primary);
            stroke-width: 3;
            fill: none;
            transition: all 0.3s ease;
        }

        .waveform-samples {
            fill: var(--secondary);
            transition: all 0.3s ease;
        }

        /* Section Styles */
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Learning Objectives */
        .objectives {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .objectives:before {
            content: '🎯';
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 60px;
            opacity: 0.2;
        }

        .objectives ul {
            list-style: none;
            padding-left: 0;
        }

        .objectives li {
            padding: 12px 0;
            padding-left: 35px;
            position: relative;
            transition: all 0.3s ease;
        }

        .objectives li:hover {
            transform: translateX(5px);
        }

        .objectives li:before {
            content: "✓";
            position: absolute;
            left: 0;
            font-weight: bold;
            font-size: 24px;
            animation: check-bounce 0.5s ease;
        }

        @keyframes check-bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Mini-Games */
        .mini-game {
            background: var(--light);
            border-radius: 20px;
            padding: 30px;
            margin: 25px 0;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 400px;
            margin: 20px auto;
        }

        .game-tile {
            aspect-ratio: 1;
            background: var(--primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .game-tile:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .game-tile.flipped {
            background: var(--secondary);
            transform: rotateY(180deg);
        }

        .game-tile.matched {
            background: var(--success);
            animation: match-bounce 0.5s ease;
        }

        @keyframes match-bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Hint System */
        .hint-btn {
            background: var(--warning);
            color: var(--dark);
            font-size: 14px;
            padding: 10px 20px;
            position: relative;
        }

        .hint-btn:before {
            content: '💡';
            margin-right: 5px;
        }

        .hint-content {
            display: none;
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid var(--warning);
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            color: #856404;
            position: relative;
            padding-left: 50px;
        }

        .hint-content:before {
            content: '💡';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
        }

        /* Leaderboard */
        .leaderboard {
            background: var(--light);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .leaderboard-entry {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .leaderboard-entry:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .leaderboard-rank {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-right: 20px;
            min-width: 40px;
        }

        .leaderboard-entry:nth-child(1) .leaderboard-rank {
            color: gold;
        }

        .leaderboard-entry:nth-child(2) .leaderboard-rank {
            color: silver;
        }

        .leaderboard-entry:nth-child(3) .leaderboard-rank {
            color: #cd7f32;
        }

        /* Code Editor */
        .code-editor {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .code-editor pre {
            color: #d4d4d4;
            margin: 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
        }

        .code-line-numbers {
            position: absolute;
            left: 0;
            top: 20px;
            color: #858585;
            padding: 0 10px;
            border-right: 1px solid #333;
            user-select: none;
        }

        /* Real-time Collaboration (Visual Only) */
        .collab-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .collab-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .collab-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success);
            position: absolute;
            bottom: 0;
            right: 0;
            border: 2px solid white;
            animation: status-pulse 2s infinite;
        }

        @keyframes status-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        /* Accessibility Menu */
        .accessibility-menu {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .accessibility-menu h4 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .accessibility-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .accessibility-btn {
            padding: 10px;
            font-size: 14px;
            background: var(--light);
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .accessibility-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* High Contrast Mode */
        body.high-contrast {
            filter: contrast(1.5);
            background: black;
        }

        body.high-contrast .main-content {
            background: white;
            color: black;
        }

        /* Dyslexia Font */
        @font-face {
            font-family: 'OpenDyslexic';
            src: url('https://fonts.cdnfonts.com/s/30195/OpenDyslexic-Regular.woff') format('woff');
        }

        body.dyslexia-font {
            font-family: 'OpenDyslexic', Arial, sans-serif;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .stats-container {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 20px;
                width: 100%;
            }
            
            .accessibility-menu {
                position: relative;
                top: 0;
                left: 0;
                margin-bottom: 20px;
                width: 100%;
            }
            
            .nav-bar {
                gap: 10px;
            }
            
            .nav-btn {
                font-size: 12px;
                padding: 10px 18px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            h2 {
                font-size: 1.5em;
            }
            
            .drag-container {
                grid-template-columns: 1fr;
            }
            
            .game-board {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Touch-friendly buttons for mobile */
        @media (hover: none) {
            button {
                padding: 16px 32px;
            }
            
            .quiz-option {
                padding: 20px;
            }
            
            .draggable {
                padding: 18px 24px;
            }
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
            }
            
            .stats-container,
            .accessibility-menu,
            .collab-indicator,
            .feedback-box,
            button {
                display: none;
            }
            
            .main-content {
                box-shadow: none;
                padding: 20px;
            }
            
            .section {
                display: block !important;
                page-break-after: always;
            }
        }

        /* Loading Animation */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Confetti Animation */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--primary);
            position: absolute;
            animation: confetti-fall 3s linear;
            z-index: 3000;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--error);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            animation: badge-pulse 1s infinite;
        }

        @keyframes badge-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Feedback Button */
        .feedback-box {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--info);
            color: white;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            transition: all 0.3s ease;
        }

        .feedback-box:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
        }

        .feedback-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            z-index: 2000;
            max-width: 500px;
            width: 90%;
            animation: modal-appear 0.3s ease;
        }

        @keyframes modal-appear {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1999;
            backdrop-filter: blur(5px);
        }

        /* Tooltips */
        [data-tooltip] {
            position: relative;
            cursor: help;
        }

        [data-tooltip]:hover:after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            animation: tooltip-appear 0.3s ease;
        }

        @keyframes tooltip-appear {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(5px);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* No Paste Warning - Enhanced */
        .paste-warning {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--error);
            color: white;
            padding: 30px;
            border-radius: 15px;
            font-weight: bold;
            display: none;
            z-index: 3000;
            animation: warning-shake 0.5s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
        }

        .paste-warning:before {
            content: '⚠️';
            display: block;
            font-size: 48px;
            margin-bottom: 10px;
        }

        @keyframes warning-shake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-50%, -50%) rotate(-5deg); }
            75% { transform: translate(-50%, -50%) rotate(5deg); }
        }
    </style>
</head>
<body>
    <!-- Background Animation -->
    <div class="bg-animation">
        <div class="wave-bg"></div>
    </div>

    <!-- XP and Stats Display -->
    <div class="stats-container" role="status" aria-live="polite">
        <h3>Your Progress 🎮</h3>
        <div style="display: flex; align-items: center; margin: 10px 0;">
            <span>Level:</span>
            <span class="level-badge" id="levelBadge">1</span>
        </div>
        <p>XP: <span id="xp">0</span>/<span id="xpNeeded">100</span></p>
        <div class="xp-bar">
            <div class="xp-fill" id="xpBar"></div>
            <div class="xp-text">0%</div>
        </div>
        <div class="badge-container">
            <div class="badge" id="badge1" data-tooltip="Starter">🌟<span class="badge-tooltip">Starter</span></div>
            <div class="badge" id="badge2" data-tooltip="Explorer">🔍<span class="badge-tooltip">Explorer</span></div>
            <div class="badge" id="badge3" data-tooltip="Scientist">🔬<span class="badge-tooltip">Scientist</span></div>
            <div class="badge" id="badge4" data-tooltip="Expert">🎓<span class="badge-tooltip">Expert</span></div>
            <div class="badge" id="badge5" data-tooltip="Master">👑<span class="badge-tooltip">Master</span></div>
        </div>
        <div style="margin-top: 15px;">
            <p>🏆 Achievements: <span id="achievementCount">0</span></p>
            <p>⭐ Streak: <span id="streakCount">0</span> days</p>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievementPopup" role="alert">
        <div class="achievement-icon" id="achievementIcon">🏆</div>
        <h3>Achievement Unlocked!</h3>
        <p id="achievementText"></p>
        <p style="color: var(--primary); font-weight: bold;">+<span id="achievementXP">0</span> XP</p>
    </div>

    <!-- Paste Warning -->
    <div class="paste-warning" id="pasteWarning" role="alert">
        No pasting allowed!<br>
        <small>Type your answers honestly to learn properly.</small>
    </div>

    <!-- Accessibility Menu -->
    <div class="accessibility-menu">
        <h4>⚙️ Accessibility</h4>
        <div class="accessibility-controls">
            <button class="accessibility-btn" onclick="toggleHighContrast()" aria-label="Toggle high contrast">High Contrast</button>
            <button class="accessibility-btn" onclick="toggleDyslexiaFont()" aria-label="Toggle dyslexia font">Dyslexia Font</button>
            <button class="accessibility-btn" onclick="changeFontSize(1)" aria-label="Increase font size">A+</button>
            <button class="accessibility-btn" onclick="changeFontSize(-1)" aria-label="Decrease font size">A-</button>
            <button class="accessibility-btn" onclick="toggleAnimations()" aria-label="Toggle animations">Animations</button>
            <button class="accessibility-btn" onclick="toggleSoundEffects()" aria-label="Toggle sounds">Sounds</button>
        </div>
    </div>

    <!-- Collaboration Indicator -->
    <div class="collab-indicator">
        <div class="collab-avatar">You<div class="collab-status"></div></div>
        <span>Working Solo</span>
    </div>

    <!-- Feedback Button -->
    <div class="feedback-box" onclick="openFeedback()" role="button" aria-label="Submit feedback">
        💬
    </div>

    <!-- Feedback Modal -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeFeedback()"></div>
    <div class="feedback-modal" id="feedbackModal">
        <h3>📝 Submit Feedback</h3>
        <p>Help us improve this worksheet!</p>
        <textarea id="feedbackText" rows="6" placeholder="Found a bug? Have a suggestion? Let us know..."></textarea>
        <div style="margin-top: 20px; text-align: center;">
            <button class="btn-success" onclick="submitFeedback()">Send Feedback</button>
            <button onclick="closeFeedback()">Cancel</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Navigation -->
        <div class="nav-container">
            <nav class="nav-bar" role="navigation">
                <button class="nav-btn active" onclick="showSection(0)" aria-label="Introduction">
                    <span class="notification-badge" id="notif0" style="display: none;">!</span>
                    Intro
                </button>
                <button class="nav-btn" onclick="showSection(1)" aria-label="Starter">
                    Starter
                </button>
                <button class="nav-btn" onclick="showSection(2)" aria-label="Sampling Rate">
                    Sampling
                </button>
                <button class="nav-btn" onclick="showSection(3)" aria-label="Bit Depth">
                    Bit Depth
                </button>
                <button class="nav-btn" onclick="showSection(4)" aria-label="How It Works">
                    Process
                </button>
                <button class="nav-btn" onclick="showSection(5)" aria-label="Perceptual">
                    Perceptual
                </button>
                <button class="nav-btn" onclick="showSection(6)" aria-label="Practice">
                    Practice
                </button>
                <button class="nav-btn" onclick="showSection(7)" aria-label="Extension">
                    Extension
                </button>
                <button class="nav-btn" onclick="showSection(8)" aria-label="Summary">
                    Summary
                </button>
            </nav>
            <div class="progress-indicator">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>

        <div class="main-content">
            <h1>🎵 Digital Sound Sampling 🎵</h1>
            
            <!-- Section 0: Introduction -->
            <div class="section active" id="section0">
                <h2>Welcome to Your Interactive Sound Journey!</h2>
                
                <div class="objectives">
                    <h3>🎯 Learning Objectives</h3>
                    <ul>
                        <li>Master sampling rate and its effect on sound quality</li>
                        <li>Understand sample resolution (bit depth) and file sizes</li>
                        <li>Explain how analog sound becomes digital data</li>
                        <li>Explore perceptual music shaping techniques</li>
                        <li>Apply knowledge to real-world scenarios</li>
                    </ul>
                </div>

                <div class="task">
                    <h3>🎮 How This Works</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div style="text-align: center; padding: 20px; background: rgba(102, 126, 234, 0.1); border-radius: 15px;">
                            <div style="font-size: 48px;">📈</div>
                            <h4>Earn XP</h4>
                            <p>Complete tasks to gain experience</p>
                        </div>
                        <div style="text-align: center; padding: 20px; background: rgba(118, 75, 162, 0.1); border-radius: 15px;">
                            <div style="font-size: 48px;">🏆</div>
                            <h4>Unlock Achievements</h4>
                            <p>Discover special rewards</p>
                        </div>
                        <div style="text-align: center; padding: 20px; background: rgba(76, 175, 80, 0.1); border-radius: 15px;">
                            <div style="font-size: 48px;">⭐</div>
                            <h4>Level Up</h4>
                            <p>Progress from Level 1 to 5</p>
                        </div>
                    </div>
                    
                    <p><strong>Pro Tips:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>🎯 Complete all activities thoroughly for maximum XP</li>
                        <li>💡 Use hints wisely - they reduce XP rewards</li>
                        <li>📝 Use technical keywords in your answers</li>
                        <li>🔄 Reset activities to try different approaches</li>
                        <li>🎮 Look out for hidden mini-games and easter eggs!</li>
                    </ul>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn-success" style="font-size: 20px; padding: 18px 40px;" onclick="startLesson()">
                            🚀 Start Your Adventure!
                        </button>
                    </div>
                </div>

                <div class="mini-game">
                    <h3>🎯 Quick Warm-Up: Sound Wave Memory</h3>
                    <p>Match the sound wave patterns to warm up your brain!</p>
                    <div class="game-board" id="memoryGame">
                        <!-- Memory game tiles will be generated here -->
                    </div>
                    <p>Moves: <span id="moveCount">0</span> | Best: <span id="bestScore">-</span></p>
                    <button onclick="initMemoryGame()">New Game</button>
                </div>
            </div>

            <!-- Section 1: Starter Activity -->
            <div class="section" id="section1">
                <h2>Starter Activity: Sound Wave Detective 🔍</h2>
                <button class="btn-error" style="float: right;" onclick="resetSection(1)">🔄 Reset Section</button>
                
                <div class="task">
                    <div class="task-complete">✓</div>
                    <h3>🎵 Interactive Sound Comparison</h3>
                    <p>Listen to these two sound samples and identify which has better quality:</p>
                    
                    <div class="sound-player">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                            <div>
                                <h4>Sample A</h4>
                                <button class="play-button" onclick="playSound('A')">▶</button>
                                <div class="waveform-container">
                                    <canvas id="waveformA" width="300" height="150"></canvas>
                                </div>
                                <p style="text-align: center;">8,000 Hz</p>
                            </div>
                            <div>
                                <h4>Sample B</h4>
                                <button class="play-button" onclick="playSound('B')">▶</button>
                                <div class="waveform-container">
                                    <canvas id="waveformB" width="300" height="150"></canvas>
                                </div>
                                <p style="text-align: center;">44,100 Hz</p>
                            </div>
                        </div>
                        
                        <div class="quiz-container">
                            <p><strong>Which sample has higher quality?</strong></p>
                            <button onclick="checkStarterAnswer('A')">Sample A</button>
                            <button onclick="checkStarterAnswer('B')">Sample B</button>
                            <button class="hint-btn" onclick="toggleHint('starter')">Need a Hint?</button>
                        </div>
                        
                        <div id="starterHint" class="hint-content">
                            Look at the sampling rates shown below each waveform. Higher sampling rate = more samples per second = better quality!
                        </div>
                        
                        <div id="starterFeedback"></div>
                    </div>
                </div>

                <div class="task">
                    <h3>🧠 Prior Knowledge Activator</h3>
                    <p>Let's activate your existing knowledge! For each statement, decide if it's true or false:</p>
                    
                    <div class="quiz-container">
                        <div style="margin: 15px 0;">
                            <p>1. Digital devices can only understand 1s and 0s (binary)</p>
                            <button onclick="checkKnowledgeItem(1, true)">True</button>
                            <button onclick="checkKnowledgeItem(1, false)">False</button>
                            <span id="knowledge1"></span>
                        </div>
                        
                        <div style="margin: 15px 0;">
                            <p>2. Sound in nature is continuous (analog)</p>
                            <button onclick="checkKnowledgeItem(2, true)">True</button>
                            <button onclick="checkKnowledgeItem(2, false)">False</button>
                            <span id="knowledge2"></span>
                        </div>
                        
                        <div style="margin: 15px 0;">
                            <p>3. Computers can store infinite detail in sound files</p>
                            <button onclick="checkKnowledgeItem(3, false)">True</button>
                            <button onclick="checkKnowledgeItem(3, true)">False</button>
                            <span id="knowledge3"></span>
                        </div>
                        
                        <div style="margin: 15px 0;">
                            <p>4. MP3 files are smaller than WAV files</p>
                            <button onclick="checkKnowledgeItem(4, true)">True</button>
                            <button onclick="checkKnowledgeItem(4, false)">False</button>
                            <span id="knowledge4"></span>
                        </div>
                    </div>
                    
                    <div id="knowledgeSummary"></div>
                </div>

                <div class="mini-game">
                    <h3>🎮 Bonus Game: Wave Rider</h3>
                    <p>Control the sample point to follow the wave! Use arrow keys or touch.</p>
                    <canvas id="waveRiderCanvas" width="600" height="300" style="border: 2px solid var(--primary); border-radius: 10px; width: 100%;"></canvas>
                    <p>Score: <span id="waveRiderScore">0</span> | High Score: <span id="waveRiderHighScore">0</span></p>
                    <button onclick="startWaveRider()">Start Game</button>
                </div>
            </div>

            <!-- Section 2: Sampling Rate -->
            <div class="section" id="section2">
                <h2>Sampling Rate: The Heartbeat of Digital Sound</h2>
                <button class="btn-error" style="float: right;" onclick="resetSection(2)">🔄 Reset Section</button>
                
                <div class="task">
                    <h3>📊 What is Sampling Rate?</h3>
                    <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <p><strong>Sampling rate</strong> is the number of times per second we measure (sample) a sound wave.</p>
                        <p>📏 Measured in <strong>Hertz (Hz)</strong> where 1 Hz = 1 sample per second</p>
                        <p>🎯 Higher sampling rate = More accurate representation = Better quality</p>
                    </div>
                    
                    <div class="simulation-container">
                        <h4>🎛️ Interactive Sampling Rate Laboratory</h4>
                        <p>Experiment with different sampling rates and see the results in real-time!</p>
                        
                        <div class="control-group">
                            <div class="slider-container">
                                <label>Sampling Rate: <span class="value-display" id="samplingRateValue">8000 Hz</span></label>
                                <input type="range" id="samplingRateSlider" min="1000" max="96000" value="8000" step="1000" 
                                       oninput="updateSamplingRate(this.value)">
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <button onclick="playSampledSound()">🔊 Play Sample</button>
                                <button onclick="compareSamples()">📊 Compare Qualities</button>
                            </div>
                        </div>
                        
                        <div class="waveform" id="samplingWaveform">
                            <svg width="100%" height="100%" viewBox="0 0 600 200">
                                <path id="originalWave" class="waveform-path" stroke="#ddd" />
                                <path id="sampledWave" class="waveform-path" />
                                <g id="samplePoints" class="waveform-samples"></g>
                            </svg>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px;">
                            <div style="text-align: center; padding: 15px; background: rgba(255, 193, 7, 0.1); border-radius: 10px;">
                                <strong>File Size</strong>
                                <p id="fileSize">~1.4 MB/min</p>
                            </div>
                            <div style="text-align: center; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 10px;">
                                <strong>Quality</strong>
                                <p id="qualityRating">★★☆☆☆</p>
                            </div>
                            <div style="text-align: center; padding: 15px; background: rgba(33, 150, 243, 0.1); border-radius: 10px;">
                                <strong>Use Case</strong>
                                <p id="useCase">Telephone</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="task">
                    <h3>🎯 Drag and Drop: Match the Professional Standards</h3>
                    <p>Match each sampling rate to its typical application:</p>
                    
                    <div class="drag-container">
                        <div class="drag-column">
                            <h4>📊 Sampling Rates</h4>
                            <div class="draggable" draggable="true" data-value="8000">8,000 Hz</div>
                            <div class="draggable" draggable="true" data-value="16000">16,000 Hz</div>
                            <div class="draggable" draggable="true" data-value="22050">22,050 Hz</div>
                            <div class="draggable" draggable="true" data-value="44100">44,100 Hz</div>
                            <div class="draggable" draggable="true" data-value="48000">48,000 Hz</div>
                            <div class="draggable" draggable="true" data-value="96000">96,000 Hz</div>
                        </div>
                        
                        <div class="drag-column">
                            <h4>🎧 Applications</h4>
                            <div class="drop-zone" data-answer="8000">📞 Telephone Quality</div>
                            <div class="drop-zone" data-answer="16000">🎙️ Voice Recording</div>
                            <div class="drop-zone" data-answer="22050">📻 AM Radio</div>
                            <div class="drop-zone" data-answer="44100">💿 CD Quality</div>
                            <div class="drop-zone" data-answer="48000">🎬 Professional Video</div>
                            <div class="drop-zone" data-answer="96000">🎼 High-Res Audio</div>
                        </div>
                    </div>
                    
                    <button onclick="checkDragDrop('sampling')">Check Answers</button>
                    <button class="hint-btn" onclick="showMatchingHints()">Show Hints</button>
                    <div id="samplingDragFeedback"></div>
                </div>

                <div class="task">
                    <h3>🧩 Advanced Fill in the Blanks</h3>
                    <p>Complete the paragraph about sampling rate effects. Click words from the bank to fill the gaps:</p>
                    
                    <div class="word-bank">
                        <span class="word-option" onclick="selectWord(this, 'increase')">increase</span>
                        <span class="word-option" onclick="selectWord(this, 'decrease')">decrease</span>
                        <span class="word-option" onclick="selectWord(this, 'accurate')">accurate</span>
                        <span class="word-option" onclick="selectWord(this, 'distorted')">distorted</span>
                        <span class="word-option" onclick="selectWord(this, 'larger')">larger</span>
                        <span class="word-option" onclick="selectWord(this, 'smaller')">smaller</span>
                        <span class="word-option" onclick="selectWord(this, 'Nyquist')">Nyquist</span>
                        <span class="word-option" onclick="selectWord(this, 'aliasing')">aliasing</span>
                        <span class="word-option" onclick="selectWord(this, 'twice')">twice</span>
                        <span class="word-option" onclick="selectWord(this, 'half')">half</span>
                    </div>
                    
                    <div style="line-height: 2; margin: 20px 0;">
                        <p>When we <input type="text" id="blank1" readonly placeholder="___" style="width: 100px;"> the sampling rate, 
                        the digital representation becomes more <input type="text" id="blank2" readonly placeholder="___" style="width: 100px;"> 
                        to the original analog wave. However, this also makes the file size <input type="text" id="blank3" readonly placeholder="___" style="width: 100px;">.</p>
                        
                        <p>According to the <input type="text" id="blank4" readonly placeholder="___" style="width: 100px;"> theorem, 
                        we must sample at least <input type="text" id="blank5" readonly placeholder="___" style="width: 100px;"> 
                        the highest frequency to avoid <input type="text" id="blank6" readonly placeholder="___" style="width: 100px;">.</p>
                    </div>
                    
                    <button onclick="checkFillBlanks()">Check Answers</button>
                    <button onclick="clearBlanks()">Clear All</button>
                    <div id="fillBlanksFeedback"></div>
                </div>

                <div class="task">
                    <h3>🔬 Real-World Investigation</h3>
                    <p>Why do CDs use 44,100 Hz specifically? Research and explain:</p>
                    <textarea id="cdInvestigation" rows="5" placeholder="Hint: Think about human hearing range (20Hz - 20kHz) and the Nyquist theorem..."></textarea>
                    <button onclick="checkInvestigation('cd')">Submit Investigation</button>
                    <div id="cdInvestigationFeedback"></div>
                </div>
            </div>

            <!-- Section 3: Sample Resolution/Bit Depth -->
            <div class="section" id="section3">
                <h2>Bit Depth: The Precision of Sound</h2>
                <button class="btn-error" style="float: right;" onclick="resetSection(3)">🔄 Reset Section</button>
                
                <div class="task">
                    <h3>🎨 Understanding Bit Depth</h3>
                    <div style="background: linear-gradient(135deg, rgba(118, 75, 162, 0.1), rgba(245, 87, 108, 0.1)); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <p><strong>Bit depth</strong> (sample resolution) determines how many different values we can use to represent the amplitude of each sample.</p>
                        <p>🎯 More bits = More precise measurements = Better dynamic range</p>
                        <p>📊 Common bit depths: 8-bit (256 levels), 16-bit (65,536 levels), 24-bit (16.7 million levels)</p>
                    </div>
                    
                    <div class="simulation-container">
                        <h4>🎛️ Bit Depth Visualizer</h4>
                        <p>See how bit depth affects the precision of amplitude measurements:</p>
                        
                        <div class="control-group">
                            <div class="slider-container">
                                <label>Bit Depth: <span class="value-display" id="bitDepthValue">8 bits</span></label>
                                <input type="range" id="bitDepthSlider" min="1" max="24" value="8" step="1" 
                                       oninput="updateBitDepth(this.value)">
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                            <div style="text-align: center;">
                                <h5>Quantization Levels</h5>
                                <canvas id="quantizationCanvas" width="250" height="200"></canvas>
                            </div>
                            <div style="text-align: center;">
                                <h5>Waveform Precision</h5>
                                <canvas id="bitDepthWaveCanvas" width="250" height="200"></canvas>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px;">
                            <div style="text-align: center; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px;">
                                <strong>Possible Values</strong>
                                <p id="possibleValues">256</p>
                            </div>
                            <div style="text-align: center; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 10px;">
                                <strong>Dynamic Range</strong>
                                <p id="dynamicRange">48 dB</p>
                            </div>
                            <div style="text-align: center; padding: 15px; background: rgba(255, 193, 7, 0.1); border-radius: 10px;">
                                <strong>Bytes per Sample</strong>
                                <p id="bytesPerSample">1</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="task">
                    <h3>🧮 Interactive File Size Calculator</h3>
                    <p>Calculate file sizes for different audio configurations:</p>
                    
                    <div class="simulation-container">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div class="control-group">
                                <label>Sampling Rate</label>
                                <select id="calcSampleRate" onchange="calculateFileSize()">
                                    <option value="8000">8,000 Hz</option>
                                    <option value="22050">22,050 Hz</option>
                                    <option value="44100" selected>44,100 Hz</option>
                                    <option value="48000">48,000 Hz</option>
                                    <option value="96000">96,000 Hz</option>
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <label>Bit Depth</label>
                                <select id="calcBitDepth" onchange="calculateFileSize()">
                                    <option value="8">8-bit</option>
                                    <option value="16" selected>16-bit</option>
                                    <option value="24">24-bit</option>
                                    <option value="32">32-bit</option>
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <label>Duration</label>
                                <input type="number" id="calcDuration" value="10" min="1" max="600" onchange="calculateFileSize()">
                                <small>seconds</small>
                            </div>
                            
                            <div class="control-group">
                                <label>Channels</label>
                                <select id="calcChannels" onchange="calculateFileSize()">
                                    <option value="1">Mono</option>
                                    <option value="2" selected>Stereo</option>
                                    <option value="6">5.1 Surround</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px; text-align: center;">
                            <h4>Calculated File Size</h4>
                            <div style="font-size: 48px; color: var(--primary); font-weight: bold;">
                                <span id="calculatedSize">0</span> <span id="sizeUnit">MB</span>
                            </div>
                            <p style="margin-top: 10px;">Formula: Sample Rate × Bit Depth ÷ 8 × Duration × Channels</p>
                        </div>
                        
                        <div class="canvas-container" style="margin-top: 20px;">
                            <div class="canvas-toolbar">
                                <span>Show your working:</span>
                                <div class="color-picker" style="background: #667eea;" onclick="setDrawColor('#667eea')"></div>
                                <div class="color-picker" style="background: #764ba2;" onclick="setDrawColor('#764ba2')"></div>
                                <div class="color-picker" style="background: #333;" onclick="setDrawColor('#333')"></div>
                                <button onclick="clearCanvas('calculationCanvas')">Clear</button>
                            </div>
                            <canvas id="calculationCanvas" width="600" height="200"></canvas>
                        </div>
                    </div>
                </div>

                <div class="task">
                    <h3>🎮 Bit Depth Challenge Game</h3>
                    <p>Can you hear the difference? Listen to audio at different bit depths:</p>
                    
                    <div class="mini-game">
                        <div id="bitDepthGame">
                            <p>Two samples will play. Which has higher bit depth?</p>
                            <button onclick="playBitDepthSample('A')">🔊 Play Sample A</button>
                            <button onclick="playBitDepthSample('B')">🔊 Play Sample B</button>
                            
                            <div style="margin-top: 20px;">
                                <button onclick="guessBitDepth('A')">A has higher bit depth</button>
                                <button onclick="guessBitDepth('B')">B has higher bit depth</button>
                                <button onclick="guessBitDepth('same')">They're the same</button>
                            </div>
                            
                            <div id="bitDepthGameFeedback"></div>
                            <p>Score: <span id="bitDepthScore">0</span>/5</p>
                        </div>
                    </div>
                </div>

                <div class="task">
                    <h3>💡 Critical Thinking</h3>
                    <p>A music producer says: "I always use 32-bit depth for the best quality!" Is this always necessary? Explain:</p>
                    <textarea id="criticalThinking" rows="5" placeholder="Consider human hearing limitations, file sizes, and practical applications..."></textarea>
                    <button onclick="checkCriticalThinking()">Submit Analysis</button>
                    <div id="criticalThinkingFeedback"></div>
                </div>
            </div>

            <!-- Section 4: How Sound is Sampled -->
            <div class="section" id="section4">
                <h2>The Digital Transformation Process</h2>
                <button class="btn-error" style="float: right;" onclick="resetSection(4)">🔄 Reset Section</button>
                
                <div class="task">
                    <h3>🔄 From Analog to Digital: The Journey</h3>
                    
                    <div class="simulation-container">
                        <h4>🎬 Interactive Sampling Process Animation</h4>
                        <p>Watch each step of the analog-to-digital conversion process:</p>
                        
                        <canvas id="samplingProcessCanvas" width="800" height="400" style="width: 100%; border: 2px solid var(--primary); border-radius: 10px;"></canvas>
                        
                        <div class="simulation-controls">
                            <button onclick="startSamplingAnimation()">▶ Play Animation</button>
                            <button onclick="pauseSamplingAnimation()">⏸ Pause</button>
                            <button onclick="stepSamplingAnimation()">⏭ Next Step</button>
                            <button onclick="resetSamplingAnimation()">🔄 Reset</button>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 20px; background: var(--light); border-radius: 10px;">
                            <h4>Current Step: <span id="currentStep">Ready to start</span></h4>
                            <div class="progress-indicator">
                                <div class="progress-bar" id="animationProgress" style="width: 0%;"></div>
                            </div>
                            <p id="stepDescription" style="margin-top: 15px;">Click 'Play Animation' to begin the journey from analog to digital!</p>
                        </div>
                    </div>
                </div>

                <div class="task">
                    <h3>🧩 Sequencing Challenge: Order the Process</h3>
                    <p>Drag these steps into the correct order:</p>
                    
                    <div id="sequenceContainer" style="margin: 20px 0;">
                        <div class="draggable" draggable="true" data-order="4">
                            <strong>Step ?</strong><br>
                            Binary values are stored in a digital file format
                        </div>
                        <div class="draggable" draggable="true" data-order="1">
                            <strong>Step ?</strong><br>
                            The analog wave's amplitude is measured at regular time intervals
                        </div>
                        <div class="draggable" draggable="true" data-order="3">
                            <strong>Step ?</strong><br>
                            Each measurement is converted to binary (1s and 0s)
                        </div>
                        <div class="draggable" draggable="true" data-order="5">
                            <strong>Step ?</strong><br>
                            The digital samples can be reconstructed into an approximated wave
                        </div>
                        <div class="draggable" draggable="true" data-order="2">
                            <strong>Step ?</strong><br>
                            Amplitude values are quantized to the nearest available level
                        </div>
                    </div>
                    
                    <button onclick="checkSequence()">Check Order</button>
                    <button class="hint-btn" onclick="showSequenceHint()">Show First Step</button>
                    <div id="sequenceFeedback"></div>
                </div>

                <div class="task">
                    <h3>🎨 Create Your Own Digital Sample</h3>
                    <p>Draw an analog wave, then click to add sample points. See how it becomes digital!</p>
                    
                    <div class="canvas-container">
                        <div class="canvas-toolbar">
                            <button onclick="setDrawingMode('wave')" class="active">Draw Wave</button>
                            <button onclick="setDrawingMode('samples')">Add Samples</button>
                            <button onclick="convertToDigital()">Convert to Digital</button>
                            <button onclick="clearCanvas('drawingCanvas')">Clear All</button>
                        </div>
                        <canvas id="drawingCanvas" width="800" height="300"></canvas>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <p><strong>Reflection Question:</strong> How does the number of sample points affect the accuracy of your digital representation?</p>
                        <textarea id="waveReflection" rows="4" placeholder="Compare your original wave to the digital version..."></textarea>
                        <button onclick="checkReflection('wave')">Submit Reflection</button>
                        <div id="waveReflectionFeedback"></div>
                    </div>
                </div>

                <div class="task">
                    <h3>🔬 Binary Representation Lab</h3>
                    <p>Convert amplitude values to binary:</p>
                    
                    <div class="code-editor">
                        <div class="code-line-numbers">1<br>2<br>3<br>4<br>5</div>
                        <pre>// Example: Converting amplitude to 8-bit binary
Amplitude: 150 (out of 255)
Binary: <input type="text" id="binaryInput1" placeholder="????????" maxlength="8" style="width: 100px; background: #2d2d2d; color: #d4d4d4; border: 1px solid #555;">

Amplitude: 200 (out of 255)
Binary: <input type="text" id="binaryInput2" placeholder="????????" maxlength="8" style="width: 100px; background: #2d2d2d; color: #d4d4d4; border: 1px solid #555;"></pre>
                    </div>
                    
                    <button onclick="checkBinaryConversion()">Check Conversions</button>
                    <button class="hint-btn" onclick="showBinaryHint()">Binary Conversion Help</button>
                    <div id="binaryFeedback"></div>
                </div>
            </div>

            <!-- Section 5: Perceptual Music Shaping -->
            <div class="section" id="section5">
                <h2>Perceptual Music Shaping: Smart Compression</h2>
                <button class="btn-error" style="float: right;" onclick="resetSection(5)">🔄 Reset Section</button>
                
                <div class="task">
                    <h3>👂 Understanding Human Hearing</h3>
                    <div style="background: linear-gradient(135deg, rgba(245, 87, 108, 0.1), rgba(255, 193, 7, 0.1)); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <p><strong>Perceptual music shaping</strong> removes sounds that humans can't hear to reduce file size without noticeable quality loss.</p>
                        <p>🎧 Human hearing range: 20 Hz - 20,000 Hz (20 kHz)</p>
                        <p>🔇 Masking effect: Loud sounds hide quiet sounds at similar frequencies</p>
                    </div>
                    
                    <div class="simulation-container">
                        <h4>🎛️ Frequency Filter Laboratory</h4>
                        <p>Toggle different frequency ranges to see file size reduction:</p>
                        
                        <canvas id="frequencyCanvas" width="800" height="250" style="width: 100%;"></canvas>
                        
                        <div style="margin: 20px 0;">
                            <label><input type="checkbox" id="subBass" checked onchange="updateFrequencyDisplay()"> 
                                🔊 Sub-bass (20-60 Hz) - Feel more than hear</label><br>
                            <label><input type="checkbox" id="bass" checked onchange="updateFrequencyDisplay()"> 
                                🎸 Bass (60-250 Hz) - Low instruments</label><br>
                            <label><input type="checkbox" id="midrange" checked onchange="updateFrequencyDisplay()"> 
                                🎤 Midrange (250-4000 Hz) - Human voice</label><br>
                            <label><input type="checkbox" id="highFreq" checked onchange="updateFrequencyDisplay()"> 
                                🎻 High (4000-20000 Hz) - Brilliance</label><br>
                            <label><input type="checkbox" id="ultrasonic" onchange="updateFrequencyDisplay()"> 
                                🦇 Ultrasonic (>20000 Hz) - Inaudible to humans</label>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div style="text-align: center; padding: 20px; background: rgba(76, 175, 80, 0.1); border-radius: 10px;">
                                <h4>File Size Reduction</h4>
                                <div style="font-size: 48px; color: var(--success);">
                                    <span id="sizeReduction">0</span>%
                                </div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: rgba(244, 67, 54, 0.1); border-radius: 10px;">
                                <h4>Quality Impact</h4>
                                <div style="font-size: 24px;" id="qualityImpact">None</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="task">
                    <h3>🎯 Frequency Sorting Challenge</h3>
                    <p>Sort these sounds into audible or inaudible categories for humans:</p>
                    
                    <div class="drag-container">
                        <div class="drag-column">
                            <h4>🔊 Sounds to Sort</h4>
                            <div class="draggable" draggable="true" data-audible="false">
                                🐕 Dog whistle (25 kHz)
                            </div>
                            <div class="draggable" draggable="true" data-audible="true">
                                🗣️ Human speech (1 kHz)
                            </div>
                            <div class="draggable" draggable="true" data-audible="false">
                                🌍 Earthquake rumble (5 Hz)
                            </div>
                            <div class="draggable" draggable="true" data-audible="true">
                                🎹 Piano middle C (262 Hz)
                            </div>
                            <div class="draggable" draggable="true" data-audible="false">
                                🦇 Bat echolocation (50 kHz)
                            </div>
                            <div class="draggable" draggable="true" data-audible="true">
                                🎸 Guitar strum (500 Hz)
                            </div>
                            <div class="draggable" draggable="true" data-audible="true">
                                🎺 Trumpet (2 kHz)
                            </div>
                            <div class="draggable" draggable="true" data-audible="false">
                                📡 Radio waves (100 MHz)
                            </div>
                        </div>
                        
                        <div class="drag-column">
                            <h4>Categories</h4>
                            <div class="drop-zone" data-category="audible" style="min-height: 200px;">
                                👂 Audible to Humans<br>
                                <small>(20 Hz - 20 kHz)</small>
                            </div>
                            <div class="drop-zone" data-category="inaudible" style="min-height: 200px;">
                                🚫 Inaudible to Humans<br>
                                <small>(Outside hearing range)</small>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="checkCategorization()">Check Sorting</button>
                    <div id="categorizationFeedback"></div>
                </div>

                <div class="task">
                    <h3>🎧 Masking Effect Demonstration</h3>
                    <p>Experience how loud sounds can mask quieter ones:</p>
                    
                    <div class="sound-player">
                        <p>Play these sounds separately, then together:</p>
                        <div style="display: flex; gap: 20px; justify-content: center; margin: 20px 0;">
                            <button onclick="playMaskingDemo('quiet')">🔉 Quiet Sound</button>
                            <button onclick="playMaskingDemo('loud')">🔊 Loud Sound</button>
                            <button onclick="playMaskingDemo('both')">🎵 Both Together</button>
                        </div>
                        <p style="text-align: center;"><em>Can you still hear the quiet sound when both play?</em></p>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <p><strong>Reflection:</strong> How could this masking effect be used in audio compression?</p>
                        <textarea id="maskingReflection" rows="3" placeholder="Think about removing sounds that would be masked anyway..."></textarea>
                        <button onclick="checkReflection('masking')">Submit Reflection</button>
                        <div id="maskingReflectionFeedback"></div>
                    </div>
                </div>

                <div class="task">
                    <h3>🏢 Real-World Applications</h3>
                    <div class="leaderboard">
                        <h4>Where Perceptual Shaping is Used:</h4>
                        <div class="leaderboard-entry">
                            <div class="leaderboard-rank">MP3</div>
                            <div>
                                <strong>Music Files</strong><br>
                                <small>Reduces file size by ~90% with minimal quality loss</small>
                            </div>
                        </div>
                        <div class="leaderboard-entry">
                            <div class="leaderboard-rank">AAC</div>
                            <div>
                                <strong>Streaming Services</strong><br>
                                <small>Used by YouTube, Apple Music, Spotify</small>
                            </div>
                        </div>
                        <div class="leaderboard-entry">
                            <div class="leaderboard-rank">OGG</div>
                            <div>
                                <strong>Video Games</strong><br>
                                <small>Efficient storage for game audio</small>
                            </div>
                        </div>
                    </div>
                    
                    <p style="margin-top: 20px;"><strong>⚠️ Common Mistake Alert!</strong></p>
                    <div style="background: rgba(244, 67, 54, 0.1); padding: 15px; border-radius: 10px; border-left: 4px solid var(--error);">
                        Students often think perceptual shaping reduces quality significantly. Remember: it removes sounds you <em>can't hear anyway</em>!
                    </div>
                </div>
            </div>

            <!-- Section 6: Practice Exam Questions -->
            <div class="section" id="section6">
                <h2>Exam Practice: Test Your Knowledge 📝</h2>
                <button class="btn-error" style="float: right;" onclick="resetSection(6)">🔄 Reset Questions</button>
                
                <div class="task">
                    <h3>Question 1 (3 marks) - Understanding</h3>
                    <p>Explain how an analog sound wave is converted into digital form.</p>
                    
                    <textarea id="examQ1" rows="8" placeholder="Write your answer here. Include the key steps in the process..."></textarea>
                    
                    <div style="margin: 15px 0;">
                        <label>Predicted marks: <input type="number" id="examQ1Marks" min="0" max="3" style="width: 60px;"> / 3</label>
                        <button onclick="revealMarkScheme('examQ1')">Reveal Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="examQ1MarkScheme" style="display: none;">
                        <h4>Mark Scheme:</h4>
                        <ul>
                            <li>✓ The height/amplitude of the wave is measured/sampled (1 mark)</li>
                            <li>✓ At regular/set intervals / at the sampling rate frequency (1 mark)</li>
                            <li>✓ Values are converted to/stored as binary/digital format (1 mark)</li>
                        </ul>
                        <p><em>Also accept: quantization, ADC (Analog-to-Digital Converter), discrete values</em></p>
                    </div>
                </div>

                <div class="task">
                    <h3>Question 2 (4 marks) - Application</h3>
                    <p>A podcast producer needs to choose between two recording options:</p>
                    <div style="background: var(--light); padding: 15px; border-radius: 10px; margin: 10px 0;">
                        <strong>Option A:</strong> 16,000 Hz sampling rate with 16-bit depth<br>
                        <strong>Option B:</strong> 44,100 Hz sampling rate with 24-bit depth
                    </div>
                    <p>Compare these options in terms of quality and file size. Which would you recommend for a voice-only podcast and why?</p>
                    
                    <textarea id="examQ2" rows="10" placeholder="Consider the frequency range of human speech..."></textarea>
                    
                    <div style="margin: 15px 0;">
                        <label>Predicted marks: <input type="number" id="examQ2Marks" min="0" max="4" style="width: 60px;"> / 4</label>
                        <button onclick="revealMarkScheme('examQ2')">Reveal Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="examQ2MarkScheme" style="display: none;">
                        <h4>Mark Scheme:</h4>
                        <ul>
                            <li>✓ Option B has higher sampling rate = captures more detail/higher frequencies (1 mark)</li>
                            <li>✓ Option B has higher bit depth = better dynamic range/more precise amplitudes (1 mark)</li>
                            <li>✓ Option B will have significantly larger file size (approximately 5x larger) (1 mark)</li>
                            <li>✓ Recommend Option A for voice podcast - human speech mainly 80-250Hz, 16kHz sufficient (1 mark)</li>
                        </ul>
                        <p><em>Must justify recommendation with reference to speech frequencies for full marks</em></p>
                    </div>
                </div>

                <div class="task">
                    <h3>Question 3 (5 marks) - Calculation</h3>
                    <p>Calculate the uncompressed file size for a stereo music track with:</p>
                    <ul style="margin-left: 20px;">
                        <li>Sampling rate: 48,000 Hz</li>
                        <li>Bit depth: 24 bits</li>
                        <li>Duration: 3 minutes 30 seconds</li>
                    </ul>
                    <p>Show all working and give your answer in MB (to 1 decimal place).</p>
                    
                    <div class="canvas-container">
                        <div class="canvas-toolbar">
                            <span>Working space:</span>
                            <button onclick="clearCanvas('examCalcCanvas')">Clear Canvas</button>
                        </div>
                        <canvas id="examCalcCanvas" width="800" height="300"></canvas>
                    </div>
                    
                    <textarea id="examQ3" rows="6" placeholder="Show your calculation steps here..."></textarea>
                    
                    <div style="margin: 15px 0;">
                        <label>Predicted marks: <input type="number" id="examQ3Marks" min="0" max="5" style="width: 60px;"> / 5</label>
                        <button onclick="revealMarkScheme('examQ3')">Reveal Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="examQ3MarkScheme" style="display: none;">
                        <h4>Mark Scheme:</h4>
                        <ul>
                            <li>✓ Convert duration to seconds: 3 × 60 + 30 = 210 seconds (1 mark)</li>
                            <li>✓ Convert bit depth to bytes: 24 ÷ 8 = 3 bytes (1 mark)</li>
                            <li>✓ Basic calculation: 48,000 × 3 × 210 = 30,240,000 bytes (1 mark)</li>
                            <li>✓ Account for stereo (2 channels): 30,240,000 × 2 = 60,480,000 bytes (1 mark)</li>
                            <li>✓ Convert to MB: 60,480,000 ÷ 1,000,000 = 60.5 MB (1 mark)</li>
                        </ul>
                        <p><em>Accept 57.7 MB if using 1,048,576 (MiB)</em></p>
                    </div>
                </div>

                <div class="task">
                    <h3>Question 4 (3 marks) - Analysis</h3>
                    <p>Explain why CD audio uses a sampling rate of 44,100 Hz specifically.</p>
                    
                    <textarea id="examQ4" rows="6" placeholder="Hint: Consider human hearing range and Nyquist theorem..."></textarea>
                    
                    <div style="margin: 15px 0;">
                        <label>Predicted marks: <input type="number" id="examQ4Marks" min="0" max="3" style="width: 60px;"> / 3</label>
                        <button onclick="revealMarkScheme('examQ4')">Reveal Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="examQ4MarkScheme" style="display: none;">
                        <h4>Mark Scheme:</h4>
                        <ul>
                            <li>✓ Human hearing range is 20 Hz to 20,000 Hz (20 kHz) (1 mark)</li>
                            <li>✓ Nyquist theorem: must sample at least 2× highest frequency (1 mark)</li>
                            <li>✓ 44,100 Hz > 40,000 Hz, with headroom for anti-aliasing filters (1 mark)</li>
                        </ul>
                        <p><em>Also accept: historical reasons related to video standards</em></p>
                    </div>
                </div>

                <div class="task">
                    <h3>Question 5 (2 marks) - Knowledge</h3>
                    <p>Define perceptual music shaping and give one example of information that could be removed.</p>
                    
                    <textarea id="examQ5" rows="4" placeholder="Keep your answer concise and specific..."></textarea>
                    
                    <div style="margin: 15px 0;">
                        <label>Predicted marks: <input type="number" id="examQ5Marks" min="0" max="2" style="width: 60px;"> / 2</label>
                        <button onclick="revealMarkScheme('examQ5')">Reveal Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="examQ5MarkScheme" style="display: none;">
                        <h4>Mark Scheme:</h4>
                        <ul>
                            <li>✓ Removing inaudible sounds/frequencies to reduce file size (1 mark)</li>
                            <li>✓ Example: frequencies above 20kHz OR below 20Hz OR masked sounds (1 mark)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Section 7: Extension Activities -->
            <div class="section" id="section7">
                <h2>Extension: Beyond the Specification 🚀</h2>
                <button class="btn-error" style="float: right;" onclick="resetSection(7)">🔄 Reset Section</button>
                
                <div class="task">
                    <h3>🔬 Advanced Concept: Nyquist-Shannon Theorem</h3>
                    <div style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(156, 39, 176, 0.1)); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <p>The Nyquist theorem is fundamental to digital audio. It states:</p>
                        <p style="text-align: center; font-size: 20px; margin: 20px 0;">
                            <strong>f<sub>s</sub> ≥ 2 × f<sub>max</sub></strong>
                        </p>
                        <p>Where f<sub>s</sub> is sampling frequency and f<sub>max</sub> is the highest frequency in the signal.</p>
                    </div>
                    
                    <p><strong>Research Challenge:</strong> Why do some studios use 96kHz or 192kHz sampling rates when humans can't hear above 20kHz?</p>
                    <textarea id="extensionQ1" rows="6" placeholder="Research and explain at least 3 reasons..."></textarea>
                    <button onclick="checkExtension('Q1')">Submit Research</button>
                    <div id="extensionQ1Feedback"></div>
                </div>

                <div class="task">
                    <h3>🎛️ Audio Codec Comparison Lab</h3>
                    <p>Research and compare different audio formats:</p>
                    
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <thead>
                                <tr style="background: var(--primary); color: white;">
                                    <th style="padding: 15px; border: 1px solid #ddd;">Format</th>
                                    <th style="padding: 15px; border: 1px solid #ddd;">Type</th>
                                    <th style="padding: 15px; border: 1px solid #ddd;">Compression Ratio</th>
                                    <th style="padding: 15px; border: 1px solid #ddd;">Your Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 15px; border: 1px solid #ddd;">WAV</td>
                                    <td style="padding: 15px; border: 1px solid #ddd;">Uncompressed</td>
                                    <td style="padding: 15px; border: 1px solid #ddd;">1:1</td>
                                    <td style="padding: 15px; border: 1px solid #ddd;">
                                        <input type="text" placeholder="Add notes..." style="width: 100%;">
                                    </td>
                                </tr>
                                <tr style="background: var(--light);">
                                    <td style="padding: 15px; border: 1px solid #ddd;">FLAC</td>
                                    <td style="padding: 15px; border: 1px solid #ddd;">
                                        <select id="flacType">
                                            <option>Choose...</option>
                                            <option>Lossless</option>
                                            <option>Lossy</option>
                                        </select>
                                    </td>
                                    <td style="padding: 15px; border: 1px solid #ddd;">
                                        <input type="text" id="flacRatio" placeholder="?:1" style="width: 80px;">
                                    </td>
                                    <td style="padding: 15px; border: 1px solid #ddd;">
                                        <input type="text" placeholder="Add notes..." style="width: 100%;">
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 15px; border: 1px solid #ddd;">MP3</td>
                                    <td style="padding: 15px; border: 1px solid #ddd;">
                                        <select id="mp3Type">
                                            <option>Choose...</option>
                                            <option>Lossless</option>
                                            <option>Lossy</option>
                                        </select>
                                    </td>
                                    <td style="padding: 15px; border: 1px solid #ddd;">
                                        <input type="text" id="mp3Ratio" placeholder="?:1" style="width: 80px;">
                                    </td>
                                    <td style="padding: 15px; border: 1px solid #ddd;">
                                        <input type="text" placeholder="Add notes..." style="width: 100%;">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <button onclick="checkCodecTable()">Check Answers</button>
                    <div id="codecTableFeedback"></div>
                </div>

                <div class="task">
                    <h3>💻 Programming Challenge: Simple Audio Processor</h3>
                    <p>Complete this pseudocode for a basic audio downsampler:</p>
                    
                    <div class="code-editor">
                        <pre style="color: #d4d4d4;">
FUNCTION downsample(audioData, originalRate, targetRate)
    ratio = <input type="text" id="code1" placeholder="?" style="width: 150px; background: #2d2d2d; color: #d4d4d4; border: 1px solid #555;">
    newLength = LENGTH(audioData) / ratio
    newAudio = ARRAY[newLength]
    
    FOR i = 0 TO newLength - 1
        sourceIndex = <input type="text" id="code2" placeholder="?" style="width: 100px; background: #2d2d2d; color: #d4d4d4; border: 1px solid #555;">
        newAudio[i] = audioData[sourceIndex]
    END FOR
    
    RETURN newAudio
END FUNCTION</pre>
                    </div>
                    
                    <button onclick="checkPseudocode()">Check Code</button>
                    <div id="pseudocodeFeedback"></div>
                </div>

                <div class="task">
                    <h3>🌟 Future Technologies</h3>
                    <p>Explore emerging audio technologies:</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div style="background: rgba(102, 126, 234, 0.1); padding: 20px; border-radius: 15px; text-align: center;">
                            <div style="font-size: 48px;">🎧</div>
                            <h4>Spatial Audio</h4>
                            <p>3D sound positioning for immersive experiences</p>
                        </div>
                        <div style="background: rgba(118, 75, 162, 0.1); padding: 20px; border-radius: 15px; text-align: center;">
                            <div style="font-size: 48px;">🤖</div>
                            <h4>AI Enhancement</h4>
                            <p>Machine learning for audio restoration and improvement</p>
                        </div>
                        <div style="background: rgba(245, 87, 108, 0.1); padding: 20px; border-radius: 15px; text-align: center;">
                            <div style="font-size: 48px;">⚛️</div>
                            <h4>Quantum Audio</h4>
                            <p>Theoretical quantum computing applications in audio</p>
                        </div>
                    </div>
                    
                    <p><strong>Creative Task:</strong> Design your own audio format for the year 2050. What features would it have?</p>
                    <textarea id="futureFormat" rows="6" placeholder="Describe your innovative audio format..."></textarea>
                    <button onclick="checkExtension('future')">Submit Design</button>
                    <div id="futureFeedback"></div>
                </div>
            </div>

            <!-- Section 8: Summary and Assessment -->
            <div class="section" id="section8">
                <h2>Final Challenge: Master Assessment 🏆</h2>
                <button class="btn-error" style="float: right;" onclick="resetSection(8)">🔄 Reset Quiz</button>
                
                <div class="task">
                    <h3>📚 Key Concepts Summary</h3>
                    <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(33, 150, 243, 0.1)); padding: 25px; border-radius: 20px; margin: 20px 0;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div style="text-align: center;">
                                <div style="font-size: 36px;">📊</div>
                                <h4>Sampling Rate</h4>
                                <p>Frequency of measurements<br>
                                Higher = Better quality</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 36px;">🎨</div>
                                <h4>Bit Depth</h4>
                                <p>Precision per sample<br>
                                More bits = Better range</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 36px;">🔄</div>
                                <h4>A/D Conversion</h4>
                                <p>Analog → Digital<br>
                                Measure → Quantize → Store</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 36px;">🎧</div>
                                <h4>Perceptual Shaping</h4>
                                <p>Remove inaudible sounds<br>
                                Smaller files, same quality</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="task">
                    <h3>🎯 Final Assessment Quiz</h3>
                    <p>Test your mastery with these comprehensive questions:</p>
                    
                    <div id="finalQuiz">
                        <!-- Question 1 -->
                        <div class="quiz-container">
                            <h4>1. What is the minimum sampling rate needed to accurately capture a 15 kHz signal?</h4>
                            <div class="quiz-option" onclick="selectQuizAnswer('q1', 'a')">
                                a) 15,000 Hz
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q1', 'b')">
                                b) 22,050 Hz
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q1', 'c')">
                                c) 30,000 Hz
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q1', 'd')">
                                d) 44,100 Hz
                            </div>
                        </div>

                        <!-- Question 2 -->
                        <div class="quiz-container">
                            <h4>2. How many different amplitude levels can 16-bit audio represent?</h4>
                            <div class="quiz-option" onclick="selectQuizAnswer('q2', 'a')">
                                a) 16
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q2', 'b')">
                                b) 256
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q2', 'c')">
                                c) 65,536
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q2', 'd')">
                                d) 16,777,216
                            </div>
                        </div>

                        <!-- Question 3 -->
                        <div class="quiz-container">
                            <h4>3. Which statement about perceptual music shaping is FALSE?</h4>
                            <div class="quiz-option" onclick="selectQuizAnswer('q3', 'a')">
                                a) It removes frequencies humans can't hear
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q3', 'b')">
                                b) It always reduces audio quality significantly
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q3', 'c')">
                                c) It can achieve 10:1 compression ratios
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q3', 'd')">
                                d) It uses psychoacoustic principles
                            </div>
                        </div>

                        <!-- Question 4 -->
                        <div class="quiz-container">
                            <h4>4. In the analog-to-digital conversion process, what happens during quantization?</h4>
                            <div class="quiz-option" onclick="selectQuizAnswer('q4', 'a')">
                                a) The wave is measured at time intervals
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q4', 'b')">
                                b) Amplitude values are rounded to nearest available level
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q4', 'c')">
                                c) Binary values are stored in a file
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q4', 'd')">
                                d) Frequencies are filtered out
                            </div>
                        </div>

                        <!-- Question 5 -->
                        <div class="quiz-container">
                            <h4>5. Calculate: A mono audio file has 44,100 Hz sampling rate, 16-bit depth, and is 30 seconds long. What's its size?</h4>
                            <div class="quiz-option" onclick="selectQuizAnswer('q5', 'a')">
                                a) 1.32 MB
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q5', 'b')">
                                b) 2.65 MB
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q5', 'c')">
                                c) 5.29 MB
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q5', 'd')">
                                d) 10.58 MB
                            </div>
                        </div>

                        <!-- Question 6 -->
                        <div class="quiz-container">
                            <h4>6. Why is 44,100 Hz used for CD audio?</h4>
                            <div class="quiz-option" onclick="selectQuizAnswer('q6', 'a')">
                                a) It's exactly double 22,050 Hz
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q6', 'b')">
                                b) It can capture frequencies up to 22,050 Hz
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q6', 'c')">
                                c) It's the maximum computers can process
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q6', 'd')">
                                d) It matches video frame rates
                            </div>
                        </div>

                        <!-- Question 7 -->
                        <div class="quiz-container">
                            <h4>7. Which frequency would be removed by perceptual music shaping?</h4>
                            <div class="quiz-option" onclick="selectQuizAnswer('q7', 'a')">
                                a) 440 Hz (musical note A)
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q7', 'b')">
                                b) 1,000 Hz (human speech)
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q7', 'c')">
                                c) 10,000 Hz (cymbal crash)
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q7', 'd')">
                                d) 25,000 Hz (ultrasonic)
                            </div>
                        </div>

                        <!-- Question 8 -->
                        <div class="quiz-container">
                            <h4>8. What is the relationship between sampling rate and file size?</h4>
                            <div class="quiz-option" onclick="selectQuizAnswer('q8', 'a')">
                                a) Inversely proportional
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q8', 'b')">
                                b) Directly proportional
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q8', 'c')">
                                c) No relationship
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q8', 'd')">
                                d) Exponentially related
                            </div>
                        </div>

                        <!-- Question 9 -->
                        <div class="quiz-container">
                            <h4>9. Which audio format uses perceptual coding?</h4>
                            <div class="quiz-option" onclick="selectQuizAnswer('q9', 'a')">
                                a) WAV
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q9', 'b')">
                                b) FLAC
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q9', 'c')">
                                c) MP3
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q9', 'd')">
                                d) AIFF
                            </div>
                        </div>

                        <!-- Question 10 -->
                        <div class="quiz-container">
                            <h4>10. What causes aliasing in digital audio?</h4>
                            <div class="quiz-option" onclick="selectQuizAnswer('q10', 'a')">
                                a) Sampling rate too high
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q10', 'b')">
                                b) Sampling rate too low for frequency content
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q10', 'c')">
                                c) Bit depth too low
                            </div>
                            <div class="quiz-option" onclick="selectQuizAnswer('q10', 'd')">
                                d) File compression
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <button class="btn-success" style="font-size: 18px; padding: 15px 40px;" onclick="checkFinalQuiz()">
                            Submit Final Quiz
                        </button>
                    </div>
                    <div id="finalQuizFeedback"></div>
                </div>

                <div class="task">
                    <h3>🏆 Your Achievement Summary</h3>
                    <div id="achievementSummary" style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(76, 175, 80, 0.1)); padding: 30px; border-radius: 20px;">
                        <div class="loading-spinner"></div>
                        <p>Calculating your achievements...</p>
                    </div>
                </div>

                <div class="task">
                    <h3>📹 Additional Learning Resources</h3>
                    <div style="background: var(--light); padding: 25px; border-radius: 15px;">
                        <h4>Recommended Videos:</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 10px;">
                                <div style="font-size: 48px;">📺</div>
                                <p><strong>Digital Audio Fundamentals</strong></p>
                                <small>[Video placeholder - 12 mins]</small>
                            </div>
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 10px;">
                                <div style="font-size: 48px;">📺</div>
                                <p><strong>Sampling Rate Explained</strong></p>
                                <small>[Video placeholder - 8 mins]</small>
                            </div>
                            <div style="text-align: center; padding: 20px; background: white; border-radius: 10px;">
                                <div style="font-size: 48px;">📺</div>
                                <p><strong>MP3 Compression Decoded</strong></p>
                                <small>[Video placeholder - 15 mins]</small>
                            </div>
                        </div>
                        
                        <h4>Further Reading:</h4>
                        <ul style="margin-left: 20px;">
                            <li>📚 "The Science of Sound" - Chapter on Digital Audio</li>
                            <li>📱 Interactive Audio Apps: Audacity, GarageBand</li>
                            <li>🌐 Online Tools: Audio Spectrum Analyzers</li>
                        </ul>
                        
                        <p style="margin-top: 20px; text-align: center;">
                            <em>Ask your teacher for specific links and resources!</em>
                        </p>
                    </div>
                </div>

                <div class="task">
                    <h3>⚠️ Common Mistakes to Avoid</h3>
                    <div style="background: rgba(244, 67, 54, 0.05); border: 2px solid var(--error); padding: 25px; border-radius: 15px;">
                        <div style="display: grid; gap: 15px;">
                            <div style="display: flex; align-items: start; gap: 15px;">
                                <span style="font-size: 24px;">❌</span>
                                <div>
                                    <strong>Confusing Hz (frequency) with bits (data)</strong><br>
                                    <small>Hz measures how often we sample; bits measure precision of each sample</small>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 15px;">
                                <span style="font-size: 24px;">❌</span>
                                <div>
                                    <strong>Thinking higher numbers always = better</strong><br>
                                    <small>96kHz sampling might be overkill for speech recording!</small>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 15px;">
                                <span style="font-size: 24px;">❌</span>
                                <div>
                                    <strong>Forgetting to convert bits to bytes</strong><br>
                                    <small>Remember: 8 bits = 1 byte when calculating file sizes</small>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 15px;">
                                <span style="font-size: 24px;">❌</span>
                                <div>
                                    <strong>Not accounting for stereo in calculations</strong><br>
                                    <small>Stereo = 2 channels = double the data!</small>
                                </div>
                            </div>
                            <div style="display: flex; align-items: start; gap: 15px;">
                                <span style="font-size: 24px;">❌</span>
                                <div>
                                    <strong>Misunderstanding perceptual shaping</strong><br>
                                    <small>It removes inaudible sounds, not just "bad quality"</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="task">
                    <h3>🎊 Congratulations!</h3>
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 72px; animation: pulse 2s infinite;">🎉</div>
                        <h3>You've completed the Digital Sound Sampling journey!</h3>
                        <p style="margin: 20px 0;">Share your achievements with your teacher and classmates!</p>
                        <button onclick="generateCertificate()" class="btn-success">
                            Generate Completion Certificate
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentSection = 0;
        let userXP = 0;
        let userLevel = 1;
        let achievements = new Set();
        let completedTasks = new Set();
        let quizAnswers = {};
        let selectedDepth = null;
        let selectedChar = null;
        let drawingMode = 'wave';
        let drawColor = '#667eea';
        let isDrawing = false;
        let animationRunning = false;
        let animationStep = 0;
        let memoryGameCards = [];
        let memoryGameFlipped = [];
        let memoryGameMoves = 0;
        let waveRiderScore = 0;
        let bitDepthGameRound = 0;
        let bitDepthGameScore = 0;
        let knowledgeScore = 0;
        let soundEffectsEnabled = true;
        let animationsEnabled = true;

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeWorksheet();
            initMemoryGame();
            setupDragAndDrop();
            setupCanvases();
            setupKeyboardShortcuts();
            preventPaste();
            initializeAccessibility();
            startBackgroundAnimation();
            checkDailyStreak();
        });

        // Core Functions
        function initializeWorksheet() {
            updateXPDisplay();
            updateProgressBar();
            drawStarterWaves();
            updateSamplingRate(8000);
            updateBitDepth(8);
            updateFrequencyDisplay();
            calculateFileSize();
            
            // Load saved progress
            loadProgress();
            
            // Set up auto-save
            setInterval(saveProgress, 30000);
            
            // Initialize tooltips
            initializeTooltips();
        }

        // Navigation
        function showSection(sectionNum) {
            if (sectionNum < 0 || sectionNum > 8) return;
            
            const sections = document.querySelectorAll('.section');
            const navBtns = document.querySelectorAll('.nav-btn');
            
            // Fade out current section
            if (animationsEnabled) {
                sections[currentSection].style.opacity = '0';
                setTimeout(() => {
                    sections.forEach(section => section.classList.remove('active'));
                    navBtns.forEach(btn => btn.classList.remove('active'));
                    
                    document.getElementById('section' + sectionNum).classList.add('active');
                    navBtns[sectionNum].classList.add('active');
                    
                    // Fade in new section
                    sections[sectionNum].style.opacity = '1';
                }, 300);
            } else {
                sections.forEach(section => section.classList.remove('active'));
                navBtns.forEach(btn => btn.classList.remove('active'));
                
                document.getElementById('section' + sectionNum).classList.add('active');
                navBtns[sectionNum].classList.add('active');
            }
            
            currentSection = sectionNum;
            updateProgressBar();
            
            // Track navigation
            if (sectionNum > 0 && !completedTasks.has('nav-' + sectionNum)) {
                addXP(5, 'Explored new section');
                completedTasks.add('nav-' + sectionNum);
            }
            
            // Special section events
            if (sectionNum === 4) {
                resetSamplingAnimation();
            }
            
            // Update URL hash for bookmarking
            window.location.hash = 'section' + sectionNum;
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateProgressBar() {
            const progress = (currentSection / 8) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            // Update nav buttons to show completion
            const navBtns = document.querySelectorAll('.nav-btn');
            completedTasks.forEach(task => {
                if (task.startsWith('section-complete-')) {
                    const sectionNum = parseInt(task.split('-')[2]);
                    if (navBtns[sectionNum]) {
                        navBtns[sectionNum].classList.add('completed');
                    }
                }
            });
        }

        function startLesson() {
            showSection(1);
            unlockAchievement('Journey Begun', 'Started your digital sound adventure!', '🚀');
            playSound('start');
        }

        // XP and Achievement System
        function addXP(amount, reason) {
            const oldLevel = userLevel;
            userXP += amount;
            updateXPDisplay();
            checkLevelUp();
            
            // Show XP popup with particles
            showXPPopup(amount, reason);
            
            // Track total XP milestones
            if (userXP >= 100 && !achievements.has('Century')) {
                unlockAchievement('Century', 'Earned 100 XP!', '💯');
            }
            if (userXP >= 500 && !achievements.has('Half K')) {
                unlockAchievement('Half K', 'Earned 500 XP!', '🌟');
            }
            if (userXP >= 1000 && !achievements.has('XP Master')) {
                unlockAchievement('XP Master', 'Earned 1000 XP!', '👑');
            }
        }

        function updateXPDisplay() {
            const xpNeeded = userLevel * 100;
            const levelProgress = userXP - ((userLevel - 1) * 100);
            const xpPercentage = (levelProgress / 100) * 100;
            
            document.getElementById('xp').textContent = userXP;
            document.getElementById('xpNeeded').textContent = xpNeeded;
            document.getElementById('xpBar').style.width = xpPercentage + '%';
            document.querySelector('.xp-text').textContent = Math.floor(xpPercentage) + '%';
            document.getElementById('levelBadge').textContent = userLevel;
        }

        function checkLevelUp() {
            const newLevel = Math.min(Math.floor(userXP / 100) + 1, 5);
            if (newLevel > userLevel) {
                userLevel = newLevel;
                document.getElementById('levelBadge').textContent = userLevel;
                unlockAchievement('Level ' + userLevel + '!', 'Reached Level ' + userLevel, '⭐');
                
                // Update badges
                document.getElementById('badge' + userLevel).classList.add('earned');
                
                // Special effects for max level
                if (userLevel === 5) {
                    createConfetti();
                    unlockAchievement('Master of Sound', 'Reached maximum level!', '👑');
                }
                
                playSound('levelup');
            }
        }

        function showXPPopup(amount, reason) {
            const popup = document.createElement('div');
            popup.className = 'achievement-popup show';
            popup.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
            popup.innerHTML = `
                <div style="font-size: 36px; text-align: center;">+${amount} XP</div>
                <p>${reason}</p>
            `;
            document.body.appendChild(popup);
            
            // Create particles at popup location
            const rect = popup.getBoundingClientRect();
            createParticles(rect.left + rect.width / 2, rect.top + rect.height / 2);
            
            setTimeout(() => {
                popup.classList.remove('show');
                setTimeout(() => popup.remove(), 500);
            }, 2000);
        }

        function unlockAchievement(title, description, icon = '🏆') {
            if (!achievements.has(title)) {
                achievements.add(title);
                document.getElementById('achievementCount').textContent = achievements.size;
                
                const popup = document.getElementById('achievementPopup');
                document.getElementById('achievementIcon').textContent = icon;
                document.getElementById('achievementText').textContent = description;
                document.getElementById('achievementXP').textContent = '50';
                popup.classList.add('show');
                
                playSound('achievement');
                
                setTimeout(() => {
                    popup.classList.remove('show');
                }, 4000);
                
                addXP(50, 'Achievement: ' + title);
                
                // Update badges based on achievements
                updateBadges();
            }
        }

        function updateBadges() {
            const badgeCount = Math.min(achievements.size / 5, 5);
            for (let i = 1; i <= badgeCount; i++) {
                document.getElementById('badge' + i).classList.add('earned');
            }
        }

        // Sound Functions
        function playSound(type) {
            if (!soundEffectsEnabled) return;
            
            // In a real implementation, these would play actual sounds
            console.log('Playing sound:', type);
            
            // Create visual feedback for sound
            const soundIndicator = document.createElement('div');
            soundIndicator.style.cssText = `
                position: fixed;
                bottom: 100px;
                right: 30px;
                background: rgba(102, 126, 234, 0.8);
                color: white;
                padding: 10px 20px;
                border-radius: 20px;
                font-size: 14px;
                z-index: 1000;
                animation: fadeInOut 1s ease;
            `;
            soundIndicator.textContent = '🔊 ' + type;
            document.body.appendChild(soundIndicator);
            
            setTimeout(() => soundIndicator.remove(), 1000);
        }

        // Starter Section Functions
        function drawStarterWaves() {
            drawWaveform('waveformA', 8000, '#667eea');
            drawWaveform('waveformB', 44100, '#764ba2');
        }

        function drawWaveform(canvasId, sampleRate, color) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw grid
            ctx.strokeStyle = '#eee';
            ctx.lineWidth = 1;
            for (let i = 0; i < 10; i++) {
                ctx.beginPath();
                ctx.moveTo(i * width / 10, 0);
                ctx.lineTo(i * width / 10, height);
                ctx.stroke();
            }
            
            // Draw waveform
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            const samples = Math.floor(width * sampleRate / 44100);
            for (let x = 0; x < width; x++) {
                const y = height/2 + Math.sin(x * 0.05) * height/3 * Math.sin(x * 0.002);
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Draw sample points
            ctx.fillStyle = color;
            const sampleInterval = width / (samples / 10);
            for (let x = 0; x < width; x += sampleInterval) {
                const y = height/2 + Math.sin(x * 0.05) * height/3 * Math.sin(x * 0.002);
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Label
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.fillText('Samples: ' + Math.floor(samples/10), 5, 15);
        }

        function checkStarterAnswer(answer) {
            const feedback = document.getElementById('starterFeedback');
            
            if (answer === 'B') {
                feedback.innerHTML = '<div class="feedback correct">🎉 Excellent! Sample B has a much higher sampling rate (44,100 Hz vs 8,000 Hz), resulting in better quality with more detail captured.</div>';
                if (!completedTasks.has('starter-quiz')) {
                    addXP(25, 'Correctly identified higher quality audio');
                    completedTasks.add('starter-quiz');
                }
            } else {
                feedback.innerHTML = '<div class="feedback incorrect">Not quite. Look at the sampling rates shown below each waveform. Sample B (44,100 Hz) has over 5x more samples per second than Sample A (8,000 Hz)!</div>';
            }
        }

        function checkKnowledgeItem(item, answer) {
            const correct = {
                1: true,  // Digital devices understand binary
                2: true,  // Sound in nature is analog
                3: false, // Computers cannot store infinite detail
                4: true   // MP3s are smaller than WAVs
            };
            
            const feedback = document.getElementById('knowledge' + item);
            if (answer === correct[item]) {
                feedback.innerHTML = ' ✅';
                feedback.style.color = '#4caf50';
                knowledgeScore++;
            } else {
                feedback.innerHTML = ' ❌';
                feedback.style.color = '#f44336';
            }
            
            // Check if all answered
            if (document.querySelectorAll('[id^="knowledge"]:not(:empty)').length === 4) {
                const summary = document.getElementById('knowledgeSummary');
                if (knowledgeScore === 4) {
                    summary.innerHTML = '<div class="feedback correct">Perfect! You have excellent prior knowledge. Let\'s build on this foundation!</div>';
                    if (!completedTasks.has('knowledge-check')) {
                        addXP(20, 'Demonstrated strong prior knowledge');
                        completedTasks.add('knowledge-check');
                    }
                } else if (knowledgeScore >= 2) {
                    summary.innerHTML = '<div class="feedback correct">Good! You got ' + knowledgeScore + '/4 correct. This lesson will strengthen your understanding.</div>';
                    if (!completedTasks.has('knowledge-check')) {
                        addXP(10 + knowledgeScore * 2, 'Completed knowledge check');
                        completedTasks.add('knowledge-check');
                    }
                } else {
                    summary.innerHTML = '<div class="feedback incorrect">You got ' + knowledgeScore + '/4. Don\'t worry! This lesson will teach you everything you need to know.</div>';
                }
            }
        }

        // Memory Game
        function initMemoryGame() {
            const gameBoard = document.getElementById('memoryGame');
            if (!gameBoard) return;
            
            const symbols = ['🎵', '🎶', '🎼', '🎹', '🎸', '🎺', '🎷', '🥁'];
            memoryGameCards = [...symbols, ...symbols].sort(() => Math.random() - 0.5);
            
            gameBoard.innerHTML = '';
            memoryGameCards.forEach((symbol, index) => {
                const tile = document.createElement('div');
                tile.className = 'game-tile';
                tile.dataset.index = index;
                tile.dataset.symbol = symbol;
                tile.onclick = () => flipMemoryCard(index);
                gameBoard.appendChild(tile);
            });
            
            memoryGameFlipped = [];
            memoryGameMoves = 0;
            document.getElementById('moveCount').textContent = '0';
        }

        function flipMemoryCard(index) {
            if (memoryGameFlipped.length === 2) return;
            if (memoryGameFlipped.includes(index)) return;
            
            const tile = document.querySelector(`[data-index="${index}"]`);
            tile.textContent = tile.dataset.symbol;
            tile.classList.add('flipped');
            memoryGameFlipped.push(index);
            
            if (memoryGameFlipped.length === 2) {
                memoryGameMoves++;
                document.getElementById('moveCount').textContent = memoryGameMoves;
                
                setTimeout(() => {
                    checkMemoryMatch();
                }, 1000);
            }
        }

        function checkMemoryMatch() {
            const [first, second] = memoryGameFlipped;
            const firstTile = document.querySelector(`[data-index="${first}"]`);
            const secondTile = document.querySelector(`[data-index="${second}"]`);
            
            if (firstTile.dataset.symbol === secondTile.dataset.symbol) {
                firstTile.classList.add('matched');
                secondTile.classList.add('matched');
                playSound('match');
                
                // Check if game complete
                if (document.querySelectorAll('.game-tile.matched').length === 16) {
                    const best = localStorage.getItem('memoryBest') || '-';
                    if (best === '-' || memoryGameMoves < parseInt(best)) {
                        localStorage.setItem('memoryBest', memoryGameMoves);
                        document.getElementById('bestScore').textContent = memoryGameMoves;
                    }
                    
                    if (!completedTasks.has('memory-game')) {
                        addXP(30, 'Completed memory game');
                        completedTasks.add('memory-game');
                        unlockAchievement('Memory Master', 'Completed the sound wave memory game!', '🧠');
                    }
                }
            } else {
                firstTile.textContent = '';
                firstTile.classList.remove('flipped');
                secondTile.textContent = '';
                secondTile.classList.remove('flipped');
            }
            
            memoryGameFlipped = [];
        }

        // Wave Rider Game
        function startWaveRider() {
            const canvas = document.getElementById('waveRiderCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let playerY = canvas.height / 2;
            let targetY = canvas.height / 2;
            waveRiderScore = 0;
            
            // Game loop
            const gameLoop = setInterval(() => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw wave
                ctx.strokeStyle = '#667eea';
                ctx.lineWidth = 3;
                ctx.beginPath();
                for (let x = 0; x < canvas.width; x++) {
                    const y = canvas.height/2 + Math.sin((x + waveRiderScore) * 0.02) * 100;
                    if (x === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
                
                // Update player position
                playerY += (targetY - playerY) * 0.1;
                
                // Draw player
                ctx.fillStyle = '#764ba2';
                ctx.beginPath();
                ctx.arc(100, playerY, 10, 0, Math.PI * 2);
                ctx.fill();
                
                // Check collision
                const waveY = canvas.height/2 + Math.sin((100 + waveRiderScore) * 0.02) * 100;
                if (Math.abs(playerY - waveY) < 20) {
                    waveRiderScore++;
                    document.getElementById('waveRiderScore').textContent = waveRiderScore;
                } else {
                    clearInterval(gameLoop);
                    endWaveRider();
                }
            }, 50);
            
            // Controls
            canvas.onmousemove = (e) => {
                const rect = canvas.getBoundingClientRect();
                targetY = e.clientY - rect.top;
            };
            
            canvas.ontouchmove = (e) => {
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                targetY = e.touches[0].clientY - rect.top;
            };
        }

        function endWaveRider() {
            const highScore = parseInt(localStorage.getItem('waveRiderHigh') || '0');
            if (waveRiderScore > highScore) {
                localStorage.setItem('waveRiderHigh', waveRiderScore);
                document.getElementById('waveRiderHighScore').textContent = waveRiderScore;
            }
            
            if (waveRiderScore > 50 && !completedTasks.has('wave-rider')) {
                addXP(25, 'High score in Wave Rider!');
                completedTasks.add('wave-rider');
            }
        }

        // Sampling Rate Functions
        function updateSamplingRate(value) {
            document.getElementById('samplingRateValue').textContent = value + ' Hz';
            
            // Update file size estimate
            const minutes = 1;
            const bitDepth = 16;
            const channels = 2;
            const bytesPerSecond = value * (bitDepth / 8) * channels;
            const mbPerMinute = (bytesPerSecond * 60) / 1000000;
            document.getElementById('fileSize').textContent = '~' + mbPerMinute.toFixed(1) + ' MB/min';
            
            // Update quality rating
            let quality = '★☆☆☆☆';
            let useCase = 'Low quality';
            
            if (value >= 44100) {
                quality = '★★★★★';
                useCase = 'CD Quality';
            } else if (value >= 22050) {
                quality = '★★★★☆';
                useCase = 'FM Radio';
            } else if (value >= 16000) {
                quality = '★★★☆☆';
                useCase = 'Voice Recording';
            } else if (value >= 8000) {
                quality = '★★☆☆☆';
                useCase = 'Telephone';
            }
            
            document.getElementById('qualityRating').textContent = quality;
            document.getElementById('useCase').textContent = useCase;
            
            // Draw visualization
            drawSamplingVisualization(value);
        }

        function drawSamplingVisualization(sampleRate) {
            const svg = document.querySelector('#samplingWaveform svg');
            const width = 600;
            const height = 200;
            
            // Generate wave path
            let originalPath = 'M 0,' + (height/2);
            let sampledPath = 'M 0,' + (height/2);
            
            for (let x = 0; x < width; x += 2) {
                const y = height/2 + Math.sin(x * 0.02) * 60 * Math.sin(x * 0.001);
                originalPath += ' L ' + x + ',' + y;
            }
            
            // Sample points
            const sampleInterval = width / (sampleRate / 1000);
            let samplePoints = '';
            let lastX = 0, lastY = height/2;
            
            for (let x = 0; x < width; x += sampleInterval) {
                const y = height/2 + Math.sin(x * 0.02) * 60 * Math.sin(x * 0.001);
                sampledPath += ' L ' + lastX + ',' + lastY + ' L ' + x + ',' + y;
                samplePoints += `<circle cx="${x}" cy="${y}" r="5" />`;
                lastX = x;
                lastY = y;
            }
            
            document.getElementById('originalWave').setAttribute('d', originalPath);
            document.getElementById('sampledWave').setAttribute('d', sampledPath);
            document.getElementById('samplePoints').innerHTML = samplePoints;
        }

        function playSampledSound() {
            playSound('sample');
            // In real implementation, would play audio at current sampling rate
        }

        function compareSamples() {
            // Show comparison visualization
            if (!completedTasks.has('compare-samples')) {
                addXP(15, 'Compared different sampling rates');
                completedTasks.add('compare-samples');
            }
        }

        // Drag and Drop
        function setupDragAndDrop() {
            const draggables = document.querySelectorAll('.draggable');
            const dropZones = document.querySelectorAll('.drop-zone');
            
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', handleDragStart);
                draggable.addEventListener('dragend', handleDragEnd);
                
                // Touch support
                draggable.addEventListener('touchstart', handleTouchStart, {passive: false});
                draggable.addEventListener('touchmove', handleTouchMove, {passive: false});
                draggable.addEventListener('touchend', handleTouchEnd);
            });
            
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('dragleave', handleDragLeave);
            });
        }

        let currentDragging = null;
        let touchItem = null;

        function handleDragStart(e) {
            currentDragging = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.innerHTML);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            currentDragging = null;
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            e.target.classList.add('drag-over');
            return false;
        }

        function handleDragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            e.preventDefault();
            
            e.target.classList.remove('drag-over');
            
            if (currentDragging && e.target.classList.contains('drop-zone')) {
                e.target.innerHTML = currentDragging.innerHTML;
                e.target.classList.add('filled');
                e.target.dataset.dropped = currentDragging.dataset.value || 
                                         currentDragging.dataset.order || 
                                         currentDragging.dataset.audible;
                currentDragging.style.opacity = '0.5';
                currentDragging.draggable = false;
                playSound('drop');
            }
            
            return false;
        }

        function handleTouchStart(e) {
            touchItem = e.target;
            const touch = e.touches[0];
            touchItem.style.position = 'fixed';
            touchItem.style.zIndex = '1000';
            touchItem.style.pointerEvents = 'none';
            touchItem.initialX = touchItem.offsetLeft;
            touchItem.initialY = touchItem.offsetTop;
        }

        function handleTouchMove(e) {
            if (!touchItem) return;
            e.preventDefault();
            
            const touch = e.touches[0];
            touchItem.style.left = (touch.pageX - 50) + 'px';
            touchItem.style.top = (touch.pageY - 25) + 'px';
            
            // Highlight drop zone under finger
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over');
            });
            if (elementBelow && elementBelow.classList.contains('drop-zone')) {
                elementBelow.classList.add('drag-over');
            }
        }

        function handleTouchEnd(e) {
            if (!touchItem) return;
            
            const touch = e.changedTouches[0];
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            
            if (elementBelow && elementBelow.classList.contains('drop-zone')) {
                elementBelow.innerHTML = touchItem.innerHTML;
                elementBelow.classList.add('filled');
                elementBelow.classList.remove('drag-over');
                elementBelow.dataset.dropped = touchItem.dataset.value || 
                                             touchItem.dataset.order || 
                                             touchItem.dataset.audible;
                touchItem.style.opacity = '0.5';
                playSound('drop');
            }
            
            // Reset position
            touchItem.style.position = '';
            touchItem.style.zIndex = '';
            touchItem.style.pointerEvents = '';
            touchItem.style.left = '';
            touchItem.style.top = '';
            touchItem = null;
        }

        function checkDragDrop(type) {
            const dropZones = document.querySelectorAll('.drop-zone[data-answer]');
            let correct = 0;
            let total = 0;
            
            dropZones.forEach(zone => {
                total++;
                if (zone.dataset.dropped === zone.dataset.answer) {
                    correct++;
                    zone.classList.remove('incorrect');
                    zone.classList.add('filled');
                } else if (zone.dataset.dropped) {
                    zone.classList.add('incorrect');
                }
            });
            
            const feedback = document.getElementById(type + 'DragFeedback');
            if (correct === total) {
                feedback.innerHTML = '<div class="feedback correct">🎉 Perfect! All matches are correct. You understand the relationship between sampling rates and their applications!</div>';
                if (!completedTasks.has(type + '-drag')) {
                    addXP(30, 'Completed drag and drop perfectly');
                    completedTasks.add(type + '-drag');
                    playSound('success');
                }
            } else {
                feedback.innerHTML = '<div class="feedback incorrect">Not quite right. ' + correct + '/' + total + ' correct. Remember: Higher rates for music, lower rates for speech!</div>';
                playSound('error');
            }
        }

        function showMatchingHints() {
            alert('Hint: CD quality uses 44,100 Hz because it can capture up to 22,050 Hz (human hearing limit). Phone quality only needs 8,000 Hz for speech.');
            if (!completedTasks.has('used-hint-matching')) {
                addXP(5, 'Used hint wisely');
                completedTasks.add('used-hint-matching');
            }
        }

        // Fill in the blanks
        function selectWord(element, word) {
            if (element.classList.contains('used')) return;
            
            // Find first empty blank
            const blanks = document.querySelectorAll('input[id^="blank"]');
            for (let blank of blanks) {
                if (blank.value === '') {
                    blank.value = word;
                    element.classList.add('used');
                    playSound('click');
                    break;
                }
            }
        }

        function clearBlanks() {
            const blanks = document.querySelectorAll('input[id^="blank"]');
            blanks.forEach(blank => {
                blank.value = '';
                blank.style.borderColor = '';
            });
            
            document.querySelectorAll('.word-option').forEach(option => {
                option.classList.remove('used');
            });
        }

        function checkFillBlanks() {
            const answers = {
                blank1: ['increase'],
                blank2: ['accurate'],
                blank3: ['increase'],
                blank4: ['Nyquist'],
                blank5: ['twice'],
                blank6: ['aliasing']
            };
            
            let correct = 0;
            const total = Object.keys(answers).length;
            
            Object.keys(answers).forEach(blankId => {
                const blank = document.getElementById(blankId);
                if (!blank) return;
                
                const userAnswer = blank.value.toLowerCase();
                
                if (answers[blankId].includes(userAnswer)) {
                    blank.style.borderColor = '#4caf50';
                    correct++;
                } else {
                    blank.style.borderColor = '#f44336';
                }
            });
            
            const feedback = document.getElementById('fillBlanksFeedback');
            if (correct === total) {
                feedback.innerHTML = '<div class="feedback correct">🎉 Excellent! All answers are correct. You understand both basic concepts and the advanced Nyquist theorem!</div>';
                if (!completedTasks.has('fillblanks-advanced')) {
                    addXP(35, 'Completed advanced fill in the blanks');
                    completedTasks.add('fillblanks-advanced');
                }
            } else {
                feedback.innerHTML = '<div class="feedback incorrect">' + correct + '/' + total + ' correct. Review the Nyquist theorem - we need 2x the highest frequency!</div>';
            }
        }

        function checkInvestigation(type) {
            const answer = document.getElementById(type + 'Investigation').value;
            const feedback = document.getElementById(type + 'InvestigationFeedback');
            
            if (answer.length < 50) {
                feedback.innerHTML = '<div class="feedback incorrect">Please provide more detail in your investigation.</div>';
                return;
            }
            
            const keywords = ['nyquist', 'human', 'hearing', '20', 'khz', 'twice', 'double', '22050', 'filter'];
            let keywordCount = 0;
            
            keywords.forEach(keyword => {
                if (answer.toLowerCase().includes(keyword)) {
                    keywordCount++;
                }
            });
            
            if (keywordCount >= 3) {
                feedback.innerHTML = '<div class="feedback correct">🔬 Excellent investigation! You correctly identified that 44.1kHz can capture up to 22.05kHz, covering the human hearing range with some headroom for filters.</div>';
                if (!completedTasks.has('investigation-' + type)) {
                    addXP(40 + keywordCount * 5, 'Thorough investigation with key insights');
                    completedTasks.add('investigation-' + type);
                }
            } else {
                feedback.innerHTML = '<div class="feedback correct">Good start! Consider the Nyquist theorem and human hearing range (20Hz-20kHz) in your answer.</div>';
                if (!completedTasks.has('investigation-' + type)) {
                    addXP(20, 'Completed investigation');
                    completedTasks.add('investigation-' + type);
                }
            }
        }

        // Bit Depth Functions
        function updateBitDepth(value) {
            document.getElementById('bitDepthValue').textContent = value + ' bits';
            
            const possibleValues = Math.pow(2, value);
            document.getElementById('possibleValues').textContent = possibleValues.toLocaleString();
            document.getElementById('dynamicRange').textContent = (value * 6) + ' dB';
            document.getElementById('bytesPerSample').textContent = Math.ceil(value / 8);
            
            drawQuantizationLevels(value);
            drawBitDepthWaveform(value);
        }

        function drawQuantizationLevels(bitDepth) {
            const canvas = document.getElementById('quantizationCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const levels = Math.pow(2, bitDepth);
            const displayLevels = Math.min(levels, 32);
            
            // Draw levels
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= displayLevels; i++) {
                const y = (i / displayLevels) * height;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
                
                // Label some levels
                if (i % Math.ceil(displayLevels / 8) === 0) {
                    ctx.fillStyle = '#666';
                    ctx.font = '10px Arial';
                    ctx.fillText(Math.floor((levels - 1) * (1 - i/displayLevels)), 5, y - 2);
                }
            }
            
            // Show bit representation
            if (bitDepth <= 4) {
                ctx.fillStyle = '#667eea';
                ctx.font = '12px monospace';
                for (let i = 0; i < levels; i++) {
                    const binary = i.toString(2).padStart(bitDepth, '0');
                    const y = ((levels - i - 0.5) / levels) * height;
                    ctx.fillText(binary, width - 40, y + 4);
                }
            }
        }

        function drawBitDepthWaveform(bitDepth) {
            const canvas = document.getElementById('bitDepthWaveCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const levels = Math.pow(2, bitDepth);
            
            // Draw original wave
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let x = 0; x < width; x++) {
                const y = height/2 + Math.sin(x * 0.03) * height/3;
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Draw quantized wave
            ctx.strokeStyle = '#764ba2';
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let x = 0; x < width; x++) {
                const originalY = height/2 + Math.sin(x * 0.03) * height/3;
                const normalized = (originalY / height);
                const quantized = Math.round(normalized * (levels - 1)) / (levels - 1);
                const y = quantized * height;
                
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Show quantization error for low bit depths
            if (bitDepth <= 4) {
                ctx.fillStyle = 'rgba(244, 67, 54, 0.3)';
                for (let x = 0; x < width; x += 5) {
                    const originalY = height/2 + Math.sin(x * 0.03) * height/3;
                    const normalized = (originalY / height);
                    const quantized = Math.round(normalized * (levels - 1)) / (levels - 1);
                    const quantizedY = quantized * height;
                    
                    ctx.fillRect(x, Math.min(originalY, quantizedY), 3, Math.abs(originalY - quantizedY));
                }
            }
        }

        function calculateFileSize() {
            const sampleRate = parseInt(document.getElementById('calcSampleRate').value);
            const bitDepth = parseInt(document.getElementById('calcBitDepth').value);
            const duration = parseInt(document.getElementById('calcDuration').value);
            const channels = parseInt(document.getElementById('calcChannels').value);
            
            const bytesPerSecond = sampleRate * (bitDepth / 8) * channels;
            const totalBytes = bytesPerSecond * duration;
            const totalMB = totalBytes / 1000000;
            
            document.getElementById('calculatedSize').textContent = totalMB.toFixed(2);
            
            // Change unit if needed
            if (totalMB < 1) {
                document.getElementById('calculatedSize').textContent = (totalBytes / 1000).toFixed(2);
                document.getElementById('sizeUnit').textContent = 'KB';
            } else if (totalMB > 1000) {
                document.getElementById('calculatedSize').textContent = (totalMB / 1000).toFixed(2);
                document.getElementById('sizeUnit').textContent = 'GB';
            } else {
                document.getElementById('sizeUnit').textContent = 'MB';
            }
            
            // Animation effect
            const sizeDisplay = document.getElementById('calculatedSize');
            sizeDisplay.style.transform = 'scale(1.2)';
            setTimeout(() => {
                sizeDisplay.style.transform = 'scale(1)';
            }, 200);
        }

        // Bit Depth Game
        function playBitDepthSample(sample) {
            playSound('sample-' + sample);
            // In real implementation, would play different bit depth samples
        }

        function guessBitDepth(guess) {
            bitDepthGameRound++;
            const correct = Math.random() > 0.5 ? 'A' : 'B'; // Randomized for demo
            
            const feedback = document.getElementById('bitDepthGameFeedback');
            if (guess === correct) {
                bitDepthGameScore++;
                feedback.innerHTML = '<div class="feedback correct">Correct! You have great ears!</div>';
            } else {
                feedback.innerHTML = '<div class="feedback incorrect">Not quite. The difference can be subtle!</div>';
            }
            
            document.getElementById('bitDepthScore').textContent = bitDepthGameScore;
            
            if (bitDepthGameRound === 5) {
                if (bitDepthGameScore >= 3 && !completedTasks.has('bitdepth-game')) {
                    addXP(25, 'Good ear for bit depth differences!');
                    completedTasks.add('bitdepth-game');
                }
                bitDepthGameRound = 0;
                bitDepthGameScore = 0;
            }
        }

        function checkCriticalThinking() {
            const answer = document.getElementById('criticalThinking').value;
            const feedback = document.getElementById('criticalThinkingFeedback');
            
            if (answer.length < 50) {
                feedback.innerHTML = '<div class="feedback incorrect">Please provide a more detailed analysis.</div>';
                return;
            }
            
            const keywords = ['file size', 'overkill', 'speech', 'music', 'necessary', 'quality', 'human', 'hearing'];
            let keywordCount = 0;
            
            keywords.forEach(keyword => {
                if (answer.toLowerCase().includes(keyword)) {
                    keywordCount++;
                }
            });
            
            if (keywordCount >= 3) {
                feedback.innerHTML = '<div class="feedback correct">💡 Excellent critical thinking! You\'re right - 32-bit is often overkill, especially for final distribution. 16-bit is sufficient for most listening, while 24-bit provides headroom for recording/mixing.</div>';
                if (!completedTasks.has('critical-thinking')) {
                    addXP(45, 'Demonstrated excellent critical thinking');
                    completedTasks.add('critical-thinking');
                    unlockAchievement('Critical Thinker', 'Analyzed real-world audio scenarios!', '🧐');
                }
            } else {
                feedback.innerHTML = '<div class="feedback correct">Good thinking! Consider that human hearing has limitations - we can\'t perceive the full dynamic range that 32-bit provides.</div>';
                if (!completedTasks.has('critical-thinking')) {
                    addXP(25, 'Completed critical thinking task');
                    completedTasks.add('critical-thinking');
                }
            }
        }

        // Sampling Process Animation
        let samplingInterval;
        const samplingSteps = [
            {
                title: 'Analog Sound Wave',
                description: 'This continuous wave represents natural sound - smooth and unbroken.',
                draw: (ctx, canvas) => {
                    drawContinuousWave(ctx, canvas, '#667eea', 3);
                }
            },
            {
                title: 'Taking Measurements',
                description: 'We measure the wave\'s height at regular time intervals.',
                draw: (ctx, canvas) => {
                    drawContinuousWave(ctx, canvas, '#ddd', 2);
                    drawSamplingLines(ctx, canvas);
                }
            },
            {
                title: 'Recording Values',
                description: 'Each measurement is recorded as a numerical value.',
                draw: (ctx, canvas) => {
                    drawContinuousWave(ctx, canvas, '#ddd', 2);
                    drawSamplingLines(ctx, canvas);
                    drawAmplitudeValues(ctx, canvas);
                }
            },
            {
                title: 'Quantization',
                description: 'Values are rounded to the nearest available level based on bit depth.',
                draw: (ctx, canvas) => {
                    drawQuantizationGrid(ctx, canvas);
                    drawQuantizedPoints(ctx, canvas);
                }
            },
            {
                title: 'Binary Conversion',
                description: 'Decimal values are converted to binary for digital storage.',
                draw: (ctx, canvas) => {
                    drawBinaryConversion(ctx, canvas);
                }
            },
            {
                title: 'Digital Storage',
                description: 'Binary data is stored in a digital audio file.',
                draw: (ctx, canvas) => {
                    drawDigitalStorage(ctx, canvas);
                }
            },
            {
                title: 'Reconstruction',
                description: 'The digital samples can be used to reconstruct an approximation of the original wave.',
                draw: (ctx, canvas) => {
                    drawContinuousWave(ctx, canvas, '#ddd', 1);
                    drawReconstructedWave(ctx, canvas);
                }
            }
        ];

        function startSamplingAnimation() {
            if (animationRunning) return;
            animationRunning = true;
            animationStep = 0;
            runSamplingAnimation();
        }

        function pauseSamplingAnimation() {
            animationRunning = false;
            clearInterval(samplingInterval);
        }

        function stepSamplingAnimation() {
            animationRunning = false;
            clearInterval(samplingInterval);
            animationStep = (animationStep + 1) % samplingSteps.length;
            drawSamplingStep();
        }

        function resetSamplingAnimation() {
            animationRunning = false;
            clearInterval(samplingInterval);
            animationStep = 0;
            drawSamplingStep();
        }

        function runSamplingAnimation() {
            drawSamplingStep();
            
            if (animationRunning) {
                samplingInterval = setInterval(() => {
                    animationStep = (animationStep + 1) % samplingSteps.length;
                    drawSamplingStep();
                    
                    if (animationStep === 0 && !completedTasks.has('watched-animation')) {
                        addXP(20, 'Watched complete sampling animation');
                        completedTasks.add('watched-animation');
                    }
                }, 3000);
            }
        }

        function drawSamplingStep() {
            const canvas = document.getElementById('samplingProcessCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const step = samplingSteps[animationStep];
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Update UI
            document.getElementById('currentStep').textContent = step.title;
            document.getElementById('stepDescription').textContent = step.description;
            document.getElementById('animationProgress').style.width = ((animationStep + 1) / samplingSteps.length * 100) + '%';
            
            // Draw current step
            step.draw(ctx, canvas);
        }

        // Animation helper functions
        function drawContinuousWave(ctx, canvas, color, width) {
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.beginPath();
            
            for (let x = 0; x < canvas.width; x++) {
                const y = canvas.height/2 + Math.sin(x * 0.02) * 100 * Math.sin(x * 0.002);
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        function drawSamplingLines(ctx, canvas) {
            ctx.strokeStyle = '#764ba2';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            
            const interval = 50;
            for (let x = 0; x < canvas.width; x += interval) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
                
                // Draw sample point
                const y = canvas.height/2 + Math.sin(x * 0.02) * 100 * Math.sin(x * 0.002);
                ctx.fillStyle = '#764ba2';
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.setLineDash([]);
        }

        function drawAmplitudeValues(ctx, canvas) {
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Arial';
            
            const interval = 50;
            for (let x = 0; x < canvas.width; x += interval) {
                const y = canvas.height/2 + Math.sin(x * 0.02) * 100 * Math.sin(x * 0.002);
                const amplitude = Math.round(((canvas.height - y) / canvas.height) * 255);
                ctx.fillText(amplitude, x - 15, y - 15);
            }
        }

        function drawQuantizationGrid(ctx, canvas) {
            const levels = 16; // 4-bit for visibility
            
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= levels; i++) {
                const y = (i / levels) * canvas.height;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Draw quantized wave
            ctx.strokeStyle = '#764ba2';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let x = 0; x < canvas.width; x++) {
                const originalY = canvas.height/2 + Math.sin(x * 0.02) * 100 * Math.sin(x * 0.002);
                const quantized = Math.round((originalY / canvas.height) * levels) / levels;
                const y = quantized * canvas.height;
                
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        function drawQuantizedPoints(ctx, canvas) {
            const interval = 50;
            const levels = 16;
            
            for (let x = 0; x < canvas.width; x += interval) {
                const originalY = canvas.height/2 + Math.sin(x * 0.02) * 100 * Math.sin(x * 0.002);
                const quantized = Math.round((originalY / canvas.height) * levels) / levels;
                const y = quantized * canvas.height;
                
                ctx.fillStyle = '#764ba2';
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function drawBinaryConversion(ctx, canvas) {
            ctx.fillStyle = '#333';
            ctx.font = '16px monospace';
            
            const values = [
                {decimal: 255, binary: '11111111'},
                {decimal: 192, binary: '11000000'},
                {decimal: 128, binary: '10000000'},
                {decimal: 64, binary: '01000000'},
                {decimal: 32, binary: '00100000'}
            ];
            
            let y = 50;
            ctx.fillText('Decimal → Binary', canvas.width/2 - 80, 30);
            
            values.forEach(val => {
                ctx.fillText(val.decimal.toString().padStart(3, ' ') + ' → ' + val.binary, canvas.width/2 - 80, y);
                y += 30;
            });
            
            // Animated conversion
            const progress = (Date.now() % 2000) / 2000;
            const currentIndex = Math.floor(progress * values.length);
            if (currentIndex < values.length) {
                ctx.fillStyle = '#667eea';
                ctx.fillRect(canvas.width/2 - 90, 35 + currentIndex * 30, 180, 25);
            }
        }

        function drawDigitalStorage(ctx, canvas) {
            // Draw file representation
            ctx.fillStyle = '#667eea';
            ctx.fillRect(canvas.width/2 - 100, 50, 200, 250);
            ctx.fillStyle = 'white';
            ctx.fillRect(canvas.width/2 - 90, 60, 180, 230);
            
            // Draw binary data
            ctx.fillStyle = '#333';
            ctx.font = '12px monospace';
            let y = 80;
            
            for (let i = 0; i < 10; i++) {
                let binary = '';
                for (let j = 0; j < 16; j++) {
                    binary += Math.random() > 0.5 ? '1' : '0';
                }
                ctx.fillText(binary, canvas.width/2 - 80, y);
                y += 20;
            }
            
            ctx.font = '18px Arial';
            ctx.fillText('audio.wav', canvas.width/2 - 40, 330);
        }

        function drawReconstructedWave(ctx, canvas) {
            const interval = 50;
            
            // Draw sample points
            const points = [];
            for (let x = 0; x < canvas.width; x += interval) {
                const y = canvas.height/2 + Math.sin(x * 0.02) * 100 * Math.sin(x * 0.002);
                points.push({x, y});
                
                ctx.fillStyle = '#764ba2';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Draw reconstructed wave (linear interpolation)
            ctx.strokeStyle = '#764ba2';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            points.forEach((point, i) => {
                if (i === 0) {
                    ctx.moveTo(point.x, point.y);
                } else {
                    ctx.lineTo(point.x, point.y);
                }
            });
            ctx.stroke();
        }

        // Sequencing
        function checkSequence() {
            const container = document.getElementById('sequenceContainer');
            const items = container.querySelectorAll('.draggable');
            let correct = 0;
            let total = items.length;
            
            items.forEach((item, index) => {
                const expectedOrder = index + 1;
                const actualOrder = parseInt(item.dataset.order);
                
                if (actualOrder === expectedOrder) {
                    correct++;
                    item.style.background = 'linear-gradient(135deg, #4caf50, #45a049)';
                } else {
                    item.style.background = 'linear-gradient(135deg, #f44336, #e53935)';
                }
            });
            
            const feedback = document.getElementById('sequenceFeedback');
            if (correct === total) {
                feedback.innerHTML = '<div class="feedback correct">🎯 Perfect sequence! You understand the complete analog-to-digital conversion process!</div>';
                if (!completedTasks.has('sequence-correct')) {
                    addXP(40, 'Correctly sequenced the sampling process');
                    completedTasks.add('sequence-correct');
                }
            } else {
                feedback.innerHTML = '<div class="feedback incorrect">' + correct + '/' + total + ' in correct position. Remember: Measure → Quantize → Convert → Store → Reconstruct</div>';
            }
        }

        function showSequenceHint() {
            alert('The first step is always measuring the analog wave\'s amplitude at regular intervals!');
            if (!completedTasks.has('sequence-hint')) {
                addXP(5, 'Used hint for sequencing');
                completedTasks.add('sequence-hint');
            }
        }

        // Canvas Setup
        function setupCanvases() {
            const canvasIds = ['calculationCanvas', 'drawingCanvas', 'examCalcCanvas'];
            
            canvasIds.forEach(canvasId => {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                let drawing = false;
                let lastX = 0;
                let lastY = 0;
                
                // Drawing functions
                function startDrawing(e) {
                    drawing = true;
                    [lastX, lastY] = getCoordinates(e, canvas);
                }
                
                function draw(e) {
                    if (!drawing) return;
                    
                    const [currentX, currentY] = getCoordinates(e, canvas);
                    
                    ctx.beginPath();
                    ctx.moveTo(lastX, lastY);
                    ctx.lineTo(currentX, currentY);
                    
                    if (canvasId === 'drawingCanvas') {
                        if (drawingMode === 'samples') {
                            // Draw dots for samples
                            ctx.strokeStyle = drawColor;
                            ctx.lineWidth = 0;
                            ctx.arc(currentX, currentY, 8, 0, Math.PI * 2);
                            ctx.fillStyle = drawColor;
                            ctx.fill();
                        } else {
                            // Draw continuous line for wave
                            ctx.strokeStyle = drawColor;
                            ctx.lineWidth = 3;
                            ctx.lineCap = 'round';
                            ctx.stroke();
                        }
                    } else {
                        // Normal drawing for calculation canvases
                        ctx.strokeStyle = drawColor;
                        ctx.lineWidth = 2;
                        ctx.lineCap = 'round';
                        ctx.stroke();
                    }
                    
                    [lastX, lastY] = [currentX, currentY];
                }
                
                function stopDrawing() {
                    drawing = false;
                }
                
                // Event listeners
                canvas.addEventListener('mousedown', startDrawing);
                canvas.addEventListener('mousemove', draw);
                canvas.addEventListener('mouseup', stopDrawing);
                canvas.addEventListener('mouseout', stopDrawing);
                
                // Touch support
                canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const mouseEvent = new MouseEvent('mousedown', {
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    });
                    canvas.dispatchEvent(mouseEvent);
                });
                
                canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const mouseEvent = new MouseEvent('mousemove', {
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    });
                    canvas.dispatchEvent(mouseEvent);
                });
                
                canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    const mouseEvent = new MouseEvent('mouseup', {});
                    canvas.dispatchEvent(mouseEvent);
                });
            });
        }

        function getCoordinates(e, canvas) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            return [
                (e.clientX - rect.left) * scaleX,
                (e.clientY - rect.top) * scaleY
            ];
        }

        function clearCanvas(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            playSound('clear');
        }

        function setDrawingMode(mode) {
            drawingMode = mode;
            
            // Update button styles
            const buttons = document.querySelectorAll('.canvas-toolbar button');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function setDrawColor(color) {
            drawColor = color;
            
            // Update color picker styles
            const pickers = document.querySelectorAll('.color-picker');
            pickers.forEach(picker => {
                picker.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function convertToDigital() {
            const canvas = document.getElementById('drawingCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Get image data and find sample points
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const samples = [];
            
            // Sample every 50 pixels
            for (let x = 0; x < canvas.width; x += 50) {
                for (let y = 0; y < canvas.height; y++) {
                    const index = (y * canvas.width + x) * 4;
                    if (imageData.data[index + 3] > 0) { // Alpha channel
                        samples.push({x, y});
                        break;
                    }
                }
            }
            
            // Clear and redraw as digital
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw digital representation
            ctx.strokeStyle = '#764ba2';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            samples.forEach((sample, i) => {
                if (i === 0) {
                    ctx.moveTo(sample.x, sample.y);
                } else {
                    // Step function
                    ctx.lineTo(sample.x, samples[i-1].y);
                    ctx.lineTo(sample.x, sample.y);
                }
            });
            ctx.stroke();
            
            // Draw sample points
            ctx.fillStyle = '#764ba2';
            samples.forEach(sample => {
                ctx.beginPath();
                ctx.arc(sample.x, sample.y, 6, 0, Math.PI * 2);
                ctx.fill();
            });
            
            if (!completedTasks.has('convert-digital')) {
                addXP(20, 'Converted analog drawing to digital');
                completedTasks.add('convert-digital');
            }
        }

        function checkReflection(type) {
            const reflection = document.getElementById(type + 'Reflection').value;
            const feedback = document.getElementById(type + 'ReflectionFeedback');
            
            if (reflection.length < 30) {
                feedback.innerHTML = '<div class="feedback incorrect">Please write a more detailed reflection.</div>';
                return;
            }
            
            const keywords = {
                wave: ['samples', 'accuracy', 'quality', 'points', 'accurate', 'detail', 'approximation'],
                masking: ['remove', 'compression', 'inaudible', 'hidden', 'covered', 'loud', 'quiet']
            };
            
            let keywordCount = 0;
            keywords[type].forEach(keyword => {
                if (reflection.toLowerCase().includes(keyword)) {
                    keywordCount++;
                }
            });
            
            if (keywordCount >= 2) {
                feedback.innerHTML = '<div class="feedback correct">🎯 Excellent reflection! You clearly understand the concept and its implications.</div>';
                if (!completedTasks.has('reflection-' + type)) {
                    addXP(25 + keywordCount * 5, 'Insightful reflection');
                    completedTasks.add('reflection-' + type);
                }
            } else {
                feedback.innerHTML = '<div class="feedback correct">Good reflection! Consider how this concept affects real-world audio applications.</div>';
                if (!completedTasks.has('reflection-' + type)) {
                    addXP(15, 'Completed reflection');
                    completedTasks.add('reflection-' + type);
                }
            }
        }

        // Binary Conversion
        function checkBinaryConversion() {
            const answers = {
                binaryInput1: '10010110', // 150 in binary
                binaryInput2: '11001000'  // 200 in binary
            };
            
            let correct = 0;
            const feedback = document.getElementById('binaryFeedback');
            
            Object.keys(answers).forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input.value === answers[inputId]) {
                    input.style.borderColor = '#4caf50';
                    correct++;
                } else {
                    input.style.borderColor = '#f44336';
                }
            });
            
            if (correct === 2) {
                feedback.innerHTML = '<div class="feedback correct">🎯 Perfect! You understand binary conversion. This is exactly how amplitude values are stored digitally!</div>';
                if (!completedTasks.has('binary-conversion')) {
                    addXP(30, 'Mastered binary conversion');
                    completedTasks.add('binary-conversion');
                }
            } else {
                feedback.innerHTML = '<div class="feedback incorrect">Not quite. Remember: 150 = 128 + 16 + 4 + 2 = 10010110</div>';
            }
        }

        function showBinaryHint() {
            alert('To convert to binary: Keep dividing by 2 and track remainders. Or use powers of 2: 128, 64, 32, 16, 8, 4, 2, 1');
            if (!completedTasks.has('binary-hint')) {
                addXP(5, 'Used binary conversion hint');
                completedTasks.add('binary-hint');
            }
        }

        // Frequency Display
        function updateFrequencyDisplay() {
            const canvas = document.getElementById('frequencyCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const frequencies = [
                {id: 'subBass', label: 'Sub-bass', range: '20-60 Hz', start: 20, end: 60, color: '#ff6b6b'},
                {id: 'bass', label: 'Bass', range: '60-250 Hz', start: 60, end: 250, color: '#4ecdc4'},
                {id: 'midrange', label: 'Midrange', range: '250-4000 Hz', start: 250, end: 4000, color: '#45b7d1'},
                {id: 'highFreq', label: 'High', range: '4-20 kHz', start: 4000, end: 20000, color: '#96ceb4'},
                {id: 'ultrasonic', label: 'Ultrasonic', range: '>20 kHz', start: 20000, end: 30000, color: '#dfe6e9'}
            ];
            
            // Draw frequency spectrum
            const logMin = Math.log10(20);
            const logMax = Math.log10(30000);
            let totalReduction = 0;
            let qualityImpact = 'None';
            
            frequencies.forEach((freq, index) => {
                const checkbox = document.getElementById(freq.id);
                const logStart = Math.log10(freq.start);
                const logEnd = Math.log10(freq.end);
                
                const x = ((logStart - logMin) / (logMax - logMin)) * canvas.width;
                const width = ((logEnd - logStart) / (logMax - logMin)) * canvas.width;
                
                if (checkbox.checked) {
                    // Draw frequency band
                    ctx.fillStyle = freq.color;
                    ctx.fillRect(x, 50, width, 100);
                    
                    // Draw waveform representation
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    
                    for (let px = x; px < x + width; px += 2) {
                        const phase = (px - x) / width * Math.PI * 4;
                        const amplitude = Math.sin(phase) * 30;
                        const y = 100 + amplitude * (1 - index * 0.15);
                        
                        if (px === x) ctx.moveTo(px, y);
                        else ctx.lineTo(px, y);
                    }
                    ctx.stroke();
                } else {
                    // Draw removed band
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                    ctx.fillRect(x, 50, width, 100);
                    
                    // Calculate reduction
                    if (freq.id === 'ultrasonic') {
                        totalReduction += 10;
                    } else if (freq.id === 'subBass') {
                        totalReduction += 5;
                        qualityImpact = 'Minimal';
                    } else if (freq.id === 'highFreq') {
                        totalReduction += 15;
                        qualityImpact = 'Noticeable';
                    } else if (freq.id === 'midrange') {
                        totalReduction += 40;
                        qualityImpact = 'Severe!';
                    } else if (freq.id === 'bass') {
                        totalReduction += 20;
                        qualityImpact = 'Significant';
                    }
                }
                
                // Label
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.save();
                ctx.translate(x + width/2, 180);
                ctx.rotate(-Math.PI/6);
                ctx.fillText(freq.label + ' ' + freq.range, -40, 0);
                ctx.restore();
            });
            
            // Draw human hearing range
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.setLineDash([10, 5]);
            
            const hearingStart = ((Math.log10(20) - logMin) / (logMax - logMin)) * canvas.width;
            const hearingEnd = ((Math.log10(20000) - logMin) / (logMax - logMin)) * canvas.width;
            
            ctx.beginPath();
            ctx.moveTo(hearingStart, 40);
            ctx.lineTo(hearingEnd, 40);
            ctx.stroke();
            
            ctx.fillStyle = '#667eea';
            ctx.font = '14px Arial';
            ctx.fillText('Human Hearing Range', hearingStart, 30);
            
            ctx.setLineDash([]);
            
            // Update displays
            document.getElementById('sizeReduction').textContent = totalReduction;
            document.getElementById('qualityImpact').textContent = qualityImpact;
            
            // Achievement for experimentation
            if (totalReduction > 0 && !completedTasks.has('frequency-experiment')) {
                addXP(15, 'Experimented with frequency filtering');
                completedTasks.add('frequency-experiment');
            }
            
            if (totalReduction > 50 && !completedTasks.has('aggressive-filter')) {
                unlockAchievement('Compression Expert', 'Achieved over 50% file size reduction!', '📉');
                completedTasks.add('aggressive-filter');
            }
        }

        function checkCategorization() {
            const dropZones = document.querySelectorAll('.drop-zone[data-category]');
            let correct = 0;
            let total = 0;
            
            const audibleZone = document.querySelector('[data-category="audible"]');
            const inaudibleZone = document.querySelector('[data-category="inaudible"]');
            
            // Count items in each zone
            const audibleItems = audibleZone.querySelectorAll('.draggable');
            const inaudibleItems = inaudibleZone.querySelectorAll('.draggable');
            
            audibleItems.forEach(item => {
                total++;
                if (item.dataset.audible === 'true') {
                    correct++;
                }
            });
            
            inaudibleItems.forEach(item => {
                total++;
                if (item.dataset.audible === 'false') {
                    correct++;
                }
            });
            
            const feedback = document.getElementById('categorizationFeedback');
            if (correct === total && total === 8) {
                feedback.innerHTML = '<div class="feedback correct">🎯 Perfect categorization! You understand human hearing limitations perfectly. Remember: 20Hz - 20kHz is the human range!</div>';
                if (!completedTasks.has('categorization-perfect')) {
                    addXP(35, 'Perfect frequency categorization');
                    completedTasks.add('categorization-perfect');
                }
            } else if (total < 8) {
                feedback.innerHTML = '<div class="feedback incorrect">Please sort all sounds before checking.</div>';
            } else {
                feedback.innerHTML = '<div class="feedback incorrect">' + correct + '/' + total + ' correct. Remember: Humans hear 20Hz to 20kHz. Dog whistles and bat sounds are ultrasonic!</div>';
            }
        }

        function playMaskingDemo(type) {
            playSound('masking-' + type);
            // In real implementation, would play actual masking demonstration
            
            if (!completedTasks.has('masking-demo')) {
                addXP(10, 'Explored masking effect');
                completedTasks.add('masking-demo');
            }
        }

        // Exam Questions
        function revealMarkScheme(questionId) {
            const textarea = document.getElementById(questionId);
            const marksInput = document.getElementById(questionId + 'Marks');
            const markScheme = document.getElementById(questionId + 'MarkScheme');
            
            if (textarea.value.length < 50) {
                alert('Please write a more complete answer before viewing the mark scheme.');
                return;
            }
            
            if (!marksInput.value) {
                alert('Please enter your predicted marks first.');
                return;
            }
            
            markScheme.style.display = 'block';
            
            if (!completedTasks.has('exam-' + questionId)) {
                const xp = 20 + Math.min(textarea.value.length / 10, 20);
                addXP(Math.round(xp), 'Attempted exam question');
                completedTasks.add('exam-' + questionId);
                
                // Check predicted accuracy
                const predicted = parseInt(marksInput.value);
                const maxMarks = parseInt(marksInput.max);
                if (predicted === maxMarks) {
                    addXP(10, 'Confident in your answer!');
                }
            }
        }

        // Extension Activities
        function checkExtension(questionId) {
            const textarea = document.getElementById('extension' + questionId);
            const feedback = document.getElementById('extension' + questionId + 'Feedback');
            
            if (!textarea) return;
            
            if (textarea.value.length < 100) {
                feedback.innerHTML = '<div class="feedback incorrect">Please provide more detail for this extension activity.</div>';
                return;
            }
            
            const responses = {
                Q1: {
                    keywords: ['oversampling', 'alias', 'filter', 'processing', 'headroom', 'plugins', 'quality'],
                    feedback: '🔬 Excellent research! High sampling rates provide: 1) Headroom for processing, 2) Better anti-aliasing filter performance, 3) Reduced plugin artifacts, 4) Future-proofing archives.'
                },
                future: {
                    keywords: ['quantum', 'ai', 'spatial', '3d', 'compression', 'holographic', 'neural'],
                    feedback: '🚀 Innovative thinking! The future of audio might include AI-enhanced compression, quantum processing, or even direct neural interfaces!'
                }
            };
            
            const config = responses[questionId] || responses.Q1;
            let keywordCount = 0;
            
            config.keywords.forEach(keyword => {
                if (textarea.value.toLowerCase().includes(keyword)) {
                    keywordCount++;
                }
            });
            
            if (keywordCount >= 2) {
                feedback.innerHTML = '<div class="feedback correct">' + config.feedback + '</div>';
                if (!completedTasks.has('extension-' + questionId)) {
                    addXP(50 + keywordCount * 10, 'Excellent extension work');
                    completedTasks.add('extension-' + questionId);
                    unlockAchievement('Beyond the Spec', 'Completed advanced extension activity!', '🚀');
                }
            } else {
                feedback.innerHTML = '<div class="feedback correct">Good effort! Your answer shows understanding beyond the basic specification.</div>';
                if (!completedTasks.has('extension-' + questionId)) {
                    addXP(30, 'Completed extension activity');
                    completedTasks.add('extension-' + questionId);
                }
            }
        }

        function checkCodecTable() {
            const flacType = document.getElementById('flacType').value;
            const mp3Type = document.getElementById('mp3Type').value;
            const flacRatio = document.getElementById('flacRatio').value;
            const mp3Ratio = document.getElementById('mp3Ratio').value;
            
            let correct = 0;
            if (flacType === 'Lossless') correct++;
            if (mp3Type === 'Lossy') correct++;
            if (flacRatio.includes('2:1') || flacRatio.includes('2')) correct++;
            if (mp3Ratio.includes('10:1') || mp3Ratio.includes('10') || mp3Ratio.includes('11')) correct++;
            
            const feedback = document.getElementById('codecTableFeedback');
            if (correct === 4) {
                feedback.innerHTML = '<div class="feedback correct">Perfect! You understand the difference between lossless (FLAC ~2:1) and lossy (MP3 ~10:1) compression.</div>';
                if (!completedTasks.has('codec-table')) {
                    addXP(30, 'Completed codec comparison');
                    completedTasks.add('codec-table');
                }
            } else {
                feedback.innerHTML = '<div class="feedback incorrect">' + correct + '/4 correct. Remember: FLAC is lossless, MP3 is lossy with perceptual coding.</div>';
            }
        }

        function checkPseudocode() {
            const code1 = document.getElementById('code1').value.toLowerCase();
            const code2 = document.getElementById('code2').value.toLowerCase();
            
            const feedback = document.getElementById('pseudocodeFeedback');
            
            if (code1.includes('original') && code1.includes('target') && 
                (code2.includes('*') && code2.includes('ratio') || code2.includes('i * ratio'))) {
                feedback.innerHTML = '<div class="feedback correct">🎯 Excellent! You understand downsampling: ratio = originalRate/targetRate, then sample every ratio\'th sample.</div>';
                if (!completedTasks.has('pseudocode')) {
                    addXP(40, 'Completed programming challenge');
                    completedTasks.add('pseudocode');
                }
            } else {
                feedback.innerHTML = '<div class="feedback incorrect">Think about it: If original is 44100Hz and target is 22050Hz, what\'s the ratio? How do we select samples?</div>';
            }
        }

        // Final Quiz
        function selectQuizAnswer(question, answer) {
            // Clear previous selections for this question
            const questionOptions = document.querySelectorAll(`[onclick*="${question}"]`);
            questionOptions.forEach(opt => opt.classList.remove('selected'));
            
            // Mark selected
            event.target.classList.add('selected');
            quizAnswers[question] = answer;
            
            // Track engagement
            if (Object.keys(quizAnswers).length === 1 && !completedTasks.has('started-final-quiz')) {
                addXP(10, 'Started final assessment');
                completedTasks.add('started-final-quiz');
            }
        }

        function checkFinalQuiz() {
            const correctAnswers = {
                q1: 'c',  // 30,000 Hz (2x 15kHz)
                q2: 'c',  // 65,536 values
                q3: 'b',  // Always reduces quality significantly (FALSE)
                q4: 'b',  // Rounded to nearest level
                q5: 'b',  // 2.65 MB
                q6: 'b',  // Can capture up to 22,050 Hz
                q7: 'd',  // 25,000 Hz (ultrasonic)
                q8: 'b',  // Directly proportional
                q9: 'c',  // MP3
                q10: 'b'  // Sampling rate too low
            };
            
            let correct = 0;
            const total = Object.keys(correctAnswers).length;
            
            // Check answers and show feedback
            Object.keys(correctAnswers).forEach(question => {
                const userAnswer = quizAnswers[question];
                const correctAnswer = correctAnswers[question];
                const options = document.querySelectorAll(`[onclick*="${question}"]`);
                
                options.forEach(opt => {
                    opt.classList.remove('correct', 'incorrect');
                    
                    // Extract answer from onclick
                    const onclick = opt.getAttribute('onclick');
                    const match = onclick.match(/'([a-d])'/);
                    if (match) {
                        const optAnswer = match[1];
                        if (optAnswer === correctAnswer) {
                            opt.classList.add('correct');
                        } else if (optAnswer === userAnswer && userAnswer !== correctAnswer) {
                            opt.classList.add('incorrect');
                        }
                    }
                });
                
                if (userAnswer === correctAnswer) {
                    correct++;
                }
            });
            
            const percentage = Math.round((correct / total) * 100);
            const feedback = document.getElementById('finalQuizFeedback');
            
            let message = '';
            let xpReward = correct * 15;
            
            if (percentage === 100) {
                message = '🎯 PERFECT SCORE! You have completely mastered digital sound sampling!';
                unlockAchievement('Perfection', 'Scored 100% on the final quiz!', '💯');
                xpReward += 100;
            } else if (percentage >= 90) {
                message = '🌟 Outstanding! You have an excellent understanding of digital sound.';
                unlockAchievement('Quiz Master', 'Scored 90%+ on final quiz!', '🏅');
                xpReward += 50;
            } else if (percentage >= 80) {
                message = '🎉 Great work! You have a strong grasp of the concepts.';
                xpReward += 25;
            } else if (percentage >= 70) {
                message = '👍 Good effort! Review the sections you found challenging.';
            } else if (percentage >= 60) {
                message = '💪 You\'re getting there! Review the feedback and try again.';
            } else {
                message = '📚 Keep studying! Each attempt helps you learn.';
            }
            
            feedback.innerHTML = `
                <div class="feedback ${percentage >= 70 ? 'correct' : 'incorrect'}">
                    <h3>Score: ${correct}/${total} (${percentage}%)</h3>
                    <p>${message}</p>
                    <div style="margin-top: 20px;">
                        <h4>Question Review:</h4>
                        <ul style="text-align: left; margin-left: 20px;">
                            ${Object.keys(correctAnswers).map(q => {
                                const num = q.replace('q', '');
                                const isCorrect = quizAnswers[q] === correctAnswers[q];
                                return `<li>Question ${num}: ${isCorrect ? '✅ Correct' : '❌ Review this topic'}</li>`;
                            }).join('')}
                        </ul>
                    </div>
                </div>
            `;
            
            if (!completedTasks.has('final-quiz-complete')) {
                addXP(xpReward, 'Completed final assessment');
                completedTasks.add('final-quiz-complete');
                
                // Update section completion
                completedTasks.add('section-complete-8');
                updateProgressBar();
            }
            
            // Trigger achievement summary update
            setTimeout(updateAchievementSummary, 1000);
        }

        function updateAchievementSummary() {
            const summary = document.getElementById('achievementSummary');
            
            // Calculate completion stats
            const totalTasks = 50; // Approximate total tasks
            const completionPercentage = Math.round((completedTasks.size / totalTasks) * 100);
            
            // Generate achievement list
            const achievementList = Array.from(achievements).map((ach, index) => {
                const icons = ['🌟', '🔍', '🔬', '🎓', '👑', '🏆', '💎', '🚀'];
                return `<li>${icons[index % icons.length]} ${ach}</li>`;
            }).join('');
            
            // Calculate time spent
            const timeSpent = Math.round((Date.now() - startTime) / 60000);
            
            summary.innerHTML = `
                <h3>🎊 Your Learning Journey Complete! 🎊</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
                    <div style="text-align: center; padding: 20px; background: white; border-radius: 15px;">
                        <div style="font-size: 48px;">🏆</div>
                        <h4>Final Level</h4>
                        <p style="font-size: 36px; color: var(--primary); font-weight: bold;">${userLevel}</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: white; border-radius: 15px;">
                        <div style="font-size: 48px;">⭐</div>
                        <h4>Total XP</h4>
                        <p style="font-size: 36px; color: var(--secondary); font-weight: bold;">${userXP}</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: white; border-radius: 15px;">
                        <div style="font-size: 48px;">✅</div>
                        <h4>Completion</h4>
                        <p style="font-size: 36px; color: var(--success); font-weight: bold;">${completionPercentage}%</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: white; border-radius: 15px;">
                        <div style="font-size: 48px;">⏱️</div>
                        <h4>Time Invested</h4>
                        <p style="font-size: 36px; color: var(--info); font-weight: bold;">${timeSpent}m</p>
                    </div>
                </div>
                
                <h4>🏅 Achievements Earned (${achievements.size}):</h4>
                <ul style="columns: 2; margin: 20px;">
                    ${achievementList || '<li>Complete more activities to earn achievements!</li>'}
                </ul>
                
                <h4>📊 Performance Analysis:</h4>
                <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <p><strong>Strengths:</strong></p>
                    <ul style="margin-left: 20px;">
                        ${completedTasks.has('sampling-drag') ? '<li>✅ Excellent understanding of sampling rates</li>' : ''}
                        ${completedTasks.has('binary-conversion') ? '<li>✅ Strong binary conversion skills</li>' : ''}
                        ${completedTasks.has('categorization-perfect') ? '<li>✅ Perfect frequency knowledge</li>' : ''}
                        ${achievements.has('Critical Thinker') ? '<li>✅ Great analytical thinking</li>' : ''}
                    </ul>
                    
                    <p style="margin-top: 15px;"><strong>Areas to Review:</strong></p>
                    <ul style="margin-left: 20px;">
                        ${!completedTasks.has('sampling-drag') ? '<li>📚 Practice more with sampling rate applications</li>' : ''}
                        ${!completedTasks.has('filesize') ? '<li>📚 Review file size calculations</li>' : ''}
                        ${!completedTasks.has('sequence-correct') ? '<li>📚 Study the A/D conversion process</li>' : ''}
                    </ul>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <h3>🎓 Ready for your exam? You\'ve got this! 🎓</h3>
                    <button class="btn-success" onclick="generateCertificate()">
                        🏆 Generate Completion Certificate
                    </button>
                </div>
            `;
            
            // Final celebration
            if (userLevel === 5 && completionPercentage > 90) {
                createConfetti();
                unlockAchievement('Digital Sound Master', 'Achieved mastery of digital sound sampling!', '👑');
            }
        }

        function generateCertificate() {
            const date = new Date().toLocaleDateString();
            const certWindow = window.open('', '_blank');
            
            certWindow.document.write(`
                <html>
                <head>
                    <title>Digital Sound Sampling Certificate</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            min-height: 100vh;
                            margin: 0;
                            background: linear-gradient(135deg, #667eea, #764ba2);
                        }
                        .certificate {
                            background: white;
                            padding: 50px;
                            border-radius: 20px;
                            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
                            text-align: center;
                            max-width: 600px;
                            border: 5px solid gold;
                        }
                        h1 {
                            color: #667eea;
                            font-size: 36px;
                            margin-bottom: 20px;
                        }
                        .level {
                            font-size: 72px;
                            color: #764ba2;
                            margin: 20px 0;
                        }
                        .stats {
                            margin: 30px 0;
                            font-size: 18px;
                        }
                        .signature {
                            margin-top: 50px;
                            border-top: 2px solid #333;
                            width: 300px;
                            margin-left: auto;
                            margin-right: auto;
                            padding-top: 10px;
                        }
                    </style>
                </head>
                <body>
                    <div class="certificate">
                        <h1>Certificate of Completion</h1>
                        <h2>Digital Sound Sampling</h2>
                        <p>This certifies that</p>
                        <h3 style="font-size: 28px; color: #667eea;">GCSE Computer Science Student</h3>
                        <p>has successfully completed the interactive worksheet with</p>
                        <div class="level">Level ${userLevel}</div>
                        <div class="stats">
                            <p><strong>Total XP Earned:</strong> ${userXP}</p>
                            <p><strong>Achievements Unlocked:</strong> ${achievements.size}</p>
                            <p><strong>Date:</strong> ${date}</p>
                        </div>
                        <div class="signature">
                            Digital Sound Sampling Course
                        </div>
                    </div>
                </body>
                </html>
            `);
            
            certWindow.document.close();
            
            if (!completedTasks.has('certificate-generated')) {
                addXP(50, 'Generated completion certificate');
                completedTasks.add('certificate-generated');
                unlockAchievement('Certified', 'Generated your completion certificate!', '📜');
            }
        }

        // Reset Functions
        function resetSection(sectionNum) {
            const resetFunctions = {
                1: resetStarter,
                2: resetSamplingRate,
                3: resetBitDepth,
                4: resetSamplingProcess,
                5: resetPerceptual,
                6: resetExamQuestions,
                7: resetExtension,
                8: resetSummary
            };
            
            if (resetFunctions[sectionNum]) {
                resetFunctions[sectionNum]();
                playSound('reset');
            }
        }

        function resetStarter() {
            document.getElementById('starterFeedback').innerHTML = '';
            document.getElementById('knowledgeSummary').innerHTML = '';
            knowledgeScore = 0;
            document.querySelectorAll('[id^="knowledge"]').forEach(elem => elem.innerHTML = '');
            initMemoryGame();
            drawStarterWaves();
        }

        function resetSamplingRate() {
            document.getElementById('samplingRateSlider').value = 8000;
            updateSamplingRate(8000);
            document.getElementById('samplingDragFeedback').innerHTML = '';
            document.getElementById('fillBlanksFeedback').innerHTML = '';
            document.getElementById('cdInvestigationFeedback').innerHTML = '';
            document.getElementById('cdInvestigation').value = '';
            clearBlanks();
            
            // Reset drag and drop
            const dropZones = document.querySelectorAll('.drop-zone');
            dropZones.forEach(zone => {
                if (zone.dataset.answer) {
                    zone.textContent = zone.textContent.split('\n')[0]; // Keep only first line
                    zone.classList.remove('filled', 'incorrect');
                    zone.style.background = '';
                    delete zone.dataset.dropped;
                }
            });
            
            const draggables = document.querySelectorAll('.draggable');
            draggables.forEach(item => {
                item.style.opacity = '1';
                item.draggable = true;
            });
        }

        function resetBitDepth() {
            document.getElementById('bitDepthSlider').value = 8;
            updateBitDepth(8);
            calculateFileSize();
            clearCanvas('calculationCanvas');
            document.getElementById('criticalThinkingFeedback').innerHTML = '';
            document.getElementById('criticalThinking').value = '';
            bitDepthGameRound = 0;
            bitDepthGameScore = 0;
            document.getElementById('bitDepthScore').textContent = '0';
            document.getElementById('bitDepthGameFeedback').innerHTML = '';
        }

        function resetSamplingProcess() {
            resetSamplingAnimation();
            document.getElementById('sequenceFeedback').innerHTML = '';
            document.getElementById('waveReflectionFeedback').innerHTML = '';
            document.getElementById('waveReflection').value = '';
            document.getElementById('binaryFeedback').innerHTML = '';
            document.getElementById('binaryInput1').value = '';
            document.getElementById('binaryInput2').value = '';
            document.getElementById('binaryInput1').style.borderColor = '';
            document.getElementById('binaryInput2').style.borderColor = '';
            clearCanvas('drawingCanvas');
            drawingMode = 'wave';
        }

        function resetPerceptual() {
            document.getElementById('categorizationFeedback').innerHTML = '';
            document.getElementById('maskingReflectionFeedback').innerHTML = '';
            document.getElementById('maskingReflection').value = '';
            
            // Reset frequency checkboxes
            document.getElementById('subBass').checked = true;
            document.getElementById('bass').checked = true;
            document.getElementById('midrange').checked = true;
            document.getElementById('highFreq').checked = true;
            document.getElementById('ultrasonic').checked = false;
            updateFrequencyDisplay();
            
            // Reset categorization
            const dropZones = document.querySelectorAll('.drop-zone[data-category]');
            dropZones.forEach(zone => {
                zone.innerHTML = zone.innerHTML.split('<')[0]; // Keep only text before first tag
                zone.classList.remove('filled');
            });
            
            const draggables = document.querySelectorAll('.draggable[data-audible]');
            draggables.forEach(item => {
                item.style.opacity = '1';
                item.draggable = true;
            });
        }

        function resetExamQuestions() {
            for (let i = 1; i <= 5; i++) {
                const questionId = 'examQ' + i;
                document.getElementById(questionId).value = '';
                document.getElementById(questionId + 'Marks').value = '';
                document.getElementById(questionId + 'MarkScheme').style.display = 'none';
            }
            clearCanvas('examCalcCanvas');
        }

        function resetExtension() {
            document.getElementById('extensionQ1').value = '';
            document.getElementById('extensionQ1Feedback').innerHTML = '';
            document.getElementById('futureFormat').value = '';
            document.getElementById('futureFeedback').innerHTML = '';
            document.getElementById('flacType').selectedIndex = 0;
            document.getElementById('mp3Type').selectedIndex = 0;
            document.getElementById('flacRatio').value = '';
            document.getElementById('mp3Ratio').value = '';
            document.getElementById('codecTableFeedback').innerHTML = '';
            document.getElementById('code1').value = '';
            document.getElementById('code2').value = '';
            document.getElementById('pseudocodeFeedback').innerHTML = '';
        }

        function resetSummary() {
            quizAnswers = {};
            document.getElementById('finalQuizFeedback').innerHTML = '';
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });
            document.getElementById('achievementSummary').innerHTML = '<div class="loading-spinner"></div><p>Calculating your achievements...</p>';
        }

        // Utility Functions
        function preventPaste() {
            document.addEventListener('paste', function(e) {
                const target = e.target;
                if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA') {
                    if (target.id && !target.id.includes('feedback')) {
                        e.preventDefault();
                        showPasteWarning();
                        return false;
                    }
                }
            });
            
            // Also prevent right-click on inputs
            document.addEventListener('contextmenu', function(e) {
                const target = e.target;
                if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA') {
                    if (target.id && !target.id.includes('feedback')) {
                        e.preventDefault();
                        return false;
                    }
                }
            });
        }

        function showPasteWarning() {
            const warning = document.getElementById('pasteWarning');
            warning.style.display = 'block';
            
            if (!completedTasks.has('paste-attempt')) {
                completedTasks.add('paste-attempt');
                // No XP penalty, just tracking
            }
            
            setTimeout(() => {
                warning.style.display = 'none';
            }, 3000);
        }

        // Accessibility Functions
        function initializeAccessibility() {
            // Check for saved preferences
            if (localStorage.getItem('highContrast') === 'true') {
                document.body.classList.add('high-contrast');
            }
            if (localStorage.getItem('dyslexiaFont') === 'true') {
                document.body.classList.add('dyslexia-font');
            }
            if (localStorage.getItem('animationsEnabled') === 'false') {
                animationsEnabled = false;
                document.body.style.animation = 'none';
            }
            if (localStorage.getItem('soundEffectsEnabled') === 'false') {
                soundEffectsEnabled = false;
            }
            
            const savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                document.documentElement.style.fontSize = savedFontSize + 'px';
            }
        }

        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
            localStorage.setItem('highContrast', document.body.classList.contains('high-contrast'));
            playSound('toggle');
        }

        function toggleDyslexiaFont() {
            document.body.classList.toggle('dyslexia-font');
            localStorage.setItem('dyslexiaFont', document.body.classList.contains('dyslexia-font'));
            playSound('toggle');
        }

        function changeFontSize(delta) {
            const root = document.documentElement;
            const currentSize = parseFloat(getComputedStyle(root).fontSize);
            const newSize = Math.max(12, Math.min(24, currentSize + delta));
            root.style.fontSize = newSize + 'px';
            localStorage.setItem('fontSize', newSize);
            playSound('toggle');
        }

        function toggleAnimations() {
            animationsEnabled = !animationsEnabled;
            localStorage.setItem('animationsEnabled', animationsEnabled);
            
            if (!animationsEnabled) {
                document.querySelectorAll('*').forEach(elem => {
                    elem.style.animation = 'none';
                    elem.style.transition = 'none';
                });
            } else {
                location.reload(); // Easiest way to restore animations
            }
        }

        function toggleSoundEffects() {
            soundEffectsEnabled = !soundEffectsEnabled;
            localStorage.setItem('soundEffectsEnabled', soundEffectsEnabled);
            playSound('toggle');
        }

        // Progress Management
        function saveProgress() {
            const progress = {
                level: userLevel,
                xp: userXP,
                achievements: Array.from(achievements),
                completedTasks: Array.from(completedTasks),
                currentSection: currentSection,
                quizAnswers: quizAnswers,
                timestamp: Date.now()
            };
            
            localStorage.setItem('soundSamplingProgress', JSON.stringify(progress));
            
            // Visual feedback
            const saveIndicator = document.createElement('div');
            saveIndicator.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                background: #4caf50;
                color: white;
                padding: 10px 20px;
                border-radius: 20px;
                font-size: 14px;
                z-index: 1000;
                animation: fadeInOut 2s ease;
            `;
            saveIndicator.textContent = '✓ Progress Saved';
            document.body.appendChild(saveIndicator);
            
            setTimeout(() => saveIndicator.remove(), 2000);
        }

        function loadProgress() {
            const saved = localStorage.getItem('soundSamplingProgress');
            if (!saved) return;
            
            try {
                const progress = JSON.parse(saved);
                
                // Restore progress
                userLevel = progress.level || 1;
                userXP = progress.xp || 0;
                achievements = new Set(progress.achievements || []);
                completedTasks = new Set(progress.completedTasks || []);
                quizAnswers = progress.quizAnswers || {};
                
                // Update displays
                updateXPDisplay();
                updateBadges();
                document.getElementById('achievementCount').textContent = achievements.size;
                
                // Show welcome back message
                if (progress.timestamp) {
                    const lastSave = new Date(progress.timestamp);
                    const now = new Date();
                    const hoursSince = Math.floor((now - lastSave) / (1000 * 60 * 60));
                    
                    if (hoursSince > 0) {
                        showWelcomeBack(hoursSince);
                    }
                }
                
                // Navigate to last section
                if (progress.currentSection > 0) {
                    setTimeout(() => showSection(progress.currentSection), 500);
                }
                
            } catch (e) {
                console.error('Failed to load progress:', e);
            }
        }

        function showWelcomeBack(hours) {
            const popup = document.createElement('div');
            popup.className = 'achievement-popup show';
            popup.style.background = 'linear-gradient(135deg, #2196f3, #00bcd4)';
            popup.innerHTML = `
                <div style="font-size: 48px; text-align: center;">👋</div>
                <h3>Welcome Back!</h3>
                <p>You were away for ${hours} hour${hours > 1 ? 's' : ''}.</p>
                <p>Ready to continue learning?</p>
            `;
            document.body.appendChild(popup);
            
            setTimeout(() => {
                popup.classList.remove('show');
                setTimeout(() => popup.remove(), 500);
            }, 4000);
        }

        // Daily Streak
        function checkDailyStreak() {
            const today = new Date().toDateString();
            const lastVisit = localStorage.getItem('lastVisit');
            const streak = parseInt(localStorage.getItem('streak') || '0');
            
            if (lastVisit !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastVisit === yesterday.toDateString()) {
                    // Continuing streak
                    const newStreak = streak + 1;
                    localStorage.setItem('streak', newStreak);
                    document.getElementById('streakCount').textContent = newStreak;
                    
                    if (newStreak === 7) {
                        unlockAchievement('Week Warrior', 'Maintained a 7-day streak!', '🔥');
                    }
                } else {
                    // Streak broken
                    localStorage.setItem('streak', '1');
                    document.getElementById('streakCount').textContent = '1';
                }
                
                localStorage.setItem('lastVisit', today);
            } else {
                document.getElementById('streakCount').textContent = streak;
            }
        }

        // Special Effects
        function createParticles(x, y) {
            if (!animationsEnabled) return;
            
            const colors = ['#667eea', '#764ba2', '#f5576c', '#ffc107', '#4caf50'];
            
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: fixed;
                    left: ${x}px;
                    top: ${y}px;
                    width: 8px;
                    height: 8px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 3000;
                `;
                
                document.body.appendChild(particle);
                
                const angle = (Math.PI * 2 * i) / 20;
                const velocity = 5 + Math.random() * 10;
                const lifetime = 1000 + Math.random() * 1000;
                
                let posX = 0;
                let posY = 0;
                let opacity = 1;
                let scale = 1;
                
                const animate = () => {
                    posX += Math.cos(angle) * velocity;
                    posY += Math.sin(angle) * velocity + 2;
                    opacity -= 1 / (lifetime / 16);
                    scale *= 0.98;
                    
                    particle.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
                    particle.style.opacity = opacity;
                    
                    if (opacity > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        particle.remove();
                    }
                };
                
                requestAnimationFrame(animate);
            }
        }

        function createConfetti() {
            if (!animationsEnabled) return;
            
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'];
            
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    confetti.style.animationDuration = (3 + Math.random() * 2) + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 5000);
                }, i * 30);
            }
        }

        // Background Animation
        function startBackgroundAnimation() {
            if (!animationsEnabled) return;
            
            // Create floating elements
            setInterval(() => {
                if (Math.random() > 0.9) {
                    const float = document.createElement('div');
                    float.style.cssText = `
                        position: fixed;
                        left: ${Math.random() * 100}%;
                        bottom: -50px;
                        width: ${20 + Math.random() * 30}px;
                        height: ${20 + Math.random() * 30}px;
                        background: rgba(255,255,255,0.1);
                        border-radius: 50%;
                        pointer-events: none;
                        z-index: 0;
                        animation: float-up 10s ease-out;
                    `;
                    
                    document.querySelector('.bg-animation').appendChild(float);
                    
                    setTimeout(() => float.remove(), 10000);
                }
            }, 2000);
        }

        // Keyboard Shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Navigation shortcuts
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'ArrowLeft':
                            e.preventDefault();
                            if (currentSection > 0) showSection(currentSection - 1);
                            break;
                        case 'ArrowRight':
                            e.preventDefault();
                            if (currentSection < 8) showSection(currentSection + 1);
                            break;
                        case 's':
                            e.preventDefault();
                            saveProgress();
                            break;
                        case 'h':
                            e.preventDefault();
                            showKeyboardHelp();
                            break;
                    }
                }
                
                // Number keys for navigation
                if (!e.ctrlKey && !e.metaKey && e.key >= '1' && e.key <= '9') {
                    const section = parseInt(e.key) - 1;
                    if (section <= 8) {
                        showSection(section);
                    }
                }
            });
        }

        function showKeyboardHelp() {
            alert(`Keyboard Shortcuts:
            
Navigation:
• 1-9: Jump to section
• Ctrl+← / Ctrl+→: Previous/Next section

Actions:
• Ctrl+S: Save progress
• Ctrl+H: Show this help

Accessibility:
• Tab: Navigate elements
• Enter: Activate buttons
• Space: Check boxes`);
        }

        // Easter Eggs
        const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let konamiIndex = 0;

        document.addEventListener('keydown', (e) => {
            if (e.key === konamiCode[konamiIndex]) {
                konamiIndex++;
                if (konamiIndex === konamiCode.length) {
                    activateEasterEgg();
                    konamiIndex = 0;
                }
            } else {
                konamiIndex = 0;
            }
        });

        function activateEasterEgg() {
            unlockAchievement('Secret Finder', 'Found the Konami code easter egg!', '🎮');
            createConfetti();
            
            // Bonus XP rain
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    addXP(10, 'Easter egg bonus!');
                }, i * 200);
            }
            
            // Fun message
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 40px;
                border-radius: 20px;
                font-size: 24px;
                z-index: 4000;
                box-shadow: 0 20px 40px rgba(0,0,0,0.3);
                text-align: center;
                animation: pulse 1s infinite;
            `;
            message.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 20px;">🎊 KONAMI CODE ACTIVATED! 🎊</div>
                <p>You found the secret! Here's 100 bonus XP!</p>
                <p style="font-size: 16px; margin-top: 20px;">Up, Up, Down, Down, Left, Right, Left, Right, B, A</p>
            `;
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.style.animation = 'fadeOut 1s ease';
                setTimeout(() => message.remove(), 1000);
            }, 5000);
        }

        // Tooltip System
        function initializeTooltips() {
            // Add tooltips to various elements
            const tooltips = {
                'xp': 'Experience Points - Earn these by completing tasks!',
                'level': 'Your current mastery level (1-5)',
                'badge1': 'Starter Badge - Begin your journey',
                'badge2': 'Explorer Badge - Discover new concepts',
                'badge3': 'Scientist Badge - Master the theory',
                'badge4': 'Expert Badge - Apply your knowledge',
                'badge5': 'Master Badge - Complete mastery achieved!'
            };
            
            Object.keys(tooltips).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.setAttribute('data-tooltip', tooltips[id]);
                }
            });
        }

        // Feedback System
        function openFeedback() {
            document.getElementById('feedbackModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
            
            // Pre-fill with current section info
            const section = document.querySelector('.section.active h2').textContent;
            document.getElementById('feedbackText').placeholder = `Feedback about: ${section}\n\nDescribe any bugs or suggestions...`;
        }

        function closeFeedback() {
            document.getElementById('feedbackModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
            document.getElementById('feedbackText').value = '';
        }

        function submitFeedback() {
            const feedbackText = document.getElementById('feedbackText').value;
            if (feedbackText.trim() === '') {
                alert('Please enter your feedback before submitting.');
                return;
            }
            
            // Prepare feedback data
            const feedbackData = {
                page: 'Section ' + (currentSection + 1),
                section: document.querySelector('.section.active h2').textContent,
                message: feedbackText,
                timestamp: new Date().toISOString(),
                userLevel: userLevel,
                userXP: userXP,
                completedTasks: completedTasks.size,
                achievements: achievements.size,
                browser: navigator.userAgent
            };
            
            // In a real implementation, this would send to server
            console.log('Feedback to send to millingtond@mgs.org:', feedbackData);
            
            // Create mailto link (fallback)
            const subject = encodeURIComponent('Digital Sound Sampling Feedback - ' + feedbackData.section);
            const body = encodeURIComponent(`
Feedback from Digital Sound Sampling Worksheet

Section: ${feedbackData.section}
Page: ${feedbackData.page}
Time: ${feedbackData.timestamp}

User Progress:
- Level: ${feedbackData.userLevel}
- XP: ${feedbackData.userXP}
- Tasks Completed: ${feedbackData.completedTasks}
- Achievements: ${feedbackData.achievements}

Feedback:
${feedbackData.message}

Browser: ${feedbackData.browser}
            `);
            
            // Show success message
            alert('Thank you for your feedback! It helps us improve the worksheet.');
            closeFeedback();
            
            if (!completedTasks.has('feedback-submitted')) {
                addXP(15, 'Provided helpful feedback');
                completedTasks.add('feedback-submitted');
                unlockAchievement('Helpful Student', 'Submitted feedback to improve the worksheet!', '💬');
            }
            
            // Optional: Open email client
            // window.location.href = `mailto:millingtond@mgs.org?subject=${subject}&body=${body}`;
        }

        // Performance Monitoring
        let startTime = Date.now();
        let totalTime = 0;

        window.addEventListener('beforeunload', function() {
            totalTime += Date.now() - startTime;
            
            // Track time achievements
            const minutes = Math.floor(totalTime / 60000);
            
            if (minutes >= 5 && !achievements.has('Dedicated Learner')) {
                unlockAchievement('Dedicated Learner', 'Spent 5+ minutes learning!', '⏱️');
            }
            if (minutes >= 30 && !achievements.has('Committed Student')) {
                unlockAchievement('Committed Student', 'Spent 30+ minutes on the worksheet!', '📚');
            }
            if (minutes >= 60 && !achievements.has('Marathon Learner')) {
                unlockAchievement('Marathon Learner', 'Studied for over an hour!', '🏃');
            }
            
            // Save session time
            const totalMinutes = parseInt(localStorage.getItem('totalStudyTime') || '0') + minutes;
            localStorage.setItem('totalStudyTime', totalMinutes);
        });

        // URL Hash Navigation
        window.addEventListener('hashchange', function() {
            const hash = window.location.hash;
            if (hash.startsWith('#section')) {
                const sectionNum = parseInt(hash.replace('#section', ''));
                if (!isNaN(sectionNum) && sectionNum >= 0 && sectionNum <= 8) {
                    showSection(sectionNum);
                }
            }
        });

        // Check initial hash
        window.addEventListener('load', function() {
            const hash = window.location.hash;
            if (hash.startsWith('#section')) {
                const sectionNum = parseInt(hash.replace('#section', ''));
                if (!isNaN(sectionNum) && sectionNum >= 0 && sectionNum <= 8) {
                    setTimeout(() => showSection(sectionNum), 100);
                }
            }
        });

        // Console Messages
        console.log('%c🎵 Welcome to Digital Sound Sampling! 🎵', 'font-size: 24px; color: #667eea; font-weight: bold;');
        console.log('%cYou found the developer console! You\'re curious - that\'s great!', 'font-size: 16px; color: #764ba2;');
        console.log('%cTry these console commands:', 'font-size: 14px; color: #667eea; font-weight: bold;');
        console.log('%c• debugMode() - Show debug information', 'font-size: 12px; color: #333;');
        console.log('%c• showStats() - Display your current statistics', 'font-size: 12px; color: #333;');
        console.log('%c• unlockAll() - Just kidding! Earn achievements properly! 😄', 'font-size: 12px; color: #333;');
        console.log('%c\nPsst... Try the Konami code: ↑↑↓↓←→←→BA', 'font-size: 14px; color: #f5576c; font-style: italic;');

        // Debug Functions (for console)
        function debugMode() {
            console.log('=== Debug Information ===');
            console.log('Current Section:', currentSection);
            console.log('User Level:', userLevel);
            console.log('User XP:', userXP);
            console.log('Achievements:', Array.from(achievements));
            console.log('Completed Tasks:', Array.from(completedTasks));
            console.log('Quiz Answers:', quizAnswers);
            console.log('Time Spent:', Math.floor((Date.now() - startTime) / 60000), 'minutes');
            console.log('========================');
            
            if (!completedTasks.has('debug-mode')) {
                addXP(5, 'Discovered debug mode');
                completedTasks.add('debug-mode');
            }
        }

        function showStats() {
            const stats = {
                'Level': userLevel + '/5',
                'XP': userXP,
                'Achievements': achievements.size,
                'Tasks Completed': completedTasks.size,
                'Sections Visited': Array.from(completedTasks).filter(t => t.startsWith('nav-')).length,
                'Time This Session': Math.floor((Date.now() - startTime) / 60000) + ' minutes',
                'Total Study Time': localStorage.getItem('totalStudyTime') || '0' + ' minutes',
                'Current Streak': document.getElementById('streakCount').textContent + ' days'
            };
            
            console.table(stats);
            
            if (!completedTasks.has('stats-checked')) {
                addXP(5, 'Checked your statistics');
                completedTasks.add('stats-checked');
            }
        }

        // Mobile Enhancements
        if ('ontouchstart' in window) {
            // Add touch feedback
            document.addEventListener('touchstart', function(e) {
                if (e.target.tagName === 'BUTTON' || e.target.classList.contains('quiz-option')) {
                    e.target.style.transform = 'scale(0.95)';
                }
            });
            
            document.addEventListener('touchend', function(e) {
                if (e.target.tagName === 'BUTTON' || e.target.classList.contains('quiz-option')) {
                    setTimeout(() => {
                        e.target.style.transform = '';
                    }, 100);
                }
            });
            
            // Swipe navigation
            let touchStartX = 0;
            let touchEndX = 0;
            
            document.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
            });
            
            document.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });
            
            function handleSwipe() {
                const swipeThreshold = 50;
                
                if (touchEndX < touchStartX - swipeThreshold && currentSection < 8) {
                    showSection(currentSection + 1);
                    playSound('swipe');
                }
                if (touchEndX > touchStartX + swipeThreshold && currentSection > 0) {
                    showSection(currentSection - 1);
                    playSound('swipe');
                }
            }
            
            // Haptic feedback (if supported)
            if ('vibrate' in navigator) {
                document.addEventListener('click', function(e) {
                    if (e.target.tagName === 'BUTTON') {
                        navigator.vibrate(10);
                    }
                });
            }
        }

        // Intersection Observer for animations
        if ('IntersectionObserver' in window) {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);
            
            // Observe task elements
            document.querySelectorAll('.task').forEach(task => {
                task.style.opacity = '0';
                task.style.transform = 'translateY(20px)';
                task.style.transition = 'all 0.5s ease';
                observer.observe(task);
            });
        }

        // Performance optimization
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                // Redraw canvases if needed
                if (document.getElementById('section1').classList.contains('active')) {
                    drawStarterWaves();
                }
                if (document.getElementById('section2').classList.contains('active')) {
                    updateSamplingRate(document.getElementById('samplingRateSlider').value);
                }
                if (document.getElementById('section3').classList.contains('active')) {
                    updateBitDepth(document.getElementById('bitDepthSlider').value);
                }
                if (document.getElementById('section5').classList.contains('active')) {
                    updateFrequencyDisplay();
                }
            }, 250);
        });

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Worksheet error:', e);
            // Could send error reports in production
        });

        // Final initialization check
        window.addEventListener('load', function() {
            // Ensure everything is properly initialized
            setTimeout(() => {
                if (userXP === 0 && !completedTasks.has('worksheet-loaded')) {
                    addXP(5, 'Worksheet loaded successfully');
                    completedTasks.add('worksheet-loaded');
                }
                
                // Show best scores
                const memoryBest = localStorage.getItem('memoryBest');
                if (memoryBest) {
                    document.getElementById('bestScore').textContent = memoryBest;
                }
                
                const waveRiderHigh = localStorage.getItem('waveRiderHigh');
                if (waveRiderHigh) {
                    document.getElementById('waveRiderHighScore').textContent = waveRiderHigh;
                }
                
                // Check for returning user
                if (localStorage.getItem('soundSamplingProgress')) {
                    if (!achievements.has('Returning Student')) {
                        unlockAchievement('Returning Student', 'Welcome back to continue learning!', '🔄');
                    }
                }
            }, 1000);
        });

        // Custom CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translateY(20px); }
                20% { opacity: 1; transform: translateY(0); }
                80% { opacity: 1; transform: translateY(0); }
                100% { opacity: 0; transform: translateY(-20px); }
            }
            
            @keyframes float-up {
                0% { transform: translateY(0) scale(1); opacity: 0.1; }
                50% { opacity: 0.3; }
                100% { transform: translateY(-100vh) scale(1.5); opacity: 0; }
            }
            
            @keyframes fadeOut {
                from { opacity: 1; transform: scale(1); }
                to { opacity: 0; transform: scale(0.8); }
            }
            
            @keyframes rainbow {
                0% { color: #ff6b6b; }
                16% { color: #4ecdc4; }
                33% { color: #45b7d1; }
                50% { color: #96ceb4; }
                66% { color: #feca57; }
                83% { color: #ff9ff3; }
                100% { color: #ff6b6b; }
            }
        `;
        document.head.appendChild(style);

        // Initialize drawing mode buttons
        document.addEventListener('DOMContentLoaded', function() {
            const drawWaveBtn = document.querySelector('button[onclick="setDrawingMode(\'wave\')"]');
            if (drawWaveBtn) drawWaveBtn.classList.add('active');
        });
    </script>
</body>
</html>