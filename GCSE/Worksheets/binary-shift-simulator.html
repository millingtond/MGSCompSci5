<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binary Shift Simulator - GCSE Computer Science</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeIn 1s ease-out;
        }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .bit-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            position: relative;
        }
        
        .bit-display {
            display: flex;
            gap: 8px;
            position: relative;
        }
        
        .bit {
            width: 50px;
            height: 50px;
            border: 3px solid #667eea;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            background: white;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .bit:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .bit.active {
            background: #667eea;
            color: white;
        }
        
        .bit.overflow {
            animation: overflow 0.5s ease-out;
            border-color: #e74c3c;
            background: #ffe6e6;
        }
        
        @keyframes overflow {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.3) rotate(180deg); }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }
        
        .bit.shifting-left {
            animation: shiftLeft 0.5s ease-out;
        }
        
        .bit.shifting-right {
            animation: shiftRight 0.5s ease-out;
        }
        
        @keyframes shiftLeft {
            0% { transform: translateX(0); }
            50% { transform: translateX(-58px); }
            100% { transform: translateX(0); }
        }
        
        @keyframes shiftRight {
            0% { transform: translateX(0); }
            50% { transform: translateX(58px); }
            100% { transform: translateX(0); }
        }
        
        .bit-label {
            position: absolute;
            top: -25px;
            font-size: 12px;
            color: #666;
            font-weight: bold;
        }
        
        .bit-value {
            position: absolute;
            bottom: -25px;
            font-size: 11px;
            color: #999;
        }
        
        button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-shift {
            background: #3498db;
            color: white;
            margin: 0 10px;
        }
        
        .btn-shift:hover {
            background: #2980b9;
            transform: scale(1.05);
        }
        
        .btn-shift:active {
            transform: scale(0.95);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .result-display {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .result-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            flex: 1;
            min-width: 150px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .result-box:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .result-box h3 {
            margin: 0 0 10px 0;
            color: #667eea;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .result-box .value {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: #f0f0f0;
            padding: 5px;
            border-radius: 15px;
        }
        
        .tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            color: #666;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }
        
        .challenge-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .challenge-box::before {
            content: '🎯';
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 40px;
            opacity: 0.2;
        }
        
        .progress-bar {
            background: #e0e0e0;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            border-radius: 5px;
        }
        
        .achievement {
            display: inline-block;
            background: gold;
            color: #333;
            padding: 5px 15px;
            border-radius: 20px;
            margin: 5px;
            font-weight: bold;
            animation: bounce 0.5s ease;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .quiz-option {
            background: #f8f9fa;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .quiz-option:hover {
            background: #e9ecef;
            border-color: #667eea;
            transform: translateX(5px);
        }
        
        .quiz-option.correct {
            background: #d4edda;
            border-color: #28a745;
            animation: correct 0.5s ease;
        }
        
        .quiz-option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            animation: shake 0.5s ease;
        }
        
        @keyframes correct {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .feedback-box {
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: 500;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from { 
                opacity: 0;
                transform: translateY(-10px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .feedback-box.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .feedback-box.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .speed-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .speed-control input[type="range"] {
            width: 200px;
        }
        
        .visual-explanation {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #3498db;
        }
        
        .arrow-animation {
            font-size: 30px;
            color: #3498db;
            animation: moveArrow 1s ease-in-out infinite;
        }
        
        @keyframes moveArrow {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(10px); }
        }
        
        .tooltip {
            position: absolute;
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .bit:hover .tooltip {
            opacity: 1;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transform: scale(0);
            animation: popIn 0.5s ease forwards;
        }
        
        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.2s; }
        .stat-card:nth-child(3) { animation-delay: 0.3s; }
        .stat-card:nth-child(4) { animation-delay: 0.4s; }
        
        @keyframes popIn {
            to {
                transform: scale(1);
            }
        }
        
        .stat-card h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .stat-card .stat-value {
            font-size: 32px;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .bit {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎮 Binary Shift Master</h1>
            <p>Learn Binary Shifts Through Interactive Gameplay - OCR J277</p>
        </div>
        
        <div class="card">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('playground')">🎯 Playground</button>
                <button class="tab" onclick="switchTab('challenges')">🏆 Challenges</button>
                <button class="tab" onclick="switchTab('learn')">📚 Learn</button>
                <button class="tab" onclick="switchTab('quiz')">🧠 Quiz</button>
            </div>
            
            <!-- Playground Tab -->
            <div id="playground" class="tab-content active">
                <h2>Interactive Binary Playground</h2>
                
                <div style="text-align: center; margin: 20px 0;">
                    <input type="text" id="binaryInput" placeholder="Enter 8-bit binary (e.g., 00010110)" maxlength="8" 
                           style="font-size: 18px; padding: 12px 20px; border: 2px solid #667eea; border-radius: 10px; width: 280px;">
                    <button class="btn-primary" onclick="updateDisplay()">Set Binary</button>
                    <button class="btn-primary" onclick="randomBinary()">🎲 Random</button>
                </div>
                
                <div class="bit-container">
                    <div class="bit-display">
                        <div class="bit" onclick="toggleBit(0)">
                            <span class="bit-label">128</span>
                            <span>0</span>
                            <span class="bit-value">2⁷</span>
                            <span class="tooltip">Click to toggle!</span>
                        </div>
                        <div class="bit" onclick="toggleBit(1)">
                            <span class="bit-label">64</span>
                            <span>0</span>
                            <span class="bit-value">2⁶</span>
                            <span class="tooltip">Click to toggle!</span>
                        </div>
                        <div class="bit" onclick="toggleBit(2)">
                            <span class="bit-label">32</span>
                            <span>0</span>
                            <span class="bit-value">2⁵</span>
                            <span class="tooltip">Click to toggle!</span>
                        </div>
                        <div class="bit" onclick="toggleBit(3)">
                            <span class="bit-label">16</span>
                            <span>1</span>
                            <span class="bit-value">2⁴</span>
                            <span class="tooltip">Click to toggle!</span>
                        </div>
                        <div class="bit" onclick="toggleBit(4)">
                            <span class="bit-label">8</span>
                            <span>0</span>
                            <span class="bit-value">2³</span>
                            <span class="tooltip">Click to toggle!</span>
                        </div>
                        <div class="bit" onclick="toggleBit(5)">
                            <span class="bit-label">4</span>
                            <span>1</span>
                            <span class="bit-value">2²</span>
                            <span class="tooltip">Click to toggle!</span>
                        </div>
                        <div class="bit" onclick="toggleBit(6)">
                            <span class="bit-label">2</span>
                            <span>1</span>
                            <span class="bit-value">2¹</span>
                            <span class="tooltip">Click to toggle!</span>
                        </div>
                        <div class="bit" onclick="toggleBit(7)">
                            <span class="bit-label">1</span>
                            <span>0</span>
                            <span class="bit-value">2⁰</span>
                            <span class="tooltip">Click to toggle!</span>
                        </div>
                    </div>
                </div>
                
                <div class="result-display">
                    <div class="result-box">
                        <h3>Binary</h3>
                        <div class="value" id="binaryValue">00010110</div>
                    </div>
                    <div class="result-box">
                        <h3>Decimal</h3>
                        <div class="value" id="decimalValue">22</div>
                    </div>
                    <div class="result-box">
                        <h3>Hexadecimal</h3>
                        <div class="value" id="hexValue">0x16</div>
                    </div>
                </div>
                
                <div class="speed-control">
                    <label>Animation Speed:</label>
                    <input type="range" id="speedSlider" min="100" max="1000" value="500">
                    <span id="speedLabel">Medium</span>
                </div>
                
                <div class="controls">
                    <button class="btn-shift" onclick="shiftLeft()">
                        <span class="arrow-animation">←</span> Shift Left (×2)
                    </button>
                    <button class="btn-shift" onclick="multiShiftLeft()">
                        ←← Multi-Shift Left
                    </button>
                    <button class="btn-shift" onclick="shiftRight()">
                        Shift Right (÷2) <span class="arrow-animation">→</span>
                    </button>
                    <button class="btn-shift" onclick="multiShiftRight()">
                        Multi-Shift Right →→
                    </button>
                </div>
                
                <div id="shiftHistory" style="margin: 20px 0;">
                    <h3>Shift History</h3>
                    <div id="historyLog" style="background: #f8f9fa; padding: 15px; border-radius: 10px; max-height: 200px; overflow-y: auto;">
                        <p style="color: #999;">No operations yet. Try shifting!</p>
                    </div>
                </div>
                
                <div id="overflowAlert" class="visual-explanation" style="display: none;">
                    <h3>⚠️ Overflow Detected!</h3>
                    <p>The leftmost bit (1) was lost during the shift. This means:</p>
                    <ul>
                        <li>Expected result: <span id="expectedResult"></span></li>
                        <li>Actual result: <span id="actualResult"></span></li>
                        <li>Lost value: <span id="lostValue"></span></li>
                    </ul>
                </div>
            </div>
            
            <!-- Challenges Tab -->
            <div id="challenges" class="tab-content">
                <h2>🏆 Binary Shift Challenges</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Challenges Complete</h4>
                        <div class="stat-value" id="challengesComplete">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>Perfect Scores</h4>
                        <div class="stat-value" id="perfectScores">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>Current Streak</h4>
                        <div class="stat-value" id="currentStreak">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>Total Points</h4>
                        <div class="stat-value" id="totalPoints">0</div>
                    </div>
                </div>
                
                <div id="challengeContainer">
                    <!-- Challenges will be loaded here -->
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn-primary" onclick="loadNewChallenge()">🎯 New Challenge</button>
                    <button class="btn-primary" onclick="resetChallenges()">🔄 Reset Progress</button>
                </div>
                
                <div id="achievements" style="margin: 20px 0;">
                    <h3>🏅 Achievements</h3>
                    <div id="achievementList"></div>
                </div>
            </div>
            
            <!-- Learn Tab -->
            <div id="learn" class="tab-content">
                <h2>📚 Master Binary Shifts</h2>
                
                <div class="visual-explanation">
                    <h3>🔄 Binary Shift Left</h3>
                    <p>When you shift left:</p>
                    <ol>
                        <li>All bits move one position to the left</li>
                        <li>A 0 is added on the right</li>
                        <li>The leftmost bit falls off (potential overflow!)</li>
                        <li>The number is multiplied by 2</li>
                    </ol>
                    <div style="text-align: center; margin: 20px 0;">
                        <code style="font-size: 18px;">00101100 → 01011000</code><br>
                        <strong>44 × 2 = 88</strong>
                    </div>
                </div>
                
                <div class="visual-explanation" style="background: #fff3cd; border-left-color: #ffc107;">
                    <h3>➡️ Binary Shift Right</h3>
                    <p>When you shift right:</p>
                    <ol>
                        <li>All bits move one position to the right</li>
                        <li>A 0 is added on the left</li>
                        <li>The rightmost bit is lost</li>
                        <li>The number is divided by 2 (integer division)</li>
                    </ol>
                    <div style="text-align: center; margin: 20px 0;">
                        <code style="font-size: 18px;">00101101 → 00010110</code><br>
                        <strong>45 ÷ 2 = 22 (remainder lost)</strong>
                    </div>
                </div>
                
                <div class="visual-explanation" style="background: #f8d7da; border-left-color: #dc3545;">
                    <h3>⚠️ Understanding Overflow</h3>
                    <p>Overflow occurs when shifting causes data loss:</p>
                    <ul>
                        <li><strong>Left shift overflow:</strong> When the leftmost bit is 1 and gets shifted out</li>
                        <li><strong>Example:</strong> 10000001 (129) shifted left loses the '1', giving 00000010 (2) instead of 258</li>
                        <li><strong>Prevention:</strong> Check if the leftmost bit is 1 before shifting left</li>
                    </ul>
                </div>
                
                <div class="challenge-box">
                    <h3>🎯 Quick Practice</h3>
                    <p>Try these examples in the playground:</p>
                    <ul>
                        <li>Shift 00001000 left three times. What do you get?</li>
                        <li>Start with 10000000 and shift left. What happens?</li>
                        <li>Take 11111111 and shift right twice. What's the result?</li>
                    </ul>
                </div>
            </div>
            
            <!-- Quiz Tab -->
            <div id="quiz" class="tab-content">
                <h2>🧠 Test Your Knowledge</h2>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="quizProgress" style="width: 0%"></div>
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <h3>Score: <span id="quizScore">0</span> / <span id="totalQuestions">0</span></h3>
                </div>
                
                <div id="quizContainer">
                    <!-- Quiz questions will be loaded here -->
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button class="btn-primary" onclick="resetQuiz()">🔄 Reset Quiz</button>
                    <button class="btn-primary" onclick="showQuizSummary()">📊 View Summary</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentBinary = '00010110';
        let animationSpeed = 500;
        let historyLog = [];
        let challengeStats = {
            complete: 0,
            perfect: 0,
            streak: 0,
            points: 0
        };
        let achievements = [];
        let quizScore = 0;
        let questionsAnswered = 0;
        let quizAnswers = [];
        
        const challenges = [
            {
                title: "Double or Nothing",
                description: "Start with 00000101 and use shifts to reach exactly 40",
                start: '00000101',
                target: 40,
                points: 100
            },
            {
                title: "Overflow Challenge",
                description: "Demonstrate an overflow by shifting 10100000",
                start: '10100000',
                action: 'shift left and observe overflow',
                points: 150
            },
            {
                title: "Power of Two",
                description: "Create the number 64 using only left shifts from 00000001",
                start: '00000001',
                target: 64,
                points: 200
            },
            {
                title: "Division Master",
                description: "Start with 11110000 and use right shifts to reach 15",
                start: '11110000',
                target: 15,
                points: 150
            },
            {
                title: "Bit Manipulation Pro",
                description: "Transform 00110011 to exactly 204 using shifts",
                start: '00110011',
                target: 204,
                points: 250
            }
        ];
        
        const quizQuestions = [
            {
                question: "What happens when you shift 00001100 one place to the left?",
                options: [
                    "00000110 (decimal 6)",
                    "00011000 (decimal 24)",
                    "00000011 (decimal 3)",
                    "00110000 (decimal 48)"
                ],
                correct: 1,
                explanation: "Shifting left multiplies by 2. 00001100 (12) becomes 00011000 (24)."
            },
            {
                question: "If you shift 01000000 left by one place, what happens?",
                options: [
                    "10000000 (decimal 128)",
                    "00100000 (decimal 32)",
                    "Overflow occurs, result is 10000000",
                    "Overflow warning, but calculation is correct: 128"
                ],
                correct: 3,
                explanation: "The leftmost 0 is lost, but since it was 0, the math is still correct: 64 × 2 = 128."
            },
            {
                question: "What is the result of shifting 10101000 right by one place?",
                options: [
                    "01010100 (decimal 84)",
                    "11010100 (decimal 212)",
                    "01010000 (decimal 80)",
                    "10101001 (decimal 169)"
                ],
                correct: 0,
                explanation: "Right shift divides by 2: 10101000 (168) becomes 01010100 (84)."
            },
            {
                question: "How many left shifts multiply a number by 8?",
                options: [
                    "2 shifts",
                    "3 shifts",
                    "4 shifts",
                    "8 shifts"
                ],
                correct: 1,
                explanation: "Each left shift multiplies by 2. Three shifts: ×2 ×2 ×2 = ×8."
            },
            {
                question: "What is overflow in binary shifting?",
                options: [
                    "When the result is too large",
                    "When a bit is lost during shifting",
                    "When memory runs out",
                    "When you shift too many times"
                ],
                correct: 1,
                explanation: "Overflow occurs when bits are lost during shifting operations."
            },
            {
                question: "If 00010010 (18) is shifted right twice, what's the result?",
                options: [
                    "00000100 (decimal 4)",
                    "00001001 (decimal 9)",
                    "01001000 (decimal 72)",
                    "00000010 (decimal 2)"
                ],
                correct: 0,
                explanation: "Two right shifts divide by 4: 18 ÷ 4 = 4.5 → 4 (integer division)."
            },
            {
                question: "Which statement about binary shifts is FALSE?",
                options: [
                    "Left shift always doubles correctly",
                    "Right shift performs integer division",
                    "Both shifts can lose data",
                    "Shifts are faster than multiplication"
                ],
                correct: 0,
                explanation: "Left shift doesn't always double correctly - overflow can cause incorrect results."
            },
            {
                question: "What's the maximum value before left shift causes meaningful overflow?",
                options: [
                    "01111111 (127)",
                    "10000000 (128)",
                    "11111111 (255)",
                    "01000000 (64)"
                ],
                correct: 0,
                explanation: "01111111 (127) is the largest where the leftmost bit is 0. Shifting left would cause overflow."
            },
            {
                question: "To divide by 16, how many right shifts are needed?",
                options: [
                    "2 shifts",
                    "3 shifts",
                    "4 shifts",
                    "16 shifts"
                ],
                correct: 2,
                explanation: "16 = 2⁴, so 4 right shifts divide by 16."
            },
            {
                question: "What happens to 11111111 after one left shift?",
                options: [
                    "11111110 (254)",
                    "11111111 (stays same)",
                    "01111110 (126)",
                    "Overflow: leftmost 1 lost"
                ],
                correct: 3,
                explanation: "The leftmost 1 is lost, resulting in 11111110 (254) instead of 510."
            }
        ];
        
        let currentChallengeIndex = -1;
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'quiz') {
                loadQuiz();
            } else if (tabName === 'challenges') {
                updateChallengeStats();
            }
        }
        
        function updateDisplay() {
            const input = document.getElementById('binaryInput').value;
            if (!/^[01]{8}$/.test(input)) {
                alert('Please enter exactly 8 binary digits (0 or 1)');
                return;
            }
            currentBinary = input;
            displayBinary();
            addToHistory(`Set binary to ${currentBinary}`);
        }
        
        function randomBinary() {
            currentBinary = '';
            for (let i = 0; i < 8; i++) {
                currentBinary += Math.random() < 0.5 ? '0' : '1';
            }
            document.getElementById('binaryInput').value = currentBinary;
            displayBinary();
            addToHistory(`Generated random binary: ${currentBinary}`);
        }
        
        function toggleBit(index) {
            const bits = currentBinary.split('');
            bits[index] = bits[index] === '0' ? '1' : '0';
            currentBinary = bits.join('');
            document.getElementById('binaryInput').value = currentBinary;
            displayBinary();
        }
        
        function displayBinary() {
            const bits = currentBinary.split('');
            const bitElements = document.querySelectorAll('.bit span:nth-child(2)');
            
            bits.forEach((bit, index) => {
                bitElements[index].textContent = bit;
                if (bit === '1') {
                    bitElements[index].parentElement.classList.add('active');
                } else {
                    bitElements[index].parentElement.classList.remove('active');
                }
            });
            
            const decimal = parseInt(currentBinary, 2);
            const hex = decimal.toString(16).toUpperCase();
            
            document.getElementById('binaryValue').textContent = currentBinary;
            document.getElementById('decimalValue').textContent = decimal;
            document.getElementById('hexValue').textContent = '0x' + hex.padStart(2, '0');
        }
        
        function shiftLeft() {
            const oldDecimal = parseInt(currentBinary, 2);
            const overflow = currentBinary[0] === '1';
            const oldLeftmostBit = currentBinary[0];
            
            // Animate
            const bitElements = document.querySelectorAll('.bit');
            bitElements.forEach(el => el.classList.add('shifting-left'));
            
            setTimeout(() => {
                currentBinary = currentBinary.substring(1) + '0';
                displayBinary();
                
                const newDecimal = parseInt(currentBinary, 2);
                const expectedDecimal = oldDecimal * 2;
                
                let message = `Left shift: ${oldDecimal} × 2 = `;
                
                if (overflow) {
                    message += `${expectedDecimal} (expected) but got ${newDecimal} due to overflow`;
                    showOverflowAlert(expectedDecimal, newDecimal, oldLeftmostBit === '1' ? 128 : 0);
                    checkAchievement('overflow_master');
                } else {
                    message += `${newDecimal} ✓`;
                    document.getElementById('overflowAlert').style.display = 'none';
                }
                
                addToHistory(message);
                bitElements.forEach(el => el.classList.remove('shifting-left'));
                
                if (overflow && oldLeftmostBit === '1') {
                    bitElements[0].classList.add('overflow');
                    setTimeout(() => bitElements[0].classList.remove('overflow'), 1000);
                }
            }, animationSpeed);
        }
        
        function shiftRight() {
            const oldDecimal = parseInt(currentBinary, 2);
            const lostBit = currentBinary[7];
            
            // Animate
            const bitElements = document.querySelectorAll('.bit');
            bitElements.forEach(el => el.classList.add('shifting-right'));
            
            setTimeout(() => {
                currentBinary = '0' + currentBinary.substring(0, 7);
                displayBinary();
                
                const newDecimal = parseInt(currentBinary, 2);
                const message = `Right shift: ${oldDecimal} ÷ 2 = ${newDecimal}` + 
                               (lostBit === '1' ? ' (remainder lost)' : ' ✓');
                
                addToHistory(message);
                bitElements.forEach(el => el.classList.remove('shifting-right'));
                document.getElementById('overflowAlert').style.display = 'none';
            }, animationSpeed);
        }
        
        function multiShiftLeft() {
            const shifts = prompt('How many left shifts? (1-8)', '2');
            if (!shifts || isNaN(shifts) || shifts < 1 || shifts > 8) return;
            
            let count = 0;
            const interval = setInterval(() => {
                shiftLeft();
                count++;
                if (count >= parseInt(shifts)) {
                    clearInterval(interval);
                    checkAchievement('multi_shifter');
                }
            }, animationSpeed + 200);
        }
        
        function multiShiftRight() {
            const shifts = prompt('How many right shifts? (1-8)', '2');
            if (!shifts || isNaN(shifts) || shifts < 1 || shifts > 8) return;
            
            let count = 0;
            const interval = setInterval(() => {
                shiftRight();
                count++;
                if (count >= parseInt(shifts)) {
                    clearInterval(interval);
                }
            }, animationSpeed + 200);
        }
        
        function showOverflowAlert(expected, actual, lost) {
            const alert = document.getElementById('overflowAlert');
            alert.style.display = 'block';
            document.getElementById('expectedResult').textContent = expected;
            document.getElementById('actualResult').textContent = actual;
            document.getElementById('lostValue').textContent = lost;
        }
        
        function addToHistory(message) {
            const timestamp = new Date().toLocaleTimeString();
            historyLog.unshift(`[${timestamp}] ${message}`);
            if (historyLog.length > 10) historyLog.pop();
            
            const historyDiv = document.getElementById('historyLog');
            historyDiv.innerHTML = historyLog.map(log => `<div style="padding: 5px 0; border-bottom: 1px solid #eee;">${log}</div>`).join('');
        }
        
        function loadNewChallenge() {
            currentChallengeIndex = (currentChallengeIndex + 1) % challenges.length;
            const challenge = challenges[currentChallengeIndex];
            
            const container = document.getElementById('challengeContainer');
            container.innerHTML = `
                <div class="challenge-box">
                    <h3>${challenge.title} (${challenge.points} points)</h3>
                    <p>${challenge.description}</p>
                    <div style="margin: 20px 0;">
                        <strong>Starting binary:</strong> ${challenge.start}<br>
                        ${challenge.target ? `<strong>Target decimal:</strong> ${challenge.target}` : ''}
                    </div>
                    <button class="btn-primary" onclick="startChallenge('${challenge.start}')">Start Challenge</button>
                    
                    <div id="challengeWidget" style="display: none; margin-top: 20px; padding: 20px; background: #e3f2fd; border-radius: 10px; border: 2px solid #2196f3;">
                        <h4 style="margin-top: 0; color: #1976d2;">🎮 Challenge Active!</h4>
                        <div style="display: flex; justify-content: center; align-items: center; margin: 20px 0;">
                            <div id="challengeBitDisplay" style="display: flex; gap: 5px; font-family: monospace; font-size: 24px; font-weight: bold;"></div>
                        </div>
                        <div style="text-align: center; margin: 15px 0;">
                            <div id="challengeCurrentValue" style="font-size: 18px; margin-bottom: 10px;"></div>
                            <div id="challengeInstructions" style="color: #1976d2; font-weight: bold;"></div>
                        </div>
                        <div style="text-align: center;">
                            <button class="btn-shift" onclick="challengeShiftLeft()">← Shift Left</button>
                            <button class="btn-shift" onclick="challengeShiftRight()">Shift Right →</button>
                            <button class="btn-primary" style="background: #f44336; margin-left: 20px;" onclick="abandonChallenge()">Abandon</button>
                        </div>
                        <div id="challengeProgress" style="margin-top: 15px; text-align: center; font-weight: bold;"></div>
                    </div>
                </div>
            `;
        }
        
        function startChallenge(startBinary) {
            currentBinary = startBinary;
            document.getElementById('binaryInput').value = currentBinary;
            displayBinary();
            
            // Show the challenge widget
            const widget = document.getElementById('challengeWidget');
            widget.style.display = 'block';
            
            // Update widget display
            updateChallengeWidget();
            
            const challenge = challenges[currentChallengeIndex];
            let instructions = '';
            
            if (challenge.title === "Overflow Challenge") {
                instructions = "Click 'Shift Left' to see the overflow happen!";
            } else if (challenge.target) {
                instructions = `Use the shift buttons to reach ${challenge.target}`;
            }
            
            document.getElementById('challengeInstructions').textContent = instructions;
            
            addToHistory(`Challenge "${challenge.title}" started with ${startBinary}`);
        }
        
        function updateChallengeWidget() {
            const bits = currentBinary.split('');
            const bitDisplay = document.getElementById('challengeBitDisplay');
            bitDisplay.innerHTML = bits.map(bit => 
                `<span style="padding: 5px 10px; background: ${bit === '1' ? '#2196f3' : '#f5f5f5'}; 
                color: ${bit === '1' ? 'white' : 'black'}; border-radius: 5px;">${bit}</span>`
            ).join('');
            
            const decimal = parseInt(currentBinary, 2);
            document.getElementById('challengeCurrentValue').textContent = `Binary: ${currentBinary} = Decimal: ${decimal}`;
            
            // Check if challenge is complete
            const challenge = challenges[currentChallengeIndex];
            if (challenge.target && decimal === challenge.target) {
                completeChallenge();
            }
        }
        
        function challengeShiftLeft() {
            const oldDecimal = parseInt(currentBinary, 2);
            const overflow = currentBinary[0] === '1';
            
            currentBinary = currentBinary.substring(1) + '0';
            updateChallengeWidget();
            displayBinary(); // Update main display too
            
            const newDecimal = parseInt(currentBinary, 2);
            
            if (challenges[currentChallengeIndex].title === "Overflow Challenge" && overflow) {
                document.getElementById('challengeProgress').innerHTML = 
                    `<span style="color: #4caf50;">✓ Overflow demonstrated! ${oldDecimal} × 2 = ${oldDecimal * 2} (expected) but got ${newDecimal}</span>`;
                setTimeout(() => completeChallenge(), 2000);
            }
        }
        
        function challengeShiftRight() {
            currentBinary = '0' + currentBinary.substring(0, 7);
            updateChallengeWidget();
            displayBinary();
        }
        
        function completeChallenge() {
            const challenge = challenges[currentChallengeIndex];
            challengeStats.complete++;
            challengeStats.points += challenge.points;
            challengeStats.streak++;
            updateChallengeStats();
            
            document.getElementById('challengeProgress').innerHTML = 
                `<span style="color: #4caf50; font-size: 20px;">🎉 Challenge Complete! +${challenge.points} points</span>`;
            
            checkAchievement('challenge_complete');
            
            setTimeout(() => {
                document.getElementById('challengeWidget').style.display = 'none';
                loadNewChallenge();
            }, 3000);
        }
        
        function abandonChallenge() {
            document.getElementById('challengeWidget').style.display = 'none';
            challengeStats.streak = 0;
            updateChallengeStats();
        }
        
        function updateChallengeStats() {
            document.getElementById('challengesComplete').textContent = challengeStats.complete;
            document.getElementById('perfectScores').textContent = challengeStats.perfect;
            document.getElementById('currentStreak').textContent = challengeStats.streak;
            document.getElementById('totalPoints').textContent = challengeStats.points;
        }
        
        function checkAchievement(type) {
            const achievementMap = {
                'overflow_master': '🌊 Overflow Master - Discovered binary overflow!',
                'multi_shifter': '🚀 Multi-Shifter - Performed multiple shifts!',
                'challenge_complete': '🏆 Challenge Champion - Completed a challenge!',
                'perfect_quiz': '💯 Perfect Score - Aced the quiz!',
                'bit_flipper': '🔄 Bit Flipper - Toggled 50 bits!'
            };
            
            if (!achievements.includes(type)) {
                achievements.push(type);
                const achievementList = document.getElementById('achievementList');
                const newAchievement = document.createElement('span');
                newAchievement.className = 'achievement';
                newAchievement.textContent = achievementMap[type];
                achievementList.appendChild(newAchievement);
            }
        }
        
        function resetChallenges() {
            challengeStats = { complete: 0, perfect: 0, streak: 0, points: 0 };
            achievements = [];
            updateChallengeStats();
            document.getElementById('achievementList').innerHTML = '';
        }
        
        function loadQuiz() {
            const container = document.getElementById('quizContainer');
            container.innerHTML = '';
            
            quizQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.innerHTML = `
                    <h3>Question ${index + 1}</h3>
                    <p>${q.question}</p>
                    <div id="options-${index}">
                        ${q.options.map((option, optIndex) => `
                            <div class="quiz-option" onclick="checkAnswer(${index}, ${optIndex})">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    <div id="feedback-${index}" class="feedback-box" style="display: none;"></div>
                `;
                container.appendChild(questionDiv);
            });
            
            updateQuizProgress();
        }
        
        function checkAnswer(questionIndex, selectedIndex) {
            const question = quizQuestions[questionIndex];
            const options = document.querySelectorAll(`#options-${questionIndex} .quiz-option`);
            const feedback = document.getElementById(`feedback-${questionIndex}`);
            
            if (quizAnswers[questionIndex] !== undefined) return; // Already answered
            
            options.forEach(option => option.style.pointerEvents = 'none');
            questionsAnswered++;
            quizAnswers[questionIndex] = selectedIndex;
            
            if (selectedIndex === question.correct) {
                options[selectedIndex].classList.add('correct');
                feedback.className = 'feedback-box correct';
                feedback.innerHTML = '✓ Correct! ' + question.explanation;
                quizScore++;
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[question.correct].classList.add('correct');
                feedback.className = 'feedback-box incorrect';
                feedback.innerHTML = '✗ Incorrect. ' + question.explanation;
            }
            
            feedback.style.display = 'block';
            updateQuizProgress();
            
            if (questionsAnswered === quizQuestions.length && quizScore === quizQuestions.length) {
                checkAchievement('perfect_quiz');
            }
        }
        
        function updateQuizProgress() {
            const progress = (questionsAnswered / quizQuestions.length) * 100;
            document.getElementById('quizProgress').style.width = progress + '%';
            document.getElementById('quizScore').textContent = quizScore;
            document.getElementById('totalQuestions').textContent = questionsAnswered;
        }
        
        function resetQuiz() {
            quizScore = 0;
            questionsAnswered = 0;
            quizAnswers = [];
            loadQuiz();
        }
        
        function showQuizSummary() {
            if (questionsAnswered === 0) {
                alert('Complete the quiz first!');
                return;
            }
            
            const percentage = Math.round((quizScore / questionsAnswered) * 100);
            const grade = percentage >= 90 ? 'A*' : percentage >= 80 ? 'A' : percentage >= 70 ? 'B' : percentage >= 60 ? 'C' : 'D';
            
            alert(`Quiz Summary:\n\nScore: ${quizScore}/${questionsAnswered}\nPercentage: ${percentage}%\nGrade: ${grade}\n\n${percentage >= 80 ? 'Excellent work!' : 'Keep practicing!'}`);
        }
        
        // Speed control
        document.getElementById('speedSlider').addEventListener('input', function(e) {
            animationSpeed = parseInt(e.value);
            const labels = ['Very Slow', 'Slow', 'Medium', 'Fast', 'Very Fast'];
            const index = Math.floor((e.value - 100) / 225);
            document.getElementById('speedLabel').textContent = labels[index];
        });
        
        // Initialize
        displayBinary();
        loadNewChallenge();
        
        // Check challenge completion after operations
        const originalShiftLeft = shiftLeft;
        const originalShiftRight = shiftRight;
        
        window.shiftLeft = function() {
            originalShiftLeft();
            setTimeout(() => {
                if (window.checkChallengeComplete) {
                    window.checkChallengeComplete();
                }
            }, animationSpeed + 100);
        };
        
        window.shiftRight = function() {
            originalShiftRight();
            setTimeout(() => {
                if (window.checkChallengeComplete) {
                    window.checkChallengeComplete();
                }
            }, animationSpeed + 100);
        };
    </script>
</body>
</html>