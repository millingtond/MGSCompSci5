<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Compression - GCSE Computer Science</title>
    <style>
        /* Global Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --primary-color: #667eea;
            --secondary-color: #48bb78;
            --danger-color: #f56565;
            --warning-color: #ed8936;
            --dark-color: #2d3748;
            --light-color: #f7fafc;
            --font-size: 16px;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-success: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: var(--font-size);
            line-height: 1.6;
            color: var(--dark-color);
            background: linear-gradient(to bottom, #f7fafc, #e2e8f0);
            transition: all 0.3s ease;
            min-height: 100vh;
            overflow-x: hidden;
        }

        body.dark-mode {
            background: linear-gradient(to bottom, #1a202c, #2d3748);
            color: #e2e8f0;
        }

        body.dark-mode .section {
            background-color: #2d3748;
            color: #e2e8f0;
        }

        body.high-contrast {
            background-color: #000;
            color: #fff;
        }

        body.high-contrast .section {
            background-color: #111;
            border: 2px solid #fff;
        }

        body.dyslexic-font {
            font-family: 'OpenDyslexic', Arial, sans-serif;
        }

        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(102, 126, 234, 0.5); }
            50% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.8), 0 0 40px rgba(102, 126, 234, 0.5); }
            100% { box-shadow: 0 0 5px rgba(102, 126, 234, 0.5); }
        }

        /* Container and Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Header */
        .header {
            background: var(--gradient-1);
            color: white;
            padding: 40px;
            text-align: center;
            border-radius: 20px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            animation: float 3s ease-in-out infinite;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        /* XP and Level Display */
        .xp-container {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 2;
        }

        .level-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.3);
            padding: 5px 15px;
            border-radius: 20px;
            margin-bottom: 10px;
            font-weight: bold;
            animation: pulse 2s ease-in-out infinite;
        }

        .xp-bar {
            width: 250px;
            height: 25px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .xp-fill {
            height: 100%;
            background: var(--gradient-success);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .xp-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            from { transform: translateX(-100%); }
            to { transform: translateX(100%); }
        }

        /* Navigation */
        .nav-container {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            position: sticky;
            top: 20px;
            z-index: 100;
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
        }

        body.dark-mode .nav-container {
            background-color: rgba(45, 55, 72, 0.95);
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            background: var(--gradient-1);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .nav-btn:hover::before {
            width: 100%;
            height: 100%;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .nav-btn:disabled {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: not-allowed;
            box-shadow: none;
        }

        .section-indicator {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            align-items: center;
        }

        .section-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: #cbd5e0;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .section-dot::after {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border-radius: 50%;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .section-dot.active {
            background: var(--gradient-1);
            transform: scale(1.2);
        }

        .section-dot.active::after {
            border-color: rgba(102, 126, 234, 0.5);
        }

        .section-dot.completed {
            background: var(--gradient-success);
            animation: pulse 2s ease-in-out infinite;
        }

        .section-dot:hover {
            transform: scale(1.3);
        }

        /* Timer Display */
        .timer-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-display.warning {
            background: var(--gradient-2);
            animation: pulse 1s ease-in-out infinite;
        }

        /* Sections */
        .section {
            background-color: white;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.1);
            display: none;
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-1);
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .section h2 {
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 2.5em;
            position: relative;
            display: inline-block;
        }

        .section h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 60px;
            height: 4px;
            background: var(--gradient-1);
            border-radius: 2px;
        }

        .section h3 {
            color: var(--dark-color);
            margin: 30px 0 15px;
            font-size: 1.8em;
        }

        /* Interactive Elements */
        .task-box {
            background: linear-gradient(to right bottom, #f8f9fa, #e9ecef);
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            border-left: 5px solid;
            border-image: var(--gradient-1) 1;
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .task-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .task-box::before {
            content: '‚ú®';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            opacity: 0.5;
        }

        /* Input Fields */
        .input-field {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            margin: 10px 0;
            transition: all 0.3s;
            background-color: white;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        /* Buttons */
        .btn {
            background: var(--gradient-1);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 8px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .btn:hover::after {
            width: 300%;
            height: 300%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--gradient-success);
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            box-shadow: 0 4px 15px rgba(245, 101, 101, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            box-shadow: 0 4px 15px rgba(237, 137, 54, 0.3);
        }

        /* Drag and Drop */
        .drag-container {
            display: flex;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .drag-source {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            min-height: 100px;
            flex: 1;
        }

        .drag-item {
            background: var(--gradient-1);
            color: white;
            padding: 18px 25px;
            border-radius: 30px;
            cursor: move;
            user-select: none;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .drag-item::before {
            content: '‚úã';
            position: absolute;
            top: 50%;
            left: -30px;
            transform: translateY(-50%);
            opacity: 0;
            transition: all 0.3s;
        }

        .drag-item:hover::before {
            left: 10px;
            opacity: 0.7;
        }

        .drag-item:hover {
            transform: scale(1.1) rotate(2deg);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .drag-item.dragging {
            opacity: 0.5;
            transform: scale(0.9);
            cursor: grabbing;
        }

        .drop-zone {
            min-height: 70px;
            border: 3px dashed #cbd5e0;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            background-color: #f8f9fa;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .drop-zone::before {
            content: 'Drop here';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.3;
            font-size: 14px;
            pointer-events: none;
        }

        .drop-zone.drag-over {
            background-color: #e0e7ff;
            border-color: var(--primary-color);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .drop-zone.drag-over::before {
            content: '‚úì Release to drop';
            opacity: 0.8;
            color: var(--primary-color);
        }

        .drop-zone.correct {
            background: linear-gradient(to right, #d4f1d4, #c6f6d5);
            border-color: var(--secondary-color);
            animation: pulse 0.5s ease;
        }

        .drop-zone.correct::before {
            content: '‚úì Correct!';
            color: var(--secondary-color);
            opacity: 1;
        }

        .drop-zone.incorrect {
            background: linear-gradient(to right, #fed7d7, #fecaca);
            border-color: var(--danger-color);
            animation: shake 0.5s;
        }

        .drop-zone.incorrect::before {
            content: '‚úó Try again';
            color: var(--danger-color);
            opacity: 1;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Quiz Elements */
        .quiz-option {
            display: block;
            width: 100%;
            text-align: left;
            padding: 18px 25px;
            margin: 12px 0;
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            border: 2px solid transparent;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .quiz-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s;
        }

        .quiz-option:hover::before {
            left: 100%;
        }

        .quiz-option:hover {
            background: linear-gradient(to right, #e0e7ff, #ddd6fe);
            border-color: var(--primary-color);
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .quiz-option.selected {
            background: var(--gradient-1);
            color: white;
            border-color: var(--primary-color);
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .quiz-option.correct {
            background: var(--gradient-success);
            color: white;
            border-color: var(--secondary-color);
            animation: pulse 0.5s ease;
        }

        .quiz-option.correct::after {
            content: '‚úì';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            animation: fadeIn 0.3s ease;
        }

        .quiz-option.incorrect {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
            border-color: var(--danger-color);
            animation: shake 0.5s;
        }

        .quiz-option.incorrect::after {
            content: '‚úó';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            animation: fadeIn 0.3s ease;
        }

        /* Feedback Messages */
        .feedback {
            padding: 20px 25px;
            border-radius: 15px;
            margin: 20px 0;
            display: none;
            position: relative;
            animation: slideInLeft 0.5s ease;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .feedback::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            border-radius: 15px 0 0 15px;
        }

        .feedback.success {
            background: linear-gradient(to right, #d4edda, #c6f6d5);
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .feedback.success::before {
            background: var(--gradient-success);
        }

        .feedback.error {
            background: linear-gradient(to right, #fed7d7, #fecaca);
            color: #742a2a;
            border: 1px solid #fc8181;
        }

        .feedback.error::before {
            background: linear-gradient(135deg, #f56565, #e53e3e);
        }

        .feedback.warning {
            background: linear-gradient(to right, #fefcbf, #faf089);
            color: #744210;
            border: 1px solid #f6e05e;
        }

        .feedback.warning::before {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
        }

        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            padding: 25px 35px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            animation: slideInRight 0.5s ease;
            border: 3px solid;
            border-image: var(--gradient-1) 1;
            max-width: 400px;
        }

        .achievement-popup::before {
            content: 'üèÜ';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            animation: float 2s ease-in-out infinite;
        }

        .achievement-popup h4 {
            margin-bottom: 10px;
            font-size: 1.4em;
            color: var(--primary-color);
            text-align: center;
            margin-top: 10px;
        }

        .achievement-popup p {
            text-align: center;
            color: var(--dark-color);
            margin: 0;
        }

        /* Progress Bar for Achievements */
        .achievement-progress {
            margin-top: 15px;
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .achievement-progress-fill {
            height: 100%;
            background: var(--gradient-1);
            width: 0%;
            transition: width 1s ease;
        }

        /* Canvas for Drawing */
        .canvas-container {
            border: 3px solid #e2e8f0;
            border-radius: 15px;
            margin: 30px 0;
            position: relative;
            background-color: white;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        #drawingCanvas {
            cursor: crosshair;
            display: block;
            touch-action: none;
        }

        .canvas-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            flex-direction: column;
        }

        .canvas-tool {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .canvas-tool:hover {
            border-color: var(--primary-color);
            transform: scale(1.1);
        }

        .canvas-tool.active {
            background: var(--gradient-1);
            color: white;
            border-color: var(--primary-color);
        }

        /* Color Picker */
        .color-picker {
            display: flex;
            gap: 5px;
            padding: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
            border: 3px solid transparent;
        }

        .color-option:hover {
            transform: scale(1.2);
        }

        .color-option.selected {
            border-color: var(--primary-color);
            transform: scale(1.2);
        }

        /* Accessibility Controls */
        .accessibility-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.2);
            z-index: 999;
            transition: all 0.3s;
        }

        .accessibility-controls.collapsed {
            padding: 15px;
        }

        .accessibility-controls.collapsed .access-buttons {
            display: none;
        }

        .access-toggle {
            background: var(--gradient-1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .access-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .accessibility-controls button {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 30px;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .accessibility-controls button:hover {
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            border-color: var(--primary-color);
            transform: translateX(5px);
        }

        /* Simulation Container */
        .simulation-container {
            background: linear-gradient(to bottom right, #f8f9fa, #e9ecef);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .simulation-container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.05) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }

        .pixel-grid {
            display: grid;
            gap: 3px;
            margin: 30px auto;
            width: fit-content;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }

        .pixel {
            width: 35px;
            height: 35px;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        .pixel::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s;
        }

        .pixel:hover::before {
            width: 100%;
            height: 100%;
        }

        .pixel:hover {
            transform: scale(1.2);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 10;
        }

        /* Binary Display */
        .binary-display {
            font-family: 'Courier New', monospace;
            background: #1a202c;
            color: #68d391;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            overflow-x: auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            position: relative;
        }

        .binary-display::before {
            content: 'BINARY';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            opacity: 0.5;
            letter-spacing: 2px;
        }

        .binary-bit {
            display: inline-block;
            padding: 5px;
            margin: 2px;
            background: rgba(104, 211, 145, 0.1);
            border-radius: 3px;
            transition: all 0.2s;
        }

        .binary-bit:hover {
            background: rgba(104, 211, 145, 0.3);
            transform: scale(1.2);
        }

        /* Feedback Form */
        .feedback-form {
            position: fixed;
            bottom: 100px;
            right: 30px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
            z-index: 998;
            width: 350px;
            animation: slideInRight 0.5s ease;
        }

        .feedback-form h4 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .feedback-form textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            transition: all 0.3s;
        }

        .feedback-form textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .feedback-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: var(--gradient-3);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 30px;
            cursor: pointer;
            z-index: 997;
            font-weight: bold;
            box-shadow: 0 5px 20px rgba(79, 172, 254, 0.3);
            transition: all 0.3s;
        }

        .feedback-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(79, 172, 254, 0.4);
        }

        /* Hint System */
        .hint-container {
            margin: 20px 0;
            position: relative;
        }

        .hint-btn {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
        }

        .hint-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.4);
        }

        .hint-content {
            background: linear-gradient(to right, #fef3c7, #fde68a);
            color: #78350f;
            padding: 20px;
            border-radius: 15px;
            margin-top: 15px;
            display: none;
            border-left: 4px solid #f59e0b;
            animation: slideInLeft 0.5s ease;
            position: relative;
        }

        .hint-content::before {
            content: 'üí°';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
        }

        /* Progressive Hints */
        .hint-levels {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .hint-level {
            background: #e5e7eb;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .hint-level.unlocked {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
        }

        .hint-level:hover {
            transform: scale(1.1);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mark Scheme */
        .mark-scheme {
            background: linear-gradient(to right, #d1fae5, #a7f3d0);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            display: none;
            border-left: 5px solid #10b981;
            animation: slideInLeft 0.5s ease;
            position: relative;
        }

        .mark-scheme::before {
            content: '‚úì';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 30px;
            color: #10b981;
            opacity: 0.3;
        }

        .mark-scheme h4 {
            color: #065f46;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .mark-scheme ul {
            list-style: none;
            padding: 0;
        }

        .mark-scheme li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
        }

        .mark-scheme li::before {
            content: '‚Ä¢';
            position: absolute;
            left: 10px;
            color: #10b981;
            font-size: 20px;
        }

        /* Extension Box */
        .extension-box {
            background: linear-gradient(135deg, #e9d5ff, #c084fc);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            border-left: 5px solid #9333ea;
            position: relative;
            color: white;
            box-shadow: 0 5px 25px rgba(147, 51, 234, 0.3);
        }

        .extension-box::before {
            content: 'üöÄ';
            position: absolute;
            top: 30px;
            right: 30px;
            font-size: 40px;
            opacity: 0.5;
            animation: float 3s ease-in-out infinite;
        }

        .extension-box h3 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* Videos Section */
        .videos-section {
            background: linear-gradient(to right, #dbeafe, #bfdbfe);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            text-align: center;
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.2);
        }

        .video-placeholder {
            background: linear-gradient(135deg, #93c5fd, #60a5fa);
            height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            color: white;
            font-size: 1.2em;
            font-weight: 600;
        }

        .video-placeholder::before {
            content: '‚ñ∂';
            position: absolute;
            font-size: 60px;
            opacity: 0.3;
            animation: pulse 2s ease-in-out infinite;
        }

        /* Sound Wave Animation */
        .sound-wave {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            height: 60px;
            margin: 20px 0;
        }

        .wave-bar {
            width: 8px;
            background: var(--gradient-1);
            border-radius: 4px;
            animation: wave 1s ease-in-out infinite;
        }

        .wave-bar:nth-child(1) { height: 20px; animation-delay: 0s; }
        .wave-bar:nth-child(2) { height: 40px; animation-delay: 0.1s; }
        .wave-bar:nth-child(3) { height: 30px; animation-delay: 0.2s; }
        .wave-bar:nth-child(4) { height: 50px; animation-delay: 0.3s; }
        .wave-bar:nth-child(5) { height: 35px; animation-delay: 0.4s; }

        @keyframes wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.5); }
        }

        /* Compression Comparison Tool */
        .comparison-tool {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }

        .comparison-side {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: relative;
            transition: transform 0.3s;
        }

        .comparison-side:hover {
            transform: translateY(-5px);
        }

        .comparison-side h4 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .file-size-display {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin: 20px 0;
            animation: pulse 2s ease-in-out infinite;
        }

        /* Leaderboard */
        .leaderboard {
            background: linear-gradient(to bottom, #fef3c7, #fde68a);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            box-shadow: 0 5px 25px rgba(251, 191, 36, 0.2);
        }

        .leaderboard h3 {
            color: #78350f;
            margin-bottom: 20px;
            text-align: center;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: white;
            border-radius: 10px;
            margin: 10px 0;
            transition: all 0.3s;
        }

        .leaderboard-entry:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .leaderboard-rank {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary-color);
            width: 40px;
        }

        .leaderboard-entry:nth-child(1) .leaderboard-rank { color: #fbbf24; }
        .leaderboard-entry:nth-child(2) .leaderboard-rank { color: #9ca3af; }
        .leaderboard-entry:nth-child(3) .leaderboard-rank { color: #f59e0b; }

        /* Mini-Game Container */
        .mini-game {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .mini-game::before {
            content: 'üéÆ';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 40px;
            opacity: 0.3;
            animation: float 3s ease-in-out infinite;
        }

        .game-score {
            font-size: 2em;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .xp-container {
                position: static;
                margin-top: 20px;
                width: 100%;
                padding: 15px;
            }
            
            .xp-bar {
                width: 100%;
            }
            
            .nav-container {
                flex-direction: column;
                gap: 15px;
                position: static;
            }
            
            .nav-buttons {
                width: 100%;
                justify-content: space-between;
            }
            
            .drag-container {
                flex-direction: column;
            }
            
            .comparison-tool {
                grid-template-columns: 1fr;
            }
            
            .accessibility-controls {
                bottom: 70px;
                right: 20px;
            }
            
            .feedback-btn {
                bottom: 70px;
            }
            
            .achievement-popup {
                right: 10px;
                left: 10px;
                max-width: calc(100% - 20px);
            }
        }

        /* Anti-paste Message */
        .paste-warning {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
            padding: 30px 50px;
            border-radius: 20px;
            font-size: 1.4em;
            font-weight: bold;
            display: none;
            z-index: 2000;
            animation: shake 0.5s, pulse 2s ease-in-out infinite;
            box-shadow: 0 10px 40px rgba(245, 101, 101, 0.5);
            text-align: center;
        }

        .paste-warning::before {
            content: '‚ö†Ô∏è';
            display: block;
            font-size: 2em;
            margin-bottom: 10px;
        }

        /* Touch-friendly styles */
        @media (pointer: coarse) {
            .btn, .quiz-option, .drag-item {
                min-height: 48px;
                min-width: 48px;
                padding: 16px 24px;
            }
            
            .input-field {
                padding: 18px;
                font-size: 18px;
            }
        }

        /* Print styles */
        @media print {
            .nav-container, .accessibility-controls, .feedback-btn, .timer-display {
                display: none !important;
            }
            
            .section {
                page-break-inside: avoid;
                display: block !important;
                box-shadow: none;
                margin-bottom: 40px;
            }
            
            body {
                background: white;
            }
        }

        /* Sound Toggle */
        .sound-toggle {
            position: fixed;
            top: 30px;
            left: 30px;
            background: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s;
            z-index: 100;
        }

        .sound-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .sound-toggle.muted {
            background: #e5e7eb;
        }

        /* Dark Mode Toggle */
        .theme-toggle {
            position: fixed;
            top: 90px;
            left: 30px;
            background: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s;
            z-index: 100;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        body.dark-mode .theme-toggle {
            background: #4b5563;
            color: white;
        }

        /* Easter Egg */
        .easter-egg {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 50px;
            transition: bottom 0.5s;
            z-index: 2000;
        }

        .easter-egg.active {
            bottom: 50%;
            animation: float 2s ease-in-out;
        }

        /* Konami Code Indicator */
        .konami-progress {
            position: fixed;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            display: none;
            flex-direction: column;
            gap: 5px;
            z-index: 100;
        }

        .konami-key {
            width: 40px;
            height: 40px;
            background: #e5e7eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s;
        }

        .konami-key.active {
            background: var(--gradient-1);
            color: white;
            transform: scale(1.2);
        }
    </style>
    <link href="https://fonts.cdnfonts.com/css/opendyslexic" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Sound Toggle -->
        <div class="sound-toggle" id="soundToggle" onclick="toggleSound()">
            <span id="soundIcon">üîä</span>
        </div>

        <!-- Theme Toggle -->
        <div class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
            <span id="themeIcon">üåô</span>
        </div>

        <!-- Konami Code Progress -->
        <div class="konami-progress" id="konamiProgress">
            <div class="konami-key" data-key="‚Üë">‚Üë</div>
            <div class="konami-key" data-key="‚Üë">‚Üë</div>
            <div class="konami-key" data-key="‚Üì">‚Üì</div>
            <div class="konami-key" data-key="‚Üì">‚Üì</div>
            <div class="konami-key" data-key="‚Üê">‚Üê</div>
            <div class="konami-key" data-key="‚Üí">‚Üí</div>
            <div class="konami-key" data-key="‚Üê">‚Üê</div>
            <div class="konami-key" data-key="‚Üí">‚Üí</div>
            <div class="konami-key" data-key="B">B</div>
            <div class="konami-key" data-key="A">A</div>
        </div>

        <!-- Header -->
        <header class="header">
            <h1>Data Compression</h1>
            <p>GCSE Computer Science - OCR J277</p>
            <div class="xp-container">
                <div class="level-badge">Level <span id="level">0</span></div>
                <div>Total XP: <span id="xp">0</span></div>
                <div class="xp-bar">
                    <div class="xp-fill" id="xpFill"></div>
                </div>
                <div style="margin-top: 5px; font-size: 14px;">
                    Next level: <span id="xpToNext">100</span> XP
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-container">
            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn" onclick="navigateSection(-1)">
                    ‚Üê Previous
                </button>
                <button class="nav-btn" id="nextBtn" onclick="navigateSection(1)">
                    Next ‚Üí
                </button>
            </div>
            <div class="section-indicator" id="sectionIndicator"></div>
            <div class="timer-display" id="timerDisplay" style="display: none;">
                <span>‚è±Ô∏è</span>
                <span id="timerText">00:00</span>
            </div>
            <button class="btn btn-warning" onclick="resetSection()">üîÑ Reset Section</button>
        </nav>

        <!-- Section 0: Starter Activity -->
        <section class="section active" id="section0">
            <h2>Starter Activity: Why Do We Need Compression?</h2>
            
            <div class="task-box">
                <h3>üéØ Quick Challenge: File Size Knowledge</h3>
                <p>Let's test your understanding of modern file sizes!</p>
                
                <div id="starterQuiz">
                    <div class="quiz-question" data-question="1">
                        <p><strong>Question 1:</strong> A typical uncompressed RAW image from a modern smartphone camera is approximately:</p>
                        <button class="quiz-option" onclick="checkStarterAnswer(this, '1', 'a')">A) 500 KB</button>
                        <button class="quiz-option" onclick="checkStarterAnswer(this, '1', 'b')">B) 5 MB</button>
                        <button class="quiz-option" onclick="checkStarterAnswer(this, '1', 'c')">C) 25 MB</button>
                        <button class="quiz-option" onclick="checkStarterAnswer(this, '1', 'd')">D) 50 MB</button>
                    </div>
                    
                    <div class="feedback" id="starter-feedback-1"></div>

                    <div class="quiz-question" data-question="2" style="margin-top: 30px; display: none;" id="starterQ2">
                        <p><strong>Question 2:</strong> How long would it take to download a 1GB file on a typical 4G connection (20 Mbps)?</p>
                        <button class="quiz-option" onclick="checkStarterAnswer(this, '2', 'a')">A) 10 seconds</button>
                        <button class="quiz-option" onclick="checkStarterAnswer(this, '2', 'b')">B) 1 minute</button>
                        <button class="quiz-option" onclick="checkStarterAnswer(this, '2', 'c')">C) 7 minutes</button>
                        <button class="quiz-option" onclick="checkStarterAnswer(this, '2', 'd')">D) 20 minutes</button>
                    </div>
                    
                    <div class="feedback" id="starter-feedback-2"></div>
                </div>
            </div>

            <div class="task-box" style="margin-top: 30px;">
                <h3>üßÆ Interactive Activity: Storage Crisis Calculator</h3>
                <p>Calculate how quickly you'd run out of storage space!</p>
                
                <div class="simulation-container">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <label>üì∏ Photos per day: 
                                <input type="number" id="photosPerDay" value="20" min="1" max="1000" class="input-field" style="width: 100px;">
                            </label>
                        </div>
                        <div>
                            <label>üé• Videos per day: 
                                <input type="number" id="videosPerDay" value="3" min="0" max="50" class="input-field" style="width: 100px;">
                            </label>
                        </div>
                        <div>
                            <label>üì± Phone storage (GB): 
                                <input type="number" id="phoneStorage" value="128" min="16" max="1024" class="input-field" style="width: 100px;">
                            </label>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="calculateStorageCrisis()">Calculate Storage Crisis! üíæ</button>
                    
                    <div id="storageResult" style="margin-top: 30px;">
                        <div class="comparison-tool">
                            <div class="comparison-side">
                                <h4>Without Compression</h4>
                                <div class="file-size-display" id="noCompression">--</div>
                                <p id="daysUntilFull1">Days until full: --</p>
                            </div>
                            <div class="comparison-side">
                                <h4>With Compression</h4>
                                <div class="file-size-display" id="withCompression">--</div>
                                <p id="daysUntilFull2">Days until full: --</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mini-game">
                <h3>üéÆ Mini-Game: Compression Race!</h3>
                <p>Click the files to compress them before your storage runs out!</p>
                <div id="compressionGame" style="position: relative; height: 300px; background: rgba(255,255,255,0.1); border-radius: 15px; margin: 20px 0;">
                    <!-- Game will be initialized here -->
                </div>
                <div class="game-score">Score: <span id="gameScore">0</span></div>
                <button class="btn" onclick="startCompressionGame()">Start Game</button>
            </div>

            <div class="hint-container">
                <button class="hint-btn" onclick="showProgressiveHint('starter', 0)">üí° Need a hint?</button>
                <div class="hint-levels" id="starter-hints" style="display: none;">
                    <div class="hint-level unlocked" onclick="showHintLevel('starter', 0)">Hint 1</div>
                    <div class="hint-level" onclick="showHintLevel('starter', 1)">Hint 2</div>
                    <div class="hint-level" onclick="showHintLevel('starter', 2)">Hint 3</div>
                </div>
                <div class="hint-content" id="starter-hint-content"></div>
            </div>
        </section>

        <!-- Section 1: Introduction to Compression -->
        <section class="section" id="section1">
            <h2>Introduction to Data Compression</h2>
            
            <div class="task-box">
                <h3>üéØ Learning Outcomes</h3>
                <ul style="list-style: none; padding: 0;">
                    <li>‚úÖ Define compression and understand why it's necessary</li>
                    <li>‚úÖ Identify the two main types of compression</li>
                    <li>‚úÖ Calculate compression ratios accurately</li>
                    <li>‚úÖ Explain real-world benefits of compression</li>
                </ul>
            </div>

            <h3>What is Compression?</h3>
            <p style="font-size: 1.1em; line-height: 1.8;">Compression is a method or protocol for using <strong>fewer bits</strong> to represent the original information. Think of it as the digital equivalent of vacuum-packing clothes!</p>
            
            <div class="simulation-container">
                <h4>üåç Real-World Impact of Compression</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="text-align: center; padding: 20px; background: white; border-radius: 10px;">
                        <div style="font-size: 3em;">üí∞</div>
                        <h5>Saves Money</h5>
                        <p>Reduces data usage and storage costs</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: white; border-radius: 10px;">
                        <div style="font-size: 3em;">‚ö°</div>
                        <h5>Faster Transmission</h5>
                        <p>Smaller files travel quicker</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: white; border-radius: 10px;">
                        <div style="font-size: 3em;">üåê</div>
                        <h5>Less Bandwidth</h5>
                        <p>Reduces internet traffic</p>
                    </div>
                    <div style="text-align: center; padding: 20px; background: white; border-radius: 10px;">
                        <div style="font-size: 3em;">üíæ</div>
                        <h5>More Storage</h5>
                        <p>Fit more files in same space</p>
                    </div>
                </div>
            </div>

            <div class="task-box">
                <h3>Task 1: Match the Compression Benefits</h3>
                <p>Drag each benefit to the correct real-world scenario:</p>
                
                <div class="drag-container">
                    <div class="drag-source">
                        <div class="drag-item" draggable="true" data-value="bandwidth">üíª Saves bandwidth</div>
                        <div class="drag-item" draggable="true" data-value="storage">üíæ Reduces storage</div>
                        <div class="drag-item" draggable="true" data-value="speed">‚ö° Faster transmission</div>
                        <div class="drag-item" draggable="true" data-value="cost">üí∞ Saves money</div>
                        <div class="drag-item" draggable="true" data-value="quality">üì∫ Enables streaming</div>
                    </div>
                </div>
                
                <div class="drop-targets" style="margin-top: 30px;">
                    <p><strong>Netflix streaming a 4K movie on your home WiFi:</strong></p>
                    <div class="drop-zone" data-answer="quality"></div>
                    
                    <p><strong>WhatsApp sending photos without using all your data:</strong></p>
                    <div class="drop-zone" data-answer="bandwidth"></div>
                    
                    <p><strong>Backing up 10,000 photos to Google Photos:</strong></p>
                    <div class="drop-zone" data-answer="storage"></div>
                    
                    <p><strong>Video calling grandma with minimal lag:</strong></p>
                    <div class="drop-zone" data-answer="speed"></div>
                    
                    <p><strong>Spotify's free tier with limited data:</strong></p>
                    <div class="drop-zone" data-answer="cost"></div>
                </div>
                
                <button class="btn" onclick="checkDragDrop('section1')">Check Answers</button>
                <div class="feedback" id="drag-feedback-1"></div>
            </div>

            <div class="task-box">
                <h3>Task 2: Compression Ratio Calculator</h3>
                <p>Master the compression ratio formula: <strong>Original Size √∑ Compressed Size</strong></p>
                
                <div class="comparison-tool">
                    <div class="comparison-side">
                        <h4>Challenge 1</h4>
                        <p>Original: 20 MB<br>Compressed: 4 MB</p>
                        <input type="text" class="input-field" id="ratio1" placeholder="Enter ratio...">
                    </div>
                    <div class="comparison-side">
                        <h4>Challenge 2</h4>
                        <p>Original: 150 MB<br>Compressed: 15 MB</p>
                        <input type="text" class="input-field" id="ratio2" placeholder="Enter ratio...">
                    </div>
                </div>
                
                <button class="btn" onclick="checkCompressionRatios()">Check All Answers</button>
                <div class="feedback" id="ratio-feedback"></div>

                <div class="hint-container">
                    <button class="hint-btn" onclick="showProgressiveHint('ratio', 0)">üí° Need help?</button>
                    <div class="hint-levels" id="ratio-hints" style="display: none;">
                        <div class="hint-level unlocked" onclick="showHintLevel('ratio', 0)">Formula</div>
                        <div class="hint-level" onclick="showHintLevel('ratio', 1)">Example</div>
                        <div class="hint-level" onclick="showHintLevel('ratio', 2)">Answer format</div>
                    </div>
                    <div class="hint-content" id="ratio-hint-content"></div>
                </div>
            </div>

            <div class="task-box">
                <h3>Task 3: Binary Visualization</h3>
                <p>See how compression reduces the actual bits needed!</p>
                
                <div class="binary-display">
                    <p><strong>Original text:</strong> "AAABBBCCC" (9 characters = 72 bits)</p>
                    <div id="originalBinary"></div>
                    
                    <p style="margin-top: 20px;"><strong>Compressed:</strong> "3A3B3C" (6 characters = 48 bits)</p>
                    <div id="compressedBinary"></div>
                    
                    <p style="margin-top: 20px; color: #68d391;">üí° Saved: 24 bits (33% reduction!)</p>
                </div>
                
                <button class="btn" onclick="animateBinaryCompression()">Animate Compression</button>
            </div>
        </section>

        <!-- Section 2: Lossy Compression -->
        <section class="section" id="section2">
            <h2>Lossy Compression</h2>
            
            <div class="task-box">
                <h3>üé® What is Lossy Compression?</h3>
                <p>Lossy compression reduces file size by <strong>permanently removing</strong> certain redundant information. The eliminated data is <strong>unrecoverable</strong>.</p>
                
                <div style="display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap; justify-content: center;">
                    <div style="flex: 1; min-width: 200px; text-align: center;">
                        <h4>‚úÖ Advantages</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li>üìâ Much smaller files</li>
                            <li>üëÅÔ∏è Often unnoticeable</li>
                            <li>üíæ Great compression ratios</li>
                        </ul>
                    </div>
                    <div style="flex: 1; min-width: 200px; text-align: center;">
                        <h4>‚ùå Disadvantages</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li>üö´ Data permanently lost</li>
                            <li>üìâ Quality degradation</li>
                            <li>üîÑ Can't restore original</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="task-box">
                <h3>üñºÔ∏è Interactive Simulation: Image Quality Degradation</h3>
                <p>Adjust the compression level and watch the quality change!</p>
                
                <div class="simulation-container">
                    <div style="text-align: center;">
                        <label for="compressionSlider" style="font-size: 1.2em;">
                            Compression Level: <span id="compressionLevel">50%</span>
                        </label>
                        <input type="range" id="compressionSlider" min="0" max="100" value="50" 
                               style="width: 80%; margin: 20px 0;" oninput="updateImageCompression(this.value)">
                    </div>
                    
                    <div style="display: flex; gap: 40px; justify-content: center; flex-wrap: wrap;">
                        <div>
                            <h4>Original (24-bit color)</h4>
                            <div class="pixel-grid" id="originalGrid" style="grid-template-columns: repeat(10, 35px);">
                                <!-- Grid populated by JavaScript -->
                            </div>
                            <p>File size: <span id="originalSize">300 KB</span></p>
                            <p>Colors: 16,777,216</p>
                        </div>
                        
                        <div>
                            <h4>Compressed</h4>
                            <div class="pixel-grid" id="compressedGrid" style="grid-template-columns: repeat(10, 35px);">
                                <!-- Grid populated by JavaScript -->
                            </div>
                            <p>File size: <span id="compressedSize">150 KB</span></p>
                            <p>Colors: <span id="colorCount">256</span></p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn" onclick="generateRandomImage()">üé≤ Generate Random Image</button>
                        <button class="btn" onclick="loadPresetImage('photo')">üì∏ Load Photo</button>
                        <button class="btn" onclick="loadPresetImage('logo')">üé® Load Logo</button>
                        <button class="btn btn-danger" onclick="resetPixels()">üîÑ Reset</button>
                    </div>
                </div>
            </div>

            <div class="task-box">
                <h3>üéµ Audio Compression Simulation</h3>
                <p>See how MP3 compression removes frequencies we can't hear well!</p>
                
                <div class="simulation-container">
                    <h4>Frequency Spectrum</h4>
                    <div style="position: relative; height: 200px; background: #1a202c; border-radius: 10px; padding: 20px;">
                        <canvas id="frequencyCanvas" style="width: 100%; height: 100%;"></canvas>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn" onclick="playOriginalSound()">üîä Play Original</button>
                        <button class="btn" onclick="playCompressedSound()">üîâ Play Compressed</button>
                        <button class="btn btn-warning" onclick="showRemovedFrequencies()">üëÇ Show Removed</button>
                    </div>
                    
                    <div class="sound-wave">
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                    </div>
                </div>
            </div>

            <div class="task-box">
                <h3>Task 4: Fill in the Blanks - Lossy Compression</h3>
                <p>Complete the sentences by selecting the correct words:</p>
                
                <div style="margin: 30px 0; font-size: 1.1em; line-height: 2;">
                    <p>1. Lossy compression creates 
                        <select class="input-field" style="width: 150px; display: inline-block;" id="lossy-blank-1">
                            <option value="">Choose...</option>
                            <option value="larger">larger</option>
                            <option value="smaller">smaller</option>
                            <option value="identical">identical</option>
                            <option value="corrupted">corrupted</option>
                            <option value="encrypted">encrypted</option>
                            <option value="compressed">compressed</option>
                        </select>
                        file sizes than lossless compression.
                    </p>
                    
                    <p>2. The human eye cannot easily detect when 
                        <select class="input-field" style="width: 180px; display: inline-block;" id="lossy-blank-2">
                            <option value="">Choose...</option>
                            <option value="all data">all data</option>
                            <option value="some colors">some colors</option>
                            <option value="text">text</option>
                            <option value="sounds">sounds</option>
                            <option value="pixels">pixels</option>
                        </select>
                        are removed from images.
                    </p>
                    
                    <p>3. JPEG compression works by reducing 
                        <select class="input-field" style="width: 180px; display: inline-block;" id="lossy-blank-3">
                            <option value="">Choose...</option>
                            <option value="file names">file names</option>
                            <option value="color depth">color depth</option>
                            <option value="file format">file format</option>
                            <option value="encryption">encryption</option>
                            <option value="metadata">metadata</option>
                        </select>
                        and image resolution.
                    </p>
                    
                    <p>4. MP3 files remove frequencies that are 
                        <select class="input-field" style="width: 200px; display: inline-block;" id="lossy-blank-4">
                            <option value="">Choose...</option>
                            <option value="too loud">too loud</option>
                            <option value="hard to hear">hard to hear</option>
                            <option value="copyrighted">copyrighted</option>
                            <option value="repeated">repeated</option>
                            <option value="digital">digital</option>
                        </select>
                        by humans.
                    </p>
                </div>
                
                <button class="btn" onclick="checkLossyBlanks()">Check All Answers</button>
                <div class="feedback" id="lossy-blanks-feedback"></div>
            </div>

            <div class="task-box">
                <h3>Task 5: When NOT to Use Lossy Compression</h3>
                <p>‚ö†Ô∏è Critical thinking: Which files should NEVER use lossy compression?</p>
                
                <div id="lossyChoices" style="margin: 30px 0;">
                    <label style="display: block; padding: 15px; background: #f8f9fa; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" value="text" style="margin-right: 15px; transform: scale(1.5);">
                        üìÑ Important legal documents
                    </label>
                    <label style="display: block; padding: 15px; background: #f8f9fa; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" value="music" style="margin-right: 15px; transform: scale(1.5);">
                        üéµ Background music for a game
                    </label>
                    <label style="display: block; padding: 15px; background: #f8f9fa; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" value="code" style="margin-right: 15px; transform: scale(1.5);">
                        üíª Python program source code
                    </label>
                    <label style="display: block; padding: 15px; background: #f8f9fa; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" value="photo" style="margin-right: 15px; transform: scale(1.5);">
                        üì∏ Holiday photos for Instagram
                    </label>
                    <label style="display: block; padding: 15px; background: #f8f9fa; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" value="spreadsheet" style="margin-right: 15px; transform: scale(1.5);">
                        üìä Bank account spreadsheet
                    </label>
                    <label style="display: block; padding: 15px; background: #f8f9fa; margin: 10px 0; border-radius: 10px; cursor: pointer; transition: all 0.3s;">
                        <input type="checkbox" value="medical" style="margin-right: 15px; transform: scale(1.5);">
                        üè• Medical scan images for diagnosis
                    </label>
                </div>
                
                <button class="btn" onclick="checkLossyChoices()">Check Answers</button>
                <div class="feedback" id="lossy-choices-feedback"></div>
            </div>

            <!-- Common Mistakes Alert -->
            <div class="task-box" style="background: linear-gradient(to right, #fef3c7, #fed7aa);">
                <h3>‚ö†Ô∏è Common Mistakes to Avoid</h3>
                <ul style="list-style: none; padding: 0;">
                    <li>‚ùå <strong>Mistake:</strong> "JPEG is good for text documents"</li>
                    <li>‚úÖ <strong>Truth:</strong> JPEG is designed for photos only - text becomes blurry!</li>
                    <li style="margin-top: 15px;">‚ùå <strong>Mistake:</strong> "Lossy compression can be reversed"</li>
                    <li>‚úÖ <strong>Truth:</strong> Once data is removed, it's gone forever!</li>
                </ul>
            </div>
        </section>

        <!-- Section 3: Lossless Compression & RLE -->
        <section class="section" id="section3">
            <h2>Lossless Compression & Run Length Encoding</h2>
            
            <div class="task-box">
                <h3>üîê What is Lossless Compression?</h3>
                <p>Lossless compression allows <strong>every bit</strong> of the original data to be recovered. Perfect for when accuracy matters!</p>
                
                <div style="background: linear-gradient(to right, #d1fae5, #a7f3d0); padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4 style="color: #065f46;">Key Features:</h4>
                    <ul style="list-style: none; padding: 0; color: #047857;">
                        <li>‚úÖ No data loss - perfect reconstruction</li>
                        <li>üîç Works by finding patterns in data</li>
                        <li>üìä Larger file sizes than lossy</li>
                        <li>üíº Essential for text, code, and data files</li>
                    </ul>
                </div>
            </div>

            <div class="task-box">
                <h3>üèÉ Run Length Encoding (RLE) Interactive</h3>
                <p>RLE compresses by counting consecutive identical values. Try it yourself!</p>
                
                <div class="simulation-container">
                    <h4>üéÆ RLE Playground</h4>
                    
                    <div style="display: flex; gap: 30px; align-items: center; justify-content: center; flex-wrap: wrap;">
                        <div>
                            <p><strong>Input your string:</strong></p>
                            <input type="text" class="input-field" id="rleInput" 
                                   placeholder="Try: AAABBCCCCAA" maxlength="30" 
                                   style="font-size: 1.2em; letter-spacing: 2px; text-transform: uppercase;">
                            <button class="btn" onclick="demonstrateRLE()">Compress with RLE</button>
                        </div>
                        
                        <div style="text-align: center;">
                            <div class="loading" id="rleLoading" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <div id="rleVisualization" style="margin-top: 30px; display: none;">
                        <div class="comparison-tool">
                            <div class="comparison-side">
                                <h4>Original</h4>
                                <p id="rleOriginal" style="font-size: 1.5em; letter-spacing: 3px; font-family: monospace;"></p>
                                <p>Length: <span id="originalLength"></span> characters</p>
                            </div>
                            <div class="comparison-side">
                                <h4>Compressed</h4>
                                <p id="rleCompressed" style="font-size: 1.5em; letter-spacing: 3px; font-family: monospace; color: var(--primary-color);"></p>
                                <p>Length: <span id="compressedLength"></span> characters</p>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <div class="file-size-display" style="color: var(--secondary-color);">
                                Compression Ratio: <span id="rleRatio"></span>
                            </div>
                            <p id="rleSavings" style="font-size: 1.1em; margin-top: 10px;"></p>
                        </div>
                    </div>

                    <div style="margin-top: 30px;">
                        <h4>üìö Try These Examples:</h4>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                            <button class="btn btn-warning" onclick="tryRLEExample('WWWWWBBBBB')">Simple</button>
                            <button class="btn btn-warning" onclick="tryRLEExample('AAAAAABBBBCCCCDDDD')">Good</button>
                            <button class="btn btn-warning" onclick="tryRLEExample('ABCDEFGHIJK')">Poor</button>
                            <button class="btn btn-warning" onclick="tryRLEExample('RRRRRGGGGGGBBBBBBB')">Image-like</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-box">
                <h3>Task 6: RLE Compression Practice</h3>
                <p>Compress these sequences using Run Length Encoding:</p>
                
                <div style="margin: 30px 0;">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <p style="font-size: 1.2em;"><strong>1.</strong> WWWWBBBB ‚Üí 
                            <input type="text" class="input-field" id="rle1" placeholder="Your answer..." 
                                   style="width: 200px; display: inline-block; margin-left: 20px;">
                        </p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <p style="font-size: 1.2em;"><strong>2.</strong> RRRGGGGBBR ‚Üí 
                            <input type="text" class="input-field" id="rle2" placeholder="Your answer..." 
                                   style="width: 200px; display: inline-block; margin-left: 20px;">
                        </p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <p style="font-size: 1.2em;"><strong>3.</strong> AAAAABBBCCCD ‚Üí 
                            <input type="text" class="input-field" id="rle3" placeholder="Your answer..." 
                                   style="width: 200px; display: inline-block; margin-left: 20px;">
                        </p>
                    </div>
                </div>
                
                <button class="btn" onclick="checkRLEAnswers()">Check All Answers</button>
                <div class="feedback" id="rle-feedback"></div>
                
                <div class="hint-container">
                    <button class="hint-btn" onclick="showProgressiveHint('rle', 0)">üí° Need help?</button>
                    <div class="hint-levels" id="rle-hints" style="display: none;">
                        <div class="hint-level unlocked" onclick="showHintLevel('rle', 0)">Basic concept</div>
                        <div class="hint-level" onclick="showHintLevel('rle', 1)">Example</div>
                        <div class="hint-level" onclick="showHintLevel('rle', 2)">Step by step</div>
                    </div>
                    <div class="hint-content" id="rle-hint-content"></div>
                </div>
            </div>

            <div class="task-box">
                <h3>üéµ Task 7: RLE Sound Compression</h3>
                <p>Sound recordings sample audio thousands of times per second. How would RLE help?</p>
                
                <div class="simulation-container">
                    <h4>Sound Wave Visualization</h4>
                    <div class="sound-wave" style="height: 100px;">
                        <div class="wave-bar" style="height: 40px;"></div>
                        <div class="wave-bar" style="height: 40px;"></div>
                        <div class="wave-bar" style="height: 40px;"></div>
                        <div class="wave-bar" style="height: 40px;"></div>
                        <div class="wave-bar" style="height: 40px;"></div>
                        <div class="wave-bar" style="height: 60px;"></div>
                        <div class="wave-bar" style="height: 60px;"></div>
                        <div class="wave-bar" style="height: 60px;"></div>
                    </div>
                    <p style="text-align: center; margin-top: 20px;">Notice the repeated heights? That's where RLE helps!</p>
                </div>
                
                <textarea class="input-field" id="rleSoundAnswer" rows="4" 
                          placeholder="Explain how RLE would compress repeated sound samples..."></textarea>
                
                <button class="btn" onclick="checkRLESound()">Submit Answer</button>
                <div class="feedback" id="rle-sound-feedback"></div>
            </div>

            <div class="mini-game">
                <h3>üéÆ RLE Challenge Game</h3>
                <p>Compress as many sequences as you can in 60 seconds!</p>
                <div id="rleGame" style="padding: 20px;">
                    <div id="gameSequence" style="font-size: 2em; letter-spacing: 5px; margin: 20px 0;">
                        Press Start to Begin!
                    </div>
                    <input type="text" class="input-field" id="gameAnswer" placeholder="Enter RLE compression..." 
                           style="font-size: 1.5em; text-align: center;" disabled>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-success" onclick="startRLEGame()">Start Game</button>
                        <button class="btn" onclick="submitGameAnswer()" disabled id="submitGameBtn">Submit</button>
                    </div>
                </div>
                <div class="game-score">Score: <span id="rleGameScore">0</span> | Time: <span id="gameTimer">60</span>s</div>
            </div>
        </section>

        <!-- Section 4: File Formats -->
        <section class="section" id="section4">
            <h2>Common Compressed File Formats</h2>
            
            <div class="task-box">
                <h3>üì∏ JPEG - Joint Photographic Experts Group</h3>
                <div style="display: flex; gap: 30px; align-items: center; flex-wrap: wrap;">
                    <div style="flex: 1;">
                        <p>The world's most popular image format uses <strong>lossy compression</strong> specifically designed for photographs.</p>
                        
                        <h4>üéØ JPEG Characteristics:</h4>
                        <ul>
                            <li>üìâ Reduces file size by 90% or more</li>
                            <li>üëÅÔ∏è Removes details humans can't easily see</li>
                            <li>üé® Quality adjustable (0-100%)</li>
                            <li>‚ùå Not suitable for text or sharp edges</li>
                            <li>üîÑ Quality degrades with each save</li>
                        </ul>
                    </div>
                    <div style="text-align: center;">
                        <div style="width: 200px; height: 200px; background: var(--gradient-2); border-radius: 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 4em; margin: 0 auto;">
                            üì∏
                        </div>
                        <p style="margin-top: 10px;"><strong>.jpg / .jpeg</strong></p>
                    </div>
                </div>
            </div>

            <div class="task-box">
                <h3>üéµ MP3 - MPEG Audio Layer 3</h3>
                <div style="display: flex; gap: 30px; align-items: center; flex-wrap: wrap;">
                    <div style="flex: 1;">
                        <p>The format that revolutionized digital music! Uses <strong>lossy compression</strong> based on psychoacoustic models.</p>
                        
                        <h4>üéØ MP3 Characteristics:</h4>
                        <ul>
                            <li>üëÇ Removes frequencies we can't hear well</li>
                            <li>üìä Typical compression ratio of 10:1</li>
                            <li>üéöÔ∏è Variable bitrates (128-320 kbps)</li>
                            <li>üíø 1 minute ‚âà 1 MB at 128kbps</li>
                            <li>üåç Universal compatibility</li>
                        </ul>
                    </div>
                    <div style="text-align: center;">
                        <div style="width: 200px; height: 200px; background: var(--gradient-3); border-radius: 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 4em; margin: 0 auto;">
                            üéµ
                        </div>
                        <p style="margin-top: 10px;"><strong>.mp3</strong></p>
                    </div>
                </div>
            </div>

            <div class="task-box">
                <h3>üìä Format Comparison Interactive</h3>
                <p>Compare different file formats for various use cases:</p>
                
                <div class="comparison-tool" style="margin-top: 30px;">
                    <div class="comparison-side">
                        <h4>Images</h4>
                        <select class="input-field" id="imageUseCase" onchange="updateFormatRecommendation('image')">
                            <option value="">Select use case...</option>
                            <option value="photo">Social media photo</option>
                            <option value="logo">Company logo</option>
                            <option value="scan">Text document scan</option>
                            <option value="art">Digital artwork</option>
                        </select>
                        <div id="imageRecommendation" style="margin-top: 20px; min-height: 100px;"></div>
                    </div>
                    
                    <div class="comparison-side">
                        <h4>Audio</h4>
                        <select class="input-field" id="audioUseCase" onchange="updateFormatRecommendation('audio')">
                            <option value="">Select use case...</option>
                            <option value="streaming">Music streaming</option>
                            <option value="podcast">Podcast</option>
                            <option value="studio">Studio master</option>
                            <option value="ringtone">Phone ringtone</option>
                        </select>
                        <div id="audioRecommendation" style="margin-top: 20px; min-height: 100px;"></div>
                    </div>
                </div>
            </div>

            <div class="task-box">
                <h3>Task 8: Format Matching Challenge</h3>
                <p>Match each scenario to the BEST file format:</p>
                
                <div class="drag-container">
                    <div class="drag-source">
                        <div class="drag-item" draggable="true" data-value="jpeg">üì∏ JPEG</div>
                        <div class="drag-item" draggable="true" data-value="mp3">üéµ MP3</div>
                        <div class="drag-item" draggable="true" data-value="png">üé® PNG</div>
                        <div class="drag-item" draggable="true" data-value="wav">üéº WAV</div>
                        <div class="drag-item" draggable="true" data-value="gif">üé¨ GIF</div>
                        <div class="drag-item" draggable="true" data-value="zip">üì¶ ZIP</div>
                    </div>
                </div>
                
                <div class="drop-targets" style="margin-top: 30px;">
                    <p><strong>Instagram holiday photos:</strong></p>
                    <div class="drop-zone" data-answer="jpeg"></div>
                    
                    <p><strong>Spotify music streaming:</strong></p>
                    <div class="drop-zone" data-answer="mp3"></div>
                    
                    <p><strong>Website logo with transparency:</strong></p>
                    <div class="drop-zone" data-answer="png"></div>
                    
                    <p><strong>Professional music production:</strong></p>
                    <div class="drop-zone" data-answer="wav"></div>
                    
                    <p><strong>Simple web animation:</strong></p>
                    <div class="drop-zone" data-answer="gif"></div>
                    
                    <p><strong>Multiple documents for email:</strong></p>
                    <div class="drop-zone" data-answer="zip"></div>
                </div>
                
                <button class="btn" onclick="checkDragDrop('section4')">Check Answers</button>
                <div class="feedback" id="drag-feedback-4"></div>
            </div>

            <div class="leaderboard">
                <h3>üèÜ Top Compression Experts</h3>
                <div id="leaderboardEntries">
                    <div class="leaderboard-entry">
                        <span class="leaderboard-rank">1st</span>
                        <span>You</span>
                        <span><strong id="yourScore">0 XP</strong></span>
                    </div>
                    <div class="leaderboard-entry">
                        <span class="leaderboard-rank">2nd</span>
                        <span>CompressKing</span>
                        <span>850 XP</span>
                    </div>
                    <div class="leaderboard-entry">
                        <span class="leaderboard-rank">3rd</span>
                        <span>DataWizard</span>
                        <span>720 XP</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 5: Practice Exam Questions -->
        <section class="section" id="section5">
            <h2>Practice Exam Questions</h2>
            
            <div class="task-box" style="background: linear-gradient(to right, #fef3c7, #fed7aa);">
                <h3>üìù Exam Tips</h3>
                <ul style="list-style: none; padding: 0;">
                    <li>‚è∞ Time yourself - aim for 1 mark per minute</li>
                    <li>üìñ Read questions carefully - highlight key words</li>
                    <li>‚úçÔ∏è Show your working for calculation questions</li>
                    <li>üéØ Use technical vocabulary from the specification</li>
                </ul>
            </div>

            <div class="task-box">
                <h3>Question 1 (4 marks)</h3>
                <button class="btn btn-warning" onclick="startTimer('q1', 4)">‚è±Ô∏è Start Timer</button>
                <span id="q1Timer" style="margin-left: 20px; font-weight: bold;"></span>
                
                <p style="margin-top: 20px; font-size: 1.1em;">Explain the difference between lossy and lossless compression. Give one example of when each type would be most appropriate.</p>
                
                <textarea class="input-field" id="examQ1" rows="8" 
                          placeholder="Write your answer here... Remember to include:
- Definition of lossy compression
- Definition of lossless compression
- Appropriate example for each
- Clear explanations"></textarea>
                
                <div style="margin: 20px 0;">
                    <label>Predicted marks: 
                        <input type="number" id="examQ1Marks" min="0" max="4" style="width: 60px;" 
                               onchange="updatePredictedTotal()"> / 4
                    </label>
                    <button class="btn" onclick="checkExamAnswer('examQ1', 4)">Submit Answer</button>
                </div>
                
                <div class="mark-scheme" id="markScheme1">
                    <h4>‚úì Mark Scheme</h4>
                    <ul>
                        <li><strong>[1 mark]</strong> Lossy removes data permanently / cannot recover original</li>
                        <li><strong>[1 mark]</strong> Lossless preserves all data / can recover original exactly</li>
                        <li><strong>[1 mark]</strong> Appropriate lossy example: photos, music, video streaming</li>
                        <li><strong>[1 mark]</strong> Appropriate lossless example: text files, source code, medical data</li>
                    </ul>
                </div>
                
                <div class="feedback" id="examQ1-feedback"></div>
            </div>

            <div class="task-box">
                <h3>Question 2 (3 marks)</h3>
                <button class="btn btn-warning" onclick="startTimer('q2', 3)">‚è±Ô∏è Start Timer</button>
                <span id="q2Timer" style="margin-left: 20px; font-weight: bold;"></span>
                
                <p style="margin-top: 20px; font-size: 1.1em;">A bitmap image has a file size of 2.4 MB. After JPEG compression, it is 240 KB.</p>
                <p style="font-size: 1.1em;">Calculate the compression ratio. Show your working.</p>
                
                <div class="canvas-container" style="height: 250px;">
                    <canvas id="drawingCanvas" width="800" height="250"></canvas>
                    <div class="canvas-controls">
                        <div class="color-picker">
                            <div class="color-option" style="background: #000;" onclick="setDrawColor('#000')"></div>
                            <div class="color-option" style="background: #f00;" onclick="setDrawColor('#f00')"></div>
                            <div class="color-option" style="background: #00f;" onclick="setDrawColor('#00f')"></div>
                            <div class="color-option" style="background: #0f0;" onclick="setDrawColor('#0f0')"></div>
                        </div>
                        <button class="canvas-tool" onclick="setDrawTool('pen')">‚úèÔ∏è</button>
                        <button class="canvas-tool" onclick="setDrawTool('eraser')">üßπ</button>
                        <button class="btn btn-danger" onclick="clearCanvas()">Clear</button>
                    </div>
                </div>
                
                <input type="text" class="input-field" id="examQ2" placeholder="Final answer (e.g., 10:1)">
                
                <div style="margin: 20px 0;">
                    <label>Predicted marks: 
                        <input type="number" id="examQ2Marks" min="0" max="3" style="width: 60px;"
                               onchange="updatePredictedTotal()"> / 3
                    </label>
                    <button class="btn" onclick="checkExamAnswer('examQ2', 3)">Submit Answer</button>
                </div>
                
                <div class="mark-scheme" id="markScheme2">
                    <h4>‚úì Mark Scheme</h4>
                    <ul>
                        <li><strong>[1 mark]</strong> Convert to same units: 2.4 MB = 2400 KB (or 240 KB = 0.24 MB)</li>
                        <li><strong>[1 mark]</strong> Division shown: 2400 √∑ 240 (or 2.4 √∑ 0.24)</li>
                        <li><strong>[1 mark]</strong> Correct answer: 10:1 or 10</li>
                    </ul>
                </div>
                
                <div class="feedback" id="examQ2-feedback"></div>
            </div>

            <div class="task-box">
                <h3>Question 3 (5 marks)</h3>
                <button class="btn btn-warning" onclick="startTimer('q3', 5)">‚è±Ô∏è Start Timer</button>
                <span id="q3Timer" style="margin-left: 20px; font-weight: bold;"></span>
                
                <p style="margin-top: 20px; font-size: 1.1em;">Describe how Run Length Encoding (RLE) works. Include an example in your answer and explain why it might not be suitable for all types of data.</p>
                
                <textarea class="input-field" id="examQ3" rows="10" 
                          placeholder="Structure your answer:
1. Explain how RLE works
2. Give a clear example
3. Show the compression
4. Explain when RLE is not suitable"></textarea>
                
                <div style="margin: 20px 0;">
                    <label>Predicted marks: 
                        <input type="number" id="examQ3Marks" min="0" max="5" style="width: 60px;"
                               onchange="updatePredictedTotal()"> / 5
                    </label>
                    <button class="btn" onclick="checkExamAnswer('examQ3', 5)">Submit Answer</button>
                </div>
                
                <div class="mark-scheme" id="markScheme3">
                    <h4>‚úì Mark Scheme</h4>
                    <ul>
                        <li><strong>[1 mark]</strong> RLE identifies consecutive repeated data/characters</li>
                        <li><strong>[1 mark]</strong> Stores one instance with count/frequency</li>
                        <li><strong>[1 mark]</strong> Valid example shown (e.g., AAABBB ‚Üí 3A3B)</li>
                        <li><strong>[1 mark]</strong> Compression demonstrated (6 chars ‚Üí 4 chars)</li>
                        <li><strong>[1 mark]</strong> Not suitable for: random data / few repeats / may increase size</li>
                    </ul>
                </div>
                
                <div class="feedback" id="examQ3-feedback"></div>
            </div>

            <div class="task-box">
                <h3>Question 4 (6 marks)</h3>
                <button class="btn btn-warning" onclick="startTimer('q4', 6)">‚è±Ô∏è Start Timer</button>
                <span id="q4Timer" style="margin-left: 20px; font-weight: bold;"></span>
                
                <p style="margin-top: 20px; font-size: 1.1em;">A music streaming service needs to decide between using MP3 (lossy) or FLAC (lossless) compression for their premium tier.</p>
                <p style="font-size: 1.1em;">Discuss the advantages and disadvantages of each format for this use case. Justify which format you would recommend.</p>
                
                <textarea class="input-field" id="examQ4" rows="12" 
                          placeholder="Consider:
- File sizes and bandwidth
- Audio quality
- User experience
- Storage costs
- Target audience"></textarea>
                
                <div style="margin: 20px 0;">
                    <label>Predicted marks: 
                        <input type="number" id="examQ4Marks" min="0" max="6" style="width: 60px;"
                               onchange="updatePredictedTotal()"> / 6
                    </label>
                    <button class="btn" onclick="checkExamAnswer('examQ4', 6)">Submit Answer</button>
                </div>
                
                <div class="mark-scheme" id="markScheme4">
                    <h4>‚úì Mark Scheme</h4>
                    <ul>
                        <li><strong>[1 mark]</strong> MP3 advantage: Much smaller file sizes (roughly 10x smaller)</li>
                        <li><strong>[1 mark]</strong> MP3 disadvantage: Quality loss / audiophiles may notice</li>
                        <li><strong>[1 mark]</strong> FLAC advantage: Perfect quality / no data loss</li>
                        <li><strong>[1 mark]</strong> FLAC disadvantage: Large files / more bandwidth needed</li>
                        <li><strong>[1 mark]</strong> Consideration of use case (streaming requires bandwidth)</li>
                        <li><strong>[1 mark]</strong> Justified recommendation with reasoning</li>
                    </ul>
                </div>
                
                <div class="feedback" id="examQ4-feedback"></div>
            </div>

            <div class="task-box" style="background: linear-gradient(to right, #d1fae5, #a7f3d0);">
                <h3>üìä Exam Summary</h3>
                <p style="font-size: 1.2em;">Total predicted marks: <strong id="totalPredicted">0</strong> / 18</p>
                <p style="font-size: 1.2em;">Predicted grade: <strong id="predictedGrade">-</strong></p>
                
                <div style="margin-top: 20px;">
                    <h4>Grade Boundaries (approximate):</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li>Grade 9: 16-18 marks (89%+)</li>
                        <li>Grade 7-8: 13-15 marks (72%+)</li>
                        <li>Grade 5-6: 10-12 marks (56%+)</li>
                        <li>Grade 4: 7-9 marks (39%+)</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 6: Extension Activities -->
        <section class="section" id="section6">
            <h2>Extension Activities</h2>
            
            <div class="extension-box">
                <h3>üöÄ Beyond the Specification</h3>
                <p>These advanced topics will give you a deeper understanding of compression and prepare you for A-Level and beyond!</p>
            </div>

            <div class="task-box">
                <h3>üå≥ Extension 1: Huffman Coding</h3>
                <p>Huffman coding assigns shorter codes to more frequent characters - like Morse code for computers!</p>
                
                <div class="simulation-container">
                    <h4>Interactive Huffman Tree Builder</h4>
                    <input type="text" class="input-field" id="huffmanInput" placeholder="Enter text to analyze..." value="HELLO">
                    <button class="btn" onclick="buildHuffmanTree()">Build Huffman Tree</button>
                    
                    <div id="huffmanVisualization" style="margin-top: 20px;">
                        <!-- Tree visualization will appear here -->
                    </div>
                </div>
                
                <p style="margin-top: 30px;">Research and explain how Huffman coding differs from RLE:</p>
                <textarea class="input-field" id="extension1" rows="5" 
                          placeholder="Consider: How does it handle frequency? Is it better for certain types of data?"></textarea>
                <button class="btn" onclick="saveExtension('extension1')">üíæ Save Response</button>
            </div>

            <div class="task-box">
                <h3>üé¨ Extension 2: Video Compression Magic</h3>
                <p>Modern video codecs use incredibly clever techniques!</p>
                
                <div style="background: linear-gradient(to right, #e0e7ff, #c7d2fe); padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4>Key Concepts:</h4>
                    <ul>
                        <li><strong>Spatial Compression:</strong> Compress each frame (like JPEG)</li>
                        <li><strong>Temporal Compression:</strong> Only store changes between frames</li>
                        <li><strong>Motion Vectors:</strong> Track how objects move</li>
                    </ul>
                </div>
                
                <p>Investigate H.264/H.265 codecs and explain temporal compression:</p>
                <textarea class="input-field" id="extension2" rows="5" 
                          placeholder="How do modern codecs achieve 100:1 compression for video?"></textarea>
                <button class="btn" onclick="saveExtension('extension2')">üíæ Save Response</button>
            </div>

            <div class="task-box">
                <h3>ü§ñ Extension 3: AI and Compression</h3>
                <p>Machine learning is revolutionizing compression!</p>
                
                <div class="mini-game">
                    <h4>AI Compression Simulator</h4>
                    <p>See how AI can "learn" patterns in data:</p>
                    <div id="aiCompressionDemo" style="padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <canvas id="aiCanvas" width="400" height="200"></canvas>
                    </div>
                    <button class="btn" onclick="runAICompression()">Run AI Compression</button>
                </div>
                
                <p style="margin-top: 30px;">How might AI improve compression in the future?</p>
                <textarea class="input-field" id="extension3" rows="5" 
                          placeholder="Think about: Pattern recognition, predictive models, context understanding..."></textarea>
                <button class="btn" onclick="saveExtension('extension3')">üíæ Save Response</button>
            </div>

            <div class="task-box">
                <h3>üî¨ Extension 4: Quantum Compression</h3>
                <p>The cutting edge of computer science!</p>
                
                <p>Research quantum data compression and write a brief explanation:</p>
                <textarea class="input-field" id="extension4" rows="5" 
                          placeholder="How might quantum computers change compression?"></textarea>
                <button class="btn" onclick="saveExtension('extension4')">üíæ Save Response</button>
            </div>

            <div class="leaderboard">
                <h3>üèÜ Extension Masters</h3>
                <p style="text-align: center;">Complete all extensions to unlock the "Compression Genius" achievement!</p>
                <div id="extensionProgress" style="margin-top: 20px;">
                    <div class="achievement-progress">
                        <div class="achievement-progress-fill" id="extensionProgressFill" style="width: 0%;"></div>
                    </div>
                    <p style="text-align: center; margin-top: 10px;">Progress: <span id="extensionCount">0</span>/4</p>
                </div>
            </div>
        </section>

        <!-- Section 7: Summary Quiz -->
        <section class="section" id="section7">
            <h2>Final Challenge: Summary Quiz</h2>
            
            <div class="task-box" style="background: var(--gradient-1); color: white;">
                <h3>üéØ Test Your Mastery</h3>
                <p style="font-size: 1.2em;">Complete this final quiz to prove you're a compression expert!</p>
                <p>‚ö° Quick fire round - 30 seconds per question!</p>
                <p>üèÜ Score 6/8 or higher to pass</p>
            </div>

            <div class="timer-display" id="quizTimerDisplay" style="position: sticky; top: 100px; z-index: 50; margin: 20px auto; width: fit-content;">
                <span>‚è±Ô∏è</span>
                <span id="quizTimer">Time: --</span>
            </div>

            <div id="summaryQuiz">
                <!-- Questions dynamically loaded -->
            </div>
            
            <button class="btn btn-success" onclick="submitSummaryQuiz()" style="font-size: 1.2em; padding: 20px 40px;">
                Submit Final Quiz üöÄ
            </button>
            <div class="feedback" id="summary-feedback"></div>
            
            <div id="quizResults" style="display: none; margin-top: 30px;">
                <div class="task-box" style="background: linear-gradient(to right, #fef3c7, #fed7aa);">
                    <h3>üìä Your Results</h3>
                    <p style="font-size: 1.5em;">Score: <strong id="quizScore"></strong>/8</p>
                    <div id="quizBreakdown" style="margin-top: 20px;"></div>
                    
                    <div id="quizAchievement" style="margin-top: 30px; display: none;">
                        <h4>üèÜ Achievement Unlocked!</h4>
                        <p id="quizAchievementText"></p>
                    </div>
                </div>
            </div>

            <div class="videos-section">
                <h3>üìπ Related Videos</h3>
                <p>Your teacher may show additional video resources here:</p>
                <div class="video-placeholder">
                    <p>Video content will be added by your teacher</p>
                </div>
                <div style="margin-top: 20px;">
                    <p><strong>Recommended channels:</strong></p>
                    <ul style="text-align: left; max-width: 600px; margin: 0 auto;">
                        <li>Computerphile - Deep dives into compression algorithms</li>
                        <li>Tom Scott - Real-world compression examples</li>
                        <li>CrashCourse Computer Science - Visual explanations</li>
                    </ul>
                </div>
            </div>

            <div class="task-box" style="margin-top: 40px; background: var(--gradient-success); color: white;">
                <h3>üéâ Congratulations!</h3>
                <p style="font-size: 1.2em;">You've completed the Data Compression worksheet!</p>
                <p>Final XP: <strong id="finalXP">0</strong> | Level: <strong id="finalLevel">0</strong></p>
                
                <div style="margin-top: 30px;">
                    <h4>Next Steps:</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li>üìö Review any sections you found challenging</li>
                        <li>üß™ Try the extension activities if you haven't already</li>
                        <li>üìù Practice more exam questions</li>
                        <li>üéØ Challenge yourself with the hidden easter eggs!</li>
                    </ul>
                </div>
            </div>
        </section>
    </div>

    <!-- Accessibility Controls -->
    <div class="accessibility-controls collapsed" id="accessControls">
        <button class="access-toggle" onclick="toggleAccessControls()">
            ‚ôø Accessibility
        </button>
        <div class="access-buttons">
            <button onclick="toggleHighContrast()">üî≤ High Contrast</button>
            <button onclick="changeFontSize(2)">A+ Larger Text</button>
            <button onclick="changeFontSize(-2)">A- Smaller Text</button>
            <button onclick="toggleDyslexicFont()">üìñ Dyslexic Font</button>
            <button onclick="toggleReducedMotion()">üé¨ Reduce Motion</button>
        </div>
    </div>

    <!-- Feedback Button and Form -->
    <button class="feedback-btn" onclick="toggleFeedbackForm()">üí¨ Feedback</button>
    
    <div class="feedback-form" id="feedbackForm">
        <h4>Submit Feedback</h4>
        <p>Found a bug? Have a suggestion? Let us know!</p>
        <textarea id="feedbackText" rows="5" placeholder="Describe any bugs or suggest features..."></textarea>
        <div style="margin-top: 15px; display: flex; gap: 10px;">
            <button class="btn" onclick="submitFeedback()">Send</button>
            <button class="btn btn-danger" onclick="toggleFeedbackForm()">Cancel</button>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievementPopup">
        <h4 id="achievementTitle">Achievement Unlocked!</h4>
        <p id="achievementDesc">Description</p>
        <div class="achievement-progress">
            <div class="achievement-progress-fill" id="achievementProgressFill"></div>
        </div>
    </div>

    <!-- Paste Warning -->
    <div class="paste-warning" id="pasteWarning">
        No pasting allowed!<br>
        <span style="font-size: 0.8em;">Type your own answers to learn properly! üìù</span>
    </div>

    <!-- Easter Egg -->
    <div class="easter-egg" id="easterEgg">üéâ</div>

    <!-- Sound Effects (muted by default) -->
    <audio id="successSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLYiTcIG2m98OScTgwOUany7blmFgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
    </audio>

    <script>
        // Global Variables
        let currentSection = 0;
        const totalSections = 8;
        let userXP = 0;
        let userLevel = 0;
        let achievements = new Set();
        let sectionProgress = new Array(totalSections).fill(false);
        let hintUsed = {};
        let soundEnabled = true;
        let gameInterval = null;
        let timerIntervals = {};
        let extensionsSaved = new Set();
        
        // XP Requirements per level
        const xpPerLevel = [0, 100, 250, 450, 700, 1000];
        
        // Konami Code
        const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let konamiIndex = 0;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeSections();
            initializeDragDrop();
            initializeCanvas();
            initializePixelGrids();
            loadSummaryQuiz();
            preventPaste();
            setupMobileGestures();
            setupKeyboardShortcuts();
            loadProgress();
            initializeBinaryDisplay();
            updateLeaderboard();
        });

        // Section Navigation
        function initializeSections() {
            const indicator = document.getElementById('sectionIndicator');
            for (let i = 0; i < totalSections; i++) {
                const dot = document.createElement('div');
                dot.className = 'section-dot';
                if (i === 0) dot.classList.add('active');
                dot.onclick = () => goToSection(i);
                dot.title = `Section ${i}`;
                indicator.appendChild(dot);
            }
            updateNavButtons();
        }

        function navigateSection(direction) {
            const newSection = currentSection + direction;
            if (newSection >= 0 && newSection < totalSections) {
                goToSection(newSection);
                playSound('navigate');
            }
        }

        function goToSection(index) {
            // Hide current section
            document.getElementById(`section${currentSection}`).classList.remove('active');
            
            // Show new section
            document.getElementById(`section${index}`).classList.add('active');
            currentSection = index;
            
            // Update indicators
            document.querySelectorAll('.section-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
                dot.classList.toggle('completed', sectionProgress[i]);
            });
            
            updateNavButtons();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Update feedback form context
            updateFeedbackContext();
        }

        function updateNavButtons() {
            document.getElementById('prevBtn').disabled = currentSection === 0;
            document.getElementById('nextBtn').disabled = currentSection === totalSections - 1;
        }

        function resetSection() {
            const section = document.getElementById(`section${currentSection}`);
            
            // Reset inputs
            section.querySelectorAll('input[type="text"], input[type="number"], textarea').forEach(input => {
                input.value = '';
            });
            
            // Reset selections
            section.querySelectorAll('select').forEach(select => {
                select.selectedIndex = 0;
            });
            
            // Reset checkboxes
            section.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            
            // Reset quiz options
            section.querySelectorAll('.quiz-option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
                option.disabled = false;
            });
            
            // Reset drag and drop
            resetDragDrop();
            
            // Hide feedbacks
            section.querySelectorAll('.feedback').forEach(fb => {
                fb.style.display = 'none';
            });
            
            // Hide mark schemes
            section.querySelectorAll('.mark-scheme').forEach(ms => {
                ms.style.display = 'none';
            });
            
            // Clear timers
            Object.keys(timerIntervals).forEach(key => {
                if (key.startsWith('q')) {
                    clearInterval(timerIntervals[key]);
                    document.getElementById(key + 'Timer').textContent = '';
                }
            });
            
            playSound('reset');
            showAchievement('Fresh Start', 'Reset a section to try again', 25);
        }

        // XP and Achievement System
        function addXP(amount, reason) {
            // Apply hint penalty if used
            if (reason && hintUsed[reason]) {
                amount = Math.floor(amount * 0.8);
            }
            
            const previousLevel = userLevel;
            userXP += amount;
            updateXPDisplay();
            
            // Check for level up
            for (let i = userLevel + 1; i < xpPerLevel.length; i++) {
                if (userXP >= xpPerLevel[i]) {
                    userLevel = i;
                    playSound('levelup');
                    showAchievement(`Level ${userLevel}!`, `You've reached level ${userLevel}!`, 100);
                    
                    // Unlock special features at certain levels
                    if (userLevel === 3) {
                        showAchievement('Dedicated Learner', 'Reached Level 3 - Keep going!', 50);
                    } else if (userLevel === 5) {
                        showAchievement('Compression Master', 'Reached Maximum Level!', 200);
                        triggerEasterEgg('üéì');
                    }
                }
            }
            
            // Update leaderboard
            updateLeaderboard();
        }

        function updateXPDisplay() {
            document.getElementById('xp').textContent = userXP;
            document.getElementById('level').textContent = userLevel;
            
            const currentLevelXP = xpPerLevel[userLevel] || 0;
            const nextLevelXP = xpPerLevel[userLevel + 1] || xpPerLevel[xpPerLevel.length - 1];
            const progress = userLevel < 5 ? 
                ((userXP - currentLevelXP) / (nextLevelXP - currentLevelXP)) * 100 : 
                100;
            
            document.getElementById('xpFill').style.width = progress + '%';
            document.getElementById('xpToNext').textContent = userLevel < 5 ? 
                (nextLevelXP - userXP) : 'MAX';
        }

        function showAchievement(title, description, xpReward = 50) {
            const achievementKey = title.toLowerCase().replace(/\s+/g, '-');
            
            // Check if already earned
            if (achievements.has(achievementKey)) return;
            
            achievements.add(achievementKey);
            
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementDesc').textContent = description;
            
            // Update progress bar
            const progress = (achievements.size / 20) * 100; // Assuming 20 total achievements
            document.getElementById('achievementProgressFill').style.width = progress + '%';
            
            popup.style.display = 'block';
            
            // Add particles effect
            createParticles();
            
            // Play sound
            playSound('achievement');
            
            setTimeout(() => {
                popup.style.display = 'none';
            }, 4000);
            
            // Add XP for achievement
            if (xpReward > 0) {
                addXP(xpReward, 'achievement');
            }
        }

        function createParticles() {
            const colors = ['#667eea', '#48bb78', '#ed8936', '#f56565', '#38b2ac'];
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: fixed;
                    width: ${Math.random() * 10 + 5}px;
                    height: ${Math.random() * 10 + 5}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    border-radius: 50%;
                    top: 50%;
                    right: 30px;
                    pointer-events: none;
                    z-index: 1001;
                    animation: particle-${i} ${1 + Math.random()}s ease-out forwards;
                `;
                
                const angle = (Math.PI * 2 * i) / 30;
                const velocity = 100 + Math.random() * 200;
                
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes particle-${i} {
                        to {
                            transform: translate(${Math.cos(angle) * velocity}px, ${Math.sin(angle) * velocity}px);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    particle.remove();
                    style.remove();
                }, 2000);
            }
        }

        // Sound System
        function playSound(type) {
            if (!soundEnabled) return;
            
            // Create audio context on first user interaction
            if (!window.audioContext) {
                window.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            const ctx = window.audioContext;
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);
            
            switch(type) {
                case 'success':
                    oscillator.frequency.setValueAtTime(523.25, ctx.currentTime); // C5
                    oscillator.frequency.setValueAtTime(659.25, ctx.currentTime + 0.1); // E5
                    oscillator.frequency.setValueAtTime(783.99, ctx.currentTime + 0.2); // G5
                    break;
                case 'error':
                    oscillator.frequency.setValueAtTime(200, ctx.currentTime);
                    oscillator.frequency.setValueAtTime(150, ctx.currentTime + 0.1);
                    break;
                case 'achievement':
                    oscillator.frequency.setValueAtTime(440, ctx.currentTime); // A4
                    oscillator.frequency.setValueAtTime(554.37, ctx.currentTime + 0.1); // C#5
                    oscillator.frequency.setValueAtTime(659.25, ctx.currentTime + 0.2); // E5
                    oscillator.frequency.setValueAtTime(880, ctx.currentTime + 0.3); // A5
                    break;
                case 'levelup':
                    oscillator.frequency.setValueAtTime(261.63, ctx.currentTime); // C4
                    oscillator.frequency.setValueAtTime(329.63, ctx.currentTime + 0.1); // E4
                    oscillator.frequency.setValueAtTime(392.00, ctx.currentTime + 0.2); // G4
                    oscillator.frequency.setValueAtTime(523.25, ctx.currentTime + 0.3); // C5
                    break;
                case 'navigate':
                    oscillator.frequency.setValueAtTime(440, ctx.currentTime);
                    break;
                case 'reset':
                    oscillator.frequency.setValueAtTime(300, ctx.currentTime);
                    oscillator.frequency.setValueAtTime(400, ctx.currentTime + 0.05);
                    break;
            }
            
            gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
            
            oscillator.start(ctx.currentTime);
            oscillator.stop(ctx.currentTime + 0.5);
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundIcon').textContent = soundEnabled ? 'üîä' : 'üîá';
            document.getElementById('soundToggle').classList.toggle('muted', !soundEnabled);
            localStorage.setItem('soundEnabled', soundEnabled);
        }

        // Theme Toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('themeIcon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('darkMode', isDark);
            
            if (!achievements.has('night-owl') && isDark) {
                showAchievement('Night Owl', 'Enabled dark mode', 10);
            }
        }

        // Starter Activity Functions
        function checkStarterAnswer(button, question, answer) {
            const correct = (question === '1' && answer === 'd') || (question === '2' && answer === 'c');
            
            button.parentElement.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected');
                opt.disabled = true;
            });
            
            button.classList.add('selected');
            button.classList.add(correct ? 'correct' : 'incorrect');
            
            const feedback = document.getElementById(`starter-feedback-${question}`);
            if (correct) {
                feedback.className = 'feedback success';
                if (question === '1') {
                    feedback.textContent = 'Correct! Modern smartphone cameras produce very large uncompressed files.';
                    // Show next question
                    document.getElementById('starterQ2').style.display = 'block';
                } else {
                    feedback.textContent = 'Right! 1GB = 8000 Mb, so at 20 Mbps: 8000 √∑ 20 = 400 seconds ‚âà 7 minutes';
                }
                feedback.style.display = 'block';
                addXP(20, 'starter-quiz');
                playSound('success');
            } else {
                feedback.className = 'feedback error';
                if (question === '1') {
                    feedback.textContent = 'Not quite. Uncompressed smartphone photos are typically around 50 MB!';
                } else {
                    feedback.textContent = 'Try again! Remember: 1 GB = 8000 Megabits, and speed is in Megabits per second.';
                }
                feedback.style.display = 'block';
                playSound('error');
            }
        }

        function calculateStorageCrisis() {
            const photos = parseInt(document.getElementById('photosPerDay').value) || 20;
            const videos = parseInt(document.getElementById('videosPerDay').value) || 3;
            const storage = parseInt(document.getElementById('phoneStorage').value) || 128;
            
            // Calculations (MB per day)
            const photoSizeUncompressed = 50; // MB
            const photoSizeCompressed = 5; // MB (JPEG)
            const videoSizeUncompressed = 500; // MB per minute
            const videoSizeCompressed = 50; // MB per minute
            const videoMinutes = 1; // Average video length
            
            const dailyUncompressed = (photos * photoSizeUncompressed) + (videos * videoMinutes * videoSizeUncompressed);
            const dailyCompressed = (photos * photoSizeCompressed) + (videos * videoMinutes * videoSizeCompressed);
            
            const storageInMB = storage * 1024;
            const daysUntilFull1 = Math.floor(storageInMB / dailyUncompressed);
            const daysUntilFull2 = Math.floor(storageInMB / dailyCompressed);
            
            // Update display
            document.getElementById('noCompression').textContent = `${(dailyUncompressed / 1024).toFixed(1)} GB/day`;
            document.getElementById('withCompression').textContent = `${(dailyCompressed / 1024).toFixed(1)} GB/day`;
            document.getElementById('daysUntilFull1').textContent = `Days until full: ${daysUntilFull1}`;
            document.getElementById('daysUntilFull2').textContent = `Days until full: ${daysUntilFull2}`;
            
            // Animate the display
            document.querySelectorAll('.file-size-display').forEach(el => {
                el.style.animation = 'pulse 0.5s ease';
            });
            
            if (!achievements.has('calculator-master')) {
                showAchievement('Calculator Master', 'Used the storage calculator', 15);
            }
            
            playSound('success');
        }

        // Compression Game
        let gameScore = 0;
        let gameFiles = [];
        let gameRunning = false;

        function startCompressionGame() {
            gameScore = 0;
            gameFiles = [];
            gameRunning = true;
            document.getElementById('gameScore').textContent = gameScore;
            
            const gameArea = document.getElementById('compressionGame');
            gameArea.innerHTML = '';
            
            // Create game files
            gameInterval = setInterval(() => {
                if (!gameRunning) return;
                
                const file = document.createElement('div');
                file.style.cssText = `
                    position: absolute;
                    width: 60px;
                    height: 60px;
                    background: linear-gradient(135deg, #f56565, #e53e3e);
                    border-radius: 10px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-size: 24px;
                    cursor: pointer;
                    left: ${Math.random() * (gameArea.offsetWidth - 60)}px;
                    top: -60px;
                    transition: top 3s linear;
                `;
                file.textContent = ['üìÑ', 'üì∏', 'üéµ', 'üé•'][Math.floor(Math.random() * 4)];
                file.onclick = () => compressFile(file);
                
                gameArea.appendChild(file);
                gameFiles.push(file);
                
                // Move file down
                setTimeout(() => {
                    file.style.top = gameArea.offsetHeight + 'px';
                }, 10);
                
                // Remove file after it falls
                setTimeout(() => {
                    if (gameArea.contains(file)) {
                        gameArea.removeChild(file);
                        gameFiles = gameFiles.filter(f => f !== file);
                    }
                }, 3000);
            }, 1000);
            
            // End game after 30 seconds
            setTimeout(() => {
                endCompressionGame();
            }, 30000);
        }

        function compressFile(file) {
            if (!gameRunning) return;
            
            gameScore += 10;
            document.getElementById('gameScore').textContent = gameScore;
            
            // Compress animation
            file.style.background = 'linear-gradient(135deg, #48bb78, #38a169)';
            file.style.transform = 'scale(0.5)';
            file.style.opacity = '0';
            
            playSound('success');
            
            setTimeout(() => {
                if (file.parentNode) {
                    file.parentNode.removeChild(file);
                }
            }, 300);
            
            if (gameScore >= 100 && !achievements.has('compression-gamer')) {
                showAchievement('Compression Gamer', 'Score 100+ in the compression game!', 30);
            }
        }

        function endCompressionGame() {
            gameRunning = false;
            clearInterval(gameInterval);
            
            const gameArea = document.getElementById('compressionGame');
            gameArea.innerHTML = '<p style="color: white; font-size: 1.5em; text-align: center; margin-top: 100px;">Game Over!</p>';
            
            if (gameScore >= 50) {
                showAchievement('Quick Compressor', 'Good reflexes in the compression game!', 20);
            }
        }

        // Drag and Drop System
        function initializeDragDrop() {
            document.querySelectorAll('.drag-item').forEach(item => {
                item.addEventListener('dragstart', dragStart);
                item.addEventListener('dragend', dragEnd);
                
                // Touch support
                item.addEventListener('touchstart', touchStart, {passive: false});
                item.addEventListener('touchmove', touchMove, {passive: false});
                item.addEventListener('touchend', touchEnd);
            });
            
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('dragover', dragOver);
                zone.addEventListener('drop', drop);
                zone.addEventListener('dragleave', dragLeave);
            });
        }

        let draggedElement = null;
        let touchItem = null;
        let touchOffset = {x: 0, y: 0};

        function dragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function dragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function dragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function dragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function drop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            if (draggedElement && e.currentTarget.children.length === 0) {
                e.currentTarget.appendChild(draggedElement);
                playSound('navigate');
            }
        }

        // Touch support for drag and drop
        function touchStart(e) {
            touchItem = e.target;
            const touch = e.touches[0];
            const rect = touchItem.getBoundingClientRect();
            touchOffset.x = touch.clientX - rect.left;
            touchOffset.y = touch.clientY - rect.top;
            touchItem.style.zIndex = 1000;
            e.preventDefault();
        }

        function touchMove(e) {
            e.preventDefault();
            if (!touchItem) return;
            
            const touch = e.touches[0];
            touchItem.style.position = 'fixed';
            touchItem.style.left = (touch.clientX - touchOffset.x) + 'px';
            touchItem.style.top = (touch.clientY - touchOffset.y) + 'px';
            touchItem.style.pointerEvents = 'none';
            
            // Find drop zone under touch
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            const dropZone = elementBelow?.closest('.drop-zone');
            
            // Update hover states
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over');
            });
            if (dropZone) {
                dropZone.classList.add('drag-over');
            }
        }

        function touchEnd(e) {
            if (!touchItem) return;
            
            const touch = e.changedTouches[0];
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            const dropZone = elementBelow?.closest('.drop-zone');
            
            if (dropZone && dropZone.children.length === 0) {
                dropZone.appendChild(touchItem);
                playSound('navigate');
            }
            
            // Reset styles
            touchItem.style.position = '';
            touchItem.style.left = '';
            touchItem.style.top = '';
            touchItem.style.zIndex = '';
            touchItem.style.pointerEvents = '';
            
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over');
            });
            
            touchItem = null;
        }

        function checkDragDrop(sectionId) {
            const section = document.getElementById(sectionId);
            const zones = section.querySelectorAll('.drop-zone');
            let correct = 0;
            let total = zones.length;
            
            zones.forEach(zone => {
                const answer = zone.dataset.answer;
                const item = zone.querySelector('.drag-item');
                
                if (item && item.dataset.value === answer) {
                    zone.classList.add('correct');
                    zone.classList.remove('incorrect');
                    correct++;
                } else if (item) {
                    zone.classList.add('incorrect');
                    zone.classList.remove('correct');
                } else {
                    zone.classList.remove('correct', 'incorrect');
                }
            });
            
            const feedbackId = sectionId === 'section1' ? 'drag-feedback-1' : 'drag-feedback-4';
            const feedback = document.getElementById(feedbackId);
            
            if (correct === total) {
                feedback.className = 'feedback success';
                feedback.textContent = 'Perfect! All answers are correct! üéâ';
                feedback.style.display = 'block';
                addXP(40, 'drag-drop-' + sectionId);
                playSound('success');
                
                const sectionNum = parseInt(sectionId.replace('section', ''));
                sectionProgress[sectionNum] = true;
                
                if (!achievements.has('drag-master')) {
                    showAchievement('Drag Master', 'Completed all drag & drop correctly!', 25);
                }
            } else {
                feedback.className = 'feedback error';
                feedback.textContent = `You got ${correct} out of ${total} correct. Try again!`;
                feedback.style.display = 'block';
                playSound('error');
            }
        }

        function resetDragDrop() {
            const currentSectionEl = document.getElementById(`section${currentSection}`);
            currentSectionEl.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('correct', 'incorrect', 'drag-over');
                const item = zone.querySelector('.drag-item');
                if (item) {
                    const source = currentSectionEl.querySelector('.drag-source');
                    if (source) source.appendChild(item);
                }
            });
        }

        // Section 1 Functions
        function checkCompressionRatios() {
            const ratio1 = document.getElementById('ratio1').value.trim();
            const ratio2 = document.getElementById('ratio2').value.trim();
            
            let correct = 0;
            
            // Check ratio 1 (20/4 = 5)
            const acceptable1 = ['5:1', '5', '5.0', '5 to 1', '5/1'];
            if (acceptable1.some(ans => ratio1.toLowerCase().replace(/\s+/g, '') === ans.replace(/\s+/g, ''))) {
                correct++;
            }
            
            // Check ratio 2 (150/15 = 10)
            const acceptable2 = ['10:1', '10', '10.0', '10 to 1', '10/1'];
            if (acceptable2.some(ans => ratio2.toLowerCase().replace(/\s+/g, '') === ans.replace(/\s+/g, ''))) {
                correct++;
            }
            
            const feedback = document.getElementById('ratio-feedback');
            if (correct === 2) {
                feedback.className = 'feedback success';
                feedback.textContent = 'Excellent! Both compression ratios are correct!';
                feedback.style.display = 'block';
                addXP(35, 'compression-ratios');
                playSound('success');
            } else if (correct === 1) {
                feedback.className = 'feedback warning';
                feedback.textContent = 'One ratio is correct! Check your calculations for the other.';
                feedback.style.display = 'block';
                addXP(15, 'compression-ratios');
            } else {
                feedback.className = 'feedback error';
                feedback.textContent = 'Not quite. Remember: compression ratio = original size √∑ compressed size';
                feedback.style.display = 'block';
                playSound('error');
            }
        }

        // Binary Visualization
        function initializeBinaryDisplay() {
            animateBinaryCompression();
        }

        function animateBinaryCompression() {
            const original = 'AAABBBCCC';
            const compressed = '3A3B3C';
            
            const originalBinary = original.split('').map(char => 
                char.charCodeAt(0).toString(2).padStart(8, '0')
            ).join(' ');
            
            const compressedBinary = compressed.split('').map(char => 
                char.charCodeAt(0).toString(2).padStart(8, '0')
            ).join(' ');
            
            const originalDiv = document.getElementById('originalBinary');
            const compressedDiv = document.getElementById('compressedBinary');
            
            originalDiv.innerHTML = '';
            compressedDiv.innerHTML = '';
            
            // Animate original binary
            originalBinary.split(' ').forEach((byte, i) => {
                setTimeout(() => {
                    const span = document.createElement('span');
                    span.className = 'binary-bit';
                    span.textContent = byte + ' ';
                    originalDiv.appendChild(span);
                }, i * 100);
            });
            
            // Animate compressed binary
            setTimeout(() => {
                compressedBinary.split(' ').forEach((byte, i) => {
                    setTimeout(() => {
                        const span = document.createElement('span');
                        span.className = 'binary-bit';
                        span.textContent = byte + ' ';
                        compressedDiv.appendChild(span);
                    }, i * 100);
                });
            }, 1000);
            
            playSound('success');
        }

        // Section 2 - Image Compression
        function initializePixelGrids() {
            generateRandomImage();
        }

        function generateRandomImage() {
            const originalGrid = document.getElementById('originalGrid');
            const compressedGrid = document.getElementById('compressedGrid');
            
            originalGrid.innerHTML = '';
            compressedGrid.innerHTML = '';
            
            // Generate 100 pixels (10x10)
            for (let i = 0; i < 100; i++) {
                // Original pixel with full color
                const r = Math.floor(Math.random() * 256);
                const g = Math.floor(Math.random() * 256);
                const b = Math.floor(Math.random() * 256);
                
                const pixel1 = document.createElement('div');
                pixel1.className = 'pixel';
                pixel1.style.backgroundColor = `rgb(${r},${g},${b})`;
                pixel1.title = `RGB(${r},${g},${b})`;
                originalGrid.appendChild(pixel1);
                
                // Compressed pixel with reduced color depth
                const compression = parseInt(document.getElementById('compressionSlider').value);
                const colorReduction = Math.floor(compression / 10) + 1;
                
                const cr = Math.floor(r / colorReduction) * colorReduction;
                const cg = Math.floor(g / colorReduction) * colorReduction;
                const cb = Math.floor(b / colorReduction) * colorReduction;
                
                const pixel2 = document.createElement('div');
                pixel2.className = 'pixel';
                pixel2.style.backgroundColor = `rgb(${cr},${cg},${cb})`;
                pixel2.title = `RGB(${cr},${cg},${cb})`;
                compressedGrid.appendChild(pixel2);
            }
            
            updateCompressionStats();
        }

        function loadPresetImage(type) {
            const originalGrid = document.getElementById('originalGrid');
            const compressedGrid = document.getElementById('compressedGrid');
            
            originalGrid.innerHTML = '';
            compressedGrid.innerHTML = '';
            
            let colors;
            if (type === 'photo') {
                // Gradient simulating a sunset photo
                colors = [];
                for (let y = 0; y < 10; y++) {
                    for (let x = 0; x < 10; x++) {
                        const r = 255 - (y * 10);
                        const g = 100 + (y * 10);
                        const b = 50 + (x * 5);
                        colors.push({r, g, b});
                    }
                }
            } else if (type === 'logo') {
                // Sharp edges simulating a logo
                colors = [];
                for (let y = 0; y < 10; y++) {
                    for (let x = 0; x < 10; x++) {
                        if (x < 5 && y < 5) {
                            colors.push({r: 0, g: 0, b: 255}); // Blue
                        } else if (x >= 5 && y < 5) {
                            colors.push({r: 255, g: 0, b: 0}); // Red
                        } else if (x < 5 && y >= 5) {
                            colors.push({r: 0, g: 255, b: 0}); // Green
                        } else {
                            colors.push({r: 255, g: 255, b: 0}); // Yellow
                        }
                    }
                }
            }
            
            colors.forEach(color => {
                const pixel1 = document.createElement('div');
                pixel1.className = 'pixel';
                pixel1.style.backgroundColor = `rgb(${color.r},${color.g},${color.b})`;
                originalGrid.appendChild(pixel1);
                
                const compression = parseInt(document.getElementById('compressionSlider').value);
                const colorReduction = Math.floor(compression / 10) + 1;
                
                const cr = Math.floor(color.r / colorReduction) * colorReduction;
                const cg = Math.floor(color.g / colorReduction) * colorReduction;
                const cb = Math.floor(color.b / colorReduction) * colorReduction;
                
                const pixel2 = document.createElement('div');
                pixel2.className = 'pixel';
                pixel2.style.backgroundColor = `rgb(${cr},${cg},${cb})`;
                compressedGrid.appendChild(pixel2);
            });
            
            updateCompressionStats();
        }

        function updateImageCompression(value) {
            document.getElementById('compressionLevel').textContent = value + '%';
            
            const compressedGrid = document.getElementById('compressedGrid');
            const originalPixels = document.querySelectorAll('#originalGrid .pixel');
            const compressedPixels = compressedGrid.querySelectorAll('.pixel');
            
            const colorReduction = Math.floor(value / 10) + 1;
            
            originalPixels.forEach((pixel, i) => {
                const rgb = pixel.style.backgroundColor.match(/\d+/g);
                if (rgb && compressedPixels[i]) {
                    const r = Math.floor(rgb[0] / colorReduction) * colorReduction;
                    const g = Math.floor(rgb[1] / colorReduction) * colorReduction;
                    const b = Math.floor(rgb[2] / colorReduction) * colorReduction;
                    compressedPixels[i].style.backgroundColor = `rgb(${r},${g},${b})`;
                }
            });
            
            updateCompressionStats();
        }

        function updateCompressionStats() {
            const compression = parseInt(document.getElementById('compressionSlider').value);
            const originalSize = 300; // KB
            const compressedSize = Math.floor(originalSize * (1 - compression / 100));
            
            document.getElementById('originalSize').textContent = originalSize + ' KB';
            document.getElementById('compressedSize').textContent = compressedSize + ' KB';
            
            const colorCount = Math.floor(16777216 / Math.pow(2, compression / 10));
            document.getElementById('colorCount').textContent = colorCount.toLocaleString();
        }

        function resetPixels() {
            document.getElementById('compressionSlider').value = 50;
            updateImageCompression(50);
            generateRandomImage();
        }

        // Audio Compression Simulation
        function initializeFrequencyCanvas() {
            const canvas = document.getElementById('frequencyCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // Draw frequency spectrum
            drawFrequencySpectrum(ctx, false);
        }

        function drawFrequencySpectrum(ctx, showRemoved) {
            const width = ctx.canvas.width;
            const height = ctx.canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw frequency bars
            const barCount = 50;
            const barWidth = width / barCount;
            
            for (let i = 0; i < barCount; i++) {
                const frequency = (i / barCount) * 20000; // 0-20kHz
                const amplitude = Math.random() * 0.8 + 0.2;
                
                // Human hearing range is roughly 20Hz - 20kHz
                // Most sensitive 1kHz - 4kHz
                const isAudible = frequency > 20 && frequency < 18000;
                const isRemoved = !isAudible || (frequency > 15000 && !showRemoved);
                
                ctx.fillStyle = isRemoved ? '#f56565' : '#48bb78';
                if (showRemoved && isRemoved) {
                    ctx.fillStyle = '#ed8936';
                }
                
                const barHeight = amplitude * height * 0.8;
                ctx.fillRect(i * barWidth, height - barHeight, barWidth - 2, barHeight);
            }
            
            // Draw labels
            ctx.fillStyle = '#e2e8f0';
            ctx.font = '12px Arial';
            ctx.fillText('20Hz', 0, height - 5);
            ctx.fillText('20kHz', width - 40, height - 5);
            ctx.fillText('Human Hearing Range', width / 2 - 60, 20);
        }

        function playOriginalSound() {
            initializeFrequencyCanvas();
            playSound('achievement');
            
            // Animate sound wave
            const bars = document.querySelectorAll('.wave-bar');
            bars.forEach((bar, i) => {
                bar.style.animationDuration = '0.5s';
            });
        }

        function playCompressedSound() {
            const canvas = document.getElementById('frequencyCanvas');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                drawFrequencySpectrum(ctx, false);
            }
            playSound('success');
            
            // Animate sound wave with less variation
            const bars = document.querySelectorAll('.wave-bar');
            bars.forEach((bar, i) => {
                bar.style.animationDuration = '1s';
            });
        }

        function showRemovedFrequencies() {
            const canvas = document.getElementById('frequencyCanvas');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                drawFrequencySpectrum(ctx, true);
            }
        }

        // Initialize frequency canvas when section becomes active
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.target.classList.contains('active') && mutation.target.id === 'section2') {
                    setTimeout(initializeFrequencyCanvas, 100);
                }
            });
        });

        document.querySelectorAll('.section').forEach(section => {
            observer.observe(section, { attributes: true, attributeFilter: ['class'] });
        });

        // Fill in the blanks
        function checkLossyBlanks() {
            const answers = {
                'lossy-blank-1': 'smaller',
                'lossy-blank-2': 'some colors',
                'lossy-blank-3': 'color depth',
                'lossy-blank-4': 'hard to hear'
            };
            
            let correct = 0;
            const total = Object.keys(answers).length;
            
            for (const [id, answer] of Object.entries(answers)) {
                const userAnswer = document.getElementById(id).value;
                if (userAnswer === answer) {
                    correct++;
                    document.getElementById(id).style.borderColor = '#48bb78';
                } else {
                    document.getElementById(id).style.borderColor = '#f56565';
                }
            }
            
            const feedback = document.getElementById('lossy-blanks-feedback');
            if (correct === total) {
                feedback.className = 'feedback success';
                feedback.textContent = 'Perfect! All answers are correct! You understand lossy compression!';
                feedback.style.display = 'block';
                addXP(40, 'lossy-blanks');
                playSound('success');
            } else {
                feedback.className = 'feedback error';
                feedback.textContent = `You got ${correct} out of ${total} correct. Review the concepts and try again.`;
                feedback.style.display = 'block';
                playSound('error');
            }
        }

        function checkLossyChoices() {
            const checkboxes = document.querySelectorAll('#lossyChoices input[type="checkbox"]');
            const correct = ['text', 'code', 'spreadsheet', 'medical'];
            let userAnswers = [];
            
            checkboxes.forEach(cb => {
                if (cb.checked) userAnswers.push(cb.value);
                
                // Visual feedback
                const label = cb.parentElement;
                if (cb.checked && correct.includes(cb.value)) {
                    label.style.background = '#d4edda';
                } else if (cb.checked && !correct.includes(cb.value)) {
                    label.style.background = '#f8d7da';
                } else if (!cb.checked && correct.includes(cb.value)) {
                    label.style.background = '#fff3cd';
                }
            });
            
            const isCorrect = correct.length === userAnswers.length && 
                correct.every(ans => userAnswers.includes(ans));
            
            const feedback = document.getElementById('lossy-choices-feedback');
            if (isCorrect) {
                feedback.className = 'feedback success';
                feedback.textContent = 'Excellent! You correctly identified all files that need perfect accuracy.';
                feedback.style.display = 'block';
                addXP(45, 'lossy-choices');
                playSound('success');
                
                if (!achievements.has('safety-first')) {
                    showAchievement('Safety First', 'Knows when NOT to use lossy compression', 30);
                }
            } else {
                feedback.className = 'feedback error';
                feedback.textContent = 'Think about which files would be unusable if any data was lost.';
                feedback.style.display = 'block';
                playSound('error');
            }
        }

        // Section 3 - RLE Functions
        function demonstrateRLE() {
            const input = document.getElementById('rleInput').value.toUpperCase();
            if (!input) return;
            
            // Show loading
            document.getElementById('rleLoading').style.display = 'inline-block';
            
            setTimeout(() => {
                let compressed = '';
                let i = 0;
                
                while (i < input.length) {
                    let count = 1;
                    let char = input[i];
                    
                    while (i + count < input.length && input[i + count] === char) {
                        count++;
                    }
                    
                    compressed += count + char;
                    i += count;
                }
                
                // Hide loading
                document.getElementById('rleLoading').style.display = 'none';
                
                // Show results
                document.getElementById('rleVisualization').style.display = 'block';
                document.getElementById('rleOriginal').textContent = input;
                document.getElementById('originalLength').textContent = input.length;
                document.getElementById('rleCompressed').textContent = compressed;
                document.getElementById('compressedLength').textContent = compressed.length;
                
                const ratio = (input.length / compressed.length).toFixed(2);
                const savings = Math.round((1 - compressed.length / input.length) * 100);
                
                document.getElementById('rleRatio').textContent = ratio + ':1';
                if (savings > 0) {
                    document.getElementById('rleSavings').textContent = `üíæ Space saved: ${savings}%`;
                    document.getElementById('rleSavings').style.color = '#48bb78';
                } else {
                    document.getElementById('rleSavings').textContent = `‚ö†Ô∏è File size increased by ${Math.abs(savings)}%`;
                    document.getElementById('rleSavings').style.color = '#f56565';
                }
                
                playSound('success');
                
                if (!achievements.has('rle-explorer')) {
                    showAchievement('RLE Explorer', 'Used the RLE simulator', 15);
                }
            }, 500);
        }

        function tryRLEExample(example) {
            document.getElementById('rleInput').value = example;
            demonstrateRLE();
        }

        function checkRLEAnswers() {
            const answers = {
                'rle1': ['4W4B', '4w4b'],
                'rle2': ['3R4G2B1R', '3r4g2b1r', '3R4G2BR'],
                'rle3': ['5A3B3C1D', '5a3b3c1d', '5A3B3CD']
            };
            
            let correct = 0;
            
            for (const [id, acceptableAnswers] of Object.entries(answers)) {
                const userAnswer = document.getElementById(id).value.trim();
                const field = document.getElementById(id);
                
                if (acceptableAnswers.some(ans => ans.toLowerCase() === userAnswer.toLowerCase())) {
                    correct++;
                    field.style.borderColor = '#48bb78';
                } else {
                    field.style.borderColor = '#f56565';
                }
            }
            
            const feedback = document.getElementById('rle-feedback');
            if (correct === 3) {
                feedback.className = 'feedback success';
                feedback.textContent = 'Perfect! You\'ve mastered Run Length Encoding!';
                feedback.style.display = 'block';
                addXP(50, 'rle-practice');
                playSound('success');
                
                if (!achievements.has('rle-master')) {
                    showAchievement('RLE Master', 'Completed all RLE exercises correctly!', 40);
                }
            } else {
                feedback.className = 'feedback error';
                feedback.textContent = `You got ${correct} out of 3 correct. Remember: count consecutive characters!`;
                feedback.style.display = 'block';
                playSound('error');
            }
        }

        function checkRLESound() {
            const answer = document.getElementById('rleSoundAnswer').value.trim();
            const keywords = ['one', 'sample', 'count', 'repeat', 'store', '1000', 'times', 'frequency', 'consecutive'];
            const keywordCount = keywords.filter(word => 
                answer.toLowerCase().includes(word)
            ).length;
            
            const feedback = document.getElementById('rle-sound-feedback');
            
            if (answer.length < 50) {
                feedback.className = 'feedback warning';
                feedback.textContent = 'Your answer is too short. Explain in more detail how RLE would work with sound samples.';
                feedback.style.display = 'block';
                return;
            }
            
            if (keywordCount >= 4) {
                feedback.className = 'feedback success';
                feedback.textContent = 'Excellent explanation! You understand how RLE can compress repeated sound samples.';
                feedback.style.display = 'block';
                addXP(30 + keywordCount * 5, 'rle-sound');
                playSound('success');
            } else if (keywordCount >= 2) {
                feedback.className = 'feedback warning';
                feedback.textContent = 'Good start! Try to explain more clearly how RLE stores the count and the sample.';
                feedback.style.display = 'block';
                addXP(15, 'rle-sound');
            } else {
                feedback.className = 'feedback error';
                feedback.textContent = 'Explain how RLE would store one sample and a count of repetitions.';
                feedback.style.display = 'block';
                playSound('error');
            }
        }

        // RLE Game
        let rleGameScore = 0;
        let rleGameTime = 60;
        let rleGameInterval = null;
        let currentGameSequence = '';

        function startRLEGame() {
            rleGameScore = 0;
            rleGameTime = 60;
            document.getElementById('rleGameScore').textContent = rleGameScore;
            document.getElementById('gameTimer').textContent = rleGameTime;
            document.getElementById('gameAnswer').disabled = false;
            document.getElementById('submitGameBtn').disabled = false;
            
            // Start timer
            rleGameInterval = setInterval(() => {
                rleGameTime--;
                document.getElementById('gameTimer').textContent = rleGameTime;
                
                if (rleGameTime <= 0) {
                    endRLEGame();
                }
            }, 1000);
            
            generateGameSequence();
        }

        function generateGameSequence() {
            const chars = ['A', 'B', 'C', 'D'];
            let sequence = '';
            
            // Generate sequence with runs
            for (let i = 0; i < 3 + Math.floor(Math.random() * 3); i++) {
                const char = chars[Math.floor(Math.random() * chars.length)];
                const count = 2 + Math.floor(Math.random() * 4);
                sequence += char.repeat(count);
            }
            
            currentGameSequence = sequence;
            document.getElementById('gameSequence').textContent = sequence;
            document.getElementById('gameAnswer').value = '';
            document.getElementById('gameAnswer').focus();
        }

        function submitGameAnswer() {
            const answer = document.getElementById('gameAnswer').value.trim().toUpperCase();
            const correct = compressRLE(currentGameSequence);
            
            if (answer === correct) {
                rleGameScore += 10;
                document.getElementById('rleGameScore').textContent = rleGameScore;
                playSound('success');
                generateGameSequence();
                
                if (rleGameScore >= 50 && !achievements.has('rle-speedster')) {
                    showAchievement('RLE Speedster', 'Score 50+ in the RLE game!', 40);
                }
            } else {
                playSound('error');
                document.getElementById('gameAnswer').style.borderColor = '#f56565';
                setTimeout(() => {
                    document.getElementById('gameAnswer').style.borderColor = '';
                }, 500);
            }
        }

        function compressRLE(str) {
            let compressed = '';
            let i = 0;
            
            while (i < str.length) {
                let count = 1;
                let char = str[i];
                
                while (i + count < str.length && str[i + count] === char) {
                    count++;
                }
                
                compressed += count + char;
                i += count;
            }
            
            return compressed;
        }

        function endRLEGame() {
            clearInterval(rleGameInterval);
            document.getElementById('gameAnswer').disabled = true;
            document.getElementById('submitGameBtn').disabled = true;
            document.getElementById('gameSequence').textContent = `Game Over! Final Score: ${rleGameScore}`;
            
            if (rleGameScore >= 30) {
                showAchievement('RLE Gamer', 'Great performance in the RLE game!', 25);
            }
        }

        // Section 4 - File Formats
        function updateFormatRecommendation(type) {
            const imageSelect = document.getElementById('imageUseCase');
            const audioSelect = document.getElementById('audioUseCase');
            
            if (type === 'image') {
                const value = imageSelect.value;
                const div = document.getElementById('imageRecommendation');
                
                switch(value) {
                    case 'photo':
                        div.innerHTML = '<strong>Recommended: JPEG</strong><br>Perfect for photos with many colors and gradients. 90% size reduction with minimal visible quality loss.';
                        break;
                    case 'logo':
                        div.innerHTML = '<strong>Recommended: PNG</strong><br>Lossless compression preserves sharp edges and supports transparency. Essential for logos and graphics.';
                        break;
                    case 'scan':
                        div.innerHTML = '<strong>Recommended: PNG or PDF</strong><br>Text must remain sharp and readable. Lossless compression prevents text blur.';
                        break;
                    case 'art':
                        div.innerHTML = '<strong>Recommended: PNG (final) or PSD (working)</strong><br>Preserve all artistic details. Use lossless for final output.';
                        break;
                    default:
                        div.innerHTML = '';
                }
            } else if (type === 'audio') {
                const value = audioSelect.value;
                const div = document.getElementById('audioRecommendation');
                
                switch(value) {
                    case 'streaming':
                        div.innerHTML = '<strong>Recommended: MP3 (192-320 kbps)</strong><br>Good balance of quality and file size. Most compatible format.';
                        break;
                    case 'podcast':
                        div.innerHTML = '<strong>Recommended: MP3 (128 kbps)</strong><br>Speech doesn\'t need high bitrates. Smaller files for easier distribution.';
                        break;
                    case 'studio':
                        div.innerHTML = '<strong>Recommended: WAV or FLAC</strong><br>No compression for professional work. Preserve every detail for editing.';
                        break;
                    case 'ringtone':
                        div.innerHTML = '<strong>Recommended: MP3 or M4R</strong><br>Small file size important. Short duration means quality less critical.';
                        break;
                    default:
                        div.innerHTML = '';
                }
            }
            
            if (!achievements.has('format-expert') && imageSelect.value && audioSelect.value) {
                showAchievement('Format Expert', 'Explored all file format options', 20);
            }
        }

        function updateLeaderboard() {
            document.getElementById('yourScore').textContent = userXP + ' XP';
            
            // Update leaderboard position
            const entries = document.querySelectorAll('.leaderboard-entry');
            if (userXP > 850) {
                entries[0].querySelector('span:last-child').innerHTML = `<strong>${userXP} XP</strong>`;
                entries[1].querySelector('span:first-child').textContent = '2nd';
                entries[2].querySelector('span:first-child').textContent = '3rd';
            } else if (userXP > 720) {
                entries[1].innerHTML = `<span class="leaderboard-rank">2nd</span><span>You</span><span><strong>${userXP} XP</strong></span>`;
            }
        }

        // Canvas Drawing Functions
        let isDrawing = false;
        let drawColor = '#000';
        let drawTool = 'pen';

        function initializeCanvas() {
            const canvas = document.getElementById('drawingCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            function resizeCanvas() {
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;
                ctx.strokeStyle = drawColor;
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Drawing functions
            function startDrawing(e) {
                isDrawing = true;
                const pos = getPosition(e);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                const pos = getPosition(e);
                
                if (drawTool === 'pen') {
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.strokeStyle = drawColor;
                    ctx.lineWidth = 2;
                } else if (drawTool === 'eraser') {
                    ctx.globalCompositeOperation = 'destination-out';
                    ctx.lineWidth = 20;
                }
                
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
            }
            
            function stopDrawing() {
                if (isDrawing) {
                    isDrawing = false;
                    ctx.beginPath();
                }
            }
            
            function getPosition(e) {
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                return { x, y };
            }
            
            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            canvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                startDrawing(e);
            });
            
            canvas.addEventListener('touchmove', function(e) {
                e.preventDefault();
                draw(e);
            });
            
            canvas.addEventListener('touchend', stopDrawing);
        }

        function setDrawColor(color) {
            drawColor = color;
            drawTool = 'pen';
            updateCanvasTools();
        }

        function setDrawTool(tool) {
            drawTool = tool;
            updateCanvasTools();
        }

        function updateCanvasTools() {
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.toggle('selected', opt.style.background === drawColor);
            });
            
            document.querySelectorAll('.canvas-tool').forEach(tool => {
                tool.classList.remove('active');
            });
        }

        function clearCanvas() {
            const canvas = document.getElementById('drawingCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            playSound('reset');
        }

        // Exam Question Functions
        function startTimer(questionId, marks) {
            const timerId = questionId + 'Timer';
            const seconds = marks * 60; // 1 minute per mark
            let timeLeft = seconds;
            
            // Clear existing timer
            if (timerIntervals[questionId]) {
                clearInterval(timerIntervals[questionId]);
            }
            
            timerIntervals[questionId] = setInterval(() => {
                timeLeft--;
                const mins = Math.floor(timeLeft / 60);
                const secs = timeLeft % 60;
                document.getElementById(timerId).textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerIntervals[questionId]);
                    document.getElementById(timerId).textContent = 'Time\'s up!';
                    document.getElementById(timerId).style.color = '#f56565';
                }
            }, 1000);
            
            // Show initial time
            const mins = Math.floor(timeLeft / 60);
            const secs = timeLeft % 60;
            document.getElementById(timerId).textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function checkExamAnswer(questionId, maxMarks) {
            const answer = document.getElementById(questionId).value.trim();
            const predictedMarks = parseInt(document.getElementById(questionId + 'Marks').value) || 0;
            
            if (answer.length < 50) {
                const feedback = document.getElementById(questionId + '-feedback');
                feedback.className = 'feedback warning';
                feedback.textContent = 'Please write a more detailed answer before checking the mark scheme.';
                feedback.style.display = 'block';
                return;
            }
            
            // Clear timer
            const timerId = questionId.replace('examQ', 'q');
            if (timerIntervals[timerId]) {
                clearInterval(timerIntervals[timerId]);
            }
            
            // Show mark scheme
            document.getElementById('markScheme' + questionId.slice(-1)).style.display = 'block';
            
            const feedback = document.getElementById(questionId + '-feedback');
            feedback.className = 'feedback success';
            feedback.textContent = `Answer submitted! You predicted ${predictedMarks}/${maxMarks} marks. Review the mark scheme above.`;
            feedback.style.display = 'block';
            
            // Award XP based on answer length and keywords
            const xpReward = Math.min(20 + Math.floor(answer.length / 20), 50);
            addXP(xpReward, 'exam-' + questionId);
            
            if (!achievements.has('exam-ready')) {
                showAchievement('Exam Ready', 'Completed your first exam question!', 30);
            }
            
            // Check if all exam questions attempted
            if (document.querySelectorAll('.mark-scheme[style*="block"]').length === 4) {
                showAchievement('Exam Master', 'Attempted all practice exam questions!', 50);
            }
            
            playSound('success');
        }

        function updatePredictedTotal() {
            let total = 0;
            for (let i = 1; i <= 4; i++) {
                total += parseInt(document.getElementById(`examQ${i}Marks`).value) || 0;
            }
            
            document.getElementById('totalPredicted').textContent = total;
            
            // Calculate grade
            let grade = '-';
            if (total >= 16) grade = '9';
            else if (total >= 14) grade = '8';
            else if (total >= 13) grade = '7';
            else if (total >= 11) grade = '6';
            else if (total >= 10) grade = '5';
            else if (total >= 7) grade = '4';
            else if (total >= 5) grade = '3';
            else if (total >= 3) grade = '2';
            else if (total >= 1) grade = '1';
            
            document.getElementById('predictedGrade').textContent = grade;
        }

        // Extension Activities
        function saveExtension(id) {
            const answer = document.getElementById(id).value.trim();
            if (answer.length > 50) {
                extensionsSaved.add(id);
                updateExtensionProgress();
                
                if (!achievements.has('extension-started')) {
                    showAchievement('Going Beyond', 'Started extension activities', 30);
                }
                
                if (extensionsSaved.size === 4 && !achievements.has('extension-master')) {
                    showAchievement('Compression Genius', 'Completed all extension activities!', 100);
                }
                
                playSound('success');
                
                // Visual feedback
                const button = event.target;
                button.textContent = '‚úÖ Saved';
                button.classList.add('btn-success');
                setTimeout(() => {
                    button.textContent = 'üíæ Save Response';
                    button.classList.remove('btn-success');
                }, 2000);
            }
        }

        function updateExtensionProgress() {
            const count = extensionsSaved.size;
            const percentage = (count / 4) * 100;
            
            document.getElementById('extensionCount').textContent = count;
            document.getElementById('extensionProgressFill').style.width = percentage + '%';
        }

        // Huffman Tree Builder
        function buildHuffmanTree() {
            const input = document.getElementById('huffmanInput').value || 'HELLO';
            const viz = document.getElementById('huffmanVisualization');
            
            // Count frequencies
            const freq = {};
            for (const char of input) {
                freq[char] = (freq[char] || 0) + 1;
            }
            
            // Simple visualization
            viz.innerHTML = '<h5>Character Frequencies:</h5>';
            const freqList = Object.entries(freq).sort((a, b) => b[1] - a[1]);
            
            freqList.forEach(([char, count]) => {
                const bar = document.createElement('div');
                bar.style.cssText = `
                    background: var(--gradient-1);
                    color: white;
                    padding: 10px;
                    margin: 5px 0;
                    border-radius: 5px;
                    width: ${count * 50}px;
                    min-width: 80px;
                `;
                bar.textContent = `${char}: ${count}`;
                viz.appendChild(bar);
            });
            
            viz.innerHTML += '<p style="margin-top: 20px;">Huffman coding would assign shorter codes to more frequent characters!</p>';
        }

        // AI Compression Demo
        function runAICompression() {
            const canvas = document.getElementById('aiCanvas');
            const ctx = canvas.getContext('2d');
            
            // Create pattern
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Original pattern
            ctx.fillStyle = '#667eea';
            for (let i = 0; i < 10; i++) {
                for (let j = 0; j < 5; j++) {
                    if ((i + j) % 2 === 0) {
                        ctx.fillRect(i * 40, j * 40, 40, 40);
                    }
                }
            }
            
            // Simulate AI compression
            setTimeout(() => {
                ctx.fillStyle = 'rgba(72, 187, 120, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Pattern Detected!', canvas.width / 2, canvas.height / 2);
                ctx.font = '14px Arial';
                ctx.fillText('AI compressed to simple rule', canvas.width / 2, canvas.height / 2 + 30);
                
                playSound('achievement');
            }, 1000);
        }

        // Summary Quiz
        function loadSummaryQuiz() {
            const questions = [
                {
                    question: "Which compression type permanently removes data?",
                    options: ["Lossless", "Lossy", "RLE", "Both lossy and lossless"],
                    correct: 1
                },
                {
                    question: "Run Length Encoding is an example of:",
                    options: ["Lossy compression", "Lossless compression", "Audio compression", "Video compression"],
                    correct: 1
                },
                {
                    question: "JPEG uses which type of compression?",
                    options: ["Lossless", "Lossy", "No compression", "RLE"],
                    correct: 1
                },
                {
                    question: "Why might text files NOT use lossy compression?",
                    options: ["They are too small", "They would become unreadable", "They cannot be compressed", "Lossy is too slow"],
                    correct: 1
                },
                {
                    question: "If a 12MB file compresses to 3MB, what is the compression ratio?",
                    options: ["3:1", "4:1", "1:4", "9:1"],
                    correct: 1
                },
                {
                    question: "MP3 removes which type of audio data?",
                    options: ["All high frequencies", "Frequencies humans can't hear well", "All low frequencies", "Random frequencies"],
                    correct: 1
                },
                {
                    question: "Which is NOT a benefit of compression?",
                    options: ["Faster downloads", "Less bandwidth usage", "Improved file quality", "Reduced storage needs"],
                    correct: 2
                },
                {
                    question: "RLE would work best on which data?",
                    options: ["Random text", "A solid color image", "Complex music", "Encrypted data"],
                    correct: 1
                }
            ];
            
            const container = document.getElementById('summaryQuiz');
            container.innerHTML = '';
            
            // Randomize questions
            questions.sort(() => Math.random() - 0.5);
            
            questions.forEach((q, index) => {
                const div = document.createElement('div');
                div.className = 'task-box';
                div.style.marginBottom = '20px';
                div.innerHTML = `<h4>Question ${index + 1}</h4><p style="font-size: 1.1em; margin-bottom: 20px;">${q.question}</p>`;
                
                // Randomize options but track correct answer
                const options = q.options.map((opt, i) => ({text: opt, index: i}));
                const correctIndex = q.correct;
                options.sort(() => Math.random() - 0.5);
                
                options.forEach(opt => {
                    const button = document.createElement('button');
                    button.className = 'quiz-option';
                    button.textContent = opt.text;
                    button.onclick = function() {
                        this.parentElement.querySelectorAll('.quiz-option').forEach(b => b.classList.remove('selected'));
                        this.classList.add('selected');
                        this.dataset.answer = opt.index;
                    };
                    div.appendChild(button);
                });
                
                div.dataset.correct = correctIndex;
                container.appendChild(div);
            });
            
            // Start quiz timer
            document.getElementById('quizTimerDisplay').style.display = 'flex';
        }

        let quizTimerInterval = null;
        let quizTimeLeft = 240; // 4 minutes total

        function submitSummaryQuiz() {
            // Stop timer
            if (quizTimerInterval) {
                clearInterval(quizTimerInterval);
            }
            
            const questions = document.querySelectorAll('#summaryQuiz .task-box');
            let correct = 0;
            const results = [];
            
            questions.forEach((q, index) => {
                const selected = q.querySelector('.quiz-option.selected');
                const correctAnswer = parseInt(q.dataset.correct);
                
                if (selected && parseInt(selected.dataset.answer) === correctAnswer) {
                    correct++;
                    selected.classList.add('correct');
                    results.push(`Question ${index + 1}: <span style="color: #48bb78;">‚úì Correct</span>`);
                } else {
                    if (selected) selected.classList.add('incorrect');
                    results.push(`Question ${index + 1}: <span style="color: #f56565;">‚úó Incorrect</span>`);
                    
                    // Highlight correct answer
                    q.querySelectorAll('.quiz-option').forEach(opt => {
                        if (parseInt(opt.dataset.answer) === correctAnswer) {
                            opt.classList.add('correct');
                        }
                    });
                }
            });
            
            const feedback = document.getElementById('summary-feedback');
            const passed = correct >= 6;
            
            if (passed) {
                feedback.className = 'feedback success';
                feedback.textContent = `üéâ Excellent! You scored ${correct}/8 and passed the quiz!`;
                showAchievement('Compression Master', 'Passed the final quiz!', 100);
                addXP(100 + (correct * 10), 'final-quiz');
                playSound('levelup');
            } else {
                feedback.className = 'feedback error';
                feedback.textContent = `You scored ${correct}/8. You need 6/8 to pass. Review the content and try again!`;
                playSound('error');
            }
            feedback.style.display = 'block';
            
            // Show detailed results
            document.getElementById('quizScore').textContent = correct;
            document.getElementById('quizBreakdown').innerHTML = results.join('<br>');
            document.getElementById('quizResults').style.display = 'block';
            
            // Special achievements
            if (correct === 8) {
                document.getElementById('quizAchievement').style.display = 'block';
                document.getElementById('quizAchievementText').textContent = 'Perfect Score! You are a true Compression Expert!';
                showAchievement('Perfectionist', 'Scored 100% on the final quiz!', 150);
            } else if (passed && quizTimeLeft > 120) {
                document.getElementById('quizAchievement').style.display = 'block';
                document.getElementById('quizAchievementText').textContent = 'Speed Demon! Passed with over 2 minutes to spare!';
                showAchievement('Speed Demon', 'Completed quiz quickly and accurately!', 75);
            }
            
            sectionProgress[7] = passed;
            
            // Update final stats
            document.getElementById('finalXP').textContent = userXP;
            document.getElementById('finalLevel').textContent = userLevel;
        }

        // Start quiz timer when quiz section is active
        document.addEventListener('DOMContentLoaded', function() {
            const quizObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.target.classList.contains('active') && mutation.target.id === 'section7') {
                        startQuizTimer();
                    }
                });
            });
            
            document.getElementById('section7').addEventListener('classAdded', startQuizTimer);
        });

        function startQuizTimer() {
            if (quizTimerInterval) return; // Already started
            
            quizTimeLeft = 240;
            quizTimerInterval = setInterval(() => {
                quizTimeLeft--;
                const mins = Math.floor(quizTimeLeft / 60);
                const secs = quizTimeLeft % 60;
                const timerEl = document.getElementById('quizTimer');
                timerEl.textContent = `Time: ${mins}:${secs.toString().padStart(2, '0')}`;
                
                if (quizTimeLeft <= 30) {
                    document.getElementById('quizTimerDisplay').classList.add('warning');
                }
                
                if (quizTimeLeft <= 0) {
                    clearInterval(quizTimerInterval);
                    timerEl.textContent = 'Time\'s up!';
                    submitSummaryQuiz();
                }
            }, 1000);
        }

        // Hint System
        const hints = {
            'starter': [
                'Think about how many megabytes are in modern camera photos...',
                'Uncompressed photos from phones are usually 40-60 MB',
                'The answer is the largest option - modern cameras capture lots of detail!'
            ],
            'ratio': [
                'Compression ratio = Original Size √∑ Compressed Size',
                'For example: 100 MB √∑ 20 MB = 5:1',
                'You can write the answer as just the number (5) or as a ratio (5:1)'
            ],
            'rle': [
                'RLE counts how many times each character repeats consecutively',
                'For example: AAA becomes 3A (3 A\'s in a row)',
                'Count each group of identical characters: WWWW = 4W, BBBB = 4B'
            ]
        };

        let hintLevels = {};

        function showProgressiveHint(topic, level) {
            const container = document.getElementById(topic + '-hints');
            const contentDiv = document.getElementById(topic + '-hint-content');
            
            container.style.display = 'flex';
            
            if (!hintLevels[topic]) {
                hintLevels[topic] = 0;
            }
            
            showHintLevel(topic, hintLevels[topic]);
        }

        function showHintLevel(topic, level) {
            const contentDiv = document.getElementById(topic + '-hint-content');
            const hintTexts = hints[topic];
            
            if (level < hintTexts.length) {
                contentDiv.textContent = hintTexts[level];
                contentDiv.style.display = 'block';
                
                // Mark hint as used
                hintUsed[topic] = true;
                
                // Unlock next hint level
                if (level < hintTexts.length - 1) {
                    const nextLevel = document.querySelectorAll(`#${topic}-hints .hint-level`)[level + 1];
                    if (nextLevel) {
                        nextLevel.classList.add('unlocked');
                    }
                }
                
                hintLevels[topic] = Math.max(hintLevels[topic] || 0, level + 1);
            }
        }

        // Accessibility Functions
        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
            localStorage.setItem('highContrast', document.body.classList.contains('high-contrast'));
        }

        function changeFontSize(change) {
            const root = document.documentElement;
            const currentSize = parseInt(getComputedStyle(root).getPropertyValue('--font-size'));
            const newSize = Math.max(12, Math.min(24, currentSize + change));
            root.style.setProperty('--font-size', newSize + 'px');
            localStorage.setItem('fontSize', newSize);
            
            if (!achievements.has('accessibility-user')) {
                showAchievement('Accessibility Aware', 'Used accessibility features', 10);
            }
        }

        function toggleDyslexicFont() {
            document.body.classList.toggle('dyslexic-font');
            localStorage.setItem('dyslexicFont', document.body.classList.contains('dyslexic-font'));
        }

        function toggleReducedMotion() {
            document.body.classList.toggle('reduced-motion');
            if (document.body.classList.contains('reduced-motion')) {
                // Disable animations
                const style = document.createElement('style');
                style.id = 'reduced-motion-style';
                style.textContent = `
                    *, *::before, *::after {
                        animation-duration: 0.01ms !important;
                        animation-iteration-count: 1 !important;
                        transition-duration: 0.01ms !important;
                    }
                `;
                document.head.appendChild(style);
            } else {
                const style = document.getElementById('reduced-motion-style');
                if (style) style.remove();
            }
            localStorage.setItem('reducedMotion', document.body.classList.contains('reduced-motion'));
        }

        function toggleAccessControls() {
            const controls = document.getElementById('accessControls');
            controls.classList.toggle('collapsed');
        }

        // Load accessibility preferences
        function loadAccessibilityPreferences() {
            if (localStorage.getItem('highContrast') === 'true') {
                document.body.classList.add('high-contrast');
            }
            if (localStorage.getItem('fontSize')) {
                document.documentElement.style.setProperty('--font-size', localStorage.getItem('fontSize') + 'px');
            }
            if (localStorage.getItem('dyslexicFont') === 'true') {
                document.body.classList.add('dyslexic-font');
            }
            if (localStorage.getItem('reducedMotion') === 'true') {
                toggleReducedMotion();
            }
            if (localStorage.getItem('soundEnabled') === 'false') {
                soundEnabled = false;
                document.getElementById('soundIcon').textContent = 'üîá';
                document.getElementById('soundToggle').classList.add('muted');
            }
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').textContent = '‚òÄÔ∏è';
            }
        }

        // Feedback System
        function toggleFeedbackForm() {
            const form = document.getElementById('feedbackForm');
            form.style.display = form.style.display === 'block' ? 'none' : 'block';
        }

        function updateFeedbackContext() {
            // Store current section info for feedback
            window.feedbackContext = {
                section: currentSection,
                sectionTitle: document.querySelector(`#section${currentSection} h2`).textContent,
                timestamp: new Date().toISOString()
            };
        }

        function submitFeedback() {
            const text = document.getElementById('feedbackText').value.trim();
            if (!text) return;
            
            const context = window.feedbackContext || {};
            const feedbackData = {
                section: context.section,
                sectionTitle: context.sectionTitle,
                feedback: text,
                timestamp: new Date().toISOString(),
                url: window.location.href,
                userAgent: navigator.userAgent,
                xp: userXP,
                level: userLevel
            };
            
            // In a real implementation, this would send an email
            console.log('Feedback submitted:', feedbackData);
            
            // Create mailto link as fallback
            const subject = `Compression Worksheet Feedback - Section ${context.section}`;
            const body = `Section: ${context.sectionTitle}
Feedback: ${text}
Time: ${new Date().toLocaleString()}
XP: ${userXP}
Level: ${userLevel}`;
            
            const mailto = `mailto:millingtond@mgs.org?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Try to open email client
            window.location.href = mailto;
            
            // Clear form and close
            document.getElementById('feedbackText').value = '';
            toggleFeedbackForm();
            
            showAchievement('Feedback Hero', 'Helped improve the worksheet', 20);
            playSound('success');
        }

        // Prevent Paste
        function preventPaste() {
            const showPasteWarning = () => {
                const warning = document.getElementById('pasteWarning');
                warning.style.display = 'block';
                
                setTimeout(() => {
                    warning.style.display = 'none';
                }, 3000);
                
                if (!achievements.has('caught-pasting')) {
                    showAchievement('Nice Try!', 'Caught trying to paste - type it yourself!', 0);
                }
            };
            
            // Global paste prevention
            document.addEventListener('paste', function(e) {
                e.preventDefault();
                showPasteWarning();
                return false;
            });
            
            // Also prevent on individual inputs
            document.querySelectorAll('input[type="text"], textarea').forEach(input => {
                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    showPasteWarning();
                    return false;
                });
                
                // Prevent context menu
                input.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    return false;
                });
            });
            
            // Prevent drag and drop text
            document.addEventListener('drop', function(e) {
                if (e.dataTransfer.types.includes('text/plain')) {
                    e.preventDefault();
                    showPasteWarning();
                    return false;
                }
            });
        }

        // Mobile Gesture Support
        function setupMobileGestures() {
            let touchStartX = 0;
            let touchStartY = 0;
            let touchEndX = 0;
            let touchEndY = 0;
            
            document.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
                touchStartY = e.changedTouches[0].screenY;
            }, { passive: true });
            
            document.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                touchEndY = e.changedTouches[0].screenY;
                handleSwipe();
            }, { passive: true });
            
            function handleSwipe() {
                const swipeThreshold = 50;
                const diffX = touchStartX - touchEndX;
                const diffY = Math.abs(touchStartY - touchEndY);
                
                // Only horizontal swipes
                if (Math.abs(diffX) > swipeThreshold && diffY < 100) {
                    if (diffX > 0) {
                        // Swipe left - next section
                        navigateSection(1);
                    } else {
                        // Swipe right - previous section
                        navigateSection(-1);
                    }
                }
            }
            
            // Add haptic feedback for mobile
            if ('vibrate' in navigator) {
                document.querySelectorAll('.btn, .quiz-option').forEach(el => {
                    el.addEventListener('touchstart', () => {
                        navigator.vibrate(10);
                    });
                });
            }
        }

        // Keyboard Shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Navigation
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        navigateSection(-1);
                    } else if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        navigateSection(1);
                    } else if (e.key === 's') {
                        e.preventDefault();
                        toggleSound();
                    } else if (e.key === 'd') {
                        e.preventDefault();
                        toggleTheme();
                    }
                }
                
                // Konami code
                if (e.key === konamiCode[konamiIndex]) {
                    konamiIndex++;
                    updateKonamiProgress();
                    
                    if (konamiIndex === konamiCode.length) {
                        activateKonamiCode();
                        konamiIndex = 0;
                    }
                } else if (e.key === 'ArrowUp' || e.key === 'ArrowDown' || e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                    // Reset if wrong arrow key
                    if (e.key !== konamiCode[konamiIndex]) {
                        konamiIndex = 0;
                        updateKonamiProgress();
                    }
                } else {
                    konamiIndex = 0;
                    updateKonamiProgress();
                }
            });
        }

        function updateKonamiProgress() {
            const progress = document.getElementById('konamiProgress');
            if (konamiIndex > 0) {
                progress.style.display = 'flex';
                progress.querySelectorAll('.konami-key').forEach((key, i) => {
                    key.classList.toggle('active', i < konamiIndex);
                });
            } else {
                progress.style.display = 'none';
            }
        }

        function activateKonamiCode() {
            showAchievement('Secret Master', 'Found the Konami Code!', 100);
            triggerEasterEgg('üéÆ');
            
            // Special effects
            document.body.style.animation = 'glow 2s ease-in-out';
            setTimeout(() => {
                document.body.style.animation = '';
            }, 2000);
            
            // Unlock special mode
            addXP(200, 'konami-code');
            playSound('levelup');
        }

        function triggerEasterEgg(emoji) {
            const egg = document.getElementById('easterEgg');
            egg.textContent = emoji;
            egg.classList.add('active');
            
            setTimeout(() => {
                egg.classList.remove('active');
            }, 2000);
        }

        // Save and Load Progress
        function saveProgress() {
            const progress = {
                xp: userXP,
                level: userLevel,
                section: currentSection,
                achievements: Array.from(achievements),
                sectionProgress: sectionProgress,
                extensionsSaved: Array.from(extensionsSaved),
                hintLevels: hintLevels,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('compressionWorksheetProgress', JSON.stringify(progress));
        }

        function loadProgress() {
            loadAccessibilityPreferences();
            
            const savedProgress = localStorage.getItem('compressionWorksheetProgress');
            if (savedProgress) {
                try {
                    const progress = JSON.parse(savedProgress);
                    userXP = progress.xp || 0;
                    userLevel = progress.level || 0;
                    achievements = new Set(progress.achievements || []);
                    sectionProgress = progress.sectionProgress || new Array(totalSections).fill(false);
                    extensionsSaved = new Set(progress.extensionsSaved || []);
                    hintLevels = progress.hintLevels || {};
                    
                    updateXPDisplay();
                    updateExtensionProgress();
                    updateLeaderboard();
                    
                    // Update section indicators
                    sectionProgress.forEach((completed, i) => {
                        if (completed) {
                            document.querySelectorAll('.section-dot')[i].classList.add('completed');
                        }
                    });
                    
                    // Welcome back message
                    if (progress.timestamp) {
                        const lastSave = new Date(progress.timestamp);
                        const hoursSince = Math.floor((new Date() - lastSave) / (1000 * 60 * 60));
                        if (hoursSince > 24) {
                            showAchievement('Welcome Back!', `Continuing after ${Math.floor(hoursSince / 24)} days`, 10);
                        }
                    }
                } catch (e) {
                    console.error('Failed to load progress:', e);
                }
            }
        }

        // Auto-save
        setInterval(saveProgress, 30000); // Every 30 seconds
        
        // Save on page unload
        window.addEventListener('beforeunload', saveProgress);

        // Initialize components on load
        window.addEventListener('load', function() {
            // Ensure canvas is properly initialized
            initializeCanvas();
            
            // Set initial feedback context
            updateFeedbackContext();
            
            // Check for first-time user
            if (!localStorage.getItem('compressionWorksheetProgress')) {
                setTimeout(() => {
                    showAchievement('Welcome!', 'Started learning about compression', 10);
                }, 1000);
            }
        });

        // Performance optimization: Lazy load images
        const lazyImages = document.querySelectorAll('img[data-src]');
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.removeAttribute('data-src');
                    imageObserver.unobserve(img);
                }
            });
        });

        lazyImages.forEach(img => imageObserver.observe(img));

        // Add custom error handler
        window.addEventListener('error', function(e) {
            console.error('Error in worksheet:', e);
            // Could send error reports in production
        });

        // Service worker for offline support (in production)
        if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
            navigator.serviceWorker.register('/sw.js').catch(() => {
                // Service worker registration failed, app still works online
            });
        }
    </script>
</body>
</html>