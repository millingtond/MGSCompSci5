<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Declarative Programming Languages - Interactive Lesson</title>
    <style>
        /* CSS Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --bg-dark: #1e293b;
            --bg-light: #f8fafc;
            --text-dark: #1e293b;
            --text-light: #e2e8f0;
            --card-bg: rgba(255, 255, 255, 0.9);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Ensure all text has proper contrast */
        p, li, span, label {
            color: var(--text-dark);
        }

        /* Inline code styling */
        code:not(.code-block *) {
            background: #e2e8f0;
            color: #1e293b;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.875em;
            font-weight: 500;
        }

        /* Iframe Styles */
        iframe {
            width: 100%;
            height: 80vh;
            border: none;
            display: block;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        /* Navigation Styles */
        .nav-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 1rem;
            justify-content: center;
        }

        .nav-tab {
            padding: 0.5rem 1rem;
            background: var(--bg-light);
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-tab:hover::before {
            left: 100%;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        /* Section Styles */
        .section {
            display: none;
            padding: 2rem;
            min-height: calc(100vh - 200px);
            animation: fadeIn 0.5s ease-in-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card Styles */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        /* Button Styles */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::after {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.3);
        }

        /* XP Bar Styles */
        .xp-container {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            min-width: 200px;
        }

        .xp-bar {
            width: 100%;
            height: 20px;
            background: var(--bg-light);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-top: 0.5rem;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .xp-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: xp-shine 2s infinite;
        }

        @keyframes xp-shine {
            to { left: 100%; }
        }

        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            text-align: center;
            animation: achievementPop 0.5s ease forwards;
        }

        @keyframes achievementPop {
            to { transform: translate(-50%, -50%) scale(1); }
        }

        /* Interactive Elements */
        .drag-container {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .draggable, .dropzone {
            padding: 1rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .draggable {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.2);
        }

        .draggable:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3);
        }

        .draggable.selected {
            opacity: 0.6;
            transform: scale(0.95);
        }

        .dropzone {
            background: #f8fafc;
            border: 2px dashed #6366f1;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            color: var(--text-dark);
            font-weight: 500;
            padding: 0.5rem;
        }

        .dropzone.highlight {
            background: #e0e7ff;
            border-color: var(--secondary);
            border-style: solid;
        }

        .dropzone.correct {
            background: #d1fae5;
            border-color: var(--success);
            border-style: solid;
            color: #064e3b;
        }

        /* Code Display */
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 0.5rem;
            font-family: 'Consolas', 'Monaco', monospace;
            overflow-x: auto;
            margin: 1rem 0;
            position: relative;
            white-space: pre-line;
            line-height: 1.6;
            border: 1px solid #334155; /* Add border for better definition */
        }

        .code-block::before {
            content: 'Prolog';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 0.75rem;
            color: #94a3b8; /* Better contrast for label */
        }

        /* Light background code blocks */
        .code-block[style*="background: #f1f5f9"],
        .code-block[style*="background: #f8fafc"] {
            background: #f1f5f9 !important;
            color: #1e293b !important;
            border: 1px solid #cbd5e1;
        }

        /* Success background code blocks */
        .code-block[style*="background: #d1fae5"] {
            background: #d1fae5 !important;
            color: #064e3b !important;
            border: 1px solid #86efac;
        }

        /* Canvas Styles */
        .canvas-container {
            position: relative;
            border: 2px solid var(--primary);
            border-radius: 0.5rem;
            margin: 1rem 0;
            background: white;
        }

        #drawingCanvas {
            display: block;
            cursor: crosshair;
            touch-action: none;
        }

        /* Input Styles */
        input[type="text"], textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #94a3b8; /* Darker border for better visibility */
            border-radius: 0.5rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: white;
            color: var(--text-dark);
        }

        input[type="text"]::placeholder, textarea::placeholder {
            color: #64748b; /* Much darker placeholder text for better contrast */
            opacity: 1; /* Firefox fix */
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Quiz Styles */
        .quiz-option {
            display: block;
            width: 100%;
            padding: 1rem;
            margin: 0.5rem 0;
            background: #f1f5f9; /* Slightly darker background */
            border: 2px solid #cbd5e1; /* More visible border */
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            color: var(--text-dark);
            font-weight: 500;
        }

        .quiz-option:hover:not(:disabled) {
            background: white;
            border-color: var(--primary);
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .quiz-option:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .quiz-option.correct {
            background: #d1fae5;
            border-color: var(--success);
            color: #064e3b;
        }

        .quiz-option.incorrect {
            background: #fee2e2;
            border-color: var(--error);
            color: #7f1d1d;
        }

        /* Simulation Styles */
        .simulation-container {
            background: #f8fafc;
            border-radius: 0.5rem;
            padding: 2rem;
            margin: 1rem 0;
            position: relative;
        }

        .fact-rule-item {
            background: white;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 0.5rem;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .fact-rule-item.active {
            background: rgba(99, 102, 241, 0.1);
            transform: translateX(10px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.2);
        }

        /* Feedback Button */
        .feedback-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 50%;
            border: none;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
            transition: all 0.3s ease;
            z-index: 999;
        }

        .feedback-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.4);
        }

        /* Feedback Modal */
        .feedback-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .feedback-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th {
            background: #e2e8f0;
            color: var(--text-dark);
            border: 1px solid #94a3b8;
            padding: 0.75rem;
            font-weight: 600;
        }

        td {
            border: 1px solid #94a3b8;
            padding: 0.75rem;
            background: white;
            color: var(--text-dark);
        }

        /* Select Styles */
        select {
            padding: 0.5rem;
            border: 2px solid #94a3b8;
            border-radius: 0.25rem;
            background: white;
            color: var(--text-dark);
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .xp-container {
                position: static;
                margin: 1rem;
            }
            
            .nav-tabs {
                font-size: 0.875rem;
            }
            
            .card {
                padding: 1rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Particle Effect */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            pointer-events: none;
        }

        /* Hint System */
        .hint-container {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--warning);
            border-radius: 0.5rem;
            display: none;
            color: #92400e; /* Dark amber for better contrast */
        }

        .hint-container.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Mark Scheme */
        .mark-scheme {
            display: none;
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid var(--success);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            color: #064e3b; /* Dark green for better contrast */
        }

        .mark-scheme.show {
            display: block;
        }

        .mark-scheme h4 {
            color: #064e3b;
            margin-bottom: 0.5rem;
        }

        /* Extension Activity */
        .extension-card {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%);
            border: 2px solid var(--secondary);
            color: var(--text-dark);
        }

        /* Common Mistakes */
        .mistake-item {
            background: rgba(239, 68, 68, 0.05);
            border-left: 4px solid var(--error);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 0.5rem;
            color: #7f1d1d; /* Dark red for better contrast */
        }

        .mistake-item strong {
            color: #991b1b; /* Slightly darker red for emphasis */
        }

        /* Real World Context */
        .real-world-example {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(5, 150, 105, 0.05) 100%);
            border-left: 4px solid var(--success);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.5rem;
            color: #064e3b; /* Dark green for better contrast */
        }

        .real-world-example h3 {
            color: #064e3b;
            margin-bottom: 0.5rem;
        }

        /* Disable text selection during drag */
        .no-select {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        /* Fill in the blank options */
        .fill-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .fill-option {
            padding: 0.5rem 1rem;
            background: #f1f5f9;
            border: 2px solid #6366f1;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-dark);
            font-weight: 500;
        }

        .fill-option:hover {
            background: #e0e7ff;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.2);
        }

        .fill-option.used {
            opacity: 0.5;
            cursor: not-allowed;
            background: #e2e8f0;
            border-color: #94a3b8;
        }

        /* Simulation Controls */
        .sim-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
        }

        .sim-control {
            padding: 0.5rem 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sim-control:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .sim-control:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Step indicator */
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--bg-light);
            transition: all 0.3s ease;
        }

        .step-dot.active {
            background: var(--primary);
            transform: scale(1.5);
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th {
            background: #e2e8f0;
            color: var(--text-dark);
            border: 1px solid #94a3b8;
            padding: 0.75rem;
            font-weight: 600;
            text-align: left;
        }

        td {
            border: 1px solid #94a3b8;
            padding: 0.75rem;
            background: white;
            color: var(--text-dark);
        }

        /* Select Styles */
        select {
            padding: 0.5rem;
            border: 2px solid #94a3b8;
            border-radius: 0.25rem;
            background: white;
            color: var(--text-dark);
            cursor: pointer;
            font-family: inherit;
            font-size: inherit;
        }

        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Disabled elements */
        button:disabled, 
        input:disabled, 
        select:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Feedback Messages */
        #starterFeedback, #factsFeeback, #queryFeedback, #complexFeedback, #extensionFeedback, 
        #fillFeedback, [id$="Feedback"] {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-weight: 500;
        }

        /* Success messages */
        p[style*="color: var(--success)"] {
            color: #059669 !important; /* Darker green for better contrast */
        }

        /* Error messages */
        p[style*="color: var(--error)"] {
            color: #dc2626 !important; /* Darker red for better contrast */
        }

        /* Warning messages */
        p[style*="color: var(--warning)"] {
            color: #d97706 !important; /* Darker amber for better contrast */
        }
    </style>
</head>
<body>
    <!-- Particle Background -->
    <div class="particles" id="particles"></div>

    <!-- Header -->
    <header class="header">
        <h1>Declarative Programming Languages</h1>
        <p>Learn how to write facts, rules, and queries in declarative programming</p>
    </header>

    <!-- XP Container -->
    <div class="xp-container">
        <div>Level <span id="level">1</span></div>
        <div>XP: <span id="xp">0</span>/<span id="xpRequired">100</span></div>
        <div class="xp-bar">
            <div class="xp-fill" id="xpFill"></div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-tabs">
            <button class="nav-tab active" data-section="starter">Starter</button>
            <button class="nav-tab" data-section="intro">Introduction</button>
            <button class="nav-tab" data-section="facts">Facts</button>
            <button class="nav-tab" data-section="rules">Rules</button>
            <button class="nav-tab" data-section="queries">Queries</button>
            <button class="nav-tab" data-section="complex">Complex Rules</button>
            <button class="nav-tab" data-section="practice">Practice</button>
            <button class="nav-tab" data-section="extension">Extension</button>
            <button class="nav-tab" data-section="summary">Summary</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="content">
        <!-- Starter Section -->
        <section class="section active" id="starter">
            <div class="card">
                <h2>Starter Activity: Programming Paradigms</h2>
                <p>Match each programming paradigm with its description by clicking on matching pairs:</p>
                
                <div class="drag-container">
                    <div class="matching-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <div class="draggable" data-match="imperative" onclick="selectMatch(this)">Imperative</div>
                            <div class="draggable" data-match="declarative" onclick="selectMatch(this)">Declarative</div>
                            <div class="draggable" data-match="functional" onclick="selectMatch(this)">Functional</div>
                            <div class="draggable" data-match="oop" onclick="selectMatch(this)">Object-Oriented</div>
                        </div>
                        <div>
                            <div class="dropzone" data-match="functional" onclick="selectMatch(this)">Treats computation as evaluation of mathematical functions</div>
                            <div class="dropzone" data-match="imperative" onclick="selectMatch(this)">Describes computation in terms of statements that change program state</div>
                            <div class="dropzone" data-match="oop" onclick="selectMatch(this)">Organises code into objects containing data and methods</div>
                            <div class="dropzone" data-match="declarative" onclick="selectMatch(this)">Describes what the program should accomplish without specifying how</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn" onclick="checkStarterMatches()">Check Answers</button>
                <button class="btn" onclick="resetStarter()" style="margin-left: 1rem;">Reset</button>
                <div id="starterFeedback" style="margin-top: 1rem;"></div>
            </div>

            <div class="nav-buttons">
                <button class="btn" disabled>Previous</button>
                <button class="btn" onclick="nextSection()">Next</button>
            </div>
        </section>

        <!-- Introduction Section -->
        <section class="section" id="intro">
            <div class="card">
                <h2>What is Declarative Programming?</h2>
                <p>Declarative programming is a programming paradigm that expresses the logic of computation without describing its control flow. Instead of telling the computer <strong>how</strong> to do something step by step, you tell it <strong>what</strong> you want to achieve.</p>
                
                <div class="real-world-example">
                    <h3>Real-World Example: Expert Systems</h3>
                    <p>Declarative languages like Prolog are used in:</p>
                    <ul style="margin-left: 2rem;">
                        <li><strong>Medical Diagnosis:</strong> Systems that match symptoms to diseases</li>
                        <li><strong>Legal Systems:</strong> Checking if legal requirements are met</li>
                        <li><strong>Natural Language Processing:</strong> Understanding grammar rules</li>
                        <li><strong>Game AI:</strong> Chess engines use declarative rules for valid moves</li>
                    </ul>
                </div>

                <h3>Key Concepts:</h3>
                <ul style="margin-left: 2rem;">
                    <li><strong>Facts</strong>: Statements that are true (e.g., "A lion is a wild cat")</li>
                    <li><strong>Rules</strong>: Logical relationships between facts</li>
                    <li><strong>Queries/Goals</strong>: Questions we ask the system to solve</li>
                </ul>

                <div class="code-block">
% Example of declarative programming
type(lion, wild).
type(persian, domestic).

hair(lion, short).
hair(persian, long).</div>

                <h3>Quick Check:</h3>
                <p>In declarative programming, we focus on:</p>
                <div class="quiz-container">
                    <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'intro1')">Writing step-by-step instructions</button>
                    <button class="quiz-option" onclick="checkQuizAnswer(this, true, 'intro1')">Describing what we want to achieve</button>
                    <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'intro1')">Managing memory allocation</button>
                    <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'intro1')">Controlling program flow explicitly</button>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next</button>
            </div>
        </section>

        <!-- Facts Section -->
        <section class="section" id="facts">
            <div class="card">
                <h2>Understanding Facts</h2>
                <p>Facts are the basic building blocks of declarative programming. They represent things that are true in our knowledge base.</p>

                <div class="code-block">
% Facts about cats
type(leopard, wild).
type(lion, wild).
type(cheetah, wild).
type(persian, domestic).

% Facts about hair length
hair(leopard, medium).
hair(lion, short).
hair(persian, long).</div>

                <h3>Syntax Rules for Facts:</h3>
                <ul style="margin-left: 2rem;">
                    <li>Start with lowercase letters</li>
                    <li>Use parentheses to enclose arguments</li>
                    <li>Separate arguments with commas</li>
                    <li>End with a full stop (.)</li>
                </ul>

                <h3>Writing Facts Exercise</h3>
                <p>Complete the facts below by selecting the correct options:</p>
                
                <div style="margin: 1rem 0;">
                    <p>A caracal is a wild cat with short hair. Write the facts:</p>
                    
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin: 0.5rem 0;">
                        <span>type(</span>
                        <select id="fact1_arg1" style="padding: 0.5rem;">
                            <option value="">Select...</option>
                            <option value="lion">lion</option>
                            <option value="caracal">caracal</option>
                            <option value="persian">persian</option>
                            <option value="wild">wild</option>
                        </select>
                        <span>,</span>
                        <select id="fact1_arg2" style="padding: 0.5rem;">
                            <option value="">Select...</option>
                            <option value="domestic">domestic</option>
                            <option value="wild">wild</option>
                            <option value="caracal">caracal</option>
                            <option value="short">short</option>
                        </select>
                        <span>).</span>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin: 0.5rem 0;">
                        <span>hair(</span>
                        <select id="fact2_arg1" style="padding: 0.5rem;">
                            <option value="">Select...</option>
                            <option value="wild">wild</option>
                            <option value="persian">persian</option>
                            <option value="caracal">caracal</option>
                            <option value="short">short</option>
                        </select>
                        <span>,</span>
                        <select id="fact2_arg2" style="padding: 0.5rem;">
                            <option value="">Select...</option>
                            <option value="long">long</option>
                            <option value="medium">medium</option>
                            <option value="short">short</option>
                            <option value="caracal">caracal</option>
                        </select>
                        <span>).</span>
                    </div>
                </div>
                
                <button class="btn" onclick="checkFactsExercise()">Check Facts</button>
                <div id="factsFeeback" style="margin-top: 1rem;"></div>

                <h3>Fill in the Blanks Exercise</h3>
                <p>Complete these facts by selecting the correct options:</p>
                
                <div class="fill-exercise" style="margin: 1rem 0;">
                    <p>A cheetah is a wild animal with spots:</p>
                    <div class="fill-options">
                        <span class="fill-option" onclick="fillBlank(this, 'blank1')">type</span>
                        <span class="fill-option" onclick="fillBlank(this, 'blank1')">animal</span>
                        <span class="fill-option" onclick="fillBlank(this, 'blank1')">spots</span>
                        <span class="fill-option" onclick="fillBlank(this, 'blank1')">hair</span>
                    </div>
                    <p><input type="text" id="blank1" readonly style="width: 100px;">(cheetah, wild).</p>
                    
                    <div class="fill-options" style="margin-top: 1rem;">
                        <span class="fill-option" onclick="fillBlank(this, 'blank2')">type</span>
                        <span class="fill-option" onclick="fillBlank(this, 'blank2')">spots</span>
                        <span class="fill-option" onclick="fillBlank(this, 'blank2')">wild</span>
                        <span class="fill-option" onclick="fillBlank(this, 'blank2')">hair</span>
                    </div>
                    <p><input type="text" id="blank2" readonly style="width: 100px;">(cheetah, yes).</p>
                </div>
                
                <button class="btn" onclick="checkFillBlanks()">Check Answers</button>
                <div id="fillFeedback" style="margin-top: 1rem;"></div>

                <h3>Facts Speed Challenge</h3>
                <p>Match facts to their correct meanings as quickly as possible! Click Start to begin.</p>
                
                <div id="speedGame" style="display: none;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <div>Time: <span id="gameTimer">30</span>s</div>
                        <div>Score: <span id="gameScore">0</span>/5</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <h4>Fact:</h4>
                            <div id="currentFact" style="background: #e0e7ff; padding: 1rem; border-radius: 0.5rem; font-family: monospace;"></div>
                        </div>
                        <div>
                            <h4>Choose Meaning:</h4>
                            <div id="meaningOptions"></div>
                        </div>
                    </div>
                </div>
                
                <button class="btn" onclick="startSpeedGame()" id="startGameBtn">Start Challenge</button>
                <button class="btn" onclick="resetSpeedGame()" style="display: none;" id="resetGameBtn">Play Again</button>
                <div id="gameFeedback" style="margin-top: 1rem;"></div>

                <button class="btn" onclick="showHint('facts')" style="margin-top: 1rem;">Show Hint</button>
                <div class="hint-container" id="factsHint">
                    <p>Remember: Facts follow the pattern <code>predicate(argument1, argument2)</code>. The first argument is usually the subject, and the second describes a property.</p>
                </div>
            </div>

            <div class="common-mistakes card">
                <h3>Common Mistakes to Avoid</h3>
                <div class="mistake-item">
                    <strong>Forgetting the full stop:</strong> Every fact must end with a period (.)
                </div>
                <div class="mistake-item">
                    <strong>Using capital letters:</strong> Facts should start with lowercase letters
                </div>
                <div class="mistake-item">
                    <strong>Wrong argument order:</strong> Keep consistent ordering (e.g., always animal name first)
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next</button>
            </div>
        </section>

        <!-- Rules Section -->
        <section class="section" id="rules">
            <div class="card">
                <h2>Understanding Rules and Variables</h2>
                <p>Rules allow us to define relationships and make logical deductions. Variables (starting with capital letters) represent values that can change.</p>

                <div class="code-block">
% Rule: All wild cats have spots
spots(Animal, yes) :- 
    type(Animal, wild).

% Rule: Domestic cats are pets
pet(Animal) :- 
    type(Animal, domestic).</div>

                <h3>How Rules Work</h3>
                <p>Rules have two parts:</p>
                <ul style="margin-left: 2rem;">
                    <li><strong>Head</strong>: What we're defining (left of :-)</li>
                    <li><strong>Body</strong>: The conditions that must be true (right of :-)</li>
                </ul>

                <h3>Interactive Rule Tracing</h3>
                <div class="simulation-container">
                    <p>Let's trace through a query step by step:</p>
                    <div class="code-block">
% Facts
type(persian, domestic).
type(lion, wild).

% Rule
pet(X) :- type(X, domestic).

% Query: pet(persian)</div>
                    
                    <div class="step-indicator">
                        <span class="step-dot active"></span>
                        <span class="step-dot"></span>
                        <span class="step-dot"></span>
                        <span class="step-dot"></span>
                    </div>
                    
                    <div id="ruleSimulation">
                        <div class="fact-rule-item" id="step1">
                            Step 1: Query <code>pet(persian)</code> - Check if persian is a pet
                        </div>
                    </div>
                    
                    <div class="sim-controls">
                        <button class="sim-control" onclick="prevRuleStep()" id="rulePrev" disabled>Previous</button>
                        <button class="sim-control" onclick="nextRuleStep()" id="ruleNext">Next</button>
                        <button class="sim-control" onclick="resetRuleSimulation()">Reset</button>
                    </div>
                </div>

                <h3>Variable Matching Exercise</h3>
                <p>Given the rule: <code>hair(Cat, medium) :- type(Cat, wild), hair(Cat, short).</code></p>
                <p>This rule would match which of the following?</p>
                
                <div class="quiz-container">
                    <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'rule1')">persian (domestic with long hair)</button>
                    <button class="quiz-option" onclick="checkQuizAnswer(this, true, 'rule1')">lion (wild with short hair)</button>
                    <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'rule1')">cheetah (wild with medium hair)</button>
                    <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'rule1')">None of the above</button>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next</button>
            </div>
        </section>

        <!-- Queries Section -->
        <section class="section" id="queries">
            <div class="card">
                <h2>Queries and Goal Satisfaction</h2>
                <p>Queries (also called goals) are questions we ask the system. The system tries to find values for variables that make the query true.</p>

                <div class="code-block">
% Facts
type(leopard, wild).
type(persian, domestic).
hair(leopard, medium).
hair(persian, long).

% Query with variable
?- hair(Cat, medium).
% Result: Cat = leopard</div>

                <h3>Interactive Query Solver</h3>
                <div class="simulation-container">
                    <h4>Knowledge Base:</h4>
                    <div class="code-block" style="font-size: 0.9rem;">
teaches(alan, mathematics).
teaches(ioana, geography).
teaches(nina, history).

studies(ahmed, history).
studies(kim, history).
studies(hua, mathematics).</div>
                    
                    <h4>Try a Query:</h4>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <span>?-</span>
                        <select id="queryPredicate" style="padding: 0.5rem;" onchange="updateQueryOptions()">
                            <option value="teaches">teaches</option>
                            <option value="studies">studies</option>
                        </select>
                        <span>(</span>
                        <select id="queryArg1" style="padding: 0.5rem;">
                            <option value="Student">Student</option>
                            <option value="alan">alan</option>
                            <option value="ioana">ioana</option>
                            <option value="nina">nina</option>
                        </select>
                        <span>,</span>
                        <select id="queryArg2" style="padding: 0.5rem;">
                            <option value="Subject">Subject</option>
                            <option value="mathematics">mathematics</option>
                            <option value="geography">geography</option>
                            <option value="history">history</option>
                        </select>
                        <span>).</span>
                    </div>
                    
                    <button class="btn" onclick="runQuery()" style="margin-top: 1rem;">Run Query</button>
                    <div id="queryResult" style="margin-top: 1rem;"></div>
                </div>

                <h3>Practice: Write the Result</h3>
                <p>Given the query <code>studies(Student, history)</code>, what would be returned?</p>
                <input type="text" id="queryAnswer" placeholder="Student = ... (list all students)">
                <button class="btn" onclick="checkQueryAnswer()" style="margin-top: 0.5rem;">Check Answer</button>
                <div id="queryFeedback" style="margin-top: 1rem;"></div>

                <h3>Categorization Exercise</h3>
                <p>Categorize these predicates by what they represent:</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0;">
                    <div>
                        <h4>Predicates to categorize:</h4>
                        <div class="draggable" onclick="categorize(this, 'teaches')">teaches(X, Y)</div>
                        <div class="draggable" onclick="categorize(this, 'type')">type(X, Y)</div>
                        <div class="draggable" onclick="categorize(this, 'studies')">studies(X, Y)</div>
                        <div class="draggable" onclick="categorize(this, 'hair')">hair(X, Y)</div>
                    </div>
                    <div>
                        <h4>Categories:</h4>
                        <div class="dropzone" data-category="actions">
                            <strong>Actions/Relationships</strong>
                            <div id="actions-items"></div>
                        </div>
                        <div class="dropzone" data-category="properties">
                            <strong>Properties/Attributes</strong>
                            <div id="properties-items"></div>
                        </div>
                    </div>
                </div>
                <button class="btn" onclick="checkCategorization()">Check Categories</button>
                <button class="btn" onclick="resetCategorization()" style="margin-left: 0.5rem;">Reset</button>
                <div id="categorizeFeedback" style="margin-top: 1rem;"></div>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next</button>
            </div>
        </section>

        <!-- Complex Rules Section -->
        <section class="section" id="complex">
            <div class="card">
                <h2>Writing Complex Rules</h2>
                <p>Complex rules use logical operators to combine multiple conditions:</p>
                
                <ul style="margin-left: 2rem;">
                    <li><strong>AND</strong>: Comma (,) - all conditions must be true</li>
                    <li><strong>NOT</strong>: \+ or not - condition must be false</li>
                    <li><strong>IF</strong>: :- - defines the rule</li>
                </ul>

                <div class="code-block">
% Complex rule example
may_choose_subject(N, S) :-
    student(N),
    subject(S),
    NOT choice1(N, S).</div>

                <h3>Build a Complex Rule</h3>
                <p>Students must choose two different subjects. N may choose S if N is a student and S is a subject and N has not chosen S as the first choice.</p>
                
                <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem;">
                    <p>Complete the rule:</p>
                    <div style="font-family: monospace;">
                        may_choose_subject(N, S) :-<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<select id="complex1" style="padding: 0.5rem;">
                            <option value="">Select...</option>
                            <option value="student">student</option>
                            <option value="subject">subject</option>
                            <option value="choice1">choice1</option>
                        </select>(N),<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<select id="complex2" style="padding: 0.5rem;">
                            <option value="">Select...</option>
                            <option value="student">student</option>
                            <option value="subject">subject</option>
                            <option value="choice1">choice1</option>
                        </select>(S),<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<select id="complex3" style="padding: 0.5rem;">
                            <option value="">Select...</option>
                            <option value="AND">AND</option>
                            <option value="NOT">NOT</option>
                            <option value="OR">OR</option>
                        </select> choice1(N, S).
                    </div>
                </div>
                
                <button class="btn" onclick="checkComplexRule()" style="margin-top: 1rem;">Check Rule</button>
                <div id="complexFeedback" style="margin-top: 1rem;"></div>

                <div class="real-world-example">
                    <h3>Real-World Application</h3>
                    <p>Complex rules like these are used in university course registration systems to enforce prerequisites and prevent scheduling conflicts.</p>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next</button>
            </div>
        </section>

        <!-- Practice Section -->
        <section class="section" id="practice">
            <div class="card">
                <h2>Practice Exam Questions</h2>
                <p>Try these exam-style questions. Enter your predicted marks before viewing the mark scheme.</p>

                <h3>Question 1: Vehicle Database [8 marks]</h3>
                <div class="code-block">
01  type(tesla, electric).
02  type(civic, petrol).
03  type(prius, hybrid).
04  type(mustang, petrol).
05  type(leaf, electric).
06
07  manufacturer(tesla, tesla).
08  manufacturer(civic, honda).
09  manufacturer(prius, toyota).
10  manufacturer(mustang, ford).
11  manufacturer(leaf, nissan).
12
13  seats(tesla, 5).
14  seats(civic, 5).
15  seats(mustang, 4).
16  seats(leaf, 5).</div>

                <p>These clauses have the following meaning:</p>
                <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
                    <tr style="background: #f8fafc;">
                        <th style="border: 1px solid #ddd; padding: 0.5rem;">Clause</th>
                        <th style="border: 1px solid #ddd; padding: 0.5rem;">Meaning</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">01</td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">A Tesla is a type of electric car.</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">07</td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">Tesla is manufactured by Tesla.</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">13</td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">A Tesla has 5 seats.</td>
                    </tr>
                </table>

                <p>(a) More facts are to be included. A Bolt is an electric car made by Chevrolet with 5 seats.</p>
                <p>Write the additional clauses to record these facts. [3 marks]</p>
                <textarea id="practice1a" rows="4" placeholder="Write your clauses here..."></textarea>

                <p>(b) Using the variable Car, the goal:</p>
                <div class="code-block" style="background: #f1f5f9;">
manufacturer(Car, honda)</div>
                <p>returns</p>
                <div class="code-block" style="background: #f1f5f9;">
Car = civic</div>
                
                <p>Write the result returned by the goal:</p>
                <div class="code-block" style="background: #f1f5f9;">
type(Car, electric)</div>
                <p>Car = <input type="text" id="practice1b" style="width: 200px;"> [2 marks]</p>

                <p>(c) Write the goal, using the variable Vehicle, to find all petrol cars that have 5 seats. [3 marks]</p>
                <textarea id="practice1c" rows="2" placeholder="Write your goal here..."></textarea>

                <div style="margin-top: 1rem;">
                    <label>Predicted marks: </label>
                    <input type="number" id="predicted1" min="0" max="8" style="width: 60px;">
                    <button class="btn" onclick="showMarkScheme(1)" style="margin-left: 1rem;">Show Mark Scheme</button>
                </div>

                <div class="mark-scheme" id="markScheme1">
                    <h4>Mark Scheme:</h4>
                    <p>(a) 1 mark per correct clause (3 marks total):</p>
                    <div class="code-block" style="background: #d1fae5;">
type(bolt, electric).
manufacturer(bolt, chevrolet).
seats(bolt, 5).</div>
                    
                    <p>(b) 2 marks for correct answer:</p>
                    <code>tesla, leaf</code> (1 mark for each correct car, accept in any order)
                    
                    <p>(c) 3 marks total:</p>
                    <div class="code-block" style="background: #d1fae5;">
?- type(Vehicle, petrol), seats(Vehicle, 5).</div>
                    <p>OR</p>
                    <div class="code-block" style="background: #d1fae5;">
?- seats(Vehicle, 5), type(Vehicle, petrol).</div>
                    <p>Award marks: 1 for correct use of Vehicle, 1 for both conditions, 1 for correct syntax</p>
                </div>
            </div>

            <div class="card">
                <h3>Question 2: Sports Database [10 marks]</h3>
                <div class="code-block">
01  sport(football).
02  sport(tennis).
03  sport(basketball).
04  sport(swimming).
05  sport(golf).
06
07  player(ronaldo).
08  player(serena).
09  player(lebron).
10  player(phelps).
11  player(tiger).
12  player(emma).
13
14  plays(ronaldo, football).
15  plays(serena, tennis).
16  plays(lebron, basketball).
17  plays(phelps, swimming).
18  plays(tiger, golf).
19  plays(emma, tennis).
20  plays(emma, swimming).
21
22  champion(ronaldo, yes).
23  champion(serena, yes).
24  champion(lebron, yes).
25  champion(phelps, yes).
26  champion(tiger, yes).
27  champion(emma, no).</div>

                <p>These clauses have the following meaning:</p>
                <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
                    <tr style="background: #f8fafc;">
                        <th style="border: 1px solid #ddd; padding: 0.5rem;">Clause</th>
                        <th style="border: 1px solid #ddd; padding: 0.5rem;">Meaning</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">01</td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">Football is a sport.</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">14</td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">Ronaldo plays football.</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">22</td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">Ronaldo is a champion.</td>
                    </tr>
                </table>

                <p>(a) Alex is a player who plays basketball and golf, and is not a champion.</p>
                <p>Write additional clauses to represent this information. [4 marks]</p>
                <textarea id="practice2a" rows="5" placeholder="Write your clauses here..."></textarea>

                <p>(b) Using the variable P, the goal:</p>
                <div class="code-block" style="background: #f1f5f9;">
plays(P, tennis)</div>
                <p>returns</p>
                <div class="code-block" style="background: #f1f5f9;">
P = serena, emma</div>
                
                <p>Write the result returned by the goal:</p>
                <div class="code-block" style="background: #f1f5f9;">
plays(P, swimming), champion(P, yes)</div>
                <p>P = <input type="text" id="practice2b" style="width: 200px;" placeholder="Enter player name..."> [1 mark]</p>

                <p>(c) A player is versatile if they play more than one sport.</p>
                <p>Write this as a rule:</p>
                <div style="font-family: monospace; background: #f8fafc; padding: 1rem; border-radius: 0.5rem;">
                    versatile(P) :-<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;IF <input type="text" id="practice2c1" style="width: 300px;"><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="practice2c2" style="width: 300px;"><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="practice2c3" style="width: 300px;">
                </div>
                <p>[5 marks]</p>

                <div style="margin-top: 1rem;">
                    <label>Predicted marks: </label>
                    <input type="number" id="predicted2" min="0" max="10" style="width: 60px;">
                    <button class="btn" onclick="showMarkScheme(2)" style="margin-left: 1rem;">Show Mark Scheme</button>
                </div>

                <div class="mark-scheme" id="markScheme2">
                    <h4>Mark Scheme:</h4>
                    <p>(a) 1 mark per correct clause (4 marks total):</p>
                    <div class="code-block" style="background: #d1fae5;">
player(alex).
plays(alex, basketball).
plays(alex, golf).
champion(alex, no).</div>
                    
                    <p>(b) 1 mark for correct answer:</p>
                    <code>phelps</code>
                    
                    <p>(c) 5 marks total - Award marks for:</p>
                    <ul style="margin-left: 2rem;">
                        <li>1 mark: Use of player(P) to check P is a player</li>
                        <li>2 marks: Two different plays clauses with different sports</li>
                        <li>1 mark: Use of S1 \= S2 or NOT S1 = S2 to ensure different sports</li>
                        <li>1 mark: Correct syntax throughout</li>
                    </ul>
                    <p>Example answer:</p>
                    <div class="code-block" style="background: #d1fae5;">
versatile(P) :-
    player(P),
    plays(P, S1),
    plays(P, S2),
    S1 \= S2.</div>
                </div>
            </div>

            <div class="card">
                <h3>Question 3: Restaurant Booking System [12 marks]</h3>
                <div class="code-block">
01  restaurant(bella).
02  restaurant(tokyo).
03  restaurant(maharaja).
04  
05  cuisine(bella, italian).
06  cuisine(tokyo, japanese).  
07  cuisine(maharaja, indian).
08
09  table(bella, 2).
10  table(bella, 4).
11  table(tokyo, 2).
12  table(tokyo, 6).
13  table(maharaja, 4).
14  table(maharaja, 8).
15
16  booked(bella, 2).
17  booked(tokyo, 6).</div>

                <p>These clauses represent a restaurant booking system where restaurants have tables of different sizes, and some tables are already booked.</p>

                <p>(a) Write a rule <code>available(Restaurant, Size)</code> that is true if Restaurant has a table of Size that is NOT booked. [4 marks]</p>
                <textarea id="practice3a" rows="3" placeholder="Write your rule here..."></textarea>

                <p>(b) Write the goal to find all restaurants that have an available table for 4 people. [2 marks]</p>
                <textarea id="practice3b" rows="2" placeholder="Write your goal here..."></textarea>

                <p>(c) A restaurant is "busy" if it has at least one booked table. Write this rule. [3 marks]</p>
                <textarea id="practice3c" rows="2" placeholder="Write your rule here..."></textarea>

                <p>(d) Write a rule <code>can_accommodate(Restaurant, People)</code> that is true if the restaurant has an available table that can seat at least People number of guests. [3 marks]</p>
                <textarea id="practice3d" rows="3" placeholder="Write your rule here..."></textarea>

                <div style="margin-top: 1rem;">
                    <label>Predicted marks: </label>
                    <input type="number" id="predicted3" min="0" max="12" style="width: 60px;">
                    <button class="btn" onclick="showMarkScheme(3)" style="margin-left: 1rem;">Show Mark Scheme</button>
                </div>

                <div class="mark-scheme" id="markScheme3">
                    <h4>Mark Scheme:</h4>
                    <p>(a) 4 marks total:</p>
                    <div class="code-block" style="background: #d1fae5;">
available(Restaurant, Size) :-
    restaurant(Restaurant),
    table(Restaurant, Size),
    NOT booked(Restaurant, Size).</div>
                    <p>Award: 1 mark for correct head, 1 mark per condition (3 marks)</p>
                    
                    <p>(b) 2 marks for correct goal:</p>
                    <div class="code-block" style="background: #d1fae5;">
?- available(Restaurant, 4).</div>
                    
                    <p>(c) 3 marks total:</p>
                    <div class="code-block" style="background: #d1fae5;">
busy(Restaurant) :-
    restaurant(Restaurant),
    booked(Restaurant, _).</div>
                    <p>Award: 1 mark for correct head, 1 mark for restaurant check, 1 mark for booked with anonymous variable</p>
                    
                    <p>(d) 3 marks total:</p>
                    <div class="code-block" style="background: #d1fae5;">
can_accommodate(Restaurant, People) :-
    available(Restaurant, Size),
    Size >= People.</div>
                    <p>Award: 1 mark for using available, 1 mark for Size >= People, 1 mark for correct syntax</p>
                </div>
            </div>

            <div class="card">
                <h3>Question 4: Drawing Canvas</h3>
                <p>Show your working for calculating the output of complex queries:</p>
                <div class="canvas-container">
                    <canvas id="drawingCanvas" width="600" height="300"></canvas>
                </div>
                <button class="btn" onclick="clearCanvas()">Clear Canvas</button>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next</button>
            </div>
        </section>

        <!-- Extension Section -->
        <section class="section" id="extension">
            <div class="card extension-card">
                <h2>Extension Activities</h2>
                <p>Go beyond the specification with these challenging tasks!</p>

                <h3>1. Recursive Rules</h3>
                <p>In Prolog, we can define recursive rules. For example, to find ancestors:</p>
                <div class="code-block">
parent(tom, bob).
parent(bob, pat).
parent(pat, jim).

ancestor(X, Y) :- parent(X, Y).
ancestor(X, Y) :- parent(X, Z), ancestor(Z, Y).</div>

                <p>Write a recursive rule to determine if two people are related (share a common ancestor):</p>
                <textarea id="extension1" rows="4" placeholder="Write your recursive rule here..."></textarea>

                <h3>2. Logic Puzzles</h3>
                <p>Declarative programming excels at solving logic puzzles. Consider this puzzle:</p>
                <blockquote style="background: #f1f5f9; padding: 1rem; border-left: 4px solid var(--primary); color: #1e293b; margin: 1rem 0; border-radius: 0.25rem;">
                    "Three houses are in a row. The red house is to the left of the green house. The blue house is to the right of the red house. What is the order of the houses?"
                </blockquote>
                
                <p>Model this puzzle using facts and rules:</p>
                <textarea id="extension2" rows="6" placeholder="Write your logic puzzle solution..."></textarea>

                <h3>3. Restaurant Recommendation System</h3>
                <p>Create a rule-based system for restaurant recommendations. Given these facts:</p>
                <div class="code-block">
cuisine(mario, italian).
cuisine(sakura, japanese).
cuisine(spice, indian).

price(mario, moderate).
price(sakura, expensive).
price(spice, cheap).

vegetarian(mario, some).
vegetarian(sakura, few).
vegetarian(spice, many).</div>
                
                <p>Write rules to recommend restaurants based on preferences. For example, a rule for budget-conscious vegetarians:</p>
                <textarea id="extension3" rows="4" placeholder="Write your recommendation rules..."></textarea>

                <button class="btn" onclick="checkExtension()">Submit Extension Work</button>
                <div id="extensionFeedback" style="margin-top: 1rem;"></div>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next</button>
            </div>
        </section>

        <!-- Summary Section -->
        <section class="section" id="summary">
            <div class="card">
                <h2>Summary Quiz</h2>
                <p>Test your understanding with these questions:</p>

                <div class="quiz-question" style="margin: 2rem 0;">
                    <h4>1. What symbol is used to define a rule in Prolog?</h4>
                    <div class="quiz-container">
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary1')">-></button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, true, 'summary1')">:-</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary1')">==</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary1')">::</button>
                    </div>
                </div>

                <div class="quiz-question" style="margin: 2rem 0;">
                    <h4>2. In Prolog, variables must start with:</h4>
                    <div class="quiz-container">
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary2')">A number</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary2')">A lowercase letter</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, true, 'summary2')">An uppercase letter</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary2')">An underscore</button>
                    </div>
                </div>

                <div class="quiz-question" style="margin: 2rem 0;">
                    <h4>3. What does the comma (,) represent in a rule body?</h4>
                    <div class="quiz-container">
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary3')">OR</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, true, 'summary3')">AND</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary3')">NOT</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary3')">EQUALS</button>
                    </div>
                </div>

                <div class="quiz-question" style="margin: 2rem 0;">
                    <h4>4. True or False: Facts must end with a full stop (.)</h4>
                    <div class="quiz-container">
                        <button class="quiz-option" onclick="checkQuizAnswer(this, true, 'summary4')">True</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary4')">False</button>
                    </div>
                </div>

                <div class="quiz-question" style="margin: 2rem 0;">
                    <h4>5. Which query would find all animals with long hair?</h4>
                    <div class="quiz-container">
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary5')">hair(long, Animal)</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, true, 'summary5')">hair(Animal, long)</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary5')">Animal(hair, long)</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary5')">long(Animal, hair)</button>
                    </div>
                </div>

                <div class="quiz-question" style="margin: 2rem 0;">
                    <h4>6. Short Answer: Explain the difference between facts and rules.</h4>
                    <textarea id="summary6" rows="3" placeholder="Facts are... while rules are...">Facts are </textarea>
                    <button class="btn" onclick="checkShortAnswer('summary6')" style="margin-top: 0.5rem;">Check Answer</button>
                    <div id="summary6Feedback" style="margin-top: 0.5rem;"></div>
                </div>

                <div class="quiz-question" style="margin: 2rem 0;">
                    <h4>7. Which of the following is a valid fact in Prolog?</h4>
                    <div class="quiz-container">
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary7')">Type(cat, animal).</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, true, 'summary7')">type(cat, animal).</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary7')">type(cat, animal)</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary7')">type(Cat, animal).</button>
                    </div>
                </div>

                <div class="quiz-question" style="margin: 2rem 0;">
                    <h4>8. In the rule: happy(X) :- has_food(X), has_shelter(X).</h4>
                    <p>X is happy if:</p>
                    <div class="quiz-container">
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary8')">X has food OR shelter</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, true, 'summary8')">X has food AND shelter</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary8')">X has neither food nor shelter</button>
                        <button class="quiz-option" onclick="checkQuizAnswer(this, false, 'summary8')">X only has food</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Key Takeaways</h2>
                <ul style="margin-left: 2rem;">
                    <li>Declarative programming describes <strong>what</strong> to compute, not <strong>how</strong></li>
                    <li>Facts represent true statements in our knowledge base</li>
                    <li>Rules define logical relationships using :- (if)</li>
                    <li>Variables (uppercase) can be unified with values during queries</li>
                    <li>Complex rules use logical operators: , (AND), NOT</li>
                    <li>Queries find values that satisfy our goals</li>
                </ul>

                <h3>Essential Syntax to Remember:</h3>
                <div class="code-block" style="background: #f8fafc; color: #1e293b;">
% Facts
predicate(argument1, argument2).

% Rules  
head(Variables) :- 
    condition1(Variables),
    condition2(Variables).

% Queries
?- goal(Variable).

% Complex conditions
rule(X, Y) :-
    condition1(X),
    condition2(Y),
    NOT negative_condition(X, Y).</div>
            </div>

            <div class="card">
                <h2>Videos</h2>
                <p style="color: #666; font-style: italic;">Video content will be added here to reinforce key concepts.</p>
            </div>

            <div class="nav-buttons">
                <button class="btn" onclick="previousSection()">Previous</button>
                <button class="btn" disabled>Next</button>
            </div>
        </section>
    </main>

    <!-- Feedback Button -->
    <button class="feedback-btn" onclick="openFeedback()" title="Send Feedback">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
    </button>

    <!-- Feedback Modal -->
    <div class="feedback-modal" id="feedbackModal">
        <div class="feedback-content">
            <h3>Send Feedback</h3>
            <p>Found a bug or have a suggestion? Let us know!</p>
            <textarea id="feedbackText" rows="5" placeholder="Describe the issue or suggestion..."></textarea>
            <div style="margin-top: 1rem; display: flex; gap: 1rem;">
                <button class="btn" onclick="sendFeedback()">Send</button>
                <button class="btn" onclick="closeFeedback()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievementPopup" style="display: none;">
        <h3>Achievement Unlocked!</h3>
        <p id="achievementText"></p>
        <div style="font-size: 3rem; margin: 1rem 0;"></div>
    </div>

    <script>
        // Game State
        let gameState = {
            xp: 0,
            level: 1,
            xpRequired: 100,
            completedActions: new Set(),
            achievements: new Set(),
            currentSection: 'starter',
            selectedMatch: null,
            ruleStep: 1,
            hints: {
                facts: false,
                rules: false,
                queries: false
            },
            quizAnswers: new Set()
        };

        // XP Levels
        const xpLevels = [0, 100, 250, 500, 1000, 2000];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeGame();
            setupEventListeners();
            createParticles();
            initializeCanvas();
        });

        // Initialize Game
        function initializeGame() {
            updateXPDisplay();
            preventPaste();
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Navigation tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const section = e.target.getAttribute('data-section');
                    navigateToSection(section);
                });
            });

            // Prevent right-click
            document.addEventListener('contextmenu', e => e.preventDefault());
        }

        // Navigation
        function navigateToSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Show target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                gameState.currentSection = sectionId;

                // Update nav tabs
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.getAttribute('data-section') === sectionId) {
                        tab.classList.add('active');
                    }
                });

                // Award XP for first visit
                const actionId = `visit_${sectionId}`;
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(10, `Explored ${sectionId} section`);
                    gameState.completedActions.add(actionId);
                }
            }
        }

        function nextSection() {
            const sections = ['starter', 'intro', 'facts', 'rules', 'queries', 'complex', 'practice', 'extension', 'summary'];
            const currentIndex = sections.indexOf(gameState.currentSection);
            if (currentIndex < sections.length - 1) {
                navigateToSection(sections[currentIndex + 1]);
            }
        }

        function previousSection() {
            const sections = ['starter', 'intro', 'facts', 'rules', 'queries', 'complex', 'practice', 'extension', 'summary'];
            const currentIndex = sections.indexOf(gameState.currentSection);
            if (currentIndex > 0) {
                navigateToSection(sections[currentIndex - 1]);
            }
        }

        // Starter Activity - Matching
        let matches = new Map();
        
        function selectMatch(element) {
            if (!gameState.selectedMatch) {
                gameState.selectedMatch = element;
                element.classList.add('selected');
            } else {
                if (gameState.selectedMatch === element) {
                    // Deselect
                    element.classList.remove('selected');
                    gameState.selectedMatch = null;
                } else if (gameState.selectedMatch.getAttribute('data-match') === element.getAttribute('data-match')) {
                    // Match found
                    matches.set(gameState.selectedMatch, element);
                    gameState.selectedMatch.style.opacity = '0.5';
                    element.classList.add('correct');
                    gameState.selectedMatch.classList.remove('selected');
                    gameState.selectedMatch = null;
                    
                    // Check if all matched
                    if (matches.size === 4) {
                        const actionId = 'starter_complete';
                        if (!gameState.completedActions.has(actionId)) {
                            awardXP(25, 'Completed starter activity');
                            gameState.completedActions.add(actionId);
                            document.getElementById('starterFeedback').innerHTML = '<p style="color: var(--success);">Excellent! All matches correct!</p>';
                        }
                    }
                } else {
                    // Wrong match
                    gameState.selectedMatch.classList.remove('selected');
                    gameState.selectedMatch = null;
                    element.classList.add('incorrect');
                    setTimeout(() => element.classList.remove('incorrect'), 1000);
                }
            }
        }

        function checkStarterMatches() {
            if (matches.size < 4) {
                document.getElementById('starterFeedback').innerHTML = '<p style="color: var(--error);">Please match all items before checking.</p>';
            }
        }

        function resetStarter() {
            matches.clear();
            gameState.selectedMatch = null;
            document.querySelectorAll('.draggable, .dropzone').forEach(el => {
                el.classList.remove('selected', 'correct', 'incorrect');
                el.style.opacity = '1';
            });
            document.getElementById('starterFeedback').innerHTML = '';
        }

        // Quiz Answer Checking
        function checkQuizAnswer(button, isCorrect, questionId) {
            const actionId = `quiz_${questionId}`;
            
            if (!gameState.quizAnswers.has(questionId)) {
                gameState.quizAnswers.add(questionId);
                
                // Disable all options for this question
                button.parentElement.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.disabled = true;
                    opt.style.cursor = 'not-allowed';
                });

                if (isCorrect) {
                    button.classList.add('correct');
                    if (!gameState.completedActions.has(actionId)) {
                        awardXP(15, 'Correct answer!');
                        gameState.completedActions.add(actionId);
                    }
                } else {
                    button.classList.add('incorrect');
                }
            }
        }

        // Facts Exercise
        function checkFactsExercise() {
            const fact1_arg1 = document.getElementById('fact1_arg1').value;
            const fact1_arg2 = document.getElementById('fact1_arg2').value;
            const fact2_arg1 = document.getElementById('fact2_arg1').value;
            const fact2_arg2 = document.getElementById('fact2_arg2').value;

            let correct = 0;
            let feedback = '';

            if (fact1_arg1 === 'caracal' && fact1_arg2 === 'wild') {
                correct++;
                feedback += '<p style="color: var(--success);"> type(caracal, wild) is correct!</p>';
            } else {
                feedback += '<p style="color: var(--error);"> First fact should be type(caracal, wild)</p>';
            }

            if (fact2_arg1 === 'caracal' && fact2_arg2 === 'short') {
                correct++;
                feedback += '<p style="color: var(--success);"> hair(caracal, short) is correct!</p>';
            } else {
                feedback += '<p style="color: var(--error);"> Second fact should be hair(caracal, short)</p>';
            }

            document.getElementById('factsFeeback').innerHTML = feedback;

            if (correct === 2) {
                const actionId = 'facts_exercise_complete';
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(30, 'Mastered writing facts!');
                    gameState.completedActions.add(actionId);
                }
            }
        }

        // Rule Simulation
        const ruleSteps = [
            {
                text: 'Step 1: Query <code>pet(persian)</code> - Check if persian is a pet',
                highlight: []
            },
            {
                text: 'Step 2: Find rule <code>pet(X) :- type(X, domestic)</code>',
                highlight: ['rule']
            },
            {
                text: 'Step 3: Substitute X = persian: <code>pet(persian) :- type(persian, domestic)</code>',
                highlight: ['substitution']
            },
            {
                text: 'Step 4: Check fact <code>type(persian, domestic)</code> - TRUE! Persian is a pet.',
                highlight: ['fact', 'success']
            }
        ];

        function nextRuleStep() {
            if (gameState.ruleStep < ruleSteps.length) {
                gameState.ruleStep++;
                updateRuleSimulation();
            }
        }

        function prevRuleStep() {
            if (gameState.ruleStep > 1) {
                gameState.ruleStep--;
                updateRuleSimulation();
            }
        }

        function updateRuleSimulation() {
            const step = ruleSteps[gameState.ruleStep - 1];
            document.getElementById('ruleSimulation').innerHTML = `
                <div class="fact-rule-item ${step.highlight.includes('success') ? 'active' : ''}">
                    ${step.text}
                </div>
            `;

            // Update step indicators
            document.querySelectorAll('.step-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index < gameState.ruleStep);
            });

            // Update buttons
            document.getElementById('rulePrev').disabled = gameState.ruleStep === 1;
            document.getElementById('ruleNext').disabled = gameState.ruleStep === ruleSteps.length;

            // Award XP for completing simulation
            if (gameState.ruleStep === ruleSteps.length) {
                const actionId = 'rule_simulation_complete';
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(20, 'Completed rule tracing');
                    gameState.completedActions.add(actionId);
                }
            }
        }

        function resetRuleSimulation() {
            gameState.ruleStep = 1;
            updateRuleSimulation();
        }

        // Query System
        function updateQueryOptions() {
            const predicate = document.getElementById('queryPredicate').value;
            const arg1Select = document.getElementById('queryArg1');
            const arg2Select = document.getElementById('queryArg2');

            if (predicate === 'teaches') {
                arg1Select.innerHTML = `
                    <option value="Teacher">Teacher</option>
                    <option value="alan">alan</option>
                    <option value="ioana">ioana</option>
                    <option value="nina">nina</option>
                `;
                arg2Select.innerHTML = `
                    <option value="Subject">Subject</option>
                    <option value="mathematics">mathematics</option>
                    <option value="geography">geography</option>
                    <option value="history">history</option>
                `;
            } else {
                arg1Select.innerHTML = `
                    <option value="Student">Student</option>
                    <option value="ahmed">ahmed</option>
                    <option value="kim">kim</option>
                    <option value="hua">hua</option>
                `;
                arg2Select.innerHTML = `
                    <option value="Subject">Subject</option>
                    <option value="mathematics">mathematics</option>
                    <option value="geography">geography</option>
                    <option value="history">history</option>
                `;
            }
        }

        function runQuery() {
            const predicate = document.getElementById('queryPredicate').value;
            const arg1 = document.getElementById('queryArg1').value;
            const arg2 = document.getElementById('queryArg2').value;

            const facts = {
                teaches: {
                    alan: 'mathematics',
                    ioana: 'geography',
                    nina: 'history'
                },
                studies: {
                    ahmed: 'history',
                    kim: 'history',
                    hua: 'mathematics'
                }
            };

            let results = [];

            if (arg1.includes('Teacher') || arg1.includes('Student')) {
                // Variable in first position
                for (let person in facts[predicate]) {
                    if (arg2.includes('Subject') || facts[predicate][person] === arg2) {
                        if (arg2.includes('Subject')) {
                            results.push(`${arg1} = ${person}, ${arg2} = ${facts[predicate][person]}`);
                        } else {
                            results.push(`${arg1} = ${person}`);
                        }
                    }
                }
            } else if (arg2.includes('Subject')) {
                // Variable in second position
                if (facts[predicate][arg1]) {
                    results.push(`${arg2} = ${facts[predicate][arg1]}`);
                }
            } else {
                // No variables - check if fact exists
                if (facts[predicate][arg1] === arg2) {
                    results.push('true');
                } else {
                    results.push('false');
                }
            }

            const resultDiv = document.getElementById('queryResult');
            if (results.length > 0) {
                resultDiv.innerHTML = '<p style="color: var(--success);">Results:</p>' + 
                    results.map(r => `<code>${r}</code>`).join('<br>');
            } else {
                resultDiv.innerHTML = '<p style="color: var(--error);">No results found</p>';
            }

            const actionId = 'run_query';
            if (!gameState.completedActions.has(actionId)) {
                awardXP(15, 'Ran your first query');
                gameState.completedActions.add(actionId);
            }
        }

        function checkQueryAnswer() {
            const answer = document.getElementById('queryAnswer').value.toLowerCase().trim();
            const feedback = document.getElementById('queryFeedback');

            // Accept various formats
            const acceptableAnswers = [
                'student = ahmed, kim',
                'student = kim, ahmed',
                'ahmed, kim',
                'kim, ahmed'
            ];

            if (acceptableAnswers.some(a => answer.includes(a.toLowerCase()))) {
                feedback.innerHTML = '<p style="color: var(--success);">Correct! The query returns ahmed and kim as they both study history.</p>';
                const actionId = 'query_answer_correct';
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(25, 'Query master!');
                    gameState.completedActions.add(actionId);
                }
            } else {
                feedback.innerHTML = '<p style="color: var(--error);">Not quite. Remember: the query finds all students studying history.</p>';
            }
        }

        // Complex Rules
        function checkComplexRule() {
            const complex1 = document.getElementById('complex1').value;
            const complex2 = document.getElementById('complex2').value;
            const complex3 = document.getElementById('complex3').value;

            const feedback = document.getElementById('complexFeedback');

            if (complex1 === 'student' && complex2 === 'subject' && complex3 === 'NOT') {
                feedback.innerHTML = '<p style="color: var(--success);">Perfect! You\'ve correctly written a complex rule with logical operators.</p>' +
                    '<p>The complete rule is:</p>' +
                    '<div class="code-block" style="background: #d1fae5;">may_choose_subject(N, S) :-<br>' +
                    '&nbsp;&nbsp;&nbsp;&nbsp;student(N),<br>' +
                    '&nbsp;&nbsp;&nbsp;&nbsp;subject(S),<br>' +
                    '&nbsp;&nbsp;&nbsp;&nbsp;NOT choice1(N, S).</div>';
                const actionId = 'complex_rule_correct';
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(40, 'Complex rule expert!');
                    gameState.completedActions.add(actionId);
                }
            } else {
                let hints = [];
                if (complex1 !== 'student') hints.push('First condition should check if N is a student');
                if (complex2 !== 'subject') hints.push('Second condition should check if S is a subject');
                if (complex3 !== 'NOT') hints.push('We need to ensure N has NOT already chosen S');
                
                feedback.innerHTML = '<p style="color: var(--error);">Not quite right. Hints:</p>' +
                    '<ul>' + hints.map(h => `<li>${h}</li>`).join('') + '</ul>' +
                    '<p>Remember: The rule should ensure that N is a student, S is a subject, and N hasn\'t already chosen S as their first choice.</p>';
            }
        }

        // Practice Questions
        function showMarkScheme(questionNum) {
            const predicted = document.getElementById(`predicted${questionNum}`).value;
            
            if (!predicted || predicted < 1) {
                alert('Please enter your predicted marks first (minimum 1).');
                return;
            }

            let answerLength = 0;
            if (questionNum === 1) {
                answerLength = document.getElementById('practice1a').value.length +
                              document.getElementById('practice1b').value.length +
                              document.getElementById('practice1c').value.length;
            } else if (questionNum === 2) {
                answerLength = document.getElementById('practice2a').value.length +
                              document.getElementById('practice2b').value.length +
                              (document.getElementById('practice2c1').value.length || 0) +
                              (document.getElementById('practice2c2').value.length || 0) +
                              (document.getElementById('practice2c3').value.length || 0);
            } else if (questionNum === 3) {
                answerLength = document.getElementById('practice3a').value.length +
                              document.getElementById('practice3b').value.length +
                              document.getElementById('practice3c').value.length +
                              (document.getElementById('practice3d') ? document.getElementById('practice3d').value.length : 0);
            }

            if (answerLength < 50) {
                alert('Please make a reasonable attempt at all parts of the question before viewing the mark scheme.');
                return;
            }

            document.getElementById(`markScheme${questionNum}`).classList.add('show');
            
            const actionId = `view_markscheme_${questionNum}`;
            if (!gameState.completedActions.has(actionId)) {
                awardXP(10, 'Reviewed mark scheme');
                gameState.completedActions.add(actionId);
            }
        }

        function checkExtension() {
            const ext1 = document.getElementById('extension1').value;
            const ext2 = document.getElementById('extension2').value;
            const ext3 = document.getElementById('extension3') ? document.getElementById('extension3').value : '';
            const feedback = document.getElementById('extensionFeedback');

            let xpAwarded = 0;
            let feedbackText = '';

            if (ext1.length > 50) {
                xpAwarded += 25;
                feedbackText += '<p>Great attempt at recursive rules!</p>';
            }

            if (ext2.length > 50) {
                xpAwarded += 25;
                feedbackText += '<p>Excellent logic puzzle modelling!</p>';
            }

            if (ext3 && ext3.length > 30) {
                xpAwarded += 25;
                feedbackText += '<p>Creative recommendation system!</p>';
            }

            if (xpAwarded > 0) {
                const actionId = 'extension_complete';
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(xpAwarded, 'Extension master!');
                    gameState.completedActions.add(actionId);
                    checkAchievement('extension_expert', 'Extension Expert', 'Completed extension activities');
                }
                feedback.innerHTML = '<div style="color: var(--success);">' + feedbackText + '</div>';
            } else {
                feedback.innerHTML = '<p style="color: var(--error);">Please provide more detailed answers to the extension questions.</p>';
            }
        }

        // Short Answer Checking
        function checkShortAnswer(questionId) {
            const answer = document.getElementById(questionId).value.toLowerCase();
            const feedback = document.getElementById(questionId + 'Feedback');

            const keywords = {
                summary6: ['facts', 'true', 'statements', 'rules', 'relationships', 'logic', 'conditions', 'define', 'if']
            };

            // Also accept synonyms and related terms
            const synonyms = {
                'true': ['correct', 'valid', 'actual'],
                'statements': ['assertions', 'declarations'],
                'relationships': ['connections', 'relations'],
                'logic': ['logical', 'reasoning'],
                'conditions': ['requirements', 'criteria'],
                'define': ['specify', 'describe', 'state']
            };

            const requiredKeywords = keywords[questionId];
            let foundKeywords = requiredKeywords.filter(kw => answer.includes(kw));

            // Check for synonyms
            for (let keyword of requiredKeywords) {
                if (synonyms[keyword] && !foundKeywords.includes(keyword)) {
                    for (let synonym of synonyms[keyword]) {
                        if (answer.includes(synonym)) {
                            foundKeywords.push(keyword);
                            break;
                        }
                    }
                }
            }

            if (answer.length < 30) {
                feedback.innerHTML = '<p style="color: var(--error);">Please provide a more detailed answer.</p>';
                return;
            }

            const score = (foundKeywords.length / requiredKeywords.length) * 100;

            if (score >= 60) {
                feedback.innerHTML = '<p style="color: var(--success);">Good answer! You covered the key points.</p>';
                const actionId = `short_answer_${questionId}`;
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(Math.floor(score / 5), 'Thoughtful answer');
                    gameState.completedActions.add(actionId);
                }
            } else {
                feedback.innerHTML = '<p style="color: var(--warning);">Try to include more key concepts in your answer. Think about what makes facts different from rules.</p>';
            }
        }

        // Canvas Drawing
        let canvas, ctx;
        let isDrawing = false;

        function initializeCanvas() {
            canvas = document.getElementById('drawingCanvas');
            if (!canvas) return;
            
            ctx = canvas.getContext('2d');
            
            // Set canvas size
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Touch events
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function resizeCanvas() {
            if (!canvas) return;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
        }

        function getCoordinates(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            return {
                x: (e.clientX - rect.left) * scaleX,
                y: (e.clientY - rect.top) * scaleY
            };
        }

        function startDrawing(e) {
            isDrawing = true;
            const coords = getCoordinates(e);
            ctx.beginPath();
            ctx.moveTo(coords.x, coords.y);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const coords = getCoordinates(e);
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000';
            ctx.lineTo(coords.x, coords.y);
            ctx.stroke();
        }

        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                const actionId = 'used_canvas';
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(5, 'Used drawing canvas');
                    gameState.completedActions.add(actionId);
                }
            }
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                            e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Fill in the Blank Exercise
        function fillBlank(option, blankId) {
            const blank = document.getElementById(blankId);
            blank.value = option.textContent;
            
            // Visual feedback
            option.classList.add('used');
            setTimeout(() => option.classList.remove('used'), 500);
        }

        function checkFillBlanks() {
            const blank1 = document.getElementById('blank1').value;
            const blank2 = document.getElementById('blank2').value;
            const feedback = document.getElementById('fillFeedback');
            
            let correct = 0;
            let feedbackText = '';
            
            if (blank1 === 'type') {
                correct++;
                feedbackText += '<p style="color: var(--success);"> First fact correct!</p>';
            } else {
                feedbackText += '<p style="color: var(--error);"> First blank should be "type" (for the type of animal)</p>';
            }
            
            if (blank2 === 'spots') {
                correct++;
                feedbackText += '<p style="color: var(--success);"> Second fact correct!</p>';
            } else {
                feedbackText += '<p style="color: var(--error);"> Second blank should be "spots" (for whether it has spots)</p>';
            }
            
            feedback.innerHTML = feedbackText;
            
            if (correct === 2) {
                const actionId = 'fill_blanks_complete';
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(15, 'Fill in the blanks master!');
                    gameState.completedActions.add(actionId);
                }
            }
        }

        // Hints System
        function showHint(section) {
            const hintContainer = document.getElementById(section + 'Hint');
            hintContainer.classList.add('show');
            
            if (!gameState.hints[section]) {
                gameState.hints[section] = true;
                // Reduced XP for using hint
                const actionId = `hint_${section}`;
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(5, 'Learning with hints');
                    gameState.completedActions.add(actionId);
                }
            }
        }

        // XP and Achievements System
        function awardXP(amount, reason) {
            gameState.xp += amount;
            
            // Show floating XP
            showFloatingXP(amount, reason);
            
            // Check for level up
            if (gameState.xp >= gameState.xpRequired && gameState.level < 5) {
                levelUp();
            }
            
            updateXPDisplay();
        }

        function levelUp() {
            gameState.level++;
            gameState.xpRequired = xpLevels[gameState.level];
            
            showAchievement('Level Up!', `You reached Level ${gameState.level}!`, '');
            
            // Create celebration particles
            createCelebrationParticles();
        }

        function updateXPDisplay() {
            document.getElementById('xp').textContent = gameState.xp;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('xpRequired').textContent = gameState.xpRequired;
            
            const fillPercentage = (gameState.xp / gameState.xpRequired) * 100;
            document.getElementById('xpFill').style.width = `${Math.min(fillPercentage, 100)}%`;
        }

        function showFloatingXP(amount, reason) {
            const xpFloat = document.createElement('div');
            xpFloat.className = 'xp-float';
            xpFloat.innerHTML = `+${amount} XP<br><small>${reason}</small>`;
            xpFloat.style.cssText = `
                position: fixed;
                top: 100px;
                right: 50px;
                background: linear-gradient(135deg, var(--primary), var(--secondary));
                color: white;
                padding: 1rem;
                border-radius: 0.5rem;
                font-weight: bold;
                z-index: 1001;
                animation: floatUp 2s ease-out forwards;
                box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
            `;
            
            document.body.appendChild(xpFloat);
            
            setTimeout(() => xpFloat.remove(), 2000);
        }

        // Create float animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes floatUp {
                0% { opacity: 0; transform: translateY(20px); }
                50% { opacity: 1; }
                100% { opacity: 0; transform: translateY(-50px); }
            }
        `;
        document.head.appendChild(style);

        function showAchievement(title, text, emoji = '') {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementText').innerHTML = `${text}<br><span style="font-size: 3rem;">${emoji}</span>`;
            popup.style.display = 'block';
            
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3000);
        }

        function checkAchievement(id, title, description) {
            if (!gameState.achievements.has(id)) {
                gameState.achievements.add(id);
                showAchievement(title, description);
                awardXP(50, `Achievement: ${title}`);
            }
        }

        // Particles System
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.cssText = `
                    width: ${Math.random() * 6 + 2}px;
                    height: ${Math.random() * 6 + 2}px;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation: float ${Math.random() * 10 + 20}s linear infinite;
                    animation-delay: ${Math.random() * 10}s;
                `;
                particlesContainer.appendChild(particle);
            }
        }

        // Add float animation for particles
        const particleStyle = document.createElement('style');
        particleStyle.textContent = `
            @keyframes float {
                0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
                10% { opacity: 1; }
                90% { opacity: 1; }
                100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
            }
        `;
        document.head.appendChild(particleStyle);

        function createCelebrationParticles() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.style.cssText = `
                        position: fixed;
                        width: 10px;
                        height: 10px;
                        background: ${['#FFD700', '#FF69B4', '#00CED1', '#32CD32'][Math.floor(Math.random() * 4)]};
                        border-radius: 50%;
                        left: 50%;
                        top: 50%;
                        pointer-events: none;
                        z-index: 2001;
                    `;
                    document.body.appendChild(particle);
                    
                    const angle = (Math.PI * 2 * i) / 50;
                    const velocity = 5 + Math.random() * 5;
                    let x = 0, y = 0;
                    
                    const animate = () => {
                        x += Math.cos(angle) * velocity;
                        y += Math.sin(angle) * velocity + 0.5;
                        particle.style.transform = `translate(${x}px, ${y}px)`;
                        particle.style.opacity = Math.max(0, 1 - (Math.abs(x) + Math.abs(y)) / 200);
                        
                        if (Math.abs(x) < 200 && Math.abs(y) < 200) {
                            requestAnimationFrame(animate);
                        } else {
                            particle.remove();
                        }
                    };
                    
                    requestAnimationFrame(animate);
                }, i * 20);
            }
        }

        // Feedback System
        function openFeedback() {
            document.getElementById('feedbackModal').style.display = 'block';
        }

        function closeFeedback() {
            document.getElementById('feedbackModal').style.display = 'none';
            document.getElementById('feedbackText').value = '';
        }

        function sendFeedback() {
            const feedbackText = document.getElementById('feedbackText').value;
            if (!feedbackText.trim()) {
                alert('Please enter your feedback before sending.');
                return;
            }

            const currentPage = gameState.currentSection;
            const pageTitle = document.querySelector(`#${currentPage} h2`)?.textContent || currentPage;
            const subject = `Declarative Programming Lesson Feedback - ${pageTitle}`;
            
            // Get relevant code context if available
            let codeContext = '';
            const codeBlocks = document.querySelector(`#${currentPage} .code-block`);
            if (codeBlocks) {
                codeContext = `\n\nRelevant code on page:\n${codeBlocks.textContent.substring(0, 200)}...`;
            }
            
            const body = `Page: ${pageTitle} (${currentPage})\n\nFeedback:\n${feedbackText}${codeContext}\n\nBrowser: ${navigator.userAgent}`;
            
            // Create mailto link
            const mailtoLink = `mailto:millingtond@mgs.org?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoLink;
            
            closeFeedback();
            
            const actionId = 'sent_feedback';
            if (!gameState.completedActions.has(actionId)) {
                awardXP(20, 'Feedback provider');
                gameState.completedActions.add(actionId);
            }
        }

        // Prevent Paste
        function preventPaste() {
            // Prevent paste events
            document.addEventListener('paste', (e) => {
                e.preventDefault();
                return false;
            });

            // Prevent Ctrl+V / Cmd+V
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'v') {
                    e.preventDefault();
                    return false;
                }
            });

            // Prevent context menu paste
            document.addEventListener('contextmenu', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    e.preventDefault();
                    return false;
                }
            });
        }

        // Ranking Exercise
        let rankingOrder = [];
        
        function selectRank(element) {
            if (element.classList.contains('ranked')) {
                // Remove from ranking
                rankingOrder = rankingOrder.filter(el => el !== element);
                element.classList.remove('ranked');
                element.style.order = '';
                element.textContent = element.textContent.replace(/^\d+\. /, '');
            } else {
                // Add to ranking
                rankingOrder.push(element);
                element.classList.add('ranked');
                element.textContent = `${rankingOrder.length}. ${element.textContent.replace(/^\d+\. /, '')}`;
                element.style.order = rankingOrder.length;
            }
            
            // Visual feedback for mobile
            if ('vibrate' in navigator) {
                navigator.vibrate(50); // Haptic feedback for mobile devices
            }
        }
        
        function checkRanking() {
            if (rankingOrder.length !== 4) {
                document.getElementById('rankingFeedback').innerHTML = 
                    '<p style="color: var(--error);">Please rank all 4 steps before checking.</p>';
                return;
            }
            
            const correctOrder = rankingOrder.every((el, index) => 
                parseInt(el.getAttribute('data-rank')) === index + 1
            );
            
            if (correctOrder) {
                document.getElementById('rankingFeedback').innerHTML = 
                    '<p style="color: var(--success);">Perfect! You understand the query evaluation process.</p>';
                const actionId = 'ranking_complete';
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(25, 'Query evaluation expert!');
                    gameState.completedActions.add(actionId);
                }
            } else {
                document.getElementById('rankingFeedback').innerHTML = 
                    '<p style="color: var(--error);">Not quite right. Think about how Prolog finds and applies rules.</p>';
            }
        }
        
        function resetRanking() {
            rankingOrder = [];
            document.querySelectorAll('#rankingItems .draggable').forEach(el => {
                el.classList.remove('ranked');
                el.style.order = '';
                el.textContent = el.textContent.replace(/^\d+\. /, '');
            });
            document.getElementById('rankingFeedback').innerHTML = '';
        }

        // Categorization Exercise
        let categorizedItems = {
            actions: [],
            properties: []
        };

        function categorize(element, predicate) {
            // Remove from any existing category
            Object.keys(categorizedItems).forEach(cat => {
                categorizedItems[cat] = categorizedItems[cat].filter(item => item !== predicate);
            });

            // Toggle selection
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                updateCategoryDisplay();
                return;
            }

            // Add to appropriate category based on click location
            document.querySelectorAll('.draggable').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
        }

        function updateCategoryDisplay() {
            document.getElementById('actions-items').innerHTML = categorizedItems.actions.map(item => 
                `<div style="margin: 0.25rem 0;">${item}</div>`).join('');
            document.getElementById('properties-items').innerHTML = categorizedItems.properties.map(item => 
                `<div style="margin: 0.25rem 0;">${item}</div>`).join('');
        }

        document.addEventListener('click', function(e) {
            if (e.target.closest('.dropzone[data-category]')) {
                const selected = document.querySelector('.draggable.selected');
                if (selected) {
                    const category = e.target.closest('.dropzone').getAttribute('data-category');
                    const predicate = selected.getAttribute('onclick').match(/'([^']+)'/)[1];
                    
                    // Remove from other categories
                    Object.keys(categorizedItems).forEach(cat => {
                        categorizedItems[cat] = categorizedItems[cat].filter(item => item !== predicate);
                    });
                    
                    // Add to new category
                    categorizedItems[category].push(predicate);
                    selected.style.opacity = '0.5';
                    selected.classList.remove('selected');
                    updateCategoryDisplay();
                }
            }
        });

        function checkCategorization() {
            const correct = {
                actions: ['teaches', 'studies'],
                properties: ['type', 'hair']
            };
            
            let score = 0;
            let feedback = '';
            
            if (categorizedItems.actions.sort().join(',') === correct.actions.sort().join(',')) {
                score += 2;
                feedback += '<p style="color: var(--success);"> Actions correctly identified!</p>';
            } else {
                feedback += '<p style="color: var(--error);"> Actions should include: teaches, studies</p>';
            }
            
            if (categorizedItems.properties.sort().join(',') === correct.properties.sort().join(',')) {
                score += 2;
                feedback += '<p style="color: var(--success);"> Properties correctly identified!</p>';
            } else {
                feedback += '<p style="color: var(--error);"> Properties should include: type, hair</p>';
            }
            
            document.getElementById('categorizeFeedback').innerHTML = feedback;
            
            if (score === 4) {
                const actionId = 'categorization_complete';
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(20, 'Categorization master!');
                    gameState.completedActions.add(actionId);
                }
            }
        }

        function resetCategorization() {
            categorizedItems = { actions: [], properties: [] };
            document.querySelectorAll('.draggable').forEach(el => {
                el.classList.remove('selected');
                el.style.opacity = '1';
            });
            updateCategoryDisplay();
            document.getElementById('categorizeFeedback').innerHTML = '';
        }

        // Speed Game
        let gameTimer = null;
        let gameTime = 30;
        let gameScore = 0;
        let currentQuestion = 0;
        const gameQuestions = [
            {
                fact: "type(tiger, wild).",
                correct: "A tiger is a wild animal",
                wrong: ["A wild is a tiger animal", "Tiger has wild type", "Wild tigers exist"]
            },
            {
                fact: "hair(persian, long).",
                correct: "A persian has long hair",
                wrong: ["Long hair is persian", "Persian cats are long", "Hair is long and persian"]
            },
            {
                fact: "spots(cheetah, yes).",
                correct: "A cheetah has spots",
                wrong: ["Spots have cheetahs", "Yes, cheetah spots", "Cheetah spots are yes"]
            },
            {
                fact: "manufacturer(tesla, tesla).",
                correct: "Tesla is manufactured by Tesla",
                wrong: ["Tesla manufactures tesla", "Manufacturer is Tesla Tesla", "Tesla and Tesla manufacture"]
            },
            {
                fact: "teaches(nina, history).",
                correct: "Nina teaches history",
                wrong: ["History teaches Nina", "Nina and history teach", "Teaching Nina history"]
            }
        ];
        
        function startSpeedGame() {
            gameScore = 0;
            gameTime = 30;
            currentQuestion = 0;
            document.getElementById('speedGame').style.display = 'block';
            document.getElementById('startGameBtn').style.display = 'none';
            document.getElementById('gameFeedback').innerHTML = '';
            
            nextGameQuestion();
            
            gameTimer = setInterval(() => {
                gameTime--;
                document.getElementById('gameTimer').textContent = gameTime;
                if (gameTime <= 0) {
                    endSpeedGame();
                }
            }, 1000);
        }
        
        function nextGameQuestion() {
            if (currentQuestion >= gameQuestions.length) {
                endSpeedGame();
                return;
            }
            
            const question = gameQuestions[currentQuestion];
            document.getElementById('currentFact').textContent = question.fact;
            
            // Randomize options
            const options = [question.correct, ...question.wrong].sort(() => Math.random() - 0.5);
            document.getElementById('meaningOptions').innerHTML = options.map((opt, index) => 
                `<button class="quiz-option" onclick="checkGameAnswer('${opt === question.correct}')">${opt}</button>`
            ).join('');
        }
        
        function checkGameAnswer(isCorrect) {
            if (isCorrect === 'true') {
                gameScore++;
                document.getElementById('gameScore').textContent = gameScore;
                
                // Visual feedback
                document.getElementById('currentFact').style.background = '#d1fae5';
                setTimeout(() => {
                    document.getElementById('currentFact').style.background = '#e0e7ff';
                }, 300);
            }
            
            currentQuestion++;
            nextGameQuestion();
        }
        
        function endSpeedGame() {
            clearInterval(gameTimer);
            document.getElementById('speedGame').style.display = 'none';
            document.getElementById('resetGameBtn').style.display = 'inline-block';
            
            let feedback = `<h4>Game Over!</h4><p>You scored ${gameScore}/5 in ${30 - gameTime} seconds!</p>`;
            
            if (gameScore === 5) {
                feedback += '<p style="color: var(--success);">Perfect score! You really understand facts!</p>';
                const actionId = 'speed_game_perfect';
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(30, 'Speed game champion!');
                    gameState.completedActions.add(actionId);
                }
            } else if (gameScore >= 3) {
                feedback += '<p style="color: var(--success);">Good job! Keep practicing!</p>';
                const actionId = 'speed_game_complete';
                if (!gameState.completedActions.has(actionId)) {
                    awardXP(15, 'Speed game player');
                    gameState.completedActions.add(actionId);
                }
            } else {
                feedback += '<p style="color: var(--warning);">Keep practicing! Remember: predicate(subject, property)</p>';
            }
            
            document.getElementById('gameFeedback').innerHTML = feedback;
        }
        
        function resetSpeedGame() {
            document.getElementById('resetGameBtn').style.display = 'none';
            document.getElementById('startGameBtn').style.display = 'inline-block';
            document.getElementById('gameFeedback').innerHTML = '';
        }

        // Speed Game
    </script>
</body>
</html>