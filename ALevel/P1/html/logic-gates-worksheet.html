<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logic Gates & Logic Circuits - Interactive Lesson</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --bg-color: #f5f7fa;
            --text-color: #2c3e50;
            --card-bg: #ffffff;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --success-color: #27ae60;
            --error-color: #e74c3c;
            --warning-color: #f39c12;
            --gate-color: #3498db;
            --wire-color: #34495e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* High Contrast Mode */
        body.high-contrast {
            --bg-color: #000000;
            --text-color: #ffffff;
            --card-bg: #1a1a1a;
            --primary-color: #00ff00;
            --secondary-color: #ffff00;
            filter: contrast(1.5);
        }

        /* Dyslexia Font */
        body.dyslexia-font {
            font-family: 'OpenDyslexic', 'Comic Sans MS', sans-serif;
            letter-spacing: 0.1em;
            line-height: 1.8;
        }

        /* Font Size Variations */
        body.font-small { font-size: 14px; }
        body.font-large { font-size: 18px; }
        body.font-xlarge { font-size: 20px; }

        /* Header with Glassmorphism */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* XP and Level Display */
        .xp-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1.5rem;
            border-radius: 2rem;
            backdrop-filter: blur(5px);
        }

        .xp-bar {
            width: 200px;
            height: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .xp-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .level-badge {
            font-size: 1.2rem;
            font-weight: bold;
            background: rgba(255,255,255,0.3);
            padding: 0.3rem 0.8rem;
            border-radius: 1rem;
        }

        /* Navigation */
        .nav-container {
            background: var(--card-bg);
            padding: 1rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 80px;
            z-index: 999;
        }

        .nav-pills {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding: 0.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-pill {
            padding: 0.5rem 1rem;
            background: var(--bg-color);
            border: 2px solid transparent;
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 500;
        }

        .nav-pill:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-color: var(--primary-color);
        }

        .nav-pill.active {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .nav-pill.completed {
            border-color: var(--success-color);
            position: relative;
        }

        .nav-pill.completed::after {
            content: '✓';
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--success-color);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        /* Main Content Area */
        .main-content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.5s ease;
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Interactive Elements */
        .interactive-area {
            background: var(--bg-color);
            border: 2px dashed var(--primary-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1rem 0;
            position: relative;
            transition: all 0.3s ease;
        }

        .interactive-area:hover {
            border-style: solid;
            transform: scale(1.02);
        }

        /* Logic Gate Styles */
        .gate-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 2rem 0;
            position: relative;
        }

        .logic-gate {
            width: 100px;
            height: 80px;
            position: relative;
            margin: 0 2rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .logic-gate:hover {
            transform: scale(1.1);
        }

        .gate-body {
            width: 100%;
            height: 100%;
            background: var(--gate-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            border-radius: 0.5rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .gate-input, .gate-output {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--wire-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .gate-input {
            left: -30px;
        }

        .gate-output {
            right: -30px;
        }

        /* Truth Table Styles */
        .truth-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow: hidden;
            border-radius: 0.5rem;
        }

        .truth-table th {
            background: var(--primary-color);
            color: white;
            padding: 0.8rem;
            text-align: center;
            font-weight: 600;
        }

        .truth-table td {
            background: var(--card-bg);
            padding: 0.8rem;
            text-align: center;
            border: 1px solid var(--bg-color);
        }

        .truth-table tr:hover td {
            background: var(--bg-color);
        }

        .truth-table input {
            width: 40px;
            padding: 0.3rem;
            text-align: center;
            border: 2px solid var(--primary-color);
            border-radius: 0.3rem;
            font-weight: bold;
        }

        .truth-table input.correct {
            border-color: var(--success-color);
            background: rgba(46, 204, 113, 0.1);
        }

        .truth-table input.incorrect {
            border-color: var(--error-color);
            background: rgba(231, 76, 60, 0.1);
        }

        /* Quiz and Activity Styles */
        .quiz-option {
            display: block;
            width: 100%;
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--card-bg);
            border: 2px solid var(--bg-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1rem;
        }

        .quiz-option:hover {
            background: var(--bg-color);
            transform: translateX(5px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .quiz-option.selected {
            border-color: var(--primary-color);
            background: rgba(74, 144, 226, 0.1);
        }

        .quiz-option.correct {
            border-color: var(--success-color);
            background: rgba(46, 204, 113, 0.1);
            animation: correctPulse 0.5s ease;
        }

        .quiz-option.incorrect {
            border-color: var(--error-color);
            background: rgba(231, 76, 60, 0.1);
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Buttons */
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .btn:active::after {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #3a7bc8;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-danger {
            background: var(--error-color);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        /* Canvas for Drawing */
        #drawing-canvas {
            border: 2px solid var(--primary-color);
            border-radius: 0.5rem;
            background: white;
            touch-action: none;
            cursor: crosshair;
            margin: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.5s ease;
            z-index: 2000;
            max-width: 300px;
        }

        .achievement-popup.show {
            transform: translateX(0);
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(0) translateY(0); }
            50% { transform: translateX(0) translateY(-10px); }
        }

        .achievement-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        /* Shame Message */
        .shame-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--error-color);
            color: white;
            padding: 2rem 3rem;
            border-radius: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            z-index: 3000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: shameAnimation 3s ease-in-out;
        }

        @keyframes shameAnimation {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); }
            20% { transform: translate(-50%, -50%) scale(1.2) rotate(-5deg); }
            40% { transform: translate(-50%, -50%) scale(0.9) rotate(5deg); }
            60% { transform: translate(-50%, -50%) scale(1.1) rotate(-5deg); }
            80% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
            100% { transform: translate(-50%, -50%) scale(0) rotate(0deg); }
        }

        /* Drag and Drop (Click-based) */
        .draggable-item {
            padding: 0.8rem;
            margin: 0.5rem;
            background: var(--card-bg);
            border: 2px solid var(--primary-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .draggable-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .draggable-item.selected {
            background: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }

        .drop-zone {
            min-height: 60px;
            padding: 1rem;
            margin: 0.5rem;
            background: var(--bg-color);
            border: 3px dashed var(--primary-color);
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .drop-zone.highlight {
            background: rgba(74, 144, 226, 0.1);
            border-color: var(--primary-color);
            border-style: solid;
        }

        .drop-zone.filled {
            background: rgba(46, 204, 113, 0.1);
            border-color: var(--success-color);
            border-style: solid;
        }

        /* Circuit Builder */
        .circuit-builder {
            background: #f0f0f0;
            border: 2px solid var(--primary-color);
            border-radius: 0.5rem;
            padding: 1rem;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }

        .circuit-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
        }

        /* Feedback Button */
        .feedback-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .feedback-btn:hover {
            transform: scale(1.1) rotate(15deg);
            background: var(--secondary-color);
        }

        /* Feedback Modal */
        .feedback-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .feedback-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Accessibility Controls */
        .accessibility-controls {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .accessibility-controls button {
            display: block;
            width: 100%;
            margin: 0.5rem 0;
            padding: 0.5rem;
            border: 1px solid var(--primary-color);
            background: white;
            border-radius: 0.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .accessibility-controls button:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Particle Effects */
        .particle {
            position: fixed;
            pointer-events: none;
            opacity: 0;
            z-index: 3000;
        }

        .particle.star {
            width: 20px;
            height: 20px;
            background: gold;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: particleFall 2s ease-out forwards;
        }

        @keyframes particleFall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(200px) rotate(360deg);
            }
        }

        /* Hint System */
        .hint-container {
            background: rgba(243, 156, 18, 0.1);
            border-left: 4px solid var(--warning-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.3rem;
            display: none;
        }

        .hint-container.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Mark Scheme */
        .mark-scheme {
            background: rgba(46, 204, 113, 0.1);
            border: 2px solid var(--success-color);
            padding: 1.5rem;
            margin-top: 1rem;
            border-radius: 0.5rem;
            display: none;
        }

        .mark-scheme.show {
            display: block;
        }

        .mark-scheme h4 {
            color: var(--success-color);
            margin-bottom: 0.5rem;
        }

        /* Circuit Components */
        .gate-symbol {
            stroke: var(--gate-color);
            stroke-width: 2;
            fill: none;
        }

        .gate-label {
            fill: var(--gate-color);
            font-weight: bold;
            font-size: 14px;
            text-anchor: middle;
        }

        .wire {
            stroke: var(--wire-color);
            stroke-width: 2;
            fill: none;
        }

        .wire.active {
            stroke: var(--success-color);
            stroke-width: 3;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Simulation Controls */
        .simulation-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .sim-btn {
            padding: 0.5rem 1rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .sim-btn:hover {
            background: #3a7bc8;
            transform: translateY(-2px);
        }

        .sim-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .xp-container {
                width: 100%;
                justify-content: center;
            }

            .nav-pills {
                justify-content: flex-start;
                padding-bottom: 0.5rem;
            }

            .gate-container {
                flex-direction: column;
                gap: 2rem;
            }

            .circuit-builder {
                min-height: 300px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .accessibility-controls {
                display: none;
            }
        }

        /* Print Styles */
        @media print {
            .header, .nav-container, .feedback-btn, .accessibility-controls {
                display: none;
            }

            .card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #000;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Input validation styles */
        .input-field {
            padding: 0.5rem;
            border: 2px solid #ddd;
            border-radius: 0.3rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .input-field.error {
            border-color: var(--error-color);
            background: rgba(231, 76, 60, 0.1);
        }

        .input-field.success {
            border-color: var(--success-color);
            background: rgba(46, 204, 113, 0.1);
        }

        /* Expression Builder */
        .expression-builder {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
            padding: 1rem;
            background: var(--bg-color);
            border-radius: 0.5rem;
            min-height: 60px;
            margin: 1rem 0;
        }

        .expression-token {
            padding: 0.3rem 0.8rem;
            background: var(--primary-color);
            color: white;
            border-radius: 1rem;
            font-weight: 500;
            cursor: move;
            transition: all 0.3s ease;
        }

        .expression-token:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .expression-token.operator {
            background: var(--secondary-color);
        }

        .expression-token.variable {
            background: var(--accent-color);
        }

        /* Simulation highlight */
        .sim-highlight {
            background: rgba(255, 235, 59, 0.3);
            border: 2px solid #fdd835;
            border-radius: 0.5rem;
            padding: 0.5rem;
            animation: highlightPulse 1s infinite;
        }

        @keyframes highlightPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Step indicator */
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ddd;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .step-dot.active {
            background: var(--primary-color);
            transform: scale(1.5);
        }

        .step-dot.completed {
            background: var(--success-color);
        }

        /* Gate simulation visuals */
        .input-indicator {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .input-indicator.zero {
            background: #e0e0e0;
            color: #666;
        }

        .input-indicator.one {
            background: var(--success-color);
            color: white;
            box-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }

        .output-display {
            font-size: 2rem;
            font-weight: bold;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .output-display.zero {
            background: #e0e0e0;
            color: #666;
        }

        .output-display.one {
            background: var(--success-color);
            color: white;
            animation: outputPulse 0.5s ease;
        }

        @keyframes outputPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Extension activity styles */
        .extension-task {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 2px solid var(--primary-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .extension-task h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        /* Common mistakes section */
        .mistake-alert {
            background: rgba(231, 76, 60, 0.1);
            border-left: 4px solid var(--error-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.3rem;
        }

        .mistake-alert h5 {
            color: var(--error-color);
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-content">
            <h1>Logic Gates & Logic Circuits</h1>
            <div class="xp-container" role="status" aria-live="polite">
                <span class="level-badge">Level <span id="current-level">1</span></span>
                <div class="xp-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <div class="xp-fill" id="xp-fill" style="width: 0%"></div>
                </div>
                <span id="xp-text">0 / 100 XP</span>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-container" role="navigation">
        <div class="nav-pills" id="nav-pills">
            <button class="nav-pill active" data-section="intro" aria-current="page">Introduction</button>
            <button class="nav-pill" data-section="starter">Starter Activity</button>
            <button class="nav-pill" data-section="gates">Logic Gates</button>
            <button class="nav-pill" data-section="simulations">Gate Simulations</button>
            <button class="nav-pill" data-section="truth-tables">Truth Tables</button>
            <button class="nav-pill" data-section="circuits">Building Circuits</button>
            <button class="nav-pill" data-section="expressions">Boolean Expressions</button>
            <button class="nav-pill" data-section="conversions">Conversions</button>
            <button class="nav-pill" data-section="practice">Exam Practice</button>
            <button class="nav-pill" data-section="extension">Extension</button>
            <button class="nav-pill" data-section="summary">Summary Quiz</button>
            <button class="nav-pill" data-section="videos">Videos</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" role="main">
        <!-- Introduction Section -->
        <section id="intro" class="section active">
            <div class="card">
                <h2 class="card-title">
                    <span>🎯</span> Welcome to Logic Gates & Circuits
                </h2>
                
                <h3>Learning Outcomes</h3>
                <ul style="margin: 1rem 0; padding-left: 2rem;">
                    <li>Identify and describe the function of all 6 logic gates (NOT, AND, OR, NAND, NOR, XOR)</li>
                    <li>Construct truth tables for each logic gate</li>
                    <li>Draw logic circuits from problem statements, expressions, or truth tables</li>
                    <li>Write Boolean expressions from logic circuits or truth tables</li>
                    <li>Convert between different representations</li>
                    <li>Design and simplify logic circuits for real-world applications</li>
                </ul>

                <div class="interactive-area">
                    <h4>Pre-Assessment: What Do You Already Know?</h4>
                    <p>Which of these is NOT a basic logic gate?</p>
                    
                    <button class="quiz-option" onclick="checkIntroQuiz('a')">XOR (Exclusive OR)</button>
                    <button class="quiz-option" onclick="checkIntroQuiz('b')">MAYBE</button>
                    <button class="quiz-option" onclick="checkIntroQuiz('c')">NAND</button>
                    <button class="quiz-option" onclick="checkIntroQuiz('d')">NOR</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="nextSection()">
                        Start Learning →
                    </button>
                </div>
            </div>
        </section>

        <!-- Starter Activity -->
        <section id="starter" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🚀</span> Starter Activity: Logic in Daily Life
                </h2>
                
                <p>Before we dive into logic gates, let's connect them to real-world scenarios. Match each scenario to the type of logic it represents:</p>
                
                <div class="interactive-area">
                    <h4>Click to Match Scenarios</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div>
                            <h5>Scenarios</h5>
                            <div class="draggable-item" onclick="selectItem('starter', 'item1')">
                                "The alarm sounds if the door is open AND motion is detected"
                            </div>
                            <div class="draggable-item" onclick="selectItem('starter', 'item2')">
                                "The light turns on if EITHER switch A OR switch B is pressed"
                            </div>
                            <div class="draggable-item" onclick="selectItem('starter', 'item3')">
                                "The heater turns off when the temperature is NOT below 20°C"
                            </div>
                            <div class="draggable-item" onclick="selectItem('starter', 'item4')">
                                "The door locks if the button is pressed AND the door is NOT already locked"
                            </div>
                        </div>
                        
                        <div>
                            <h5>Logic Types</h5>
                            <div class="drop-zone" onclick="dropItem('starter', 'and')">
                                <strong>AND Logic</strong>
                                <div id="starter-and-items"></div>
                            </div>
                            <div class="drop-zone" onclick="dropItem('starter', 'or')">
                                <strong>OR Logic</strong>
                                <div id="starter-or-items"></div>
                            </div>
                            <div class="drop-zone" onclick="dropItem('starter', 'not')">
                                <strong>NOT Logic</strong>
                                <div id="starter-not-items"></div>
                            </div>
                            <div class="drop-zone" onclick="dropItem('starter', 'combined')">
                                <strong>Combined Logic</strong>
                                <div id="starter-combined-items"></div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="resetActivity('starter')" style="margin-top: 1rem;">
                        Reset Activity
                    </button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousSection()">← Previous</button>
                    <button class="btn btn-primary" onclick="checkStarterActivity()">Check Answers</button>
                    <button class="btn btn-primary" onclick="nextSection()">Next →</button>
                </div>
            </div>
        </section>

        <!-- Logic Gates Section -->
        <section id="gates" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🔌</span> The Six Logic Gates
                </h2>
                
                <p>Logic gates are the fundamental building blocks of digital circuits. They take binary inputs (0 or 1) and produce binary outputs based on their function.</p>
                
                <div class="interactive-area">
                    <h4>Click each gate to learn more:</h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
                        <div class="logic-gate" onclick="showGateInfo('not')">
                            <div class="gate-body">NOT</div>
                            <div class="gate-input" style="top: 30px;">A</div>
                            <div class="gate-output" style="top: 30px;">X</div>
                        </div>
                        
                        <div class="logic-gate" onclick="showGateInfo('and')">
                            <div class="gate-body">AND</div>
                            <div class="gate-input" style="top: 15px;">A</div>
                            <div class="gate-input" style="top: 45px;">B</div>
                            <div class="gate-output" style="top: 30px;">X</div>
                        </div>
                        
                        <div class="logic-gate" onclick="showGateInfo('or')">
                            <div class="gate-body">OR</div>
                            <div class="gate-input" style="top: 15px;">A</div>
                            <div class="gate-input" style="top: 45px;">B</div>
                            <div class="gate-output" style="top: 30px;">X</div>
                        </div>
                        
                        <div class="logic-gate" onclick="showGateInfo('nand')">
                            <div class="gate-body">NAND</div>
                            <div class="gate-input" style="top: 15px;">A</div>
                            <div class="gate-input" style="top: 45px;">B</div>
                            <div class="gate-output" style="top: 30px;">X</div>
                        </div>
                        
                        <div class="logic-gate" onclick="showGateInfo('nor')">
                            <div class="gate-body">NOR</div>
                            <div class="gate-input" style="top: 15px;">A</div>
                            <div class="gate-input" style="top: 45px;">B</div>
                            <div class="gate-output" style="top: 30px;">X</div>
                        </div>
                        
                        <div class="logic-gate" onclick="showGateInfo('xor')">
                            <div class="gate-body">XOR</div>
                            <div class="gate-input" style="top: 15px;">A</div>
                            <div class="gate-input" style="top: 45px;">B</div>
                            <div class="gate-output" style="top: 30px;">X</div>
                        </div>
                    </div>
                    
                    <div id="gate-info" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--bg-color); border-radius: 0.5rem;">
                        <!-- Gate information will be displayed here -->
                    </div>
                </div>

                <div class="interactive-area">
                    <h4>Quick Check: Gate Identification</h4>
                    <p>Which gate outputs 1 only when BOTH inputs are different?</p>
                    
                    <button class="quiz-option" onclick="checkGateQuiz('a')">AND</button>
                    <button class="quiz-option" onclick="checkGateQuiz('b')">OR</button>
                    <button class="quiz-option" onclick="checkGateQuiz('c')">XOR</button>
                    <button class="quiz-option" onclick="checkGateQuiz('d')">NAND</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousSection()">← Previous</button>
                    <button class="btn btn-primary" onclick="nextSection()">Next →</button>
                </div>
            </div>
        </section>

        <!-- Gate Simulations Section -->
        <section id="simulations" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>⚡</span> Interactive Gate Simulations
                </h2>
                
                <p>Experiment with each gate by clicking the inputs to toggle between 0 and 1. Watch how the output changes!</p>
                
                <div class="interactive-area">
                    <h4>Gate Simulator</h4>
                    
                    <div class="simulation-controls">
                        <button class="sim-btn" onclick="selectGateSimulation('not')">NOT</button>
                        <button class="sim-btn" onclick="selectGateSimulation('and')">AND</button>
                        <button class="sim-btn" onclick="selectGateSimulation('or')">OR</button>
                        <button class="sim-btn" onclick="selectGateSimulation('nand')">NAND</button>
                        <button class="sim-btn" onclick="selectGateSimulation('nor')">NOR</button>
                        <button class="sim-btn" onclick="selectGateSimulation('xor')">XOR</button>
                    </div>
                    
                    <div id="gate-simulation" style="margin: 2rem 0; text-align: center;">
                        <!-- Simulation will be displayed here -->
                    </div>
                    
                    <button class="btn btn-secondary" onclick="resetSimulation()">
                        Reset Simulation
                    </button>
                </div>

                <div class="interactive-area">
                    <h4>Challenge: Predict the Output</h4>
                    <p>For an AND gate with inputs A=1 and B=0, what is the output?</p>
                    
                    <button class="quiz-option" onclick="checkSimQuiz('a')">0</button>
                    <button class="quiz-option" onclick="checkSimQuiz('b')">1</button>
                    <button class="quiz-option" onclick="checkSimQuiz('c')">It depends</button>
                    <button class="quiz-option" onclick="checkSimQuiz('d')">Error</button>
                </div>

                <div class="mistake-alert">
                    <h5>Common Mistake!</h5>
                    <p>Remember: AND gates output 1 ONLY when ALL inputs are 1. Any 0 input makes the output 0.</p>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousSection()">← Previous</button>
                    <button class="btn btn-primary" onclick="nextSection()">Next →</button>
                </div>
            </div>
        </section>

        <!-- Truth Tables Section -->
        <section id="truth-tables" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>📊</span> Truth Tables
                </h2>
                
                <p>Truth tables show all possible input combinations and their corresponding outputs for logic gates.</p>
                
                <div class="interactive-area">
                    <h4>Complete the Truth Tables</h4>
                    <p>Fill in the missing outputs. Click Check when done.</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
                        <!-- AND Gate Truth Table -->
                        <div>
                            <h5>AND Gate</h5>
                            <table class="truth-table">
                                <thead>
                                    <tr>
                                        <th>A</th>
                                        <th>B</th>
                                        <th>Output</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>0</td>
                                        <td>0</td>
                                        <td><input type="text" id="and-00" maxlength="1"></td>
                                    </tr>
                                    <tr>
                                        <td>0</td>
                                        <td>1</td>
                                        <td><input type="text" id="and-01" maxlength="1"></td>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>0</td>
                                        <td><input type="text" id="and-10" maxlength="1"></td>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>1</td>
                                        <td><input type="text" id="and-11" maxlength="1"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- XOR Gate Truth Table -->
                        <div>
                            <h5>XOR Gate</h5>
                            <table class="truth-table">
                                <thead>
                                    <tr>
                                        <th>A</th>
                                        <th>B</th>
                                        <th>Output</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>0</td>
                                        <td>0</td>
                                        <td><input type="text" id="xor-00" maxlength="1"></td>
                                    </tr>
                                    <tr>
                                        <td>0</td>
                                        <td>1</td>
                                        <td><input type="text" id="xor-01" maxlength="1"></td>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>0</td>
                                        <td><input type="text" id="xor-10" maxlength="1"></td>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>1</td>
                                        <td><input type="text" id="xor-11" maxlength="1"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkTruthTables()" style="margin-top: 1rem;">
                        Check Answers
                    </button>
                    <button class="btn btn-secondary" onclick="showHint('truth-tables')">
                        Need a Hint?
                    </button>
                    
                    <div id="truth-tables-hint" class="hint-container">
                        <p>💡 Hint: AND outputs 1 only when both inputs are 1. XOR outputs 1 when inputs are different.</p>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousSection()">← Previous</button>
                    <button class="btn btn-primary" onclick="nextSection()">Next →</button>
                </div>
            </div>
        </section>

        <!-- Building Circuits Section -->
        <section id="circuits" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🔧</span> Building Logic Circuits
                </h2>
                
                <p>Logic circuits combine multiple gates to perform complex operations. Let's build some circuits!</p>
                
                <div class="interactive-area">
                    <h4>Circuit Building Challenge</h4>
                    <p>Build a circuit for: X = (A AND B) OR C</p>
                    
                    <!-- PLACEHOLDER FOR CIRCUIT BUILDER SIMULATION -->
                    <div style="background: var(--bg-color); border: 3px dashed var(--primary-color); border-radius: 1rem; padding: 3rem; text-align: center; min-height: 400px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">🔌</div>
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Circuit Builder Simulation</h3>
                        <p style="color: var(--text-secondary); max-width: 500px;">
                            An interactive circuit building simulation will be embedded here. 
                            Students will be able to drag and drop gates, connect wires, and test their circuits in real-time.
                        </p>
                        <div style="margin-top: 2rem; padding: 1rem; background: rgba(74, 144, 226, 0.1); border-radius: 0.5rem;">
                            <p><strong>Expected Features:</strong></p>
                            <ul style="text-align: left; margin: 0.5rem 0;">
                                <li>Drag & drop logic gates</li>
                                <li>Click to connect wires</li>
                                <li>Real-time circuit testing</li>
                                <li>Visual feedback for connections</li>
                                <li>Save/load circuit designs</li>
                            </ul>
                        </div>
                    </div>
                    <!-- END PLACEHOLDER -->
                </div>

                <div class="interactive-area">
                    <h4>Circuit Analysis</h4>
                    <p>What type of gate would you use to invert a signal?</p>
                    
                    <button class="quiz-option" onclick="checkCircuitQuiz('a')">AND</button>
                    <button class="quiz-option" onclick="checkCircuitQuiz('b')">OR</button>
                    <button class="quiz-option" onclick="checkCircuitQuiz('c')">NOT</button>
                    <button class="quiz-option" onclick="checkCircuitQuiz('d')">XOR</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousSection()">← Previous</button>
                    <button class="btn btn-primary" onclick="nextSection()">Next →</button>
                </div>
            </div>
        </section>

        <!-- Boolean Expressions Section -->
        <section id="expressions" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>✏️</span> Boolean Expressions
                </h2>
                
                <p>Boolean expressions represent logic circuits using mathematical notation.</p>
                
                <div class="interactive-area">
                    <h4>Expression Builder</h4>
                    <p>Build the expression: NOT(A AND B)</p>
                    
                    <div class="expression-builder" id="expression-area">
                        <!-- Tokens will be added here -->
                    </div>
                    
                    <div style="margin: 1rem 0;">
                        <button class="sim-btn" onclick="addToken('NOT')">NOT</button>
                        <button class="sim-btn" onclick="addToken('AND')">AND</button>
                        <button class="sim-btn" onclick="addToken('OR')">OR</button>
                        <button class="sim-btn" onclick="addToken('(')">(</button>
                        <button class="sim-btn" onclick="addToken(')')">)</button>
                        <button class="sim-btn" onclick="addToken('A')">A</button>
                        <button class="sim-btn" onclick="addToken('B')">B</button>
                        <button class="sim-btn" onclick="clearExpression()">Clear</button>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkExpression()">
                        Check Expression
                    </button>
                </div>

                <div class="interactive-area">
                    <h4>Expression Evaluation</h4>
                    <p>For the expression (A OR B) AND C, if A=1, B=0, C=1, what is the output?</p>
                    
                    <button class="quiz-option" onclick="checkExpressionQuiz('a')">0</button>
                    <button class="quiz-option" onclick="checkExpressionQuiz('b')">1</button>
                    <button class="quiz-option" onclick="checkExpressionQuiz('c')">Cannot determine</button>
                    <button class="quiz-option" onclick="checkExpressionQuiz('d')">Error</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousSection()">← Previous</button>
                    <button class="btn btn-primary" onclick="nextSection()">Next →</button>
                </div>
            </div>
        </section>

        <!-- Conversions Section -->
        <section id="conversions" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🔄</span> Converting Between Representations
                </h2>
                
                <p>You need to be able to convert between problem statements, logic circuits, truth tables, and Boolean expressions.</p>
                
                <div class="interactive-area">
                    <h4>Conversion Practice</h4>
                    <p>Given the problem: "The alarm sounds when the door is open AND motion is detected"</p>
                    
                    <h5>Write the Boolean expression:</h5>
                    <input type="text" class="input-field" id="conversion-expression" placeholder="Enter expression using D for door, M for motion, A for alarm">
                    
                    <h5>Complete the truth table:</h5>
                    <table class="truth-table" style="max-width: 400px; margin: 1rem auto;">
                        <thead>
                            <tr>
                                <th>Door (D)</th>
                                <th>Motion (M)</th>
                                <th>Alarm (A)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td><input type="text" id="conv-00" maxlength="1"></td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>1</td>
                                <td><input type="text" id="conv-01" maxlength="1"></td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>0</td>
                                <td><input type="text" id="conv-10" maxlength="1"></td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>1</td>
                                <td><input type="text" id="conv-11" maxlength="1"></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <button class="btn btn-primary" onclick="checkConversion()">
                        Check Answers
                    </button>
                    <button class="btn btn-secondary" onclick="resetConversion()">
                        Reset
                    </button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousSection()">← Previous</button>
                    <button class="btn btn-primary" onclick="nextSection()">Next →</button>
                </div>
            </div>
        </section>

        <!-- Exam Practice Section -->
        <section id="practice" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>📝</span> Exam Practice Questions
                </h2>
                
                <div class="interactive-area">
                    <h4>Question 1 (4 marks)</h4>
                    <p>Draw a logic circuit for the expression: X = NOT((A AND B) OR (C AND D))</p>
                    
                    <canvas id="drawing-canvas" width="600" height="300"></canvas>
                    <button class="btn btn-secondary" onclick="clearCanvas()">Clear Canvas</button>
                    
                    <div style="margin-top: 1rem;">
                        <label>Your predicted marks (0-4): 
                            <input type="number" id="q1-marks" min="0" max="4" style="width: 50px;">
                        </label>
                        <button class="btn btn-success" onclick="showMarkScheme('q1')">
                            Show Mark Scheme
                        </button>
                    </div>
                    
                    <div id="mark-scheme-q1" class="mark-scheme">
                        <h4>Mark Scheme:</h4>
                        <ul>
                            <li>Two AND gates with correct inputs (1 mark)</li>
                            <li>OR gate combining AND outputs (1 mark)</li>
                            <li>NOT gate on final output (1 mark)</li>
                            <li>Correct connections and labels (1 mark)</li>
                        </ul>
                    </div>
                </div>

                <div class="interactive-area">
                    <h4>Question 2 (3 marks)</h4>
                    <p>Complete the truth table for a NOR gate:</p>
                    
                    <table class="truth-table" style="max-width: 300px; margin: 1rem auto;">
                        <thead>
                            <tr>
                                <th>A</th>
                                <th>B</th>
                                <th>Output</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td><input type="text" id="exam-00" maxlength="1"></td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>1</td>
                                <td><input type="text" id="exam-01" maxlength="1"></td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>0</td>
                                <td><input type="text" id="exam-10" maxlength="1"></td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>1</td>
                                <td><input type="text" id="exam-11" maxlength="1"></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 1rem;">
                        <label>Your predicted marks (0-3): 
                            <input type="number" id="q2-marks" min="0" max="3" style="width: 50px;">
                        </label>
                        <button class="btn btn-success" onclick="showMarkScheme('q2')">
                            Show Mark Scheme
                        </button>
                    </div>
                    
                    <div id="mark-scheme-q2" class="mark-scheme">
                        <h4>Mark Scheme:</h4>
                        <ul>
                            <li>Output = 1 when A=0, B=0 (1 mark)</li>
                            <li>Output = 0 for all other combinations (2 marks)</li>
                        </ul>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousSection()">← Previous</button>
                    <button class="btn btn-primary" onclick="nextSection()">Next →</button>
                </div>
            </div>
        </section>

        <!-- Extension Section -->
        <section id="extension" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🌟</span> Extension Activities
                </h2>
                
                <div class="extension-task">
                    <h4>Half Adder Circuit</h4>
                    <p>Research and explain how a half adder circuit works. Include:</p>
                    <ul>
                        <li>The logic gates used</li>
                        <li>The truth table</li>
                        <li>Real-world applications</li>
                    </ul>
                    
                    <textarea class="input-field" rows="6" id="extension-1" placeholder="Write your explanation here..."></textarea>
                </div>

                <div class="extension-task">
                    <h4>De Morgan's Laws</h4>
                    <p>Investigate De Morgan's Laws and show how they can be used to simplify Boolean expressions. Provide examples.</p>
                    
                    <textarea class="input-field" rows="6" id="extension-2" placeholder="Write your investigation here..."></textarea>
                </div>

                <button class="btn btn-primary" onclick="submitExtension()">
                    Submit Extension Work
                </button>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousSection()">← Previous</button>
                    <button class="btn btn-primary" onclick="nextSection()">Next →</button>
                </div>
            </div>
        </section>

        <!-- Summary Quiz Section -->
        <section id="summary" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>✅</span> Summary Quiz
                </h2>
                
                <p>Test your understanding of logic gates and circuits!</p>
                
                <div class="interactive-area">
                    <div id="summary-quiz">
                        <!-- Question 1 -->
                        <div style="margin-bottom: 2rem;">
                            <h4>Question 1</h4>
                            <p>Which gate outputs 0 when both inputs are 1?</p>
                            <button class="quiz-option" onclick="selectQuizAnswer(1, 'a')">AND</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(1, 'b')">NAND</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(1, 'c')">OR</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(1, 'd')">XOR</button>
                        </div>
                        
                        <!-- Question 2 -->
                        <div style="margin-bottom: 2rem;">
                            <h4>Question 2</h4>
                            <p>The Boolean expression for a NOR gate is:</p>
                            <button class="quiz-option" onclick="selectQuizAnswer(2, 'a')">A + B</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(2, 'b')">NOT(A + B)</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(2, 'c')">A · B</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(2, 'd')">NOT(A · B)</button>
                        </div>
                        
                        <!-- Question 3 -->
                        <div style="margin-bottom: 2rem;">
                            <h4>Question 3</h4>
                            <p>How many input combinations does a 3-input truth table have?</p>
                            <button class="quiz-option" onclick="selectQuizAnswer(3, 'a')">3</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(3, 'b')">6</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(3, 'c')">8</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(3, 'd')">9</button>
                        </div>
                        
                        <!-- Question 4 -->
                        <div style="margin-bottom: 2rem;">
                            <h4>Question 4</h4>
                            <p>Which gate is equivalent to NOT(A AND B)?</p>
                            <button class="quiz-option" onclick="selectQuizAnswer(4, 'a')">OR</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(4, 'b')">NOR</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(4, 'c')">NAND</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(4, 'd')">XOR</button>
                        </div>
                        
                        <!-- Question 5 -->
                        <div style="margin-bottom: 2rem;">
                            <h4>Question 5</h4>
                            <p>For XOR gate, the output is 1 when:</p>
                            <button class="quiz-option" onclick="selectQuizAnswer(5, 'a')">Both inputs are 1</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(5, 'b')">Both inputs are 0</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(5, 'c')">Inputs are different</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(5, 'd')">At least one input is 1</button>
                        </div>
                        
                        <!-- Question 6 -->
                        <div style="margin-bottom: 2rem;">
                            <h4>Question 6</h4>
                            <p>The NOT gate has how many inputs?</p>
                            <button class="quiz-option" onclick="selectQuizAnswer(6, 'a')">0</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(6, 'b')">1</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(6, 'c')">2</button>
                            <button class="quiz-option" onclick="selectQuizAnswer(6, 'd')">Variable</button>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="submitSummaryQuiz()">
                        Submit Quiz
                    </button>
                    
                    <div id="quiz-results" style="display: none; margin-top: 2rem;">
                        <h4>Your Results:</h4>
                        <p id="quiz-score"></p>
                        <div id="quiz-feedback"></div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousSection()">← Previous</button>
                    <button class="btn btn-primary" onclick="nextSection()">Next →</button>
                </div>
            </div>
        </section>

        <!-- Videos Section -->
        <section id="videos" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🎬</span> Video Resources
                </h2>
                
                <div class="interactive-area">
                    <p>Your teacher will add helpful video links here to support your learning.</p>
                    
                    <div style="background: var(--bg-color); padding: 3rem; text-align: center; border-radius: 0.5rem; margin: 2rem 0;">
                        <p style="font-size: 3rem;">📹</p>
                        <p>Video content will be added here</p>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousSection()">← Previous</button>
                    <button class="btn btn-primary" onclick="goToSection('intro')">Start Over</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievement-popup">
        <div class="achievement-icon">🏆</div>
        <h3 id="achievement-title">Achievement Unlocked!</h3>
        <p id="achievement-desc">Description</p>
    </div>

    <!-- Shame Message -->
    <div class="shame-message" id="shame-message">
        🚫 No pasting allowed! Do your own work! 🚫
    </div>

    <!-- Feedback Button -->
    <button class="feedback-btn" onclick="openFeedback()" aria-label="Send feedback">
        💬
    </button>

    <!-- Feedback Modal -->
    <div class="feedback-modal" id="feedback-modal">
        <div class="feedback-content">
            <h3>Send Feedback</h3>
            <p>Found a bug or have a suggestion? Let us know!</p>
            <p style="font-size: 0.9rem; color: #666;">Current page: <span id="feedback-page"></span></p>
            <textarea class="input-field" id="feedback-text" rows="5" placeholder="Describe the issue or suggestion..."></textarea>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="closeFeedback()">Cancel</button>
                <button class="btn btn-primary" onclick="sendFeedback()">Send</button>
            </div>
        </div>
    </div>

    <!-- Accessibility Controls -->
    <div class="accessibility-controls">
        <h4>Accessibility</h4>
        <button onclick="toggleHighContrast()">High Contrast</button>
        <button onclick="toggleDyslexiaFont()">Dyslexia Font</button>
        <button onclick="changeFontSize('small')">A-</button>
        <button onclick="changeFontSize('normal')">A</button>
        <button onclick="changeFontSize('large')">A+</button>
    </div>

    <script>
        // Game State
        let gameState = {
            xp: 0,
            level: 1,
            completedSections: [],
            achievements: [],
            currentSection: 'intro',
            selectedItems: {},
            quizAnswers: {},
            starterAnswers: {
                'item1': 'and',
                'item2': 'or',
                'item3': 'not',
                'item4': 'combined'
            },
            actionsPerformed: new Set(),
            hintUsed: {}
        };

        // XP Requirements
        const XP_PER_LEVEL = [0, 100, 250, 450, 700, 1000];

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeLesson();
            setupEventListeners();
            selectGateSimulation('not'); // Start with NOT gate
            updateXPDisplay();
            updateFeedbackPage();
        });

        // Initialize lesson
        function initializeLesson() {
            // Set up navigation
            document.querySelectorAll('.nav-pill').forEach(pill => {
                pill.addEventListener('click', function() {
                    goToSection(this.dataset.section);
                });
            });

            // Initialize canvas
            initializeCanvas();
            
            // Prevent paste
            document.addEventListener('paste', function(e) {
                e.preventDefault();
                showShameMessage();
                return false;
            });

            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowLeft') previousSection();
                if (e.key === 'ArrowRight') nextSection();
                if (e.ctrlKey && e.key === 'v') {
                    e.preventDefault();
                    showShameMessage();
                }
            });
        }

        // Navigation functions
        function goToSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                gameState.currentSection = sectionId;
                
                // Update navigation
                document.querySelectorAll('.nav-pill').forEach(pill => {
                    pill.classList.remove('active');
                    if (pill.dataset.section === sectionId) {
                        pill.classList.add('active');
                    }
                });
                
                // Mark section as visited
                if (!gameState.completedSections.includes(sectionId)) {
                    awardXP(5, 'Explored new section');
                }
                
                updateFeedbackPage();
                window.scrollTo(0, 0);
            }
        }

        function nextSection() {
            const sections = Array.from(document.querySelectorAll('.nav-pill')).map(p => p.dataset.section);
            const currentIndex = sections.indexOf(gameState.currentSection);
            if (currentIndex < sections.length - 1) {
                goToSection(sections[currentIndex + 1]);
            }
        }

        function previousSection() {
            const sections = Array.from(document.querySelectorAll('.nav-pill')).map(p => p.dataset.section);
            const currentIndex = sections.indexOf(gameState.currentSection);
            if (currentIndex > 0) {
                goToSection(sections[currentIndex - 1]);
            }
        }

        // XP System
        function awardXP(amount, action, actionId = null) {
            // Prevent duplicate XP for same action
            if (actionId && gameState.actionsPerformed.has(actionId)) {
                return;
            }
            
            if (actionId) {
                gameState.actionsPerformed.add(actionId);
            }
            
            gameState.xp += amount;
            updateXPDisplay();
            checkLevelUp();
            
            // Show floating XP
            showFloatingXP(amount);
        }

        function updateXPDisplay() {
            const xpForNextLevel = XP_PER_LEVEL[gameState.level] || XP_PER_LEVEL[XP_PER_LEVEL.length - 1];
            const xpProgress = (gameState.xp / xpForNextLevel) * 100;
            
            document.getElementById('xp-fill').style.width = xpProgress + '%';
            document.getElementById('xp-text').textContent = gameState.xp + ' / ' + xpForNextLevel + ' XP';
            document.getElementById('current-level').textContent = gameState.level;
        }

        function checkLevelUp() {
            if (gameState.level < 5 && gameState.xp >= XP_PER_LEVEL[gameState.level]) {
                gameState.level++;
                showAchievement('Level Up!', 'You reached Level ' + gameState.level + '!');
                createParticleEffect();
            }
        }

        function showFloatingXP(amount) {
            const xpFloat = document.createElement('div');
            xpFloat.style.cssText = `
                position: fixed;
                top: 100px;
                right: 150px;
                color: #f39c12;
                font-weight: bold;
                font-size: 1.5rem;
                pointer-events: none;
                z-index: 3000;
                animation: floatUp 2s ease-out forwards;
            `;
            xpFloat.textContent = '+' + amount + ' XP';
            document.body.appendChild(xpFloat);
            
            setTimeout(() => xpFloat.remove(), 2000);
        }

        // Add floating animation style
        const style = document.createElement('style');
        style.textContent = `
            @keyframes floatUp {
                0% { transform: translateY(0); opacity: 1; }
                100% { transform: translateY(-50px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Achievement System
        function showAchievement(title, desc) {
            const popup = document.getElementById('achievement-popup');
            document.getElementById('achievement-title').textContent = title;
            document.getElementById('achievement-desc').textContent = desc;
            
            popup.classList.add('show');
            setTimeout(() => popup.classList.remove('show'), 3000);
            
            awardXP(50, 'Achievement');
        }

        function checkAchievements() {
            // First correct answer
            if (!gameState.achievements.includes('first_correct') && gameState.actionsPerformed.has('correct_answer')) {
                gameState.achievements.push('first_correct');
                showAchievement('First Steps', 'Got your first correct answer!');
            }
            
            // Gate Master
            if (!gameState.achievements.includes('gate_master') && 
                ['not', 'and', 'or', 'nand', 'nor', 'xor'].every(gate => 
                    gameState.actionsPerformed.has('learned_' + gate))) {
                gameState.achievements.push('gate_master');
                showAchievement('Gate Master', 'Learned all 6 logic gates!');
            }
            
            // Truth Table Expert
            if (!gameState.achievements.includes('truth_expert') && 
                gameState.actionsPerformed.has('truth_tables_complete')) {
                gameState.achievements.push('truth_expert');
                showAchievement('Truth Table Expert', 'Mastered truth tables!');
            }
        }

        // Particle Effects
        function createParticleEffect() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle star';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = '100px';
                    document.body.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 2000);
                }, i * 100);
            }
        }

        // Shame Message
        function showShameMessage() {
            const shame = document.getElementById('shame-message');
            shame.style.display = 'block';
            
            // Lose XP for trying to paste
            gameState.xp = Math.max(0, gameState.xp - 10);
            updateXPDisplay();
            
            setTimeout(() => shame.style.display = 'none', 3000);
        }

        // Starter Activity Functions
        function selectItem(activity, itemId) {
            const items = document.querySelectorAll(`#${activity} .draggable-item`);
            items.forEach(item => item.classList.remove('selected'));
            
            const selectedItem = event.target;
            selectedItem.classList.add('selected');
            gameState.selectedItems[activity] = itemId;
        }

        function dropItem(activity, dropZone) {
            const selectedId = gameState.selectedItems[activity];
            if (!selectedId) return;
            
            const selectedItem = document.querySelector(`#${activity} .draggable-item.selected`);
            if (!selectedItem) return;
            
            const dropArea = document.getElementById(`${activity}-${dropZone}-items`);
            dropArea.appendChild(selectedItem.cloneNode(true));
            selectedItem.style.display = 'none';
            
            // Visual feedback
            event.target.classList.add('highlight');
            setTimeout(() => event.target.classList.remove('highlight'), 500);
        }

        function resetActivity(activity) {
            // Reset draggable items
            document.querySelectorAll(`#${activity} .draggable-item`).forEach(item => {
                item.style.display = 'block';
                item.classList.remove('selected');
            });
            
            // Clear drop zones
            document.querySelectorAll(`#${activity} [id$="-items"]`).forEach(zone => {
                zone.innerHTML = '';
            });
            
            gameState.selectedItems[activity] = null;
        }

        function checkStarterActivity() {
            let correct = 0;
            const total = 4;
            
            // Check each answer
            Object.keys(gameState.starterAnswers).forEach(itemId => {
                const expectedZone = gameState.starterAnswers[itemId];
                const dropZone = document.getElementById(`starter-${expectedZone}-items`);
                
                if (dropZone && dropZone.textContent.includes(document.querySelector(`[onclick*="${itemId}"]`).textContent)) {
                    correct++;
                }
            });
            
            if (correct === total) {
                awardXP(30, 'Starter activity completed', 'starter_complete');
                markSectionComplete('starter');
                alert('Perfect! You understand the basic logic concepts.');
            } else {
                alert(`You got ${correct} out of ${total} correct. Try again!`);
            }
        }

        // Quiz Functions
        function checkIntroQuiz(answer) {
            const options = document.querySelectorAll('#intro .quiz-option');
            options.forEach(opt => opt.classList.remove('correct', 'incorrect'));
            
            if (answer === 'b') {
                options[1].classList.add('correct');
                awardXP(10, 'Correct answer', 'intro_quiz');
                gameState.actionsPerformed.add('correct_answer');
                checkAchievements();
            } else {
                event.target.classList.add('incorrect');
                options[1].classList.add('correct');
            }
        }

        function checkGateQuiz(answer) {
            const options = document.querySelectorAll('#gates .quiz-option');
            options.forEach(opt => opt.classList.remove('correct', 'incorrect'));
            
            if (answer === 'c') {
                options[2].classList.add('correct');
                awardXP(10, 'Gate quiz correct', 'gate_quiz');
            } else {
                event.target.classList.add('incorrect');
                options[2].classList.add('correct');
            }
        }

        function checkSimQuiz(answer) {
            const options = document.querySelectorAll('#simulations .quiz-option');
            options.forEach(opt => opt.classList.remove('correct', 'incorrect'));
            
            if (answer === 'a') {
                options[0].classList.add('correct');
                awardXP(10, 'Simulation quiz correct', 'sim_quiz');
            } else {
                event.target.classList.add('incorrect');
                options[0].classList.add('correct');
            }
        }

        function checkCircuitQuiz(answer) {
            const options = document.querySelectorAll('#circuits .quiz-option');
            options.forEach(opt => opt.classList.remove('correct', 'incorrect'));
            
            if (answer === 'c') {
                options[2].classList.add('correct');
                awardXP(10, 'Circuit quiz correct', 'circuit_quiz');
            } else {
                event.target.classList.add('incorrect');
                options[2].classList.add('correct');
            }
        }

        function checkExpressionQuiz(answer) {
            const options = document.querySelectorAll('#expressions .quiz-option');
            options.forEach(opt => opt.classList.remove('correct', 'incorrect'));
            
            if (answer === 'b') {
                options[1].classList.add('correct');
                awardXP(10, 'Expression quiz correct', 'expr_quiz');
            } else {
                event.target.classList.add('incorrect');
                options[1].classList.add('correct');
            }
        }

        // Gate Information
        function showGateInfo(gate) {
            const info = {
                'not': {
                    name: 'NOT Gate',
                    description: 'Inverts the input. If input is 0, output is 1. If input is 1, output is 0.',
                    symbol: '¬ or NOT',
                    truthTable: [[0,1], [1,0]]
                },
                'and': {
                    name: 'AND Gate',
                    description: 'Outputs 1 only when ALL inputs are 1. Otherwise outputs 0.',
                    symbol: '· or AND',
                    truthTable: [[0,0,0], [0,1,0], [1,0,0], [1,1,1]]
                },
                'or': {
                    name: 'OR Gate',
                    description: 'Outputs 1 when AT LEAST ONE input is 1. Only outputs 0 when all inputs are 0.',
                    symbol: '+ or OR',
                    truthTable: [[0,0,0], [0,1,1], [1,0,1], [1,1,1]]
                },
                'nand': {
                    name: 'NAND Gate',
                    description: 'NOT AND. Outputs 0 only when all inputs are 1. Otherwise outputs 1.',
                    symbol: '¬(A·B) or NAND',
                    truthTable: [[0,0,1], [0,1,1], [1,0,1], [1,1,0]]
                },
                'nor': {
                    name: 'NOR Gate',
                    description: 'NOT OR. Outputs 1 only when all inputs are 0. Otherwise outputs 0.',
                    symbol: '¬(A+B) or NOR',
                    truthTable: [[0,0,1], [0,1,0], [1,0,0], [1,1,0]]
                },
                'xor': {
                    name: 'XOR Gate',
                    description: 'Exclusive OR. Outputs 1 when inputs are DIFFERENT. Outputs 0 when inputs are the same.',
                    symbol: '⊕ or XOR',
                    truthTable: [[0,0,0], [0,1,1], [1,0,1], [1,1,0]]
                }
            };
            
            const gateData = info[gate];
            const infoDiv = document.getElementById('gate-info');
            
            infoDiv.innerHTML = `
                <h4>${gateData.name}</h4>
                <p>${gateData.description}</p>
                <p><strong>Symbol:</strong> ${gateData.symbol}</p>
            `;
            
            infoDiv.style.display = 'block';
            
            awardXP(5, 'Learned about ' + gate, 'learned_' + gate);
            checkAchievements();
        }

        // Gate Simulation
        let currentSimulation = {
            gate: 'not',
            inputs: { A: 0, B: 0 },
            output: 1
        };

        function selectGateSimulation(gate) {
            currentSimulation.gate = gate;
            currentSimulation.inputs = { A: 0, B: 0 };
            updateSimulation();
            
            // Update button states
            document.querySelectorAll('.simulation-controls .sim-btn').forEach(btn => {
                btn.style.background = btn.textContent.toLowerCase() === gate ? '#2ecc71' : '';
            });
        }

        function updateSimulation() {
            const simDiv = document.getElementById('gate-simulation');
            const gate = currentSimulation.gate;
            const inputs = currentSimulation.inputs;
            
            // Calculate output based on gate type
            let output = 0;
            switch(gate) {
                case 'not':
                    output = inputs.A === 0 ? 1 : 0;
                    break;
                case 'and':
                    output = inputs.A === 1 && inputs.B === 1 ? 1 : 0;
                    break;
                case 'or':
                    output = inputs.A === 1 || inputs.B === 1 ? 1 : 0;
                    break;
                case 'nand':
                    output = !(inputs.A === 1 && inputs.B === 1) ? 1 : 0;
                    break;
                case 'nor':
                    output = !(inputs.A === 1 || inputs.B === 1) ? 1 : 0;
                    break;
                case 'xor':
                    output = inputs.A !== inputs.B ? 1 : 0;
                    break;
            }
            
            currentSimulation.output = output;
            
            // Create simulation HTML
            let html = `<div class="sim-highlight">`;
            
            if (gate === 'not') {
                html += `
                    <div style="display: flex; align-items: center; justify-content: center; gap: 2rem;">
                        <div>
                            <p>Input A:</p>
                            <div class="input-indicator ${inputs.A === 1 ? 'one' : 'zero'}" 
                                 onclick="toggleInput('A')">${inputs.A}</div>
                        </div>
                        <div style="font-size: 2rem;">→</div>
                        <div class="gate-body" style="display: inline-block;">${gate.toUpperCase()}</div>
                        <div style="font-size: 2rem;">→</div>
                        <div>
                            <p>Output:</p>
                            <div class="output-display ${output === 1 ? 'one' : 'zero'}">${output}</div>
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div style="display: flex; align-items: center; justify-content: center; gap: 2rem;">
                        <div>
                            <p>Input A:</p>
                            <div class="input-indicator ${inputs.A === 1 ? 'one' : 'zero'}" 
                                 onclick="toggleInput('A')">${inputs.A}</div>
                            <p style="margin-top: 1rem;">Input B:</p>
                            <div class="input-indicator ${inputs.B === 1 ? 'one' : 'zero'}" 
                                 onclick="toggleInput('B')">${inputs.B}</div>
                        </div>
                        <div style="font-size: 2rem;">→</div>
                        <div class="gate-body" style="display: inline-block;">${gate.toUpperCase()}</div>
                        <div style="font-size: 2rem;">→</div>
                        <div>
                            <p>Output:</p>
                            <div class="output-display ${output === 1 ? 'one' : 'zero'}">${output}</div>
                        </div>
                    </div>
                `;
            }
            
            html += `</div>`;
            simDiv.innerHTML = html;
        }

        function toggleInput(input) {
            currentSimulation.inputs[input] = currentSimulation.inputs[input] === 0 ? 1 : 0;
            updateSimulation();
            awardXP(2, 'Experimented with simulation', 'sim_experiment_' + currentSimulation.gate);
        }

        function resetSimulation() {
            currentSimulation.inputs = { A: 0, B: 0 };
            updateSimulation();
        }

        // Truth Table Functions
        function checkTruthTables() {
            const andAnswers = { '00': '0', '01': '0', '10': '0', '11': '1' };
            const xorAnswers = { '00': '0', '01': '1', '10': '1', '11': '0' };
            
            let andCorrect = 0;
            let xorCorrect = 0;
            
            // Check AND table
            Object.keys(andAnswers).forEach(key => {
                const input = document.getElementById('and-' + key);
                if (input.value === andAnswers[key]) {
                    input.classList.add('correct');
                    input.classList.remove('incorrect');
                    andCorrect++;
                } else {
                    input.classList.add('incorrect');
                    input.classList.remove('correct');
                }
            });
            
            // Check XOR table
            Object.keys(xorAnswers).forEach(key => {
                const input = document.getElementById('xor-' + key);
                if (input.value === xorAnswers[key]) {
                    input.classList.add('correct');
                    input.classList.remove('incorrect');
                    xorCorrect++;
                } else {
                    input.classList.add('incorrect');
                    input.classList.remove('correct');
                }
            });
            
            if (andCorrect === 4 && xorCorrect === 4) {
                awardXP(40, 'Truth tables completed', 'truth_tables_complete');
                markSectionComplete('truth-tables');
                checkAchievements();
                alert('Perfect! You understand truth tables.');
            } else {
                alert(`AND: ${andCorrect}/4 correct, XOR: ${xorCorrect}/4 correct. Keep trying!`);
            }
        }

        // Expression Builder
        let expressionTokens = [];

        function addToken(token) {
            expressionTokens.push(token);
            updateExpressionDisplay();
        }

        function clearExpression() {
            expressionTokens = [];
            updateExpressionDisplay();
        }

        function updateExpressionDisplay() {
            const area = document.getElementById('expression-area');
            area.innerHTML = expressionTokens.map(token => {
                let className = 'expression-token';
                if (['AND', 'OR', 'NOT'].includes(token)) className += ' operator';
                if (['A', 'B', 'C', 'D'].includes(token)) className += ' variable';
                return `<span class="${className}">${token}</span>`;
            }).join('');
        }

        function checkExpression() {
            const expected = ['NOT', '(', 'A', 'AND', 'B', ')'];
            const userExpression = expressionTokens.join('');
            const expectedExpression = expected.join('');
            
            if (userExpression === expectedExpression) {
                awardXP(30, 'Expression built correctly', 'expression_builder');
                markSectionComplete('expressions');
                alert('Correct! You built the expression NOT(A AND B)');
            } else {
                alert('Not quite right. The expression should be: NOT(A AND B)');
            }
        }

        // Conversion Practice
        function checkConversion() {
            const expression = document.getElementById('conversion-expression').value.trim().toUpperCase();
            const truthTableAnswers = { '00': '0', '01': '0', '10': '0', '11': '1' };
            
            let expressionCorrect = false;
            let tableCorrect = 0;
            
            // Check expression (accept various formats)
            const acceptableExpressions = ['A = D AND M', 'A=D AND M', 'A = D·M', 'A=D·M', 'A = D * M', 'A=D*M'];
            if (acceptableExpressions.some(expr => expression.includes(expr.replace(/\s/g, '')))) {
                expressionCorrect = true;
                document.getElementById('conversion-expression').classList.add('success');
            } else {
                document.getElementById('conversion-expression').classList.add('error');
            }
            
            // Check truth table
            Object.keys(truthTableAnswers).forEach(key => {
                const input = document.getElementById('conv-' + key);
                if (input.value === truthTableAnswers[key]) {
                    input.classList.add('correct');
                    tableCorrect++;
                } else {
                    input.classList.add('incorrect');
                }
            });
            
            if (expressionCorrect && tableCorrect === 4) {
                awardXP(40, 'Conversion mastered', 'conversion_complete');
                markSectionComplete('conversions');
                alert('Excellent! You can convert between different representations.');
            } else {
                alert(`Expression: ${expressionCorrect ? 'Correct' : 'Incorrect'}, Truth table: ${tableCorrect}/4 correct`);
            }
        }

        function resetConversion() {
            document.getElementById('conversion-expression').value = '';
            document.getElementById('conversion-expression').classList.remove('success', 'error');
            ['00', '01', '10', '11'].forEach(key => {
                const input = document.getElementById('conv-' + key);
                input.value = '';
                input.classList.remove('correct', 'incorrect');
            });
        }

        // Circuit Builder Functions (Simplified)
        let circuitElements = [];

        function addGate(type) {
            // Simplified circuit building
            circuitElements.push({ type: type, x: Math.random() * 400 + 100, y: Math.random() * 200 + 50 });
            drawCircuit();
            awardXP(5, 'Added gate to circuit', 'circuit_add_' + type);
        }

        function addWire() {
            // Simplified wire adding
            alert('Click two connection points to add a wire');
        }

        function clearCircuit() {
            circuitElements = [];
            drawCircuit();
        }

        function drawCircuit() {
            const svg = document.getElementById('circuit-svg');
            svg.innerHTML = circuitElements.map(elem => {
                return `<rect x="${elem.x}" y="${elem.y}" width="80" height="60" 
                         fill="${elem.type === 'and' ? '#3498db' : '#2ecc71'}" 
                         stroke="#2c3e50" stroke-width="2" rx="5">
                        </rect>
                        <text x="${elem.x + 40}" y="${elem.y + 35}" 
                         text-anchor="middle" fill="white" font-weight="bold">
                         ${elem.type.toUpperCase()}
                        </text>`;
            }).join('');
        }

        // Exam Practice Functions
        function showMarkScheme(question) {
            const marksInput = document.getElementById(question + '-marks');
            const marks = parseInt(marksInput.value) || 0;
            
            if (marks === 0) {
                alert('Please enter your predicted marks first');
                return;
            }
            
            document.getElementById('mark-scheme-' + question).classList.add('show');
            awardXP(20, 'Attempted exam question', 'exam_' + question);
        }

        // Canvas Functions
        function initializeCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            function getCoordinates(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                if (e.touches) {
                    return {
                        x: (e.touches[0].clientX - rect.left) * scaleX,
                        y: (e.touches[0].clientY - rect.top) * scaleY
                    };
                } else {
                    return {
                        x: (e.clientX - rect.left) * scaleX,
                        y: (e.clientY - rect.top) * scaleY
                    };
                }
            }
            
            function startDrawing(e) {
                isDrawing = true;
                const coords = getCoordinates(e);
                lastX = coords.x;
                lastY = coords.y;
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                const coords = getCoordinates(e);
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(coords.x, coords.y);
                ctx.stroke();
                
                lastX = coords.x;
                lastY = coords.y;
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
            
            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            canvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                startDrawing(e);
            });
            canvas.addEventListener('touchmove', function(e) {
                e.preventDefault();
                draw(e);
            });
            canvas.addEventListener('touchend', function(e) {
                e.preventDefault();
                stopDrawing();
            });
        }

        function clearCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Extension Activities
        function submitExtension() {
            const ext1 = document.getElementById('extension-1').value;
            const ext2 = document.getElementById('extension-2').value;
            
            const keywords1 = ['half adder', 'sum', 'carry', 'xor', 'and'];
            const keywords2 = ['de morgan', 'not(a and b)', 'not a or not b', 'simplify'];
            
            let score = 0;
            
            // Check extension 1
            keywords1.forEach(keyword => {
                if (ext1.toLowerCase().includes(keyword)) score += 10;
            });
            
            // Check extension 2
            keywords2.forEach(keyword => {
                if (ext2.toLowerCase().includes(keyword)) score += 10;
            });
            
            // Bonus for length
            if (ext1.length > 100) score += 20;
            if (ext2.length > 100) score += 20;
            
            awardXP(Math.min(score, 100), 'Extension activities', 'extension_complete');
            markSectionComplete('extension');
            alert('Extension work submitted! Your teacher will review your responses.');
        }

        // Summary Quiz
        const quizCorrectAnswers = {
            1: 'b', // NAND
            2: 'b', // NOT(A + B)
            3: 'c', // 8
            4: 'c', // NAND
            5: 'c', // Inputs are different
            6: 'b'  // 1
        };

        function selectQuizAnswer(question, answer) {
            // Mark selected
            const options = document.querySelectorAll(`#summary-quiz div:nth-child(${question}) .quiz-option`);
            options.forEach(opt => opt.classList.remove('selected'));
            event.target.classList.add('selected');
            
            gameState.quizAnswers[question] = answer;
        }

        function submitSummaryQuiz() {
            let correct = 0;
            const feedback = [];
            
            Object.keys(quizCorrectAnswers).forEach(q => {
                if (gameState.quizAnswers[q] === quizCorrectAnswers[q]) {
                    correct++;
                } else {
                    const topics = {
                        1: 'NAND outputs 0 when both inputs are 1',
                        2: 'NOR = NOT(A + B) in Boolean notation',
                        3: '3 inputs = 2³ = 8 combinations',
                        4: 'NAND = NOT(A AND B)',
                        5: 'XOR outputs 1 when inputs differ',
                        6: 'NOT gate has exactly 1 input'
                    };
                    feedback.push(`Q${q}: ${topics[q]}`);
                }
            });
            
            const score = Math.round((correct / 6) * 100);
            document.getElementById('quiz-score').textContent = `You scored ${correct}/6 (${score}%)`;
            
            const feedbackDiv = document.getElementById('quiz-feedback');
            if (feedback.length > 0) {
                feedbackDiv.innerHTML = '<h5>Review these topics:</h5><ul>' + 
                    feedback.map(f => `<li>${f}</li>`).join('') + '</ul>';
            } else {
                feedbackDiv.innerHTML = '<p style="color: var(--success-color);">Perfect score! Well done!</p>';
            }
            
            document.getElementById('quiz-results').style.display = 'block';
            
            awardXP(correct * 15, 'Summary quiz', 'summary_quiz');
            markSectionComplete('summary');
            
            if (correct === 6) {
                showAchievement('Quiz Master', 'Perfect score on the summary quiz!');
            }
        }

        // Hint System
        function showHint(section) {
            const hint = document.getElementById(section + '-hint');
            if (hint) {
                hint.classList.add('show');
                // Reduce XP for using hint (only once per hint)
                if (!gameState.hintUsed[section]) {
                    gameState.xp = Math.max(0, gameState.xp - 5);
                    updateXPDisplay();
                    gameState.hintUsed[section] = true;
                }
            }
        }

        // Section Completion
        function markSectionComplete(section) {
            if (!gameState.completedSections.includes(section)) {
                gameState.completedSections.push(section);
                
                // Update navigation
                const pill = document.querySelector(`[data-section="${section}"]`);
                if (pill) {
                    pill.classList.add('completed');
                }
                
                // Check for completion achievement
                if (gameState.completedSections.length === 10) {
                    showAchievement('Course Complete!', 'Completed all main sections!');
                }
            }
        }

        // Feedback System
        function openFeedback() {
            document.getElementById('feedback-modal').style.display = 'flex';
        }

        function closeFeedback() {
            document.getElementById('feedback-modal').style.display = 'none';
            document.getElementById('feedback-text').value = '';
        }

        function updateFeedbackPage() {
            const sectionNames = {
                'intro': 'Introduction',
                'starter': 'Starter Activity',
                'gates': 'Logic Gates',
                'simulations': 'Gate Simulations',
                'truth-tables': 'Truth Tables',
                'circuits': 'Building Circuits',
                'expressions': 'Boolean Expressions',
                'conversions': 'Conversions',
                'practice': 'Exam Practice',
                'extension': 'Extension',
                'summary': 'Summary Quiz',
                'videos': 'Videos'
            };
            
            document.getElementById('feedback-page').textContent = 
                sectionNames[gameState.currentSection] || gameState.currentSection;
        }

        function sendFeedback() {
            const text = document.getElementById('feedback-text').value;
            if (!text.trim()) {
                alert('Please enter your feedback');
                return;
            }
            
            const subject = encodeURIComponent('Logic Gates Lesson Feedback');
            const body = encodeURIComponent(
                `Page: ${document.getElementById('feedback-page').textContent}\n\n` +
                `Feedback: ${text}\n\n` +
                `Section: ${gameState.currentSection}\n` +
                `XP: ${gameState.xp}, Level: ${gameState.level}`
            );
            
            window.location.href = `mailto:millingtond@mgs.org?subject=${subject}&body=${body}`;
            closeFeedback();
            awardXP(5, 'Feedback sent', 'feedback');
        }

        // Accessibility Functions
        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
        }

        function toggleDyslexiaFont() {
            document.body.classList.toggle('dyslexia-font');
        }

        function changeFontSize(size) {
            document.body.classList.remove('font-small', 'font-large', 'font-xlarge');
            if (size !== 'normal') {
                document.body.classList.add('font-' + size);
            }
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Close feedback modal on outside click
            document.getElementById('feedback-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeFeedback();
                }
            });
            
            // Prevent form submission on enter
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.target.tagName === 'INPUT') {
                    e.preventDefault();
                }
            });
        }

        // Easter Egg
        let konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let konamiIndex = 0;

        document.addEventListener('keydown', function(e) {
            if (e.key === konamiCode[konamiIndex]) {
                konamiIndex++;
                if (konamiIndex === konamiCode.length) {
                    showAchievement('Secret Found!', 'You discovered the Konami code!');
                    awardXP(100, 'Easter egg', 'konami');
                    createParticleEffect();
                    konamiIndex = 0;
                }
            } else {
                konamiIndex = 0;
            }
        });

        // Auto-save progress (using sessionStorage to avoid localStorage)
        setInterval(function() {
            sessionStorage.setItem('logicGatesProgress', JSON.stringify(gameState));
        }, 30000);

        // Load progress
        window.addEventListener('load', function() {
            const saved = sessionStorage.getItem('logicGatesProgress');
            if (saved) {
                try {
                    const savedState = JSON.parse(saved);
                    // Restore some state but not all to prevent cheating
                    gameState.currentSection = savedState.currentSection || 'intro';
                    gameState.completedSections = savedState.completedSections || [];
                    goToSection(gameState.currentSection);
                } catch (e) {
                    console.error('Could not load saved progress');
                }
            }
        });
    </script>
</body>
</html>