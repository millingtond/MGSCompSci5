<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Protocols - Interactive Lesson</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --secondary-color: #7c3aed;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header with animated gradient */
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 1.5rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
        }

        /* XP System */
        .xp-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1.5rem;
            border-radius: 2rem;
            backdrop-filter: blur(10px);
        }

        .xp-bar {
            width: 200px;
            height: 24px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%);
            transition: width 0.6s ease;
            position: relative;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }

        .xp-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .level-badge {
            font-size: 1.1rem;
            font-weight: 700;
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
        }

        /* Navigation */
        .nav-container {
            background: white;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 80px;
            z-index: 999;
            box-shadow: var(--shadow-md);
        }

        .nav-pills {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding: 0.5rem;
            max-width: 1200px;
            margin: 0 auto;
            scrollbar-width: none;
        }

        .nav-pills::-webkit-scrollbar {
            display: none;
        }

        .nav-pill {
            padding: 0.5rem 1.25rem;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 2rem;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav-pill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--primary-color);
            transition: left 0.3s ease;
            z-index: -1;
        }

        .nav-pill:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .nav-pill:hover::before {
            left: 0;
        }

        .nav-pill.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .nav-pill.completed {
            border-color: var(--success-color);
        }

        .nav-pill.completed::after {
            content: '✓';
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--success-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .section {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.5s ease;
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* Interactive Elements */
        .interactive-area {
            background: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
            transition: all 0.3s ease;
        }

        .interactive-area:hover {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::after {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        /* Quiz Options */
        .quiz-option {
            display: block;
            width: 100%;
            padding: 1rem;
            margin: 0.5rem 0;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            border-color: var(--primary-light);
            transform: translateX(5px);
            box-shadow: var(--shadow-md);
        }

        .quiz-option.selected {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-color);
        }

        .quiz-option.correct {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
            animation: correctPulse 0.6s ease;
        }

        .quiz-option.incorrect {
            background: var(--error-color);
            color: white;
            border-color: var(--error-color);
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Matching Activity */
        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 1.5rem 0;
        }

        .matching-item {
            padding: 1rem;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.5rem 0;
        }

        .matching-item:hover {
            border-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .matching-item.selected {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-color);
        }

        .matching-item.matched {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
            opacity: 0.7;
            pointer-events: none;
        }

        /* Protocol Simulator */
        .protocol-simulator {
            background: #1e293b;
            border-radius: 0.75rem;
            padding: 2rem;
            color: white;
            margin: 1.5rem 0;
            position: relative;
            overflow: hidden;
        }

        .sim-device {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            transition: all 0.3s ease;
        }

        .sim-device.active {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .data-packet {
            position: absolute;
            width: 60px;
            height: 30px;
            background: linear-gradient(90deg, #fbbf24, #f59e0b);
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            color: #1e293b;
            opacity: 0;
            z-index: 10;
        }

        @keyframes movePacket {
            0% { 
                opacity: 1;
                transform: translateX(0);
            }
            100% { 
                opacity: 1;
                transform: translateX(300px);
            }
        }

        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            border-radius: 1rem;
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-lg);
            transform: translateX(400px);
            transition: transform 0.5s ease;
            z-index: 2000;
            border: 2px solid var(--success-color);
        }

        .achievement-popup.show {
            transform: translateX(0);
        }

        .achievement-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 0.5rem;
            animation: bounce 0.6s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Input Fields */
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Select Dropdown */
        .select-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .select-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Drawing Canvas */
        .drawing-canvas {
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            background: white;
            touch-action: none;
            cursor: crosshair;
            margin: 1rem 0;
        }

        /* Feedback Button */
        .feedback-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .feedback-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }

        /* Feedback Modal */
        .feedback-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .feedback-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Accessibility Controls */
        .accessibility-controls {
            position: fixed;
            top: 150px;
            right: 20px;
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
        }

        .accessibility-controls button {
            display: block;
            width: 100%;
            margin: 0.5rem 0;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 0.25rem;
            cursor: pointer;
        }

        .accessibility-controls button:hover {
            background: var(--bg-color);
        }

        /* High Contrast Mode */
        body.high-contrast {
            background: #000;
            color: #fff;
        }

        body.high-contrast .card {
            background: #111;
            border-color: #fff;
        }

        /* Dyslexia Font */
        body.dyslexia-font {
            font-family: 'Comic Sans MS', 'OpenDyslexic', sans-serif;
        }

        /* Font Sizes */
        body.font-small { font-size: 14px; }
        body.font-large { font-size: 18px; }

        /* Hint Container */
        .hint-container {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--warning-color);
            border-radius: 0.5rem;
            display: none;
        }

        .hint-container.show {
            display: block;
        }

        /* Protocol Card */
        .protocol-card {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin: 1rem 0;
            transition: all 0.3s ease;
        }

        .protocol-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .protocol-card h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        /* Mark Scheme */
        .mark-scheme {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--success-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1rem;
            display: none;
        }

        .mark-scheme.show {
            display: block;
        }

        /* Shame Message */
        .shame-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--error-color);
            color: white;
            padding: 2rem 3rem;
            border-radius: 1rem;
            font-size: 1.25rem;
            font-weight: bold;
            text-align: center;
            z-index: 5000;
            animation: shameAnimation 3s ease forwards;
        }

        @keyframes shameAnimation {
            0% { transform: translate(-50%, -50%) scale(0); }
            20% { transform: translate(-50%, -50%) scale(1.2); }
            80% { transform: translate(-50%, -50%) scale(1); }
            100% { transform: translate(-50%, -50%) scale(0); }
        }

        /* Particle Container */
        #particle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2999;
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            animation: particleFall 2s linear forwards;
        }

        @keyframes particleFall {
            to {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.25rem;
            }

            .xp-container {
                width: 100%;
                justify-content: center;
            }

            .xp-bar {
                width: 150px;
            }

            .matching-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .accessibility-controls {
                top: auto;
                bottom: 90px;
                right: 10px;
            }
        }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,0.1);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Real-world Context Box */
        .real-world-box {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(37, 99, 235, 0.1));
            border: 2px solid var(--secondary-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .real-world-box h4 {
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }

        /* Common Mistakes Box */
        .mistakes-box {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid var(--error-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .mistakes-box h4 {
            color: var(--error-color);
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>🌐 Network Protocols</h1>
            <div class="xp-container">
                <span class="level-badge">Level <span id="current-level">1</span></span>
                <div class="xp-bar">
                    <div class="xp-fill" id="xp-fill" style="width: 0%"></div>
                </div>
                <span id="xp-text">0 / 100 XP</span>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-pills" id="nav-pills">
            <button class="nav-pill active" data-section="intro">Introduction</button>
            <button class="nav-pill" data-section="starter">Starter Activity</button>
            <button class="nav-pill" data-section="email-protocols">Email Protocols</button>
            <button class="nav-pill" data-section="pop3-imap">POP3 vs IMAP</button>
            <button class="nav-pill" data-section="smtp">SMTP</button>
            <button class="nav-pill" data-section="ftp">FTP</button>
            <button class="nav-pill" data-section="http">HTTP/HTTPS</button>
            <button class="nav-pill" data-section="udp">UDP</button>
            <button class="nav-pill" data-section="simulation">Protocol Simulation</button>
            <button class="nav-pill" data-section="summary">Summary Quiz</button>
            <button class="nav-pill" data-section="exam">Exam Practice</button>
            <button class="nav-pill" data-section="extension">Extension</button>
            <button class="nav-pill" data-section="videos">Videos</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Introduction Section -->
        <section id="intro" class="section active">
            <div class="card">
                <h2 class="card-title">
                    <span>📡</span> Welcome to Network Protocols!
                </h2>
                
                <h3>Learning Outcomes</h3>
                <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                    <li>Understand the purpose and function of key network protocols</li>
                    <li>Differentiate between POP3 and IMAP for email retrieval</li>
                    <li>Explain how SMTP works for email transmission</li>
                    <li>Describe FTP and its components</li>
                    <li>Understand HTTP/HTTPS and their role in web browsing</li>
                    <li>Explain when UDP is preferred over TCP</li>
                </ul>

                <div class="real-world-box">
                    <h4>🌍 Real-World Context</h4>
                    <p>Every time you send an email, browse a website, or download a file, network protocols are working behind the scenes to make it happen. Today we'll explore how these invisible rules enable our digital communications!</p>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="navigateSection('next')">
                        Start Learning →
                    </button>
                </div>
            </div>
        </section>

        <!-- Starter Activity -->
        <section id="starter" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🎯</span> Starter Activity: Protocol Knowledge Check
                </h2>
                
                <p>Let's assess your current knowledge! Can you match these everyday activities to their protocols?</p>
                
                <div class="interactive-area">
                    <h4>Click to Match Activities with Protocols</h4>
                    
                    <div class="matching-container" id="starter-matching">
                        <div>
                            <h5>Activities</h5>
                            <div class="matching-item" data-id="a1">Browsing Facebook</div>
                            <div class="matching-item" data-id="a2">Sending an email</div>
                            <div class="matching-item" data-id="a3">Downloading homework files</div>
                            <div class="matching-item" data-id="a4">Video calling on Zoom</div>
                            <div class="matching-item" data-id="a5">Checking emails on phone</div>
                        </div>
                        <div>
                            <h5>Protocols</h5>
                            <div class="matching-item" data-match="a1">HTTPS</div>
                            <div class="matching-item" data-match="a2">SMTP</div>
                            <div class="matching-item" data-match="a3">FTP</div>
                            <div class="matching-item" data-match="a4">UDP</div>
                            <div class="matching-item" data-match="a5">IMAP</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="resetStarterActivity()">Reset Activity</button>
                    <button class="btn btn-primary" onclick="checkStarterActivity()">Check Matches</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Email Protocols Overview -->
        <section id="email-protocols" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>📧</span> Email Protocols Overview
                </h2>
                
                <p>Email communication relies on different protocols for different tasks. Let's explore the main ones!</p>
                
                <div class="protocol-card">
                    <h4>POP3 (Post Office Protocol version 3)</h4>
                    <ul>
                        <li>Downloads emails from server to device</li>
                        <li>Usually deletes emails from server after download</li>
                        <li>Good for single device access</li>
                        <li>Simple and fast</li>
                    </ul>
                </div>

                <div class="protocol-card">
                    <h4>IMAP (Internet Message Access Protocol)</h4>
                    <ul>
                        <li>Synchronizes emails across all devices</li>
                        <li>Emails remain on server</li>
                        <li>Downloads headers first, full message on demand</li>
                        <li>Better for multi-device access</li>
                    </ul>
                </div>

                <div class="protocol-card">
                    <h4>SMTP (Simple Mail Transfer Protocol)</h4>
                    <ul>
                        <li>Used for sending emails</li>
                        <li>Transfers emails between servers</li>
                        <li>Works at application layer of TCP/IP</li>
                        <li>Works with POP3/IMAP for complete email service</li>
                    </ul>
                </div>

                <div class="interactive-area">
                    <h4>Quick Check: Protocol Functions</h4>
                    <p>Select the correct protocol for each function:</p>
                    
                    <div style="margin: 1rem 0;">
                        <p>1. I want to send an email to my teacher: 
                            <select class="select-field" id="func1">
                                <option value="">Choose protocol...</option>
                                <option value="pop3">POP3</option>
                                <option value="imap">IMAP</option>
                                <option value="smtp">SMTP</option>
                                <option value="ftp">FTP</option>
                            </select>
                        </p>
                        
                        <p>2. I want to check emails on both phone and laptop: 
                            <select class="select-field" id="func2">
                                <option value="">Choose protocol...</option>
                                <option value="smtp">SMTP</option>
                                <option value="pop3">POP3</option>
                                <option value="imap">IMAP</option>
                                <option value="http">HTTP</option>
                            </select>
                        </p>
                        
                        <p>3. I only use one computer for emails and want to save server space: 
                            <select class="select-field" id="func3">
                                <option value="">Choose protocol...</option>
                                <option value="imap">IMAP</option>
                                <option value="pop3">POP3</option>
                                <option value="smtp">SMTP</option>
                                <option value="udp">UDP</option>
                            </select>
                        </p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkProtocolFunctions()">Check Answers</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- POP3 vs IMAP Detailed -->
        <section id="pop3-imap" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>⚖️</span> POP3 vs IMAP: Detailed Comparison
                </h2>
                
                <div class="interactive-area">
                    <h4>Scenario-Based Learning</h4>
                    <p>For each scenario, decide whether POP3 or IMAP would be better:</p>
                    
                    <div style="margin: 1.5rem 0;">
                        <div class="quiz-option" onclick="selectScenario(this, 'sc1')">
                            <strong>Scenario 1:</strong> Sarah is a student who checks email on her phone during the day and laptop at home. She wants to see all emails on both devices.
                        </div>
                        <div style="margin: 1rem 0; display: none;" id="sc1-options">
                            <button class="btn btn-secondary" onclick="checkScenario('sc1', 'pop3')">POP3</button>
                            <button class="btn btn-secondary" onclick="checkScenario('sc1', 'imap')">IMAP</button>
                        </div>
                        
                        <div class="quiz-option" onclick="selectScenario(this, 'sc2')">
                            <strong>Scenario 2:</strong> John has limited internet data and only uses his desktop computer for emails. He wants emails removed from the server after reading.
                        </div>
                        <div style="margin: 1rem 0; display: none;" id="sc2-options">
                            <button class="btn btn-secondary" onclick="checkScenario('sc2', 'pop3')">POP3</button>
                            <button class="btn btn-secondary" onclick="checkScenario('sc2', 'imap')">IMAP</button>
                        </div>
                        
                        <div class="quiz-option" onclick="selectScenario(this, 'sc3')">
                            <strong>Scenario 3:</strong> A business team needs to access shared emails from different locations and devices, with everyone seeing the same inbox state.
                        </div>
                        <div style="margin: 1rem 0; display: none;" id="sc3-options">
                            <button class="btn btn-secondary" onclick="checkScenario('sc3', 'pop3')">POP3</button>
                            <button class="btn btn-secondary" onclick="checkScenario('sc3', 'imap')">IMAP</button>
                        </div>
                    </div>
                </div>

                <div class="interactive-area">
                    <h4>True or False Challenge</h4>
                    <div style="margin: 1rem 0;">
                        <p>1. POP3 downloads only email headers initially 
                            <select class="select-field" style="width: 100px;" id="tf1">
                                <option value="">Select...</option>
                                <option value="true">True</option>
                                <option value="false">False</option>
                            </select>
                        </p>
                        
                        <p>2. IMAP synchronizes emails across all devices 
                            <select class="select-field" style="width: 100px;" id="tf2">
                                <option value="">Select...</option>
                                <option value="true">True</option>
                                <option value="false">False</option>
                            </select>
                        </p>
                        
                        <p>3. POP3 always keeps emails on the server 
                            <select class="select-field" style="width: 100px;" id="tf3">
                                <option value="">Select...</option>
                                <option value="true">True</option>
                                <option value="false">False</option>
                            </select>
                        </p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkTrueFalse()">Check Answers</button>
                    <button class="btn btn-secondary" onclick="showHint('pop3-imap')">Need a Hint?</button>
                </div>
                
                <div class="hint-container" id="pop3-imap-hint">
                    <p>💡 Hint: Think about what happens to emails after they're accessed. POP3 = Post Office (collect and take away), IMAP = Cloud-like (stay on server)</p>
                </div>

                <div class="mistakes-box">
                    <h4>⚠️ Common Mistakes</h4>
                    <ul>
                        <li>Thinking POP3 is always better because it's "simpler" - it depends on your needs!</li>
                        <li>Assuming IMAP uses more data - it only downloads headers initially</li>
                        <li>Not considering multi-device access when choosing protocols</li>
                    </ul>
                </div>

                <button class="btn btn-secondary" onclick="resetPop3ImapSection()">Reset Section</button>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- SMTP Section -->
        <section id="smtp" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>📤</span> SMTP: Sending Emails
                </h2>
                
                <p>SMTP (Simple Mail Transfer Protocol) is the standard protocol for sending emails. Unlike POP3/IMAP which retrieve emails, SMTP handles the sending process.</p>
                
                <div class="interactive-area">
                    <h4>SMTP Process Sequencing</h4>
                    <p>Put these SMTP steps in the correct order by clicking them in sequence:</p>
                    
                    <div id="smtp-sequence">
                        <div class="quiz-option" data-order="3" onclick="selectSequence(this, 'smtp')">
                            SMTP server forwards email to recipient's email server
                        </div>
                        <div class="quiz-option" data-order="1" onclick="selectSequence(this, 'smtp')">
                            User composes email and clicks send
                        </div>
                        <div class="quiz-option" data-order="4" onclick="selectSequence(this, 'smtp')">
                            Recipient retrieves email using POP3/IMAP
                        </div>
                        <div class="quiz-option" data-order="2" onclick="selectSequence(this, 'smtp')">
                            Email client connects to SMTP server
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkSequence('smtp')">Check Order</button>
                    <button class="btn btn-secondary" onclick="resetSequence('smtp')">Reset</button>
                </div>

                <div class="interactive-area">
                    <h4>Fill in the Blanks: SMTP Facts</h4>
                    <p>Complete these statements about SMTP:</p>
                    
                    <div style="margin: 1rem 0;">
                        <p>1. SMTP operates at the 
                            <select class="select-field" style="width: 150px;" id="smtp-fill1">
                                <option value="">Choose...</option>
                                <option value="physical">physical</option>
                                <option value="application">application</option>
                                <option value="network">network</option>
                                <option value="transport">transport</option>
                            </select>
                            layer of TCP/IP
                        </p>
                        
                        <p>2. SMTP is used for 
                            <select class="select-field" style="width: 150px;" id="smtp-fill2">
                                <option value="">Choose...</option>
                                <option value="receiving">receiving</option>
                                <option value="storing">storing</option>
                                <option value="sending">sending</option>
                                <option value="deleting">deleting</option>
                            </select>
                            emails
                        </p>
                        
                        <p>3. SMTP can transfer emails between 
                            <select class="select-field" style="width: 150px;" id="smtp-fill3">
                                <option value="">Choose...</option>
                                <option value="clients">clients</option>
                                <option value="servers">servers</option>
                                <option value="routers">routers</option>
                                <option value="switches">switches</option>
                            </select>
                        </p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkSMTPFill()">Check Answers</button>
                </div>

                <div class="real-world-box">
                    <h4>🌍 Real-World Example</h4>
                    <p>When you send an email from Gmail to someone using Outlook, SMTP handles the journey. Your Gmail SMTP server sends it to Microsoft's SMTP server, which then stores it for the recipient to retrieve via POP3 or IMAP.</p>
                </div>

                <button class="btn btn-secondary" onclick="resetSMTPSection()">Reset Section</button>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- FTP Section -->
        <section id="ftp" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>📁</span> FTP: File Transfer Protocol
                </h2>
                
                <p>FTP allows files to be transferred between computers over a network. It's commonly used for uploading websites and sharing large files.</p>
                
                <div class="protocol-card">
                    <h4>FTP Components</h4>
                    <ul>
                        <li><strong>Server:</strong> Central computer storing files</li>
                        <li><strong>Client:</strong> User's computer accessing the server</li>
                        <li><strong>Commands:</strong> Instructions like change directory, upload, download</li>
                        <li><strong>Anonymous Access:</strong> Optional feature allowing access without login</li>
                    </ul>
                </div>

                <div class="interactive-area">
                    <h4>FTP Commands Matching</h4>
                    <p>Match these FTP operations with their likely commands:</p>
                    
                    <div class="matching-container" id="ftp-matching">
                        <div>
                            <h5>Operations</h5>
                            <div class="matching-item" data-id="f1">Upload a file to server</div>
                            <div class="matching-item" data-id="f2">Download a file from server</div>
                            <div class="matching-item" data-id="f3">List files in directory</div>
                            <div class="matching-item" data-id="f4">Change to different folder</div>
                        </div>
                        <div>
                            <h5>Commands</h5>
                            <div class="matching-item" data-match="f1">PUT</div>
                            <div class="matching-item" data-match="f2">GET</div>
                            <div class="matching-item" data-match="f3">LIST/DIR</div>
                            <div class="matching-item" data-match="f4">CD</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkFTPMatching()">Check Matches</button>
                    <button class="btn btn-secondary" onclick="resetFTPMatching()">Reset</button>
                </div>

                <div class="interactive-area">
                    <h4>FTP Security Question</h4>
                    <p>What is a major security concern with standard FTP?</p>
                    
                    <button class="quiz-option" onclick="checkFTPSecurity('a')">It's too slow for modern files</button>
                    <button class="quiz-option" onclick="checkFTPSecurity('b')">Passwords and data are sent unencrypted</button>
                    <button class="quiz-option" onclick="checkFTPSecurity('c')">It only works on Windows</button>
                    <button class="quiz-option" onclick="checkFTPSecurity('d')">Files get corrupted during transfer</button>
                </div>

                <div class="real-world-box">
                    <h4>🌍 Real-World Use</h4>
                    <p>Web developers use FTP to upload website files to web servers. However, many now use SFTP (Secure FTP) or FTPS for better security!</p>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- HTTP/HTTPS Section -->
        <section id="http" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🌐</span> HTTP/HTTPS: Web Protocols
                </h2>
                
                <p>HTTP (HyperText Transfer Protocol) and HTTPS (HTTP Secure) are the foundation of web browsing.</p>
                
                <div class="interactive-area">
                    <h4>HTTP vs HTTPS Comparison</h4>
                    <p>Categorize these features:</p>
                    
                    <div id="http-features">
                        <button class="quiz-option" onclick="categorizeFeature(this, 'encrypted')">
                            Data is encrypted during transmission
                        </button>
                        <button class="quiz-option" onclick="categorizeFeature(this, 'faster')">
                            Generally faster due to less overhead
                        </button>
                        <button class="quiz-option" onclick="categorizeFeature(this, 'padlock')">
                            Shows padlock icon in browser
                        </button>
                        <button class="quiz-option" onclick="categorizeFeature(this, 'banking')">
                            Safe for online banking
                        </button>
                        <button class="quiz-option" onclick="categorizeFeature(this, 'port80')">
                            Uses port 80 by default
                        </button>
                        <button class="quiz-option" onclick="categorizeFeature(this, 'port443')">
                            Uses port 443 by default
                        </button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                        <div style="background: #f8f8f8; padding: 1rem; border-radius: 0.5rem;">
                            <h5>HTTP Features</h5>
                            <div id="http-list"></div>
                        </div>
                        <div style="background: #f8f8f8; padding: 1rem; border-radius: 0.5rem;">
                            <h5>HTTPS Features</h5>
                            <div id="https-list"></div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkHTTPFeatures()">Check Categorization</button>
                    <button class="btn btn-secondary" onclick="resetHTTPSection()">Reset</button>
                </div>

                <div class="interactive-area">
                    <h4>Website Security Check</h4>
                    <p>Which of these activities should ALWAYS use HTTPS?</p>
                    
                    <div style="margin: 1rem 0;">
                        <label><input type="checkbox" id="act1"> Reading news articles</label><br>
                        <label><input type="checkbox" id="act2"> Online shopping</label><br>
                        <label><input type="checkbox" id="act3"> Entering passwords</label><br>
                        <label><input type="checkbox" id="act4"> Viewing public photos</label><br>
                        <label><input type="checkbox" id="act5"> Online banking</label><br>
                        <label><input type="checkbox" id="act6"> Submitting personal information</label>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkHTTPSActivities()">Check Answers</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- UDP Section -->
        <section id="udp" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>⚡</span> UDP: User Datagram Protocol
                </h2>
                
                <p>UDP is an alternative to TCP that prioritizes speed over reliability. It doesn't guarantee packet delivery or order.</p>
                
                <div class="protocol-card">
                    <h4>UDP Characteristics</h4>
                    <ul>
                        <li>No connection establishment (connectionless)</li>
                        <li>No guarantee of delivery</li>
                        <li>No guarantee of order</li>
                        <li>Faster than TCP</li>
                        <li>Lower overhead</li>
                        <li>Used where speed matters more than reliability</li>
                    </ul>
                </div>

                <div class="interactive-area">
                    <h4>TCP vs UDP: Which Protocol?</h4>
                    <p>For each application, decide whether TCP or UDP would be better:</p>
                    
                    <div style="margin: 1rem 0;">
                        <div class="quiz-option" onclick="selectProtocol(this, 'p1')">
                            Online gaming (real-time action)
                        </div>
                        <div class="quiz-option" onclick="selectProtocol(this, 'p2')">
                            Downloading a software update
                        </div>
                        <div class="quiz-option" onclick="selectProtocol(this, 'p3')">
                            Live video streaming
                        </div>
                        <div class="quiz-option" onclick="selectProtocol(this, 'p4')">
                            Email transmission
                        </div>
                        <div class="quiz-option" onclick="selectProtocol(this, 'p5')">
                            Voice over IP (VoIP) calls
                        </div>
                        <div class="quiz-option" onclick="selectProtocol(this, 'p6')">
                            File transfer
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkProtocolChoices()">Check All Answers</button>
                </div>

                <div class="interactive-area">
                    <h4>UDP Understanding Check</h4>
                    <p>Why might video conferencing use UDP instead of TCP?</p>
                    
                    <textarea class="input-field" id="udp-explanation" rows="4" placeholder="Type your explanation here..."></textarea>
                    
                    <button class="btn btn-primary" onclick="checkUDPExplanation()">Submit Answer</button>
                </div>

                <div class="mistakes-box">
                    <h4>⚠️ Common Misconception</h4>
                    <p>UDP isn't "worse" than TCP - it's designed for different purposes. Think of it like choosing between a guaranteed delivery service (TCP) and express shipping that might occasionally lose a package but is much faster (UDP).</p>
                </div>

                <button class="btn btn-secondary" onclick="resetUDPSection()">Reset Section</button>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Protocol Simulation -->
        <section id="simulation" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🔬</span> Interactive Protocol Simulation
                </h2>
                
                <p>Let's see how these protocols work in action! Choose a protocol to simulate:</p>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="startSimulation('email')">Email Journey (POP3/IMAP/SMTP)</button>
                    <button class="btn btn-secondary" onclick="startSimulation('web')">Web Request (HTTP/HTTPS)</button>
                    <button class="btn btn-secondary" onclick="startSimulation('streaming')">Video Stream (UDP vs TCP)</button>
                </div>

                <div class="protocol-simulator" id="simulator">
                    <div id="sim-content">
                        <p style="text-align: center; color: #64748b;">Select a simulation above to begin</p>
                    </div>
                    
                    <div id="sim-controls" style="display: none; margin-top: 1rem;">
                        <button class="btn btn-secondary" onclick="simPrevStep()">← Previous Step</button>
                        <button class="btn btn-primary" onclick="simNextStep()">Next Step →</button>
                        <button class="btn btn-secondary" onclick="resetSimulation()">Reset</button>
                    </div>
                </div>

                <div class="interactive-area" id="sim-reflection" style="display: none;">
                    <h4>Simulation Reflection</h4>
                    <p id="reflection-question"></p>
                    <textarea class="input-field" id="reflection-answer" rows="3" placeholder="Type your answer here..."></textarea>
                    <button class="btn btn-primary" onclick="checkReflection()">Submit Reflection</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Summary Quiz -->
        <section id="summary" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>📝</span> Summary Quiz
                </h2>
                
                <p>Test your understanding of network protocols!</p>
                
                <div id="summary-quiz">
                    <!-- Question 1 -->
                    <div class="interactive-area">
                        <h4>Question 1</h4>
                        <p>Which protocol would you use to check emails on multiple devices and keep them synchronized?</p>
                        <button class="quiz-option" data-q="1" data-a="a">POP3</button>
                        <button class="quiz-option" data-q="1" data-a="b">SMTP</button>
                        <button class="quiz-option" data-q="1" data-a="c">IMAP</button>
                        <button class="quiz-option" data-q="1" data-a="d">FTP</button>
                    </div>

                    <!-- Question 2 -->
                    <div class="interactive-area">
                        <h4>Question 2</h4>
                        <p>What does the 'S' in HTTPS stand for?</p>
                        <button class="quiz-option" data-q="2" data-a="a">Simple</button>
                        <button class="quiz-option" data-q="2" data-a="b">Secure</button>
                        <button class="quiz-option" data-q="2" data-a="c">Server</button>
                        <button class="quiz-option" data-q="2" data-a="d">System</button>
                    </div>

                    <!-- Question 3 -->
                    <div class="interactive-area">
                        <h4>Question 3</h4>
                        <p>Which protocol is used for sending emails?</p>
                        <button class="quiz-option" data-q="3" data-a="a">POP3</button>
                        <button class="quiz-option" data-q="3" data-a="b">IMAP</button>
                        <button class="quiz-option" data-q="3" data-a="c">SMTP</button>
                        <button class="quiz-option" data-q="3" data-a="d">HTTP</button>
                    </div>

                    <!-- Question 4 -->
                    <div class="interactive-area">
                        <h4>Question 4</h4>
                        <p>True or False: UDP guarantees that all packets arrive in the correct order.</p>
                        <button class="quiz-option" data-q="4" data-a="a">True</button>
                        <button class="quiz-option" data-q="4" data-a="b">False</button>
                    </div>

                    <!-- Question 5 -->
                    <div class="interactive-area">
                        <h4>Question 5</h4>
                        <p>Which component of FTP stores the files to be downloaded/uploaded?</p>
                        <button class="quiz-option" data-q="5" data-a="a">Client</button>
                        <button class="quiz-option" data-q="5" data-a="b">Server</button>
                        <button class="quiz-option" data-q="5" data-a="c">Command</button>
                        <button class="quiz-option" data-q="5" data-a="d">Anonymous</button>
                    </div>

                    <!-- Question 6 -->
                    <div class="interactive-area">
                        <h4>Question 6</h4>
                        <p>POP3 typically does what with emails after downloading them?</p>
                        <button class="quiz-option" data-q="6" data-a="a">Keeps them on server</button>
                        <button class="quiz-option" data-q="6" data-a="b">Deletes them from server</button>
                        <button class="quiz-option" data-q="6" data-a="c">Encrypts them</button>
                        <button class="quiz-option" data-q="6" data-a="d">Forwards them</button>
                    </div>

                    <!-- Question 7 -->
                    <div class="interactive-area">
                        <h4>Question 7</h4>
                        <p>Which protocol would be best for live video streaming where some data loss is acceptable?</p>
                        <button class="quiz-option" data-q="7" data-a="a">TCP</button>
                        <button class="quiz-option" data-q="7" data-a="b">UDP</button>
                        <button class="quiz-option" data-q="7" data-a="c">SMTP</button>
                        <button class="quiz-option" data-q="7" data-a="d">FTP</button>
                    </div>

                    <!-- Question 8 -->
                    <div class="interactive-area">
                        <h4>Question 8</h4>
                        <p>At which layer of the TCP/IP stack does HTTP/HTTPS operate?</p>
                        <button class="quiz-option" data-q="8" data-a="a">Physical</button>
                        <button class="quiz-option" data-q="8" data-a="b">Network</button>
                        <button class="quiz-option" data-q="8" data-a="c">Transport</button>
                        <button class="quiz-option" data-q="8" data-a="d">Application</button>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="submitSummaryQuiz()">Submit Quiz</button>
                
                <div id="quiz-results" style="margin-top: 2rem; display: none;">
                    <h4>Your Results:</h4>
                    <p id="quiz-score"></p>
                    <div id="quiz-feedback"></div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Exam Practice -->
        <section id="exam" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>📋</span> Exam Practice Questions
                </h2>
                
                <div class="interactive-area">
                    <h4>Question 1 (4 marks)</h4>
                    <p>Explain two differences between POP3 and IMAP protocols for email retrieval.</p>
                    
                    <textarea class="input-field" id="exam-q1" rows="6" placeholder="Write your answer here..."></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <label>Predicted marks: 
                            <input type="number" id="marks-q1" min="0" max="4" style="width: 50px;" class="input-field">
                        </label>
                        <button class="btn btn-secondary" onclick="showMarkScheme('q1')">Show Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="mark-scheme-q1">
                        <h5>Mark Scheme:</h5>
                        <p>1 mark for each valid difference (max 2 differences, 2 marks each):</p>
                        <ul>
                            <li>POP3 downloads entire email / IMAP downloads headers first</li>
                            <li>POP3 usually deletes from server / IMAP keeps on server</li>
                            <li>POP3 doesn't sync across devices / IMAP synchronizes</li>
                            <li>POP3 better for single device / IMAP better for multiple devices</li>
                        </ul>
                    </div>
                </div>

                <div class="interactive-area" style="margin-top: 2rem;">
                    <h4>Question 2 (3 marks)</h4>
                    <p>A company wants to allow employees to upload large files to a central server. Name the protocol they should use and describe two of its components.</p>
                    
                    <textarea class="input-field" id="exam-q2" rows="5" placeholder="Write your answer here..."></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <label>Predicted marks: 
                            <input type="number" id="marks-q2" min="0" max="3" style="width: 50px;" class="input-field">
                        </label>
                        <button class="btn btn-secondary" onclick="showMarkScheme('q2')">Show Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="mark-scheme-q2">
                        <h5>Mark Scheme:</h5>
                        <ul>
                            <li>Protocol: FTP (1 mark)</li>
                            <li>Component 1: Server - stores files (1 mark)</li>
                            <li>Component 2: Commands - instructions like upload/download (1 mark)</li>
                            <li>Alternative component: Client/Anonymous access</li>
                        </ul>
                    </div>
                </div>

                <div class="interactive-area" style="margin-top: 2rem;">
                    <h4>Question 3 (6 marks)</h4>
                    <p>Explain why UDP might be preferred over TCP for video conferencing applications. Include at least three reasons in your answer.</p>
                    
                    <textarea class="input-field" id="exam-q3" rows="8" placeholder="Write your answer here..."></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <label>Predicted marks: 
                            <input type="number" id="marks-q3" min="0" max="6" style="width: 50px;" class="input-field">
                        </label>
                        <button class="btn btn-secondary" onclick="showMarkScheme('q3')">Show Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="mark-scheme-q3">
                        <h5>Mark Scheme:</h5>
                        <p>2 marks per valid reason with explanation (max 3 reasons):</p>
                        <ul>
                            <li>Speed - UDP faster as no connection establishment needed</li>
                            <li>Real-time - old packets not useful, better to drop than delay</li>
                            <li>Lower overhead - no acknowledgments needed</li>
                            <li>Synchronization - audio/video must stay in sync</li>
                            <li>Acceptable loss - missing frames tolerable vs delay</li>
                        </ul>
                    </div>
                </div>

                <h4 style="margin-top: 2rem;">Drawing Canvas for Network Diagrams</h4>
                <p>Use this canvas for any network diagrams or rough work:</p>
                <canvas id="drawing-canvas" class="drawing-canvas" width="600" height="300"></canvas>
                <button class="btn btn-secondary" onclick="clearCanvas()">Clear Canvas</button>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Extension Activities -->
        <section id="extension" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🌟</span> Extension Activities
                </h2>
                
                <h3>Beyond the Specification</h3>
                
                <div class="interactive-area">
                    <h4>Research Task 1: Modern Protocols</h4>
                    <p>Research and explain how QUIC (Quick UDP Internet Connections) combines features of TCP and UDP:</p>
                    
                    <textarea class="input-field" rows="6" placeholder="Explain QUIC protocol and its advantages..."></textarea>
                </div>

                <div class="interactive-area" style="margin-top: 2rem;">
                    <h4>Research Task 2: Security Protocols</h4>
                    <p>Investigate how TLS (Transport Layer Security) works with HTTPS. What is a TLS handshake?</p>
                    
                    <textarea class="input-field" rows="6" placeholder="Describe TLS and the handshake process..."></textarea>
                </div>

                <div class="interactive-area" style="margin-top: 2rem;">
                    <h4>Challenge: Protocol Design</h4>
                    <p>Design your own protocol for a specific purpose (e.g., instant messaging, file sharing). Include:</p>
                    <ul>
                        <li>Protocol name and purpose</li>
                        <li>Key features (reliability, speed, security)</li>
                        <li>How it would handle common scenarios</li>
                        <li>Advantages over existing protocols</li>
                    </ul>
                    
                    <textarea class="input-field" rows="10" placeholder="Design your protocol here..."></textarea>
                </div>

                <button class="btn btn-primary" onclick="submitExtension()">Submit Extension Work</button>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Videos Section -->
        <section id="videos" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🎥</span> Video Resources
                </h2>
                
                <div class="interactive-area">
                    <h4>Supplementary Videos</h4>
                    <p>Your teacher will add video links here to support your learning:</p>
                    
                    <div style="background: #f8f8f8; padding: 3rem; border-radius: 0.75rem; text-align: center; margin: 2rem 0;">
                        <p style="color: #64748b; font-size: 3rem;">📹</p>
                        <p style="color: #64748b;">Video content will be added here</p>
                    </div>
                </div>

                <h4>Additional Resources</h4>
                <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                    <li>Cambridge 9618 Specification - Network Protocols</li>
                    <li>Protocol Analyzers (Wireshark tutorials)</li>
                    <li>RFC Documents for Protocol Standards</li>
                    <li>Network+ Protocol Reference Guide</li>
                </ul>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('intro')">Start Over</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievement-popup">
        <div class="achievement-icon" id="achievement-icon">🏆</div>
        <h4 id="achievement-title">Achievement Unlocked!</h4>
        <p id="achievement-desc">You've earned a new achievement</p>
    </div>

    <!-- Shame Message -->
    <div class="shame-message" id="shame-message">
        🚫 No pasting allowed! Type your own answers! 🚫
    </div>

    <!-- Particle Container -->
    <div id="particle-container"></div>

    <!-- Feedback Button & Modal -->
    <button class="feedback-btn" onclick="openFeedback()">
        💬
    </button>

    <div class="feedback-modal" id="feedback-modal">
        <div class="feedback-content">
            <h3>Send Feedback</h3>
            <p>Found a bug or have a suggestion?</p>
            <p style="font-size: 0.875rem; color: #64748b;">Current page: <span id="feedback-page"></span></p>
            <textarea class="input-field" id="feedback-text" rows="5" placeholder="Describe the issue or suggestion..."></textarea>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="closeFeedback()">Cancel</button>
                <button class="btn btn-primary" onclick="sendFeedback()">Send</button>
            </div>
        </div>
    </div>

    <!-- Accessibility Controls -->
    <div class="accessibility-controls">
        <h4>Accessibility</h4>
        <button onclick="toggleHighContrast()">High Contrast</button>
        <button onclick="toggleDyslexiaFont()">Dyslexia Font</button>
        <button onclick="changeFontSize('small')">A-</button>
        <button onclick="changeFontSize('normal')">A</button>
        <button onclick="changeFontSize('large')">A+</button>
    </div>

    <script>
        // Game State
        let gameState = {
            xp: 0,
            level: 1,
            completedSections: new Set(),
            achievements: new Set(),
            actionsPerformed: new Set(),
            currentSection: 'intro',
            sectionScores: {},
            selectedItems: {},
            sequenceOrder: {},
            simulationState: {
                type: null,
                step: 0,
                maxSteps: 0
            }
        };

        // XP Requirements per level
        const XP_PER_LEVEL = [0, 100, 250, 450, 700, 1000];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateXPDisplay();
            initializeMatchingActivities();
            initializeCanvas();
        });

        // Event Listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-pill').forEach(pill => {
                pill.addEventListener('click', function() {
                    navigateToSection(this.dataset.section);
                });
            });

            // Quiz options
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('quiz-option') && e.target.dataset.q) {
                    const question = e.target.dataset.q;
                    document.querySelectorAll(`[data-q="${question}"]`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    e.target.classList.add('selected');
                }
            });

            // Prevent paste
            document.addEventListener('paste', function(e) {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    e.preventDefault();
                    showShameMessage();
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowLeft') navigateSection('prev');
                if (e.key === 'ArrowRight') navigateSection('next');
            });
        }

        // Navigation
        function navigateToSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-pill').forEach(p => p.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
            
            gameState.currentSection = sectionId;
            updateFeedbackPage();
            
            if (!gameState.completedSections.has(sectionId)) {
                awardXP(5, 'Section Visit', `visit_${sectionId}`);
            }
        }

        function navigateSection(direction) {
            const sections = Array.from(document.querySelectorAll('.nav-pill')).map(p => p.dataset.section);
            const currentIndex = sections.indexOf(gameState.currentSection);
            
            if (direction === 'next' && currentIndex < sections.length - 1) {
                navigateToSection(sections[currentIndex + 1]);
            } else if (direction === 'prev' && currentIndex > 0) {
                navigateToSection(sections[currentIndex - 1]);
            }
        }

        // XP System
        function awardXP(amount, action, actionId = null) {
            if (actionId && gameState.actionsPerformed.has(actionId)) return;
            if (actionId) gameState.actionsPerformed.add(actionId);
            
            gameState.xp += amount;
            updateXPDisplay();
            checkLevelUp();
            
            // Floating XP indicator
            const xpFloat = document.createElement('div');
            xpFloat.style.cssText = `
                position: fixed;
                top: 120px;
                right: 100px;
                color: #f59e0b;
                font-weight: bold;
                font-size: 1.5rem;
                pointer-events: none;
                z-index: 3000;
                animation: floatUp 2s ease-out forwards;
            `;
            xpFloat.textContent = `+${amount} XP`;
            document.body.appendChild(xpFloat);
            
            setTimeout(() => xpFloat.remove(), 2000);
        }

        // Add floating animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes floatUp {
                0% { transform: translateY(0); opacity: 1; }
                100% { transform: translateY(-50px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        function updateXPDisplay() {
            const xpForNextLevel = XP_PER_LEVEL[gameState.level] || XP_PER_LEVEL[XP_PER_LEVEL.length - 1];
            const xpProgress = Math.min((gameState.xp / xpForNextLevel) * 100, 100);
            
            document.getElementById('xp-fill').style.width = xpProgress + '%';
            document.getElementById('xp-text').textContent = `${gameState.xp} / ${xpForNextLevel} XP`;
            document.getElementById('current-level').textContent = gameState.level;
        }

        function checkLevelUp() {
            if (gameState.level < 5 && gameState.xp >= XP_PER_LEVEL[gameState.level]) {
                gameState.level++;
                showAchievement('Level Up!', `You reached Level ${gameState.level}!`, '⬆️');
                createParticleEffect();
            }
        }

        // Achievements
        function showAchievement(title, desc, icon) {
            const popup = document.getElementById('achievement-popup');
            document.getElementById('achievement-title').textContent = title;
            document.getElementById('achievement-desc').textContent = desc;
            document.getElementById('achievement-icon').textContent = icon;
            
            popup.classList.add('show');
            setTimeout(() => popup.classList.remove('show'), 3000);
            
            awardXP(50, 'Achievement');
        }

        function createParticleEffect() {
            const colors = ['#fbbf24', '#f59e0b', '#3b82f6', '#7c3aed', '#10b981'];
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    document.getElementById('particle-container').appendChild(particle);
                    
                    particle.addEventListener('animationend', () => particle.remove());
                }, i * 50);
            }
        }

        // Starter Activity
        function initializeMatchingActivities() {
            setupMatching('starter-matching', {
                'a1': 'a1', 'a2': 'a2', 'a3': 'a3', 'a4': 'a4', 'a5': 'a5'
            });
            
            setupMatching('ftp-matching', {
                'f1': 'f1', 'f2': 'f2', 'f3': 'f3', 'f4': 'f4'
            });
        }

        function setupMatching(containerId, answers) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const items = container.querySelectorAll('.matching-item[data-id]');
            const matches = container.querySelectorAll('.matching-item[data-match]');
            
            items.forEach(item => {
                item.addEventListener('click', function() {
                    if (this.classList.contains('matched')) return;
                    
                    items.forEach(i => i.classList.remove('selected'));
                    this.classList.add('selected');
                    gameState.selectedItems[containerId] = this;
                });
            });
            
            matches.forEach(match => {
                match.addEventListener('click', function() {
                    const selected = gameState.selectedItems[containerId];
                    if (!selected || selected.classList.contains('matched')) return;
                    
                    const itemId = selected.dataset.id;
                    const matchId = this.dataset.match;
                    
                    if (answers[itemId] === matchId) {
                        selected.classList.add('matched');
                        this.classList.add('matched');
                        this.textContent += ' ✓';
                        awardXP(10, 'Correct Match', `match_${containerId}_${itemId}`);
                    } else {
                        selected.classList.remove('selected');
                        this.style.animation = 'shake 0.5s';
                        setTimeout(() => this.style.animation = '', 500);
                    }
                });
            });
        }

        function resetStarterActivity() {
            const container = document.getElementById('starter-matching');
            container.querySelectorAll('.matching-item').forEach(item => {
                item.classList.remove('matched', 'selected');
                if (item.dataset.match) {
                    item.textContent = item.textContent.replace(' ✓', '');
                }
            });
        }

        function checkStarterActivity() {
            const matched = document.querySelectorAll('#starter-matching .matched').length;
            if (matched === 10) { // 5 items + 5 matches
                awardXP(20, 'Starter Complete', 'starter_complete');
                markSectionComplete('starter');
            } else {
                alert(`You've matched ${matched/2} out of 5 correctly. Keep trying!`);
            }
        }

        // Email Protocols Functions
        function checkProtocolFunctions() {
            const answers = {
                'func1': 'smtp',
                'func2': 'imap',
                'func3': 'pop3'
            };
            
            let correct = 0;
            Object.keys(answers).forEach(id => {
                const select = document.getElementById(id);
                if (select.value === answers[id]) {
                    select.style.borderColor = '#10b981';
                    correct++;
                } else {
                    select.style.borderColor = '#ef4444';
                }
            });
            
            if (correct === 3) {
                awardXP(15, 'Protocol Functions', 'protocol_functions');
                markSectionComplete('email-protocols');
            }
        }

        // POP3 vs IMAP Functions
        function selectScenario(element, scenarioId) {
            element.classList.add('selected');
            document.getElementById(`${scenarioId}-options`).style.display = 'block';
        }

        function checkScenario(scenarioId, choice) {
            const correct = {
                'sc1': 'imap',
                'sc2': 'pop3',
                'sc3': 'imap'
            };
            
            if (choice === correct[scenarioId]) {
                awardXP(10, 'Scenario Correct', `scenario_${scenarioId}`);
                alert('Correct! ' + getScenarioFeedback(scenarioId, true));
            } else {
                alert('Not quite. ' + getScenarioFeedback(scenarioId, false));
            }
        }

        function getScenarioFeedback(scenarioId, isCorrect) {
            const feedback = {
                'sc1': {
                    true: 'IMAP keeps emails synchronized across all devices.',
                    false: 'POP3 would download to one device and delete from server.'
                },
                'sc2': {
                    true: 'POP3 is perfect for single device use and saves server space.',
                    false: 'IMAP would keep emails on server, using more space.'
                },
                'sc3': {
                    true: 'IMAP allows the whole team to see the same inbox state.',
                    false: 'POP3 would cause confusion with different inbox states.'
                }
            };
            return feedback[scenarioId][isCorrect];
        }

        function checkTrueFalse() {
            const answers = {
                'tf1': 'false',
                'tf2': 'true',
                'tf3': 'false'
            };
            
            let correct = 0;
            Object.keys(answers).forEach(id => {
                const select = document.getElementById(id);
                if (select.value === answers[id]) {
                    select.style.borderColor = '#10b981';
                    correct++;
                } else {
                    select.style.borderColor = '#ef4444';
                }
            });
            
            if (correct === 3) {
                awardXP(15, 'True/False Complete', 'tf_complete');
                markSectionComplete('pop3-imap');
            }
        }

        function showHint(section) {
            document.getElementById(`${section}-hint`).classList.add('show');
            awardXP(-5, 'Hint Used', `hint_${section}`);
        }

        function resetPop3ImapSection() {
            document.querySelectorAll('#pop3-imap .select-field').forEach(field => {
                field.value = '';
                field.style.borderColor = '#e2e8f0';
            });
            document.querySelectorAll('#pop3-imap .quiz-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelectorAll('[id$="-options"]').forEach(opts => {
                opts.style.display = 'none';
            });
        }

        // SMTP Functions
        function selectSequence(element, type) {
            if (!gameState.sequenceOrder[type]) {
                gameState.sequenceOrder[type] = [];
            }
            
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                const index = gameState.sequenceOrder[type].indexOf(element);
                gameState.sequenceOrder[type].splice(index, 1);
            } else {
                element.classList.add('selected');
                gameState.sequenceOrder[type].push(element);
            }
            
            // Update numbers
            gameState.sequenceOrder[type].forEach((el, index) => {
                el.style.order = index;
                el.textContent = `${index + 1}. ${el.textContent.replace(/^\d+\.\s*/, '')}`;
            });
        }

        function checkSequence(type) {
            const sequence = gameState.sequenceOrder[type] || [];
            let correct = true;
            
            sequence.forEach((element, index) => {
                const expectedOrder = parseInt(element.dataset.order);
                if (index + 1 !== expectedOrder) {
                    correct = false;
                }
            });
            
            if (correct && sequence.length === 4) {
                awardXP(20, 'Sequence Correct', `sequence_${type}`);
                alert('Perfect! You got the sequence correct!');
                markSectionComplete('smtp');
            } else {
                alert('Not quite right. Think about the logical flow of sending an email.');
            }
        }

        function resetSequence(type) {
            gameState.sequenceOrder[type] = [];
            document.querySelectorAll(`#${type}-sequence .quiz-option`).forEach(opt => {
                opt.classList.remove('selected');
                opt.style.order = '';
                opt.textContent = opt.textContent.replace(/^\d+\.\s*/, '');
            });
        }

        function checkSMTPFill() {
            const answers = {
                'smtp-fill1': 'application',
                'smtp-fill2': 'sending',
                'smtp-fill3': 'servers'
            };
            
            let correct = 0;
            Object.keys(answers).forEach(id => {
                const select = document.getElementById(id);
                if (select.value === answers[id]) {
                    select.style.borderColor = '#10b981';
                    correct++;
                } else {
                    select.style.borderColor = '#ef4444';
                }
            });
            
            if (correct === 3) {
                awardXP(15, 'SMTP Fill Complete', 'smtp_fill');
            }
        }

        function resetSMTPSection() {
            resetSequence('smtp');
            document.querySelectorAll('#smtp .select-field').forEach(field => {
                field.value = '';
                field.style.borderColor = '#e2e8f0';
            });
        }

        // FTP Functions
        function checkFTPMatching() {
            const matched = document.querySelectorAll('#ftp-matching .matched').length;
            if (matched === 8) {
                awardXP(20, 'FTP Matching Complete', 'ftp_matching');
                markSectionComplete('ftp');
            }
        }

        function resetFTPMatching() {
            const container = document.getElementById('ftp-matching');
            container.querySelectorAll('.matching-item').forEach(item => {
                item.classList.remove('matched', 'selected');
                if (item.dataset.match) {
                    item.textContent = item.textContent.replace(' ✓', '');
                }
            });
        }

        function checkFTPSecurity(answer) {
            const options = document.querySelectorAll('#ftp .quiz-option');
            options.forEach(opt => opt.classList.remove('correct', 'incorrect'));
            
            if (answer === 'b') {
                options[1].classList.add('correct');
                awardXP(10, 'FTP Security', 'ftp_security');
            } else {
                const index = answer.charCodeAt(0) - 97;
                options[index].classList.add('incorrect');
                setTimeout(() => {
                    options[index].classList.remove('incorrect');
                }, 2000);
            }
        }

        // HTTP/HTTPS Functions
        function categorizeFeature(element, feature) {
            const httpFeatures = ['faster', 'port80'];
            const httpsFeatures = ['encrypted', 'padlock', 'banking', 'port443'];
            
            element.style.display = 'none';
            
            const targetList = httpFeatures.includes(feature) ? 'http-list' : 'https-list';
            const listElement = document.getElementById(targetList);
            
            const item = document.createElement('div');
            item.textContent = element.textContent;
            item.style.padding = '0.5rem';
            item.style.margin = '0.25rem 0';
            item.style.background = '#e2e8f0';
            item.style.borderRadius = '0.25rem';
            listElement.appendChild(item);
            
            awardXP(5, 'Feature Categorized', `feature_${feature}`);
        }

        function checkHTTPFeatures() {
            const httpList = document.getElementById('http-list').children.length;
            const httpsList = document.getElementById('https-list').children.length;
            
            if (httpList === 2 && httpsList === 4) {
                awardXP(20, 'HTTP Features Complete', 'http_features');
                markSectionComplete('http');
            }
        }

        function resetHTTPSection() {
            document.getElementById('http-list').innerHTML = '';
            document.getElementById('https-list').innerHTML = '';
            document.querySelectorAll('#http-features .quiz-option').forEach(opt => {
                opt.style.display = 'block';
            });
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
        }

        function checkHTTPSActivities() {
            const shouldUseHTTPS = ['act2', 'act3', 'act5', 'act6'];
            let correct = 0;
            let total = 0;
            
            for (let i = 1; i <= 6; i++) {
                const checkbox = document.getElementById(`act${i}`);
                const shouldBeChecked = shouldUseHTTPS.includes(`act${i}`);
                
                if (checkbox.checked === shouldBeChecked) {
                    correct++;
                }
                total++;
            }
            
            if (correct === total) {
                awardXP(15, 'HTTPS Activities', 'https_activities');
                alert('Perfect! You correctly identified all activities requiring HTTPS.');
            } else {
                alert(`You got ${correct} out of ${total} correct. Remember: any activity involving passwords, personal info, or financial data needs HTTPS!`);
            }
        }

        // UDP Functions
        function selectProtocol(element, id) {
            element.classList.add('selected');
            
            const protocolAnswers = {
                'p1': 'udp', // Gaming
                'p2': 'tcp', // Software download
                'p3': 'udp', // Live streaming
                'p4': 'tcp', // Email
                'p5': 'udp', // VoIP
                'p6': 'tcp'  // File transfer
            };
            
            // Store answer
            element.dataset.userAnswer = protocolAnswers[id];
        }

        function checkProtocolChoices() {
            const protocolAnswers = {
                'p1': 'udp',
                'p2': 'tcp',
                'p3': 'udp',
                'p4': 'tcp',
                'p5': 'udp',
                'p6': 'tcp'
            };
            
            let correct = 0;
            Object.keys(protocolAnswers).forEach(id => {
                const element = document.querySelector(`[onclick*="${id}"]`);
                if (element && element.dataset.userAnswer === protocolAnswers[id]) {
                    element.classList.add('correct');
                    correct++;
                } else if (element) {
                    element.classList.add('incorrect');
                }
            });
            
            if (correct === 6) {
                awardXP(30, 'Protocol Master', 'protocol_choices');
                markSectionComplete('udp');
            } else {
                alert(`You got ${correct} out of 6 correct. Remember: UDP for real-time, TCP for reliability!`);
            }
        }

        function checkUDPExplanation() {
            const explanation = document.getElementById('udp-explanation').value;
            const keywords = ['speed', 'real-time', 'delay', 'drop', 'sync', 'audio', 'video'];
            
            let keywordCount = 0;
            keywords.forEach(keyword => {
                if (explanation.toLowerCase().includes(keyword)) {
                    keywordCount++;
                }
            });
            
            if (explanation.length > 50 && keywordCount >= 3) {
                awardXP(20, 'UDP Explanation', 'udp_explanation');
                alert('Excellent explanation! You understand why UDP is better for real-time applications.');
            } else {
                alert('Try to include more details about speed, real-time requirements, and why dropped packets are acceptable.');
            }
        }

        function resetUDPSection() {
            document.querySelectorAll('#udp .quiz-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
                delete opt.dataset.userAnswer;
            });
            document.getElementById('udp-explanation').value = '';
        }

        // Protocol Simulation
        function startSimulation(type) {
            gameState.simulationState.type = type;
            gameState.simulationState.step = 0;
            
            const simContent = document.getElementById('sim-content');
            const simControls = document.getElementById('sim-controls');
            
            simControls.style.display = 'block';
            
            switch(type) {
                case 'email':
                    gameState.simulationState.maxSteps = 5;
                    showEmailSimStep(0);
                    break;
                case 'web':
                    gameState.simulationState.maxSteps = 4;
                    showWebSimStep(0);
                    break;
                case 'streaming':
                    gameState.simulationState.maxSteps = 4;
                    showStreamingSimStep(0);
                    break;
            }
            
            awardXP(10, 'Simulation Started', `sim_${type}`);
        }

        function showEmailSimStep(step) {
            const simContent = document.getElementById('sim-content');
            const steps = [
                {
                    title: 'Step 1: Composing Email',
                    content: `
                        <div class="sim-device active">
                            <h5>Your Email Client</h5>
                            <p>You compose an email and click Send</p>
                        </div>
                    `
                },
                {
                    title: 'Step 2: SMTP Connection',
                    content: `
                        <div class="sim-device">
                            <h5>Your Email Client</h5>
                            <p>Connecting to SMTP server...</p>
                        </div>
                        <div class="data-packet" style="animation: movePacket 1s ease; opacity: 1;">SMTP</div>
                        <div class="sim-device active" style="margin-top: 2rem;">
                            <h5>Your SMTP Server</h5>
                            <p>Receiving email for transmission</p>
                        </div>
                    `
                },
                {
                    title: 'Step 3: Server to Server',
                    content: `
                        <div class="sim-device">
                            <h5>Your SMTP Server</h5>
                            <p>Forwarding email...</p>
                        </div>
                        <div class="data-packet" style="animation: movePacket 1s ease; opacity: 1;">Email Data</div>
                        <div class="sim-device active" style="margin-top: 2rem;">
                            <h5>Recipient\'s Email Server</h5>
                            <p>Email received and stored</p>
                        </div>
                    `
                },
                {
                    title: 'Step 4: Email Retrieval (POP3)',
                    content: `
                        <div class="sim-device active">
                            <h5>Recipient\'s Email Client</h5>
                            <p>Downloading entire email via POP3</p>
                        </div>
                        <div class="sim-device" style="margin-top: 2rem;">
                            <h5>Email Server</h5>
                            <p>Email deleted after download</p>
                        </div>
                    `
                },
                {
                    title: 'Step 5: Email Retrieval (IMAP)',
                    content: `
                        <div class="sim-device active">
                            <h5>Recipient\'s Devices</h5>
                            <p>Synchronizing email headers via IMAP</p>
                        </div>
                        <div class="sim-device" style="margin-top: 2rem;">
                            <h5>Email Server</h5>
                            <p>Email remains on server, accessible from all devices</p>
                        </div>
                    `
                }
            ];
            
            simContent.innerHTML = `<h4>${steps[step].title}</h4>${steps[step].content}`;
            
            if (step === gameState.simulationState.maxSteps - 1) {
                document.getElementById('sim-reflection').style.display = 'block';
                document.getElementById('reflection-question').textContent = 
                    'Explain the key difference between how POP3 and IMAP handle emails after retrieval.';
            }
        }

        function showWebSimStep(step) {
            const simContent = document.getElementById('sim-content');
            const steps = [
                {
                    title: 'Step 1: URL Entry',
                    content: `
                        <div class="sim-device active">
                            <h5>Your Browser</h5>
                            <p>You type: https://example.com</p>
                        </div>
                    `
                },
                {
                    title: 'Step 2: DNS Lookup',
                    content: `
                        <div class="sim-device">
                            <h5>Your Browser</h5>
                            <p>Requesting IP address...</p>
                        </div>
                        <div class="sim-device active" style="margin-top: 2rem;">
                            <h5>DNS Server</h5>
                            <p>Returns: 93.184.216.34</p>
                        </div>
                    `
                },
                {
                    title: 'Step 3: HTTPS Request',
                    content: `
                        <div class="sim-device active">
                            <h5>Your Browser</h5>
                            <p>Sending encrypted HTTPS request</p>
                        </div>
                        <div class="data-packet" style="animation: movePacket 1s ease; opacity: 1; background: #10b981;">🔒 GET /</div>
                        <div class="sim-device" style="margin-top: 2rem;">
                            <h5>Web Server</h5>
                            <p>Processing request...</p>
                        </div>
                    `
                },
                {
                    title: 'Step 4: Server Response',
                    content: `
                        <div class="sim-device">
                            <h5>Web Server</h5>
                            <p>Sending encrypted webpage</p>
                        </div>
                        <div class="data-packet" style="animation: movePacket 1s ease reverse; opacity: 1; background: #10b981;">🔒 HTML</div>
                        <div class="sim-device active" style="margin-top: 2rem;">
                            <h5>Your Browser</h5>
                            <p>Decrypting and displaying webpage</p>
                        </div>
                    `
                }
            ];
            
            simContent.innerHTML = `<h4>${steps[step].title}</h4>${steps[step].content}`;
            
            if (step === gameState.simulationState.maxSteps - 1) {
                document.getElementById('sim-reflection').style.display = 'block';
                document.getElementById('reflection-question').textContent = 
                    'Why is HTTPS important for this process? What could happen with HTTP?';
            }
        }

        function showStreamingSimStep(step) {
            const simContent = document.getElementById('sim-content');
            const steps = [
                {
                    title: 'Step 1: TCP Streaming',
                    content: `
                        <div class="sim-device">
                            <h5>Video Server (TCP)</h5>
                            <p>Sending video packets in order...</p>
                        </div>
                        <div style="margin: 1rem 0;">
                            <div class="data-packet" style="position: relative; animation: movePacket 2s ease; opacity: 1;">Frame 1</div>
                            <div class="data-packet" style="position: relative; animation: movePacket 2s ease 0.5s; opacity: 1; top: 40px;">Frame 2</div>
                            <div class="data-packet" style="position: relative; animation: movePacket 2s ease 1s; opacity: 1; top: 80px;">Frame 3</div>
                        </div>
                        <div class="sim-device active" style="margin-top: 6rem;">
                            <h5>Your Device</h5>
                            <p>Waiting for all packets...</p>
                        </div>
                    `
                },
                {
                    title: 'Step 2: TCP Packet Loss',
                    content: `
                        <div class="sim-device">
                            <h5>Video Server (TCP)</h5>
                            <p>Packet 2 lost! Retransmitting...</p>
                        </div>
                        <div style="margin: 1rem 0;">
                            <div class="data-packet" style="position: relative; opacity: 1;">Frame 1 ✓</div>
                            <div class="data-packet" style="position: relative; opacity: 0.3; top: 40px; background: red;">Frame 2 ✗</div>
                            <div class="data-packet" style="position: relative; opacity: 1; top: 80px;">Frame 3 (waiting)</div>
                        </div>
                        <div class="sim-device active" style="margin-top: 6rem;">
                            <h5>Your Device</h5>
                            <p>Video paused - buffering...</p>
                        </div>
                    `
                },
                {
                    title: 'Step 3: UDP Streaming',
                    content: `
                        <div class="sim-device">
                            <h5>Video Server (UDP)</h5>
                            <p>Sending video packets quickly...</p>
                        </div>
                        <div style="margin: 1rem 0;">
                            <div class="data-packet" style="position: relative; animation: movePacket 1s ease; opacity: 1;">Frame 1</div>
                            <div class="data-packet" style="position: relative; animation: movePacket 1s ease 0.2s; opacity: 1; top: 40px;">Frame 2</div>
                            <div class="data-packet" style="position: relative; animation: movePacket 1s ease 0.4s; opacity: 1; top: 80px;">Frame 3</div>
                        </div>
                        <div class="sim-device active" style="margin-top: 6rem;">
                            <h5>Your Device</h5>
                            <p>Playing video smoothly</p>
                        </div>
                    `
                },
                {
                    title: 'Step 4: UDP Packet Loss',
                    content: `
                        <div class="sim-device">
                            <h5>Video Server (UDP)</h5>
                            <p>Packet 2 lost - continuing anyway!</p>
                        </div>
                        <div style="margin: 1rem 0;">
                            <div class="data-packet" style="position: relative; opacity: 1;">Frame 1 ✓</div>
                            <div class="data-packet" style="position: relative; opacity: 0.3; top: 40px; background: orange;">Frame 2 (lost)</div>
                            <div class="data-packet" style="position: relative; opacity: 1; top: 80px;">Frame 3 ✓</div>
                        </div>
                        <div class="sim-device active" style="margin-top: 6rem;">
                            <h5>Your Device</h5>
                            <p>Video continues - tiny glitch but no buffering!</p>
                        </div>
                    `
                }
            ];
            
            simContent.innerHTML = `<h4>${steps[step].title}</h4>${steps[step].content}`;
            
            if (step === gameState.simulationState.maxSteps - 1) {
                document.getElementById('sim-reflection').style.display = 'block';
                document.getElementById('reflection-question').textContent = 
                    'Based on this simulation, explain why UDP is preferred for live streaming despite packet loss.';
            }
        }

        function simNextStep() {
            if (gameState.simulationState.step < gameState.simulationState.maxSteps - 1) {
                gameState.simulationState.step++;
                updateSimulation();
            }
        }

        function simPrevStep() {
            if (gameState.simulationState.step > 0) {
                gameState.simulationState.step--;
                updateSimulation();
            }
        }

        function updateSimulation() {
            const step = gameState.simulationState.step;
            const type = gameState.simulationState.type;
            
            switch(type) {
                case 'email':
                    showEmailSimStep(step);
                    break;
                case 'web':
                    showWebSimStep(step);
                    break;
                case 'streaming':
                    showStreamingSimStep(step);
                    break;
            }
        }

        function resetSimulation() {
            gameState.simulationState.step = 0;
            updateSimulation();
            document.getElementById('sim-reflection').style.display = 'none';
            document.getElementById('reflection-answer').value = '';
        }

        function checkReflection() {
            const answer = document.getElementById('reflection-answer').value;
            if (answer.length > 50) {
                awardXP(25, 'Simulation Reflection', `reflection_${gameState.simulationState.type}`);
                alert('Great reflection! You\'re understanding how these protocols work in practice.');
                markSectionComplete('simulation');
            } else {
                alert('Please provide a more detailed reflection (at least 50 characters).');
            }
        }

        // Summary Quiz
        function submitSummaryQuiz() {
            const answers = {
                '1': 'c', // IMAP
                '2': 'b', // Secure
                '3': 'c', // SMTP
                '4': 'b', // False
                '5': 'b', // Server
                '6': 'b', // Deletes from server
                '7': 'b', // UDP
                '8': 'd'  // Application
            };
            
            let score = 0;
            const feedback = [];
            
            Object.keys(answers).forEach(q => {
                const selected = document.querySelector(`.quiz-option[data-q="${q}"].selected`);
                if (selected && selected.dataset.a === answers[q]) {
                    selected.classList.add('correct');
                    score++;
                } else {
                    if (selected) selected.classList.add('incorrect');
                    const correctOption = document.querySelector(`.quiz-option[data-q="${q}"][data-a="${answers[q]}"]`);
                    if (correctOption) correctOption.classList.add('correct');
                    
                    const topics = {
                        '1': 'IMAP synchronizes across devices',
                        '2': 'HTTPS = HTTP Secure',
                        '3': 'SMTP sends emails',
                        '4': 'UDP does NOT guarantee order',
                        '5': 'Server stores FTP files',
                        '6': 'POP3 typically deletes from server',
                        '7': 'UDP is best for streaming',
                        '8': 'HTTP operates at Application layer'
                    };
                    feedback.push(`Q${q}: ${topics[q]}`);
                }
            });
            
            gameState.sectionScores.summary = score;
            
            document.getElementById('quiz-score').textContent = `You scored ${score}/8 (${Math.round(score/8*100)}%)`;
            
            if (feedback.length > 0) {
                document.getElementById('quiz-feedback').innerHTML = 
                    '<h5>Review these topics:</h5><ul>' + 
                    feedback.map(f => `<li>${f}</li>`).join('') + 
                    '</ul>';
            } else {
                document.getElementById('quiz-feedback').innerHTML = 
                    '<p style="color: #10b981;">Perfect score! You\'ve mastered network protocols!</p>';
            }
            
            document.getElementById('quiz-results').style.display = 'block';
            
            awardXP(score * 10, 'Quiz Complete', 'summary_quiz');
            markSectionComplete('summary');
            
            if (score === 8) {
                showAchievement('Perfect Score!', 'You aced the summary quiz!', '💯');
            }
        }

        // Exam Practice
        function showMarkScheme(question) {
            const textarea = document.getElementById(`exam-${question}`);
            const marks = document.getElementById(`marks-${question}`);
            const scheme = document.getElementById(`mark-scheme-${question}`);
            
            const minLength = question === 'q1' ? 80 : question === 'q2' ? 60 : 100;
            
            if (textarea.value.length < minLength || !marks.value) {
                alert(`Please write a more complete answer and enter predicted marks`);
                return;
            }
            
            scheme.classList.add('show');
            awardXP(10, 'Exam Practice', `exam_${question}`);
        }

        // Canvas Functions
        function initializeCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            function getCoordinates(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                if (e.touches) {
                    return {
                        x: (e.touches[0].clientX - rect.left) * scaleX,
                        y: (e.touches[0].clientY - rect.top) * scaleY
                    };
                } else {
                    return {
                        x: (e.clientX - rect.left) * scaleX,
                        y: (e.clientY - rect.top) * scaleY
                    };
                }
            }
            
            function startDrawing(e) {
                isDrawing = true;
                const coords = getCoordinates(e);
                lastX = coords.x;
                lastY = coords.y;
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                const coords = getCoordinates(e);
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(coords.x, coords.y);
                ctx.strokeStyle = '#1e293b';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                lastX = coords.x;
                lastY = coords.y;
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function clearCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Extension Activities
        function submitExtension() {
            const textareas = document.querySelectorAll('#extension .input-field');
            let totalWords = 0;
            
            textareas.forEach(ta => {
                totalWords += ta.value.split(' ').filter(word => word.length > 0).length;
            });
            
            if (totalWords > 100) {
                awardXP(50, 'Extension Complete', 'extension_complete');
                markSectionComplete('extension');
                showAchievement('Going Beyond!', 'Completed extension activities!', '🌟');
            } else {
                alert('Please provide more detailed responses (at least 100 words total).');
            }
        }

        // Utility Functions
        function markSectionComplete(section) {
            gameState.completedSections.add(section);
            document.querySelector(`[data-section="${section}"]`).classList.add('completed');
            
            // Check for level completion
            if (gameState.completedSections.size >= 10 && gameState.level < 5) {
                showAchievement('Protocol Expert!', 'Completed all main sections!', '🎓');
            }
        }

        function showShameMessage() {
            const shame = document.getElementById('shame-message');
            shame.style.display = 'block';
            shame.style.animation = 'shameAnimation 3s ease forwards';
            
            setTimeout(() => {
                shame.style.display = 'none';
            }, 3000);
            
            // Lose XP for trying to paste
            gameState.xp = Math.max(0, gameState.xp - 10);
            updateXPDisplay();
        }

        // Feedback System
        function openFeedback() {
            document.getElementById('feedback-modal').style.display = 'flex';
            updateFeedbackPage();
        }

        function closeFeedback() {
            document.getElementById('feedback-modal').style.display = 'none';
            document.getElementById('feedback-text').value = '';
        }

        function updateFeedbackPage() {
            const sectionTitles = {
                'intro': 'Introduction',
                'starter': 'Starter Activity',
                'email-protocols': 'Email Protocols',
                'pop3-imap': 'POP3 vs IMAP',
                'smtp': 'SMTP',
                'ftp': 'FTP',
                'http': 'HTTP/HTTPS',
                'udp': 'UDP',
                'simulation': 'Protocol Simulation',
                'summary': 'Summary Quiz',
                'exam': 'Exam Practice',
                'extension': 'Extension',
                'videos': 'Videos'
            };
            
            document.getElementById('feedback-page').textContent = 
                sectionTitles[gameState.currentSection] || 'Unknown';
        }

        function sendFeedback() {
            const text = document.getElementById('feedback-text').value.trim();
            if (!text) {
                alert('Please enter your feedback');
                return;
            }
            
            const subject = encodeURIComponent('Network Protocols Worksheet Feedback');
            const body = encodeURIComponent(
                `Page: ${document.getElementById('feedback-page').textContent}\n\n` +
                `Feedback: ${text}\n\n` +
                `Section: ${gameState.currentSection}\n` +
                `Level: ${gameState.level}, XP: ${gameState.xp}`
            );
            
            window.location.href = `mailto:millingtond@mgs.org?subject=${subject}&body=${body}`;
            closeFeedback();
            awardXP(5, 'Feedback Sent', 'feedback');
        }

        // Accessibility Functions
        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
        }

        function toggleDyslexiaFont() {
            document.body.classList.toggle('dyslexia-font');
        }

        function changeFontSize(size) {
            document.body.classList.remove('font-small', 'font-large');
            if (size !== 'normal') {
                document.body.classList.add('font-' + size);
            }
        }
    </script>
</body>
</html>