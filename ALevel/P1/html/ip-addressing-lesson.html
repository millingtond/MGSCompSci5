<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Addressing - A Level Computer Science</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f3f4f6;
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Header with animated gradient */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            background-size: 200% 200%;
            animation: gradientShift 10s ease infinite;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
        }

        /* XP and Level System */
        .stats-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .xp-container {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            padding: 15px;
            border-radius: 15px;
            flex: 1;
        }

        .xp-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 25px;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            margin-top: 10px;
        }

        .xp-fill {
            background: linear-gradient(90deg, var(--secondary) 0%, #34d399 100%);
            height: 100%;
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .xp-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            to { left: 100%; }
        }

        .xp-text {
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .level-badge {
            background: linear-gradient(135deg, var(--accent) 0%, #f97316 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        /* Navigation */
        .nav-container {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 10px;
            border-radius: 15px;
            margin-bottom: 30px;
            position: sticky;
            top: 10px;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .nav-pills {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 5px;
        }

        .nav-pill {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            border: 1px solid transparent;
        }

        .nav-pill:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .nav-pill.active {
            background: var(--primary);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        /* Section Cards */
        .section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: none;
            animation: fadeInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            animation: gradientMove 3s linear infinite;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .section.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section h2 {
            color: var(--dark);
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h3 {
            color: var(--primary);
            margin: 20px 0 15px;
            font-size: 1.3rem;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #059669 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        /* Interactive Elements */
        .task-card {
            background: var(--light);
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            border: 2px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .task-card:hover {
            border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.1);
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .quiz-option {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid #e5e7eb;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .quiz-option:hover {
            transform: translateX(5px);
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
        }

        .quiz-option.correct {
            background: #d1fae5;
            border-color: var(--secondary);
            animation: correctPulse 0.5s;
        }

        .quiz-option.incorrect {
            background: #fee2e2;
            border-color: var(--danger);
            animation: shake 0.5s;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 20px;
            right: -400px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: right 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .achievement-popup.show {
            right: 20px;
        }

        .achievement-popup h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        /* XP Indicator */
        .xp-indicator {
            position: fixed;
            color: var(--secondary);
            font-weight: bold;
            font-size: 1.5rem;
            pointer-events: none;
            animation: floatUp 2s ease-out forwards;
            z-index: 1000;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }

        /* IP Address Display */
        .ip-display {
            font-family: 'Courier New', monospace;
            background: #1e293b;
            color: #10b981;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2rem;
            text-align: center;
            margin: 15px 0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Drag and Drop Areas */
        .drop-zone {
            background: #f3f4f6;
            border: 2px dashed #9ca3af;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            min-height: 60px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .drop-zone.active {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .draggable-item {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
            border: 2px solid #e5e7eb;
            transition: all 0.3s;
            display: inline-block;
        }

        .draggable-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .draggable-item.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary-dark);
        }

        /* Navigation Controls */
        .nav-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 10px;
        }

        /* Canvas for Drawing */
        .drawing-canvas {
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: white;
            cursor: crosshair;
            touch-action: none;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        /* Feedback Button */
        .feedback-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
            transition: all 0.3s;
            z-index: 100;
        }

        .feedback-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .feedback-btn svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        /* Feedback Modal */
        .feedback-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 1000;
        }

        .feedback-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .feedback-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .feedback-modal.show .feedback-content {
            transform: scale(1);
        }

        /* Simulation Styles */
        .simulation-container {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #e5e7eb;
        }

        .simulation-step {
            display: none;
            animation: fadeIn 0.5s;
        }

        .simulation-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .network-diagram {
            display: flex;
            align-items: center;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .network-device {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            position: relative;
        }

        .network-device.active {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.3);
        }

        .packet {
            position: absolute;
            background: var(--accent);
            width: 30px;
            height: 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 0.8rem;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        /* Mark Scheme */
        .mark-scheme {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .mark-scheme.show {
            display: block;
            animation: fadeInUp 0.5s;
        }

        /* Hints */
        .hint-box {
            background: #dbeafe;
            border: 2px solid #60a5fa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }

        .hint-box.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .hint-btn {
            background: #60a5fa;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .hint-btn:hover {
            background: #3b82f6;
            transform: translateY(-1px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .nav-pills {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .section {
                padding: 20px;
            }
            
            .network-diagram {
                flex-direction: column;
                gap: 20px;
            }
            
            .stats-container {
                flex-direction: column;
            }
        }

        /* Particles Background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
            }
            33% {
                transform: translateY(-100px) translateX(100px);
            }
            66% {
                transform: translateY(100px) translateX(-100px);
            }
        }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error Messages */
        .error-msg {
            background: #fee2e2;
            color: #dc2626;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #fca5a5;
            animation: shake 0.5s;
        }

        /* Success Messages */
        .success-msg {
            background: #d1fae5;
            color: #059669;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #6ee7b7;
            animation: fadeInUp 0.5s;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        th {
            background: var(--primary);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        tr:hover {
            background: #f9fafb;
        }

        /* Code Blocks */
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: var(--primary);
            text-decoration: underline dotted;
        }

        .tooltip-content {
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 100;
        }

        .tooltip:hover .tooltip-content {
            opacity: 1;
            visibility: visible;
        }

        /* Progress Indicator */
        .progress-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e5e7eb;
            transition: all 0.3s;
        }

        .progress-dot.active {
            background: var(--primary);
            transform: scale(1.2);
        }

        .progress-dot.completed {
            background: var(--secondary);
        }

        /* Shame Message */
        .shame-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--danger);
            color: white;
            padding: 30px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.5);
            z-index: 2000;
            display: none;
            animation: shameShake 0.5s;
        }

        @keyframes shameShake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0); }
            25% { transform: translate(-50%, -50%) rotate(-5deg); }
            75% { transform: translate(-50%, -50%) rotate(5deg); }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Focus Styles */
        *:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        button:focus,
        a:focus {
            outline-offset: 4px;
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
            }
            
            .nav-container,
            .feedback-btn,
            .nav-controls,
            .btn {
                display: none;
            }
            
            .section {
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid #e5e7eb;
            }
        }
    </style>
</head>
<body>
    <!-- Particles Background -->
    <div class="particles" id="particles"></div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>IP Addressing: The Internet's Phone Book</h1>
            <p>Master IPv4, IPv6, Public/Private IPs, NAT, and Static/Dynamic Addressing</p>
            
            <!-- Stats Container -->
            <div class="stats-container">
                <div class="xp-container">
                    <div class="xp-text">XP: <span id="xp-current">0</span> / <span id="xp-max">1000</span></div>
                    <div class="xp-bar">
                        <div class="xp-fill" id="xp-fill"></div>
                    </div>
                </div>
                <div class="level-badge">Level <span id="level">0</span></div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="nav-container">
            <div class="nav-pills">
                <div class="nav-pill active" data-section="starter">Starter</div>
                <div class="nav-pill" data-section="ipv4">IPv4 Basics</div>
                <div class="nav-pill" data-section="ipv6">IPv6 & Future</div>
                <div class="nav-pill" data-section="private-public">Private vs Public</div>
                <div class="nav-pill" data-section="nat">NAT</div>
                <div class="nav-pill" data-section="static-dynamic">Static vs Dynamic</div>
                <div class="nav-pill" data-section="exam">Exam Practice</div>
                <div class="nav-pill" data-section="summary">Summary</div>
                <div class="nav-pill" data-section="extension">Extension</div>
            </div>
        </nav>

        <!-- Starter Section -->
        <section class="section active" id="starter">
            <h2>🔍 IP Address Detective</h2>
            <p>Welcome! Let's start by testing your IP address detection skills. Can you identify which of these are valid IP addresses?</p>
            
            <div class="task-card">
                <h3>Quick Challenge: Spot the Valid IP Addresses</h3>
                <p>Click on all the VALID IP addresses below. Some are IPv4, some are IPv6, and some are invalid!</p>
                
                <div id="ip-detective-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div class="ip-option" data-valid="true" data-type="ipv4">192.168.1.1</div>
                    <div class="ip-option" data-valid="false" data-type="invalid">256.100.50.25</div>
                    <div class="ip-option" data-valid="true" data-type="ipv6">2001:0db8:85a3::8a2e:0370:7334</div>
                    <div class="ip-option" data-valid="false" data-type="invalid">192.168.300.1</div>
                    <div class="ip-option" data-valid="true" data-type="ipv4">10.0.0.1</div>
                    <div class="ip-option" data-valid="false" data-type="invalid">AB.CD.EF.GH</div>
                    <div class="ip-option" data-valid="true" data-type="ipv6">::1</div>
                    <div class="ip-option" data-valid="false" data-type="invalid">172.16.0.0.1</div>
                </div>
                
                <button class="btn" onclick="checkDetective()">Check Answers</button>
                <button class="btn btn-secondary" onclick="resetDetective()">Reset</button>
                
                <div id="detective-feedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Prior Knowledge Check</h3>
                <p>Let's see what you already know about IP addresses. Answer these quick questions:</p>
                
                <div class="quiz-container">
                    <div class="quiz-question">
                        <p><strong>1. How many bits are in an IPv4 address?</strong></p>
                        <div class="quiz-options" data-question="starter-q1" data-correct="32">
                            <div class="quiz-option" data-value="16">16 bits</div>
                            <div class="quiz-option" data-value="32">32 bits</div>
                            <div class="quiz-option" data-value="64">64 bits</div>
                            <div class="quiz-option" data-value="128">128 bits</div>
                        </div>
                    </div>
                    
                    <div class="quiz-question" style="margin-top: 20px;">
                        <p><strong>2. What does NAT stand for?</strong></p>
                        <div class="quiz-options" data-question="starter-q2" data-correct="Network Address Translation">
                            <div class="quiz-option" data-value="Network Access Terminal">Network Access Terminal</div>
                            <div class="quiz-option" data-value="Network Address Translation">Network Address Translation</div>
                            <div class="quiz-option" data-value="New Address Type">New Address Type</div>
                            <div class="quiz-option" data-value="Node Allocation Table">Node Allocation Table</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="nav-controls">
                <button class="btn btn-secondary" disabled>Previous</button>
                <button class="btn" onclick="nextSection()">Next: IPv4 Basics</button>
            </div>
        </section>

        <!-- IPv4 Section -->
        <section class="section" id="ipv4">
            <h2>🌐 IPv4 Fundamentals</h2>
            
            <div class="task-card">
                <h3>Understanding IPv4 Structure</h3>
                <p>IPv4 addresses are 32-bit numbers, typically written as four octets (8-bit numbers) separated by dots.</p>
                
                <div class="ip-display">
                    <span id="ipv4-example">192.168.1.254</span>
                </div>
                
                <p>Each octet can range from 0 to 255 (2^8 = 256 possible values)</p>
            </div>

            <div class="task-card">
                <h3>Interactive IPv4 Builder</h3>
                <p>Build a valid IPv4 address by adjusting each octet. Watch what happens when you go out of range!</p>
                
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px 0;">
                    <div>
                        <label>Octet 1</label>
                        <input type="number" class="input-field ipv4-octet" id="octet1" min="0" max="255" value="192" onchange="updateIPv4Display()">
                    </div>
                    <div>
                        <label>Octet 2</label>
                        <input type="number" class="input-field ipv4-octet" id="octet2" min="0" max="255" value="168" onchange="updateIPv4Display()">
                    </div>
                    <div>
                        <label>Octet 3</label>
                        <input type="number" class="input-field ipv4-octet" id="octet3" min="0" max="255" value="1" onchange="updateIPv4Display()">
                    </div>
                    <div>
                        <label>Octet 4</label>
                        <input type="number" class="input-field ipv4-octet" id="octet4" min="0" max="255" value="1" onchange="updateIPv4Display()">
                    </div>
                </div>
                
                <div id="ipv4-validation" style="margin-top: 15px;"></div>
                
                <button class="btn btn-secondary" onclick="generateRandomIPv4()">Generate Random IP</button>
            </div>

            <div class="task-card">
                <h3>IPv4 Validation Challenge</h3>
                <p>Identify whether these IPv4 addresses are valid or invalid, and explain why:</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>IP Address</th>
                            <th>Valid/Invalid</th>
                            <th>Reason</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>172.16.254.1</td>
                            <td>
                                <select class="input-field" id="ipv4-val-1">
                                    <option value="">Select...</option>
                                    <option value="valid">Valid</option>
                                    <option value="invalid">Invalid</option>
                                </select>
                            </td>
                            <td><input type="text" class="input-field" id="ipv4-reason-1" placeholder="Enter reason..."></td>
                        </tr>
                        <tr>
                            <td>256.1.1.1</td>
                            <td>
                                <select class="input-field" id="ipv4-val-2">
                                    <option value="">Select...</option>
                                    <option value="valid">Valid</option>
                                    <option value="invalid">Invalid</option>
                                </select>
                            </td>
                            <td><input type="text" class="input-field" id="ipv4-reason-2" placeholder="Enter reason..."></td>
                        </tr>
                        <tr>
                            <td>192.168.1</td>
                            <td>
                                <select class="input-field" id="ipv4-val-3">
                                    <option value="">Select...</option>
                                    <option value="valid">Valid</option>
                                    <option value="invalid">Invalid</option>
                                </select>
                            </td>
                            <td><input type="text" class="input-field" id="ipv4-reason-3" placeholder="Enter reason..."></td>
                        </tr>
                        <tr>
                            <td>10.0.0.0</td>
                            <td>
                                <select class="input-field" id="ipv4-val-4">
                                    <option value="">Select...</option>
                                    <option value="valid">Valid</option>
                                    <option value="invalid">Invalid</option>
                                </select>
                            </td>
                            <td><input type="text" class="input-field" id="ipv4-reason-4" placeholder="Enter reason..."></td>
                        </tr>
                    </tbody>
                </table>
                
                <button class="btn" onclick="checkIPv4Validation()">Check Answers</button>
                <div id="ipv4-validation-feedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Quick Quiz: IPv4 Facts</h3>
                <div class="quiz-question">
                    <p><strong>How many unique IPv4 addresses are theoretically possible?</strong></p>
                    <div class="quiz-options" data-question="ipv4-q1" data-correct="4.3 billion">
                        <div class="quiz-option" data-value="2.1 billion">About 2.1 billion</div>
                        <div class="quiz-option" data-value="4.3 billion">About 4.3 billion</div>
                        <div class="quiz-option" data-value="8.6 billion">About 8.6 billion</div>
                        <div class="quiz-option" data-value="16.8 billion">About 16.8 billion</div>
                    </div>
                </div>
            </div>

            <div class="nav-controls">
                <button class="btn btn-secondary" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next: IPv6 & Future</button>
            </div>
        </section>

        <!-- IPv6 Section -->
        <section class="section" id="ipv6">
            <h2>🚀 IPv6 and the Future</h2>
            
            <div class="task-card">
                <h3>Why IPv6?</h3>
                <p>Watch this live counter to understand why we need IPv6:</p>
                
                <div class="simulation-container">
                    <h4>IPv4 Address Exhaustion Simulator</h4>
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 2rem; color: var(--primary); font-weight: bold;">
                            Available IPv4 Addresses: <span id="ipv4-counter">294,967,296</span>
                        </div>
                        <div style="margin-top: 10px;">
                            <button class="btn" onclick="startIPv4Exhaustion()">Start Simulation</button>
                            <button class="btn btn-secondary" onclick="resetIPv4Exhaustion()">Reset</button>
                        </div>
                        <div id="exhaustion-message" style="margin-top: 20px; font-size: 1.1rem;"></div>
                    </div>
                </div>
            </div>

            <div class="task-card">
                <h3>IPv6 Structure</h3>
                <p>IPv6 uses 128 bits, written as 8 groups of 4 hexadecimal digits:</p>
                
                <div class="ip-display">
                    <span id="ipv6-example">2001:0db8:85a3:0000:0000:8a2e:0370:7334</span>
                </div>
                
                <p>That's 2^128 possible addresses - about 340 undecillion!</p>
            </div>

            <div class="task-card">
                <h3>IPv6 Compression Rules Interactive</h3>
                <p>Learn the two rules for simplifying IPv6 addresses:</p>
                
                <div class="simulation-container">
                    <h4>Rule 1: Leading Zeros</h4>
                    <p>Leading zeros in each group can be omitted.</p>
                    <div style="display: flex; align-items: center; gap: 20px; margin: 20px 0;">
                        <div class="ip-display" style="flex: 1;">
                            <span id="ipv6-uncompressed">2001:0db8:0000:0042:0000:8a2e:0370:7334</span>
                        </div>
                        <button class="btn" onclick="applyIPv6Rule1()">Apply Rule 1 →</button>
                        <div class="ip-display" style="flex: 1;">
                            <span id="ipv6-rule1">Click to apply</span>
                        </div>
                    </div>
                    
                    <h4>Rule 2: Consecutive Zeros</h4>
                    <p>One group of consecutive zero blocks can be replaced with ::</p>
                    <div style="display: flex; align-items: center; gap: 20px; margin: 20px 0;">
                        <div class="ip-display" style="flex: 1;">
                            <span id="ipv6-rule1-result">2001:db8:0:42:0:8a2e:370:7334</span>
                        </div>
                        <button class="btn" onclick="applyIPv6Rule2()">Apply Rule 2 →</button>
                        <div class="ip-display" style="flex: 1;">
                            <span id="ipv6-compressed">Click to apply</span>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-secondary" onclick="resetIPv6Compression()">Reset Example</button>
            </div>

            <div class="task-card">
                <h3>Practice: Compress IPv6 Addresses</h3>
                <p>Compress these IPv6 addresses using both rules:</p>
                
                <div style="margin: 20px 0;">
                    <div style="margin-bottom: 15px;">
                        <strong>1. FE80:0000:0000:0000:0202:B3FF:FE1E:8329</strong>
                        <input type="text" class="input-field" id="ipv6-compress-1" placeholder="Enter compressed form...">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>2. 2001:0DB8:0000:0000:0008:0800:200C:417A</strong>
                        <input type="text" class="input-field" id="ipv6-compress-2" placeholder="Enter compressed form...">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>3. 0000:0000:0000:0000:0000:0000:0000:0001</strong>
                        <input type="text" class="input-field" id="ipv6-compress-3" placeholder="Enter compressed form...">
                    </div>
                </div>
                
                <button class="btn" onclick="checkIPv6Compression()">Check Answers</button>
                <button class="hint-btn" onclick="showIPv6Hint()">Need a Hint?</button>
                
                <div class="hint-box" id="ipv6-hint">
                    <p><strong>Hint:</strong> Remember to apply Rule 1 first (remove leading zeros), then Rule 2 (replace the longest sequence of zero groups with ::). Rule 2 can only be used once!</p>
                </div>
                
                <div id="ipv6-compression-feedback" style="margin-top: 20px;"></div>
            </div>

            <div class="nav-controls">
                <button class="btn btn-secondary" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next: Private vs Public</button>
            </div>
        </section>

        <!-- Private vs Public Section -->
        <section class="section" id="private-public">
            <h2>🔒 Private vs Public IP Addresses</h2>
            
            <div class="task-card">
                <h3>Network Visualization</h3>
                <p>Explore how private and public IP addresses work in a network:</p>
                
                <div class="simulation-container">
                    <div class="network-diagram">
                        <div class="network-device" id="device1">
                            <h4>Your Computer</h4>
                            <p>Private IP: 192.168.1.10</p>
                        </div>
                        <div class="network-device" id="router">
                            <h4>Router/NAT</h4>
                            <p>Private: 192.168.1.1</p>
                            <p>Public: 82.45.123.67</p>
                        </div>
                        <div class="network-device" id="internet">
                            <h4>Internet</h4>
                            <p>Public IPs Only</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" onclick="simulateNetworkTraffic()">Simulate Traffic</button>
                        <button class="btn btn-secondary" onclick="resetNetworkSimulation()">Reset</button>
                    </div>
                </div>
            </div>

            <div class="task-card">
                <h3>Private IP Address Ranges</h3>
                <p>These special ranges are reserved for private networks:</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Class</th>
                            <th>Range Start</th>
                            <th>Range End</th>
                            <th>Number of Addresses</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Class A</td>
                            <td>10.0.0.0</td>
                            <td>10.255.255.255</td>
                            <td>16,777,216</td>
                        </tr>
                        <tr>
                            <td>Class B</td>
                            <td>172.16.0.0</td>
                            <td>172.31.255.255</td>
                            <td>1,048,576</td>
                        </tr>
                        <tr>
                            <td>Class C</td>
                            <td>192.168.0.0</td>
                            <td>192.168.255.255</td>
                            <td>65,536</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="task-card">
                <h3>Sorting Challenge: Private vs Public</h3>
                <p>Click to categorize these IP addresses as either private or public:</p>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0;">
                    <div>
                        <h4>IP Addresses</h4>
                        <div id="ip-pool">
                            <div class="draggable-item" data-type="private" onclick="selectIP(this)">10.0.0.1</div>
                            <div class="draggable-item" data-type="public" onclick="selectIP(this)">8.8.8.8</div>
                            <div class="draggable-item" data-type="private" onclick="selectIP(this)">192.168.1.100</div>
                            <div class="draggable-item" data-type="public" onclick="selectIP(this)">142.250.80.46</div>
                            <div class="draggable-item" data-type="private" onclick="selectIP(this)">172.20.10.5</div>
                            <div class="draggable-item" data-type="public" onclick="selectIP(this)">93.184.216.34</div>
                            <div class="draggable-item" data-type="private" onclick="selectIP(this)">192.168.254.254</div>
                            <div class="draggable-item" data-type="public" onclick="selectIP(this)">1.1.1.1</div>
                        </div>
                    </div>
                    <div>
                        <h4>Private IPs</h4>
                        <div class="drop-zone" id="private-zone" onclick="dropIP('private')"></div>
                    </div>
                    <div>
                        <h4>Public IPs</h4>
                        <div class="drop-zone" id="public-zone" onclick="dropIP('public')"></div>
                    </div>
                </div>
                
                <button class="btn" onclick="checkIPSorting()">Check Sorting</button>
                <button class="btn btn-secondary" onclick="resetIPSorting()">Reset</button>
                
                <div id="sorting-feedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Key Differences</h3>
                <p>Complete this comparison table:</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Aspect</th>
                            <th>Private IP</th>
                            <th>Public IP</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Internet Accessible</td>
                            <td>
                                <select class="input-field" id="diff-1-private">
                                    <option value="">Select...</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </td>
                            <td>
                                <select class="input-field" id="diff-1-public">
                                    <option value="">Select...</option>
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>Assigned By</td>
                            <td>
                                <select class="input-field" id="diff-2-private">
                                    <option value="">Select...</option>
                                    <option value="router">Router/Network Admin</option>
                                    <option value="isp">ISP</option>
                                    <option value="user">User</option>
                                </select>
                            </td>
                            <td>
                                <select class="input-field" id="diff-2-public">
                                    <option value="">Select...</option>
                                    <option value="router">Router/Network Admin</option>
                                    <option value="isp">ISP</option>
                                    <option value="user">User</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>Security Level</td>
                            <td>
                                <select class="input-field" id="diff-3-private">
                                    <option value="">Select...</option>
                                    <option value="high">More Secure</option>
                                    <option value="low">Less Secure</option>
                                    <option value="same">Same</option>
                                </select>
                            </td>
                            <td>
                                <select class="input-field" id="diff-3-public">
                                    <option value="">Select...</option>
                                    <option value="high">More Secure</option>
                                    <option value="low">Less Secure</option>
                                    <option value="same">Same</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <button class="btn" onclick="checkDifferences()">Check Answers</button>
                <div id="differences-feedback" style="margin-top: 20px;"></div>
            </div>

            <div class="nav-controls">
                <button class="btn btn-secondary" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next: NAT</button>
            </div>
        </section>

        <!-- NAT Section -->
        <section class="section" id="nat">
            <h2>🔄 Network Address Translation (NAT)</h2>
            
            <div class="task-card">
                <h3>How NAT Works</h3>
                <p>NAT allows multiple devices with private IPs to share a single public IP address.</p>
                
                <div class="simulation-container">
                    <h4>NAT Packet Journey Simulator</h4>
                    <div class="simulation-step active" id="nat-step-1">
                        <p><strong>Step 1:</strong> Your computer (192.168.1.10) wants to visit a website.</p>
                        <div class="network-diagram">
                            <div class="network-device active">
                                <h4>Your PC</h4>
                                <p>192.168.1.10</p>
                                <p style="color: var(--primary);">→ Sending request</p>
                            </div>
                            <div class="network-device">
                                <h4>Router/NAT</h4>
                                <p>Internal: 192.168.1.1</p>
                                <p>External: 82.45.123.67</p>
                            </div>
                            <div class="network-device">
                                <h4>Web Server</h4>
                                <p>93.184.216.34</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="simulation-step" id="nat-step-2">
                        <p><strong>Step 2:</strong> Router receives the packet and performs NAT translation.</p>
                        <div class="network-diagram">
                            <div class="network-device">
                                <h4>Your PC</h4>
                                <p>192.168.1.10</p>
                            </div>
                            <div class="network-device active">
                                <h4>Router/NAT</h4>
                                <p style="color: var(--primary);">Translating...</p>
                                <p>From: 192.168.1.10</p>
                                <p>To: 82.45.123.67</p>
                            </div>
                            <div class="network-device">
                                <h4>Web Server</h4>
                                <p>93.184.216.34</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="simulation-step" id="nat-step-3">
                        <p><strong>Step 3:</strong> Packet travels across the internet with public IP.</p>
                        <div class="network-diagram">
                            <div class="network-device">
                                <h4>Your PC</h4>
                                <p>192.168.1.10</p>
                            </div>
                            <div class="network-device">
                                <h4>Router/NAT</h4>
                                <p>NAT Table Updated</p>
                            </div>
                            <div class="network-device active">
                                <h4>Web Server</h4>
                                <p>93.184.216.34</p>
                                <p style="color: var(--primary);">← Receiving from 82.45.123.67</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="simulation-step" id="nat-step-4">
                        <p><strong>Step 4:</strong> Server responds, router translates back to private IP.</p>
                        <div class="network-diagram">
                            <div class="network-device active">
                                <h4>Your PC</h4>
                                <p>192.168.1.10</p>
                                <p style="color: var(--secondary);">✓ Response received!</p>
                            </div>
                            <div class="network-device">
                                <h4>Router/NAT</h4>
                                <p>Reverse translation</p>
                            </div>
                            <div class="network-device">
                                <h4>Web Server</h4>
                                <p>93.184.216.34</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="previousNATStep()">← Previous</button>
                        <span style="margin: 0 20px;">Step <span id="nat-current-step">1</span> of 4</span>
                        <button class="btn" onclick="nextNATStep()">Next →</button>
                        <button class="btn btn-danger" onclick="resetNATSimulation()">Reset</button>
                    </div>
                </div>
            </div>

            <div class="task-card">
                <h3>NAT Translation Table</h3>
                <p>The router maintains a translation table. Fill in the missing entries:</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Internal IP:Port</th>
                            <th>External Port</th>
                            <th>Destination IP:Port</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>192.168.1.10:45678</td>
                            <td>54321</td>
                            <td>93.184.216.34:80</td>
                        </tr>
                        <tr>
                            <td>192.168.1.15:12345</td>
                            <td><input type="text" class="input-field" id="nat-port-1" placeholder="Port?" style="width: 100px;"></td>
                            <td>8.8.8.8:53</td>
                        </tr>
                        <tr>
                            <td><input type="text" class="input-field" id="nat-ip-1" placeholder="IP:Port?" style="width: 150px;"></td>
                            <td>54323</td>
                            <td>142.250.80.46:443</td>
                        </tr>
                    </tbody>
                </table>
                
                <button class="btn" onclick="checkNATTable()">Check Table</button>
                <div id="nat-table-feedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>NAT Benefits Quiz</h3>
                <p>Select ALL the benefits of using NAT:</p>
                
                <div style="margin: 20px 0;">
                    <label style="display: block; margin: 10px 0;">
                        <input type="checkbox" id="nat-benefit-1" value="security"> Enhanced security by hiding internal IPs
                    </label>
                    <label style="display: block; margin: 10px 0;">
                        <input type="checkbox" id="nat-benefit-2" value="conservation"> Conserves public IP addresses
                    </label>
                    <label style="display: block; margin: 10px 0;">
                        <input type="checkbox" id="nat-benefit-3" value="speed"> Increases internet speed significantly
                    </label>
                    <label style="display: block; margin: 10px 0;">
                        <input type="checkbox" id="nat-benefit-4" value="flexibility"> Allows internal network restructuring without changing public IP
                    </label>
                    <label style="display: block; margin: 10px 0;">
                        <input type="checkbox" id="nat-benefit-5" value="encryption"> Encrypts all network traffic
                    </label>
                </div>
                
                <button class="btn" onclick="checkNATBenefits()">Check Answers</button>
                <div id="nat-benefits-feedback" style="margin-top: 20px;"></div>
            </div>

            <div class="nav-controls">
                <button class="btn btn-secondary" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next: Static vs Dynamic</button>
            </div>
        </section>

        <!-- Static vs Dynamic Section -->
        <section class="section" id="static-dynamic">
            <h2>📌 Static vs Dynamic IP Addresses</h2>
            
            <div class="task-card">
                <h3>Understanding the Difference</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div style="background: #e0e7ff; padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--primary);">Static IP</h4>
                        <p>Like a permanent phone number - it never changes!</p>
                        <ul style="margin-top: 10px;">
                            <li>Assigned manually</li>
                            <li>Remains constant</li>
                            <li>Good for servers</li>
                        </ul>
                    </div>
                    <div style="background: #d1fae5; padding: 20px; border-radius: 10px;">
                        <h4 style="color: var(--secondary);">Dynamic IP</h4>
                        <p>Like a temporary ID badge - changes each time!</p>
                        <ul style="margin-top: 10px;">
                            <li>Assigned by DHCP</li>
                            <li>Changes on reconnection</li>
                            <li>Good for clients</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="task-card">
                <h3>Scenario-Based Selection</h3>
                <p>For each scenario, decide whether a static or dynamic IP would be better:</p>
                
                <div class="scenario-container">
                    <div class="scenario-item" style="margin: 15px 0; padding: 15px; background: #f9fafb; border-radius: 10px;">
                        <p><strong>Scenario 1:</strong> A company's web server that hosts their main website</p>
                        <select class="input-field" id="scenario-1">
                            <option value="">Choose IP type...</option>
                            <option value="static">Static IP</option>
                            <option value="dynamic">Dynamic IP</option>
                        </select>
                        <input type="text" class="input-field" id="scenario-1-reason" placeholder="Why? (Brief explanation)" style="margin-top: 10px;">
                    </div>
                    
                    <div class="scenario-item" style="margin: 15px 0; padding: 15px; background: #f9fafb; border-radius: 10px;">
                        <p><strong>Scenario 2:</strong> Employee laptops in an office</p>
                        <select class="input-field" id="scenario-2">
                            <option value="">Choose IP type...</option>
                            <option value="static">Static IP</option>
                            <option value="dynamic">Dynamic IP</option>
                        </select>
                        <input type="text" class="input-field" id="scenario-2-reason" placeholder="Why? (Brief explanation)" style="margin-top: 10px;">
                    </div>
                    
                    <div class="scenario-item" style="margin: 15px 0; padding: 15px; background: #f9fafb; border-radius: 10px;">
                        <p><strong>Scenario 3:</strong> A security camera system that needs remote access</p>
                        <select class="input-field" id="scenario-3">
                            <option value="">Choose IP type...</option>
                            <option value="static">Static IP</option>
                            <option value="dynamic">Dynamic IP</option>
                        </select>
                        <input type="text" class="input-field" id="scenario-3-reason" placeholder="Why? (Brief explanation)" style="margin-top: 10px;">
                    </div>
                    
                    <div class="scenario-item" style="margin: 15px 0; padding: 15px; background: #f9fafb; border-radius: 10px;">
                        <p><strong>Scenario 4:</strong> Home devices connecting to WiFi</p>
                        <select class="input-field" id="scenario-4">
                            <option value="">Choose IP type...</option>
                            <option value="static">Static IP</option>
                            <option value="dynamic">Dynamic IP</option>
                        </select>
                        <input type="text" class="input-field" id="scenario-4-reason" placeholder="Why? (Brief explanation)" style="margin-top: 10px;">
                    </div>
                </div>
                
                <button class="btn" onclick="checkScenarios()">Check Answers</button>
                <div id="scenario-feedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Benefits and Drawbacks Sorting</h3>
                <p>Click each statement to place it in the correct category:</p>
                
                <div id="benefits-pool" style="margin: 20px 0;">
                    <div class="draggable-item" data-category="static-benefit" onclick="selectBenefit(this)">
                        DNS doesn't need updating
                    </div>
                    <div class="draggable-item" data-category="dynamic-benefit" onclick="selectBenefit(this)">
                        Lower cost for ISPs
                    </div>
                    <div class="draggable-item" data-category="static-drawback" onclick="selectBenefit(this)">
                        Greater security risk
                    </div>
                    <div class="draggable-item" data-category="dynamic-benefit" onclick="selectBenefit(this)">
                        Automatic configuration
                    </div>
                    <div class="draggable-item" data-category="static-benefit" onclick="selectBenefit(this)">
                        Better for running servers
                    </div>
                    <div class="draggable-item" data-category="dynamic-drawback" onclick="selectBenefit(this)">
                        Less reliable for remote access
                    </div>
                    <div class="draggable-item" data-category="static-benefit" onclick="selectBenefit(this)">
                        Can be cached for faster access
                    </div>
                    <div class="draggable-item" data-category="static-drawback" onclick="selectBenefit(this)">
                        Manual configuration required
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4>Static IP</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div>
                                <h5 style="color: var(--secondary);">Benefits</h5>
                                <div class="drop-zone" id="static-benefits" onclick="dropBenefit('static-benefit')"></div>
                            </div>
                            <div>
                                <h5 style="color: var(--danger);">Drawbacks</h5>
                                <div class="drop-zone" id="static-drawbacks" onclick="dropBenefit('static-drawback')"></div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4>Dynamic IP</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div>
                                <h5 style="color: var(--secondary);">Benefits</h5>
                                <div class="drop-zone" id="dynamic-benefits" onclick="dropBenefit('dynamic-benefit')"></div>
                            </div>
                            <div>
                                <h5 style="color: var(--danger);">Drawbacks</h5>
                                <div class="drop-zone" id="dynamic-drawbacks" onclick="dropBenefit('dynamic-drawback')"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="btn" onclick="checkBenefitsSorting()">Check Sorting</button>
                <button class="btn btn-secondary" onclick="resetBenefitsSorting()">Reset</button>
                <div id="benefits-sorting-feedback" style="margin-top: 20px;"></div>
            </div>

            <div class="nav-controls">
                <button class="btn btn-secondary" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next: Exam Practice</button>
            </div>
        </section>

        <!-- Exam Practice Section -->
        <section class="section" id="exam">
            <h2>📝 Exam Practice Questions</h2>
            <p>These questions are based on Cambridge 9618 exam style. Attempt each question before viewing the mark scheme.</p>
            
            <div class="task-card">
                <h3>Question 1: IP Address Validation [4 marks]</h3>
                <p>The following table shows four possible IP addresses. Indicate for each IP address whether it is valid or invalid and give a reason.</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Address</th>
                            <th>Format</th>
                            <th>Valid or Invalid</th>
                            <th>Reason</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>3.2A.6AA.BBBB</td>
                            <td>Hexadecimal</td>
                            <td><input type="text" class="input-field" id="exam-q1-1"></td>
                            <td><input type="text" class="input-field" id="exam-q1-1-reason"></td>
                        </tr>
                        <tr>
                            <td>2.0.255.1</td>
                            <td>Denary</td>
                            <td><input type="text" class="input-field" id="exam-q1-2"></td>
                            <td><input type="text" class="input-field" id="exam-q1-2-reason"></td>
                        </tr>
                        <tr>
                            <td>6.0.257.6</td>
                            <td>Denary</td>
                            <td><input type="text" class="input-field" id="exam-q1-3"></td>
                            <td><input type="text" class="input-field" id="exam-q1-3-reason"></td>
                        </tr>
                        <tr>
                            <td>CA.78.F4.J8</td>
                            <td>Hexadecimal</td>
                            <td><input type="text" class="input-field" id="exam-q1-4"></td>
                            <td><input type="text" class="input-field" id="exam-q1-4-reason"></td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 20px;">
                    <p>Predicted marks: <input type="number" class="input-field" id="q1-predicted" min="0" max="4" style="width: 60px;"> / 4</p>
                    <button class="btn" onclick="showMarkScheme('q1')">View Mark Scheme</button>
                </div>
                
                <div class="mark-scheme" id="mark-scheme-q1">
                    <h4>Mark Scheme:</h4>
                    <ul>
                        <li><strong>3.2A.6AA.BBBB:</strong> Invalid - More than 32 bits / 6AA or BBBB uses more than 8 bits [1 mark]</li>
                        <li><strong>2.0.255.1:</strong> Valid - All values in range 0-255 [1 mark]</li>
                        <li><strong>6.0.257.6:</strong> Invalid - 257 is above 255 / Third octet exceeds maximum [1 mark]</li>
                        <li><strong>CA.78.F4.J8:</strong> Invalid - J is not a valid hexadecimal digit [1 mark]</li>
                    </ul>
                </div>
            </div>

            <div class="task-card">
                <h3>Question 2: Private vs Public IP Addresses [3 marks]</h3>
                <p>Describe two differences between public and private IP addresses.</p>
                
                <textarea class="input-field" id="exam-q2" rows="6" placeholder="Write your answer here..."></textarea>
                
                <div style="margin-top: 20px;">
                    <p>Predicted marks: <input type="number" class="input-field" id="q2-predicted" min="0" max="3" style="width: 60px;"> / 3</p>
                    <button class="btn" onclick="showMarkScheme('q2')">View Mark Scheme</button>
                </div>
                
                <div class="mark-scheme" id="mark-scheme-q2">
                    <h4>Mark Scheme (any two from):</h4>
                    <ul>
                        <li>Public address can be reached across the Internet / Private address can only be reached internally through LAN [1 mark]</li>
                        <li>NAT is necessary for a private IP address to access the Internet directly [1 mark]</li>
                        <li>Private address is more secure than public address [1 mark]</li>
                        <li>Public addresses are provided by ISP / Private addresses are assigned by router [1 mark]</li>
                        <li>Public addresses are unique to the Internet / Private addresses can be duplicated in other networks [1 mark]</li>
                    </ul>
                    <p><em>Max 2 marks for two points, 1 mark for one point</em></p>
                </div>
            </div>

            <div class="task-card">
                <h3>Question 3: IPv4 Format [2 marks]</h3>
                <p>Describe, using an example, the format of an IPv4 address.</p>
                
                <textarea class="input-field" id="exam-q3" rows="4" placeholder="Write your answer here..."></textarea>
                
                <div style="margin-top: 20px;">
                    <p>Predicted marks: <input type="number" class="input-field" id="q3-predicted" min="0" max="2" style="width: 60px;"> / 2</p>
                    <button class="btn" onclick="showMarkScheme('q3')">View Mark Scheme</button>
                </div>
                
                <div class="mark-scheme" id="mark-scheme-q3">
                    <h4>Mark Scheme:</h4>
                    <ul>
                        <li>Four numbers/octets separated by dots/periods [1 mark]</li>
                        <li>Each number ranges from 0 to 255 [1 mark]</li>
                        <li>Example must show correct format e.g. 192.168.1.1</li>
                    </ul>
                </div>
            </div>

            <div class="task-card">
                <h3>Question 4: Static IP Addresses [3 marks]</h3>
                <p>Explain the reasons for a web server using a static instead of a dynamic IP address.</p>
                
                <textarea class="input-field" id="exam-q4" rows="5" placeholder="Write your answer here..."></textarea>
                
                <div style="margin-top: 20px;">
                    <p>Predicted marks: <input type="number" class="input-field" id="q4-predicted" min="0" max="3" style="width: 60px;"> / 3</p>
                    <button class="btn" onclick="showMarkScheme('q4')">View Mark Scheme</button>
                </div>
                
                <div class="mark-scheme" id="mark-scheme-q4">
                    <h4>Mark Scheme (1 mark per point, max 3):</h4>
                    <ul>
                        <li>Static IP does not change whereas dynamic IP address does change [1 mark]</li>
                        <li>DNS does not need updating which might be delayed causing 'address not found' errors [1 mark]</li>
                        <li>Web server may be accessed directly using just the IP address [1 mark]</li>
                        <li>IP address can be held in cache memory [1 mark]</li>
                    </ul>
                </div>
            </div>

            <div class="task-card">
                <h3>Question 5: IPv6 [4 marks]</h3>
                <p>(a) State why there is a need for IPv6 addressing. [1 mark]</p>
                <textarea class="input-field" id="exam-q5a" rows="2" placeholder="Write your answer here..."></textarea>
                
                <p>(b) A computer's IPv6 address is: 2001:0db8:0000:0000:0000:ff00:0042:8329</p>
                <p>Apply compression rules to simplify this address. [2 marks]</p>
                <input type="text" class="input-field" id="exam-q5b" placeholder="Enter compressed IPv6 address...">
                
                <p>(c) Explain why this IPv6 address would be an invalid IPv4 address. [1 mark]</p>
                <textarea class="input-field" id="exam-q5c" rows="2" placeholder="Write your answer here..."></textarea>
                
                <div style="margin-top: 20px;">
                    <p>Predicted marks: <input type="number" class="input-field" id="q5-predicted" min="0" max="4" style="width: 60px;"> / 4</p>
                    <button class="btn" onclick="showMarkScheme('q5')">View Mark Scheme</button>
                </div>
                
                <div class="mark-scheme" id="mark-scheme-q5">
                    <h4>Mark Scheme:</h4>
                    <ul>
                        <li>(a) The number of IP addresses needed will exceed the number available using IPv4 [1 mark]</li>
                        <li>(b) 2001:db8::ff00:42:8329 [2 marks - 1 for removing leading zeros, 1 for :: compression]</li>
                        <li>(c) Any one from: Too many groups/digits, Uses colons as separators, Contains letters beyond F, More than 32 bits [1 mark]</li>
                    </ul>
                </div>
            </div>

            <div class="task-card">
                <h3>Drawing Canvas for Calculations</h3>
                <p>Use this space for any rough work or calculations:</p>
                <canvas id="drawing-canvas" class="drawing-canvas" width="600" height="300"></canvas>
                <button class="btn btn-secondary" onclick="clearCanvas()">Clear Canvas</button>
            </div>

            <div class="nav-controls">
                <button class="btn btn-secondary" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Next: Summary</button>
            </div>
        </section>

        <!-- Summary Section -->
        <section class="section" id="summary">
            <h2>📊 Summary & Final Assessment</h2>
            <p>Test your understanding with these comprehensive questions covering all topics from this lesson.</p>
            
            <div class="task-card">
                <h3>Final Assessment</h3>
                
                <!-- Question 1 -->
                <div class="quiz-question">
                    <p><strong>1. Which of the following is a valid private IPv4 address range?</strong></p>
                    <div class="quiz-options" data-question="summary-q1" data-correct="172.16.0.0 - 172.31.255.255">
                        <div class="quiz-option" data-value="172.16.0.0 - 172.31.255.255">172.16.0.0 - 172.31.255.255</div>
                        <div class="quiz-option" data-value="172.0.0.0 - 172.255.255.255">172.0.0.0 - 172.255.255.255</div>
                        <div class="quiz-option" data-value="192.0.0.0 - 192.255.255.255">192.0.0.0 - 192.255.255.255</div>
                        <div class="quiz-option" data-value="10.0.0.0 - 20.255.255.255">10.0.0.0 - 20.255.255.255</div>
                    </div>
                </div>

                <!-- Question 2 -->
                <div class="quiz-question" style="margin-top: 25px;">
                    <p><strong>2. What is the main purpose of NAT?</strong></p>
                    <div class="quiz-options" data-question="summary-q2" data-correct="Allow multiple devices to share a single public IP">
                        <div class="quiz-option" data-value="Encrypt network traffic">Encrypt network traffic</div>
                        <div class="quiz-option" data-value="Allow multiple devices to share a single public IP">Allow multiple devices to share a single public IP</div>
                        <div class="quiz-option" data-value="Speed up internet connections">Speed up internet connections</div>
                        <div class="quiz-option" data-value="Block malicious websites">Block malicious websites</div>
                    </div>
                </div>

                <!-- Question 3 -->
                <div class="quiz-question" style="margin-top: 25px;">
                    <p><strong>3. How many bits does an IPv6 address use?</strong></p>
                    <div class="quiz-options" data-question="summary-q3" data-correct="128">
                        <div class="quiz-option" data-value="32">32 bits</div>
                        <div class="quiz-option" data-value="64">64 bits</div>
                        <div class="quiz-option" data-value="128">128 bits</div>
                        <div class="quiz-option" data-value="256">256 bits</div>
                    </div>
                </div>

                <!-- Question 4 -->
                <div class="quiz-question" style="margin-top: 25px;">
                    <p><strong>4. Which statement about static IP addresses is FALSE?</strong></p>
                    <div class="quiz-options" data-question="summary-q4" data-correct="They are automatically assigned by DHCP">
                        <div class="quiz-option" data-value="They remain constant when reconnecting">They remain constant when reconnecting</div>
                        <div class="quiz-option" data-value="They are automatically assigned by DHCP">They are automatically assigned by DHCP</div>
                        <div class="quiz-option" data-value="They are good for running servers">They are good for running servers</div>
                        <div class="quiz-option" data-value="They can be cached for faster access">They can be cached for faster access</div>
                    </div>
                </div>

                <!-- Question 5 -->
                <div class="quiz-question" style="margin-top: 25px;">
                    <p><strong>5. What is the compressed form of IPv6 address 2001:0000:0000:0000:0000:0000:0000:0001?</strong></p>
                    <div class="quiz-options" data-question="summary-q5" data-correct="2001::1">
                        <div class="quiz-option" data-value="2001::1">2001::1</div>
                        <div class="quiz-option" data-value="2001:0:0:0:0:0:0:1">2001:0:0:0:0:0:0:1</div>
                        <div class="quiz-option" data-value="2001:::::::1">2001:::::::1</div>
                        <div class="quiz-option" data-value="21::1">21::1</div>
                    </div>
                </div>

                <!-- Question 6 -->
                <div class="quiz-question" style="margin-top: 25px;">
                    <p><strong>6. Which IP address would typically be assigned to a home router's internal interface?</strong></p>
                    <div class="quiz-options" data-question="summary-q6" data-correct="192.168.1.1">
                        <div class="quiz-option" data-value="8.8.8.8">8.8.8.8</div>
                        <div class="quiz-option" data-value="192.168.1.1">192.168.1.1</div>
                        <div class="quiz-option" data-value="172.217.14.196">172.217.14.196</div>
                        <div class="quiz-option" data-value="256.256.256.256">256.256.256.256</div>
                    </div>
                </div>

                <!-- Question 7 -->
                <div class="quiz-question" style="margin-top: 25px;">
                    <p><strong>7. True or False: A device with only a private IP address can directly communicate with servers on the internet without NAT.</strong></p>
                    <div class="quiz-options" data-question="summary-q7" data-correct="False">
                        <div class="quiz-option" data-value="True">True</div>
                        <div class="quiz-option" data-value="False">False</div>
                    </div>
                </div>

                <!-- Question 8 -->
                <div class="quiz-question" style="margin-top: 25px;">
                    <p><strong>8. Which scenario would NOT benefit from using a static IP address?</strong></p>
                    <div class="quiz-options" data-question="summary-q8" data-correct="Employee laptops in an office">
                        <div class="quiz-option" data-value="Web server hosting a company website">Web server hosting a company website</div>
                        <div class="quiz-option" data-value="Email server">Email server</div>
                        <div class="quiz-option" data-value="Employee laptops in an office">Employee laptops in an office</div>
                        <div class="quiz-option" data-value="VPN server">VPN server</div>
                    </div>
                </div>

                <button class="btn" onclick="checkSummaryQuiz()" style="margin-top: 30px;">Check All Answers</button>
                <div id="summary-feedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Key Takeaways</h3>
                <ul>
                    <li><strong>IPv4:</strong> 32-bit addresses (4 octets), written as four decimal numbers (0-255) separated by dots</li>
                    <li><strong>IPv6:</strong> 128-bit addresses, written as 8 groups of 4 hexadecimal digits, can be compressed</li>
                    <li><strong>Private IPs:</strong> Used internally, more secure, require NAT for internet access</li>
                    <li><strong>Public IPs:</strong> Globally unique, directly accessible from internet, assigned by ISPs</li>
                    <li><strong>NAT:</strong> Translates private IPs to public IPs, conserves addresses, adds security</li>
                    <li><strong>Static IPs:</strong> Fixed addresses, good for servers, manually configured</li>
                    <li><strong>Dynamic IPs:</strong> Change on reconnection, assigned by DHCP, good for clients</li>
                </ul>
            </div>

            <div class="task-card">
                <h3>Your Progress</h3>
                <div id="progress-summary">
                    <p>Calculating your final statistics...</p>
                </div>
            </div>

            <div class="nav-controls">
                <button class="btn btn-secondary" onclick="previousSection()">Previous</button>
                <button class="btn" onclick="nextSection()">Extension Activities</button>
            </div>
        </section>

        <!-- Extension Section -->
        <section class="section" id="extension">
            <h2>🚀 Extension Activities</h2>
            <p>Ready to go beyond the specification? These advanced topics will deepen your understanding.</p>
            
            <div class="task-card">
                <h3>Subnet Masking Introduction</h3>
                <p>Subnet masks help divide IP networks into smaller sub-networks. A subnet mask looks like an IP address but actually defines which part of an IP identifies the network vs the host.</p>
                
                <div class="ip-display">
                    IP: 192.168.1.100<br>
                    Mask: 255.255.255.0<br>
                    Network: 192.168.1.0<br>
                    Hosts: 192.168.1.1 - 192.168.1.254
                </div>
                
                <p><strong>Challenge:</strong> If you have the IP 172.16.45.123 with subnet mask 255.255.0.0, what is the network address?</p>
                <input type="text" class="input-field" id="subnet-challenge" placeholder="Enter network address...">
                <button class="btn" onclick="checkSubnetChallenge()">Check</button>
                <div id="subnet-feedback" style="margin-top: 15px;"></div>
            </div>

            <div class="task-card">
                <h3>CIDR Notation</h3>
                <p>CIDR (Classless Inter-Domain Routing) is a compact way to specify IP addresses and their routing prefix.</p>
                
                <div class="code-block">
                    192.168.1.0/24  = Network with 256 addresses (24 network bits)
                    10.0.0.0/8      = Network with 16,777,216 addresses (8 network bits)
                    172.16.0.0/12   = Network with 1,048,576 addresses (12 network bits)
                </div>
                
                <p><strong>Research Task:</strong> What does /16 mean in CIDR notation? How many hosts can it support?</p>
                <textarea class="input-field" id="cidr-research" rows="3" placeholder="Write your answer..."></textarea>
            </div>

            <div class="task-card">
                <h3>IPv6 Adoption Statistics</h3>
                <p>Research the current state of IPv6 adoption worldwide. Consider:</p>
                <ul>
                    <li>Which countries lead in IPv6 adoption?</li>
                    <li>What percentage of internet traffic uses IPv6?</li>
                    <li>What are the main barriers to adoption?</li>
                </ul>
                <textarea class="input-field" id="ipv6-research" rows="5" placeholder="Share your findings..."></textarea>
            </div>

            <div class="task-card">
                <h3>Advanced NAT: Port Forwarding</h3>
                <p>Port forwarding is a specific type of NAT that redirects communication from one address/port to another. It's commonly used for:</p>
                <ul>
                    <li>Running game servers</li>
                    <li>Remote desktop access</li>
                    <li>Web servers behind NAT</li>
                </ul>
                
                <p><strong>Scenario:</strong> You want to run a Minecraft server (port 25565) on your home computer (192.168.1.50). Your router's public IP is 86.143.22.178. Describe how you would set up port forwarding.</p>
                <textarea class="input-field" id="port-forward" rows="4" placeholder="Explain the setup process..."></textarea>
            </div>

            <div class="task-card">
                <h3>Real-World Application</h3>
                <p>Design a network addressing scheme for a small company with:</p>
                <ul>
                    <li>3 departments (Sales, IT, Management)</li>
                    <li>50 total employees</li>
                    <li>Need for guest WiFi</li>
                    <li>2 servers that need external access</li>
                </ul>
                <p>Consider: Which IP ranges would you use? Where would you use static vs dynamic IPs? How would you implement security?</p>
                <textarea class="input-field" id="network-design" rows="6" placeholder="Design your network..."></textarea>
            </div>

            <div class="nav-controls">
                <button class="btn btn-secondary" onclick="previousSection()">Previous</button>
                <button class="btn btn-secondary" disabled>End of Lesson</button>
            </div>
        </section>

        <!-- Videos Placeholder -->
        <div class="section" id="videos" style="display: none;">
            <h2>📹 Recommended Videos</h2>
            <div class="task-card">
                <p>Video content would be embedded here to reinforce learning:</p>
                <ul>
                    <li>IPv4 vs IPv6 Explained</li>
                    <li>How NAT Works - Animated Guide</li>
                    <li>Setting Up Static IPs - Practical Demo</li>
                    <li>Understanding Subnet Masks</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievement-popup">
        <h3 id="achievement-title">Achievement Unlocked!</h3>
        <p id="achievement-desc">Description</p>
    </div>

    <!-- XP Indicator (will be created dynamically) -->
    
    <!-- Feedback Button -->
    <div class="feedback-btn" onclick="openFeedback()">
        <svg viewBox="0 0 24 24">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
        </svg>
    </div>

    <!-- Feedback Modal -->
    <div class="feedback-modal" id="feedback-modal">
        <div class="feedback-content">
            <h3>Send Feedback</h3>
            <p>Found a bug or have a suggestion? Let us know!</p>
            <textarea class="input-field" id="feedback-text" rows="5" placeholder="Describe the issue or suggestion..."></textarea>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn" onclick="sendFeedback()">Send</button>
                <button class="btn btn-secondary" onclick="closeFeedback()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Shame Message -->
    <div class="shame-message" id="shame-message">
        🚫 Pasting is disabled! Type your answers to learn properly! 🚫
    </div>

    <script>
        // Global variables
        let currentXP = 0;
        let currentLevel = 0;
        const XP_PER_LEVEL = 200;
        const MAX_LEVEL = 5;
        let earnedXP = new Set(); // Track XP actions to prevent duplicates
        let selectedIP = null;
        let selectedBenefit = null;
        let currentNATStep = 1;
        let achievements = [];
        let ipv4Counter = null;
        let currentSection = 'starter';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeParticles();
            initializeEventListeners();
            initializeCanvas();
            updateProgressDisplay();
            preventPasting();
        });

        // Particle system
        function initializeParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 20 + 10 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 20 + 20) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Event Listeners
        function initializeEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-pill').forEach(pill => {
                pill.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    showSection(section);
                });
            });

            // Quiz options - Event delegation
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('quiz-option')) {
                    handleQuizOption(e.target);
                }
            });

            // IP Detective options
            document.querySelectorAll('.ip-option').forEach(option => {
                option.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });

            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowLeft') {
                    previousSection();
                } else if (e.key === 'ArrowRight') {
                    nextSection();
                }
            });
        }

        // XP System
        function awardXP(amount, action, showIndicator = true) {
            if (earnedXP.has(action)) return; // Already earned
            earnedXP.add(action);
            
            currentXP += amount;
            const newLevel = Math.min(Math.floor(currentXP / XP_PER_LEVEL), MAX_LEVEL);
            
            if (newLevel > currentLevel) {
                currentLevel = newLevel;
                showAchievement('Level Up!', `You reached Level ${currentLevel}!`);
            }
            
            updateProgressDisplay();
            
            if (showIndicator) {
                showXPIndicator(amount);
            }
        }

        function updateProgressDisplay() {
            const xpInLevel = currentXP % XP_PER_LEVEL;
            const xpForNextLevel = currentLevel >= MAX_LEVEL ? XP_PER_LEVEL : XP_PER_LEVEL;
            
            document.getElementById('xp-current').textContent = currentXP;
            document.getElementById('xp-max').textContent = currentLevel >= MAX_LEVEL ? 
                (MAX_LEVEL * XP_PER_LEVEL) : ((currentLevel + 1) * XP_PER_LEVEL);
            document.getElementById('level').textContent = currentLevel;
            
            const fillPercentage = currentLevel >= MAX_LEVEL ? 100 : (xpInLevel / xpForNextLevel) * 100;
            document.getElementById('xp-fill').style.width = fillPercentage + '%';
        }

        function showXPIndicator(amount) {
            const indicator = document.createElement('div');
            indicator.className = 'xp-indicator';
            indicator.textContent = '+' + amount + ' XP';
            indicator.style.left = (Math.random() * window.innerWidth) + 'px';
            indicator.style.top = (window.innerHeight / 2) + 'px';
            document.body.appendChild(indicator);
            
            setTimeout(() => indicator.remove(), 2000);
        }

        // Achievements
        function showAchievement(title, description) {
            const popup = document.getElementById('achievement-popup');
            document.getElementById('achievement-title').textContent = title;
            document.getElementById('achievement-desc').textContent = description;
            
            popup.classList.add('show');
            achievements.push({title, description, time: new Date()});
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-pill').forEach(pill => {
                pill.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
            
            currentSection = sectionId;
            window.scrollTo(0, 0);
        }

        function nextSection() {
            const sections = ['starter', 'ipv4', 'ipv6', 'private-public', 'nat', 'static-dynamic', 'exam', 'summary', 'extension'];
            const currentIndex = sections.indexOf(currentSection);
            if (currentIndex < sections.length - 1) {
                showSection(sections[currentIndex + 1]);
            }
        }

        function previousSection() {
            const sections = ['starter', 'ipv4', 'ipv6', 'private-public', 'nat', 'static-dynamic', 'exam', 'summary', 'extension'];
            const currentIndex = sections.indexOf(currentSection);
            if (currentIndex > 0) {
                showSection(sections[currentIndex - 1]);
            }
        }

        // Starter Section Functions
        function checkDetective() {
            const selected = document.querySelectorAll('.ip-option.selected');
            const correct = document.querySelectorAll('.ip-option[data-valid="true"]');
            let score = 0;
            
            selected.forEach(option => {
                if (option.getAttribute('data-valid') === 'true') {
                    option.style.background = '#d1fae5';
                    score++;
                } else {
                    option.style.background = '#fee2e2';
                }
            });
            
            correct.forEach(option => {
                if (!option.classList.contains('selected')) {
                    option.style.border = '2px solid #10b981';
                }
            });
            
            const feedback = document.getElementById('detective-feedback');
            feedback.innerHTML = `<p class="success-msg">You found ${score} out of ${correct.length} valid IP addresses!</p>`;
            
            if (score === correct.length) {
                awardXP(50, 'detective-perfect');
                showAchievement('IP Detective', 'Found all valid IP addresses!');
            } else {
                awardXP(20, 'detective-attempt');
            }
        }

        function resetDetective() {
            document.querySelectorAll('.ip-option').forEach(option => {
                option.classList.remove('selected');
                option.style.background = '';
                option.style.border = '';
            });
            document.getElementById('detective-feedback').innerHTML = '';
        }

        // Quiz Functions
        function handleQuizOption(option) {
            const container = option.parentElement;
            const question = container.getAttribute('data-question');
            const correct = container.getAttribute('data-correct');
            
            // Remove previous selections
            container.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('correct', 'incorrect');
            });
            
            if (option.getAttribute('data-value') === correct) {
                option.classList.add('correct');
                awardXP(10, `quiz-${question}`);
            } else {
                option.classList.add('incorrect');
                // Show correct answer
                container.querySelectorAll('.quiz-option').forEach(opt => {
                    if (opt.getAttribute('data-value') === correct) {
                        opt.classList.add('correct');
                    }
                });
            }
        }

        // IPv4 Section Functions
        function updateIPv4Display() {
            const octets = [
                document.getElementById('octet1').value,
                document.getElementById('octet2').value,
                document.getElementById('octet3').value,
                document.getElementById('octet4').value
            ];
            
            const ipDisplay = document.getElementById('ipv4-example');
            ipDisplay.textContent = octets.join('.');
            
            const validation = document.getElementById('ipv4-validation');
            let isValid = true;
            let errors = [];
            
            octets.forEach((octet, index) => {
                const value = parseInt(octet);
                if (isNaN(value) || value < 0 || value > 255) {
                    isValid = false;
                    errors.push(`Octet ${index + 1} is out of range (must be 0-255)`);
                }
            });
            
            if (isValid) {
                validation.innerHTML = '<p class="success-msg">✓ Valid IPv4 address!</p>';
                awardXP(5, 'ipv4-builder-valid');
            } else {
                validation.innerHTML = '<p class="error-msg">✗ Invalid: ' + errors.join(', ') + '</p>';
            }
        }

        function generateRandomIPv4() {
            const octets = ['octet1', 'octet2', 'octet3', 'octet4'];
            octets.forEach(id => {
                document.getElementById(id).value = Math.floor(Math.random() * 256);
            });
            updateIPv4Display();
        }

        function checkIPv4Validation() {
            const answers = [
                { id: 'ipv4-val-1', correct: 'valid', reason: 'All octets within range' },
                { id: 'ipv4-val-2', correct: 'invalid', reason: '256 exceeds maximum' },
                { id: 'ipv4-val-3', correct: 'invalid', reason: 'Missing fourth octet' },
                { id: 'ipv4-val-4', correct: 'valid', reason: 'Valid network address' }
            ];
            
            let correct = 0;
            answers.forEach((answer, index) => {
                const selected = document.getElementById(answer.id).value;
                const reason = document.getElementById(`ipv4-reason-${index + 1}`).value.toLowerCase();
                
                if (selected === answer.correct && reason.length > 10) {
                    correct++;
                }
            });
            
            const feedback = document.getElementById('ipv4-validation-feedback');
            feedback.innerHTML = `<p class="success-msg">You got ${correct}/4 correct with valid reasons!</p>`;
            
            if (correct === 4) {
                awardXP(40, 'ipv4-validation-perfect');
                showAchievement('Validation Master', 'Perfect IPv4 validation!');
            } else {
                awardXP(correct * 8, 'ipv4-validation-partial');
            }
        }

        // IPv6 Section Functions
        function startIPv4Exhaustion() {
            if (ipv4Counter) return;
            
            let count = 294967296;
            const counterElement = document.getElementById('ipv4-counter');
            const messageElement = document.getElementById('exhaustion-message');
            
            ipv4Counter = setInterval(() => {
                count -= Math.floor(Math.random() * 10000 + 5000);
                counterElement.textContent = count.toLocaleString();
                
                if (count <= 100000000) {
                    messageElement.innerHTML = '<span style="color: #f59e0b;">⚠️ Running low on addresses!</span>';
                }
                
                if (count <= 0) {
                    clearInterval(ipv4Counter);
                    ipv4Counter = null;
                    counterElement.textContent = '0';
                    messageElement.innerHTML = '<span style="color: #ef4444;">❌ All IPv4 addresses exhausted! This is why we need IPv6!</span>';
                    awardXP(30, 'ipv4-exhaustion-witness');
                }
            }, 100);
        }

        function resetIPv4Exhaustion() {
            if (ipv4Counter) {
                clearInterval(ipv4Counter);
                ipv4Counter = null;
            }
            document.getElementById('ipv4-counter').textContent = '294,967,296';
            document.getElementById('exhaustion-message').innerHTML = '';
        }

        function applyIPv6Rule1() {
            const compressed = '2001:db8:0:42:0:8a2e:370:7334';
            document.getElementById('ipv6-rule1').textContent = compressed;
            document.getElementById('ipv6-rule1-result').textContent = compressed;
            awardXP(10, 'ipv6-rule1-applied');
        }

        function applyIPv6Rule2() {
            document.getElementById('ipv6-compressed').textContent = '2001:db8::42:0:8a2e:370:7334';
            awardXP(10, 'ipv6-rule2-applied');
        }

        function resetIPv6Compression() {
            document.getElementById('ipv6-rule1').textContent = 'Click to apply';
            document.getElementById('ipv6-compressed').textContent = 'Click to apply';
            document.getElementById('ipv6-rule1-result').textContent = '2001:db8:0:42:0:8a2e:370:7334';
        }

        function checkIPv6Compression() {
            const answers = [
                { id: 'ipv6-compress-1', correct: ['FE80::202:B3FF:FE1E:8329', 'fe80::202:b3ff:fe1e:8329'] },
                { id: 'ipv6-compress-2', correct: ['2001:DB8::8:800:200C:417A', '2001:db8::8:800:200c:417a'] },
                { id: 'ipv6-compress-3', correct: ['::1'] }
            ];
            
            let correct = 0;
            const feedback = document.getElementById('ipv6-compression-feedback');
            let feedbackHTML = '';
            
            answers.forEach((answer, index) => {
                const userAnswer = document.getElementById(answer.id).value.toLowerCase().trim();
                const isCorrect = answer.correct.some(c => c.toLowerCase() === userAnswer);
                
                if (isCorrect) {
                    correct++;
                    feedbackHTML += `<p class="success-msg">Question ${index + 1}: ✓ Correct!</p>`;
                } else {
                    feedbackHTML += `<p class="error-msg">Question ${index + 1}: ✗ Expected: ${answer.correct[0]}</p>`;
                }
            });
            
            feedback.innerHTML = feedbackHTML;
            
            if (correct === 3) {
                awardXP(50, 'ipv6-compression-master');
                showAchievement('Compression Expert', 'Perfect IPv6 compression!');
            } else {
                awardXP(correct * 15, 'ipv6-compression-partial');
            }
        }

        function showIPv6Hint() {
            document.getElementById('ipv6-hint').classList.add('show');
            awardXP(-5, 'ipv6-hint-used'); // Deduct XP for using hint
        }

        // Private vs Public Section Functions
        function simulateNetworkTraffic() {
            const devices = ['device1', 'router', 'internet'];
            let step = 0;
            
            const animation = setInterval(() => {
                devices.forEach(device => {
                    document.getElementById(device).classList.remove('active');
                });
                
                if (step < devices.length) {
                    document.getElementById(devices[step]).classList.add('active');
                    step++;
                } else {
                    clearInterval(animation);
                    awardXP(20, 'network-traffic-simulation');
                }
            }, 1000);
        }

        function resetNetworkSimulation() {
            ['device1', 'router', 'internet'].forEach(device => {
                document.getElementById(device).classList.remove('active');
            });
        }

        function selectIP(element) {
            if (selectedIP) {
                selectedIP.classList.remove('selected');
            }
            selectedIP = element;
            element.classList.add('selected');
        }

        function dropIP(zoneType) {
            if (!selectedIP) return;
            
            const zone = document.getElementById(zoneType + '-zone');
            const ipType = selectedIP.getAttribute('data-type');
            
            if (ipType === zoneType) {
                zone.appendChild(selectedIP);
                selectedIP.classList.remove('selected');
                selectedIP.onclick = null;
                selectedIP = null;
                awardXP(5, `ip-sort-${selectedIP.textContent}`);
            }
        }

        function checkIPSorting() {
            const privateZone = document.getElementById('private-zone');
            const publicZone = document.getElementById('public-zone');
            
            const privateCorrect = privateZone.querySelectorAll('[data-type="private"]').length;
            const publicCorrect = publicZone.querySelectorAll('[data-type="public"]').length;
            
            const total = privateCorrect + publicCorrect;
            const feedback = document.getElementById('sorting-feedback');
            
            if (total === 8) {
                feedback.innerHTML = '<p class="success-msg">Perfect! All IPs correctly sorted!</p>';
                awardXP(40, 'ip-sorting-perfect');
                showAchievement('Network Organizer', 'Correctly sorted all IP addresses!');
            } else {
                feedback.innerHTML = `<p class="error-msg">You correctly sorted ${total}/8 IP addresses.</p>`;
                awardXP(total * 4, 'ip-sorting-partial');
            }
        }

        function resetIPSorting() {
            const pool = document.getElementById('ip-pool');
            document.querySelectorAll('.draggable-item').forEach(item => {
                pool.appendChild(item);
                item.classList.remove('selected');
                item.onclick = function() { selectIP(this); };
            });
            document.getElementById('private-zone').innerHTML = '';
            document.getElementById('public-zone').innerHTML = '';
            document.getElementById('sorting-feedback').innerHTML = '';
        }

        function checkDifferences() {
            const correct = {
                'diff-1-private': 'no',
                'diff-1-public': 'yes',
                'diff-2-private': 'router',
                'diff-2-public': 'isp',
                'diff-3-private': 'high',
                'diff-3-public': 'low'
            };
            
            let score = 0;
            Object.keys(correct).forEach(id => {
                if (document.getElementById(id).value === correct[id]) {
                    score++;
                }
            });
            
            const feedback = document.getElementById('differences-feedback');
            feedback.innerHTML = `<p class="success-msg">You got ${score}/6 correct!</p>`;
            
            if (score === 6) {
                awardXP(30, 'differences-perfect');
                showAchievement('Comparison Expert', 'Perfect understanding of IP differences!');
            } else {
                awardXP(score * 4, 'differences-partial');
            }
        }

        // NAT Section Functions
        function nextNATStep() {
            if (currentNATStep < 4) {
                document.getElementById(`nat-step-${currentNATStep}`).classList.remove('active');
                currentNATStep++;
                document.getElementById(`nat-step-${currentNATStep}`).classList.add('active');
                document.getElementById('nat-current-step').textContent = currentNATStep;
                
                if (currentNATStep === 4) {
                    awardXP(30, 'nat-simulation-complete');
                }
            }
        }

        function previousNATStep() {
            if (currentNATStep > 1) {
                document.getElementById(`nat-step-${currentNATStep}`).classList.remove('active');
                currentNATStep--;
                document.getElementById(`nat-step-${currentNATStep}`).classList.add('active');
                document.getElementById('nat-current-step').textContent = currentNATStep;
            }
        }

        function resetNATSimulation() {
            document.querySelectorAll('.simulation-step').forEach(step => {
                step.classList.remove('active');
            });
            currentNATStep = 1;
            document.getElementById('nat-step-1').classList.add('active');
            document.getElementById('nat-current-step').textContent = '1';
        }

        function checkNATTable() {
            const port1 = document.getElementById('nat-port-1').value;
            const ip1 = document.getElementById('nat-ip-1').value;
            
            let feedback = '';
            let correct = 0;
            
            // Port should be a 5-digit number
            if (port1.match(/^\d{5}$/) && parseInt(port1) > 1024 && parseInt(port1) < 65536) {
                feedback += '<p class="success-msg">✓ Valid external port!</p>';
                correct++;
            } else {
                feedback += '<p class="error-msg">✗ Port should be between 1024-65535</p>';
            }
            
            // IP should match private IP pattern with port
            if (ip1.match(/^192\.168\.1\.\d{1,3}:\d{4,5}$/)) {
                feedback += '<p class="success-msg">✓ Valid internal IP:Port format!</p>';
                correct++;
            } else {
                feedback += '<p class="error-msg">✗ Expected format: 192.168.1.X:PORT</p>';
            }
            
            document.getElementById('nat-table-feedback').innerHTML = feedback;
            awardXP(correct * 15, 'nat-table-completion');
        }

        function checkNATBenefits() {
            const correctBenefits = ['security', 'conservation', 'flexibility'];
            let selected = [];
            
            for (let i = 1; i <= 5; i++) {
                const checkbox = document.getElementById(`nat-benefit-${i}`);
                if (checkbox.checked) {
                    selected.push(checkbox.value);
                }
            }
            
            let correct = 0;
            let incorrect = 0;
            
            selected.forEach(benefit => {
                if (correctBenefits.includes(benefit)) {
                    correct++;
                } else {
                    incorrect++;
                }
            });
            
            const feedback = document.getElementById('nat-benefits-feedback');
            
            if (correct === 3 && incorrect === 0) {
                feedback.innerHTML = '<p class="success-msg">Perfect! You identified all NAT benefits correctly!</p>';
                awardXP(40, 'nat-benefits-perfect');
            } else {
                feedback.innerHTML = `<p class="error-msg">You got ${correct} correct but selected ${incorrect} incorrect options.</p>`;
                awardXP(correct * 10, 'nat-benefits-partial');
            }
        }

        // Static vs Dynamic Section Functions
        function checkScenarios() {
            const scenarios = [
                { id: 'scenario-1', correct: 'static', keywords: ['dns', 'access', 'constant', 'reliable'] },
                { id: 'scenario-2', correct: 'dynamic', keywords: ['temporary', 'security', 'automatic', 'dhcp'] },
                { id: 'scenario-3', correct: 'static', keywords: ['remote', 'constant', 'access', 'fixed'] },
                { id: 'scenario-4', correct: 'dynamic', keywords: ['home', 'automatic', 'easy', 'dhcp'] }
            ];
            
            let score = 0;
            let feedback = '';
            
            scenarios.forEach((scenario, index) => {
                const choice = document.getElementById(scenario.id).value;
                const reason = document.getElementById(`${scenario.id}-reason`).value.toLowerCase();
                
                if (choice === scenario.correct) {
                    const hasKeyword = scenario.keywords.some(keyword => reason.includes(keyword));
                    if (hasKeyword && reason.length > 15) {
                        score++;
                        feedback += `<p class="success-msg">Scenario ${index + 1}: ✓ Correct choice with good reasoning!</p>`;
                    } else {
                        feedback += `<p class="error-msg">Scenario ${index + 1}: ✓ Correct choice but explanation needs improvement</p>`;
                    }
                } else {
                    feedback += `<p class="error-msg">Scenario ${index + 1}: ✗ Incorrect - ${scenario.correct} IP would be better</p>`;
                }
            });
            
            document.getElementById('scenario-feedback').innerHTML = feedback;
            
            if (score === 4) {
                awardXP(50, 'scenarios-perfect');
                showAchievement('Decision Maker', 'Perfect scenario analysis!');
            } else {
                awardXP(score * 10, 'scenarios-partial');
            }
        }

        function selectBenefit(element) {
            if (selectedBenefit) {
                selectedBenefit.classList.remove('selected');
            }
            selectedBenefit = element;
            element.classList.add('selected');
        }

        function dropBenefit(category) {
            if (!selectedBenefit) return;
            
            const benefitCategory = selectedBenefit.getAttribute('data-category');
            
            if (benefitCategory === category) {
                let targetId;
                switch(category) {
                    case 'static-benefit': targetId = 'static-benefits'; break;
                    case 'static-drawback': targetId = 'static-drawbacks'; break;
                    case 'dynamic-benefit': targetId = 'dynamic-benefits'; break;
                    case 'dynamic-drawback': targetId = 'dynamic-drawbacks'; break;
                }
                
                document.getElementById(targetId).appendChild(selectedBenefit);
                selectedBenefit.classList.remove('selected');
                selectedBenefit.onclick = null;
                selectedBenefit = null;
                awardXP(5, `benefit-sort-${category}`);
            }
        }

        function checkBenefitsSorting() {
            const categories = [
                { id: 'static-benefits', expected: 3 },
                { id: 'static-drawbacks', expected: 2 },
                { id: 'dynamic-benefits', expected: 2 },
                { id: 'dynamic-drawbacks', expected: 1 }
            ];
            
            let totalCorrect = 0;
            
            categories.forEach(cat => {
                const items = document.getElementById(cat.id).children.length;
                if (items === cat.expected) {
                    totalCorrect += items;
                }
            });
            
            const feedback = document.getElementById('benefits-sorting-feedback');
            
            if (totalCorrect === 8) {
                feedback.innerHTML = '<p class="success-msg">Excellent! All benefits and drawbacks correctly sorted!</p>';
                awardXP(50, 'benefits-sorting-perfect');
                showAchievement('Pros & Cons Master', 'Perfect benefit/drawback analysis!');
            } else {
                feedback.innerHTML = `<p class="error-msg">You correctly sorted ${totalCorrect}/8 items.</p>`;
                awardXP(totalCorrect * 5, 'benefits-sorting-partial');
            }
        }

        function resetBenefitsSorting() {
            const pool = document.getElementById('benefits-pool');
            document.querySelectorAll('.draggable-item[data-category]').forEach(item => {
                pool.appendChild(item);
                item.classList.remove('selected');
                item.onclick = function() { selectBenefit(this); };
            });
            
            ['static-benefits', 'static-drawbacks', 'dynamic-benefits', 'dynamic-drawbacks'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            
            document.getElementById('benefits-sorting-feedback').innerHTML = '';
        }

        // Exam Section Functions
        function showMarkScheme(questionId) {
            const predicted = parseInt(document.getElementById(`${questionId}-predicted`).value) || 0;
            const maxMarks = {
                'q1': 4,
                'q2': 3,
                'q3': 2,
                'q4': 3,
                'q5': 4
            };
            
            // Check if they've made a reasonable attempt
            let hasAttempted = false;
            
            switch(questionId) {
                case 'q1':
                    hasAttempted = document.getElementById('exam-q1-1').value.length > 0;
                    break;
                case 'q2':
                    hasAttempted = document.getElementById('exam-q2').value.length > 50;
                    break;
                case 'q3':
                    hasAttempted = document.getElementById('exam-q3').value.length > 30;
                    break;
                case 'q4':
                    hasAttempted = document.getElementById('exam-q4').value.length > 40;
                    break;
                case 'q5':
                    hasAttempted = document.getElementById('exam-q5a').value.length > 10;
                    break;
            }
            
            if (!hasAttempted) {
                alert('Please make a reasonable attempt at the question before viewing the mark scheme.');
                return;
            }
            
            document.getElementById(`mark-scheme-${questionId}`).classList.add('show');
            awardXP(20, `exam-${questionId}-attempt`);
            
            // Award bonus XP for accurate self-assessment
            if (predicted === maxMarks[questionId]) {
                awardXP(10, `exam-${questionId}-accurate-prediction`);
            }
        }

        // Canvas Functions
        function initializeCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;

            function getCoordinates(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                if (e.touches) {
                    return {
                        x: (e.touches[0].clientX - rect.left) * scaleX,
                        y: (e.touches[0].clientY - rect.top) * scaleY
                    };
                } else {
                    return {
                        x: (e.clientX - rect.left) * scaleX,
                        y: (e.clientY - rect.top) * scaleY
                    };
                }
            }

            function startDrawing(e) {
                isDrawing = true;
                const coords = getCoordinates(e);
                lastX = coords.x;
                lastY = coords.y;
            }

            function draw(e) {
                if (!isDrawing) return;
                
                e.preventDefault();
                const coords = getCoordinates(e);
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(coords.x, coords.y);
                ctx.strokeStyle = '#4f46e5';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                lastX = coords.x;
                lastY = coords.y;
            }

            function stopDrawing() {
                isDrawing = false;
            }

            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Touch events
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function clearCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Summary Section Functions
        function checkSummaryQuiz() {
            const questions = document.querySelectorAll('#summary .quiz-question');
            let correct = 0;
            
            questions.forEach(question => {
                const options = question.querySelector('.quiz-options');
                const correctAnswer = options.getAttribute('data-correct');
                const selected = options.querySelector('.quiz-option.correct, .quiz-option.incorrect');
                
                if (selected && selected.getAttribute('data-value') === correctAnswer) {
                    correct++;
                }
            });
            
            const feedback = document.getElementById('summary-feedback');
            const percentage = (correct / questions.length * 100).toFixed(0);
            
            feedback.innerHTML = `
                <h4>Results: ${correct}/${questions.length} (${percentage}%)</h4>
                <p>${percentage >= 80 ? 'Excellent work!' : percentage >= 60 ? 'Good effort!' : 'Review the material and try again.'}</p>
            `;
            
            if (percentage >= 80) {
                awardXP(100, 'summary-quiz-excellent');
                showAchievement('IP Master', 'Excellent performance on the final assessment!');
            } else if (percentage >= 60) {
                awardXP(60, 'summary-quiz-good');
            } else {
                awardXP(30, 'summary-quiz-attempt');
            }
            
            // Update progress summary
            updateProgressSummary();
        }

        function updateProgressSummary() {
            const summary = document.getElementById('progress-summary');
            const completionPercentage = (earnedXP.size / 50 * 100).toFixed(0); // Estimate based on possible actions
            
            summary.innerHTML = `
                <h4>Your Learning Journey</h4>
                <ul>
                    <li><strong>Total XP Earned:</strong> ${currentXP}</li>
                    <li><strong>Current Level:</strong> ${currentLevel}</li>
                    <li><strong>Achievements Unlocked:</strong> ${achievements.length}</li>
                    <li><strong>Activities Completed:</strong> ${earnedXP.size}</li>
                    <li><strong>Estimated Completion:</strong> ${completionPercentage}%</li>
                </ul>
                ${currentLevel >= MAX_LEVEL ? '<p class="success-msg">🎉 Congratulations! You\'ve reached the maximum level!</p>' : ''}
            `;
        }

        // Extension Section Functions
        function checkSubnetChallenge() {
            const answer = document.getElementById('subnet-challenge').value.trim();
            const feedback = document.getElementById('subnet-feedback');
            
            if (answer.toLowerCase() === '172.16.0.0') {
                feedback.innerHTML = '<p class="success-msg">Correct! With a /16 mask (255.255.0.0), the network portion is the first two octets.</p>';
                awardXP(30, 'subnet-challenge-correct');
            } else {
                feedback.innerHTML = '<p class="error-msg">Not quite. Remember, 255.255.0.0 means the first two octets are the network portion.</p>';
            }
        }

        // Feedback System
        function openFeedback() {
            document.getElementById('feedback-modal').classList.add('show');
        }

        function closeFeedback() {
            document.getElementById('feedback-modal').classList.remove('show');
        }

        function sendFeedback() {
            const feedbackText = document.getElementById('feedback-text').value;
            if (feedbackText.length < 10) {
                alert('Please provide more detailed feedback.');
                return;
            }
            
            // Get current section and relevant code context
            const currentSectionElement = document.querySelector('.section.active');
            const sectionTitle = currentSectionElement.querySelector('h2').textContent;
            
            // Create email content
            const emailBody = `
Feedback from IP Addressing Lesson
Section: ${sectionTitle}
Page URL: ${window.location.href}
User Agent: ${navigator.userAgent}

Feedback:
${feedbackText}

Context:
Current Level: ${currentLevel}
Current XP: ${currentXP}
Section ID: ${currentSection}
            `;
            
            // Create mailto link
            const mailtoLink = `mailto:millingtond@mgs.org?subject=IP Addressing Lesson Feedback&body=${encodeURIComponent(emailBody)}`;
            window.location.href = mailtoLink;
            
            closeFeedback();
            showAchievement('Feedback Hero', 'Thanks for helping improve the lesson!');
            awardXP(20, 'feedback-submitted');
        }

        // Prevent Pasting
        function preventPasting() {
            document.addEventListener('paste', function(e) {
                e.preventDefault();
                
                const shameMessage = document.getElementById('shame-message');
                shameMessage.style.display = 'block';
                
                setTimeout(() => {
                    shameMessage.style.display = 'none';
                }, 3000);
                
                return false;
            });
            
            // Also prevent context menu on input fields
            document.addEventListener('contextmenu', function(e) {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    e.preventDefault();
                    return false;
                }
            });
        }

        // Utility Functions
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + S to save progress (just show a message)
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                showAchievement('Progress Saved', 'Your progress is automatically saved!');
            }
            
            // Escape to close modals
            if (e.key === 'Escape') {
                closeFeedback();
            }
        });

        // Performance optimizations
        const handleScroll = debounce(function() {
            // Update active nav pill based on scroll position
            const sections = document.querySelectorAll('.section');
            const scrollPosition = window.scrollY + 200;
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionBottom = sectionTop + section.offsetHeight;
                
                if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                    const sectionId = section.id;
                    document.querySelectorAll('.nav-pill').forEach(pill => {
                        pill.classList.remove('active');
                    });
                    const activePill = document.querySelector(`[data-section="${sectionId}"]`);
                    if (activePill) {
                        activePill.classList.add('active');
                    }
                }
            });
        }, 100);

        // Add scroll listener
        window.addEventListener('scroll', handleScroll);

        // Initialize first achievement
        setTimeout(() => {
            showAchievement('Welcome!', 'Started IP Addressing lesson');
            awardXP(10, 'lesson-started');
        }, 1000);

        // Check for reduced motion preference
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
            document.documentElement.style.setProperty('--animation-duration', '0.01s');
        }
    </script>
</body>
</html>