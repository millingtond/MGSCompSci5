<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Topologies - A Level Computer Science</title>
    <style>
        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary-color: #8b5cf6;
            --secondary-dark: #7c3aed;
            --success-color: #10b981;
            --success-dark: #059669;
            --error-color: #ef4444;
            --error-dark: #dc2626;
            --warning-color: #f59e0b;
            --warning-dark: #d97706;
            --bg-color: #ffffff;
            --bg-secondary: #f8fafc;
            --text-color: #1e293b;
            --text-secondary: #64748b;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --highlight-color: #fef3c7;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            --gradient-gold: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --animation-duration: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Performance: Use transform for animations */
        * {
            will-change: auto;
        }

        /* High Contrast Mode */
        body.high-contrast {
            --bg-color: #000000;
            --bg-secondary: #0a0a0a;
            --text-color: #ffffff;
            --text-secondary: #e0e0e0;
            --card-bg: #1a1a1a;
            --border-color: #ffffff;
            --primary-color: #00ff00;
            --secondary-color: #ffff00;
            --gradient-primary: linear-gradient(135deg, #00ff00 0%, #ffff00 100%);
        }

        /* Dyslexia-Friendly Font */
        body.dyslexia-font {
            font-family: 'Comic Sans MS', 'OpenDyslexic', sans-serif;
            letter-spacing: 0.05em;
            word-spacing: 0.1em;
            line-height: 1.8;
        }

        /* Modern Glass Header */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 1.5rem 1rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-lg);
        }

        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, transparent 50%, rgba(255,255,255,0.1) 100%);
            pointer-events: none;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Modern XP Container */
        .xp-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255,255,255,0.15);
            padding: 0.5rem 1.5rem;
            border-radius: 2rem;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
            transition: transform var(--animation-duration) ease;
        }

        .xp-container:hover {
            transform: translateY(-2px);
        }

        .xp-bar {
            width: 200px;
            height: 24px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }

        .xp-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .level-badge {
            font-size: 1.1rem;
            font-weight: 700;
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.3);
        }

        /* Modern Navigation */
        .nav-container {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(20px);
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 80px;
            z-index: 999;
            box-shadow: var(--shadow-md);
        }

        .nav-pills {
            display: flex;
            gap: 0.75rem;
            overflow-x: auto;
            padding: 0.5rem;
            max-width: 1200px;
            margin: 0 auto;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }

        .nav-pills::-webkit-scrollbar {
            display: none;
        }

        .nav-pill {
            padding: 0.625rem 1.25rem;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 2rem;
            cursor: pointer;
            white-space: nowrap;
            transition: all var(--animation-duration) cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.875rem;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav-pill::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--primary-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .nav-pill:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .nav-pill:hover::before {
            width: 100%;
            height: 100%;
        }

        .nav-pill.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .nav-pill.completed {
            border-color: var(--success-color);
            position: relative;
        }

        .nav-pill.completed::after {
            content: '‚úì';
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--gradient-success);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            box-shadow: var(--shadow-md);
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            min-height: calc(100vh - 200px);
        }

        .section {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Modern Cards */
        .card {
            background: var(--card-bg);
            border-radius: 1.5rem;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: transform var(--animation-duration) ease, box-shadow var(--animation-duration) ease;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.6s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card-title {
            font-size: 1.75rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-title span {
            font-size: 2rem;
            -webkit-text-fill-color: initial;
        }

        /* Interactive Areas */
        .interactive-area {
            background: var(--bg-secondary);
            border: 2px dashed var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin: 1.5rem 0;
            min-height: 120px;
            position: relative;
            transition: all var(--animation-duration) ease;
        }

        .interactive-area:hover {
            border-color: var(--primary-light);
            background: rgba(99, 102, 241, 0.02);
        }

        .highlight-active {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.05);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
            50% { box-shadow: 0 0 0 12px rgba(99, 102, 241, 0); }
        }

        /* Modern Buttons */
        .btn {
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--animation-duration) cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            text-transform: none;
            letter-spacing: 0.025em;
            touch-action: manipulation;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-color);
            border: 2px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), var(--success-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--error-color), var(--error-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        /* Modern Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            border-radius: 1.5rem;
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-xl);
            transform: translateX(400px);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2000;
            max-width: 320px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .achievement-popup::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-gold);
        }

        .achievement-popup.show {
            transform: translateX(0);
        }

        .achievement-icon {
            font-size: 3.5rem;
            text-align: center;
            margin-bottom: 0.75rem;
            animation: bounceRotate 0.6s ease;
        }

        @keyframes bounceRotate {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        /* Quiz Elements */
        .quiz-option {
            display: block;
            width: 100%;
            padding: 1.25rem;
            margin: 0.75rem 0;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            text-align: left;
            cursor: pointer;
            transition: all var(--animation-duration) cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            font-weight: 500;
        }

        .quiz-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .quiz-option:hover {
            background: var(--bg-secondary);
            border-color: var(--primary-light);
            transform: translateX(8px);
            box-shadow: var(--shadow-md);
        }

        .quiz-option:hover::before {
            left: 100%;
        }

        .quiz-option.selected {
            background: var(--gradient-primary);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .quiz-option.correct {
            background: linear-gradient(135deg, var(--success-color), var(--success-dark));
            color: white;
            border-color: var(--success-color);
            animation: correctAnswer 0.6s ease;
        }

        .quiz-option.incorrect {
            background: linear-gradient(135deg, var(--error-color), var(--error-dark));
            color: white;
            border-color: var(--error-color);
            animation: shake 0.5s ease;
        }

        @keyframes correctAnswer {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Modern Input Fields */
        .input-field {
            width: 100%;
            padding: 0.875rem 1.25rem;
            border: 2px solid var(--border-color);
            border-radius: 0.75rem;
            font-size: 1rem;
            transition: all var(--animation-duration) ease;
            background: var(--card-bg);
            font-family: inherit;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            background: white;
        }

        .input-field::placeholder {
            color: var(--text-secondary);
        }

        /* Modern Matching Container */
        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        .draggable-item, .drop-zone {
            padding: 1.25rem;
            margin: 0.75rem 0;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            cursor: pointer;
            transition: all var(--animation-duration) cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            touch-action: manipulation;
            position: relative;
            font-weight: 500;
        }

        .draggable-item:hover {
            background: var(--bg-secondary);
            transform: translateY(-2px) scale(1.02);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .draggable-item.selected {
            background: var(--gradient-primary);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .draggable-item.matched {
            opacity: 0.5;
            transform: scale(0.95);
            pointer-events: none;
        }

        .drop-zone {
            min-height: 80px;
            border-style: dashed;
            border-width: 3px;
            background: var(--bg-secondary);
        }

        .drop-zone.highlight {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--primary-color);
            animation: dropZonePulse 1s infinite;
        }

        @keyframes dropZonePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .drop-zone.correct {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border-color: var(--success-color);
        }

        /* Network Topology Visualization */
        .topology-viewer {
            background: #1a1b26;
            border-radius: 1rem;
            padding: 2rem;
            margin: 1.5rem 0;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .topology-canvas {
            background: #1a1b26;
            border-radius: 0.5rem;
            width: 100%;
            height: 400px;
            position: relative;
            cursor: crosshair;
        }

        .network-node {
            position: absolute;
            width: 80px;
            height: 80px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: var(--shadow-md);
            transition: all var(--animation-duration) ease;
            z-index: 10;
            cursor: pointer;
        }

        .network-node:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.6);
        }

        .network-node.active {
            animation: nodePulse 1s infinite;
        }

        @keyframes nodePulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.6); }
            50% { transform: scale(1.1); box-shadow: 0 0 20px 10px rgba(99, 102, 241, 0); }
        }

        .network-cable {
            position: absolute;
            background: #4a5568;
            height: 4px;
            transform-origin: left center;
            z-index: 1;
            transition: background var(--animation-duration) ease;
        }

        .network-cable.active {
            background: var(--warning-color);
            box-shadow: 0 0 10px var(--warning-color);
            animation: dataFlow 1s linear infinite;
        }

        @keyframes dataFlow {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }

        .network-switch {
            width: 100px;
            height: 100px;
            background: var(--secondary-color);
            border-radius: 1rem;
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: var(--shadow-lg);
        }

        /* Simulation Controls */
        .simulation-controls {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .sim-step-indicator {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border-radius: 2rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .sim-step {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border-color);
            transition: all var(--animation-duration) ease;
        }

        .sim-step.active {
            background: var(--primary-color);
            transform: scale(1.5);
            box-shadow: 0 0 10px var(--primary-color);
        }

        .sim-step.completed {
            background: var(--success-color);
        }

        /* Code Display */
        .code-display {
            background: #1a1b26;
            color: #a9b1d6;
            padding: 1.75rem;
            border-radius: 1rem;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.95rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            line-height: 1.6;
            box-shadow: var(--shadow-lg);
            position: relative;
        }

        .code-display::before {
            content: 'CSMA/CD';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 0.75rem;
            color: #565f89;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .code-keyword {
            color: #bb9af7;
            font-weight: 600;
        }

        .code-string {
            color: #9ece6a;
        }

        .code-comment {
            color: #565f89;
            font-style: italic;
        }

        /* Drawing Canvas */
        .drawing-canvas {
            border: 3px solid var(--border-color);
            border-radius: 1rem;
            background: white;
            touch-action: none;
            cursor: crosshair;
            margin: 1.5rem 0;
            box-shadow: var(--shadow-md);
            transition: border-color var(--animation-duration) ease;
        }

        .drawing-canvas:hover {
            border-color: var(--primary-light);
        }

        /* Modern Feedback Button */
        .feedback-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all var(--animation-duration) cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            font-size: 1.5rem;
        }

        .feedback-btn:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: var(--shadow-xl);
        }

        .feedback-btn:active {
            transform: scale(0.95);
        }

        /* Modern Modal */
        .feedback-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .feedback-content {
            background: white;
            padding: 2.5rem;
            border-radius: 1.5rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Modern Accessibility Controls */
        .accessibility-controls {
            position: fixed;
            top: 150px;
            right: 20px;
            background: white;
            border-radius: 1rem;
            padding: 1.25rem;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            border: 1px solid var(--border-color);
            transition: transform var(--animation-duration) ease;
        }

        .accessibility-controls:hover {
            transform: translateX(-5px);
        }

        .accessibility-controls h4 {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .accessibility-controls button {
            display: block;
            width: 100%;
            margin: 0.5rem 0;
            padding: 0.625rem;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all var(--animation-duration) ease;
            font-weight: 500;
        }

        .accessibility-controls button:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateX(-2px);
        }

        /* Progress Indicators */
        .progress-indicator {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-color);
            transition: all var(--animation-duration) ease;
            cursor: pointer;
        }

        .progress-dot:hover {
            transform: scale(1.2);
        }

        .progress-dot.active {
            background: var(--primary-color);
            transform: scale(1.5);
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
        }

        .progress-dot.completed {
            background: var(--success-color);
            position: relative;
        }

        .progress-dot.completed::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.6rem;
            font-weight: bold;
        }

        /* Shame Message */
        .shame-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, var(--error-color), var(--error-dark));
            color: white;
            padding: 2rem 3rem;
            border-radius: 1.5rem;
            font-size: 1.25rem;
            font-weight: bold;
            text-align: center;
            z-index: 3000;
            box-shadow: var(--shadow-xl);
            animation: shameAnimation 3s ease forwards;
        }

        @keyframes shameAnimation {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); }
            20% { transform: translate(-50%, -50%) scale(1.2) rotate(-5deg); }
            40% { transform: translate(-50%, -50%) scale(0.9) rotate(5deg); }
            60% { transform: translate(-50%, -50%) scale(1) rotate(-5deg); }
            80% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
            100% { transform: translate(-50%, -50%) scale(0) rotate(0deg); }
        }

        /* Modern Hint Container */
        .hint-container {
            margin-top: 1rem;
            padding: 1.25rem;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
            border-left: 4px solid var(--warning-color);
            border-radius: 0.75rem;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .hint-container.show {
            display: block;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mark Scheme */
        .mark-scheme {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border: 2px solid var(--success-color);
            border-radius: 1rem;
            padding: 2rem;
            margin-top: 1.5rem;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .mark-scheme.show {
            display: block;
        }

        .mark-scheme h5 {
            color: var(--success-dark);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        /* Font Size Controls */
        .font-size-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-top: 0.5rem;
        }

        .font-size-controls button {
            padding: 0.5rem 0.75rem;
            margin: 0;
        }

        body.font-small { font-size: 14px; }
        body.font-large { font-size: 18px; }
        body.font-xlarge { font-size: 20px; }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid transparent;
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Performance Optimizations */
        .section:not(.active) {
            visibility: hidden;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.25rem;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .xp-container {
                width: 100%;
                justify-content: center;
            }

            .xp-bar {
                width: 150px;
            }

            .matching-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .nav-container {
                top: 140px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .accessibility-controls {
                top: auto;
                bottom: 90px;
                right: 10px;
                padding: 1rem;
            }

            .card {
                padding: 1.5rem;
            }

            .achievement-popup {
                right: 10px;
                left: 10px;
                max-width: none;
            }

            .interactive-area {
                padding: 1.5rem;
            }
        }

        /* Print Styles */
        @media print {
            .header, .nav-container, .feedback-btn, .accessibility-controls, .btn {
                display: none !important;
            }

            .section {
                display: block !important;
                opacity: 1 !important;
                transform: none !important;
                page-break-after: always;
            }

            .card {
                box-shadow: none;
                border: 1px solid #000;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 6px;
            border: 2px solid var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* Particle Container */
        #particle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2999;
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            animation: particleFall 2s linear forwards;
        }

        @keyframes particleFall {
            to {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        /* Exam Question Styling */
        .exam-question {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 1rem;
            margin: 1.5rem 0;
            border: 2px solid var(--border-color);
        }

        .exam-question h4 {
            color: var(--primary-dark);
            margin-bottom: 1rem;
        }

        .marks-input {
            width: 60px;
            padding: 0.5rem;
            margin-left: 0.5rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
        }

        /* Success Animation */
        @keyframes successPulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        .success-animation {
            animation: successPulse 1s ease;
        }

        /* Simulation Message */
        .sim-message {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1rem;
            font-size: 0.95rem;
            color: var(--text-secondary);
            min-height: 60px;
            display: flex;
            align-items: center;
            border: 1px solid var(--border-color);
        }

        .sim-message.active {
            border-color: var(--primary-color);
            color: var(--text-color);
            background: rgba(99, 102, 241, 0.05);
        }

        /* Table Styles */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: var(--card-bg);
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .comparison-table th,
        .comparison-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .comparison-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: var(--bg-secondary);
        }

        .comparison-table tr:last-child td {
            border-bottom: none;
        }

        /* Network Packet Animation */
        .network-packet {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--warning-color);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--warning-color);
            z-index: 20;
            opacity: 0;
            pointer-events: none;
        }

        .network-packet.active {
            opacity: 1;
            animation: packetMove 2s linear;
        }

        @keyframes packetMove {
            0% { transform: translateX(0); }
            100% { transform: translateX(300px); }
        }

        /* Common Mistakes Section */
        .mistake-item {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            padding: 1rem;
            margin: 0.75rem 0;
            border-radius: 0.75rem;
            border-left: 4px solid var(--error-color);
        }

        .mistake-item::before {
            content: '‚ö†Ô∏è ';
            font-size: 1.2rem;
        }

        /* Real World Context */
        .real-world-example {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(139, 92, 246, 0.05));
            padding: 1.5rem;
            border-radius: 1rem;
            margin: 1.5rem 0;
            border: 2px solid var(--secondary-color);
        }

        .real-world-example h5 {
            color: var(--secondary-dark);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .real-world-example h5::before {
            content: 'üåç';
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-content">
            <h1>Network Topologies - A Level Computer Science</h1>
            <div class="xp-container" role="status" aria-live="polite">
                <span class="level-badge">Level <span id="current-level">1</span></span>
                <div class="xp-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <div class="xp-fill" id="xp-fill" style="width: 0%"></div>
                </div>
                <span id="xp-text">0 / 100 XP</span>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-container" role="navigation" aria-label="Lesson sections">
        <div class="nav-pills" id="nav-pills">
            <button class="nav-pill active" data-section="intro" aria-current="page">Introduction</button>
            <button class="nav-pill" data-section="starter">Starter Activity</button>
            <button class="nav-pill" data-section="bus">Bus Topology</button>
            <button class="nav-pill" data-section="star">Star Topology</button>
            <button class="nav-pill" data-section="mesh">Mesh Topology</button>
            <button class="nav-pill" data-section="comparison">Comparison</button>
            <button class="nav-pill" data-section="csmacd">CSMA/CD Deep Dive</button>
            <button class="nav-pill" data-section="practice">Practice Questions</button>
            <button class="nav-pill" data-section="summary">Summary Quiz</button>
            <button class="nav-pill" data-section="extension">Extension</button>
            <button class="nav-pill" data-section="videos">Videos</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" role="main">
        <!-- Introduction Section -->
        <section id="intro" class="section active">
            <div class="card">
                <h2 class="card-title">
                    <span>üåê</span> Welcome to Network Topologies!
                </h2>
                <div class="progress-indicator" role="group" aria-label="Section progress">
                    <span class="progress-dot active" title="Current section"></span>
                    <span class="progress-dot" title="Not started"></span>
                    <span class="progress-dot" title="Not started"></span>
                    <span class="progress-dot" title="Not started"></span>
                </div>
                
                <h3>Learning Outcomes</h3>
                <ul style="margin: 1rem 0; padding-left: 1.5rem; line-height: 1.8;">
                    <li>Show understanding of bus, star, mesh and hybrid topologies</li>
                    <li>Understand how packets are transmitted between hosts for each topology</li>
                    <li>Justify the use of a topology for a given situation</li>
                    <li>Describe how CSMA/CD is used in a bus network</li>
                    <li>Compare advantages and disadvantages of different topologies</li>
                </ul>

                <div class="interactive-area highlight-active">
                    <h4>Pre-Assessment: What Do You Already Know?</h4>
                    <p>Test your existing knowledge of network topologies!</p>
                    
                    <div id="pre-quiz">
                        <p><strong>Question 1:</strong> In which topology do all devices connect to a central device?</p>
                        <button class="quiz-option" data-answer="a">Mesh topology</button>
                        <button class="quiz-option" data-answer="b">Bus topology</button>
                        <button class="quiz-option" data-answer="c">Star topology</button>
                        <button class="quiz-option" data-answer="d">Ring topology</button>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkPreQuiz()" style="margin-top: 1rem;">
                        Check Answer
                    </button>
                </div>

                <div class="real-world-example">
                    <h5>Real-World Context</h5>
                    <p>Network topologies are used everywhere - from your home WiFi (star topology with router as central device) to the internet itself (massive mesh topology). Understanding these helps you design efficient networks and troubleshoot connection issues.</p>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="navigateSection('next')">
                        Start Learning ‚Üí
                    </button>
                </div>
            </div>
        </section>

        <!-- Starter Activity -->
        <section id="starter" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>üéØ</span> Starter Activity: Quick Knowledge Check
                </h2>
                
                <p>Before we dive in, let's see what you might already know about network structures!</p>
                
                <div class="interactive-area">
                    <h4>Fill in the Blanks</h4>
                    <p>Complete these sentences by selecting the correct terms:</p>
                    
                    <div style="margin: 1.5rem 0;">
                        <p>1. A network where all computers connect to one central device uses a 
                            <select class="input-field" style="width: 150px; display: inline-block;" id="blank1">
                                <option value="">Choose...</option>
                                <option value="star">star</option>
                                <option value="bus">bus</option>
                                <option value="mesh">mesh</option>
                                <option value="ring">ring</option>
                                <option value="tree">tree</option>
                                <option value="hybrid">hybrid</option>
                            </select>
                            topology.
                        </p>
                        
                        <p style="margin-top: 1rem;">2. When two devices transmit at the same time on a shared cable, this is called a 
                            <select class="input-field" style="width: 150px; display: inline-block;" id="blank2">
                                <option value="">Choose...</option>
                                <option value="collision">collision</option>
                                <option value="broadcast">broadcast</option>
                                <option value="multicast">multicast</option>
                                <option value="unicast">unicast</option>
                                <option value="error">error</option>
                                <option value="fault">fault</option>
                            </select>.
                        </p>
                        
                        <p style="margin-top: 1rem;">3. A topology where every device connects to multiple other devices is called a 
                            <select class="input-field" style="width: 150px; display: inline-block;" id="blank3">
                                <option value="">Choose...</option>
                                <option value="mesh">mesh</option>
                                <option value="star">star</option>
                                <option value="bus">bus</option>
                                <option value="ring">ring</option>
                                <option value="linear">linear</option>
                                <option value="central">central</option>
                            </select>
                            topology.
                        </p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkFillBlanks()">Check Answers</button>
                    <button class="btn btn-secondary" onclick="resetFillBlanks()">Reset</button>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- Bus Topology Section -->
        <section id="bus" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>üöå</span> Bus Topology
                </h2>
                
                <div class="interactive-area">
                    <h4>Bus Topology Characteristics</h4>
                    <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                        <li>Uses a single central cable (the "bus") for all connections</li>
                        <li>Data travels in only one direction at a time</li>
                        <li>Only one device can transmit simultaneously</li>
                        <li>Requires terminators at each end to prevent signal bounce</li>
                        <li>Uses broadcasting - all devices receive all packets</li>
                        <li>Devices check MAC addresses to identify their packets</li>
                        <li>Needs collision handling (CSMA/CD) due to shared transmission path</li>
                    </ul>
                </div>

                <div class="topology-viewer">
                    <h4 style="color: white; margin-bottom: 1rem;">Interactive Bus Topology Simulation</h4>
                    <div class="topology-canvas" id="bus-canvas">
                        <!-- Bus topology will be drawn here -->
                    </div>
                    <div class="simulation-controls">
                        <button class="btn btn-secondary" onclick="resetBusSimulation()">Reset</button>
                        <button class="btn btn-primary" onclick="simulateBusTransmission()">Simulate Transmission</button>
                        <div class="sim-step-indicator">
                            <span>Step:</span>
                            <span class="sim-step active" id="bus-step-1"></span>
                            <span class="sim-step" id="bus-step-2"></span>
                            <span class="sim-step" id="bus-step-3"></span>
                            <span class="sim-step" id="bus-step-4"></span>
                        </div>
                    </div>
                    <div class="sim-message" id="bus-sim-message">
                        Click "Simulate Transmission" to see how data travels on a bus network
                    </div>
                </div>

                <div class="interactive-area highlight-active" style="margin-top: 2rem;">
                    <h4>Bus Topology Quiz</h4>
                    <p>Which statement about bus topology is <strong>FALSE</strong>?</p>
                    
                    <button class="quiz-option" onclick="checkBusQuiz('a')">
                        All devices share the same transmission medium
                    </button>
                    <button class="quiz-option" onclick="checkBusQuiz('b')">
                        Multiple devices can transmit simultaneously without issues
                    </button>
                    <button class="quiz-option" onclick="checkBusQuiz('c')">
                        A break in the cable affects the entire network
                    </button>
                    <button class="quiz-option" onclick="checkBusQuiz('d')">
                        Terminators are needed at both ends of the cable
                    </button>
                </div>

                <div class="matching-container" style="margin-top: 2rem;">
                    <div>
                        <h4>Bus Topology Features</h4>
                        <div class="draggable-item" data-id="bus1">Cheap to install</div>
                        <div class="draggable-item" data-id="bus2">Single point of failure</div>
                        <div class="draggable-item" data-id="bus3">Easy to add devices</div>
                        <div class="draggable-item" data-id="bus4">Performance degrades with load</div>
                        <div class="draggable-item" data-id="bus5">All data visible to all devices</div>
                    </div>
                    <div>
                        <h4>Category</h4>
                        <div class="drop-zone" data-type="advantage">
                            <strong>Advantages</strong>
                            <div class="dropped-items"></div>
                        </div>
                        <div class="drop-zone" data-type="disadvantage">
                            <strong>Disadvantages</strong>
                            <div class="dropped-items"></div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-secondary" onclick="resetBusSection()">Reset Section</button>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- Star Topology Section -->
        <section id="star" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>‚≠ê</span> Star Topology
                </h2>
                
                <div class="interactive-area">
                    <h4>Star Topology Characteristics</h4>
                    <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                        <li>Requires a central device (typically a switch)</li>
                        <li>Each node connects directly to the central device</li>
                        <li>Every node has a dedicated connection</li>
                        <li>Connections are bidirectional (usually full-duplex)</li>
                        <li>Packets are sent only to intended computers</li>
                        <li>No collisions occur due to dedicated paths</li>
                    </ul>
                </div>

                <div class="topology-viewer">
                    <h4 style="color: white; margin-bottom: 1rem;">Interactive Star Topology Simulation</h4>
                    <div class="topology-canvas" id="star-canvas">
                        <!-- Star topology will be drawn here -->
                    </div>
                    <div class="simulation-controls">
                        <button class="btn btn-secondary" onclick="resetStarSimulation()">Reset</button>
                        <button class="btn btn-primary" onclick="simulateStarTransmission()">Simulate Transmission</button>
                        <div class="sim-step-indicator">
                            <span>Step:</span>
                            <span class="sim-step active" id="star-step-1"></span>
                            <span class="sim-step" id="star-step-2"></span>
                            <span class="sim-step" id="star-step-3"></span>
                        </div>
                    </div>
                    <div class="sim-message" id="star-sim-message">
                        Click "Simulate Transmission" to see directed communication in star topology
                    </div>
                </div>

                <div class="interactive-area highlight-active" style="margin-top: 2rem;">
                    <h4>True or False: Star Topology</h4>
                    <div style="margin: 1rem 0;">
                        <p>1. Star topology eliminates data collisions 
                            <select class="input-field" style="width: 100px; display: inline-block;" id="star-tf1">
                                <option value="">Select...</option>
                                <option value="true">True</option>
                                <option value="false">False</option>
                            </select>
                        </p>
                        
                        <p style="margin-top: 1rem;">2. If the central device fails, individual computers can still communicate 
                            <select class="input-field" style="width: 100px; display: inline-block;" id="star-tf2">
                                <option value="">Select...</option>
                                <option value="true">True</option>
                                <option value="false">False</option>
                            </select>
                        </p>
                        
                        <p style="margin-top: 1rem;">3. Star topology uses more cable than bus topology 
                            <select class="input-field" style="width: 100px; display: inline-block;" id="star-tf3">
                                <option value="">Select...</option>
                                <option value="true">True</option>
                                <option value="false">False</option>
                            </select>
                        </p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkStarTrueFalse()">Check Answers</button>
                </div>

                <div class="real-world-example">
                    <h5>Real-World Example</h5>
                    <p>Most home networks use star topology with a router/switch as the central device. Each device (laptop, phone, smart TV) connects directly to the router. This is why when your router stops working, none of your devices can access the internet!</p>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- Mesh Topology Section -->
        <section id="mesh" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>üï∏Ô∏è</span> Mesh Topology
                </h2>
                
                <div class="interactive-area">
                    <h4>Mesh Topology Characteristics</h4>
                    <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                        <li>All computers connect to at least one other device</li>
                        <li>Multiple routes exist between devices</li>
                        <li>Computers can act as relays/routers</li>
                        <li>Packets find the best path to destination</li>
                        <li>Highly resilient to failures</li>
                        <li>More complex and expensive to implement</li>
                    </ul>
                </div>

                <div class="topology-viewer">
                    <h4 style="color: white; margin-bottom: 1rem;">Path Finding in Mesh Networks</h4>
                    <div class="topology-canvas" id="mesh-canvas">
                        <!-- Mesh topology will be drawn here -->
                    </div>
                    <div class="simulation-controls">
                        <button class="btn btn-secondary" onclick="resetMeshSimulation()">Reset</button>
                        <button class="btn btn-primary" onclick="simulateMeshPathfinding()">Find Path</button>
                        <p style="color: white; margin-top: 0.5rem; font-size: 0.875rem;">
                            Click two nodes to see possible paths between them
                        </p>
                    </div>
                    <div class="sim-message" id="mesh-sim-message">
                        Select a source and destination node to find paths
                    </div>
                </div>

                <div class="interactive-area highlight-active" style="margin-top: 2rem;">
                    <h4>Mesh Network Scenario</h4>
                    <p>A company wants maximum network reliability. Which mesh topology benefit is MOST important?</p>
                    
                    <button class="quiz-option" onclick="checkMeshQuiz('a')">
                        Lower installation costs
                    </button>
                    <button class="quiz-option" onclick="checkMeshQuiz('b')">
                        Multiple redundant paths between devices
                    </button>
                    <button class="quiz-option" onclick="checkMeshQuiz('c')">
                        Simpler network management
                    </button>
                    <button class="quiz-option" onclick="checkMeshQuiz('d')">
                        Less cable required
                    </button>
                </div>

                <h4 style="margin-top: 2rem;">Hybrid Topology</h4>
                <div class="interactive-area">
                    <p><strong>Definition:</strong> Any topology that combines characteristics of multiple standard topologies.</p>
                    <p><strong>Example:</strong> A building might use star topology on each floor (with a switch), then connect all floor switches using a bus topology backbone.</p>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- Comparison Section -->
        <section id="comparison" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>‚öñÔ∏è</span> Topology Comparison
                </h2>
                
                <div class="interactive-area">
                    <h4>Side-by-Side Comparison</h4>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Feature</th>
                                <th>Bus</th>
                                <th>Star</th>
                                <th>Mesh</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Installation Cost</td>
                                <td>Low</td>
                                <td>Medium</td>
                                <td>High</td>
                            </tr>
                            <tr>
                                <td>Cable Required</td>
                                <td>Least</td>
                                <td>Medium</td>
                                <td>Most</td>
                            </tr>
                            <tr>
                                <td>Reliability</td>
                                <td>Low</td>
                                <td>Medium</td>
                                <td>High</td>
                            </tr>
                            <tr>
                                <td>Collisions</td>
                                <td>Common</td>
                                <td>None</td>
                                <td>None</td>
                            </tr>
                            <tr>
                                <td>Scalability</td>
                                <td>Limited</td>
                                <td>Good</td>
                                <td>Excellent</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="interactive-area highlight-active" style="margin-top: 2rem;">
                    <h4>Scenario-Based Questions</h4>
                    <div id="scenario-quiz">
                        <p><strong>Scenario 1:</strong> A small classroom needs to connect 20 computers with minimal budget. Which topology is BEST?</p>
                        
                        <button class="quiz-option" data-scenario="1" onclick="checkScenario(1, 'a')">
                            Mesh - for maximum reliability
                        </button>
                        <button class="quiz-option" data-scenario="1" onclick="checkScenario(1, 'b')">
                            Star - for easy management
                        </button>
                        <button class="quiz-option" data-scenario="1" onclick="checkScenario(1, 'c')">
                            Bus - for lowest cost
                        </button>
                        
                        <div style="margin-top: 2rem;">
                            <p><strong>Scenario 2:</strong> A hospital needs a network where device failure won't disrupt critical services. Which topology?</p>
                            
                            <button class="quiz-option" data-scenario="2" onclick="checkScenario(2, 'a')">
                                Bus - simple to maintain
                            </button>
                            <button class="quiz-option" data-scenario="2" onclick="checkScenario(2, 'b')">
                                Star - centralized control
                            </button>
                            <button class="quiz-option" data-scenario="2" onclick="checkScenario(2, 'c')">
                                Mesh - multiple redundant paths
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mistake-item">
                    <strong>Common Mistake:</strong> Thinking star topology is always best. While it's common, each topology has specific use cases where it excels.
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- CSMA/CD Deep Dive -->
        <section id="csmacd" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>üîÑ</span> CSMA/CD Deep Dive
                </h2>
                
                <p><strong>Carrier Sense Multiple Access / Collision Detection</strong> - The protocol that makes bus networks work!</p>
                
                <div class="topology-viewer">
                    <h4 style="color: white; margin-bottom: 1rem;">CSMA/CD Simulation</h4>
                    <div class="topology-canvas" id="csmacd-canvas" style="height: 300px;">
                        <!-- CSMA/CD simulation will be shown here -->
                    </div>
                    <div class="simulation-controls">
                        <button class="btn btn-secondary" onclick="resetCSMACDSimulation()">Reset</button>
                        <button class="btn btn-secondary" onclick="previousCSMACDStep()" id="csma-prev" disabled>‚Üê Previous</button>
                        <button class="btn btn-primary" onclick="nextCSMACDStep()" id="csma-next">Next Step ‚Üí</button>
                        <div class="sim-step-indicator">
                            <span>Step:</span>
                            <span class="sim-step active" id="csma-step-1"></span>
                            <span class="sim-step" id="csma-step-2"></span>
                            <span class="sim-step" id="csma-step-3"></span>
                            <span class="sim-step" id="csma-step-4"></span>
                            <span class="sim-step" id="csma-step-5"></span>
                            <span class="sim-step" id="csma-step-6"></span>
                        </div>
                    </div>
                    <div class="sim-message active" id="csmacd-message">
                        Step 1: Device wants to transmit - first it listens to the channel
                    </div>
                </div>

                <div class="code-display">
                    <span class="code-comment">// CSMA/CD Algorithm</span><br>
                    <span class="code-keyword">WHILE</span> (data_to_send) {<br>
                    &nbsp;&nbsp;<span class="code-keyword">IF</span> (channel_is_quiet) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// Start transmission</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;transmit_data();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">IF</span> (collision_detected) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send_jam_signal();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wait(random_backoff_time);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attempts++;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;} <span class="code-keyword">ELSE</span> {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// Channel busy - wait</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;wait_for_quiet();<br>
                    &nbsp;&nbsp;}<br>
                    }
                </div>

                <div class="interactive-area highlight-active" style="margin-top: 2rem;">
                    <h4>CSMA/CD Understanding Check</h4>
                    <p>Put these CSMA/CD steps in the correct order:</p>
                    
                    <div id="csmacd-ordering">
                        <div class="draggable-item" data-order="3">Send jam signal if collision detected</div>
                        <div class="draggable-item" data-order="1">Listen to check if channel is free</div>
                        <div class="draggable-item" data-order="4">Wait random backoff time</div>
                        <div class="draggable-item" data-order="2">Start transmitting data</div>
                        <div class="draggable-item" data-order="5">Retry transmission</div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkCSMACDOrder()" style="margin-top: 1rem;">Check Order</button>
                </div>

                <div class="mistake-item">
                    <strong>Common Mistake:</strong> Forgetting that CSMA/CD only works on shared medium networks (like bus). Star networks with switches don't need it because each connection is dedicated!
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- Practice Questions -->
        <section id="practice" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>üìù</span> Exam-Style Practice Questions
                </h2>
                
                <div class="exam-question">
                    <h4>Question 1 (4 marks)</h4>
                    <p>Andy plays computer games over the internet. He has several devices that connect wirelessly to the router in his house.</p>
                    <p>(i) Identify the topology of Andy's home network. Justify your choice. [2 marks]</p>
                    
                    <textarea class="input-field" id="practice-q1" rows="4" style="width: 100%; margin-top: 1rem;"></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <label>Your predicted marks: 
                            <input type="number" class="marks-input" id="marks-q1" min="0" max="2">
                        </label>
                        <button class="btn btn-secondary" onclick="showPracticeMarkScheme('q1')">Show Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="mark-scheme-q1">
                        <h5>Mark Scheme:</h5>
                        <ul>
                            <li>1 mark: Identification of star topology</li>
                            <li>1 mark: Justification - devices connected directly to router independently / all devices only connected to the router</li>
                        </ul>
                    </div>
                </div>

                <div class="exam-question">
                    <h4>Question 2 (4 marks)</h4>
                    <p>A business creating a local area network (LAN) in its office.</p>
                    <p>The business is deciding which topology to use. Tick one or more boxes in each row to identify the topology, or topologies, each statement describes.</p>
                    
                    <table class="comparison-table" style="margin-top: 1rem;">
                        <thead>
                            <tr>
                                <th>Statement</th>
                                <th>Bus</th>
                                <th>Star</th>
                                <th>Mesh</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>All devices connect to one central device</td>
                                <td><input type="checkbox" id="q2-1-bus"></td>
                                <td><input type="checkbox" id="q2-1-star"></td>
                                <td><input type="checkbox" id="q2-1-mesh"></td>
                            </tr>
                            <tr>
                                <td>All devices connect to a central cable</td>
                                <td><input type="checkbox" id="q2-2-bus"></td>
                                <td><input type="checkbox" id="q2-2-star"></td>
                                <td><input type="checkbox" id="q2-2-mesh"></td>
                            </tr>
                            <tr>
                                <td>Multiple paths for packets to travel along</td>
                                <td><input type="checkbox" id="q2-3-bus"></td>
                                <td><input type="checkbox" id="q2-3-star"></td>
                                <td><input type="checkbox" id="q2-3-mesh"></td>
                            </tr>
                            <tr>
                                <td>Most likely to lose data through collisions</td>
                                <td><input type="checkbox" id="q2-4-bus"></td>
                                <td><input type="checkbox" id="q2-4-star"></td>
                                <td><input type="checkbox" id="q2-4-mesh"></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-primary" onclick="checkPracticeQ2()">Check Answers</button>
                        <button class="btn btn-secondary" onclick="showPracticeMarkScheme('q2')">Show Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="mark-scheme-q2">
                        <h5>Mark Scheme (1 mark per row, all correct required):</h5>
                        <ul>
                            <li>Row 1: Star only</li>
                            <li>Row 2: Bus only</li>
                            <li>Row 3: Mesh only</li>
                            <li>Row 4: Bus only</li>
                        </ul>
                    </div>
                </div>

                <div class="exam-question">
                    <h4>Question 3 (3 marks)</h4>
                    <p>State three tasks performed by devices to deal with collisions when using the Carrier Sense Multiple Access/Collision Detection (CSMA/CD) protocol in a network.</p>
                    
                    <textarea class="input-field" id="practice-q3" rows="6" style="width: 100%; margin-top: 1rem;"></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <label>Your predicted marks: 
                            <input type="number" class="marks-input" id="marks-q3" min="0" max="3">
                        </label>
                        <button class="btn btn-secondary" onclick="showPracticeMarkScheme('q3')">Show Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="mark-scheme-q3">
                        <h5>Mark Scheme (1 mark each, max 3):</h5>
                        <ul>
                            <li>Monitor the communications channel</li>
                            <li>Send data only when line is quiet/idle</li>
                            <li>Detect a collision and stop transmission/transmit jamming signal</li>
                            <li>Calculate a random wait time/back-off time</li>
                            <li>Retransmit data after random wait time</li>
                            <li>Increase random time if multiple collisions</li>
                        </ul>
                    </div>
                </div>

                <h4>Drawing Canvas for Diagrams</h4>
                <p>Use this canvas for drawing topology diagrams:</p>
                <canvas id="drawing-canvas" class="drawing-canvas" width="600" height="400"></canvas>
                <button class="btn btn-secondary" onclick="clearCanvas()">Clear Canvas</button>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- Summary Quiz -->
        <section id="summary" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>üéØ</span> Summary Quiz
                </h2>
                
                <p>Test your understanding of all network topologies!</p>
                
                <div class="interactive-area highlight-active">
                    <div id="final-quiz">
                        <!-- Question 1 -->
                        <div class="quiz-question" style="margin-bottom: 2rem;">
                            <p><strong>1. Which topology requires terminators at cable ends?</strong></p>
                            <button class="quiz-option" data-q="1" data-a="a">Star</button>
                            <button class="quiz-option" data-q="1" data-a="b">Mesh</button>
                            <button class="quiz-option" data-q="1" data-a="c">Bus</button>
                            <button class="quiz-option" data-q="1" data-a="d">Hybrid</button>
                        </div>
                        
                        <!-- Question 2 -->
                        <div class="quiz-question" style="margin-bottom: 2rem;">
                            <p><strong>2. In star topology, what happens if the central device fails?</strong></p>
                            <button class="quiz-option" data-q="2" data-a="a">Only some devices lose connection</button>
                            <button class="quiz-option" data-q="2" data-a="b">The entire network fails</button>
                            <button class="quiz-option" data-q="2" data-a="c">Devices switch to mesh mode</button>
                            <button class="quiz-option" data-q="2" data-a="d">Nothing, network continues working</button>
                        </div>
                        
                        <!-- Question 3 -->
                        <div class="quiz-question" style="margin-bottom: 2rem;">
                            <p><strong>3. What does CSMA/CD stand for?</strong></p>
                            <button class="quiz-option" data-q="3" data-a="a">Computer System Multiple Access/Collision Detection</button>
                            <button class="quiz-option" data-q="3" data-a="b">Carrier Sense Multiple Access/Collision Detection</button>
                            <button class="quiz-option" data-q="3" data-a="c">Central Switch Multiple Access/Connection Detection</button>
                            <button class="quiz-option" data-q="3" data-a="d">Carrier Signal Multiple Access/Connection Detection</button>
                        </div>
                        
                        <!-- Question 4 -->
                        <div class="quiz-question" style="margin-bottom: 2rem;">
                            <p><strong>4. Which topology provides the most redundancy?</strong></p>
                            <button class="quiz-option" data-q="4" data-a="a">Bus</button>
                            <button class="quiz-option" data-q="4" data-a="b">Star</button>
                            <button class="quiz-option" data-q="4" data-a="c">Ring</button>
                            <button class="quiz-option" data-q="4" data-a="d">Mesh</button>
                        </div>
                        
                        <!-- Question 5 -->
                        <div class="quiz-question" style="margin-bottom: 2rem;">
                            <p><strong>5. True or False: Bus topology uses broadcasting to send data</strong></p>
                            <button class="quiz-option" data-q="5" data-a="a">True</button>
                            <button class="quiz-option" data-q="5" data-a="b">False</button>
                        </div>
                        
                        <!-- Question 6 -->
                        <div class="quiz-question" style="margin-bottom: 2rem;">
                            <p><strong>6. Which topology has NO collision issues?</strong></p>
                            <button class="quiz-option" data-q="6" data-a="a">Bus only</button>
                            <button class="quiz-option" data-q="6" data-a="b">Star and Mesh</button>
                            <button class="quiz-option" data-q="6" data-a="c">Bus and Star</button>
                            <button class="quiz-option" data-q="6" data-a="d">All topologies have collisions</button>
                        </div>
                        
                        <!-- Question 7 -->
                        <div class="quiz-question" style="margin-bottom: 2rem;">
                            <p><strong>7. What is a hybrid topology?</strong></p>
                            <button class="quiz-option" data-q="7" data-a="a">A wireless network</button>
                            <button class="quiz-option" data-q="7" data-a="b">Combination of multiple topology types</button>
                            <button class="quiz-option" data-q="7" data-a="c">A very large network</button>
                            <button class="quiz-option" data-q="7" data-a="d">A network with backup systems</button>
                        </div>
                        
                        <!-- Question 8 -->
                        <div class="quiz-question" style="margin-bottom: 2rem;">
                            <p><strong>8. Which topology is typically cheapest to install?</strong></p>
                            <button class="quiz-option" data-q="8" data-a="a">Star</button>
                            <button class="quiz-option" data-q="8" data-a="b">Mesh</button>
                            <button class="quiz-option" data-q="8" data-a="c">Bus</button>
                            <button class="quiz-option" data-q="8" data-a="d">Hybrid</button>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="submitFinalQuiz()">Submit Quiz</button>
                    
                    <div id="quiz-results" style="margin-top: 2rem; display: none;">
                        <h4>Your Results:</h4>
                        <p id="quiz-score"></p>
                        <div id="quiz-feedback"></div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- Extension Activities -->
        <section id="extension" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>üöÄ</span> Extension Activities
                </h2>
                
                <h3>Beyond the Specification</h3>
                
                <div class="interactive-area">
                    <h4>1. Modern Network Technologies</h4>
                    <p>Research and explain how modern switched Ethernet has largely eliminated the need for CSMA/CD:</p>
                    <textarea class="input-field" rows="6"></textarea>
                </div>
                
                <div class="interactive-area" style="margin-top: 2rem;">
                    <h4>2. Network Design Challenge</h4>
                    <p>Design a network for a three-floor office building with 50 computers per floor. Consider:</p>
                    <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                        <li>Which topology for each floor?</li>
                        <li>How to connect the floors?</li>
                        <li>Redundancy requirements</li>
                        <li>Cost considerations</li>
                    </ul>
                    <textarea class="input-field" rows="8" style="margin-top: 1rem;"></textarea>
                </div>
                
                <div class="interactive-area" style="margin-top: 2rem;">
                    <h4>3. Wireless Networks</h4>
                    <p>How do wireless networks handle the topology concept? Research and explain:</p>
                    <textarea class="input-field" rows="6"></textarea>
                </div>
                
                <button class="btn btn-primary" onclick="submitExtension()">Submit Extension Work</button>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- Videos Section -->
        <section id="videos" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>üé•</span> Video Resources
                </h2>
                
                <div class="interactive-area">
                    <h4>Supplementary Videos</h4>
                    <p>Your teacher will add video links here to support your learning:</p>
                    
                    <div style="background: var(--bg-secondary); padding: 3rem; border-radius: 1rem; text-align: center; margin: 2rem 0;">
                        <p style="color: var(--text-secondary); font-size: 4rem;">üìπ</p>
                        <p style="color: var(--text-secondary);">Video content will be added here</p>
                    </div>
                </div>
                
                <h4>Additional Resources</h4>
                <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                    <li>Cambridge 9618 Specification - Network Topologies</li>
                    <li>Past Paper Questions on Topologies</li>
                    <li>Network Simulation Software</li>
                    <li>CSMA/CD Animation Resources</li>
                </ul>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">‚Üê Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('intro')">Start Over</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievement-popup">
        <div class="achievement-icon" id="achievement-icon">üèÜ</div>
        <h4 id="achievement-title">Achievement Unlocked!</h4>
        <p id="achievement-desc">You've earned a new achievement</p>
    </div>

    <!-- Shame Message -->
    <div class="shame-message" id="shame-message">
        üö´ No pasting allowed! Type your own answers! üö´
    </div>

    <!-- Particle Container -->
    <div id="particle-container"></div>

    <!-- Feedback Button & Modal -->
    <button class="feedback-btn" onclick="openFeedback()" aria-label="Send feedback">
        <span>üí¨</span>
    </button>

    <div class="feedback-modal" id="feedback-modal">
        <div class="feedback-content">
            <h3 style="margin-bottom: 1rem; color: var(--primary-color);">Send Feedback</h3>
            <p>Found a bug or have a suggestion? Let us know!</p>
            <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
                Current page: <span id="feedback-page" style="font-weight: 600;"></span>
            </p>
            <textarea class="input-field" id="feedback-text" rows="5" style="margin-top: 1rem;"></textarea>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="closeFeedback()">Cancel</button>
                <button class="btn btn-primary" onclick="sendFeedback()">Send</button>
            </div>
        </div>
    </div>

    <!-- Accessibility Controls -->
    <div class="accessibility-controls">
        <h4>Accessibility</h4>
        <button onclick="toggleHighContrast()">High Contrast</button>
        <button onclick="toggleDyslexiaFont()">Dyslexia Font</button>
        <div class="font-size-controls">
            <button onclick="changeFontSize('small')">A-</button>
            <button onclick="changeFontSize('normal')">A</button>
            <button onclick="changeFontSize('large')">A+</button>
        </div>
    </div>

    <script>
        // Performance optimization: Cache DOM elements
        const DOM = {
            xpFill: null,
            xpText: null,
            currentLevel: null,
            navPills: null,
            sections: null,
            achievementPopup: null,
            shameMessage: null,
            feedbackModal: null,
            feedbackPage: null,
            feedbackText: null,
            particleContainer: null
        };

        // Initialize DOM cache
        function initializeDOM() {
            DOM.xpFill = document.getElementById('xp-fill');
            DOM.xpText = document.getElementById('xp-text');
            DOM.currentLevel = document.getElementById('current-level');
            DOM.navPills = document.querySelectorAll('.nav-pill');
            DOM.sections = document.querySelectorAll('.section');
            DOM.achievementPopup = document.getElementById('achievement-popup');
            DOM.shameMessage = document.getElementById('shame-message');
            DOM.feedbackModal = document.getElementById('feedback-modal');
            DOM.feedbackPage = document.getElementById('feedback-page');
            DOM.feedbackText = document.getElementById('feedback-text');
            DOM.particleContainer = document.getElementById('particle-container');
        }

        // Game State
        let gameState = {
            xp: 0,
            level: 1,
            completedSections: new Set(),
            achievements: new Set(),
            actionsPerformed: new Set(),
            currentSection: 'intro',
            sectionScores: {},
            selectedItems: {},
            hintUsage: {},
            simulations: {
                bus: { step: 0, maxSteps: 4 },
                star: { step: 0, maxSteps: 3 },
                mesh: { selectedNodes: [], paths: [] },
                csmacd: { step: 0, maxSteps: 6 }
            }
        };

        // XP Requirements per level
        const XP_PER_LEVEL = [0, 100, 250, 450, 700, 1000];

        // Performance: Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Performance: Throttle function
        function throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeDOM();
            setupEventListeners();
            loadProgress();
            updateXPDisplay();
            initializeTopologyCanvases();
            setupMatchingActivities();
            
            // Initialize canvas when section becomes active
            const observer = new MutationObserver(function(mutations) {
                const canvas = document.getElementById('drawing-canvas');
                if (canvas && !canvas.hasAttribute('data-initialized')) {
                    initializeCanvas();
                    canvas.setAttribute('data-initialized', 'true');
                }
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        });

        // Initialize Topology Canvases
        function initializeTopologyCanvases() {
            // Initialize after a short delay to ensure DOM is ready
            setTimeout(() => {
                drawBusTopology();
                drawStarTopology();
                drawMeshTopology();
                drawCSMACDDiagram();
            }, 100);
        }

        // Draw Bus Topology
        function drawBusTopology() {
            const canvas = document.getElementById('bus-canvas');
            if (!canvas) return;
            
            // Clear existing content
            canvas.innerHTML = '';
            
            // Create main bus cable
            const cable = document.createElement('div');
            cable.className = 'network-cable';
            cable.style.width = '80%';
            cable.style.height = '6px';
            cable.style.left = '10%';
            cable.style.top = '50%';
            cable.style.transform = 'translateY(-50%)';
            canvas.appendChild(cable);
            
            // Create nodes
            const nodePositions = [20, 35, 50, 65, 80];
            nodePositions.forEach((pos, index) => {
                // Node
                const node = document.createElement('div');
                node.className = 'network-node';
                node.textContent = `PC${index + 1}`;
                node.style.left = `${pos}%`;
                node.style.top = '30%';
                node.style.transform = 'translate(-50%, -50%)';
                node.id = `bus-node-${index}`;
                canvas.appendChild(node);
                
                // Connection to bus
                const connection = document.createElement('div');
                connection.className = 'network-cable';
                connection.style.width = '2px';
                connection.style.height = '20%';
                connection.style.left = `${pos}%`;
                connection.style.top = '30%';
                connection.style.transform = 'translateX(-50%)';
                canvas.appendChild(connection);
            });
            
            // Add terminators
            ['10%', '90%'].forEach((pos, index) => {
                const terminator = document.createElement('div');
                terminator.style.position = 'absolute';
                terminator.style.width = '20px';
                terminator.style.height = '20px';
                terminator.style.background = '#e53e3e';
                terminator.style.borderRadius = '50%';
                terminator.style.left = pos;
                terminator.style.top = '50%';
                terminator.style.transform = 'translate(-50%, -50%)';
                terminator.title = 'Terminator';
                canvas.appendChild(terminator);
            });
        }

        // Draw Star Topology
        function drawStarTopology() {
            const canvas = document.getElementById('star-canvas');
            if (!canvas) return;
            
            canvas.innerHTML = '';
            
            // Central switch
            const switchEl = document.createElement('div');
            switchEl.className = 'network-switch';
            switchEl.textContent = 'Switch';
            switchEl.style.left = '50%';
            switchEl.style.top = '50%';
            switchEl.style.transform = 'translate(-50%, -50%)';
            switchEl.id = 'star-switch';
            canvas.appendChild(switchEl);
            
            // Create nodes in a circle
            const nodeCount = 6;
            const radius = 120;
            
            for (let i = 0; i < nodeCount; i++) {
                const angle = (i * 2 * Math.PI) / nodeCount - Math.PI / 2;
                const x = 50 + radius * Math.cos(angle) / 3;
                const y = 50 + radius * Math.sin(angle) / 4;
                
                // Node
                const node = document.createElement('div');
                node.className = 'network-node';
                node.textContent = `PC${i + 1}`;
                node.style.left = `${x}%`;
                node.style.top = `${y}%`;
                node.style.transform = 'translate(-50%, -50%)';
                node.id = `star-node-${i}`;
                canvas.appendChild(node);
                
                // Cable to switch
                const cable = document.createElement('div');
                cable.className = 'network-cable';
                cable.id = `star-cable-${i}`;
                cable.style.left = '50%';
                cable.style.top = '50%';
                
                // Calculate cable length and angle
                const dx = x - 50;
                const dy = y - 50;
                const length = Math.sqrt(dx * dx + dy * dy) * 3;
                const rotation = Math.atan2(dy, dx) * 180 / Math.PI;
                
                cable.style.width = `${length}px`;
                cable.style.transform = `rotate(${rotation}deg)`;
                cable.style.transformOrigin = 'left center';
                
                canvas.appendChild(cable);
            }
        }

        // Draw Mesh Topology
        function drawMeshTopology() {
            const canvas = document.getElementById('mesh-canvas');
            if (!canvas) return;
            
            canvas.innerHTML = '';
            
            // Create nodes
            const nodePositions = [
                { x: 25, y: 25, id: 0 },
                { x: 75, y: 25, id: 1 },
                { x: 50, y: 50, id: 2 },
                { x: 25, y: 75, id: 3 },
                { x: 75, y: 75, id: 4 }
            ];
            
            // Draw connections first (so they appear behind nodes)
            const connections = [
                [0, 1], [0, 2], [0, 3],
                [1, 2], [1, 4],
                [2, 3], [2, 4],
                [3, 4]
            ];
            
            connections.forEach(([from, to]) => {
                const fromNode = nodePositions[from];
                const toNode = nodePositions[to];
                
                const cable = document.createElement('div');
                cable.className = 'network-cable';
                cable.id = `mesh-cable-${from}-${to}`;
                
                const dx = toNode.x - fromNode.x;
                const dy = toNode.y - fromNode.y;
                const length = Math.sqrt(dx * dx + dy * dy) * 4;
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                cable.style.left = `${fromNode.x}%`;
                cable.style.top = `${fromNode.y}%`;
                cable.style.width = `${length}px`;
                cable.style.transform = `rotate(${angle}deg)`;
                cable.style.transformOrigin = 'left center';
                
                canvas.appendChild(cable);
            });
            
            // Draw nodes
            nodePositions.forEach((pos, index) => {
                const node = document.createElement('div');
                node.className = 'network-node';
                node.textContent = `N${index + 1}`;
                node.style.left = `${pos.x}%`;
                node.style.top = `${pos.y}%`;
                node.style.transform = 'translate(-50%, -50%)';
                node.id = `mesh-node-${index}`;
                node.style.cursor = 'pointer';
                
                node.addEventListener('click', () => selectMeshNode(index));
                
                canvas.appendChild(node);
            });
        }

        // Draw CSMA/CD Diagram
        function drawCSMACDDiagram() {
            const canvas = document.getElementById('csmacd-canvas');
            if (!canvas) return;
            
            canvas.innerHTML = '';
            
            // Create simplified bus network for CSMA/CD demo
            const cable = document.createElement('div');
            cable.className = 'network-cable';
            cable.style.width = '80%';
            cable.style.height = '8px';
            cable.style.left = '10%';
            cable.style.top = '50%';
            cable.style.transform = 'translateY(-50%)';
            cable.id = 'csmacd-cable';
            canvas.appendChild(cable);
            
            // Create two nodes that will demonstrate collision
            const nodes = [
                { id: 'csmacd-node-1', label: 'Device A', x: 25 },
                { id: 'csmacd-node-2', label: 'Device B', x: 75 }
            ];
            
            nodes.forEach(nodeData => {
                const node = document.createElement('div');
                node.className = 'network-node';
                node.textContent = nodeData.label;
                node.style.left = `${nodeData.x}%`;
                node.style.top = '30%';
                node.style.transform = 'translate(-50%, -50%)';
                node.id = nodeData.id;
                canvas.appendChild(node);
                
                // Connection
                const connection = document.createElement('div');
                connection.className = 'network-cable';
                connection.style.width = '2px';
                connection.style.height = '20%';
                connection.style.left = `${nodeData.x}%`;
                connection.style.top = '30%';
                connection.style.transform = 'translateX(-50%)';
                canvas.appendChild(connection);
            });
        }

        // Simulation Functions
        function resetBusSimulation() {
            const nodes = document.querySelectorAll('#bus-canvas .network-node');
            const cable = document.querySelector('#bus-canvas .network-cable');
            
            nodes.forEach(node => node.classList.remove('active'));
            if (cable) cable.classList.remove('active');
            
            // Reset step indicators
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`bus-step-${i}`);
                if (step) {
                    step.classList.remove('active', 'completed');
                    if (i === 1) step.classList.add('active');
                }
            }
            
            const message = document.getElementById('bus-sim-message');
            if (message) message.textContent = 'Click "Simulate Transmission" to see how data travels on a bus network';
            
            gameState.simulations.bus.step = 0;
        }

        function simulateBusTransmission() {
            const steps = [
                {
                    action: () => {
                        document.getElementById('bus-node-0').classList.add('active');
                        document.getElementById('bus-sim-message').textContent = 'Step 1: PC1 wants to send data. It starts transmitting.';
                    }
                },
                {
                    action: () => {
                        document.querySelector('#bus-canvas .network-cable').classList.add('active');
                        document.getElementById('bus-sim-message').textContent = 'Step 2: Data travels along the entire bus cable (broadcasting).';
                    }
                },
                {
                    action: () => {
                        document.querySelectorAll('#bus-canvas .network-node').forEach(node => {
                            if (node.id !== 'bus-node-0') {
                                node.classList.add('active');
                            }
                        });
                        document.getElementById('bus-sim-message').textContent = 'Step 3: ALL devices receive the data and check the MAC address.';
                    }
                },
                {
                    action: () => {
                        document.querySelectorAll('#bus-canvas .network-node').forEach((node, index) => {
                            if (index !== 0 && index !== 2) {
                                node.classList.remove('active');
                            }
                        });
                        document.getElementById('bus-sim-message').textContent = 'Step 4: Only PC3 (destination) processes the data. Others ignore it.';
                    }
                }
            ];
            
            const currentStep = gameState.simulations.bus.step;
            if (currentStep < steps.length) {
                steps[currentStep].action();
                
                // Update step indicators
                if (currentStep > 0) {
                    document.getElementById(`bus-step-${currentStep}`).classList.add('completed');
                }
                document.getElementById(`bus-step-${currentStep + 1}`).classList.add('active');
                
                gameState.simulations.bus.step++;
                
                if (currentStep === 0) {
                    awardXP(10, 'Bus Simulation Started', 'bus_sim_start');
                } else if (currentStep === steps.length - 1) {
                    awardXP(20, 'Bus Simulation Complete', 'bus_sim_complete');
                }
            } else {
                resetBusSimulation();
            }
        }

        function resetStarSimulation() {
            document.querySelectorAll('#star-canvas .network-node, #star-canvas .network-cable').forEach(el => {
                el.classList.remove('active');
            });
            
            // Reset steps
            for (let i = 1; i <= 3; i++) {
                const step = document.getElementById(`star-step-${i}`);
                if (step) {
                    step.classList.remove('active', 'completed');
                    if (i === 1) step.classList.add('active');
                }
            }
            
            const message = document.getElementById('star-sim-message');
            if (message) message.textContent = 'Click "Simulate Transmission" to see directed communication in star topology';
            
            gameState.simulations.star.step = 0;
        }

        function simulateStarTransmission() {
            const steps = [
                {
                    action: () => {
                        document.getElementById('star-node-0').classList.add('active');
                        document.getElementById('star-cable-0').classList.add('active');
                        document.getElementById('star-sim-message').textContent = 'Step 1: PC1 sends data to the switch through dedicated cable.';
                    }
                },
                {
                    action: () => {
                        document.getElementById('star-switch').classList.add('active');
                        document.getElementById('star-sim-message').textContent = 'Step 2: Switch receives data and checks destination MAC address.';
                    }
                },
                {
                    action: () => {
                        document.getElementById('star-cable-3').classList.add('active');
                        document.getElementById('star-node-3').classList.add('active');
                        document.getElementById('star-sim-message').textContent = 'Step 3: Switch forwards data ONLY to PC4 (destination). No broadcasting!';
                    }
                }
            ];
            
            const currentStep = gameState.simulations.star.step;
            if (currentStep < steps.length) {
                steps[currentStep].action();
                
                if (currentStep > 0) {
                    document.getElementById(`star-step-${currentStep}`).classList.add('completed');
                }
                document.getElementById(`star-step-${currentStep + 1}`).classList.add('active');
                
                gameState.simulations.star.step++;
                
                if (currentStep === steps.length - 1) {
                    awardXP(20, 'Star Simulation Complete', 'star_sim_complete');
                }
            } else {
                resetStarSimulation();
            }
        }

        function resetMeshSimulation() {
            document.querySelectorAll('#mesh-canvas .network-node, #mesh-canvas .network-cable').forEach(el => {
                el.classList.remove('active');
            });
            
            gameState.simulations.mesh.selectedNodes = [];
            gameState.simulations.mesh.paths = [];
            
            const message = document.getElementById('mesh-sim-message');
            if (message) message.textContent = 'Select a source and destination node to find paths';
        }

        function selectMeshNode(nodeId) {
            const node = document.getElementById(`mesh-node-${nodeId}`);
            const selected = gameState.simulations.mesh.selectedNodes;
            
            if (selected.length === 0) {
                node.classList.add('active');
                selected.push(nodeId);
                document.getElementById('mesh-sim-message').textContent = 'Source selected. Now select a destination node.';
            } else if (selected.length === 1 && nodeId !== selected[0]) {
                node.classList.add('active');
                selected.push(nodeId);
                findMeshPaths(selected[0], selected[1]);
            } else {
                resetMeshSimulation();
            }
        }

        function findMeshPaths(source, dest) {
            // Simplified path highlighting for demonstration
            const paths = {
                '0-1': [[0, 1], [0, 2, 1]],
                '0-2': [[0, 2], [0, 1, 2], [0, 3, 2]],
                '0-3': [[0, 3], [0, 2, 3]],
                '0-4': [[0, 2, 4], [0, 3, 4], [0, 1, 4]],
                '1-2': [[1, 2], [1, 0, 2], [1, 4, 2]],
                '1-3': [[1, 0, 3], [1, 2, 3]],
                '1-4': [[1, 4], [1, 2, 4]],
                '2-3': [[2, 3], [2, 0, 3], [2, 4, 3]],
                '2-4': [[2, 4], [2, 1, 4], [2, 3, 4]],
                '3-4': [[3, 4], [3, 2, 4]]
            };
            
            const key = source < dest ? `${source}-${dest}` : `${dest}-${source}`;
            const availablePaths = paths[key] || [];
            
            if (availablePaths.length > 0) {
                // Highlight the shortest path
                const path = availablePaths[0];
                for (let i = 0; i < path.length - 1; i++) {
                    const from = path[i];
                    const to = path[i + 1];
                    const cableId = from < to ? `mesh-cable-${from}-${to}` : `mesh-cable-${to}-${from}`;
                    const cable = document.getElementById(cableId);
                    if (cable) cable.classList.add('active');
                }
                
                document.getElementById('mesh-sim-message').textContent = 
                    `Found ${availablePaths.length} possible paths. Shortest path highlighted!`;
                
                awardXP(15, 'Mesh Pathfinding', 'mesh_pathfind');
            }
        }

        function simulateMeshPathfinding() {
            resetMeshSimulation();
            document.getElementById('mesh-sim-message').textContent = 'Select two nodes to see available paths between them';
        }

        // CSMA/CD Simulation
        function resetCSMACDSimulation() {
            document.querySelectorAll('#csmacd-canvas .network-node, #csmacd-canvas .network-cable').forEach(el => {
                el.classList.remove('active');
            });
            
            // Remove any collision indicators
            document.querySelectorAll('.collision-indicator').forEach(el => el.remove());
            
            // Reset steps
            for (let i = 1; i <= 6; i++) {
                const step = document.getElementById(`csma-step-${i}`);
                if (step) {
                    step.classList.remove('active', 'completed');
                    if (i === 1) step.classList.add('active');
                }
            }
            
            gameState.simulations.csmacd.step = 0;
            document.getElementById('csma-prev').disabled = true;
            document.getElementById('csma-next').disabled = false;
            
            document.getElementById('csmacd-message').textContent = 'Step 1: Device wants to transmit - first it listens to the channel';
        }

        function nextCSMACDStep() {
            const steps = [
                'Step 1: Device wants to transmit - first it listens to the channel',
                'Step 2: Channel is quiet - Device A starts transmitting',
                'Step 3: Device B also wants to transmit and starts (collision occurs!)',
                'Step 4: Both devices detect collision and send jam signal',
                'Step 5: Both devices calculate random backoff time and wait',
                'Step 6: Device A retransmits after shorter wait time (success!)'
            ];
            
            const actions = [
                () => {
                    document.getElementById('csmacd-node-1').classList.add('active');
                },
                () => {
                    document.getElementById('csmacd-cable').classList.add('active');
                },
                () => {
                    document.getElementById('csmacd-node-2').classList.add('active');
                    // Add collision indicator
                    const collision = document.createElement('div');
                    collision.className = 'collision-indicator';
                    collision.style.cssText = 'position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: red; border-radius: 50%; opacity: 0.7; animation: pulse 1s infinite;';
                    collision.textContent = 'üí•';
                    collision.style.fontSize = '2rem';
                    collision.style.display = 'flex';
                    collision.style.alignItems = 'center';
                    collision.style.justifyContent = 'center';
                    document.getElementById('csmacd-canvas').appendChild(collision);
                },
                () => {
                    document.getElementById('csmacd-cable').style.background = 'red';
                },
                () => {
                    document.querySelectorAll('#csmacd-canvas .network-node').forEach(node => {
                        node.classList.remove('active');
                    });
                    document.getElementById('csmacd-cable').classList.remove('active');
                    document.getElementById('csmacd-cable').style.background = '';
                },
                () => {
                    document.querySelector('.collision-indicator')?.remove();
                    document.getElementById('csmacd-node-1').classList.add('active');
                    document.getElementById('csmacd-cable').classList.add('active');
                }
            ];
            
            const currentStep = gameState.simulations.csmacd.step;
            if (currentStep < steps.length - 1) {
                gameState.simulations.csmacd.step++;
                const newStep = gameState.simulations.csmacd.step;
                
                document.getElementById('csmacd-message').textContent = steps[newStep];
                actions[newStep - 1]();
                
                // Update step indicators
                document.getElementById(`csma-step-${currentStep + 1}`).classList.remove('active');
                document.getElementById(`csma-step-${currentStep + 1}`).classList.add('completed');
                document.getElementById(`csma-step-${newStep + 1}`).classList.add('active');
                
                // Update button states
                document.getElementById('csma-prev').disabled = false;
                if (newStep === steps.length - 1) {
                    document.getElementById('csma-next').disabled = true;
                    awardXP(25, 'CSMA/CD Complete', 'csmacd_complete');
                }
            }
        }

        function previousCSMACDStep() {
            if (gameState.simulations.csmacd.step > 0) {
                gameState.simulations.csmacd.step--;
                
                // Reset and replay up to current step
                resetCSMACDSimulation();
                const targetStep = gameState.simulations.csmacd.step;
                gameState.simulations.csmacd.step = 0;
                
                for (let i = 0; i < targetStep; i++) {
                    nextCSMACDStep();
                }
                
                // Update buttons
                document.getElementById('csma-next').disabled = false;
                if (gameState.simulations.csmacd.step === 0) {
                    document.getElementById('csma-prev').disabled = true;
                }
            }
        }

        // Quiz and Activity Functions
        function checkPreQuiz() {
            const selected = document.querySelector('#pre-quiz .quiz-option.selected');
            if (!selected) return;
            
            const correct = selected.dataset.answer === 'c';
            if (correct) {
                selected.classList.add('correct');
                awardXP(10, 'Pre-quiz Correct', 'pre_quiz');
            } else {
                selected.classList.add('incorrect');
                document.querySelector('#pre-quiz .quiz-option[data-answer="c"]').classList.add('correct');
            }
        }

        function checkFillBlanks() {
            const answers = {
                'blank1': 'star',
                'blank2': 'collision',
                'blank3': 'mesh'
            };
            
            let correct = 0;
            Object.keys(answers).forEach(id => {
                const select = document.getElementById(id);
                if (!select) return;
                
                if (select.value === answers[id]) {
                    select.style.borderColor = 'var(--success-color)';
                    correct++;
                } else {
                    select.style.borderColor = 'var(--error-color)';
                }
            });
            
            if (correct === 3) {
                awardXP(15, 'Fill Blanks Complete', 'fill_blanks');
                markSectionComplete('starter');
            }
        }

        function resetFillBlanks() {
            ['blank1', 'blank2', 'blank3'].forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    select.value = '';
                    select.style.borderColor = '';
                }
            });
        }

        function checkBusQuiz(answer) {
            const options = document.querySelectorAll('#bus .quiz-option');
            options.forEach(opt => opt.classList.remove('correct', 'incorrect'));
            
            if (answer === 'b') {
                event.target.classList.add('correct');
                awardXP(10, 'Bus Quiz Correct', 'bus_quiz');
            } else {
                event.target.classList.add('incorrect');
                // Find and highlight correct answer
                options.forEach(opt => {
                    if (opt.textContent.includes('Multiple devices can transmit simultaneously')) {
                        opt.classList.add('correct');
                    }
                });
            }
        }

        function resetBusSection() {
            resetBusSimulation();
            resetMatching('bus-matching');
            document.querySelectorAll('#bus .quiz-option').forEach(opt => {
                opt.classList.remove('correct', 'incorrect');
            });
        }

        function checkStarTrueFalse() {
            const answers = {
                'star-tf1': 'true',
                'star-tf2': 'false',
                'star-tf3': 'true'
            };
            
            let correct = 0;
            Object.keys(answers).forEach(id => {
                const select = document.getElementById(id);
                if (!select) return;
                
                if (select.value === answers[id]) {
                    select.style.borderColor = 'var(--success-color)';
                    correct++;
                } else {
                    select.style.borderColor = 'var(--error-color)';
                }
            });
            
            if (correct === 3) {
                awardXP(15, 'Star True/False', 'star_tf');
                markSectionComplete('star');
            }
        }

        function checkMeshQuiz(answer) {
            const options = event.target.parentElement.querySelectorAll('.quiz-option');
            options.forEach(opt => opt.classList.remove('correct', 'incorrect'));
            
            if (answer === 'b') {
                event.target.classList.add('correct');
                awardXP(10, 'Mesh Quiz Correct', 'mesh_quiz');
                markSectionComplete('mesh');
            } else {
                event.target.classList.add('incorrect');
                options[1].classList.add('correct');
            }
        }

        function checkScenario(scenario, answer) {
            const options = document.querySelectorAll(`.quiz-option[data-scenario="${scenario}"]`);
            options.forEach(opt => opt.classList.remove('correct', 'incorrect'));
            
            const correct = (scenario === 1 && answer === 'c') || (scenario === 2 && answer === 'c');
            
            if (correct) {
                event.target.classList.add('correct');
                awardXP(15, `Scenario ${scenario} Correct`, `scenario_${scenario}`);
                
                // Check if both scenarios completed
                const scenario1Correct = document.querySelector('.quiz-option[data-scenario="1"].correct');
                const scenario2Correct = document.querySelector('.quiz-option[data-scenario="2"].correct');
                if (scenario1Correct && scenario2Correct) {
                    markSectionComplete('comparison');
                }
            } else {
                event.target.classList.add('incorrect');
                const correctIndex = scenario === 1 ? 2 : 2;
                options[correctIndex].classList.add('correct');
            }
        }

        function checkCSMACDOrder() {
            const items = document.querySelectorAll('#csmacd-ordering .draggable-item');
            let correctOrder = true;
            let previousOrder = 0;
            
            items.forEach(item => {
                const order = parseInt(item.dataset.order);
                if (order <= previousOrder) {
                    correctOrder = false;
                }
                previousOrder = order;
            });
            
            if (correctOrder) {
                awardXP(20, 'CSMA/CD Order Correct', 'csmacd_order');
                markSectionComplete('csmacd');
                items.forEach(item => {
                    item.style.background = 'var(--gradient-success)';
                    item.style.color = 'white';
                });
            } else {
                alert('Not quite right! Remember: Listen ‚Üí Transmit ‚Üí Detect Collision ‚Üí Jam Signal ‚Üí Wait ‚Üí Retry');
            }
        }

        // Practice Question Functions
        function showPracticeMarkScheme(question) {
            const textarea = document.getElementById(`practice-${question}`);
            const marks = document.getElementById(`marks-${question}`);
            const scheme = document.getElementById(`mark-scheme-${question}`);
            
            if (!textarea || !marks || !scheme) return;
            
            const minLength = 50;
            
            if (textarea.value.length < minLength || !marks.value) {
                alert(`Please write a more detailed answer (minimum ${minLength} characters) and enter predicted marks`);
                return;
            }
            
            scheme.classList.add('show');
            awardXP(10, 'Practice Question', `practice_${question}`);
            
            // Check for keywords for additional XP
            const keywords = {
                'q1': ['star', 'topology', 'router', 'central', 'device'],
                'q3': ['monitor', 'collision', 'jam', 'random', 'wait', 'retransmit']
            };
            
            if (keywords[question]) {
                let keywordCount = 0;
                const answer = textarea.value.toLowerCase();
                keywords[question].forEach(keyword => {
                    if (answer.includes(keyword)) keywordCount++;
                });
                
                if (keywordCount >= 3) {
                    awardXP(5, 'Good Answer', `practice_${question}_keywords`);
                }
            }
        }

        function checkPracticeQ2() {
            const correctAnswers = {
                'q2-1-star': true,
                'q2-2-bus': true,
                'q2-3-mesh': true,
                'q2-4-bus': true
            };
            
            let allCorrect = true;
            
            // Check all checkboxes
            document.querySelectorAll('#practice input[type="checkbox"]').forEach(checkbox => {
                const shouldBeChecked = correctAnswers[checkbox.id] || false;
                if (checkbox.checked !== shouldBeChecked) {
                    allCorrect = false;
                    checkbox.style.outline = '2px solid var(--error-color)';
                } else if (checkbox.checked) {
                    checkbox.style.outline = '2px solid var(--success-color)';
                }
            });
            
            if (allCorrect) {
                awardXP(20, 'Practice Q2 Perfect', 'practice_q2');
                markSectionComplete('practice');
            }
        }

        // Final Quiz Functions
        function submitFinalQuiz() {
            const answers = {
                '1': 'c', '2': 'b', '3': 'b', '4': 'd',
                '5': 'a', '6': 'b', '7': 'b', '8': 'c'
            };
            
            let score = 0;
            const feedback = [];
            
            Object.keys(answers).forEach(q => {
                const selected = document.querySelector(`.quiz-option[data-q="${q}"].selected`);
                if (selected && selected.dataset.a === answers[q]) {
                    selected.classList.add('correct');
                    score++;
                } else {
                    if (selected) selected.classList.add('incorrect');
                    const correctOption = document.querySelector(`.quiz-option[data-q="${q}"][data-a="${answers[q]}"]`);
                    if (correctOption) correctOption.classList.add('correct');
                    
                    // Add feedback
                    const topics = {
                        '1': 'Bus topology uses terminators',
                        '2': 'Central device failure affects entire star network',
                        '3': 'CSMA/CD = Carrier Sense Multiple Access/Collision Detection',
                        '4': 'Mesh topology has most redundancy',
                        '5': 'Bus topology broadcasts to all devices',
                        '6': 'Star and Mesh have no collisions',
                        '7': 'Hybrid combines multiple topologies',
                        '8': 'Bus topology is cheapest to install'
                    };
                    feedback.push(`Q${q}: ${topics[q]}`);
                }
            });
            
            gameState.sectionScores.finalQuiz = score;
            
            const scoreEl = document.getElementById('quiz-score');
            const feedbackEl = document.getElementById('quiz-feedback');
            const resultsEl = document.getElementById('quiz-results');
            
            if (scoreEl) scoreEl.textContent = `You scored ${score}/8 (${Math.round(score/8*100)}%)`;
            
            if (feedbackEl) {
                if (feedback.length > 0) {
                    feedbackEl.innerHTML = 
                        '<h5>Review these topics:</h5><ul>' + 
                        feedback.map(f => `<li>${f}</li>`).join('') + 
                        '</ul>';
                } else {
                    feedbackEl.innerHTML = '<p style="color: var(--success-color);">Perfect score! Excellent work!</p>';
                }
            }
            
            if (resultsEl) resultsEl.style.display = 'block';
            
            awardXP(score * 10, 'Final Quiz', 'final_quiz_complete');
            markSectionComplete('summary');
            
            if (score === 8) {
                showAchievement('Perfect Score!', 'You aced the final quiz!', 'üíØ');
            }
        }

        // Extension Functions
        function submitExtension() {
            const textareas = document.querySelectorAll('#extension .input-field');
            let totalWords = 0;
            
            textareas.forEach(ta => {
                totalWords += ta.value.split(' ').filter(word => word.length > 0).length;
            });
            
            if (totalWords > 50) {
                awardXP(30, 'Extension Work', 'extension_complete');
                markSectionComplete('extension');
                alert('Excellent extension work! Your teacher will review your responses.');
            } else {
                alert('Please provide more detailed responses for the extension activities.');
            }
        }

        // Matching Activities Setup
        function setupMatchingActivities() {
            setupMatching('bus-matching', {
                'bus1': 'advantage',
                'bus2': 'disadvantage', 
                'bus3': 'advantage',
                'bus4': 'disadvantage',
                'bus5': 'disadvantage'
            });
        }

        function setupMatching(containerId, answers) {
            const container = document.querySelector(`#${containerId}`);
            if (!container) return;
            
            const items = container.querySelectorAll('.draggable-item');
            const zones = container.querySelectorAll('.drop-zone');
            
            items.forEach(item => {
                item.addEventListener('click', function() {
                    if (this.classList.contains('matched')) return;
                    
                    items.forEach(i => i.classList.remove('selected'));
                    this.classList.add('selected');
                    gameState.selectedItems[containerId] = this;
                });
            });
            
            zones.forEach(zone => {
                zone.addEventListener('click', function() {
                    const selected = gameState.selectedItems[containerId];
                    if (!selected || selected.classList.contains('matched')) return;
                    
                    const itemId = selected.dataset.id;
                    const zoneType = this.dataset.type;
                    
                    if (answers[itemId] === zoneType) {
                        selected.classList.add('matched');
                        selected.classList.remove('selected');
                        const droppedArea = this.querySelector('.dropped-items');
                        if (droppedArea) {
                            droppedArea.appendChild(selected.cloneNode(true));
                        }
                        this.classList.add('correct');
                        awardXP(5, 'Correct Match', `match_${containerId}_${itemId}`);
                        
                        // Check if all matched
                        const allMatched = container.querySelectorAll('.draggable-item:not(.matched)').length === 0;
                        if (allMatched) {
                            awardXP(10, 'Matching Complete', `${containerId}_complete`);
                        }
                    } else {
                        this.classList.add('highlight');
                        setTimeout(() => this.classList.remove('highlight'), 1000);
                    }
                });
            });
        }

        function resetMatching(containerId) {
            const container = document.querySelector(`#${containerId}`);
            if (!container) return;
            
            container.querySelectorAll('.draggable-item').forEach(item => {
                item.classList.remove('matched', 'selected');
            });
            
            container.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('correct', 'highlight');
                const droppedItems = zone.querySelector('.dropped-items');
                if (droppedItems) droppedItems.innerHTML = '';
            });
        }

        // Canvas Functions
        function initializeCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            function getCoordinates(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                if (e.touches) {
                    return {
                        x: (e.touches[0].clientX - rect.left) * scaleX,
                        y: (e.touches[0].clientY - rect.top) * scaleY
                    };
                } else {
                    return {
                        x: (e.clientX - rect.left) * scaleX,
                        y: (e.clientY - rect.top) * scaleY
                    };
                }
            }
            
            function startDrawing(e) {
                isDrawing = true;
                const coords = getCoordinates(e);
                lastX = coords.x;
                lastY = coords.y;
                e.preventDefault();
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                const coords = getCoordinates(e);
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(coords.x, coords.y);
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.stroke();
                
                lastX = coords.x;
                lastY = coords.y;
                e.preventDefault();
            }
            
            function stopDrawing(e) {
                isDrawing = false;
                e.preventDefault();
            }
            
            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            canvas.addEventListener('touchstart', startDrawing, { passive: false });
            canvas.addEventListener('touchmove', draw, { passive: false });
            canvas.addEventListener('touchend', stopDrawing, { passive: false });
        }

        function clearCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            if (ctx) ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Navigation and Core Functions
        function navigateToSection(sectionId) {
            if (!DOM.sections || !DOM.navPills) return;
            
            DOM.sections.forEach(s => {
                if (s) {
                    s.classList.remove('active');
                    s.style.visibility = 'hidden';
                }
            });
            DOM.navPills.forEach(p => {
                if (p) p.classList.remove('active');
            });
            
            const targetSection = document.getElementById(sectionId);
            const targetPill = document.querySelector(`[data-section="${sectionId}"]`);
            
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.visibility = 'visible';
            }
            if (targetPill) {
                targetPill.classList.add('active');
            }
            
            gameState.currentSection = sectionId;
            updateFeedbackPage();
            
            if (!gameState.completedSections.has(sectionId)) {
                awardXP(5, 'Section Visit', `section_${sectionId}`);
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function navigateSection(direction) {
            if (!DOM.navPills) return;
            
            const sections = Array.from(DOM.navPills).filter(p => p).map(p => p.dataset.section);
            const currentIndex = sections.indexOf(gameState.currentSection);
            
            if (direction === 'next' && currentIndex < sections.length - 1) {
                navigateToSection(sections[currentIndex + 1]);
            } else if (direction === 'prev' && currentIndex > 0) {
                navigateToSection(sections[currentIndex - 1]);
            }
        }

        // XP and Achievement System
        function awardXP(amount, action, actionId = null) {
            if (actionId && gameState.actionsPerformed.has(actionId)) return;
            if (actionId) gameState.actionsPerformed.add(actionId);
            
            gameState.xp += amount;
            updateXPDisplay();
            checkLevelUp();
            checkAchievements();
            saveProgress();
            
            createFloatingXP(amount);
        }

        function createFloatingXP(amount) {
            try {
                const xpFloat = document.createElement('div');
                xpFloat.style.cssText = `
                    position: fixed;
                    top: 120px;
                    right: 100px;
                    color: var(--warning-color);
                    font-weight: bold;
                    font-size: 1.5rem;
                    pointer-events: none;
                    z-index: 3000;
                    animation: floatUp 2s ease-out forwards;
                `;
                xpFloat.textContent = `+${amount} XP`;
                document.body.appendChild(xpFloat);
                
                setTimeout(() => {
                    if (xpFloat && xpFloat.parentNode) {
                        xpFloat.remove();
                    }
                }, 2000);
            } catch (e) {
                console.warn('Could not create floating XP indicator:', e);
            }
        }

        function updateXPDisplay() {
            if (!DOM.xpFill || !DOM.xpText || !DOM.currentLevel) return;
            
            const xpForNextLevel = XP_PER_LEVEL[gameState.level] || XP_PER_LEVEL[XP_PER_LEVEL.length - 1];
            const xpProgress = Math.min((gameState.xp / xpForNextLevel) * 100, 100);
            
            DOM.xpFill.style.width = xpProgress + '%';
            DOM.xpText.textContent = `${gameState.xp} / ${xpForNextLevel} XP`;
            DOM.currentLevel.textContent = gameState.level;
        }

        function checkLevelUp() {
            if (gameState.level < 5 && gameState.xp >= XP_PER_LEVEL[gameState.level]) {
                gameState.level++;
                showAchievement('Level Up!', `You reached Level ${gameState.level}!`, '‚¨ÜÔ∏è');
                createParticleEffect();
            }
        }

        function createParticleEffect() {
            if (!DOM.particleContainer) return;
            
            const colors = ['#fbbf24', '#f59e0b', '#6366f1', '#8b5cf6', '#10b981'];
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.cssText = `
                        left: ${Math.random() * window.innerWidth}px;
                        top: -10px;
                        background: ${colors[Math.floor(Math.random() * colors.length)]};
                        animation-duration: ${2 + Math.random() * 2}s;
                        animation-delay: ${Math.random() * 0.5}s;
                    `;
                    DOM.particleContainer.appendChild(particle);
                    
                    particle.addEventListener('animationend', () => particle.remove());
                }, i * 50);
            }
        }

        function checkAchievements() {
            // Network Explorer
            if (!gameState.achievements.has('network_explorer') && 
                gameState.completedSections.has('bus') && 
                gameState.completedSections.has('star') && 
                gameState.completedSections.has('mesh')) {
                gameState.achievements.add('network_explorer');
                showAchievement('Network Explorer', 'Mastered all topology types!', 'üåê');
            }
            
            // Simulation Master
            if (!gameState.achievements.has('simulation_master') && 
                gameState.actionsPerformed.has('bus_sim_complete') && 
                gameState.actionsPerformed.has('star_sim_complete') && 
                gameState.actionsPerformed.has('csmacd_complete')) {
                gameState.achievements.add('simulation_master');
                showAchievement('Simulation Master', 'Completed all simulations!', 'üéÆ');
            }
            
            // Perfect Score
            if (!gameState.achievements.has('perfect_score') && gameState.sectionScores.finalQuiz === 8) {
                gameState.achievements.add('perfect_score');
                showAchievement('Perfect Score', 'Aced the final quiz!', 'üíØ');
            }
            
            // Speed Learner
            if (!gameState.achievements.has('speed_learner') && 
                gameState.completedSections.size >= 5 && 
                Date.now() - startTime < 600000) {
                gameState.achievements.add('speed_learner');
                showAchievement('Speed Learner', 'Completed 5 sections in under 10 minutes!', '‚ö°');
            }
        }

        function showAchievement(title, desc, icon) {
            if (!DOM.achievementPopup) return;
            
            const titleEl = DOM.achievementPopup.querySelector('#achievement-title');
            const descEl = DOM.achievementPopup.querySelector('#achievement-desc');
            const iconEl = DOM.achievementPopup.querySelector('#achievement-icon');
            
            if (titleEl) titleEl.textContent = title;
            if (descEl) descEl.textContent = desc;
            if (iconEl) iconEl.textContent = icon;
            
            DOM.achievementPopup.classList.add('show');
            setTimeout(() => {
                if (DOM.achievementPopup) DOM.achievementPopup.classList.remove('show');
            }, 3000);
            
            awardXP(50, 'Achievement');
            
            // Haptic feedback for mobile
            if ('vibrate' in navigator) {
                navigator.vibrate([100, 50, 100]);
            }
        }

        function markSectionComplete(section) {
            gameState.completedSections.add(section);
            const pill = document.querySelector(`[data-section="${section}"]`);
            if (pill) pill.classList.add('completed');
            saveProgress();
        }

        // Event Listeners Setup
        function setupEventListeners() {
            // Navigation with event delegation
            const navContainer = document.querySelector('.nav-pills');
            if (navContainer) {
                navContainer.addEventListener('click', function(e) {
                    if (e.target.classList.contains('nav-pill')) {
                        navigateToSection(e.target.dataset.section);
                    }
                });
            }

            // Quiz options with event delegation
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('quiz-option')) {
                    if (!e.target.classList.contains('correct') && !e.target.classList.contains('incorrect')) {
                        selectQuizOption(e.target);
                    }
                }
            });

            // Prevent paste
            document.addEventListener('paste', function(e) {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    e.preventDefault();
                    e.stopPropagation();
                    showShameMessage();
                    return false;
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', throttle(function(e) {
                if (e.key === 'ArrowLeft') navigateSection('prev');
                if (e.key === 'ArrowRight') navigateSection('next');
                if (e.ctrlKey && e.key === 'v') {
                    e.preventDefault();
                    showShameMessage();
                }
            }, 100));

            // Touch support
            let touchStartX = 0;
            let touchStartY = 0;
            
            document.addEventListener('touchstart', function(e) {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }, { passive: true });

            document.addEventListener('touchend', function(e) {
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const diffX = touchStartX - touchEndX;
                const diffY = Math.abs(touchStartY - touchEndY);
                
                if (Math.abs(diffX) > 50 && diffY < 100) {
                    if (diffX > 0) navigateSection('next');
                    else navigateSection('prev');
                }
            }, { passive: true });

            // Final quiz selections
            document.addEventListener('click', function(e) {
                if (e.target.matches('#final-quiz .quiz-option')) {
                    const option = e.target;
                    const question = option.dataset.q;
                    const siblings = document.querySelectorAll(`.quiz-option[data-q="${question}"]`);
                    siblings.forEach(s => s.classList.remove('selected'));
                    option.classList.add('selected');
                }
            });

            // CSMA/CD ordering - make items draggable by clicking
            const orderingContainer = document.getElementById('csmacd-ordering');
            if (orderingContainer) {
                let selectedItem = null;
                
                orderingContainer.addEventListener('click', function(e) {
                    if (e.target.classList.contains('draggable-item')) {
                        if (selectedItem && selectedItem !== e.target) {
                            // Swap positions
                            const temp = selectedItem.nextSibling;
                            selectedItem.parentNode.insertBefore(selectedItem, e.target.nextSibling);
                            e.target.parentNode.insertBefore(e.target, temp);
                            
                            selectedItem.classList.remove('selected');
                            selectedItem = null;
                        } else if (selectedItem === e.target) {
                            selectedItem.classList.remove('selected');
                            selectedItem = null;
                        } else {
                            selectedItem = e.target;
                            selectedItem.classList.add('selected');
                        }
                    }
                });
            }
        }

        function selectQuizOption(option) {
            const siblings = option.parentElement.querySelectorAll('.quiz-option');
            siblings.forEach(s => s.classList.remove('selected'));
            option.classList.add('selected');
        }

        function showShameMessage() {
            if (!DOM.shameMessage) return;
            
            DOM.shameMessage.style.display = 'block';
            DOM.shameMessage.style.animation = 'shameAnimation 3s ease forwards';
            
            // Remove XP for trying to paste
            gameState.xp = Math.max(0, gameState.xp - 10);
            updateXPDisplay();
            
            setTimeout(() => {
                if (DOM.shameMessage) DOM.shameMessage.style.display = 'none';
            }, 3000);
        }

        // Feedback System
        function openFeedback() {
            if (DOM.feedbackModal) {
                DOM.feedbackModal.style.display = 'flex';
                updateFeedbackPage();
            }
        }

        function closeFeedback() {
            if (DOM.feedbackModal) {
                DOM.feedbackModal.style.display = 'none';
            }
            if (DOM.feedbackText) {
                DOM.feedbackText.value = '';
            }
        }

        function updateFeedbackPage() {
            const sectionTitles = {
                'intro': 'Introduction',
                'starter': 'Starter Activity',
                'bus': 'Bus Topology',
                'star': 'Star Topology',
                'mesh': 'Mesh Topology',
                'comparison': 'Topology Comparison',
                'csmacd': 'CSMA/CD Deep Dive',
                'practice': 'Practice Questions',
                'summary': 'Summary Quiz',
                'extension': 'Extension Activities',
                'videos': 'Videos'
            };
            
            if (DOM.feedbackPage) {
                DOM.feedbackPage.textContent = sectionTitles[gameState.currentSection] || 'Unknown';
            }
        }

        function sendFeedback() {
            if (!DOM.feedbackText) return;
            
            const text = DOM.feedbackText.value.trim();
            if (!text) {
                alert('Please enter your feedback');
                return;
            }
            
            const subject = encodeURIComponent('Network Topology Lesson Feedback');
            const body = encodeURIComponent(
                `Page: ${DOM.feedbackPage ? DOM.feedbackPage.textContent : 'Unknown'}\n\n` +
                `Feedback: ${text}\n\n` +
                `Section ID: ${gameState.currentSection}\n` +
                `Level: ${gameState.level}, XP: ${gameState.xp}`
            );
            
            window.location.href = `mailto:millingtond@mgs.org?subject=${subject}&body=${body}`;
            closeFeedback();
            awardXP(5, 'Feedback Sent', 'feedback');
        }

        // Accessibility Functions
        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
            saveProgress();
        }

        function toggleDyslexiaFont() {
            document.body.classList.toggle('dyslexia-font');
            saveProgress();
        }

        function changeFontSize(size) {
            document.body.classList.remove('font-small', 'font-large', 'font-xlarge');
            if (size !== 'normal') {
                document.body.classList.add('font-' + size);
            }
            saveProgress();
        }

        // Save/Load Progress
        function saveProgress() {
            const data = {
                gameState: {
                    xp: gameState.xp,
                    level: gameState.level,
                    completedSections: Array.from(gameState.completedSections),
                    achievements: Array.from(gameState.achievements),
                    actionsPerformed: Array.from(gameState.actionsPerformed),
                    currentSection: gameState.currentSection,
                    sectionScores: gameState.sectionScores,
                    hintUsage: gameState.hintUsage
                },
                accessibility: {
                    highContrast: document.body.classList.contains('high-contrast'),
                    dyslexiaFont: document.body.classList.contains('dyslexia-font'),
                    fontSize: Array.from(document.body.classList).find(c => c.startsWith('font-')) || 'normal'
                }
            };
            
            try {
                sessionStorage.setItem('networkTopologyProgress', JSON.stringify(data));
            } catch (e) {
                console.warn('Could not save progress:', e);
            }
        }

        function loadProgress() {
            try {
                const saved = sessionStorage.getItem('networkTopologyProgress');
                if (saved) {
                    const data = JSON.parse(saved);
                    
                    // Restore game state
                    gameState.xp = data.gameState.xp || 0;
                    gameState.level = data.gameState.level || 1;
                    gameState.completedSections = new Set(data.gameState.completedSections || []);
                    gameState.achievements = new Set(data.gameState.achievements || []);
                    gameState.actionsPerformed = new Set(data.gameState.actionsPerformed || []);
                    gameState.currentSection = data.gameState.currentSection || 'intro';
                    gameState.sectionScores = data.gameState.sectionScores || {};
                    gameState.hintUsage = data.gameState.hintUsage || {};
                    
                    // Restore accessibility settings
                    if (data.accessibility) {
                        if (data.accessibility.highContrast) {
                            document.body.classList.add('high-contrast');
                        }
                        if (data.accessibility.dyslexiaFont) {
                            document.body.classList.add('dyslexia-font');
                        }
                        if (data.accessibility.fontSize && data.accessibility.fontSize !== 'normal') {
                            document.body.classList.add(data.accessibility.fontSize);
                        }
                    }
                    
                    // Restore completed sections visual state
                    gameState.completedSections.forEach(section => {
                        const pill = document.querySelector(`[data-section="${section}"]`);
                        if (pill) pill.classList.add('completed');
                    });
                }
            } catch (e) {
                console.error('Error loading progress:', e);
            }
        }

        // Add floating animation style
        try {
            const style = document.createElement('style');
            style.textContent = `
                @keyframes floatUp {
                    0% { transform: translateY(0); opacity: 1; }
                    100% { transform: translateY(-50px); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        } catch (e) {
            console.warn('Could not add floating animation style:', e);
        }

        // Auto-save every 30 seconds
        setInterval(saveProgress, 30000);

        // Easter egg: Konami code
        const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let konamiIndex = 0;
        
        document.addEventListener('keydown', function(e) {
            if (e.key === konamiCode[konamiIndex]) {
                konamiIndex++;
                if (konamiIndex === konamiCode.length) {
                    showAchievement('Secret Found!', 'You discovered the Konami code!', 'üéÆ');
                    awardXP(100, 'Easter Egg', 'konami_code');
                    konamiIndex = 0;
                    createParticleEffect();
                }
            } else {
                konamiIndex = 0;
            }
        });

        // Performance monitoring
        const startTime = Date.now();
        
        window.addEventListener('load', function() {
            console.log('Page load time:', Date.now() - startTime, 'ms');
            console.log('Network Topology Lesson initialized successfully');
        });

        // Prevent right-click
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
    </script>
</body>
</html>
                