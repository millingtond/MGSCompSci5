<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binary Arithmetic - Interactive Lesson</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f4f4f4;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        .nav-bar {
            background: #34495e;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .nav-bar button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .nav-bar button:hover {
            background: #2980b9;
        }
        
        .nav-bar button.active {
            background: #2980b9;
        }
        
        .section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .section.active {
            display: block;
        }
        
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .nav-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .nav-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        .info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            width: 200px;
            z-index: 1000;
        }
        
        .xp-bar {
            background: #34495e;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .xp-fill {
            background: #27ae60;
            height: 100%;
            width: 0%;
            transition: width 0.5s;
        }
        
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #27ae60;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
            z-index: 2000;
            animation: popIn 0.5s ease-out;
        }
        
        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        .task-box {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .drag-item {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: move;
            user-select: none;
        }
        
        .drop-zone {
            border: 2px dashed #3498db;
            padding: 10px;
            margin: 10px 0;
            min-height: 50px;
            border-radius: 4px;
            background: #e8f4f8;
        }
        
        .drop-zone.drag-over {
            background: #d4e6f1;
            border-color: #2980b9;
        }
        
        input[type="text"], input[type="number"] {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .correct {
            color: #27ae60;
            font-weight: bold;
        }
        
        .incorrect {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .feedback-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #95a5a6;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 20px;
            z-index: 1000;
        }
        
        .feedback-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
        }
        
        .feedback-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
        }
        
        .reset-button {
            background: #e74c3c;
            float: right;
        }
        
        .reset-button:hover {
            background: #c0392b;
        }
        
        .hint-button {
            background: #f39c12;
        }
        
        .hint-button:hover {
            background: #e67e22;
        }
        
        .hint-text {
            display: none;
            background: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #ffeaa7;
        }
        
        .canvas-container {
            border: 2px solid #3498db;
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
        }
        
        #drawingCanvas {
            display: block;
            cursor: crosshair;
            touch-action: none;
        }
        
        .shame-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 10px;
            display: none;
            z-index: 3000;
            font-size: 24px;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-50%, -50%) rotate(-5deg); }
            75% { transform: translate(-50%, -50%) rotate(5deg); }
        }
        
        .learning-outcome {
            background: #e8f8f5;
            padding: 15px;
            border-left: 4px solid #27ae60;
            margin: 10px 0;
        }
        
        .key-takeaway {
            background: #fef9e7;
            padding: 15px;
            border-left: 4px solid #f39c12;
            margin: 10px 0;
        }
        
        .common-mistake {
            background: #fadbd8;
            padding: 15px;
            border-left: 4px solid #e74c3c;
            margin: 10px 0;
        }
        
        .real-world {
            background: #eaf2f8;
            padding: 15px;
            border-left: 4px solid #3498db;
            margin: 10px 0;
        }
        
        .quiz-question {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        
        .options label {
            display: block;
            padding: 8px;
            margin: 5px 0;
            background: #e9ecef;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .options label:hover {
            background: #dee2e6;
        }
        
        .binary-display {
            font-family: 'Courier New', monospace;
            font-size: 24px;
            background: #2c3e50;
            color: #2ecc71;
            padding: 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px;
        }
        
        .bit-box {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            background: #34495e;
            color: white;
            margin: 2px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 20px;
        }
        
        .bit-box:hover {
            background: #2c3e50;
        }
        
        @media (max-width: 768px) {
            .info-panel {
                position: static;
                width: 100%;
                margin-bottom: 20px;
            }
            
            .nav-bar {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }
        
        .high-contrast {
            background: black !important;
            color: yellow !important;
        }
        
        .high-contrast * {
            background: black !important;
            color: yellow !important;
            border-color: yellow !important;
        }
        
        .dyslexia-font {
            font-family: 'OpenDyslexic', Arial, sans-serif !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Binary Arithmetic</h1>
            <p>Master the fundamentals of binary number operations</p>
        </header>
        
        <div class="info-panel" role="complementary" aria-label="Progress Information">
            <h3>Progress</h3>
            <p>Level: <span id="level">0</span> / 5</p>
            <p>XP: <span id="xp">0</span></p>
            <div class="xp-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <div class="xp-fill" id="xpFill"></div>
            </div>
            <h4>Achievements</h4>
            <div id="achievements"></div>
            <button onclick="toggleAccessibility()" aria-label="Toggle Accessibility Features">
                Accessibility
            </button>
        </div>
        
        <nav class="nav-bar" role="navigation" aria-label="Lesson Navigation">
            <button onclick="showSection(0)" class="active">Start</button>
            <button onclick="showSection(1)">Binary Addition</button>
            <button onclick="showSection(2)">Overflow</button>
            <button onclick="showSection(3)">One's Complement</button>
            <button onclick="showSection(4)">Two's Complement</button>
            <button onclick="showSection(5)">Signed vs Unsigned</button>
            <button onclick="showSection(6)">Binary Subtraction</button>
            <button onclick="showSection(7)">Practice Exam</button>
            <button onclick="showSection(8)">Summary</button>
            <button onclick="showSection(9)">Extension</button>
        </nav>
        
        <!-- Section 0: Starter Activity -->
        <section class="section active" id="section0">
            <h2>Starter Activity: Binary Addition Warm-up</h2>
            
            <div class="learning-outcome">
                <h3>Learning Outcomes</h3>
                <ul>
                    <li>Understand and apply binary addition rules</li>
                    <li>Recognize and explain overflow errors in binary arithmetic</li>
                    <li>Convert between positive and negative binary using complement methods</li>
                    <li>Perform binary subtraction using two's complement</li>
                    <li>Distinguish between signed and unsigned binary representations</li>
                </ul>
            </div>
            
            <div class="task-box">
                <h3>Quick Binary Addition Practice</h3>
                <p>Let's start by testing your current knowledge. Add these two 4-bit binary numbers:</p>
                
                <div style="text-align: center; margin: 20px 0;">
                    <span class="binary-display">0101</span>
                    <span style="font-size: 24px;">+</span>
                    <span class="binary-display">0011</span>
                    <span style="font-size: 24px;">=</span>
                    <input type="text" id="starterAnswer" maxlength="4" placeholder="Enter 4-bit result" aria-label="Binary addition result">
                    <button onclick="checkStarterAnswer()">Check</button>
                </div>
                
                <div id="starterFeedback"></div>
                
                <button class="hint-button" onclick="showHint('starter')">Need a hint?</button>
                <div id="starterHint" class="hint-text">
                    Remember: Start from the rightmost bit (LSB). 1+1=0 with carry 1.
                </div>
            </div>
            
            <button class="reset-button" onclick="resetSection(0)">Reset Activity</button>
            
            <div class="navigation-buttons">
                <button class="nav-btn" disabled>Previous</button>
                <button class="nav-btn" onclick="showSection(1)">Next</button>
            </div>
        </section>
        
        <!-- Section 1: Binary Addition Rules -->
        <section class="section" id="section1">
            <h2>Binary Addition Rules</h2>
            
            <div class="task-box">
                <h3>Understanding Binary Addition</h3>
                <p>Binary addition follows these simple rules:</p>
                <ul>
                    <li>0 + 0 = 0</li>
                    <li>0 + 1 = 1</li>
                    <li>1 + 0 = 1</li>
                    <li>1 + 1 = 0 (carry 1)</li>
                    <li>1 + 1 + 1 = 1 (carry 1)</li>
                </ul>
            </div>
            
            <div class="task-box">
                <h3>Interactive Binary Adder</h3>
                <p>Click on the bits to set your numbers, then see the addition step-by-step:</p>
                
                <div style="text-align: center; margin: 20px 0;">
                    <div id="binaryAdder1">
                        <span class="bit-box" onclick="toggleBit(this)">0</span>
                        <span class="bit-box" onclick="toggleBit(this)">0</span>
                        <span class="bit-box" onclick="toggleBit(this)">0</span>
                        <span class="bit-box" onclick="toggleBit(this)">0</span>
                    </div>
                    <div style="margin: 10px 0;">+</div>
                    <div id="binaryAdder2">
                        <span class="bit-box" onclick="toggleBit(this)">0</span>
                        <span class="bit-box" onclick="toggleBit(this)">0</span>
                        <span class="bit-box" onclick="toggleBit(this)">0</span>
                        <span class="bit-box" onclick="toggleBit(this)">0</span>
                    </div>
                    <button onclick="performAddition()">Add Numbers</button>
                    <div id="additionResult" style="margin-top: 20px;"></div>
                </div>
            </div>
            
            <div class="task-box">
                <h3>Drag and Drop Practice</h3>
                <p>Match the binary additions with their correct results:</p>
                
                <div style="display: flex; justify-content: space-around; flex-wrap: wrap;">
                    <div>
                        <h4>Additions</h4>
                        <div class="drop-zone" id="drop1" ondrop="drop(event)" ondragover="allowDrop(event)">
                            0011 + 0010 = ?
                        </div>
                        <div class="drop-zone" id="drop2" ondrop="drop(event)" ondragover="allowDrop(event)">
                            1010 + 0101 = ?
                        </div>
                        <div class="drop-zone" id="drop3" ondrop="drop(event)" ondragover="allowDrop(event)">
                            1111 + 0001 = ?
                        </div>
                    </div>
                    <div>
                        <h4>Results</h4>
                        <div id="dragItems">
                            <div class="drag-item" draggable="true" ondragstart="drag(event)" id="drag1">10000</div>
                            <div class="drag-item" draggable="true" ondragstart="drag(event)" id="drag2">0101</div>
                            <div class="drag-item" draggable="true" ondragstart="drag(event)" id="drag3">1111</div>
                            <div class="drag-item" draggable="true" ondragstart="drag(event)" id="drag4">0110</div>
                            <div class="drag-item" draggable="true" ondragstart="drag(event)" id="drag5">1001</div>
                        </div>
                    </div>
                </div>
                <button onclick="checkDragDrop()">Check Answers</button>
                <div id="dragDropFeedback"></div>
            </div>
            
            <div class="quiz-question">
                <h4>Quick Check</h4>
                <p>What is the result of 1101 + 0111?</p>
                <div class="options">
                    <label><input type="radio" name="q1" value="a"> 10100</label>
                    <label><input type="radio" name="q1" value="b"> 10000</label>
                    <label><input type="radio" name="q1" value="c"> 11111</label>
                    <label><input type="radio" name="q1" value="d"> 01010</label>
                </div>
                <button onclick="checkQuiz('q1', 'a')">Check</button>
                <div id="q1Feedback"></div>
            </div>
            
            <button class="reset-button" onclick="resetSection(1)">Reset Activity</button>
            
            <div class="navigation-buttons">
                <button class="nav-btn" onclick="showSection(0)">Previous</button>
                <button class="nav-btn" onclick="showSection(2)">Next</button>
            </div>
        </section>
        
        <!-- Section 2: Overflow Errors -->
        <section class="section" id="section2">
            <h2>Understanding Overflow Errors</h2>
            
            <div class="key-takeaway">
                <h3>Key Concept</h3>
                <p>An overflow error occurs when the result of an addition is too big for the number of bits available. In two's complement, overflow happens when adding two numbers with the same sign produces a result with the opposite sign.</p>
            </div>
            
            <div class="task-box">
                <h3>Overflow Simulator</h3>
                <p>Try adding these 4-bit numbers and see when overflow occurs:</p>
                
                <div style="text-align: center;">
                    <select id="num1" aria-label="First number">
                        <option value="0111">0111 (+7)</option>
                        <option value="0110">0110 (+6)</option>
                        <option value="0101">0101 (+5)</option>
                        <option value="1001">1001 (-7)</option>
                        <option value="1010">1010 (-6)</option>
                    </select>
                    <span> + </span>
                    <select id="num2" aria-label="Second number">
                        <option value="0001">0001 (+1)</option>
                        <option value="0010">0010 (+2)</option>
                        <option value="0011">0011 (+3)</option>
                        <option value="1111">1111 (-1)</option>
                        <option value="1110">1110 (-2)</option>
                    </select>
                    <button onclick="simulateOverflow()">Add</button>
                </div>
                
                <div id="overflowResult" style="margin-top: 20px;"></div>
            </div>
            
            <div class="real-world">
                <h3>Real-World Context</h3>
                <p>The Y2K bug was essentially an overflow problem! Many older systems used only 2 digits for years, so after 99, they would overflow to 00, potentially causing date calculations to fail.</p>
            </div>
            
            <div class="task-box">
                <h3>Identify Overflow</h3>
                <p>Which of these 4-bit additions will cause overflow? Select all that apply:</p>
                
                <div id="overflowChoices">
                    <label><input type="checkbox" value="1"> 0111 + 0010 (7 + 2)</label><br>
                    <label><input type="checkbox" value="2"> 0100 + 0011 (4 + 3)</label><br>
                    <label><input type="checkbox" value="3"> 1000 + 1111 (-8 + -1)</label><br>
                    <label><input type="checkbox" value="4"> 0110 + 1001 (6 + -7)</label><br>
                </div>
                <button onclick="checkOverflowChoices()">Check</button>
                <div id="overflowChoicesFeedback"></div>
            </div>
            
            <button class="reset-button" onclick="resetSection(2)">Reset Activity</button>
            
            <div class="navigation-buttons">
                <button class="nav-btn" onclick="showSection(1)">Previous</button>
                <button class="nav-btn" onclick="showSection(3)">Next</button>
            </div>
        </section>
        
        <!-- Section 3: One's Complement -->
        <section class="section" id="section3">
            <h2>One's Complement</h2>
            
            <div class="task-box">
                <h3>Understanding One's Complement</h3>
                <p>One's complement is simply flipping all the bits: 0 becomes 1, and 1 becomes 0.</p>
                
                <div style="text-align: center; margin: 20px 0;">
                    <h4>Interactive Bit Flipper</h4>
                    <div id="bitFlipper">
                        <div>
                            Original: 
                            <span class="bit-box" onclick="toggleFlipperBit(this, 0)">1</span>
                            <span class="bit-box" onclick="toggleFlipperBit(this, 1)">0</span>
                            <span class="bit-box" onclick="toggleFlipperBit(this, 2)">1</span>
                            <span class="bit-box" onclick="toggleFlipperBit(this, 3)">1</span>
                        </div>
                        <button onclick="calculateOnesComplement()">Calculate One's Complement</button>
                        <div id="onesComplementResult" style="margin-top: 10px;"></div>
                    </div>
                </div>
            </div>
            
            <div class="task-box">
                <h3>Practice: Fill in the Blanks</h3>
                <p>Complete the one's complement for each number. Choose from the options provided:</p>
                
                <div style="margin: 20px 0;">
                    <p>1. One's complement of 1010 is: 
                        <select id="ones1" aria-label="One's complement answer 1">
                            <option value="">Select...</option>
                            <option value="0101">0101</option>
                            <option value="1010">1010</option>
                            <option value="0110">0110</option>
                            <option value="1101">1101</option>
                        </select>
                    </p>
                    
                    <p>2. One's complement of 0011 is: 
                        <select id="ones2" aria-label="One's complement answer 2">
                            <option value="">Select...</option>
                            <option value="0011">0011</option>
                            <option value="1100">1100</option>
                            <option value="1010">1010</option>
                            <option value="0110">0110</option>
                        </select>
                    </p>
                    
                    <p>3. One's complement of 1111 is: 
                        <select id="ones3" aria-label="One's complement answer 3">
                            <option value="">Select...</option>
                            <option value="1111">1111</option>
                            <option value="0001">0001</option>
                            <option value="0000">0000</option>
                            <option value="1000">1000</option>
                        </select>
                    </p>
                </div>
                
                <button onclick="checkOnesComplement()">Check Answers</button>
                <div id="onesComplementFeedback"></div>
            </div>
            
            <button class="reset-button" onclick="resetSection(3)">Reset Activity</button>
            
            <div class="navigation-buttons">
                <button class="nav-btn" onclick="showSection(2)">Previous</button>
                <button class="nav-btn" onclick="showSection(4)">Next</button>
            </div>
        </section>
        
        <!-- Section 4: Two's Complement -->
        <section class="section" id="section4">
            <h2>Two's Complement</h2>
            
            <div class="key-takeaway">
                <h3>Key Concept</h3>
                <p>Two's complement = One's complement + 1. This is how we represent negative numbers in binary!</p>
            </div>
            
            <div class="task-box">
                <h3>Step-by-Step Two's Complement Converter</h3>
                <p>Enter a decimal number to see the two's complement conversion process:</p>
                
                <div style="text-align: center;">
                    <input type="number" id="decimalInput" min="-128" max="127" value="-34" aria-label="Decimal number input">
                    <button onclick="showTwosComplementSteps()">Convert</button>
                    <div id="twosSteps" style="margin-top: 20px; text-align: left;"></div>
                </div>
            </div>
            
            <div class="common-mistake">
                <h3>Common Mistake</h3>
                <p>Don't forget to add 1 after flipping the bits! Missing this step is the most common error when calculating two's complement.</p>
            </div>
            
            <div class="task-box">
                <h3>Practice Conversions</h3>
                <p>Convert these numbers to 8-bit two's complement:</p>
                
                <div class="quiz-question">
                    <p>1. Convert -45 to two's complement:</p>
                    <input type="text" id="twos1" maxlength="8" placeholder="8-bit binary" aria-label="Two's complement of -45">
                    <button onclick="checkTwosAnswer('twos1', '11010011')">Check</button>
                    <div id="twos1Feedback"></div>
                </div>
                
                <div class="quiz-question">
                    <p>2. Convert -100 to two's complement:</p>
                    <input type="text" id="twos2" maxlength="8" placeholder="8-bit binary" aria-label="Two's complement of -100">
                    <button onclick="checkTwosAnswer('twos2', '10011100')">Check</button>
                    <div id="twos2Feedback"></div>
                </div>
            </div>
            
            <div class="task-box">
                <h3>Drawing Canvas for Calculations</h3>
                <p>Use this canvas to work out your calculations:</p>
                
                <div class="canvas-container">
                    <canvas id="drawingCanvas" width="600" height="300"></canvas>
                    <button onclick="clearCanvas()">Clear Canvas</button>
                </div>
            </div>
            
            <button class="reset-button" onclick="resetSection(4)">Reset Activity</button>
            
            <div class="navigation-buttons">
                <button class="nav-btn" onclick="showSection(3)">Previous</button>
                <button class="nav-btn" onclick="showSection(5)">Next</button>
            </div>
        </section>
        
        <!-- Section 5: Signed vs Unsigned -->
        <section class="section" id="section5">
            <h2>Signed vs Unsigned Binary</h2>
            
            <div class="task-box">
                <h3>Understanding the Difference</h3>
                <p>The same binary pattern can represent different values depending on whether it's signed or unsigned!</p>
                
                <div style="text-align: center;">
                    <h4>Binary Pattern: <span class="binary-display" id="patternDisplay">10110010</span></h4>
                    <button onclick="randomizePattern()">New Pattern</button>
                    
                    <div style="display: flex; justify-content: space-around; margin-top: 20px;">
                        <div>
                            <h5>Unsigned Value</h5>
                            <p id="unsignedValue" style="font-size: 24px;">?</p>
                        </div>
                        <div>
                            <h5>Signed Value</h5>
                            <p id="signedValue" style="font-size: 24px;">?</p>
                        </div>
                    </div>
                    <button onclick="calculateSignedUnsigned()">Calculate Values</button>
                </div>
            </div>
            
            <div class="task-box">
                <h3>Range Calculator</h3>
                <p>For different bit widths, what's the range of values?</p>
                
                <div style="text-align: center;">
                    <label>Number of bits: 
                        <input type="number" id="bitWidth" min="4" max="16" value="8" aria-label="Number of bits">
                    </label>
                    <button onclick="calculateRange()">Calculate Range</button>
                    <div id="rangeResult" style="margin-top: 20px;"></div>
                </div>
            </div>
            
            <div class="quiz-question">
                <h4>Quick Check</h4>
                <p>In 8-bit two's complement, what decimal value does 11111111 represent?</p>
                <div class="options">
                    <label><input type="radio" name="q5" value="a"> 255</label>
                    <label><input type="radio" name="q5" value="b"> -1</label>
                    <label><input type="radio" name="q5" value="c"> -128</label>
                    <label><input type="radio" name="q5" value="d"> 0</label>
                </div>
                <button onclick="checkQuiz('q5', 'b')">Check</button>
                <div id="q5Feedback"></div>
            </div>
            
            <button class="reset-button" onclick="resetSection(5)">Reset Activity</button>
            
            <div class="navigation-buttons">
                <button class="nav-btn" onclick="showSection(4)">Previous</button>
                <button class="nav-btn" onclick="showSection(6)">Next</button>
            </div>
        </section>
        
        <!-- Section 6: Binary Subtraction -->
        <section class="section" id="section6">
            <h2>Binary Subtraction</h2>
            
            <div class="key-takeaway">
                <h3>Key Concept</h3>
                <p>Binary subtraction is performed by adding the two's complement of the number being subtracted!</p>
                <p>A - B = A + (-B) = A + (two's complement of B)</p>
            </div>
            
            <div class="task-box">
                <h3>Interactive Subtraction Tool</h3>
                <p>Enter two 8-bit binary numbers to see the subtraction process:</p>
                
                <div style="text-align: center;">
                    <input type="text" id="subNum1" maxlength="8" value="01010110" aria-label="First binary number">
                    <span> - </span>
                    <input type="text" id="subNum2" maxlength="8" value="00110010" aria-label="Second binary number">
                    <button onclick="performSubtraction()">Subtract</button>
                    <div id="subtractionSteps" style="margin-top: 20px; text-align: left;"></div>
                </div>
            </div>
            
            <div class="task-box">
                <h3>Practice Problems</h3>
                <p>Solve these binary subtraction problems:</p>
                
                <div class="quiz-question">
                    <p>1. Calculate 1100 - 0101 (show your work on the canvas):</p>
                    <input type="text" id="sub1" maxlength="4" placeholder="4-bit result" aria-label="Subtraction result 1">
                    <button onclick="checkSubAnswer('sub1', '0111')">Check</button>
                    <div id="sub1Feedback"></div>
                </div>
                
                <div class="quiz-question">
                    <p>2. Calculate 10000000 - 00000001 (8-bit):</p>
                    <input type="text" id="sub2" maxlength="8" placeholder="8-bit result" aria-label="Subtraction result 2">
                    <button onclick="checkSubAnswer('sub2', '01111111')">Check</button>
                    <div id="sub2Feedback"></div>
                </div>
            </div>
            
            <button class="reset-button" onclick="resetSection(6)">Reset Activity</button>
            
            <div class="navigation-buttons">
                <button class="nav-btn" onclick="showSection(5)">Previous</button>
                <button class="nav-btn" onclick="showSection(7)">Next</button>
            </div>
        </section>
        
        <!-- Section 7: Practice Exam Questions -->
        <section class="section" id="section7">
            <h2>Practice Exam Questions</h2>
            
            <div class="task-box">
                <h3>Exam-Style Questions</h3>
                <p>Complete these questions as you would in an exam. Enter your predicted marks for each question.</p>
                
                <div class="quiz-question">
                    <h4>Question 1 (4 marks)</h4>
                    <p>a) Convert the decimal number -75 to 8-bit two's complement binary. Show your working. [2 marks]</p>
                    <textarea id="exam1a" rows="4" cols="50" placeholder="Show your working here..." aria-label="Exam answer 1a"></textarea>
                    
                    <p>b) Explain what would happen if you tried to add 0111 1111 and 0000 0010 in 8-bit two's complement. [2 marks]</p>
                    <textarea id="exam1b" rows="3" cols="50" placeholder="Your explanation..." aria-label="Exam answer 1b"></textarea>
                    
                    <p>Predicted marks: <input type="number" id="marks1" min="0" max="4" aria-label="Predicted marks for question 1"> / 4</p>
                    <button onclick="showMarkScheme(1)">Show Mark Scheme</button>
                    <div id="markScheme1" style="display: none;" class="key-takeaway">
                        <h5>Mark Scheme:</h5>
                        <p>a) [2 marks]</p>
                        <ul>
                            <li>Correct binary for +75: 01001011 [1 mark]</li>
                            <li>Correct two's complement: 10110101 [1 mark]</li>
                        </ul>
                        <p>b) [2 marks]</p>
                        <ul>
                            <li>Identifies overflow will occur [1 mark]</li>
                            <li>Explains that result (129) exceeds 8-bit signed range (-128 to 127) [1 mark]</li>
                        </ul>
                    </div>
                </div>
                
                <div class="quiz-question">
                    <h4>Question 2 (3 marks)</h4>
                    <p>Perform the binary subtraction 1010 1100 - 0011 1010 using two's complement. Show all steps. [3 marks]</p>
                    <textarea id="exam2" rows="5" cols="50" placeholder="Show all steps..." aria-label="Exam answer 2"></textarea>
                    
                    <p>Predicted marks: <input type="number" id="marks2" min="0" max="3" aria-label="Predicted marks for question 2"> / 3</p>
                    <button onclick="showMarkScheme(2)">Show Mark Scheme</button>
                    <div id="markScheme2" style="display: none;" class="key-takeaway">
                        <h5>Mark Scheme:</h5>
                        <ul>
                            <li>Correct two's complement of 0011 1010: 1100 0110 [1 mark]</li>
                            <li>Correct addition shown [1 mark]</li>
                            <li>Correct final answer: 0111 0010 [1 mark]</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <button class="reset-button" onclick="resetSection(7)">Reset Activity</button>
            
            <div class="navigation-buttons">
                <button class="nav-btn" onclick="showSection(6)">Previous</button>
                <button class="nav-btn" onclick="showSection(8)">Next</button>
            </div>
        </section>
        
        <!-- Section 8: Summary -->
        <section class="section" id="section8">
            <h2>Summary and Final Quiz</h2>
            
            <div class="key-takeaway">
                <h3>Key Takeaways</h3>
                <ul>
                    <li>Binary addition follows specific rules with carry operations</li>
                    <li>Overflow occurs when results exceed the available bit range</li>
                    <li>One's complement inverts all bits</li>
                    <li>Two's complement = one's complement + 1 (used for negative numbers)</li>
                    <li>Binary subtraction is performed using two's complement addition</li>
                    <li>The MSB indicates sign in signed binary representations</li>
                </ul>
            </div>
            
            <div class="task-box">
                <h3>Drawing Canvas for Calculations</h3>
                <p>Use this canvas to work out your answers for the quiz below:</p>
                
                <div class="canvas-container">
                    <canvas id="summaryCanvas" width="600" height="300"></canvas>
                    <button onclick="clearSummaryCanvas()">Clear Canvas</button>
                </div>
            </div>
            
            <div class="task-box">
                <h3>Final Assessment</h3>
                
                <div class="quiz-question">
                    <p>1. What is 1011 + 0110 in binary?</p>
                    <div class="options">
                        <label><input type="radio" name="final1" value="a"> 10001</label>
                        <label><input type="radio" name="final1" value="b"> 10101</label>
                        <label><input type="radio" name="final1" value="c"> 01111</label>
                        <label><input type="radio" name="final1" value="d"> 11011</label>
                    </div>
                </div>
                
                <div class="quiz-question">
                    <p>2. In 4-bit two's complement, what is the decimal value of 1101?</p>
                    <div class="options">
                        <label><input type="radio" name="final2" value="a"> 13</label>
                        <label><input type="radio" name="final2" value="b"> -3</label>
                        <label><input type="radio" name="final2" value="c"> -5</label>
                        <label><input type="radio" name="final2" value="d"> 5</label>
                    </div>
                </div>
                
                <div class="quiz-question">
                    <p>3. Which situation will NOT cause overflow in 8-bit two's complement?</p>
                    <div class="options">
                        <label><input type="radio" name="final3" value="a"> 01111111 + 00000010</label>
                        <label><input type="radio" name="final3" value="b"> 10000000 + 11111111</label>
                        <label><input type="radio" name="final3" value="c"> 01000000 + 00111111</label>
                        <label><input type="radio" name="final3" value="d"> 01111111 + 10000001</label>
                    </div>
                </div>
                
                <div class="quiz-question">
                    <p>4. What is the one's complement of 10101010?</p>
                    <div class="options">
                        <label><input type="radio" name="final4" value="a"> 01010101</label>
                        <label><input type="radio" name="final4" value="b"> 10101011</label>
                        <label><input type="radio" name="final4" value="c"> 01010110</label>
                        <label><input type="radio" name="final4" value="d"> 11111111</label>
                    </div>
                </div>
                
                <div class="quiz-question">
                    <p>5. To subtract in binary, we:</p>
                    <div class="options">
                        <label><input type="radio" name="final5" value="a"> Use special subtraction rules</label>
                        <label><input type="radio" name="final5" value="b"> Add the two's complement of the subtrahend</label>
                        <label><input type="radio" name="final5" value="c"> Add the one's complement of the subtrahend</label>
                        <label><input type="radio" name="final5" value="d"> Convert to decimal first</label>
                    </div>
                </div>
                
                <div class="quiz-question">
                    <p>6. In unsigned 8-bit binary, what is the maximum value?</p>
                    <div class="options">
                        <label><input type="radio" name="final6" value="a"> 127</label>
                        <label><input type="radio" name="final6" value="b"> 128</label>
                        <label><input type="radio" name="final6" value="c"> 255</label>
                        <label><input type="radio" name="final6" value="d"> 256</label>
                    </div>
                </div>
                
                <div class="quiz-question">
                    <p>7. Which binary addition rule is correct?</p>
                    <div class="options">
                        <label><input type="radio" name="final7" value="a"> 1 + 1 = 1 carry 1</label>
                        <label><input type="radio" name="final7" value="b"> 1 + 1 = 0 carry 1</label>
                        <label><input type="radio" name="final7" value="c"> 1 + 1 = 2</label>
                        <label><input type="radio" name="final7" value="d"> 1 + 1 = 10 carry 0</label>
                    </div>
                </div>
                
                <div class="quiz-question">
                    <p>8. The MSB in a signed binary number represents:</p>
                    <div class="options">
                        <label><input type="radio" name="final8" value="a"> The largest value</label>
                        <label><input type="radio" name="final8" value="b"> The sign (positive/negative)</label>
                        <label><input type="radio" name="final8" value="c"> The overflow bit</label>
                        <label><input type="radio" name="final8" value="d"> The carry bit</label>
                    </div>
                </div>
                
                <button onclick="checkFinalQuiz()">Submit Final Quiz</button>
                <div id="finalQuizResult"></div>
            </div>
            
            <button class="reset-button" onclick="resetSection(8)">Reset Quiz</button>
            
            <div class="navigation-buttons">
                <button class="nav-btn" onclick="showSection(7)">Previous</button>
                <button class="nav-btn" onclick="showSection(9)">Next</button>
            </div>
        </section>
        
        <!-- Section 9: Extension Activities -->
        <section class="section" id="section9">
            <h2>Extension Activities</h2>
            
            <div class="task-box">
                <h3>Beyond the Specification</h3>
                <p>These activities go beyond the A-level requirements to deepen your understanding.</p>
                
                <div class="quiz-question">
                    <h4>1. Booth's Algorithm</h4>
                    <p>Research Booth's algorithm for binary multiplication. Write a brief explanation of how it works and why it's more efficient than repeated addition.</p>
                    <textarea id="extension1" rows="5" cols="50" placeholder="Your research findings..." aria-label="Extension activity 1"></textarea>
                </div>
                
                <div class="quiz-question">
                    <h4>2. IEEE 754 Floating Point</h4>
                    <p>Investigate how computers represent decimal numbers using IEEE 754 standard. What are the three components of a floating-point number?</p>
                    <textarea id="extension2" rows="5" cols="50" placeholder="Your answer..." aria-label="Extension activity 2"></textarea>
                </div>
                
                <div class="quiz-question">
                    <h4>3. Binary Coded Decimal (BCD)</h4>
                    <p>Some systems use BCD instead of pure binary. Research and explain one advantage and one disadvantage of BCD.</p>
                    <textarea id="extension3" rows="4" cols="50" placeholder="Your answer..." aria-label="Extension activity 3"></textarea>
                </div>
            </div>
            
            <div class="task-box">
                <h3>Video Resources</h3>
                <p>Additional video tutorials will be added here to support your learning:</p>
                <div style="background: #ecf0f1; padding: 20px; text-align: center; border-radius: 8px;">
                    <p>[Video placeholder - Binary Arithmetic Explained]</p>
                    <p>[Video placeholder - Two's Complement Deep Dive]</p>
                    <p>[Video placeholder - Real-world Applications]</p>
                </div>
            </div>
            
            <button class="reset-button" onclick="resetSection(9)">Reset Activity</button>
            
            <div class="navigation-buttons">
                <button class="nav-btn" onclick="showSection(8)">Previous</button>
                <button class="nav-btn" disabled>Next</button>
            </div>
        </section>
    </div>
    
    <!-- Achievement Popup -->
    <div id="achievementPopup" class="achievement-popup" role="alert">
        <h3 id="achievementTitle"></h3>
        <p id="achievementText"></p>
    </div>
    
    <!-- Shame Message -->
    <div id="shameMessage" class="shame-message" role="alert">
        <p>üö´ No pasting allowed! Type it yourself! üö´</p>
    </div>
    
    <!-- Feedback Modal -->
    <div id="feedbackModal" class="feedback-modal">
        <div class="feedback-content">
            <h3>Send Feedback</h3>
            <p>Found a bug or have a suggestion? Let us know!</p>
            <p>Current page: <span id="currentPageInfo"></span></p>
            <textarea id="feedbackText" rows="5" cols="40" placeholder="Describe the issue or suggestion..." aria-label="Feedback text"></textarea>
            <button onclick="sendFeedback()">Send</button>
            <button onclick="closeFeedback()">Cancel</button>
        </div>
    </div>
    
    <!-- Feedback Button -->
    <button class="feedback-button" onclick="openFeedback()" aria-label="Send Feedback">
        üìù
    </button>
    
    <script>
        // Global variables
        let currentSection = 0;
        let xp = 0;
        let level = 0;
        let achievements = [];
        let completedTasks = new Set();
        let hintsUsed = new Set();
        
        // Prevent paste
        document.addEventListener('paste', function(e) {
            e.preventDefault();
            showShameMessage();
            return false;
        });
        
        // Canvas setup
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;
        
        // Summary canvas setup
        const summaryCanvas = document.getElementById('summaryCanvas');
        const summaryCtx = summaryCanvas.getContext('2d');
        let drawingOnSummary = false;
        
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('touchstart', handleTouch);
        canvas.addEventListener('touchmove', handleTouch);
        canvas.addEventListener('touchend', stopDrawing);
        
        // Summary canvas event listeners
        summaryCanvas.addEventListener('mousedown', (e) => startDrawingOnCanvas(e, summaryCanvas, true));
        summaryCanvas.addEventListener('mousemove', (e) => drawOnCanvas(e, summaryCanvas, summaryCtx, true));
        summaryCanvas.addEventListener('mouseup', () => stopDrawingOnCanvas(true));
        summaryCanvas.addEventListener('touchstart', (e) => handleTouchOnCanvas(e, summaryCanvas, true));
        summaryCanvas.addEventListener('touchmove', (e) => handleTouchOnCanvas(e, summaryCanvas, true));
        summaryCanvas.addEventListener('touchend', () => stopDrawingOnCanvas(true));
        
        function startDrawing(e) {
            drawing = true;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            ctx.beginPath();
            ctx.moveTo(x, y);
        }
        
        function draw(e) {
            if (!drawing) return;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            ctx.lineTo(x, y);
            ctx.stroke();
        }
        
        function stopDrawing() {
            drawing = false;
        }
        
        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                            e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }
        
        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        // Generic canvas drawing functions
        function startDrawingOnCanvas(e, canvasElement, isSummary = false) {
            if (isSummary) {
                drawingOnSummary = true;
            } else {
                drawing = true;
            }
            const rect = canvasElement.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const context = isSummary ? summaryCtx : ctx;
            context.beginPath();
            context.moveTo(x, y);
        }
        
        function drawOnCanvas(e, canvasElement, context, isSummary = false) {
            if (isSummary ? !drawingOnSummary : !drawing) return;
            const rect = canvasElement.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            context.lineTo(x, y);
            context.stroke();
        }
        
        function stopDrawingOnCanvas(isSummary = false) {
            if (isSummary) {
                drawingOnSummary = false;
            } else {
                drawing = false;
            }
        }
        
        function handleTouchOnCanvas(e, canvasElement, isSummary = false) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                            e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvasElement.dispatchEvent(mouseEvent);
        }
        
        function clearSummaryCanvas() {
            summaryCtx.clearRect(0, 0, summaryCanvas.width, summaryCanvas.height);
        }
        
        // Navigation
        function showSection(index) {
            const sections = document.querySelectorAll('.section');
            const navButtons = document.querySelectorAll('.nav-bar button');
            
            sections.forEach((section, i) => {
                section.classList.toggle('active', i === index);
            });
            
            navButtons.forEach((button, i) => {
                button.classList.toggle('active', i === index);
            });
            
            currentSection = index;
        }
        
        // XP and Achievements
        function addXP(amount) {
            const taskId = event.target.id || Math.random().toString();
            if (completedTasks.has(taskId)) return;
            
            completedTasks.add(taskId);
            xp += amount;
            updateXPDisplay();
            checkLevelUp();
        }
        
        function updateXPDisplay() {
            document.getElementById('xp').textContent = xp;
            const xpPerLevel = 100;
            const progress = (xp % xpPerLevel) / xpPerLevel * 100;
            document.getElementById('xpFill').style.width = progress + '%';
        }
        
        function checkLevelUp() {
            const newLevel = Math.floor(xp / 100);
            if (newLevel > level && newLevel <= 5) {
                level = newLevel;
                document.getElementById('level').textContent = level;
                unlockAchievement('Level ' + level, 'Reached level ' + level + '!');
            }
        }
        
        function unlockAchievement(title, text) {
            if (!achievements.includes(title)) {
                achievements.push(title);
                showAchievementPopup(title, text);
                updateAchievementDisplay();
            }
        }
        
        function showAchievementPopup(title, text) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementText').textContent = text;
            popup.style.display = 'block';
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3000);
        }
        
        function updateAchievementDisplay() {
            const container = document.getElementById('achievements');
            container.innerHTML = achievements.map(a => `<div>üèÜ ${a}</div>`).join('');
        }
        
        // Starter Activity
        function checkStarterAnswer() {
            const answer = document.getElementById('starterAnswer').value;
            const feedback = document.getElementById('starterFeedback');
            
            if (answer === '1000') {
                feedback.innerHTML = '<span class="correct">Correct! 0101 + 0011 = 1000</span>';
                addXP(10);
            } else {
                feedback.innerHTML = '<span class="incorrect">Not quite. Remember to carry when 1+1 occurs.</span>';
            }
        }
        
        // Hint system
        function showHint(hintId) {
            const hint = document.getElementById(hintId + 'Hint');
            hint.style.display = 'block';
            if (!hintsUsed.has(hintId)) {
                hintsUsed.add(hintId);
                addXP(-5); // Reduce XP for using hint
            }
        }
        
        // Binary addition interactive
        function toggleBit(element) {
            element.textContent = element.textContent === '0' ? '1' : '0';
        }
        
        function performAddition() {
            const bits1 = Array.from(document.querySelectorAll('#binaryAdder1 .bit-box')).map(b => b.textContent);
            const bits2 = Array.from(document.querySelectorAll('#binaryAdder2 .bit-box')).map(b => b.textContent);
            
            let carry = 0;
            let result = [];
            let steps = [];
            
            for (let i = 3; i >= 0; i--) {
                const a = parseInt(bits1[i]);
                const b = parseInt(bits2[i]);
                const sum = a + b + carry;
                
                result.unshift(sum % 2);
                carry = Math.floor(sum / 2);
                
                steps.unshift(`Position ${3-i}: ${a} + ${b} + carry(${carry}) = ${sum % 2}, new carry = ${Math.floor(sum / 2)}`);
            }
            
            if (carry > 0) {
                result.unshift(carry);
            }
            
            const resultDiv = document.getElementById('additionResult');
            resultDiv.innerHTML = `
                <h4>Step-by-step:</h4>
                ${steps.map(s => `<p>${s}</p>`).join('')}
                <h4>Result: ${result.join('')}</h4>
            `;
            
            addXP(15);
        }
        
        // Drag and Drop
        function allowDrop(ev) {
            ev.preventDefault();
            ev.target.classList.add('drag-over');
        }
        
        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }
        
        function drop(ev) {
            ev.preventDefault();
            ev.target.classList.remove('drag-over');
            const data = ev.dataTransfer.getData("text");
            ev.target.appendChild(document.getElementById(data));
        }
        
        function checkDragDrop() {
            const correct = {
                'drop1': '0101',
                'drop2': '1111',
                'drop3': '10000'
            };
            
            let allCorrect = true;
            const feedback = document.getElementById('dragDropFeedback');
            
            for (const [dropId, answer] of Object.entries(correct)) {
                const dropZone = document.getElementById(dropId);
                const draggedItem = dropZone.querySelector('.drag-item');
                
                if (!draggedItem || draggedItem.textContent !== answer) {
                    allCorrect = false;
                    break;
                }
            }
            
            if (allCorrect) {
                feedback.innerHTML = '<span class="correct">All correct! Well done!</span>';
                addXP(20);
                unlockAchievement('Drag Master', 'Completed drag and drop perfectly!');
            } else {
                feedback.innerHTML = '<span class="incorrect">Some answers are incorrect. Try again!</span>';
            }
        }
        
        // Quiz checker
        function checkQuiz(questionName, correctAnswer) {
            const selected = document.querySelector(`input[name="${questionName}"]:checked`);
            const feedback = document.getElementById(questionName + 'Feedback');
            
            if (!selected) {
                feedback.innerHTML = '<span class="incorrect">Please select an answer.</span>';
                return;
            }
            
            if (selected.value === correctAnswer) {
                feedback.innerHTML = '<span class="correct">Correct!</span>';
                addXP(10);
            } else {
                feedback.innerHTML = '<span class="incorrect">Incorrect. Try again!</span>';
            }
        }
        
        // Overflow simulator
        function simulateOverflow() {
            const num1 = document.getElementById('num1').value;
            const num2 = document.getElementById('num2').value;
            const resultDiv = document.getElementById('overflowResult');
            
            // Convert to decimal
            const dec1 = parseInt(num1, 2);
            const dec2 = parseInt(num2, 2);
            
            // Check if negative (MSB is 1)
            const signed1 = num1[0] === '1' ? dec1 - 16 : dec1;
            const signed2 = num2[0] === '1' ? dec2 - 16 : dec2;
            
            const sum = signed1 + signed2;
            const binarySum = (dec1 + dec2).toString(2).padStart(4, '0').slice(-4);
            
            let overflow = false;
            if ((signed1 > 0 && signed2 > 0 && sum < 0) || 
                (signed1 < 0 && signed2 < 0 && sum >= 0)) {
                overflow = true;
            }
            
            resultDiv.innerHTML = `
                <p>Decimal: ${signed1} + ${signed2} = ${sum}</p>
                <p>Binary result: ${binarySum}</p>
                <p>Overflow: <span class="${overflow ? 'incorrect' : 'correct'}">${overflow ? 'YES!' : 'No'}</span></p>
                ${overflow ? '<p>The result is outside the range -8 to +7!</p>' : ''}
            `;
            
            addXP(10);
        }
        
        // Check overflow choices
        function checkOverflowChoices() {
            const checkboxes = document.querySelectorAll('#overflowChoices input[type="checkbox"]');
            const correct = ['1', '3']; // Options that cause overflow
            const selected = Array.from(checkboxes)
                .filter(cb => cb.checked)
                .map(cb => cb.value);
            
            const feedback = document.getElementById('overflowChoicesFeedback');
            
            if (JSON.stringify(selected.sort()) === JSON.stringify(correct)) {
                feedback.innerHTML = '<span class="correct">Correct! You identified all overflow cases.</span>';
                addXP(15);
            } else {
                feedback.innerHTML = '<span class="incorrect">Not quite. Remember: overflow occurs when same-sign addition produces opposite sign.</span>';
            }
        }
        
        // One's complement
        function toggleFlipperBit(element, index) {
            element.textContent = element.textContent === '0' ? '1' : '0';
        }
        
        function calculateOnesComplement() {
            const bits = Array.from(document.querySelectorAll('#bitFlipper .bit-box')).map(b => b.textContent);
            const flipped = bits.map(b => b === '0' ? '1' : '0');
            
            document.getElementById('onesComplementResult').innerHTML = `
                <p>One's Complement: <span class="binary-display">${flipped.join('')}</span></p>
            `;
            
            addXP(10);
        }
        
        function checkOnesComplement() {
            const answers = {
                'ones1': '0101',
                'ones2': '1100',
                'ones3': '0000'
            };
            
            let correct = 0;
            const feedback = document.getElementById('onesComplementFeedback');
            
            for (const [id, answer] of Object.entries(answers)) {
                if (document.getElementById(id).value === answer) {
                    correct++;
                }
            }
            
            if (correct === 3) {
                feedback.innerHTML = '<span class="correct">All correct! You understand one\'s complement!</span>';
                addXP(20);
            } else {
                feedback.innerHTML = `<span class="incorrect">${correct}/3 correct. Remember: flip every bit!</span>`;
            }
        }
        
        // Two's complement
        function showTwosComplementSteps() {
            const decimal = parseInt(document.getElementById('decimalInput').value);
            const stepsDiv = document.getElementById('twosSteps');
            
            if (decimal >= -128 && decimal <= 127) {
                let steps = [];
                
                if (decimal >= 0) {
                    const binary = decimal.toString(2).padStart(8, '0');
                    steps.push(`Positive number ${decimal}: ${binary}`);
                } else {
                    const positive = Math.abs(decimal);
                    const positiveBinary = positive.toString(2).padStart(8, '0');
                    const onesComp = positiveBinary.split('').map(b => b === '0' ? '1' : '0').join('');
                    const twosComp = (parseInt(onesComp, 2) + 1).toString(2).padStart(8, '0');
                    
                    steps = [
                        `Step 1: Find positive binary of ${positive}: ${positiveBinary}`,
                        `Step 2: One's complement (flip bits): ${onesComp}`,
                        `Step 3: Add 1: ${twosComp}`,
                        `Result: ${decimal} in two's complement is ${twosComp}`
                    ];
                }
                
                stepsDiv.innerHTML = steps.map(s => `<p>${s}</p>`).join('');
                addXP(15);
            } else {
                stepsDiv.innerHTML = '<p class="incorrect">Please enter a number between -128 and 127.</p>';
            }
        }
        
        function checkTwosAnswer(inputId, correctAnswer) {
            const answer = document.getElementById(inputId).value;
            const feedback = document.getElementById(inputId + 'Feedback');
            
            if (answer === correctAnswer) {
                feedback.innerHTML = '<span class="correct">Correct!</span>';
                addXP(15);
            } else {
                feedback.innerHTML = '<span class="incorrect">Incorrect. Check your calculation.</span>';
            }
        }
        
        // Signed vs Unsigned
        function randomizePattern() {
            const pattern = Math.floor(Math.random() * 256).toString(2).padStart(8, '0');
            document.getElementById('patternDisplay').textContent = pattern;
            document.getElementById('unsignedValue').textContent = '?';
            document.getElementById('signedValue').textContent = '?';
        }
        
        function calculateSignedUnsigned() {
            const pattern = document.getElementById('patternDisplay').textContent;
            const unsigned = parseInt(pattern, 2);
            
            let signed;
            if (pattern[0] === '1') {
                signed = unsigned - 256;
            } else {
                signed = unsigned;
            }
            
            document.getElementById('unsignedValue').textContent = unsigned;
            document.getElementById('signedValue').textContent = signed;
            
            addXP(10);
        }
        
        function calculateRange() {
            const bits = parseInt(document.getElementById('bitWidth').value);
            const unsignedMax = Math.pow(2, bits) - 1;
            const signedMin = -Math.pow(2, bits - 1);
            const signedMax = Math.pow(2, bits - 1) - 1;
            
            document.getElementById('rangeResult').innerHTML = `
                <p><strong>Unsigned:</strong> 0 to ${unsignedMax}</p>
                <p><strong>Signed:</strong> ${signedMin} to ${signedMax}</p>
            `;
            
            addXP(10);
        }
        
        // Binary subtraction
        function performSubtraction() {
            const num1 = document.getElementById('subNum1').value;
            const num2 = document.getElementById('subNum2').value;
            const stepsDiv = document.getElementById('subtractionSteps');
            
            if (num1.length !== 8 || num2.length !== 8) {
                stepsDiv.innerHTML = '<p class="incorrect">Please enter 8-bit binary numbers.</p>';
                return;
            }
            
            // Calculate two's complement of num2
            const onesComp = num2.split('').map(b => b === '0' ? '1' : '0').join('');
            const twosCompDec = parseInt(onesComp, 2) + 1;
            const twosComp = twosCompDec.toString(2).padStart(8, '0').slice(-8);
            
            // Add num1 and two's complement of num2
            let carry = 0;
            let result = [];
            
            for (let i = 7; i >= 0; i--) {
                const sum = parseInt(num1[i]) + parseInt(twosComp[i]) + carry;
                result.unshift(sum % 2);
                carry = Math.floor(sum / 2);
            }
            
            stepsDiv.innerHTML = `
                <p>Step 1: Two's complement of ${num2}:</p>
                <p>&nbsp;&nbsp;One's complement: ${onesComp}</p>
                <p>&nbsp;&nbsp;Add 1: ${twosComp}</p>
                <p>Step 2: Add ${num1} + ${twosComp}:</p>
                <p>&nbsp;&nbsp;Result: ${result.join('')}</p>
                <p>Decimal: ${parseInt(num1, 2)} - ${parseInt(num2, 2)} = ${parseInt(result.join(''), 2)}</p>
            `;
            
            addXP(20);
        }
        
        function checkSubAnswer(inputId, correctAnswer) {
            const answer = document.getElementById(inputId).value;
            const feedback = document.getElementById(inputId + 'Feedback');
            
            if (answer === correctAnswer) {
                feedback.innerHTML = '<span class="correct">Correct!</span>';
                addXP(15);
            } else {
                feedback.innerHTML = '<span class="incorrect">Incorrect. Remember to use two\'s complement.</span>';
            }
        }
        
        // Exam questions
        function showMarkScheme(questionNum) {
            const markScheme = document.getElementById('markScheme' + questionNum);
            const marksInput = document.getElementById('marks' + questionNum);
            
            // Check if they've attempted the question
            const textAreas = questionNum === 1 ? 
                [document.getElementById('exam1a'), document.getElementById('exam1b')] :
                [document.getElementById('exam2')];
            
            const totalLength = textAreas.reduce((sum, ta) => sum + ta.value.length, 0);
            
            if (totalLength < 50) {
                alert('Please make a reasonable attempt at the question before viewing the mark scheme.');
                return;
            }
            
            markScheme.style.display = 'block';
            
            // Award XP based on predicted marks
            const marks = parseInt(marksInput.value) || 0;
            addXP(marks * 5);
        }
        
        // Final quiz
        function checkFinalQuiz() {
            const answers = {
                'final1': 'a',
                'final2': 'b',
                'final3': 'd',
                'final4': 'a',
                'final5': 'b',
                'final6': 'c',
                'final7': 'b',
                'final8': 'b'
            };
            
            let correct = 0;
            
            for (const [question, answer] of Object.entries(answers)) {
                const selected = document.querySelector(`input[name="${question}"]:checked`);
                if (selected && selected.value === answer) {
                    correct++;
                }
            }
            
            const percentage = Math.round((correct / 8) * 100);
            const resultDiv = document.getElementById('finalQuizResult');
            
            resultDiv.innerHTML = `
                <h3>Final Score: ${correct}/8 (${percentage}%)</h3>
                <p>${percentage >= 80 ? 'Excellent work!' : 
                     percentage >= 60 ? 'Good effort!' : 
                     'Keep practicing!'}</p>
            `;
            
            addXP(correct * 10);
            
            if (percentage === 100) {
                unlockAchievement('Perfect Score', 'Got 100% on the final quiz!');
            }
        }
        
        // Reset functions
        function resetSection(sectionNum) {
            switch(sectionNum) {
                case 0:
                    document.getElementById('starterAnswer').value = '';
                    document.getElementById('starterFeedback').innerHTML = '';
                    document.getElementById('starterHint').style.display = 'none';
                    break;
                case 1:
                    // Reset binary adder
                    document.querySelectorAll('.bit-box').forEach(b => b.textContent = '0');
                    document.getElementById('additionResult').innerHTML = '';
                    // Reset drag and drop
                    const dragItems = document.getElementById('dragItems');
                    document.querySelectorAll('.drag-item').forEach(item => {
                        dragItems.appendChild(item);
                    });
                    document.getElementById('dragDropFeedback').innerHTML = '';
                    // Reset quiz
                    document.querySelectorAll('input[name="q1"]').forEach(r => r.checked = false);
                    document.getElementById('q1Feedback').innerHTML = '';
                    break;
                // Add more cases as needed
            }
        }
        
        // Feedback system
        function openFeedback() {
            document.getElementById('feedbackModal').style.display = 'block';
            document.getElementById('currentPageInfo').textContent = `Section ${currentSection + 1}`;
        }
        
        function closeFeedback() {
            document.getElementById('feedbackModal').style.display = 'none';
            document.getElementById('feedbackText').value = '';
        }
        
        function sendFeedback() {
            const feedback = document.getElementById('feedbackText').value;
            const section = currentSection;
            
            // Construct email
            const subject = encodeURIComponent('Binary Arithmetic Lesson Feedback');
            const body = encodeURIComponent(`Feedback for Section ${section + 1}:\n\n${feedback}\n\nRelevant code section: ${window.location.href}#section${section}`);
            const mailtoLink = `mailto:millingtond@mgs.org?subject=${subject}&body=${body}`;
            
            window.location.href = mailtoLink;
            closeFeedback();
        }
        
        // Shame message
        function showShameMessage() {
            const shame = document.getElementById('shameMessage');
            shame.style.display = 'block';
            setTimeout(() => {
                shame.style.display = 'none';
            }, 2000);
        }
        
        // Accessibility
        function toggleAccessibility() {
            const body = document.body;
            body.classList.toggle('high-contrast');
            body.classList.toggle('dyslexia-font');
        }
        
        // Mobile gestures
        let touchStartX = 0;
        document.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
        });
        
        document.addEventListener('touchend', e => {
            const touchEndX = e.changedTouches[0].clientX;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > 50) { // Swipe threshold
                if (diff > 0 && currentSection < 9) { // Swipe left
                    showSection(currentSection + 1);
                } else if (diff < 0 && currentSection > 0) { // Swipe right
                    showSection(currentSection - 1);
                }
            }
        });
        
        // Initialize
        randomizePattern();
    </script>
</body>
</html>