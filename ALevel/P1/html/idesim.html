<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Development Environment (IDE) Simulation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --dark-bg: #1a1b26;
            --main-bg: #24283b;
            --light-bg: #414868;
            --text-main: #c0caf5;
            --text-bright: #ffffff;
            --accent-blue: #7aa2f7;
            --accent-green: #9ece6a;
            --accent-red: #f7768e;
            --accent-orange: #ff9e64;
            --accent-purple: #bb9af7;
            --border-color: rgba(192, 202, 245, 0.15);
            --shadow-color: rgba(0, 0, 0, 0.5);
        }

        html, body {
            height: 100%;
            overflow: hidden; /* Prevent double scrollbars */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-main);
        }

        .font-fira {
            font-family: 'Fira Code', monospace;
        }

        /* Enhanced Glassmorphism & Gradients */
        .glassmorphism {
            background: rgba(36, 40, 59, 0.65);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px 0 var(--shadow-color);
        }
        .animated-gradient {
            background: linear-gradient(-45deg, #1a1b26, #24283b, var(--accent-blue), var(--accent-purple));
            background-size: 400% 400%;
            animation: gradient-animation 20s ease infinite;
        }
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Transitions & GPU Acceleration */
        .simulation-step, .modal-content, .nav-button, .quiz-option {
            transition: opacity 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            will-change: transform, opacity;
            transform: translateZ(0);
        }
        .simulation-step:not(.active) {
            display: none;
        }
        .simulation-step.hidden-step {
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px);
        }
        .simulation-step.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Button Styles */
        .nav-button {
            position: relative;
            overflow: hidden;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.3s ease;
        }
        .nav-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 7px 25px rgba(122, 162, 247, 0.4);
        }
        .nav-button:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .quiz-option {
            transition: border-color 0.3s ease, background-color 0.3s ease, transform 0.2s ease;
        }
        .quiz-option:hover:not(:disabled) {
             border-color: var(--accent-blue);
             background-color: var(--light-bg);
             transform: translateY(-2px);
        }
        
        .ripple {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.7);
            transform: scale(0);
            animation: ripple-animation 0.6s linear;
        }
        @keyframes ripple-animation {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        /* Mock IDE Styles */
        .code-line-number { color: #5c6370; padding-right: 1.5rem; text-align: right; user-select: none; }
        .code-keyword { color: var(--accent-purple); }
        .code-variable { color: var(--text-main); }
        .code-string { color: var(--accent-green); }
        .code-comment { color: #565f89; font-style: italic; }
        .code-function { color: var(--accent-blue); }
        .code-number { color: var(--accent-orange); }
        .code-parameter { color: #e0af68; }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body class="animated-gradient">

    <div id="simulation-container" class="max-w-7xl mx-auto p-4 sm:p-6 h-full grid grid-rows-[auto_1fr]">
        <header class="text-center mb-4 flex-shrink-0">
            <h1 class="text-3xl sm:text-4xl font-bold text-white tracking-tight">IDE Simulation</h1>
            <p class="text-lg text-text-main mt-2">Cambridge 9618 A-Level Computer Science</p>
        </header>

        <main id="main-content" class="glassmorphism rounded-2xl p-4 sm:p-6 grid grid-rows-[1fr_auto] shadow-2xl opacity-0 transition-opacity duration-700 min-h-0">
            <div id="simulation-steps-container" class="overflow-y-auto pr-2 min-h-0">
                <!-- Step 1: Intro -->
                <div id="step-1" class="simulation-step active">
                    <h2 class="text-2xl font-bold text-white mb-4">What is an IDE?</h2>
                    <p class="mb-4 text-lg leading-relaxed">An <strong class="text-accent-blue">Integrated Development Environment (IDE)</strong> is a powerful software application that provides comprehensive tools for programmers, combining them into a single graphical user interface.</p>
                    <p class="text-lg leading-relaxed">This simulation will walk you through the key features that make IDEs essential for efficient software development. Use the navigation buttons or arrow keys to proceed.</p>
                    <div class="mt-8 p-6 bg-dark-bg/50 rounded-lg border border-border-color">
                        <h3 class="font-semibold text-accent-purple mb-2">Key takeaway</h3>
                        <p>Think of an IDE as a programmer's ultimate workshop, containing an editor, debugger, and compiler/interpreter all in one place.</p>
                    </div>
                </div>

                <!-- Step 2: Colour Coding (Python) -->
                <div id="step-2" class="simulation-step hidden-step">
                    <h2 class="text-2xl font-bold text-white mb-4">The Smart Editor: Colour Coding</h2>
                    <p class="mb-6">One of the most noticeable features is <strong class="text-accent-blue">colour coding</strong> (also called syntax highlighting or pretty printing). It improves readability by displaying different parts of the code in different colours.</p>
                    <div class="bg-dark-bg rounded-lg p-4 font-fira text-sm sm:text-base overflow-hidden">
                        <pre id="code-block-colour"><code># A simple Python function
def add_numbers(num1, num2):
    # This is a comment
    result = num1 + num2
    print(f"The result is: {result}")

add_numbers(5, 10)</code></pre>
                    </div>
                </div>

                <!-- Step 3: Auto-complete (Python) -->
                <div id="step-3" class="simulation-step hidden-step">
                    <h2 class="text-2xl font-bold text-white mb-4">Intelligent Assistance: Auto-Complete</h2>
                    <p class="mb-6">IDEs speed up coding with <strong class="text-accent-blue">auto-completion</strong>. They suggest functions, methods, and variables as you type, reducing typos and saving time.</p>
                    <div class="bg-dark-bg rounded-lg p-4 font-fira text-sm sm:text-base relative">
                        <pre><code><span class="code-variable">user_name</span> = <span class="code-string">"Alice"</span>
<span id="log-start">pri</span><span id="typing-cursor" class="inline-block w-0.5 h-5 bg-white align-bottom animate-pulse"></span></code></pre>
                        <div id="autocomplete-box" class="absolute bg-light-bg border border-border-color rounded-md shadow-lg p-2 mt-1 opacity-0 pointer-events-none transition-opacity duration-300" style="left: 0.5rem; top: 2.8rem;">
                           <div class="bg-accent-blue/50 text-white p-2 rounded-sm">print()</div>
                           <div class="p-2 hover:bg-main-bg rounded-sm cursor-pointer">property()</div>
                        </div>
                    </div>
                </div>
                
                <!-- Step 4: Syntax Checking (Python) -->
                <div id="step-4" class="simulation-step hidden-step">
                    <h2 class="text-2xl font-bold text-white mb-4">Error Prevention: Dynamic Syntax Checking</h2>
                    <p class="mb-6">IDEs check your code for syntax errors <strong class="text-accent-blue">in real-time</strong>. This helps you catch mistakes immediately, long before you try to run the program.</p>
                     <div class="bg-dark-bg rounded-lg p-4 font-fira text-sm sm:text-base relative">
                        <pre id="code-block-error"><code><span class="code-keyword">def</span> <span class="code-function">greet</span>(<span class="code-parameter">name</span>) <span id="syntax-error-location" class="transition-all"></span>
    <span class="code-function">print</span>(<span class="code-string">f"Hello, {name}!"</span>)

<span class="code-function">greet</span>(<span class="code-string">"World"</span>)</code></pre>
                    </div>
                </div>

                <!-- Step 5: Debugging (Python) -->
                <div id="step-5" class="simulation-step hidden-step">
                     <h2 class="text-2xl font-bold text-white mb-4">The Debugger: Finding & Fixing Bugs</h2>
                    <p class="mb-2">The <strong class="text-accent-blue">debugger</strong> is a suite of tools to analyze a program's execution and pinpoint logical errors (bugs).</p>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-dark-bg rounded-lg p-4 font-fira text-sm sm:text-base relative">
                            <div class="step-highlight absolute left-0 right-0 h-6 rounded-sm" style="top: 48px;"></div>
                            <div class="absolute left-0 top-0 bottom-0 w-10 bg-main-bg/50">
                               <div class="breakpoint" style="top: 72px;"></div>
                            </div>
                            <pre class="pl-8"><code><span class="code-line-number">1</span> <span class="code-comment"># Finding the largest number</span>
<span class="code-line-number">2</span> <span class="code-variable">numbers</span> = [<span class="code-number">10</span>, <span class="code-number">50</span>, <span class="code-number">20</span>]
<span class="code-line-number">3</span> <span class="code-variable">largest</span> = <span class="code-number">0</span>
<span class="code-line-number">4</span> 
<span class="code-line-number">5</span> <span class="code-keyword">for</span> <span class="code-variable">number</span> <span class="code-keyword">in</span> <span class="code-variable">numbers</span>:
<span class="code-line-number">6</span>     <span class="code-keyword">if</span> <span class="code-variable">number</span> > <span class="code-variable">largest</span>:
<span class="code-line-number">7</span>         <span class="code-variable">largest</span> = <span class="code-variable">number</span>
<span class="code-line-number">8</span> 
<span class="code-line-number">9</span> <span class="code-function">print</span>(<span class="code-variable">largest</span>)</code></pre>
                        </div>
                        <div class="space-y-4">
                             <div class="glassmorphism rounded-lg p-4">
                               <h3 class="text-lg font-bold text-accent-orange mb-2 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 256 256"><path fill="currentColor" d="M128 24a104 104 0 1 0 104 104A104.11 104.11 0 0 0 128 24Zm0 192a88 88 0 1 1 88-88a88.1 88.1 0 0 1-88 88Zm64-88a64 64 0 1 1-64-64a64.07 64.07 0 0 1 64 64Z"/></svg>Breakpoints</h3>
                               <p>You set a <strong class="text-accent-red">breakpoint</strong> to pause execution at a specific line, letting you inspect the program's state.</p>
                            </div>
                            <div class="glassmorphism rounded-lg p-4">
                                <h3 class="text-lg font-bold text-accent-orange mb-2 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M6 5H4v14h2V5m5 0H9v14h2V5m1.5 14h-1l4-7l-4-7h1l4 7l-4 7M18 5h-2v14h2V5Z"/></svg>Single Stepping</h3>
                               <p>This executes the program <strong class="text-accent-blue">one line at a time</strong>, letting you trace the logic flow precisely.</p>
                            </div>
                            <div class="glassmorphism rounded-lg p-4">
                                <h3 class="text-lg font-bold text-accent-orange mb-2 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M13 9h-2V7h2m0 10h-2v-6h2m-1-9A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8Z"/></svg>Variables Report</h3>
                                <p>A window shows the <strong class="text-accent-blue">current values</strong> of variables, updating as you step through.</p>
                                <div id="variables-window" class="mt-2 p-3 bg-dark-bg/70 rounded font-fira text-sm">
                                    <p><span class="code-variable">number</span>: <span id="var-number" class="code-number transition-colors">undefined</span></p>
                                    <p><span class="code-variable">largest</span>: <span id="var-largest" class="code-number transition-colors">undefined</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Step 6: Quiz -->
                <div id="step-6" class="simulation-step hidden-step">
                    <h2 class="text-2xl font-bold text-white mb-4">Knowledge Check</h2>
                    <p class="mb-6">Time to test your understanding of IDE features.</p>
                    <div id="quiz-container" class="glassmorphism rounded-lg p-6"></div>
                </div>
                <!-- Step 7: Results -->
                <div id="step-7" class="simulation-step hidden-step">
                    <h2 class="text-2xl font-bold text-white mb-4">Quiz Complete!</h2>
                    <div id="results-container" class="text-center">
                        <p class="text-xl mb-4">You scored <span id="final-score" class="font-bold text-accent-green">0</span> out of <span id="total-questions" class="font-bold text-white">0</span>.</p>
                        <div id="results-feedback" class="text-left space-y-4 max-w-2xl mx-auto"></div>
                        <button id="reset-button" class="nav-button text-white font-bold py-3 px-6 rounded-lg mt-8 transition-transform duration-200 flex items-center gap-2 mx-auto">
                           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M12 4c-4.41 0-8 3.59-8 8s3.59 8 8 8s8-3.59 8-8s-3.59-8-8-8Zm-1 12H9V8h2v8Zm4 0h-2V8h2v8Z"/></svg>
                            Try Again
                        </button>
                    </div>
                </div>
            </div>

            <div id="navigation" class="pt-4 flex justify-between items-center flex-shrink-0">
                <button id="prev-button" class="nav-button text-white font-bold py-2 px-5 rounded-lg flex items-center gap-2" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M15.41 16.58L10.83 12l4.58-4.59L14 6l-6 6l6 6l1.41-1.42Z"/></svg>
                    Previous
                </button>
                <div id="step-indicator" class="flex space-x-2"></div>
                <button id="next-button" class="nav-button text-white font-bold py-2 px-5 rounded-lg flex items-center gap-2">
                    Next
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M8.59 16.58L13.17 12L8.59 7.41L10 6l6 6l-6 6l-1.41-1.42Z"/></svg>
                </button>
            </div>
        </main>
    </div>

    <!-- Modal for instructions -->
    <div id="instruction-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="glassmorphism rounded-2xl p-8 max-w-2xl w-full shadow-2xl text-center border-t-4 border-accent-blue transform scale-95 transition-transform duration-300">
            <h2 class="text-3xl font-bold text-white mb-4">Welcome to the IDE Simulation!</h2>
            <p class="text-lg mb-6">This interactive guide will explore the essential features of an Integrated Development Environment (IDE).</p>
            <p class="mb-8">Click 'Next' or use the <kbd class="bg-light-bg px-2 py-1 rounded-md text-text-main font-fira">&rarr;</kbd> arrow key to move through the steps. Click 'Previous' or use the <kbd class="bg-light-bg px-2 py-1 rounded-md text-text-main font-fira">&larr;</kbd> arrow key to go back.</p>
            <button id="start-simulation-button" class="nav-button text-white font-bold py-3 px-8 rounded-lg text-lg">
                Let's Begin
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Caching ---
            const mainContent = document.getElementById('main-content');
            const steps = Array.from(document.querySelectorAll('.simulation-step'));
            const prevButton = document.getElementById('prev-button');
            const nextButton = document.getElementById('next-button');
            const stepIndicatorContainer = document.getElementById('step-indicator');
            const instructionModal = document.getElementById('instruction-modal');
            const startButton = document.getElementById('start-simulation-button');
            const resetButton = document.getElementById('reset-button');
            const quizContainer = document.getElementById('quiz-container');

            // --- State ---
            let currentStep = 0;
            const totalSteps = steps.length;
            let animationIntervalId = null;
            let quizScore = 0;
            let currentQuestionIndex = 0;
            let quizFinished = false;

            const quizQuestions = [
                {
                    type: 'mcq',
                    question: "An IDE is described as 'integrated' because it...",
                    options: [
                        'Connects directly to the internet for cloud compilation.',
                        'Can be integrated into any operating system.',
                        'Combines several development tools (editor, debugger, etc.) into one application.',
                        'Uses an integrated circuit for faster processing.'
                    ],
                    answer: 'Combines several development tools (editor, debugger, etc.) into one application.',
                    explanation: "The 'Integrated' in IDE refers to the bundling of multiple essential programming tools into a single, cohesive environment."
                },
                {
                    type: 'mcq',
                    question: 'Which feature improves code readability by displaying keywords, variables, and strings in different colours?',
                    options: ['Auto-complete', 'Debugger', 'Colour Coding', 'Compiler'],
                    answer: 'Colour Coding',
                    explanation: 'Colour coding, or syntax highlighting, is designed to make code easier to read by differentiating its components visually.'
                },
                {
                    type: 'mcq',
                    question: 'While typing `pri`, the IDE suggests `print()`. This feature is known as:',
                    options: ['Auto-correct', 'Dynamic Syntax Checking', 'Auto-completion', 'Single Stepping'],
                    answer: 'Auto-completion',
                    explanation: 'Auto-completion (or intellisense) predicts the code you intend to write and offers suggestions from available libraries, functions, and variables to speed up coding.'
                },
                 {
                    type: 'mcq',
                    question: 'What is the primary role of "Dynamic Syntax Checking" in an IDE?',
                    options: [
                        'To translate the code into machine language.',
                        'To format the code according to style guidelines.',
                        'To identify and flag errors in the code as it is being written.',
                        'To suggest more efficient algorithms.'
                    ],
                    answer: 'To identify and flag errors in the code as it is being written.',
                    explanation: 'Dynamic syntax checking provides real-time feedback on errors, allowing developers to fix them immediately rather than waiting until compilation or runtime.'
                },
                {
                    type: 'text',
                    question: 'You want your program to pause execution on a specific line so you can inspect its state. What is the name of the debugger feature you would set on that line?',
                    answer: 'breakpoint',
                    explanation: 'A breakpoint is an intentional stopping or pausing place in a program, put in place for debugging purposes.'
                },
                {
                    type: 'mcq',
                    question: 'In a large code file, what feature allows a programmer to hide the body of a function to get a better overview of the code structure?',
                    options: ['Commenting out', 'Code folding (or collapsing)', 'The debugger', 'Pretty printing'],
                    answer: 'Code folding (or collapsing)',
                    explanation: 'Code folding allows developers to selectively hide and display blocks of code, which is invaluable for navigating and understanding large or complex files.'
                },
                 {
                    type: 'mcq',
                    question: 'What is the primary purpose of a debugger\'s "single stepping" feature?',
                    options: [
                        'To run the entire program very slowly.',
                        'To execute code one line at a time to trace its flow.',
                        'To automatically fix single-line errors.',
                        'To check for syntax errors in a single file.'
                    ],
                    answer: 'To execute code one line at a time to trace its flow.',
                    explanation: 'Single stepping allows a developer to carefully follow the execution path of the code, observing how variables change and how control flows between different parts of the program.'
                },
                {
                    type: 'text',
                    question: 'During a debugging session, which specific window would you watch to see how the value of a variable changes as you step through the code?',
                    answer: 'variables', // Special check for 'variables', 'watch', 'expression'
                    explanation: 'The variables/watch window is a core part of the debugger that displays the current state (value) of variables in the current scope, updating in real-time as the program executes.'
                }
            ];

            // --- Functions ---
            const createStepIndicators = () => {
                stepIndicatorContainer.innerHTML = '';
                for (let i = 0; i < totalSteps; i++) {
                    const indicator = document.createElement('div');
                    indicator.className = `w-3 h-3 rounded-full transition-all duration-300 ${i === currentStep ? 'bg-accent-blue scale-125' : 'bg-light-bg'}`;
                    stepIndicatorContainer.appendChild(indicator);
                }
            };
            
            const runStepAnimations = (stepIndex) => {
                clearInterval(animationIntervalId);
                resetStepAnimations();

                setTimeout(() => {
                    switch(stepIndex) {
                        case 1: 
                            const codeBlock = document.getElementById('code-block-colour');
                            const originalHTML = codeBlock.innerHTML;
                            codeBlock.innerHTML = `<code>${codeBlock.innerText}</code>`;
                            setTimeout(() => applySyntaxHighlighting(codeBlock, originalHTML), 500);
                            break;
                        case 2:
                            const autocompleteBox = document.getElementById('autocomplete-box');
                            animationIntervalId = setTimeout(() => {
                               autocompleteBox.classList.remove('opacity-0', 'pointer-events-none');
                               document.getElementById('log-start').textContent = "print";
                               document.getElementById('typing-cursor').classList.add('hidden');
                            }, 800);
                            break;
                        case 3:
                            const errorLocation = document.getElementById('syntax-error-location');
                             animationIntervalId = setTimeout(() => {
                                errorLocation.textContent = ":";
                                errorLocation.style.cssText = 'color: var(--accent-red); font-weight: bold; text-decoration: underline wavy var(--accent-red) 2px;';
                            }, 800);
                            break;
                        case 4: 
                            const breakpoint = document.querySelector('.breakpoint');
                            const highlight = document.querySelector('#step-5 .step-highlight');
                            const varNumber = document.getElementById('var-number');
                            const varLargest = document.getElementById('var-largest');
                            
                            const debugSteps = [
                                { line: 4, number: '10', largest: '0' },
                                { line: 5, number: '10', largest: '0' },
                                { line: 6, number: '10', largest: '10' },
                                { line: 4, number: '50', largest: '10' },
                                { line: 5, number: '50', largest: '10' },
                                { line: 6, number: '50', largest: '50' },
                                { line: 4, number: '20', largest: '50' },
                                { line: 5, number: '20', largest: '50' },
                                { line: 8, number: '20', largest: '50' },
                            ];
                            
                            let debugStep = 0;
                            setTimeout(() => {
                                breakpoint.classList.add('visible');
                                highlight.style.top = '96px';
                                varLargest.textContent = '0';
                            }, 500);
                            
                            animationIntervalId = setInterval(() => {
                                if (debugStep >= debugSteps.length) {
                                    clearInterval(animationIntervalId);
                                    return;
                                }
                                const stepData = debugSteps[debugStep];
                                highlight.style.top = `${24 + (stepData.line * 24)}px`;
                                varNumber.textContent = stepData.number;
                                varLargest.textContent = stepData.largest;
                                varNumber.classList.add('text-accent-orange', 'scale-125');
                                varLargest.classList.add('text-accent-orange', 'scale-125');
                                setTimeout(() => {
                                  varNumber.classList.remove('text-accent-orange', 'scale-125');
                                  varLargest.classList.remove('text-accent-orange', 'scale-125');
                                }, 300);
                                debugStep++;
                            }, 1200);
                            break;
                    }
                }, 200);
            };

            const resetStepAnimations = () => {
                clearInterval(animationIntervalId);
                document.getElementById('autocomplete-box').classList.add('opacity-0', 'pointer-events-none');
                document.getElementById('log-start').textContent = 'pri';
                document.getElementById('typing-cursor').classList.remove('hidden');
                
                const errorLocation = document.getElementById('syntax-error-location');
                errorLocation.textContent = '';
                errorLocation.style.cssText = '';
                
                document.querySelector('.breakpoint').classList.remove('visible');
                const highlight = document.querySelector('#step-5 .step-highlight');
                if (highlight) highlight.style.top = '48px';
                document.getElementById('var-number').textContent = 'undefined';
                document.getElementById('var-largest').textContent = 'undefined';
                applySyntaxHighlighting(document.getElementById('code-block-colour'), document.getElementById('code-block-colour').innerHTML);
            };

            const applySyntaxHighlighting = (block, html) => {
                 block.innerHTML = (html || block.innerHTML)
                    .replace(/\b(def|return|for|if|in)\b/g, '<span class="code-keyword">$&</span>')
                    .replace(/\b(add_numbers|greet|print)\b/g, '<span class="code-function">$&</span>')
                    .replace(/(\".*?\"|\'.*?\')/g, '<span class="code-string">$&</span>')
                    .replace(/(#.*)/g, '<span class="code-comment">$&</span>')
                    .replace(/\b(\d+)\b/g, '<span class="code-number">$&</span>')
                    .replace(/\b(num1|num2|name)\b/g, '<span class="code-parameter">$&</span>')
                    .replace(/\b(result|numbers|largest|user_name|number)\b/g, '<span class="code-variable">$&</span>');
            };

            const updateUIForStep = () => {
                steps.forEach((step, index) => {
                    step.classList.toggle('active', index === currentStep);
                    step.classList.toggle('hidden-step', index !== currentStep);
                });
                
                prevButton.disabled = currentStep === 0;
                const onQuizStep = steps[currentStep].id === 'step-6';

                if (onQuizStep) {
                    if (quizFinished) {
                        nextButton.classList.remove('hidden');
                        nextButton.disabled = false;
                    } else {
                        nextButton.classList.add('hidden');
                        nextButton.disabled = true;
                    }
                } else {
                    nextButton.classList.remove('hidden');
                    nextButton.disabled = currentStep === totalSteps - 1;
                }
                 if(steps[currentStep].id === 'step-7') nextButton.classList.add('hidden');

                createStepIndicators();
                runStepAnimations(currentStep);
            };
            
            const handleNextClick = () => {
                const onQuizStep = steps[currentStep].id === 'step-6';
                if(onQuizStep && quizFinished) {
                    showResults();
                } else {
                    showNextStep();
                }
            };

            const showNextStep = () => {
                if (currentStep < totalSteps - 1) {
                    document.getElementById('simulation-steps-container').scrollTop = 0;
                    currentStep++;
                    updateUIForStep();
                }
            };

            const showPrevStep = () => {
                if (currentStep > 0) {
                    document.getElementById('simulation-steps-container').scrollTop = 0;
                    currentStep--;
                    updateUIForStep();
                }
            };
            
            const startQuiz = () => {
                quizScore = 0;
                currentQuestionIndex = 0;
                quizFinished = false;
                updateUIForStep();
                displayQuizQuestion();
            };

            const displayQuizQuestion = () => {
                if (currentQuestionIndex >= quizQuestions.length) return;

                const q = quizQuestions[currentQuestionIndex];
                let content = `<h3 class="text-xl font-semibold text-white mb-4">Question ${currentQuestionIndex + 1}/${quizQuestions.length}</h3>
                               <p class="mb-6 text-text-main">${q.question}</p>`;

                if (q.type === 'mcq') {
                    content += `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">`;
                    q.options.forEach(option => {
                        content += `<button class="quiz-option text-left w-full p-4 border-2 border-border-color rounded-lg">${option}</button>`;
                    });
                    content += `</div>`;
                } else if (q.type === 'text') {
                    content += `<form id="text-answer-form" class="flex flex-col items-start">
                                    <input type="text" id="text-answer" class="w-full md:w-2/3 bg-dark-bg border-2 border-border-color rounded-lg p-3 text-text-main focus:border-accent-blue focus:ring-0 outline-none" placeholder="Your answer here...">
                                    <button type="submit" id="submit-text-answer" class="nav-button text-white font-bold py-2 px-5 rounded-lg mt-4">Submit Answer</button>
                                </form>`;
                }
                
                content += `<div id="feedback" class="mt-4 p-4 rounded-lg opacity-0 transition-opacity duration-300"></div>`;
                quizContainer.innerHTML = content;
            };

            const handleQuizAnswer = (e) => {
                e.preventDefault();
                const target = e.target;
                if (target.matches('.quiz-option')) checkMCQAnswer(target.textContent);
                else if (target.id === 'submit-text-answer' || e.type === 'submit') {
                    const input = document.getElementById('text-answer');
                    if (input.value.trim().length >= 5) checkTextAnswer(input.value);
                    else {
                       const feedbackEl = document.getElementById('feedback');
                       feedbackEl.innerHTML = `Please provide a more specific answer.`;
                       feedbackEl.className = 'flex items-center gap-2 mt-4 p-4 rounded-lg bg-accent-orange/20 text-accent-orange opacity-100';
                    }
                }
            };

            const showFeedback = (isCorrect, explanation, correctAnswerText) => {
                const feedbackEl = document.getElementById('feedback');
                let feedbackHTML = '';
                if (isCorrect) {
                    feedbackHTML = `<strong class="font-bold">Correct!</strong> ${explanation}`;
                    feedbackEl.className = 'flex items-center gap-2 mt-4 p-4 rounded-lg bg-accent-green/20 text-accent-green opacity-100';
                    quizScore++;
                } else {
                    feedbackHTML = `<strong class="font-bold">Not quite.</strong> The correct answer is <strong class="text-white">${correctAnswerText}</strong>. ${explanation}`;
                    feedbackEl.className = 'flex items-center gap-2 mt-4 p-4 rounded-lg bg-accent-red/20 text-accent-red opacity-100';
                }
                feedbackEl.innerHTML = feedbackHTML;
                
                setTimeout(() => {
                    currentQuestionIndex++;
                    if (currentQuestionIndex >= quizQuestions.length) {
                        quizFinished = true;
                        updateUIForStep();
                    } else {
                        displayQuizQuestion();
                    }
                }, 4000);
            };

            const checkMCQAnswer = (selectedOption) => {
                const q = quizQuestions[currentQuestionIndex];
                document.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.disabled = true;
                    if (opt.textContent === q.answer) opt.classList.add('border-accent-green', 'bg-accent-green/10');
                });
                const isCorrect = selectedOption === q.answer;
                if (!isCorrect) {
                    const wrongButton = Array.from(document.querySelectorAll('.quiz-option')).find(opt => opt.textContent === selectedOption);
                    if (wrongButton) wrongButton.classList.add('border-accent-red', 'bg-accent-red/10');
                }
                showFeedback(isCorrect, q.explanation, q.answer);
            };

            const checkTextAnswer = (answer) => {
                const q = quizQuestions[currentQuestionIndex];
                document.getElementById('submit-text-answer').disabled = true;
                const userAnswer = answer.trim().toLowerCase();
                
                let isCorrect;
                let correctAnswerText = `'${q.answer}'`;
                if (q.answer === 'variables') { 
                    isCorrect = userAnswer.includes('variable') || userAnswer.includes('watch') || userAnswer.includes('expression');
                    correctAnswerText = "'variables', 'watch', or 'expressions' window";
                } else {
                    isCorrect = userAnswer.includes(q.answer);
                }
                showFeedback(isCorrect, q.explanation, correctAnswerText);
            };

            const showResults = () => {
                currentStep = totalSteps - 1;
                updateUIForStep();
                document.getElementById('final-score').textContent = quizScore;
                document.getElementById('total-questions').textContent = quizQuestions.length;
                
                const feedbackContainer = document.getElementById('results-feedback');
                feedbackContainer.innerHTML = '<h3 class="text-xl font-bold text-white mb-3">Review:</h3>';
                quizQuestions.forEach((q, index) => {
                    const div = document.createElement('div');
                    div.className = 'p-4 bg-main-bg/70 rounded-lg';
                    div.innerHTML = `<p class="font-semibold text-text-main">${index + 1}. ${q.question}</p>
                                     <p class="text-accent-green mt-2"><strong>Correct Answer:</strong> ${q.answer === 'variables' ? 'variables/watch window' : q.answer}</p>`;
                    feedbackContainer.appendChild(div);
                });
            };

            const resetSimulation = () => {
                currentStep = 0;
                quizScore = 0;
                currentQuestionIndex = 0;
                quizFinished = false;
                resetStepAnimations();
                updateUIForStep();
            };
            
            const createRipple = (event) => {
              const button = event.currentTarget;
              const circle = document.createElement("span");
              const diameter = Math.max(button.clientWidth, button.clientHeight);
              const radius = diameter / 2;
              circle.style.width = circle.style.height = `${diameter}px`;
              circle.style.left = `${event.clientX - button.offsetLeft - radius}px`;
              circle.style.top = `${event.clientY - button.offsetTop - radius}px`;
              circle.classList.add("ripple");
              const ripple = button.getElementsByClassName("ripple")[0];
              if (ripple) { ripple.remove(); }
              button.appendChild(circle);
            }

            // --- Event Listeners ---
            startButton.addEventListener('click', () => {
                instructionModal.style.opacity = '0';
                instructionModal.querySelector('.glassmorphism').style.transform = 'scale(0.95)';
                setTimeout(() => {
                    instructionModal.classList.add('hidden');
                    mainContent.classList.remove('opacity-0');
                    runStepAnimations(currentStep);
                }, 300);
            });

            nextButton.addEventListener('click', handleNextClick);
            prevButton.addEventListener('click', showPrevStep);
            resetButton.addEventListener('click', resetSimulation);
            document.querySelectorAll('.nav-button').forEach(button => button.addEventListener('click', createRipple));
            quizContainer.addEventListener('click', handleQuizAnswer);
            quizContainer.addEventListener('submit', handleQuizAnswer);
            document.addEventListener('keydown', (e) => {
                if (!instructionModal.classList.contains('hidden') || e.target.tagName === 'INPUT') return;
                if (e.key === 'ArrowRight' && !nextButton.disabled) { e.preventDefault(); handleNextClick(); } 
                else if (e.key === 'ArrowLeft' && !prevButton.disabled) { e.preventDefault(); showPrevStep(); }
            });
            
            const init = () => {
                const quizStepObserver = new IntersectionObserver((entries) => {
                    if (entries[0].isIntersecting) {
                        if (currentQuestionIndex === 0 && !quizFinished) {
                           startQuiz();
                        }
                    }
                }, { threshold: 0.5 });
                const quizStepElement = document.getElementById('step-6');
                if(quizStepElement) {
                   quizStepObserver.observe(quizStepElement);
                }
                
                const modalContent = instructionModal.querySelector('.glassmorphism');
                setTimeout(() => { modalContent.style.transform = 'scale(1)'; }, 50);
                
                updateUIForStep();
            };
            init();
        });
    </script>
</body>
</html>
