<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Operating Systems - Lesson 1</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --dark-bg: #1f2937;
            --light-bg: #f3f4f6;
            --text-dark: #111827;
            --text-light: #6b7280;
            --border-color: #e5e7eb;
            --success-color: #10b981;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: #f9fafb;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), #7c3aed);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.1); opacity: 0.1; }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .learning-outcomes {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border-left: 5px solid var(--secondary-color);
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: none;
        }

        .section.active {
            display: block;
        }

        .nav-bar {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            position: sticky;
            top: 10px;
            z-index: 100;
        }

        .nav-btn {
            padding: 8px 16px;
            border: none;
            background: var(--light-bg);
            color: var(--text-dark);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .nav-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .stats-bar {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .xp-bar {
            width: 200px;
            height: 20px;
            background: var(--light-bg);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), #22c55e);
            width: 0%;
            transition: width 0.5s ease;
        }

        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.5s ease;
            z-index: 1000;
            max-width: 300px;
        }

        .achievement-popup.show {
            transform: translateX(0);
        }

        .achievement-popup h3 {
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .task-card {
            background: var(--light-bg);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .task-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.1);
        }

        .button {
            padding: 10px 20px;
            border: none;
            background: var(--primary-color);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            margin: 5px;
        }

        .button:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
        }

        .button.secondary {
            background: var(--secondary-color);
        }

        .button.danger {
            background: var(--danger-color);
        }

        input[type="text"], input[type="number"], textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            background: white;
        }

        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .quiz-option {
            display: block;
            padding: 15px;
            margin: 10px 0;
            background: var(--light-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-option:hover {
            border-color: var(--primary-color);
            background: #f0f9ff;
        }

        .quiz-option.selected {
            border-color: var(--primary-color);
            background: #dbeafe;
        }

        .quiz-option.correct {
            border-color: var(--success-color);
            background: #d1fae5;
        }

        .quiz-option.incorrect {
            border-color: var(--danger-color);
            background: #fee2e2;
        }

        .drag-item {
            padding: 12px;
            margin: 8px;
            background: #dbeafe;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
        }

        .drag-item:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
        }

        .drag-item.selected {
            background: var(--primary-color);
            color: white;
        }

        .drop-zone {
            min-height: 50px;
            padding: 15px;
            margin: 10px 0;
            background: var(--light-bg);
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .drop-zone.highlight {
            border-color: var(--primary-color);
            background: #f0f9ff;
        }

        .drop-zone.correct {
            border-color: var(--success-color);
            background: #d1fae5;
        }

        .drop-zone.incorrect {
            border-color: var(--danger-color);
            background: #fee2e2;
        }

        .simulation-container {
            background: var(--dark-bg);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .process-box {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .process-box.active {
            background: rgba(16, 185, 129, 0.3);
            border-color: var(--success-color);
            transform: scale(1.05);
        }

        .feedback-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
            z-index: 999;
            font-size: 20px;
        }

        .feedback-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .feedback-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
            align-items: center;
            justify-content: center;
        }

        .feedback-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .nav-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--border-color);
        }

        .accessibility-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 998;
        }

        .high-contrast {
            background: black !important;
            color: white !important;
        }

        .high-contrast * {
            background: black !important;
            color: white !important;
            border-color: white !important;
        }

        .dyslexia-font {
            font-family: 'OpenDyslexic', Arial, sans-serif !important;
        }

        .canvas-container {
            border: 2px solid var(--border-color);
            border-radius: 8px;
            margin: 20px 0;
            background: white;
            position: relative;
        }

        #drawingCanvas {
            cursor: crosshair;
            touch-action: none;
        }

        .shame-message {
            background: #fee2e2;
            border: 2px solid var(--danger-color);
            color: var(--danger-color);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .nav-bar {
                position: relative;
                top: 0;
            }
            
            .stats-bar {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .xp-bar {
                width: 100%;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hint-box {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
        }

        .particle {
            position: fixed;
            pointer-events: none;
            opacity: 0;
            animation: particle-float 2s ease-out forwards;
        }

        @keyframes particle-float {
            0% {
                opacity: 1;
                transform: translateY(0) scale(0);
            }
            50% {
                opacity: 1;
                transform: translateY(-100px) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-200px) scale(0.5);
            }
        }
    </style>
</head>
<body>
    <div class="accessibility-controls">
        <button onclick="toggleHighContrast()" class="button" style="font-size: 12px; padding: 5px 10px;">High Contrast</button>
        <button onclick="changeFontSize(1)" class="button" style="font-size: 12px; padding: 5px 10px;">A+</button>
        <button onclick="changeFontSize(-1)" class="button" style="font-size: 12px; padding: 5px 10px;">A-</button>
    </div>

    <div class="container">
        <div class="header">
            <h1>Operating Systems - Part 1</h1>
            <p>Understanding the fundamentals of Operating Systems</p>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <span>Level: <strong id="level">0</strong>/5</span>
            </div>
            <div class="stat-item">
                <span>XP: <strong id="xp">0</strong></span>
                <div class="xp-bar">
                    <div class="xp-fill" id="xpFill"></div>
                </div>
            </div>
            <div class="stat-item">
                <span>Achievements: <strong id="achievements">0</strong></span>
            </div>
        </div>

        <div class="nav-bar" role="navigation" aria-label="Section navigation">
            <button class="nav-btn active" onclick="showSection(0)" aria-label="Go to Learning Outcomes">Learning Outcomes</button>
            <button class="nav-btn" onclick="showSection(1)" aria-label="Go to Starter Activity">Starter Activity</button>
            <button class="nav-btn" onclick="showSection(2)" aria-label="Go to Why OS?">Why OS?</button>
            <button class="nav-btn" onclick="showSection(3)" aria-label="Go to Memory Management">Memory</button>
            <button class="nav-btn" onclick="showSection(4)" aria-label="Go to File Management">Files</button>
            <button class="nav-btn" onclick="showSection(5)" aria-label="Go to Security Management">Security</button>
            <button class="nav-btn" onclick="showSection(6)" aria-label="Go to Hardware Management">Hardware</button>
            <button class="nav-btn" onclick="showSection(7)" aria-label="Go to Process Management">Processes</button>
            <button class="nav-btn" onclick="showSection(8)" aria-label="Go to Real World">Real World</button>
            <button class="nav-btn" onclick="showSection(9)" aria-label="Go to Exam Practice">Exam Practice</button>
            <button class="nav-btn" onclick="showSection(10)" aria-label="Go to Summary">Summary</button>
        </div>

        <!-- Section 0: Learning Outcomes -->
        <div class="section active" id="section0">
            <div class="learning-outcomes">
                <h2>🎯 Learning Outcomes</h2>
                <p>By the end of this lesson, you will be able to:</p>
                <ul>
                    <li>Explain why a computer system requires an Operating System (OS)</li>
                    <li>Describe the five key management tasks carried out by an Operating System</li>
                    <li>Understand memory management including allocation and virtual memory</li>
                    <li>Explain file management and directory structures</li>
                    <li>Describe security management features of an OS</li>
                    <li>Understand hardware management and device drivers</li>
                    <li>Explain process management and multitasking</li>
                </ul>
            </div>
            <div class="nav-controls">
                <button class="button secondary" disabled>Previous</button>
                <button class="button" onclick="nextSection()">Start Lesson →</button>
            </div>
        </div>

        <!-- Section 1: Starter Activity -->
        <div class="section" id="section1">
            <h2>🚀 Starter Activity: OS or Not?</h2>
            <p>Test your current knowledge! Click each item to categorize it as either an Operating System or Not an Operating System.</p>
            
            <div class="task-card">
                <div id="starterItems" style="display: flex; flex-wrap: wrap; gap: 10px; margin: 20px 0;">
                    <!-- Items will be added by JavaScript -->
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                    <div class="drop-zone" id="osZone">
                        <h3>Operating Systems</h3>
                        <div id="osItems"></div>
                    </div>
                    <div class="drop-zone" id="notOsZone">
                        <h3>Not Operating Systems</h3>
                        <div id="notOsItems"></div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="button" onclick="checkStarter()">Check Answers</button>
                    <button class="button secondary" onclick="resetStarter()">Reset</button>
                    <button class="button secondary" onclick="showHint('starter')">Hint (-5 XP)</button>
                </div>
                
                <div id="starterFeedback" style="margin-top: 20px;"></div>
                <div id="starterHint" class="hint-box">
                    <strong>Hint:</strong> Operating Systems manage computer resources and provide a platform for running applications. Think about what controls your computer vs what runs on top of it.
                </div>
            </div>
            
            <div class="nav-controls">
                <button class="button secondary" onclick="previousSection()">← Previous</button>
                <button class="button" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Section 2: Why do we need an OS? -->
        <div class="section" id="section2">
            <h2>🤔 Why Do We Need an Operating System?</h2>
            
            <div class="task-card">
                <h3>Interactive Simulation: Computer Without an OS</h3>
                <p>Click the buttons below to see what happens when you try to use a computer without an Operating System:</p>
                
                <div class="simulation-container">
                    <div id="noOsSimulation" style="min-height: 300px; position: relative;">
                        <div style="text-align: center; padding: 20px;">
                            <h4>Computer Hardware</h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 20px 0;">
                                <button class="button" onclick="tryNoOs('app')">Run Application</button>
                                <button class="button" onclick="tryNoOs('file')">Save File</button>
                                <button class="button" onclick="tryNoOs('print')">Print Document</button>
                                <button class="button" onclick="tryNoOs('network')">Connect to Internet</button>
                            </div>
                            <div id="noOsOutput" style="margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 8px; min-height: 100px;">
                                <p>Click a button to see what happens...</p>
                            </div>
                        </div>
                    </div>
                    <button class="button secondary" onclick="resetNoOsSimulation()">Reset Simulation</button>
                </div>
            </div>

            <div class="task-card">
                <h3>Fill in the Blanks</h3>
                <p>Complete the following sentences about why we need an Operating System. Choose from the options provided:</p>
                
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 20px 0;">
                    <span class="drag-item" onclick="selectWord(this, 'interface')">interface</span>
                    <span class="drag-item" onclick="selectWord(this, 'hardware')">hardware</span>
                    <span class="drag-item" onclick="selectWord(this, 'software')">software</span>
                    <span class="drag-item" onclick="selectWord(this, 'games')">games</span>
                    <span class="drag-item" onclick="selectWord(this, 'resources')">resources</span>
                    <span class="drag-item" onclick="selectWord(this, 'music')">music</span>
                    <span class="drag-item" onclick="selectWord(this, 'applications')">applications</span>
                    <span class="drag-item" onclick="selectWord(this, 'videos')">videos</span>
                </div>
                
                <div style="font-size: 18px; line-height: 2;">
                    <p>1. An Operating System provides an <input type="text" id="blank1" style="width: 150px; display: inline-block;"> between the user and the computer <input type="text" id="blank2" style="width: 150px; display: inline-block;">.</p>
                    <p>2. The OS manages system <input type="text" id="blank3" style="width: 150px; display: inline-block;"> and allows multiple <input type="text" id="blank4" style="width: 150px; display: inline-block;"> to run.</p>
                </div>
                
                <button class="button" onclick="checkBlanks()">Check Answers</button>
                <button class="button secondary" onclick="resetBlanks()">Reset</button>
                <div id="blanksFeedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Short Answer Question</h3>
                <p>In your own words, explain why a computer system requires an Operating System. Your answer should be at least 50 words.</p>
                <textarea id="osReason" rows="4" placeholder="Start your answer here..."></textarea>
                <button class="button" onclick="checkOsReason()">Submit Answer</button>
                <div id="osReasonFeedback" style="margin-top: 20px;"></div>
            </div>
            
            <div class="nav-controls">
                <button class="button secondary" onclick="previousSection()">← Previous</button>
                <button class="button" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Section 3: Memory Management -->
        <div class="section" id="section3">
            <h2>💾 Memory Management</h2>
            
            <div class="task-card">
                <h3>Interactive Memory Allocation Simulator</h3>
                <p>Watch how the OS allocates memory to different programs. Click "Add Program" to see memory allocation in action:</p>
                
                <div class="simulation-container">
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1;">
                            <h4>RAM (8GB Total)</h4>
                            <div id="memoryDisplay" style="background: #374151; height: 400px; border-radius: 8px; padding: 10px; position: relative; overflow: hidden;">
                                <!-- Memory blocks will be added here -->
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <h4>Control Panel</h4>
                            <button class="button" onclick="addProgram()">Add Program</button>
                            <button class="button danger" onclick="removeProgram()">Remove Program</button>
                            <button class="button secondary" onclick="resetMemory()">Reset</button>
                            <div style="margin-top: 20px;">
                                <p>Programs Running: <span id="programCount">0</span></p>
                                <p>Memory Used: <span id="memoryUsed">0</span> MB</p>
                                <p>Memory Free: <span id="memoryFree">8192</span> MB</p>
                            </div>
                            <div id="memoryLog" style="margin-top: 20px; height: 150px; overflow-y: auto; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;">
                                <p style="color: #9ca3af;">Memory allocation log...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-card">
                <h3>Memory Management Quiz</h3>
                <div id="memoryQuiz">
                    <p><strong>What happens when a program requests more memory than is physically available?</strong></p>
                    <label class="quiz-option" onclick="selectQuizOption(this, 'mem1')">
                        <input type="radio" name="memQ1" value="a" style="display: none;">
                        The computer immediately crashes
                    </label>
                    <label class="quiz-option" onclick="selectQuizOption(this, 'mem1')">
                        <input type="radio" name="memQ1" value="b" style="display: none;">
                        The OS uses virtual memory (paging) to extend available memory
                    </label>
                    <label class="quiz-option" onclick="selectQuizOption(this, 'mem1')">
                        <input type="radio" name="memQ1" value="c" style="display: none;">
                        The program is deleted permanently
                    </label>
                    <label class="quiz-option" onclick="selectQuizOption(this, 'mem1')">
                        <input type="radio" name="memQ1" value="d" style="display: none;">
                        Nothing happens, the request is ignored
                    </label>
                </div>
                <button class="button" onclick="checkMemoryQuiz()">Check Answer</button>
                <div id="memoryQuizFeedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Virtual Memory Explanation</h3>
                <p>Complete this matching exercise about virtual memory:</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4>Terms</h4>
                        <div class="drag-item" onclick="selectMatch(this, 'paging')">Paging</div>
                        <div class="drag-item" onclick="selectMatch(this, 'swap')">Swap Space</div>
                        <div class="drag-item" onclick="selectMatch(this, 'thrashing')">Thrashing</div>
                        <div class="drag-item" onclick="selectMatch(this, 'frame')">Page Frame</div>
                    </div>
                    <div>
                        <h4>Definitions</h4>
                        <div class="drop-zone" data-match="paging">Dividing memory into fixed-size blocks</div>
                        <div class="drop-zone" data-match="swap">Area on hard disk used as virtual memory</div>
                        <div class="drop-zone" data-match="thrashing">Excessive swapping causing performance issues</div>
                        <div class="drop-zone" data-match="frame">Fixed-size block in physical memory</div>
                    </div>
                </div>
                <button class="button" onclick="checkMatching('memory')">Check Matches</button>
                <button class="button secondary" onclick="resetMatching('memory')">Reset</button>
                <div id="matchingFeedback" style="margin-top: 20px;"></div>
            </div>
            
            <div class="nav-controls">
                <button class="button secondary" onclick="previousSection()">← Previous</button>
                <button class="button" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Section 4: File Management -->
        <div class="section" id="section4">
            <h2>📁 File Management</h2>
            
            <div class="task-card">
                <h3>File System Structure</h3>
                <p>Build a directory structure by organizing files into the correct folders:</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4>Files to Organize</h4>
                        <div id="filesToOrganize">
                            <div class="drag-item" onclick="selectFile(this, 'system')">kernel.sys</div>
                            <div class="drag-item" onclick="selectFile(this, 'user')">vacation.jpg</div>
                            <div class="drag-item" onclick="selectFile(this, 'system')">driver.dll</div>
                            <div class="drag-item" onclick="selectFile(this, 'user')">report.docx</div>
                            <div class="drag-item" onclick="selectFile(this, 'program')">chrome.exe</div>
                            <div class="drag-item" onclick="selectFile(this, 'user')">music.mp3</div>
                            <div class="drag-item" onclick="selectFile(this, 'program')">office.exe</div>
                            <div class="drag-item" onclick="selectFile(this, 'system')">config.ini</div>
                        </div>
                    </div>
                    <div>
                        <h4>Directory Structure</h4>
                        <div class="drop-zone" data-folder="system">
                            <strong>/System</strong>
                            <div id="systemFiles"></div>
                        </div>
                        <div class="drop-zone" data-folder="program">
                            <strong>/Program Files</strong>
                            <div id="programFiles"></div>
                        </div>
                        <div class="drop-zone" data-folder="user">
                            <strong>/Users/Documents</strong>
                            <div id="userFiles"></div>
                        </div>
                    </div>
                </div>
                <button class="button" onclick="checkFileOrganization()">Check Organization</button>
                <button class="button secondary" onclick="resetFileOrganization()">Reset</button>
                <div id="fileOrgFeedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>File Permissions</h3>
                <p>Match the file permissions with their meanings:</p>
                
                <table style="width: 100%; margin: 20px 0;">
                    <tr>
                        <th>Permission</th>
                        <th>Meaning</th>
                    </tr>
                    <tr>
                        <td>Read (R)</td>
                        <td><select id="perm1">
                            <option value="">Select...</option>
                            <option value="modify">Modify file contents</option>
                            <option value="view">View file contents</option>
                            <option value="run">Run the file</option>
                            <option value="delete">Delete the file</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td>Write (W)</td>
                        <td><select id="perm2">
                            <option value="">Select...</option>
                            <option value="modify">Modify file contents</option>
                            <option value="view">View file contents</option>
                            <option value="run">Run the file</option>
                            <option value="delete">Delete the file</option>
                        </select></td>
                    </tr>
                    <tr>
                        <td>Execute (X)</td>
                        <td><select id="perm3">
                            <option value="">Select...</option>
                            <option value="modify">Modify file contents</option>
                            <option value="view">View file contents</option>
                            <option value="run">Run the file</option>
                            <option value="delete">Delete the file</option>
                        </select></td>
                    </tr>
                </table>
                <button class="button" onclick="checkPermissions()">Check Answers</button>
                <div id="permissionsFeedback" style="margin-top: 20px;"></div>
            </div>
            
            <div class="nav-controls">
                <button class="button secondary" onclick="previousSection()">← Previous</button>
                <button class="button" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Section 5: Security Management -->
        <div class="section" id="section5">
            <h2>🔒 Security Management</h2>
            
            <div class="task-card">
                <h3>Security Scenario Analysis</h3>
                <p>Read each scenario and identify the security management feature being used:</p>
                
                <div style="margin: 20px 0;">
                    <div style="background: var(--light-bg); padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                        <p><strong>Scenario 1:</strong> Sarah tries to access her colleague's personal files but receives an "Access Denied" message.</p>
                        <select id="security1" style="margin-top: 10px;">
                            <option value="">Select security feature...</option>
                            <option value="firewall">Firewall Protection</option>
                            <option value="antivirus">Antivirus Scanning</option>
                            <option value="permissions">File Permissions</option>
                            <option value="encryption">Data Encryption</option>
                        </select>
                    </div>
                    
                    <div style="background: var(--light-bg); padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                        <p><strong>Scenario 2:</strong> John enters his username and password to log into the computer.</p>
                        <select id="security2" style="margin-top: 10px;">
                            <option value="">Select security feature...</option>
                            <option value="auth">User Authentication</option>
                            <option value="backup">System Backup</option>
                            <option value="update">System Updates</option>
                            <option value="monitor">Performance Monitoring</option>
                        </select>
                    </div>
                    
                    <div style="background: var(--light-bg); padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                        <p><strong>Scenario 3:</strong> The OS automatically blocks a suspicious program from making changes to system files.</p>
                        <select id="security3" style="margin-top: 10px;">
                            <option value="">Select security feature...</option>
                            <option value="uac">User Access Control</option>
                            <option value="defrag">Disk Defragmentation</option>
                            <option value="indexing">File Indexing</option>
                            <option value="compression">File Compression</option>
                        </select>
                    </div>
                </div>
                
                <button class="button" onclick="checkSecurityScenarios()">Check Answers</button>
                <div id="securityFeedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Security Features True or False</h3>
                <div id="securityTrueFalse">
                    <div style="margin: 15px 0;">
                        <p>1. The OS can encrypt files to protect sensitive data.</p>
                        <label class="quiz-option" onclick="selectTF(this, 'sec1', true)">
                            <input type="radio" name="secTF1" value="true" style="display: none;"> True
                        </label>
                        <label class="quiz-option" onclick="selectTF(this, 'sec1', false)">
                            <input type="radio" name="secTF1" value="false" style="display: none;"> False
                        </label>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <p>2. User accounts and passwords are managed by individual applications, not the OS.</p>
                        <label class="quiz-option" onclick="selectTF(this, 'sec2', true)">
                            <input type="radio" name="secTF2" value="true" style="display: none;"> True
                        </label>
                        <label class="quiz-option" onclick="selectTF(this, 'sec2', false)">
                            <input type="radio" name="secTF2" value="false" style="display: none;"> False
                        </label>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <p>3. The OS maintains audit logs to track user activities and system events.</p>
                        <label class="quiz-option" onclick="selectTF(this, 'sec3', true)">
                            <input type="radio" name="secTF3" value="true" style="display: none;"> True
                        </label>
                        <label class="quiz-option" onclick="selectTF(this, 'sec3', false)">
                            <input type="radio" name="secTF3" value="false" style="display: none;"> False
                        </label>
                    </div>
                </div>
                <button class="button" onclick="checkSecurityTF()">Check Answers</button>
                <div id="securityTFFeedback" style="margin-top: 20px;"></div>
            </div>
            
            <div class="nav-controls">
                <button class="button secondary" onclick="previousSection()">← Previous</button>
                <button class="button" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Section 6: Hardware Management -->
        <div class="section" id="section6">
            <h2>🖥️ Hardware Management</h2>
            
            <div class="task-card">
                <h3>Device Driver Matching</h3>
                <p>Match each hardware device with its primary function in the OS:</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div>
                        <div class="drag-item" onclick="selectHardware(this, 'gpu')">Graphics Card</div>
                        <div class="drag-item" onclick="selectHardware(this, 'network')">Network Adapter</div>
                        <div class="drag-item" onclick="selectHardware(this, 'storage')">Hard Drive</div>
                        <div class="drag-item" onclick="selectHardware(this, 'input')">Keyboard</div>
                        <div class="drag-item" onclick="selectHardware(this, 'audio')">Sound Card</div>
                        <div class="drag-item" onclick="selectHardware(this, 'printer')">Printer</div>
                    </div>
                    <div>
                        <div class="drop-zone" data-hardware="gpu">Renders visual output to display</div>
                        <div class="drop-zone" data-hardware="network">Enables internet connectivity</div>
                        <div class="drop-zone" data-hardware="storage">Provides persistent data storage</div>
                        <div class="drop-zone" data-hardware="input">Accepts user text input</div>
                        <div class="drop-zone" data-hardware="audio">Processes sound output</div>
                        <div class="drop-zone" data-hardware="printer">Produces physical documents</div>
                    </div>
                </div>
                <button class="button" onclick="checkHardwareMatching()">Check Matches</button>
                <button class="button secondary" onclick="resetHardwareMatching()">Reset</button>
                <div id="hardwareFeedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Hardware Management Concepts</h3>
                <p>Answer these questions about how the OS manages hardware:</p>
                
                <div style="margin: 20px 0;">
                    <p><strong>What is a device driver?</strong></p>
                    <textarea id="driverAnswer" rows="3" placeholder="Explain in your own words..."></textarea>
                    <button class="button" onclick="checkDriverAnswer()">Submit</button>
                    <div id="driverFeedback" style="margin-top: 10px;"></div>
                </div>
                
                <div style="margin: 20px 0;">
                    <p><strong>Why does the OS need to manage I/O operations?</strong></p>
                    <div>
                        <label class="quiz-option" onclick="selectQuizOption(this, 'io1')">
                            <input type="radio" name="ioQ" value="a" style="display: none;">
                            To prevent conflicts when multiple programs access the same device
                        </label>
                        <label class="quiz-option" onclick="selectQuizOption(this, 'io1')">
                            <input type="radio" name="ioQ" value="b" style="display: none;">
                            To make hardware run faster than designed
                        </label>
                        <label class="quiz-option" onclick="selectQuizOption(this, 'io1')">
                            <input type="radio" name="ioQ" value="c" style="display: none;">
                            To prevent users from accessing hardware
                        </label>
                        <label class="quiz-option" onclick="selectQuizOption(this, 'io1')">
                            <input type="radio" name="ioQ" value="d" style="display: none;">
                            To increase electricity consumption
                        </label>
                    </div>
                    <button class="button" onclick="checkIOQuestion()">Check Answer</button>
                    <div id="ioFeedback" style="margin-top: 10px;"></div>
                </div>
            </div>
            
            <div class="nav-controls">
                <button class="button secondary" onclick="previousSection()">← Previous</button>
                <button class="button" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Section 7: Process Management -->
        <div class="section" id="section7">
            <h2>⚙️ Process Management</h2>
            
            <div class="task-card">
                <h3>Process Scheduling Simulator</h3>
                <p>Watch how the OS schedules processes using a Round-Robin algorithm. Each process gets a time slice.</p>
                
                <div class="simulation-container">
                    <div id="processSimulation">
                        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                            <button class="button" onclick="startProcessSimulation()">Start Scheduler</button>
                            <button class="button secondary" onclick="pauseProcessSimulation()">Pause</button>
                            <button class="button secondary" onclick="resetProcessSimulation()">Reset</button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                            <div class="process-box" id="process1">
                                <h4>Process A</h4>
                                <p>Status: <span id="status1">Ready</span></p>
                                <p>Progress: <span id="progress1">0</span>%</p>
                            </div>
                            <div class="process-box" id="process2">
                                <h4>Process B</h4>
                                <p>Status: <span id="status2">Ready</span></p>
                                <p>Progress: <span id="progress2">0</span>%</p>
                            </div>
                            <div class="process-box" id="process3">
                                <h4>Process C</h4>
                                <p>Status: <span id="status3">Ready</span></p>
                                <p>Progress: <span id="progress3">0</span>%</p>
                            </div>
                            <div class="process-box" id="process4">
                                <h4>Process D</h4>
                                <p>Status: <span id="status4">Ready</span></p>
                                <p>Progress: <span id="progress4">0</span>%</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <p>Current Time Slice: Process <span id="currentProcess">-</span></p>
                            <p>CPU Usage: <span id="cpuUsage">0</span>%</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-card">
                <h3>Process States</h3>
                <p>Arrange these process states in the correct order of the process lifecycle:</p>
                
                <div id="processStates" style="display: flex; gap: 10px; margin: 20px 0;">
                    <div class="drag-item" data-order="2" onclick="selectState(this)">Ready</div>
                    <div class="drag-item" data-order="4" onclick="selectState(this)">Terminated</div>
                    <div class="drag-item" data-order="1" onclick="selectState(this)">New</div>
                    <div class="drag-item" data-order="3" onclick="selectState(this)">Running</div>
                </div>
                
                <div style="display: flex; gap: 10px; margin: 20px 0;">
                    <div class="drop-zone" style="flex: 1;">1st: <span id="state1"></span></div>
                    <div class="drop-zone" style="flex: 1;">2nd: <span id="state2"></span></div>
                    <div class="drop-zone" style="flex: 1;">3rd: <span id="state3"></span></div>
                    <div class="drop-zone" style="flex: 1;">4th: <span id="state4"></span></div>
                </div>
                
                <button class="button" onclick="checkProcessStates()">Check Order</button>
                <button class="button secondary" onclick="resetProcessStates()">Reset</button>
                <div id="statesFeedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Multitasking Quiz</h3>
                <p><strong>Which statement best describes preemptive multitasking?</strong></p>
                <div>
                    <label class="quiz-option" onclick="selectQuizOption(this, 'multi1')">
                        <input type="radio" name="multiQ" value="a" style="display: none;">
                        Programs voluntarily give up CPU time
                    </label>
                    <label class="quiz-option" onclick="selectQuizOption(this, 'multi1')">
                        <input type="radio" name="multiQ" value="b" style="display: none;">
                        The OS forcibly switches between processes at regular intervals
                    </label>
                    <label class="quiz-option" onclick="selectQuizOption(this, 'multi1')">
                        <input type="radio" name="multiQ" value="c" style="display: none;">
                        Only one program can run at a time
                    </label>
                    <label class="quiz-option" onclick="selectQuizOption(this, 'multi1')">
                        <input type="radio" name="multiQ" value="d" style="display: none;">
                        Users manually switch between programs
                    </label>
                </div>
                <button class="button" onclick="checkMultitaskingQuiz()">Check Answer</button>
                <div id="multitaskingFeedback" style="margin-top: 20px;"></div>
            </div>
            
            <div class="nav-controls">
                <button class="button secondary" onclick="previousSection()">← Previous</button>
                <button class="button" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Section 8: Real World Context -->
        <div class="section" id="section8">
            <h2>🌍 Real World Context & Common Mistakes</h2>
            
            <div class="task-card">
                <h3>Real-World OS Examples</h3>
                <p>Match these real-world scenarios with the OS management task being performed:</p>
                
                <div style="margin: 20px 0;">
                    <div style="background: var(--light-bg); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <p><strong>Scenario:</strong> Your smartphone automatically closes apps you haven't used recently when running low on RAM</p>
                        <select id="real1">
                            <option value="">Select management task...</option>
                            <option value="memory">Memory Management</option>
                            <option value="file">File Management</option>
                            <option value="security">Security Management</option>
                            <option value="hardware">Hardware Management</option>
                            <option value="process">Process Management</option>
                        </select>
                    </div>
                    
                    <div style="background: var(--light-bg); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <p><strong>Scenario:</strong> Windows Defender automatically scans downloaded files before allowing you to open them</p>
                        <select id="real2">
                            <option value="">Select management task...</option>
                            <option value="memory">Memory Management</option>
                            <option value="file">File Management</option>
                            <option value="security">Security Management</option>
                            <option value="hardware">Hardware Management</option>
                            <option value="process">Process Management</option>
                        </select>
                    </div>
                    
                    <div style="background: var(--light-bg); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <p><strong>Scenario:</strong> macOS automatically installs drivers when you connect a new printer</p>
                        <select id="real3">
                            <option value="">Select management task...</option>
                            <option value="memory">Memory Management</option>
                            <option value="file">File Management</option>
                            <option value="security">Security Management</option>
                            <option value="hardware">Hardware Management</option>
                            <option value="process">Process Management</option>
                        </select>
                    </div>
                </div>
                <button class="button" onclick="checkRealWorld()">Check Answers</button>
                <div id="realWorldFeedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Common Misconceptions</h3>
                <p>Identify whether these statements are TRUE or FALSE:</p>
                
                <div style="margin: 20px 0;">
                    <div style="margin-bottom: 15px;">
                        <p>1. "The OS only runs when you start a program"</p>
                        <label class="quiz-option" onclick="selectTF(this, 'mis1', true)">
                            <input type="radio" name="misTF1" value="true" style="display: none;"> True
                        </label>
                        <label class="quiz-option" onclick="selectTF(this, 'mis1', false)">
                            <input type="radio" name="misTF1" value="false" style="display: none;"> False
                        </label>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <p>2. "Virtual memory is just as fast as physical RAM"</p>
                        <label class="quiz-option" onclick="selectTF(this, 'mis2', true)">
                            <input type="radio" name="misTF2" value="true" style="display: none;"> True
                        </label>
                        <label class="quiz-option" onclick="selectTF(this, 'mis2', false)">
                            <input type="radio" name="misTF2" value="false" style="display: none;"> False
                        </label>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <p>3. "Device drivers are part of the hardware, not software"</p>
                        <label class="quiz-option" onclick="selectTF(this, 'mis3', true)">
                            <input type="radio" name="misTF3" value="true" style="display: none;"> True
                        </label>
                        <label class="quiz-option" onclick="selectTF(this, 'mis3', false)">
                            <input type="radio" name="misTF3" value="false" style="display: none;"> False
                        </label>
                    </div>
                </div>
                <button class="button" onclick="checkMisconceptions()">Check Answers</button>
                <div id="misconceptionsFeedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Extension: Modern OS Features</h3>
                <p>Research and explain one modern OS feature not covered in this lesson (e.g., containerization, sandboxing, machine learning integration):</p>
                <textarea id="extensionAnswer" rows="4" placeholder="Describe a modern OS feature..."></textarea>
                <button class="button" onclick="submitExtension()">Submit Extension</button>
                <div id="extensionFeedback" style="margin-top: 20px;"></div>
            </div>
            
            <div class="nav-controls">
                <button class="button secondary" onclick="previousSection()">← Previous</button>
                <button class="button" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Section 9: Exam Practice -->
        <div class="section" id="section9">
            <h2>📝 Practice Exam Questions</h2>
            
            <div class="task-card">
                <h3>Question 1 (4 marks)</h3>
                <p>Explain two reasons why a computer system requires an Operating System.</p>
                <textarea id="exam1" rows="6" placeholder="Write your answer here..."></textarea>
                <div style="margin-top: 10px;">
                    <label>Predicted marks: <input type="number" id="marks1" min="0" max="4" style="width: 60px;"></label>
                    <button class="button" onclick="checkExam1()">Show Mark Scheme</button>
                </div>
                <div id="exam1Feedback" style="margin-top: 20px; display: none;"></div>
            </div>

            <div class="task-card">
                <h3>Question 2 (6 marks)</h3>
                <p>Describe three different management tasks carried out by an Operating System.</p>
                <textarea id="exam2" rows="8" placeholder="Write your answer here..."></textarea>
                <div style="margin-top: 10px;">
                    <label>Predicted marks: <input type="number" id="marks2" min="0" max="6" style="width: 60px;"></label>
                    <button class="button" onclick="checkExam2()">Show Mark Scheme</button>
                </div>
                <div id="exam2Feedback" style="margin-top: 20px; display: none;"></div>
            </div>

            <div class="task-card">
                <h3>Question 3 (3 marks)</h3>
                <p>What is virtual memory and why is it needed?</p>
                <div class="canvas-container">
                    <canvas id="drawingCanvas" width="600" height="200"></canvas>
                    <button class="button secondary" onclick="clearCanvas()">Clear Canvas</button>
                </div>
                <textarea id="exam3" rows="4" placeholder="Write your answer here..."></textarea>
                <div style="margin-top: 10px;">
                    <label>Predicted marks: <input type="number" id="marks3" min="0" max="3" style="width: 60px;"></label>
                    <button class="button" onclick="checkExam3()">Show Mark Scheme</button>
                </div>
                <div id="exam3Feedback" style="margin-top: 20px; display: none;"></div>
            </div>
            
            <div class="nav-controls">
                <button class="button secondary" onclick="previousSection()">← Previous</button>
                <button class="button" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Section 10: Summary -->
        <div class="section" id="section10">
            <h2>📊 Lesson Summary</h2>
            
            <div class="task-card">
                <h3>Key Takeaways</h3>
                <ul style="line-height: 2;">
                    <li>An Operating System is essential for managing computer resources and providing an interface between hardware and software</li>
                    <li>The OS performs five key management tasks: Memory, File, Security, Hardware, and Process Management</li>
                    <li>Memory management includes allocation, deallocation, and virtual memory through paging</li>
                    <li>File management organizes data storage and controls access permissions</li>
                    <li>Security management protects system resources through authentication and access control</li>
                    <li>Hardware management uses device drivers to communicate with physical components</li>
                    <li>Process management enables multitasking through scheduling algorithms</li>
                </ul>
            </div>

            <div class="task-card">
                <h3>Final Assessment</h3>
                <p>Test your understanding with these summary questions:</p>
                
                <div id="summaryQuiz">
                    <!-- Questions will be dynamically loaded here -->
                </div>
                
                <button class="button" onclick="checkSummaryQuiz()">Submit Assessment</button>
                <button class="button secondary" onclick="resetSummaryQuiz()">Reset</button>
                <div id="summaryFeedback" style="margin-top: 20px;"></div>
            </div>

            <div class="task-card">
                <h3>Your Progress</h3>
                <div style="text-align: center; padding: 20px;">
                    <h4>Final Level: <span id="finalLevel">0</span>/5</h4>
                    <h4>Total XP Earned: <span id="finalXP">0</span></h4>
                    <h4>Achievements Unlocked: <span id="finalAchievements">0</span></h4>
                    <div id="achievementsList" style="margin-top: 20px;"></div>
                </div>
            </div>

            <div class="task-card">
                <h3>📹 Additional Resources</h3>
                <p>Watch these videos to reinforce your learning:</p>
                <div style="background: var(--light-bg); padding: 20px; border-radius: 8px; text-align: center;">
                    <p style="color: var(--text-light);">Video content placeholder - Your teacher will provide links to relevant videos</p>
                </div>
            </div>
            
            <div class="nav-controls">
                <button class="button secondary" onclick="previousSection()">← Previous</button>
                <button class="button secondary" disabled>Next Lesson Coming Soon</button>
            </div>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievementPopup">
        <h3>🏆 Achievement Unlocked!</h3>
        <p id="achievementText"></p>
    </div>

    <!-- Feedback Modal -->
    <div class="feedback-modal" id="feedbackModal">
        <div class="feedback-content">
            <h3>Send Feedback</h3>
            <p>Found a bug or have a suggestion? Let us know!</p>
            <textarea id="feedbackText" rows="4" placeholder="Describe the issue or suggestion..."></textarea>
            <div style="margin-top: 20px;">
                <button class="button" onclick="sendFeedback()">Send</button>
                <button class="button secondary" onclick="closeFeedback()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Feedback Button -->
    <button class="feedback-button" onclick="openFeedback()" aria-label="Send Feedback">💬</button>

    <!-- Shame Message -->
    <div class="shame-message" id="shameMessage">
        🚫 Pasting is disabled! Type your own answers to learn properly! 🚫
    </div>

    <script>
        // Global variables
        let currentSection = 0;
        let xp = 0;
        let level = 0;
        let achievements = [];
        let completedTasks = new Set();
        let processInterval = null;
        let selectedWord = null;
        let selectedMatch = null;
        let selectedFile = null;
        let selectedHardware = null;
        let selectedState = null;
        let currentStateOrder = [];

        // XP thresholds for levels
        const levelThresholds = [0, 100, 250, 450, 700, 1000];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeSummaryQuiz();
            initializeCanvas();
            preventPasting();
        });

        // Navigation functions
        function showSection(index) {
            const sections = document.querySelectorAll('.section');
            const navBtns = document.querySelectorAll('.nav-btn');
            
            sections.forEach(s => s.classList.remove('active'));
            navBtns.forEach(b => b.classList.remove('active'));
            
            sections[index].classList.add('active');
            navBtns[index].classList.add('active');
            currentSection = index;
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function nextSection() {
            if (currentSection < 10) {
                showSection(currentSection + 1);
            }
        }

        function previousSection() {
            if (currentSection > 0) {
                showSection(currentSection - 1);
            }
        }

        // XP and Achievement System
        function addXP(amount, taskId) {
            if (completedTasks.has(taskId)) return;
            
            completedTasks.add(taskId);
            xp += amount;
            document.getElementById('xp').textContent = xp;
            
            updateLevel();
            updateXPBar();
            
            // Create particle effect
            createParticle(amount);
        }

        function updateLevel() {
            const oldLevel = level;
            for (let i = levelThresholds.length - 1; i >= 0; i--) {
                if (xp >= levelThresholds[i]) {
                    level = i;
                    break;
                }
            }
            
            if (level > oldLevel) {
                document.getElementById('level').textContent = level;
                unlockAchievement('Level Up!', `Reached Level ${level}`);
            }
        }

        function updateXPBar() {
            const currentThreshold = levelThresholds[level];
            const nextThreshold = levelThresholds[level + 1] || levelThresholds[levelThresholds.length - 1];
            const progress = ((xp - currentThreshold) / (nextThreshold - currentThreshold)) * 100;
            document.getElementById('xpFill').style.width = progress + '%';
        }

        function unlockAchievement(title, description) {
            if (achievements.find(a => a.title === title)) return;
            
            achievements.push({ title, description });
            document.getElementById('achievements').textContent = achievements.length;
            
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementText').textContent = description;
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }

        function createParticle(xpAmount) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = `+${xpAmount} XP`;
            particle.style.left = Math.random() * window.innerWidth + 'px';
            particle.style.top = Math.random() * window.innerHeight + 'px';
            particle.style.color = '#10b981';
            particle.style.fontSize = '20px';
            particle.style.fontWeight = 'bold';
            document.body.appendChild(particle);
            
            setTimeout(() => particle.remove(), 2000);
        }

        // Starter Activity Functions
        const starterItems = [
            { name: 'Windows 11', type: 'os' },
            { name: 'Microsoft Word', type: 'not' },
            { name: 'Linux Ubuntu', type: 'os' },
            { name: 'Google Chrome', type: 'not' },
            { name: 'macOS', type: 'os' },
            { name: 'Photoshop', type: 'not' },
            { name: 'Android', type: 'os' },
            { name: 'Spotify', type: 'not' }
        ];

        function initializeStarter() {
            const container = document.getElementById('starterItems');
            container.innerHTML = '';
            
            starterItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'drag-item';
                div.textContent = item.name;
                div.onclick = function() { selectStarterItem(this, item.type); };
                container.appendChild(div);
            });
        }

        let selectedStarterItem = null;
        let selectedStarterType = null;

        function selectStarterItem(element, type) {
            if (selectedStarterItem) {
                selectedStarterItem.classList.remove('selected');
            }
            selectedStarterItem = element;
            selectedStarterType = type;
            element.classList.add('selected');
            
            // Add to appropriate zone
            const zone = type === 'os' ? 'osItems' : 'notOsItems';
            document.getElementById(zone).appendChild(element);
        }

        function checkStarter() {
            const osItems = document.getElementById('osItems').children;
            const notOsItems = document.getElementById('notOsItems').children;
            
            let correct = 0;
            const total = starterItems.length;
            
            // Check OS items
            for (let item of osItems) {
                const itemData = starterItems.find(i => i.name === item.textContent);
                if (itemData && itemData.type === 'os') {
                    correct++;
                    item.style.color = '#10b981';
                } else {
                    item.style.color = '#ef4444';
                }
            }
            
            // Check not OS items
            for (let item of notOsItems) {
                const itemData = starterItems.find(i => i.name === item.textContent);
                if (itemData && itemData.type === 'not') {
                    correct++;
                    item.style.color = '#10b981';
                } else {
                    item.style.color = '#ef4444';
                }
            }
            
            const feedback = document.getElementById('starterFeedback');
            feedback.innerHTML = `<p style="color: ${correct === total ? '#10b981' : '#f59e0b'}">
                You got ${correct}/${total} correct! 
                ${correct === total ? 'Perfect! Operating Systems are software that manage computer resources.' : 'Remember: OS manages hardware, while applications run on top of the OS.'}
            </p>`;
            
            if (correct === total) {
                addXP(50, 'starter-perfect');
                if (achievements.length === 0) {
                    unlockAchievement('Quick Starter', 'Completed the starter activity perfectly!');
                }
            } else if (correct >= total * 0.7) {
                addXP(30, 'starter-good');
            }
        }

        function resetStarter() {
            initializeStarter();
            document.getElementById('osItems').innerHTML = '';
            document.getElementById('notOsItems').innerHTML = '';
            document.getElementById('starterFeedback').innerHTML = '';
        }

        function showHint(section) {
            const hintBox = document.getElementById(section + 'Hint');
            if (hintBox) {
                hintBox.style.display = 'block';
                addXP(-5, section + '-hint-penalty');
            }
        }

        // No OS Simulation
        function tryNoOs(action) {
            const output = document.getElementById('noOsOutput');
            let message = '';
            
            switch(action) {
                case 'app':
                    message = '❌ ERROR: No OS to load and execute applications! The CPU doesn\'t know how to interpret the program instructions without an OS to manage execution.';
                    break;
                case 'file':
                    message = '❌ ERROR: No file system exists! Without an OS, there\'s no way to organize, store, or retrieve data on the storage device.';
                    break;
                case 'print':
                    message = '❌ ERROR: No printer driver or print spooler! The computer cannot communicate with the printer without OS hardware management.';
                    break;
                case 'network':
                    message = '❌ ERROR: No network stack or protocols! Internet connectivity requires OS network management and TCP/IP implementation.';
                    break;
            }
            
            output.innerHTML = `<p style="color: #ef4444;">${message}</p>
                <p style="margin-top: 10px;">This shows why we need an OS - to provide the essential services that allow hardware and software to work together!</p>`;
            
            addXP(10, 'no-os-' + action);
        }

        function resetNoOsSimulation() {
            document.getElementById('noOsOutput').innerHTML = '<p>Click a button to see what happens...</p>';
        }

        // Fill in the blanks
        function selectWord(element, word) {
            if (selectedWord) {
                selectedWord.classList.remove('selected');
            }
            selectedWord = element;
            element.classList.add('selected');
        }

        function checkBlanks() {
            const answers = {
                blank1: 'interface',
                blank2: 'hardware',
                blank3: 'resources',
                blank4: 'applications'
            };
            
            let correct = 0;
            for (let i = 1; i <= 4; i++) {
                const input = document.getElementById('blank' + i);
                const answer = input.value.toLowerCase().trim();
                
                if (answer === answers['blank' + i]) {
                    correct++;
                    input.style.borderColor = '#10b981';
                } else {
                    input.style.borderColor = '#ef4444';
                }
            }
            
            const feedback = document.getElementById('blanksFeedback');
            feedback.innerHTML = `<p style="color: ${correct === 4 ? '#10b981' : '#f59e0b'}">
                ${correct}/4 correct! ${correct === 4 ? 'Excellent understanding!' : 'Review the role of an OS in managing computer systems.'}
            </p>`;
            
            if (correct === 4) {
                addXP(40, 'blanks-perfect');
            } else if (correct >= 3) {
                addXP(25, 'blanks-good');
            }
        }

        function resetBlanks() {
            for (let i = 1; i <= 4; i++) {
                const input = document.getElementById('blank' + i);
                input.value = '';
                input.style.borderColor = '#e5e7eb';
            }
            document.getElementById('blanksFeedback').innerHTML = '';
        }

        // OS Reason Check
        function checkOsReason() {
            const answer = document.getElementById('osReason').value.trim();
            const wordCount = answer.split(/\s+/).filter(word => word.length > 0).length;
            
            if (wordCount < 50) {
                document.getElementById('osReasonFeedback').innerHTML = 
                    '<p style="color: #f59e0b;">Please write at least 50 words to submit your answer.</p>';
                return;
            }
            
            const keywords = ['interface', 'hardware', 'software', 'manage', 'resources', 'memory', 'file', 'process', 'security', 'user'];
            let keywordsFound = 0;
            
            keywords.forEach(keyword => {
                if (answer.toLowerCase().includes(keyword)) {
                    keywordsFound++;
                }
            });
            
            const feedback = document.getElementById('osReasonFeedback');
            let xpAwarded = Math.min(keywordsFound * 10, 60);
            
            feedback.innerHTML = `<p style="color: #10b981">Good answer! You included ${keywordsFound} key concepts. 
                Remember: The OS acts as an intermediary between hardware and software, managing resources, 
                providing security, and enabling multiple programs to run efficiently.</p>`;
            
            addXP(xpAwarded, 'os-reason');
            
            if (keywordsFound >= 5) {
                unlockAchievement('OS Expert', 'Demonstrated excellent understanding of OS fundamentals!');
            }
        }

        // Memory Management Functions
        const programs = [
            { name: 'Web Browser', size: 512, color: '#3b82f6' },
            { name: 'Game', size: 2048, color: '#8b5cf6' },
            { name: 'Video Editor', size: 1024, color: '#ef4444' },
            { name: 'Music Player', size: 256, color: '#10b981' },
            { name: 'Office Suite', size: 768, color: '#f59e0b' }
        ];

        let memoryUsed = 0;
        let runningPrograms = [];

        function addProgram() {
            if (runningPrograms.length >= programs.length) {
                addToMemoryLog('All programs are already running!');
                return;
            }
            
            const availablePrograms = programs.filter(p => !runningPrograms.find(r => r.name === p.name));
            const program = availablePrograms[Math.floor(Math.random() * availablePrograms.length)];
            
            if (memoryUsed + program.size > 8192) {
                addToMemoryLog(`Cannot allocate ${program.size}MB for ${program.name} - insufficient memory!`);
                // Trigger virtual memory
                addToMemoryLog('OS is using virtual memory (swap file) to handle this request...');
                setTimeout(() => {
                    addToMemoryLog('Warning: Performance may be reduced due to paging!');
                }, 1000);
                return;
            }
            
            runningPrograms.push(program);
            memoryUsed += program.size;
            updateMemoryDisplay();
            addToMemoryLog(`Allocated ${program.size}MB for ${program.name}`);
            
            addXP(15, 'memory-add-' + runningPrograms.length);
        }

        function removeProgram() {
            if (runningPrograms.length === 0) {
                addToMemoryLog('No programs to remove!');
                return;
            }
            
            const program = runningPrograms.pop();
            memoryUsed -= program.size;
            updateMemoryDisplay();
            addToMemoryLog(`Freed ${program.size}MB from ${program.name}`);
            
            addXP(10, 'memory-remove-' + runningPrograms.length);
        }

        function updateMemoryDisplay() {
            const display = document.getElementById('memoryDisplay');
            display.innerHTML = '';
            
            let currentY = 0;
            runningPrograms.forEach(program => {
                const height = (program.size / 8192) * 380;
                const block = document.createElement('div');
                block.style.cssText = `
                    position: absolute;
                    left: 10px;
                    right: 10px;
                    top: ${currentY}px;
                    height: ${height}px;
                    background: ${program.color};
                    border-radius: 4px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: bold;
                `;
                block.textContent = `${program.name} (${program.size}MB)`;
                display.appendChild(block);
                currentY += height + 5;
            });
            
            document.getElementById('programCount').textContent = runningPrograms.length;
            document.getElementById('memoryUsed').textContent = memoryUsed;
            document.getElementById('memoryFree').textContent = 8192 - memoryUsed;
        }

        function addToMemoryLog(message) {
            const log = document.getElementById('memoryLog');
            const entry = document.createElement('p');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            entry.style.color = '#e5e7eb';
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function resetMemory() {
            runningPrograms = [];
            memoryUsed = 0;
            updateMemoryDisplay();
            document.getElementById('memoryLog').innerHTML = '<p style="color: #9ca3af;">Memory allocation log...</p>';
        }

        // Memory Quiz
        function selectQuizOption(element, quizId) {
            const options = element.parentElement.querySelectorAll('.quiz-option');
            options.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
        }

        function checkMemoryQuiz() {
            const selected = document.querySelector('input[name="memQ1"]:checked');
            const feedback = document.getElementById('memoryQuizFeedback');
            
            if (!selected) {
                feedback.innerHTML = '<p style="color: #f59e0b;">Please select an answer.</p>';
                return;
            }
            
            if (selected.value === 'b') {
                feedback.innerHTML = '<p style="color: #10b981;">Correct! The OS uses virtual memory (paging) to extend available memory by using disk space.</p>';
                addXP(30, 'memory-quiz');
                selected.parentElement.classList.add('correct');
            } else {
                feedback.innerHTML = '<p style="color: #ef4444;">Incorrect. The OS uses virtual memory to handle memory shortage situations.</p>';
                selected.parentElement.classList.add('incorrect');
            }
        }

        // Matching Functions
        function selectMatch(element, type) {
            if (selectedMatch) {
                selectedMatch.classList.remove('selected');
            }
            selectedMatch = element;
            selectedMatch.dataset.type = type;
            element.classList.add('selected');
        }

        function checkMatching(section) {
            const zones = document.querySelectorAll('.drop-zone[data-match]');
            let correct = 0;
            
            zones.forEach(zone => {
                const expected = zone.dataset.match;
                const item = zone.querySelector('.drag-item');
                
                if (item && item.dataset.type === expected) {
                    correct++;
                    zone.classList.add('correct');
                } else if (item) {
                    zone.classList.add('incorrect');
                }
            });
            
            const feedback = document.getElementById('matchingFeedback');
            feedback.innerHTML = `<p style="color: ${correct === 4 ? '#10b981' : '#f59e0b'}">
                ${correct}/4 matches correct! ${correct === 4 ? 'Excellent understanding of virtual memory!' : 'Review virtual memory concepts.'}
            </p>`;
            
            if (correct === 4) {
                addXP(40, section + '-matching');
            }
        }

        function resetMatching(section) {
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('correct', 'incorrect');
            });
            document.getElementById('matchingFeedback').innerHTML = '';
        }

        // File Management Functions
        function selectFile(element, folder) {
            if (selectedFile) {
                selectedFile.classList.remove('selected');
            }
            selectedFile = element;
            selectedFile.dataset.folder = folder;
            element.classList.add('selected');
            
            // Move to folder
            document.getElementById(folder + 'Files').appendChild(element);
        }

        function checkFileOrganization() {
            const folders = ['system', 'program', 'user'];
            let correct = 0;
            let total = 0;
            
            folders.forEach(folder => {
                const files = document.getElementById(folder + 'Files').children;
                for (let file of files) {
                    total++;
                    if (file.dataset.folder === folder) {
                        correct++;
                        file.style.color = '#10b981';
                    } else {
                        file.style.color = '#ef4444';
                    }
                }
            });
            
            const feedback = document.getElementById('fileOrgFeedback');
            feedback.innerHTML = `<p style="color: ${correct === total ? '#10b981' : '#f59e0b'}">
                ${correct}/${total} files organized correctly! 
                ${correct === total ? 'Perfect file organization!' : 'Remember: System files belong in /System, programs in /Program Files, and user files in /Users.'}
            </p>`;
            
            if (correct === total) {
                addXP(50, 'file-organization');
            }
        }

        function resetFileOrganization() {
            const container = document.getElementById('filesToOrganize');
            const files = document.querySelectorAll('.drag-item[data-folder]');
            files.forEach(file => {
                file.style.color = '';
                container.appendChild(file);
            });
            document.getElementById('fileOrgFeedback').innerHTML = '';
        }

        // File Permissions
        function checkPermissions() {
            const correct = {
                perm1: 'view',
                perm2: 'modify',
                perm3: 'run'
            };
            
            let score = 0;
            for (let i = 1; i <= 3; i++) {
                const select = document.getElementById('perm' + i);
                if (select.value === correct['perm' + i]) {
                    score++;
                    select.style.borderColor = '#10b981';
                } else {
                    select.style.borderColor = '#ef4444';
                }
            }
            
            const feedback = document.getElementById('permissionsFeedback');
            feedback.innerHTML = `<p style="color: ${score === 3 ? '#10b981' : '#f59e0b'}">
                ${score}/3 correct! ${score === 3 ? 'You understand file permissions!' : 'Review: R=Read/View, W=Write/Modify, X=Execute/Run'}
            </p>`;
            
            if (score === 3) {
                addXP(30, 'permissions');
            }
        }

        // Security Functions
        function checkSecurityScenarios() {
            const correct = {
                security1: 'permissions',
                security2: 'auth',
                security3: 'uac'
            };
            
            let score = 0;
            for (let i = 1; i <= 3; i++) {
                const select = document.getElementById('security' + i);
                if (select.value === correct['security' + i]) {
                    score++;
                    select.style.borderColor = '#10b981';
                } else {
                    select.style.borderColor = '#ef4444';
                }
            }
            
            const feedback = document.getElementById('securityFeedback');
            feedback.innerHTML = `<p style="color: ${score === 3 ? '#10b981' : '#f59e0b'}">
                ${score}/3 scenarios identified correctly! 
                ${score === 3 ? 'Excellent understanding of OS security features!' : 'Review how the OS protects system resources.'}
            </p>`;
            
            if (score === 3) {
                addXP(40, 'security-scenarios');
            }
        }

        function selectTF(element, question, value) {
            const options = element.parentElement.querySelectorAll('.quiz-option');
            options.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            element.dataset.answer = value;
        }

        function checkSecurityTF() {
            const correct = {
                sec1: true,
                sec2: false,
                sec3: true
            };
            
            let score = 0;
            let total = 3;
            
            for (let i = 1; i <= 3; i++) {
                const selected = document.querySelector(`input[name="secTF${i}"]:checked`);
                if (selected) {
                    const answer = selected.value === 'true';
                    if (answer === correct['sec' + i]) {
                        score++;
                        selected.parentElement.classList.add('correct');
                    } else {
                        selected.parentElement.classList.add('incorrect');
                    }
                }
            }
            
            const feedback = document.getElementById('securityTFFeedback');
            feedback.innerHTML = `<p style="color: ${score === total ? '#10b981' : '#f59e0b'}">
                ${score}/${total} correct! ${score === total ? 'Perfect understanding!' : 'Remember: The OS manages security centrally, not individual applications.'}
            </p>`;
            
            if (score === total) {
                addXP(30, 'security-tf');
            }
        }

        // Hardware Management Functions
        function selectHardware(element, type) {
            if (selectedHardware) {
                selectedHardware.classList.remove('selected');
            }
            selectedHardware = element;
            selectedHardware.dataset.type = type;
            element.classList.add('selected');
        }

        function checkHardwareMatching() {
            const zones = document.querySelectorAll('.drop-zone[data-hardware]');
            let correct = 0;
            
            zones.forEach(zone => {
                const expected = zone.dataset.hardware;
                const items = zone.querySelectorAll('.drag-item');
                
                items.forEach(item => {
                    if (item.dataset.type === expected) {
                        correct++;
                        zone.classList.add('correct');
                    } else {
                        zone.classList.add('incorrect');
                    }
                });
            });
            
            const feedback = document.getElementById('hardwareFeedback');
            const total = 6;
            feedback.innerHTML = `<p style="color: ${correct === total ? '#10b981' : '#f59e0b'}">
                ${correct}/${total} devices matched correctly! 
                ${correct === total ? 'Excellent hardware knowledge!' : 'Review how different hardware components serve different functions.'}
            </p>`;
            
            if (correct === total) {
                addXP(40, 'hardware-matching');
            }
        }

        function resetHardwareMatching() {
            document.querySelectorAll('.drop-zone[data-hardware]').forEach(zone => {
                zone.classList.remove('correct', 'incorrect');
            });
            document.getElementById('hardwareFeedback').innerHTML = '';
        }

        function checkDriverAnswer() {
            const answer = document.getElementById('driverAnswer').value.trim();
            const wordCount = answer.split(/\s+/).filter(word => word.length > 0).length;
            
            if (wordCount < 20) {
                document.getElementById('driverFeedback').innerHTML = 
                    '<p style="color: #f59e0b;">Please provide a more detailed answer.</p>';
                return;
            }
            
            const keywords = ['software', 'hardware', 'communicate', 'interface', 'device', 'operating system'];
            let keywordsFound = 0;
            
            keywords.forEach(keyword => {
                if (answer.toLowerCase().includes(keyword)) {
                    keywordsFound++;
                }
            });
            
            const feedback = document.getElementById('driverFeedback');
            feedback.innerHTML = `<p style="color: #10b981">Good explanation! A device driver is software that allows the OS to communicate with hardware devices.</p>`;
            
            addXP(keywordsFound * 5, 'driver-explanation');
        }

        function checkIOQuestion() {
            const selected = document.querySelector('input[name="ioQ"]:checked');
            const feedback = document.getElementById('ioFeedback');
            
            if (!selected) {
                feedback.innerHTML = '<p style="color: #f59e0b;">Please select an answer.</p>';
                return;
            }
            
            if (selected.value === 'a') {
                feedback.innerHTML = '<p style="color: #10b981;">Correct! The OS manages I/O to prevent conflicts and ensure orderly access to devices.</p>';
                addXP(25, 'io-question');
                selected.parentElement.classList.add('correct');
            } else {
                feedback.innerHTML = '<p style="color: #ef4444;">Incorrect. The OS manages I/O to coordinate access and prevent conflicts.</p>';
                selected.parentElement.classList.add('incorrect');
            }
        }

        // Process Management Functions
        let processes = [
            { id: 1, progress: 0, status: 'Ready' },
            { id: 2, progress: 0, status: 'Ready' },
            { id: 3, progress: 0, status: 'Ready' },
            { id: 4, progress: 0, status: 'Ready' }
        ];
        let currentProcess = 0;
        let simulationRunning = false;

        function startProcessSimulation() {
            if (simulationRunning) return;
            
            simulationRunning = true;
            processInterval = setInterval(() => {
                // Update current process
                processes.forEach((p, index) => {
                    const box = document.getElementById('process' + (index + 1));
                    if (index === currentProcess && p.progress < 100) {
                        p.status = 'Running';
                        p.progress += 10;
                        box.classList.add('active');
                    } else if (p.progress >= 100) {
                        p.status = 'Completed';
                        box.classList.remove('active');
                    } else {
                        p.status = 'Ready';
                        box.classList.remove('active');
                    }
                    
                    document.getElementById('status' + (index + 1)).textContent = p.status;
                    document.getElementById('progress' + (index + 1)).textContent = p.progress;
                });
                
                // Move to next process (Round Robin)
                currentProcess = (currentProcess + 1) % 4;
                
                // Update display
                document.getElementById('currentProcess').textContent = String.fromCharCode(65 + currentProcess);
                
                // Calculate CPU usage
                const activeProcesses = processes.filter(p => p.progress < 100).length;
                document.getElementById('cpuUsage').textContent = activeProcesses > 0 ? '100' : '0';
                
                // Check if all complete
                if (processes.every(p => p.progress >= 100)) {
                    pauseProcessSimulation();
                    addXP(50, 'process-simulation-complete');
                    unlockAchievement('Process Master', 'Completed the process scheduling simulation!');
                }
            }, 1000);
            
            addXP(20, 'process-simulation-start');
        }

        function pauseProcessSimulation() {
            simulationRunning = false;
            if (processInterval) {
                clearInterval(processInterval);
                processInterval = null;
            }
        }

        function resetProcessSimulation() {
            pauseProcessSimulation();
            processes = [
                { id: 1, progress: 0, status: 'Ready' },
                { id: 2, progress: 0, status: 'Ready' },
                { id: 3, progress: 0, status: 'Ready' },
                { id: 4, progress: 0, status: 'Ready' }
            ];
            currentProcess = 0;
            
            for (let i = 1; i <= 4; i++) {
                document.getElementById('status' + i).textContent = 'Ready';
                document.getElementById('progress' + i).textContent = '0';
                document.getElementById('process' + i).classList.remove('active');
            }
            
            document.getElementById('currentProcess').textContent = '-';
            document.getElementById('cpuUsage').textContent = '0';
        }

        // Process States
        function selectState(element) {
            if (selectedState) {
                selectedState.classList.remove('selected');
            }
            selectedState = element;
            element.classList.add('selected');
        }

        function checkProcessStates() {
            const correctOrder = ['New', 'Ready', 'Running', 'Terminated'];
            let correct = 0;
            
            for (let i = 1; i <= 4; i++) {
                const stateElement = document.getElementById('state' + i);
                if (stateElement.textContent === correctOrder[i-1]) {
                    correct++;
                    stateElement.style.color = '#10b981';
                } else {
                    stateElement.style.color = '#ef4444';
                }
            }
            
            const feedback = document.getElementById('statesFeedback');
            feedback.innerHTML = `<p style="color: ${correct === 4 ? '#10b981' : '#f59e0b'}">
                ${correct}/4 states in correct order! 
                ${correct === 4 ? 'Perfect! You understand the process lifecycle!' : 'Remember: New → Ready → Running → Terminated'}
            </p>`;
            
            if (correct === 4) {
                addXP(35, 'process-states');
            }
        }

        function resetProcessStates() {
            for (let i = 1; i <= 4; i++) {
                document.getElementById('state' + i).textContent = '';
                document.getElementById('state' + i).style.color = '';
            }
            currentStateOrder = [];
            document.getElementById('statesFeedback').innerHTML = '';
        }

        function checkMultitaskingQuiz() {
            const selected = document.querySelector('input[name="multiQ"]:checked');
            const feedback = document.getElementById('multitaskingFeedback');
            
            if (!selected) {
                feedback.innerHTML = '<p style="color: #f59e0b;">Please select an answer.</p>';
                return;
            }
            
            if (selected.value === 'b') {
                feedback.innerHTML = '<p style="color: #10b981;">Correct! Preemptive multitasking means the OS controls when to switch between processes.</p>';
                addXP(30, 'multitasking-quiz');
                selected.parentElement.classList.add('correct');
            } else {
                feedback.innerHTML = '<p style="color: #ef4444;">Incorrect. In preemptive multitasking, the OS forcibly switches between processes.</p>';
                selected.parentElement.classList.add('incorrect');
            }
        }

        // Real World Context Functions
        function checkRealWorld() {
            const correct = {
                real1: 'memory',
                real2: 'security',
                real3: 'hardware'
            };
            
            let score = 0;
            for (let i = 1; i <= 3; i++) {
                const select = document.getElementById('real' + i);
                if (select.value === correct['real' + i]) {
                    score++;
                    select.style.borderColor = '#10b981';
                } else {
                    select.style.borderColor = '#ef4444';
                }
            }
            
            const feedback = document.getElementById('realWorldFeedback');
            feedback.innerHTML = `<p style="color: ${score === 3 ? '#10b981' : '#f59e0b'}">
                ${score}/3 scenarios correctly identified! 
                ${score === 3 ? 'Great job connecting OS concepts to real life!' : 'Think about which OS task each scenario represents.'}
            </p>`;
            
            if (score === 3) {
                addXP(40, 'real-world');
            }
        }

        function checkMisconceptions() {
            const correct = {
                mis1: false,
                mis2: false,
                mis3: false
            };
            
            let score = 0;
            for (let i = 1; i <= 3; i++) {
                const selected = document.querySelector(`input[name="misTF${i}"]:checked`);
                if (selected) {
                    const answer = selected.value === 'true';
                    if (answer === correct['mis' + i]) {
                        score++;
                        selected.parentElement.classList.add('correct');
                    } else {
                        selected.parentElement.classList.add('incorrect');
                    }
                }
            }
            
            const feedback = document.getElementById('misconceptionsFeedback');
            const explanations = [
                'The OS runs continuously in the background!',
                'Virtual memory is much slower than RAM as it uses disk storage!',
                'Device drivers are software that enable OS-hardware communication!'
            ];
            
            feedback.innerHTML = `<p style="color: ${score === 3 ? '#10b981' : '#f59e0b'}">
                ${score}/3 correct! ${score < 3 ? 'Remember: ' + explanations.filter((e, i) => !document.querySelector(`input[name="misTF${i+1}"]:checked`) || document.querySelector(`input[name="misTF${i+1}"]:checked`).value !== (correct['mis' + (i+1)] ? 'false' : 'true')).join(' ') : 'Excellent! You avoided common misconceptions!'}
            </p>`;
            
            if (score === 3) {
                addXP(35, 'misconceptions');
                unlockAchievement('Myth Buster', 'Identified all OS misconceptions correctly!');
            }
        }

        function submitExtension() {
            const answer = document.getElementById('extensionAnswer').value.trim();
            const wordCount = answer.split(/\s+/).filter(word => word.length > 0).length;
            
            if (wordCount < 30) {
                document.getElementById('extensionFeedback').innerHTML = 
                    '<p style="color: #f59e0b;">Please provide more detail about the modern OS feature.</p>';
                return;
            }
            
            document.getElementById('extensionFeedback').innerHTML = 
                '<p style="color: #10b981;">Excellent extension work! You\'ve gone beyond the specification to explore modern OS features.</p>';
            
            addXP(80, 'extension-task');
            unlockAchievement('Going Beyond', 'Completed the extension task on modern OS features!');
        }

        // Exam Practice Functions
        function checkExam1() {
            const answer = document.getElementById('exam1').value.trim();
            const marks = parseInt(document.getElementById('marks1').value) || 0;
            
            if (answer.length < 50) {
                alert('Please write a more detailed answer before viewing the mark scheme.');
                return;
            }
            
            const feedback = document.getElementById('exam1Feedback');
            feedback.style.display = 'block';
            feedback.innerHTML = `
                <h4>Mark Scheme (4 marks)</h4>
                <p><strong>Any two reasons from:</strong></p>
                <ul>
                    <li>Provides interface between user and hardware (1 mark)</li>
                    <li>Manages system resources/hardware resources (1 mark)</li>
                    <li>Allows multiple programs to run simultaneously (1 mark)</li>
                    <li>Provides security/access control (1 mark)</li>
                    <li>Manages files and storage (1 mark)</li>
                    <li>Handles errors and system failures (1 mark)</li>
                </ul>
                <p><strong>Your predicted marks:</strong> ${marks}/4</p>
            `;
            
            addXP(marks * 10, 'exam1');
        }

        function checkExam2() {
            const answer = document.getElementById('exam2').value.trim();
            const marks = parseInt(document.getElementById('marks2').value) || 0;
            
            if (answer.length < 100) {
                alert('Please write a more detailed answer before viewing the mark scheme.');
                return;
            }
            
            const feedback = document.getElementById('exam2Feedback');
            feedback.style.display = 'block';
            feedback.innerHTML = `
                <h4>Mark Scheme (6 marks)</h4>
                <p><strong>Three tasks from (1 mark each for naming, 1 mark each for description):</strong></p>
                <ul>
                    <li><strong>Memory Management:</strong> Allocates/deallocates memory to programs, manages virtual memory/paging</li>
                    <li><strong>File Management:</strong> Organizes files in directories, controls access permissions</li>
                    <li><strong>Security Management:</strong> User authentication, access control, protects system resources</li>
                    <li><strong>Hardware Management:</strong> Controls hardware through device drivers, manages I/O operations</li>
                    <li><strong>Process Management:</strong> Schedules processes, enables multitasking, manages CPU time</li>
                </ul>
                <p><strong>Your predicted marks:</strong> ${marks}/6</p>
            `;
            
            addXP(marks * 10, 'exam2');
        }

        function checkExam3() {
            const answer = document.getElementById('exam3').value.trim();
            const marks = parseInt(document.getElementById('marks3').value) || 0;
            
            if (answer.length < 30) {
                alert('Please write a more detailed answer before viewing the mark scheme.');
                return;
            }
            
            const feedback = document.getElementById('exam3Feedback');
            feedback.style.display = 'block';
            feedback.innerHTML = `
                <h4>Mark Scheme (3 marks)</h4>
                <ul>
                    <li>Virtual memory is use of hard disk space as an extension of RAM (1 mark)</li>
                    <li>Allows programs to run when insufficient physical memory available (1 mark)</li>
                    <li>Uses paging/swapping to move data between RAM and disk (1 mark)</li>
                </ul>
                <p><strong>Your predicted marks:</strong> ${marks}/3</p>
            `;
            
            addXP(marks * 10, 'exam3');
        }

        // Summary Quiz
        function initializeSummaryQuiz() {
            const questions = [
                {
                    question: "What is the primary purpose of an Operating System?",
                    options: ["Run games", "Manage computer resources", "Browse the internet", "Create documents"],
                    correct: 1
                },
                {
                    question: "Which is NOT a key management task of an OS?",
                    options: ["Memory Management", "File Management", "Game Management", "Process Management"],
                    correct: 2
                },
                {
                    question: "Virtual memory uses which storage device?",
                    options: ["USB drive", "Hard disk", "CD-ROM", "Network storage"],
                    correct: 1
                },
                {
                    question: "What does preemptive multitasking mean?",
                    options: ["Programs crash frequently", "OS controls process switching", "Users switch programs manually", "Only one program runs"],
                    correct: 1
                },
                {
                    question: "Device drivers are:",
                    options: ["Hardware components", "Software programs", "User applications", "Storage devices"],
                    correct: 1
                },
                {
                    question: "File permissions control:",
                    options: ["Internet speed", "Screen brightness", "Access to files", "Computer temperature"],
                    correct: 2
                }
            ];
            
            const container = document.getElementById('summaryQuiz');
            container.innerHTML = '';
            
            questions.forEach((q, index) => {
                const div = document.createElement('div');
                div.style.marginBottom = '20px';
                div.innerHTML = `
                    <p><strong>${index + 1}. ${q.question}</strong></p>
                    ${q.options.map((opt, i) => `
                        <label class="quiz-option" onclick="selectQuizOption(this, 'summary${index}')">
                            <input type="radio" name="summaryQ${index}" value="${i}" style="display: none;">
                            ${opt}
                        </label>
                    `).join('')}
                `;
                container.appendChild(div);
            });
        }

        function checkSummaryQuiz() {
            const questions = 6;
            let correct = 0;
            
            for (let i = 0; i < questions; i++) {
                const selected = document.querySelector(`input[name="summaryQ${i}"]:checked`);
                if (selected) {
                    const answer = parseInt(selected.value);
                    const correctAnswers = [1, 2, 1, 1, 1, 2];
                    
                    if (answer === correctAnswers[i]) {
                        correct++;
                        selected.parentElement.classList.add('correct');
                    } else {
                        selected.parentElement.classList.add('incorrect');
                    }
                }
            }
            
            const percentage = Math.round((correct / questions) * 100);
            const feedback = document.getElementById('summaryFeedback');
            feedback.innerHTML = `
                <h4>Assessment Results</h4>
                <p>You scored ${correct}/${questions} (${percentage}%)</p>
                <p style="color: ${percentage >= 80 ? '#10b981' : percentage >= 60 ? '#f59e0b' : '#ef4444'}">
                    ${percentage >= 80 ? 'Excellent work! You have mastered OS fundamentals!' : 
                      percentage >= 60 ? 'Good effort! Review the topics you found challenging.' : 
                      'Keep practicing! Review the lesson and try again.'}
                </p>
            `;
            
            addXP(correct * 20, 'summary-quiz');
            
            if (percentage === 100) {
                unlockAchievement('Perfect Score', 'Achieved 100% on the final assessment!');
            }
            
            // Update final stats
            updateFinalStats();
        }

        function resetSummaryQuiz() {
            initializeSummaryQuiz();
            document.getElementById('summaryFeedback').innerHTML = '';
        }

        function updateFinalStats() {
            document.getElementById('finalLevel').textContent = level;
            document.getElementById('finalXP').textContent = xp;
            document.getElementById('finalAchievements').textContent = achievements.length;
            
            const achievementsList = document.getElementById('achievementsList');
            achievementsList.innerHTML = '<h5>Your Achievements:</h5>';
            achievements.forEach(ach => {
                achievementsList.innerHTML += `<p>🏆 ${ach.title}: ${ach.description}</p>`;
            });
        }

        // Canvas Functions
        let canvas, ctx;
        let isDrawing = false;

        function initializeCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas size
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            // Drawing events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#2563eb';
            
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                            e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Accessibility Functions
        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
        }

        function changeFontSize(delta) {
            const root = document.documentElement;
            const currentSize = parseFloat(getComputedStyle(root).fontSize);
            root.style.fontSize = (currentSize + delta) + 'px';
        }

        // Feedback System
        function openFeedback() {
            document.getElementById('feedbackModal').style.display = 'flex';
        }

        function closeFeedback() {
            document.getElementById('feedbackModal').style.display = 'none';
            document.getElementById('feedbackText').value = '';
        }

        function sendFeedback() {
            const feedback = document.getElementById('feedbackText').value.trim();
            if (!feedback) {
                alert('Please enter your feedback before sending.');
                return;
            }
            
            const section = document.querySelector('.section.active h2').textContent;
            const subject = `OS Lesson Feedback - ${section}`;
            const body = `Section: ${section}\n\nFeedback: ${feedback}\n\nPage: Section ${currentSection + 1}`;
            
            // Create mailto link
            const mailtoLink = `mailto:millingtond@mgs.org?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoLink;
            
            closeFeedback();
            addXP(10, 'feedback-sent');
        }

        // Prevent Pasting
        function preventPasting() {
            // Prevent paste events
            document.addEventListener('paste', function(e) {
                e.preventDefault();
                showShameMessage();
                return false;
            });
            
            // Prevent context menu
            document.addEventListener('contextmenu', function(e) {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    e.preventDefault();
                    return false;
                }
            });
            
            // Prevent keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && (e.key === 'v' || e.key === 'V')) {
                    e.preventDefault();
                    showShameMessage();
                    return false;
                }
            });
        }

        function showShameMessage() {
            const shame = document.getElementById('shameMessage');
            shame.style.display = 'block';
            setTimeout(() => {
                shame.style.display = 'none';
            }, 3000);
        }

        // Initialize on load
        window.onload = function() {
            initializeStarter();
            resetMemory();
            resetProcessSimulation();
        };

        // Prevent accidental navigation
        window.addEventListener('beforeunload', function(e) {
            if (xp > 0) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>