<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control and Monitoring Systems | A Level Computer Science</title>
    <style>
        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary-color: #8b5cf6;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header Styles */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 1.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* XP System */
        .xp-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            backdrop-filter: blur(10px);
        }

        .xp-bar {
            width: 150px;
            height: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24, #f59e0b);
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .xp-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .level-badge {
            font-weight: 700;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
        }

        /* Navigation */
        .nav-container {
            background: white;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 80px;
            z-index: 90;
        }

        .nav-pills {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-pills::-webkit-scrollbar {
            height: 4px;
        }

        .nav-pills::-webkit-scrollbar-track {
            background: var(--border-color);
        }

        .nav-pills::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 2px;
        }

        .nav-pill {
            padding: 0.5rem 1rem;
            background: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 2rem;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-pill:hover {
            background: var(--primary-light);
            color: white;
            transform: translateY(-2px);
        }

        .nav-pill.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .nav-pill.completed {
            border-color: var(--success-color);
            position: relative;
        }

        .nav-pill.completed::after {
            content: '✓';
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--success-color);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card Styles */
        .card {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.5s ease;
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        /* Interactive Areas */
        .interactive-area {
            background: var(--bg-color);
            border: 2px dashed var(--primary-light);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1rem 0;
            transition: all 0.3s ease;
        }

        .interactive-area:hover {
            border-style: solid;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .btn:active::before {
            width: 200px;
            height: 200px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: var(--bg-color);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-danger {
            background: var(--error-color);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        /* Quiz Styles */
        .quiz-option {
            display: block;
            width: 100%;
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            background: var(--primary-light);
            color: white;
            transform: translateX(5px);
        }

        .quiz-option.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .quiz-option.correct {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
            animation: correctPulse 0.5s ease;
        }

        .quiz-option.incorrect {
            background: var(--error-color);
            color: white;
            border-color: var(--error-color);
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Input Fields */
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        /* Matching Game Styles */
        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 1rem 0;
        }

        .draggable-item, .drop-zone {
            padding: 1rem;
            margin: 0.5rem 0;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .draggable-item:hover {
            background: var(--primary-light);
            color: white;
            transform: scale(1.05);
        }

        .draggable-item.selected {
            background: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }

        .draggable-item.matched {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .drop-zone {
            min-height: 60px;
            border-style: dashed;
        }

        .drop-zone.highlight {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--primary-color);
        }

        .drop-zone.correct {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success-color);
        }

        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transform: translateX(400px);
            transition: transform 0.5s ease;
            z-index: 1000;
            max-width: 300px;
        }

        .achievement-popup.show {
            transform: translateX(0);
        }

        .achievement-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        /* Simulation Styles */
        .simulation-container {
            background: #1a1b26;
            color: #a9b1d6;
            padding: 2rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }

        .simulation-step {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .simulation-step.active {
            display: block;
        }

        .simulation-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        /* Feedback Button */
        .feedback-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .feedback-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        /* Feedback Modal */
        .feedback-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .feedback-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        /* Shame Message */
        .shame-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--error-color);
            color: white;
            padding: 2rem;
            border-radius: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            z-index: 2000;
            animation: shameAnimation 3s ease;
        }

        @keyframes shameAnimation {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0); }
            20% { transform: translate(-50%, -50%) scale(1.2) rotate(-10deg); }
            40% { transform: translate(-50%, -50%) scale(0.9) rotate(10deg); }
            60% { transform: translate(-50%, -50%) scale(1.1) rotate(-5deg); }
            80% { transform: translate(-50%, -50%) scale(1) rotate(0); }
            100% { transform: translate(-50%, -50%) scale(0) rotate(0); }
        }

        /* Canvas Styles */
        .canvas-container {
            margin: 1rem 0;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        canvas {
            display: block;
            background: white;
            touch-action: none;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.25rem;
            }

            .matching-container {
                grid-template-columns: 1fr;
            }

            .xp-bar {
                width: 100px;
            }

            .nav-pills {
                padding: 0.5rem;
            }

            .card {
                padding: 1.5rem;
            }
        }

        /* Accessibility */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* High Contrast Mode */
        body.high-contrast {
            --bg-color: #000;
            --card-bg: #111;
            --text-color: #fff;
            --border-color: #fff;
        }

        /* Font Size Controls */
        body.font-small { font-size: 14px; }
        body.font-large { font-size: 18px; }
        body.font-xlarge { font-size: 20px; }

        /* Hint Container */
        .hint-container {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--warning-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.5rem;
            display: none;
        }

        .hint-container.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mark Scheme */
        .mark-scheme {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--success-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1rem;
            display: none;
        }

        .mark-scheme.show {
            display: block;
        }

        /* Accessibility Controls */
        .accessibility-controls {
            position: fixed;
            top: 150px;
            right: 20px;
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .accessibility-controls button {
            display: block;
            width: 100%;
            margin: 0.5rem 0;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .accessibility-controls button:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Progress Dots */
        .progress-dots {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--border-color);
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: var(--primary-color);
            transform: scale(1.2);
        }

        .progress-dot.completed {
            background: var(--success-color);
        }

        /* Sensor Display */
        .sensor-display {
            background: #2a2b3d;
            color: #fff;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            margin: 0.5rem 0;
        }

        .sensor-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--warning-color);
        }

        /* System Diagram */
        .system-diagram {
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 2rem;
            background: var(--bg-color);
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .system-component {
            text-align: center;
            padding: 1rem;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .system-component:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .system-arrow {
            font-size: 2rem;
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>Control and Monitoring Systems</h1>
            <div class="xp-container">
                <span class="level-badge">Level <span id="current-level">1</span></span>
                <div class="xp-bar">
                    <div class="xp-fill" id="xp-fill" style="width: 0%"></div>
                </div>
                <span id="xp-text">0 / 100 XP</span>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-pills" id="nav-pills">
            <button class="nav-pill active" data-section="intro">Introduction</button>
            <button class="nav-pill" data-section="starter">Starter Activity</button>
            <button class="nav-pill" data-section="control-monitoring">Control vs Monitoring</button>
            <button class="nav-pill" data-section="feedback">Feedback Systems</button>
            <button class="nav-pill" data-section="sensors">Types of Sensors</button>
            <button class="nav-pill" data-section="hardware">Hardware Components</button>
            <button class="nav-pill" data-section="actuators">Actuators</button>
            <button class="nav-pill" data-section="embedded">Embedded Systems</button>
            <button class="nav-pill" data-section="applications">Real-World Applications</button>
            <button class="nav-pill" data-section="summary">Summary & Quiz</button>
            <button class="nav-pill" data-section="exam">Exam Practice</button>
            <button class="nav-pill" data-section="extension">Extension</button>
            <button class="nav-pill" data-section="videos">Videos</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Introduction Section -->
        <section id="intro" class="section active">
            <div class="card">
                <h2 class="card-title">🎯 Learning Outcomes</h2>
                <ul>
                    <li>Distinguish between control and monitoring systems</li>
                    <li>Identify appropriate sensors for different applications</li>
                    <li>Explain the role of feedback in control systems</li>
                    <li>Describe hardware components (ADC, DAC, actuators)</li>
                    <li>Understand embedded systems and their characteristics</li>
                    <li>Apply knowledge to real-world scenarios</li>
                </ul>
            </div>

            <div class="card">
                <h2 class="card-title">📊 Pre-Assessment</h2>
                <p>Let's check your current knowledge about control and monitoring systems!</p>
                
                <div class="interactive-area">
                    <h3>Question 1: What is the main difference between control and monitoring systems?</h3>
                    <button class="quiz-option" data-answer="a">Control systems are more expensive</button>
                    <button class="quiz-option" data-answer="b">Monitoring systems only gather information</button>
                    <button class="quiz-option" data-answer="c">Control systems don't use sensors</button>
                    <button class="quiz-option" data-answer="d">Monitoring systems can perform actions</button>
                </div>

                <button class="btn btn-primary" onclick="checkPreAssessment()">Check Answer</button>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="navigateSection('next')">Start Learning →</button>
                </div>
            </div>
        </section>

        <!-- Starter Activity -->
        <section id="starter" class="section">
            <div class="card">
                <h2 class="card-title">🚀 Starter Activity: Sensor Matching</h2>
                <p>Match each sensor type with its most appropriate application. Click a sensor, then click its matching application!</p>
                
                <div class="matching-container" id="sensor-matching">
                    <div>
                        <h3>Sensors</h3>
                        <div class="draggable-item" data-id="temp">Temperature Sensor</div>
                        <div class="draggable-item" data-id="motion">Motion Sensor</div>
                        <div class="draggable-item" data-id="pressure">Pressure Sensor</div>
                        <div class="draggable-item" data-id="light">Light Sensor</div>
                        <div class="draggable-item" data-id="humidity">Humidity Sensor</div>
                        <div class="draggable-item" data-id="sound">Sound Sensor</div>
                    </div>
                    <div>
                        <h3>Applications</h3>
                        <div class="drop-zone" data-match="temp">Refrigerator Control</div>
                        <div class="drop-zone" data-match="motion">Security Alarm</div>
                        <div class="drop-zone" data-match="pressure">Car Seat Detection</div>
                        <div class="drop-zone" data-match="light">Street Lighting</div>
                        <div class="drop-zone" data-match="humidity">Greenhouse Control</div>
                        <div class="drop-zone" data-match="sound">Noise Level Monitor</div>
                    </div>
                </div>
                
                <button class="btn btn-secondary" onclick="resetStarterActivity()">Reset Activity</button>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Control vs Monitoring -->
        <section id="control-monitoring" class="section">
            <div class="card">
                <h2 class="card-title">🔄 Control vs Monitoring Systems</h2>
                
                <div class="system-diagram">
                    <div class="system-component">
                        <h3>Monitoring System</h3>
                        <p>Sensors → Data → Display/Log</p>
                        <p>✓ Observes</p>
                        <p>✗ No Actions</p>
                    </div>
                    <span class="system-arrow">↔️</span>
                    <div class="system-component">
                        <h3>Control System</h3>
                        <p>Sensors → Process → Action</p>
                        <p>✓ Observes</p>
                        <p>✓ Takes Action</p>
                        <p>✓ Uses Feedback</p>
                    </div>
                </div>

                <div class="interactive-area">
                    <h3>Quick Check: Identify the System Type</h3>
                    <p>A weather station that records temperature and humidity throughout the day is a:</p>
                    <select class="input-field" id="system-type-1">
                        <option value="">Select...</option>
                        <option value="monitoring">Monitoring System</option>
                        <option value="control">Control System</option>
                    </select>
                    
                    <p>A greenhouse that automatically adjusts temperature based on sensor readings is a:</p>
                    <select class="input-field" id="system-type-2">
                        <option value="">Select...</option>
                        <option value="monitoring">Monitoring System</option>
                        <option value="control">Control System</option>
                    </select>
                    
                    <button class="btn btn-primary" onclick="checkSystemTypes()">Check Answers</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Feedback Systems -->
        <section id="feedback" class="section">
            <div class="card">
                <h2 class="card-title">🔁 Feedback in Control Systems</h2>
                
                <div class="simulation-container">
                    <h3>Refrigerator Control Simulation</h3>
                    <div class="simulation-step active" data-step="1">
                        <div class="sensor-display">
                            <p>Current Temperature: <span class="sensor-value" id="temp-value">7°C</span></p>
                            <p>Target Range: 4-6°C</p>
                        </div>
                        <p>The temperature sensor detects that the temperature is too high.</p>
                    </div>
                    
                    <div class="simulation-step" data-step="2">
                        <p>The microprocessor compares the current temperature (7°C) with the target range (4-6°C).</p>
                        <p>Decision: Temperature is above range → Turn ON cooling</p>
                    </div>
                    
                    <div class="simulation-step" data-step="3">
                        <p>The microprocessor sends a signal to the actuator (compressor motor).</p>
                        <p>The cooling system activates! 🧊</p>
                    </div>
                    
                    <div class="simulation-step" data-step="4">
                        <div class="sensor-display">
                            <p>Current Temperature: <span class="sensor-value">5°C</span></p>
                            <p>Target Range: 4-6°C</p>
                        </div>
                        <p>The temperature is now within range. The system turns OFF cooling.</p>
                        <p><strong>This is FEEDBACK</strong> - the output affects the input!</p>
                    </div>
                    
                    <div class="simulation-controls">
                        <button class="btn btn-secondary" onclick="previousSimStep('feedback')">← Previous</button>
                        <button class="btn btn-primary" onclick="nextSimStep('feedback')">Next →</button>
                    </div>
                </div>

                <div class="interactive-area">
                    <h3>Understanding Check</h3>
                    <p>Why is this a control system and not just monitoring?</p>
                    <textarea class="input-field" id="feedback-answer" rows="3" placeholder="Type your answer here..."></textarea>
                    <button class="btn btn-primary" onclick="checkFeedbackAnswer()">Check Answer</button>
                    <button class="btn btn-secondary" onclick="showHint('feedback')">Need a Hint?</button>
                    
                    <div class="hint-container" id="feedback-hint">
                        <p>💡 Hint: Think about what happens after the temperature is measured. Does the system just record it, or does it do something?</p>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Types of Sensors -->
        <section id="sensors" class="section">
            <div class="card">
                <h2 class="card-title">📡 Types of Sensors</h2>
                
                <div class="interactive-area">
                    <h3>Sensor Categories</h3>
                    <p>Click on each sensor type to learn more about it:</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div class="system-component" onclick="showSensorInfo('temperature')">
                            <h4>🌡️ Temperature</h4>
                            <div id="temp-info" style="display: none;">
                                <p>Measures heat levels</p>
                                <p>Uses: HVAC, fridges</p>
                            </div>
                        </div>
                        <div class="system-component" onclick="showSensorInfo('pressure')">
                            <h4>⚡ Pressure</h4>
                            <div id="pressure-info" style="display: none;">
                                <p>Detects force/weight</p>
                                <p>Uses: Car seats, scales</p>
                            </div>
                        </div>
                        <div class="system-component" onclick="showSensorInfo('light')">
                            <h4>💡 Light</h4>
                            <div id="light-info" style="display: none;">
                                <p>Measures brightness</p>
                                <p>Uses: Street lights</p>
                            </div>
                        </div>
                        <div class="system-component" onclick="showSensorInfo('motion')">
                            <h4>🏃 Motion/Infrared</h4>
                            <div id="motion-info" style="display: none;">
                                <p>Detects movement</p>
                                <p>Uses: Security, doors</p>
                            </div>
                        </div>
                        <div class="system-component" onclick="showSensorInfo('sound')">
                            <h4>🔊 Sound</h4>
                            <div id="sound-info" style="display: none;">
                                <p>Measures noise levels</p>
                                <p>Uses: Alarms, monitors</p>
                            </div>
                        </div>
                        <div class="system-component" onclick="showSensorInfo('humidity')">
                            <h4>💧 Humidity</h4>
                            <div id="humidity-info" style="display: none;">
                                <p>Measures moisture</p>
                                <p>Uses: Greenhouses</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="interactive-area">
                    <h3>Sensor Selection Challenge</h3>
                    <p>For a car alarm system, which sensor would be MOST appropriate?</p>
                    <button class="quiz-option" onclick="checkSensorChoice('a')">Temperature Sensor</button>
                    <button class="quiz-option" onclick="checkSensorChoice('b')">Humidity Sensor</button>
                    <button class="quiz-option" onclick="checkSensorChoice('c')">Sound/Pressure Sensor</button>
                    <button class="quiz-option" onclick="checkSensorChoice('d')">pH Sensor</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Hardware Components -->
        <section id="hardware" class="section">
            <div class="card">
                <h2 class="card-title">🔧 Hardware Components</h2>
                
                <div class="interactive-area">
                    <h3>Build a Control System</h3>
                    <p>Select the correct components in order:</p>
                    
                    <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                        <select class="input-field" style="width: 150px;" id="comp1">
                            <option value="">Component 1</option>
                            <option value="actuator">Actuator</option>
                            <option value="sensor">Sensor</option>
                            <option value="processor">Processor</option>
                            <option value="display">Display</option>
                        </select>
                        →
                        <select class="input-field" style="width: 150px;" id="comp2">
                            <option value="">Component 2</option>
                            <option value="adc">ADC</option>
                            <option value="dac">DAC</option>
                            <option value="sensor">Sensor</option>
                            <option value="cable">Cable</option>
                        </select>
                        →
                        <select class="input-field" style="width: 150px;" id="comp3">
                            <option value="">Component 3</option>
                            <option value="processor">Processor</option>
                            <option value="sensor">Sensor</option>
                            <option value="actuator">Actuator</option>
                            <option value="adc">ADC</option>
                        </select>
                        →
                        <select class="input-field" style="width: 150px;" id="comp4">
                            <option value="">Component 4</option>
                            <option value="dac">DAC</option>
                            <option value="adc">ADC</option>
                            <option value="display">Display</option>
                            <option value="sensor">Sensor</option>
                        </select>
                        →
                        <select class="input-field" style="width: 150px;" id="comp5">
                            <option value="">Component 5</option>
                            <option value="actuator">Actuator</option>
                            <option value="sensor">Sensor</option>
                            <option value="processor">Processor</option>
                            <option value="cable">Cable</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkSystemBuild()">Check System</button>
                    <button class="btn btn-secondary" onclick="resetSystemBuild()">Reset</button>
                </div>

                <div class="card" style="background: var(--bg-color); margin-top: 1rem;">
                    <h4>Component Functions:</h4>
                    <ul>
                        <li><strong>ADC (Analogue to Digital Converter):</strong> Converts sensor signals for the processor</li>
                        <li><strong>DAC (Digital to Analogue Converter):</strong> Converts processor signals for actuators</li>
                        <li><strong>Microprocessor:</strong> Processes data and makes decisions</li>
                        <li><strong>Actuator:</strong> Performs physical actions (motors, heaters, etc.)</li>
                    </ul>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Actuators -->
        <section id="actuators" class="section">
            <div class="card">
                <h2 class="card-title">⚙️ Actuators</h2>
                
                <div class="interactive-area">
                    <h3>What is an Actuator?</h3>
                    <p>Fill in the blanks to complete the definition:</p>
                    
                    <p>An actuator is a hardware device that receives a 
                        <select class="input-field" style="width: 100px; display: inline;">
                            <option value="">choose...</option>
                            <option value="temperature">temperature</option>
                            <option value="signal">signal</option>
                            <option value="sensor">sensor</option>
                            <option value="pressure">pressure</option>
                        </select>
                        from a computer and adjusts the setting of a 
                        <select class="input-field" style="width: 150px; display: inline;">
                            <option value="">choose...</option>
                            <option value="sensor">sensor device</option>
                            <option value="display">display screen</option>
                            <option value="controlling">controlling device</option>
                            <option value="monitoring">monitoring system</option>
                        </select>
                        or motor.
                    </p>
                    
                    <button class="btn btn-primary" onclick="checkActuatorDefinition()">Check Answer</button>
                </div>

                <div class="interactive-area">
                    <h3>Actuator Examples</h3>
                    <p>Match the actuator with its action:</p>
                    
                    <div class="matching-container" id="actuator-matching">
                        <div>
                            <h4>Actuators</h4>
                            <div class="draggable-item" data-id="motor">Electric Motor</div>
                            <div class="draggable-item" data-id="valve">Solenoid Valve</div>
                            <div class="draggable-item" data-id="heater">Heating Element</div>
                            <div class="draggable-item" data-id="relay">Relay Switch</div>
                        </div>
                        <div>
                            <h4>Actions</h4>
                            <div class="drop-zone" data-match="motor">Opens/closes doors</div>
                            <div class="drop-zone" data-match="valve">Controls water flow</div>
                            <div class="drop-zone" data-match="heater">Increases temperature</div>
                            <div class="drop-zone" data-match="relay">Turns lights on/off</div>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Embedded Systems -->
        <section id="embedded" class="section">
            <div class="card">
                <h2 class="card-title">🔌 Embedded Systems</h2>
                
                <div class="interactive-area">
                    <h3>What are Embedded Systems?</h3>
                    <p>Computer systems with a dedicated/specific function within a larger electrical or mechanical system.</p>
                    
                    <h4>Common Examples:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem;">
                        <div class="system-component">🍳 Cookers</div>
                        <div class="system-component">🌀 Washing Machines</div>
                        <div class="system-component">❄️ Refrigerators</div>
                        <div class="system-component">🔥 Microwaves</div>
                        <div class="system-component">🚗 Cars</div>
                        <div class="system-component">🔔 Doorbells</div>
                    </div>
                </div>

                <div class="interactive-area">
                    <h3>Embedded System Characteristics</h3>
                    <p>Categorize each characteristic as an Advantage or Disadvantage:</p>
                    
                    <div class="matching-container" id="embedded-matching">
                        <div>
                            <h4>Characteristics</h4>
                            <div class="draggable-item" data-id="small">Small in size</div>
                            <div class="draggable-item" data-id="lowcost">Low cost to manufacture</div>
                            <div class="draggable-item" data-id="upgrade">Difficult to upgrade</div>
                            <div class="draggable-item" data-id="dedicated">Dedicated to one task</div>
                            <div class="draggable-item" data-id="lowpower">Consume little power</div>
                            <div class="draggable-item" data-id="throwaway">Often thrown away</div>
                        </div>
                        <div>
                            <h4>Categories</h4>
                            <div class="drop-zone" data-type="advantage" style="background: rgba(16, 185, 129, 0.1);">
                                <strong>Advantages</strong>
                            </div>
                            <div class="drop-zone" data-type="disadvantage" style="background: rgba(239, 68, 68, 0.1);">
                                <strong>Disadvantages</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Real-World Applications -->
        <section id="applications" class="section">
            <div class="card">
                <h2 class="card-title">🌍 Real-World Applications</h2>
                
                <div class="interactive-area">
                    <h3>Case Study: Smart Video Doorbell</h3>
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 300'%3E%3Crect width='200' height='300' fill='%23ddd'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' font-family='sans-serif' font-size='20' fill='%23999'%3EDoorbell%3C/text%3E%3C/svg%3E" alt="Doorbell diagram" style="max-width: 200px; margin: 0 auto; display: block;">
                    
                    <p>A video doorbell has these features:</p>
                    <ul>
                        <li>Motion sensor to detect visitors</li>
                        <li>Digital camera for recording</li>
                        <li>Smartphone notification system</li>
                        <li>Button for traditional doorbell function</li>
                        <li>Internal storage for video clips</li>
                    </ul>
                    
                    <h4>Task: Is this a monitoring or control system?</h4>
                    <textarea class="input-field" rows="4" id="doorbell-answer" placeholder="Explain your reasoning..."></textarea>
                    <button class="btn btn-primary" onclick="checkDoorbellAnswer()">Submit Answer</button>
                </div>

                <div class="interactive-area">
                    <h3>Design Challenge</h3>
                    <p>A chocolate factory needs a system to remove bars with incorrect weight. Design the system:</p>
                    
                    <div style="margin: 1rem 0;">
                        <label>Sensor type: 
                            <select class="input-field" id="factory-sensor" style="width: 200px;">
                                <option value="">Select sensor...</option>
                                <option value="temperature">Temperature sensor</option>
                                <option value="weight">Weight/Pressure sensor</option>
                                <option value="infrared">Infrared sensor</option>
                                <option value="sound">Sound sensor</option>
                            </select>
                        </label>
                    </div>
                    
                    <div style="margin: 1rem 0;">
                        <label>Actuator action:
                            <textarea class="input-field" id="factory-actuator" rows="2" placeholder="Describe what the actuator does..."></textarea>
                        </label>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkFactoryDesign()">Check Design</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Summary & Quiz -->
        <section id="summary" class="section">
            <div class="card">
                <h2 class="card-title">📝 Summary & Final Quiz</h2>
                
                <div class="interactive-area">
                    <h3>Key Takeaways</h3>
                    <ul>
                        <li>✅ Monitoring systems observe but don't act</li>
                        <li>✅ Control systems use feedback to take actions</li>
                        <li>✅ ADC converts analogue → digital</li>
                        <li>✅ DAC converts digital → analogue</li>
                        <li>✅ Actuators perform physical actions</li>
                        <li>✅ Embedded systems are dedicated to specific tasks</li>
                    </ul>
                </div>

                <div class="interactive-area">
                    <h3>Final Assessment</h3>
                    
                    <div style="margin: 1rem 0;">
                        <p><strong>1. Which component converts sensor signals for the processor?</strong></p>
                        <button class="quiz-option" data-q="1" data-a="a">DAC</button>
                        <button class="quiz-option" data-q="1" data-a="b">ADC</button>
                        <button class="quiz-option" data-q="1" data-a="c">Actuator</button>
                        <button class="quiz-option" data-q="1" data-a="d">Sensor</button>
                    </div>

                    <div style="margin: 1rem 0;">
                        <p><strong>2. What makes a control system different from monitoring?</strong></p>
                        <button class="quiz-option" data-q="2" data-a="a">It's more expensive</button>
                        <button class="quiz-option" data-q="2" data-a="b">It uses feedback</button>
                        <button class="quiz-option" data-q="2" data-a="c">It has sensors</button>
                        <button class="quiz-option" data-q="2" data-a="d">It stores data</button>
                    </div>

                    <div style="margin: 1rem 0;">
                        <p><strong>3. An embedded system must contain:</strong></p>
                        <button class="quiz-option" data-q="3" data-a="a">A screen</button>
                        <button class="quiz-option" data-q="3" data-a="b">Internet connection</button>
                        <button class="quiz-option" data-q="3" data-a="c">A microprocessor</button>
                        <button class="quiz-option" data-q="3" data-a="d">A keyboard</button>
                    </div>

                    <div style="margin: 1rem 0;">
                        <p><strong>4. True or False: Actuators convert electrical signals into mechanical force</strong></p>
                        <button class="quiz-option" data-q="4" data-a="a">True</button>
                        <button class="quiz-option" data-q="4" data-a="b">False</button>
                    </div>

                    <div style="margin: 1rem 0;">
                        <p><strong>5. Which sensor is best for a car alarm?</strong></p>
                        <button class="quiz-option" data-q="5" data-a="a">Temperature</button>
                        <button class="quiz-option" data-q="5" data-a="b">pH</button>
                        <button class="quiz-option" data-q="5" data-a="c">Sound/Pressure</button>
                        <button class="quiz-option" data-q="5" data-a="d">Humidity</button>
                    </div>

                    <div style="margin: 1rem 0;">
                        <p><strong>6. The main disadvantage of embedded systems is:</strong></p>
                        <button class="quiz-option" data-q="6" data-a="a">High power consumption</button>
                        <button class="quiz-option" data-q="6" data-a="b">Large size</button>
                        <button class="quiz-option" data-q="6" data-a="c">Difficult to upgrade</button>
                        <button class="quiz-option" data-q="6" data-a="d">High cost</button>
                    </div>

                    <button class="btn btn-success" onclick="submitFinalQuiz()">Submit Quiz</button>
                    
                    <div id="quiz-results" style="display: none; margin-top: 1rem;">
                        <h4>Results:</h4>
                        <p id="quiz-score"></p>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Exam Practice -->
        <section id="exam" class="section">
            <div class="card">
                <h2 class="card-title">📋 Exam Practice</h2>
                
                <div class="interactive-area">
                    <h3>Question 1 (3 marks)</h3>
                    <p>Explain the importance of feedback in a control system.</p>
                    
                    <textarea class="input-field" id="exam-q1" rows="5" placeholder="Write your answer here..."></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <label>Predicted marks: 
                            <input type="number" id="marks-q1" min="0" max="3" style="width: 50px;" class="input-field">
                        </label>
                        <button class="btn btn-secondary" onclick="showMarkScheme('q1')">Show Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="mark-scheme-q1">
                        <h5>Mark Scheme:</h5>
                        <ul>
                            <li>To ensure the system operates with the given criteria (1)</li>
                            <li>By enabling system output to affect subsequent system input (1)</li>
                            <li>Thus allowing conditions to be automatically adjusted (1)</li>
                        </ul>
                    </div>
                </div>

                <div class="interactive-area">
                    <h3>Question 2 (5 marks)</h3>
                    <p>A factory uses a conveyor belt system. An automated system counts chocolate bars at the end of production.</p>
                    <p>(a) Identify one appropriate type of sensor that can be used. [1]</p>
                    <p>(b) Describe the role of an actuator if bars with incorrect weight need to be removed. [2]</p>
                    <p>(c) Identify two features of embedded systems. [2]</p>
                    
                    <textarea class="input-field" id="exam-q2" rows="8" placeholder="Write your answers here..."></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <label>Predicted marks: 
                            <input type="number" id="marks-q2" min="0" max="5" style="width: 50px;" class="input-field">
                        </label>
                        <button class="btn btn-secondary" onclick="showMarkScheme('q2')">Show Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="mark-scheme-q2">
                        <h5>Mark Scheme:</h5>
                        <p>(a) Infrared/proximity sensor (1)</p>
                        <p>(b) Actuator generates a signal/causes an action/converts electrical energy into mechanical force (1)<br>
                            To push an arm/open a trap door/pick up the chocolate bar with incorrect weight (1)</p>
                        <p>(c) Any two from:</p>
                        <ul>
                            <li>Dedicated to a single task/limited number of functions</li>
                            <li>Built into a larger system/integrated into a larger system</li>
                            <li>Must contain a processor, memory and I/O capability</li>
                            <li>Dedicated hardware</li>
                        </ul>
                    </div>
                </div>

                <div class="canvas-container">
                    <p>Use this space for any rough work:</p>
                    <canvas id="drawing-canvas" width="600" height="200"></canvas>
                    <button class="btn btn-secondary" onclick="clearCanvas()">Clear Canvas</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Extension -->
        <section id="extension" class="section">
            <div class="card">
                <h2 class="card-title">🚀 Extension Activities</h2>
                
                <div class="interactive-area">
                    <h3>Beyond the Specification: IoT and Smart Systems</h3>
                    <p>Research and explain how the Internet of Things (IoT) extends traditional control systems:</p>
                    
                    <textarea class="input-field" rows="5" id="extension-iot" placeholder="Consider: remote monitoring, cloud processing, security concerns..."></textarea>
                </div>

                <div class="interactive-area">
                    <h3>Design Challenge</h3>
                    <p>Design a smart home system that integrates multiple control systems. Include:</p>
                    <ul>
                        <li>At least 3 different types of sensors</li>
                        <li>How they communicate with each other</li>
                        <li>Security considerations</li>
                        <li>Energy efficiency features</li>
                    </ul>
                    
                    <textarea class="input-field" rows="8" id="extension-design" placeholder="Describe your smart home system design..."></textarea>
                </div>

                <button class="btn btn-primary" onclick="submitExtension()">Submit Extension Work</button>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Videos -->
        <section id="videos" class="section">
            <div class="card">
                <h2 class="card-title">🎥 Video Resources</h2>
                
                <div class="interactive-area">
                    <p>Your teacher will add video links here to support your learning.</p>
                    
                    <div style="background: var(--bg-color); padding: 3rem; text-align: center; margin: 2rem 0; border-radius: 0.5rem;">
                        <p style="font-size: 3rem;">📹</p>
                        <p>Video content will be added here</p>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('intro')">Start Over</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievement-popup">
        <div class="achievement-icon" id="achievement-icon">🏆</div>
        <h4 id="achievement-title">Achievement Unlocked!</h4>
        <p id="achievement-desc">Description</p>
    </div>

    <!-- Shame Message -->
    <div class="shame-message" id="shame-message" style="display: none;">
        🚫 No pasting allowed! Type it yourself! 🚫
    </div>

    <!-- Feedback Button -->
    <button class="feedback-btn" onclick="openFeedback()">
        💬
    </button>

    <!-- Feedback Modal -->
    <div class="feedback-modal" id="feedback-modal">
        <div class="feedback-content">
            <h3>Send Feedback</h3>
            <p>Found a bug or have a suggestion?</p>
            <p>Current page: <span id="feedback-page"></span></p>
            <textarea class="input-field" id="feedback-text" rows="4" placeholder="Describe the issue..."></textarea>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="closeFeedback()">Cancel</button>
                <button class="btn btn-primary" onclick="sendFeedback()">Send</button>
            </div>
        </div>
    </div>

    <!-- Accessibility Controls -->
    <div class="accessibility-controls">
        <h4>Accessibility</h4>
        <button onclick="toggleHighContrast()">High Contrast</button>
        <button onclick="toggleDyslexiaFont()">Dyslexia Font</button>
        <button onclick="changeFontSize('small')">A-</button>
        <button onclick="changeFontSize('normal')">A</button>
        <button onclick="changeFontSize('large')">A+</button>
    </div>

    <script>
        // Game State
        let gameState = {
            xp: 0,
            level: 1,
            completedSections: new Set(),
            achievements: new Set(),
            currentSection: 'intro',
            selectedItem: null,
            simStep: {},
            actionsPerformed: new Set()
        };

        // XP Requirements
        const XP_PER_LEVEL = [0, 100, 250, 450, 700, 1000];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            setupMatchingActivities();
            loadProgress();
            updateXPDisplay();
            initCanvas();
        });

        // Event Listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-pill').forEach(pill => {
                pill.addEventListener('click', function() {
                    navigateToSection(this.dataset.section);
                });
            });

            // Quiz options
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('quiz-option')) {
                    selectQuizOption(e.target);
                }
            });

            // Prevent paste
            document.addEventListener('paste', function(e) {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    e.preventDefault();
                    showShameMessage();
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowLeft') navigateSection('prev');
                if (e.key === 'ArrowRight') navigateSection('next');
            });
        }

        // Navigation
        function navigateToSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-pill').forEach(p => p.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
            
            gameState.currentSection = sectionId;
            document.getElementById('feedback-page').textContent = sectionId;
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function navigateSection(direction) {
            const sections = Array.from(document.querySelectorAll('.nav-pill')).map(p => p.dataset.section);
            const currentIndex = sections.indexOf(gameState.currentSection);
            
            if (direction === 'next' && currentIndex < sections.length - 1) {
                navigateToSection(sections[currentIndex + 1]);
            } else if (direction === 'prev' && currentIndex > 0) {
                navigateToSection(sections[currentIndex - 1]);
            }
        }

        // XP System
        function awardXP(amount, action, actionId = null) {
            if (actionId && gameState.actionsPerformed.has(actionId)) return;
            if (actionId) gameState.actionsPerformed.add(actionId);
            
            gameState.xp += amount;
            updateXPDisplay();
            checkLevelUp();
            saveProgress();
            
            // Show floating XP
            showFloatingXP(amount);
        }

        function updateXPDisplay() {
            const xpForNextLevel = XP_PER_LEVEL[gameState.level] || XP_PER_LEVEL[XP_PER_LEVEL.length - 1];
            const xpProgress = Math.min((gameState.xp / xpForNextLevel) * 100, 100);
            
            document.getElementById('xp-fill').style.width = xpProgress + '%';
            document.getElementById('xp-text').textContent = `${gameState.xp} / ${xpForNextLevel} XP`;
            document.getElementById('current-level').textContent = gameState.level;
        }

        function checkLevelUp() {
            if (gameState.level < 5 && gameState.xp >= XP_PER_LEVEL[gameState.level]) {
                gameState.level++;
                showAchievement('Level Up!', `You reached Level ${gameState.level}!`, '⬆️');
            }
        }

        function showFloatingXP(amount) {
            const xpFloat = document.createElement('div');
            xpFloat.style.cssText = `
                position: fixed;
                top: 100px;
                right: 100px;
                color: var(--warning-color);
                font-weight: bold;
                font-size: 1.5rem;
                animation: floatUp 2s ease-out forwards;
                pointer-events: none;
                z-index: 1000;
            `;
            xpFloat.textContent = `+${amount} XP`;
            document.body.appendChild(xpFloat);
            
            setTimeout(() => xpFloat.remove(), 2000);
        }

        // Add floating animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes floatUp {
                0% { transform: translateY(0); opacity: 1; }
                100% { transform: translateY(-50px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Achievements
        function showAchievement(title, desc, icon) {
            const popup = document.getElementById('achievement-popup');
            document.getElementById('achievement-title').textContent = title;
            document.getElementById('achievement-desc').textContent = desc;
            document.getElementById('achievement-icon').textContent = icon;
            
            popup.classList.add('show');
            setTimeout(() => popup.classList.remove('show'), 3000);
            
            gameState.achievements.add(title);
        }

        // Section Complete
        function markSectionComplete(section) {
            gameState.completedSections.add(section);
            document.querySelector(`[data-section="${section}"]`).classList.add('completed');
            saveProgress();
            
            // Check for achievements
            if (gameState.completedSections.size === 1) {
                showAchievement('First Steps', 'Completed your first section!', '👣');
            }
            if (gameState.completedSections.size === 5) {
                showAchievement('Halfway There', 'Completed 5 sections!', '🎯');
            }
            if (gameState.completedSections.size === 10) {
                showAchievement('Control Master', 'Completed most sections!', '🎓');
            }
        }

        // Pre-Assessment
        function checkPreAssessment() {
            const selected = document.querySelector('#intro .quiz-option.selected');
            if (!selected) return;
            
            if (selected.dataset.answer === 'b') {
                selected.classList.add('correct');
                awardXP(10, 'Pre-assessment correct', 'pre_assessment');
            } else {
                selected.classList.add('incorrect');
                document.querySelector('#intro .quiz-option[data-answer="b"]').classList.add('correct');
            }
        }

        // Starter Activity - Matching
        function setupMatchingActivities() {
            setupMatching('sensor-matching', {
                'temp': 'temp',
                'motion': 'motion',
                'pressure': 'pressure',
                'light': 'light',
                'humidity': 'humidity',
                'sound': 'sound'
            });
            
            setupMatching('actuator-matching', {
                'motor': 'motor',
                'valve': 'valve',
                'heater': 'heater',
                'relay': 'relay'
            });
            
            setupMatching('embedded-matching', {
                'small': 'advantage',
                'lowcost': 'advantage',
                'upgrade': 'disadvantage',
                'dedicated': 'advantage',
                'lowpower': 'advantage',
                'throwaway': 'disadvantage'
            });
        }

        function setupMatching(containerId, answers) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const items = container.querySelectorAll('.draggable-item');
            const zones = container.querySelectorAll('.drop-zone');
            
            items.forEach(item => {
                item.addEventListener('click', function() {
                    if (this.classList.contains('matched')) return;
                    
                    items.forEach(i => i.classList.remove('selected'));
                    this.classList.add('selected');
                    gameState.selectedItem = this;
                });
            });
            
            zones.forEach(zone => {
                zone.addEventListener('click', function() {
                    if (!gameState.selectedItem || gameState.selectedItem.classList.contains('matched')) return;
                    
                    const itemId = gameState.selectedItem.dataset.id;
                    const zoneMatch = this.dataset.match || this.dataset.type;
                    
                    if (answers[itemId] === zoneMatch) {
                        gameState.selectedItem.classList.add('matched');
                        gameState.selectedItem.classList.remove('selected');
                        this.appendChild(gameState.selectedItem.cloneNode(true));
                        this.classList.add('correct');
                        awardXP(5, 'Correct match', `match_${containerId}_${itemId}`);
                        
                        // Check if all matched
                        const allMatched = container.querySelectorAll('.draggable-item:not(.matched)').length === 0;
                        if (allMatched) {
                            awardXP(20, 'Activity complete', `complete_${containerId}`);
                            if (containerId === 'sensor-matching') {
                                markSectionComplete('starter');
                                showAchievement('Sensor Expert', 'Matched all sensors correctly!', '📡');
                            }
                        }
                    } else {
                        this.classList.add('highlight');
                        setTimeout(() => this.classList.remove('highlight'), 1000);
                    }
                    
                    gameState.selectedItem = null;
                });
            });
        }

        function resetStarterActivity() {
            resetMatching('sensor-matching');
        }

        function resetMatching(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.querySelectorAll('.draggable-item').forEach(item => {
                item.classList.remove('matched', 'selected');
            });
            
            container.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('correct', 'highlight');
                const clones = zone.querySelectorAll('.draggable-item');
                clones.forEach(clone => clone.remove());
            });
        }

        // Control vs Monitoring
        function checkSystemTypes() {
            const type1 = document.getElementById('system-type-1').value;
            const type2 = document.getElementById('system-type-2').value;
            
            let correct = 0;
            if (type1 === 'monitoring') {
                document.getElementById('system-type-1').style.borderColor = 'var(--success-color)';
                correct++;
            }
            if (type2 === 'control') {
                document.getElementById('system-type-2').style.borderColor = 'var(--success-color)';
                correct++;
            }
            
            if (correct === 2) {
                awardXP(15, 'System types correct', 'system_types');
                markSectionComplete('control-monitoring');
            }
        }

        // Feedback Simulation
        function nextSimStep(simId) {
            if (!gameState.simStep[simId]) gameState.simStep[simId] = 1;
            
            const steps = document.querySelectorAll(`#${simId} .simulation-step`);
            steps.forEach(s => s.classList.remove('active'));
            
            gameState.simStep[simId]++;
            if (gameState.simStep[simId] > steps.length) gameState.simStep[simId] = 1;
            
            steps[gameState.simStep[simId] - 1].classList.add('active');
            
            if (gameState.simStep[simId] === steps.length) {
                awardXP(10, 'Simulation complete', `sim_${simId}`);
            }
        }

        function previousSimStep(simId) {
            if (!gameState.simStep[simId]) gameState.simStep[simId] = 1;
            
            const steps = document.querySelectorAll(`#${simId} .simulation-step`);
            steps.forEach(s => s.classList.remove('active'));
            
            gameState.simStep[simId]--;
            if (gameState.simStep[simId] < 1) gameState.simStep[simId] = steps.length;
            
            steps[gameState.simStep[simId] - 1].classList.add('active');
        }

        function checkFeedbackAnswer() {
            const answer = document.getElementById('feedback-answer').value.toLowerCase();
            const keywords = ['action', 'control', 'cooling', 'responds', 'changes', 'adjusts', 'actuator'];
            
            const matchedKeywords = keywords.filter(keyword => answer.includes(keyword));
            
            if (answer.length > 50 && matchedKeywords.length >= 2) {
                awardXP(20, 'Feedback understanding', 'feedback_answer');
                markSectionComplete('feedback');
                alert('Excellent! You understand that control systems take action based on sensor input.');
            } else {
                alert('Think about what happens after the temperature is measured. Does it just record it or take action?');
            }
        }

        function showHint(section) {
            const hint = document.getElementById(section + '-hint');
            hint.classList.add('show');
            // Reduce XP for using hint
            if (!gameState.actionsPerformed.has(`hint_${section}`)) {
                gameState.xp = Math.max(0, gameState.xp - 5);
                updateXPDisplay();
                gameState.actionsPerformed.add(`hint_${section}`);
            }
        }

        // Sensors Section
        function showSensorInfo(type) {
            const info = document.getElementById(type + '-info');
            const isVisible = info.style.display === 'block';
            
            // Hide all
            ['temperature', 'pressure', 'light', 'motion', 'sound', 'humidity'].forEach(t => {
                const el = document.getElementById(t + '-info');
                if (el) el.style.display = 'none';
            });
            
            // Toggle selected
            if (!isVisible) {
                info.style.display = 'block';
                awardXP(2, 'Explore sensor', `sensor_${type}`);
            }
        }

        function checkSensorChoice(answer) {
            const options = event.target.parentElement.querySelectorAll('.quiz-option');
            options.forEach(opt => opt.classList.remove('correct', 'incorrect'));
            
            if (answer === 'c') {
                options[2].classList.add('correct');
                awardXP(10, 'Sensor selection', 'sensor_choice');
                markSectionComplete('sensors');
            } else {
                event.target.classList.add('incorrect');
                options[2].classList.add('correct');
            }
        }

        // Hardware Components
        function checkSystemBuild() {
            const correct = {
                'comp1': 'sensor',
                'comp2': 'adc',
                'comp3': 'processor',
                'comp4': 'dac',
                'comp5': 'actuator'
            };
            
            let allCorrect = true;
            Object.keys(correct).forEach(id => {
                const select = document.getElementById(id);
                if (select.value === correct[id]) {
                    select.style.borderColor = 'var(--success-color)';
                } else {
                    select.style.borderColor = 'var(--error-color)';
                    allCorrect = false;
                }
            });
            
            if (allCorrect) {
                awardXP(25, 'System build complete', 'system_build');
                markSectionComplete('hardware');
                showAchievement('System Builder', 'Built a complete control system!', '🔧');
            }
        }

        function resetSystemBuild() {
            ['comp1', 'comp2', 'comp3', 'comp4', 'comp5'].forEach(id => {
                const select = document.getElementById(id);
                select.value = '';
                select.style.borderColor = '';
            });
        }

        // Actuators
        function checkActuatorDefinition() {
            const blanks = document.querySelectorAll('#actuators .input-field');
            if (blanks[0].value === 'signal' && blanks[1].value === 'controlling') {
                blanks.forEach(b => b.style.borderColor = 'var(--success-color)');
                awardXP(10, 'Actuator definition', 'actuator_def');
                markSectionComplete('actuators');
            } else {
                blanks.forEach(b => b.style.borderColor = 'var(--error-color)');
            }
        }

        // Applications
        function checkDoorbellAnswer() {
            const answer = document.getElementById('doorbell-answer').value.toLowerCase();
            const keywords = ['monitoring', 'no action', 'records', 'observes', 'stores'];
            
            const matchedKeywords = keywords.filter(keyword => answer.includes(keyword));
            
            if (answer.length > 50 && matchedKeywords.length >= 1) {
                awardXP(20, 'Doorbell analysis', 'doorbell_answer');
                alert('Good analysis! The doorbell primarily monitors and records.');
            } else {
                alert('Consider: Does the doorbell system take any automatic actions based on what it detects?');
            }
        }

        function checkFactoryDesign() {
            const sensor = document.getElementById('factory-sensor').value;
            const actuator = document.getElementById('factory-actuator').value.toLowerCase();
            
            if (sensor === 'weight' && actuator.length > 20 && 
                (actuator.includes('push') || actuator.includes('remove') || actuator.includes('arm'))) {
                awardXP(25, 'Factory design', 'factory_design');
                markSectionComplete('applications');
                alert('Excellent design! Weight sensor with actuator to remove incorrect bars.');
            } else {
                alert('Think about what needs to be detected (weight) and what action to take.');
            }
        }

        // Final Quiz
        function selectQuizOption(option) {
            const question = option.dataset.q;
            const siblings = document.querySelectorAll(`.quiz-option[data-q="${question}"]`);
            siblings.forEach(s => s.classList.remove('selected'));
            option.classList.add('selected');
        }

        function submitFinalQuiz() {
            const answers = {
                '1': 'b', // ADC
                '2': 'b', // Uses feedback
                '3': 'c', // Microprocessor
                '4': 'a', // True
                '5': 'c', // Sound/Pressure
                '6': 'c'  // Difficult to upgrade
            };
            
            let score = 0;
            Object.keys(answers).forEach(q => {
                const selected = document.querySelector(`.quiz-option[data-q="${q}"].selected`);
                if (selected && selected.dataset.a === answers[q]) {
                    selected.classList.add('correct');
                    score++;
                } else {
                    if (selected) selected.classList.add('incorrect');
                    document.querySelector(`.quiz-option[data-q="${q}"][data-a="${answers[q]}"]`).classList.add('correct');
                }
            });
            
            document.getElementById('quiz-score').textContent = `You scored ${score}/6 (${Math.round(score/6*100)}%)`;
            document.getElementById('quiz-results').style.display = 'block';
            
            awardXP(score * 10, 'Final quiz', 'final_quiz');
            markSectionComplete('summary');
            
            if (score === 6) {
                showAchievement('Perfect Score!', 'Aced the final quiz!', '💯');
            }
        }

        // Exam Practice
        function showMarkScheme(question) {
            const textarea = document.getElementById(`exam-${question}`);
            const marks = document.getElementById(`marks-${question}`);
            
            if (textarea.value.length < 50 || !marks.value) {
                alert('Please write an answer and enter predicted marks first');
                return;
            }
            
            document.getElementById(`mark-scheme-${question}`).classList.add('show');
            awardXP(15, 'Exam practice', `exam_${question}`);
        }

        // Canvas
        function initCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
            
            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                ctx.beginPath();
                ctx.moveTo(x, y);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                ctx.lineTo(x, y);
                ctx.stroke();
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
        }

        function clearCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Extension
        function submitExtension() {
            const iot = document.getElementById('extension-iot').value;
            const design = document.getElementById('extension-design').value;
            
            if (iot.length > 100 && design.length > 100) {
                awardXP(50, 'Extension complete', 'extension');
                markSectionComplete('extension');
                showAchievement('Going Beyond', 'Completed extension activities!', '🚀');
                alert('Excellent extension work! Your teacher will review your responses.');
            } else {
                alert('Please provide more detailed responses for the extension activities.');
            }
        }

        // Feedback System
        function openFeedback() {
            document.getElementById('feedback-modal').style.display = 'flex';
            document.getElementById('feedback-page').textContent = gameState.currentSection;
        }

        function closeFeedback() {
            document.getElementById('feedback-modal').style.display = 'none';
            document.getElementById('feedback-text').value = '';
        }

        function sendFeedback() {
            const text = document.getElementById('feedback-text').value;
            if (!text) return;
            
            const subject = 'Control Systems Worksheet Feedback';
            const body = `Page: ${gameState.currentSection}\n\nFeedback: ${text}`;
            
            window.location.href = `mailto:millingtond@mgs.org?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            closeFeedback();
            awardXP(5, 'Feedback sent', 'feedback');
        }

        // Shame Message
        function showShameMessage() {
            const shame = document.getElementById('shame-message');
            shame.style.display = 'block';
            setTimeout(() => shame.style.display = 'none', 3000);
            
            // Lose XP for trying to paste
            gameState.xp = Math.max(0, gameState.xp - 10);
            updateXPDisplay();
        }

        // Accessibility
        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
            saveProgress();
        }

        function toggleDyslexiaFont() {
            if (document.body.style.fontFamily === 'OpenDyslexic, sans-serif') {
                document.body.style.fontFamily = '';
            } else {
                document.body.style.fontFamily = 'OpenDyslexic, sans-serif';
            }
            saveProgress();
        }

        function changeFontSize(size) {
            document.body.classList.remove('font-small', 'font-large', 'font-xlarge');
            if (size !== 'normal') {
                document.body.classList.add('font-' + size);
            }
            saveProgress();
        }

        // Save/Load Progress
        function saveProgress() {
            const data = {
                gameState: gameState,
                accessibility: {
                    highContrast: document.body.classList.contains('high-contrast'),
                    fontSize: Array.from(document.body.classList).find(c => c.startsWith('font-')) || 'normal'
                }
            };
            
            // Using sessionStorage instead of localStorage
            sessionStorage.setItem('controlSystemsProgress', JSON.stringify(data));
        }

        function loadProgress() {
            const saved = sessionStorage.getItem('controlSystemsProgress');
            if (saved) {
                const data = JSON.parse(saved);
                gameState = data.gameState;
                
                // Restore completed sections
                gameState.completedSections = new Set(gameState.completedSections);
                gameState.achievements = new Set(gameState.achievements);
                gameState.actionsPerformed = new Set(gameState.actionsPerformed);
                
                gameState.completedSections.forEach(section => {
                    document.querySelector(`[data-section="${section}"]`)?.classList.add('completed');
                });
                
                // Restore accessibility
                if (data.accessibility.highContrast) {
                    document.body.classList.add('high-contrast');
                }
                if (data.accessibility.fontSize !== 'normal') {
                    document.body.classList.add(data.accessibility.fontSize);
                }
                
                updateXPDisplay();
            }
        }

        // Auto-save
        setInterval(saveProgress, 30000);
    </script>
</body>
</html>