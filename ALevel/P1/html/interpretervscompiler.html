<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interpreter vs. Compiler: An Interactive Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-start: #1e3a8a; /*_blue-800*/
            --bg-end: #3b82f6; /*_blue-500*/
            --card-bg: rgba(255, 255, 255, 0.08);
            --border-color: rgba(255, 255, 255, 0.2);
            --text-primary: #f0f9ff; /*_sky-50*/
            --text-secondary: #bae6fd; /*_sky-200*/
            --accent-color: #38bdf8; /*_sky-400*/
            --accent-glow: rgba(56, 189, 248, 0.5);
            --success-color: #4ade80; /*_green-400*/
            --error-color: #f87171; /*_red-400*/
            --python-yellow: #ffde57;
            --python-blue: #4584b6;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
            color: var(--text-primary);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.25);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .btn {
            position: relative;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            background-color: var(--accent-color);
            color: white;
            font-weight: 600;
            border: none;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform: translateZ(0);
            will-change: transform, box-shadow;
        }

        .btn:before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px var(--accent-glow);
        }
        .btn:hover:not(:disabled):before { left: 100%; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-secondary { background: var(--card-bg); border: 1px solid var(--accent-color); }
        
        .scene {
            display: none; opacity: 0;
            transform: translateY(10px) scale(0.98);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
            will-change: opacity, transform;
            min-height: 450px;
        }
        .scene.active { display: flex; opacity: 1; transform: translateY(0) scale(1); }

        .code-block {
            font-family: 'SF Mono', 'Courier New', Courier, monospace;
            background: rgba(0, 0, 0, 0.4);
            padding: 1rem; border-radius: 0.5rem;
            border-left: 4px solid var(--accent-color);
        }
        .code-line {
            display: block; opacity: 0.6;
            transition: all 0.4s ease-in-out;
            padding: 0.1rem 0.5rem; border-radius: 0.25rem;
        }
        .code-line.highlight { opacity: 1; background-color: rgba(56, 189, 248, 0.2); }
        .code-line.error {
            background-color: rgba(248, 113, 113, 0.25);
            opacity: 1; box-shadow: 0 0 8px rgba(248, 113, 113, 0.5);
        }
        
        .modal-backdrop {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.6);
            display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
            z-index: 1000;
        }
        .modal-backdrop.visible { opacity: 1; visibility: visible; transition: opacity 0.3s ease; }
        .modal-content { transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .modal-backdrop.visible .modal-content { transform: scale(1); }
        
        .quiz-option { border: 2px solid var(--border-color); transition: all 0.2s ease; }
        .quiz-option:hover { border-color: var(--accent-color); background-color: rgba(56, 189, 248, 0.1); }
        .quiz-option.selected { border-color: var(--accent-color); background-color: rgba(56, 189, 248, 0.2); }
        .quiz-option.correct { border-color: var(--success-color) !important; background-color: rgba(74, 222, 128, 0.2) !important; }
        .quiz-option.incorrect { border-color: var(--error-color) !important; background-color: rgba(248, 113, 113, 0.2) !important; }
        
        .draggable { cursor: grab; touch-action: none; }
        .drop-zone { border: 2px dashed var(--border-color); min-height: 50px; transition: all 0.2s ease; }
        .drop-zone.over { background-color: rgba(56, 189, 248, 0.2); border-style: solid; }
        
        .flow-arrow { opacity: 0; transition: opacity 0.5s ease; }
        .pulse { animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 var(--accent-glow); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(56, 189, 248, 0); }
        }
        .bytecode-table { font-family: 'SF Mono', 'Courier New', monospace; font-size: 0.8rem; }
        .bytecode-table td { padding: 4px 8px; }
        .bytecode-table tr:nth-child(odd) { background-color: rgba(0,0,0,0.1); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <main id="simulation-container" class="card w-full max-w-6xl p-4 sm:p-8 space-y-6">
        <!-- Header -->
        <header class="text-center border-b border-[var(--border-color)] pb-4">
            <h1 class="text-3xl sm:text-4xl font-bold text-white tracking-tight">Interpreter vs. Compiler Simulation</h1>
            <p class="text-md text-sky-200 mt-2">An A-Level Guide to Program Translation (Cambridge 9618)</p>
        </header>

        <!-- Dynamic Content Area -->
        <div id="content-area" class="relative">
            <!-- SCENE 0: Welcome -->
            <section id="scene-0" class="scene active flex-col items-center justify-center text-center space-y-4">
                <h2 class="text-2xl font-bold text-white">How does a computer understand our code?</h2>
                <p class="max-w-2xl text-sky-200">This simulation will explore program translation, covering interpreters, compilers, and the hybrid approaches used by languages like Java and Python.</p>
                <p class="max-w-2xl text-sky-200">Click 'Next' or press the right arrow key to begin.</p>
            </section>
            
            <!-- SCENE 1: The Interpreter -->
            <section id="scene-1" class="scene flex-col lg:flex-row items-center justify-around gap-8">
                <div class="lg:w-1/2 space-y-4">
                    <h2 class="text-2xl font-bold text-sky-300">Step 1: The Pure Interpreter</h2>
                    <p class="text-sky-200">A pure interpreter translates and executes code one line at a time, directly, without a separate compilation step. This provides immediate feedback, which is great for debugging.</p>
                    <p id="interpreter-narration" class="text-white font-semibold min-h-[50px] bg-black/20 p-2 rounded-md"></p>
                    <button id="run-interpreter-btn" class="btn">Run Interpreter</button>
                </div>
                <div class="lg:w-1/2 w-full">
                     <div class="code-block">
                        <span class="code-line" id="line-1">1: <span class="text-purple-400">let</span> score = 0;</span>
                        <span class="code-line" id="line-2">2: <span class="text-purple-400">let</span> name = "Alex";</span>
                        <span class="code-line" id="line-3">3: <span class="text-blue-400">print</span>("Welcome, " + name);</span>
                        <span class="code-line" id="line-4">4: <span class="text-purple-400">let</span> bonus = "100";</span>
                        <span class="code-line" id="line-5">5: score = score + bonuss;</span>
                        <span class="code-line" id="line-6">6: <span class="text-blue-400">print</span>("Final Score: " + score);</span>
                    </div>
                </div>
            </section>
            
            <!-- SCENE 2: The Compiler -->
            <section id="scene-2" class="scene flex-col lg:flex-row items-center justify-around gap-8">
                 <div class="lg:w-1/2 space-y-4">
                    <h2 class="text-2xl font-bold text-sky-300">Step 2: The Pure Compiler</h2>
                    <p class="text-sky-200">A compiler translates the *entire* source code into a machine-code file (e.g., an executable) all at once. This file can then be run by the user without the compiler or original code.</p>
                    <p id="compiler-narration" class="text-white font-semibold min-h-[50px] bg-black/20 p-2 rounded-md"></p>
                    <button id="run-compiler-btn" class="btn">Run Compiler</button>
                </div>
                <div class="lg:w-1/2 w-full flex flex-col items-center justify-center space-y-4">
                    <div id="source-code-icon" class="text-center transition-all duration-500 ease-in-out">
                        <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                        <p>Source Code</p>
                    </div>
                    <div id="compiler-machine" class="text-4xl opacity-0 transition-opacity duration-500">‚öôÔ∏è</div>
                     <div id="exe-file-icon" class="text-center opacity-0 transition-transform duration-500 scale-50">
                        <svg class="w-16 h-16 mx-auto text-green-400" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M8.603 3.799A4.49 4.49 0 0112 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 013.498 1.307 4.491 4.491 0 011.307 3.497A4.49 4.49 0 0121.75 12a4.49 4.49 0 01-1.549 3.397 4.491 4.491 0 01-1.307 3.497 4.491 4.491 0 01-3.497 1.307A4.49 4.49 0 0112 21.75a4.49 4.49 0 01-3.397-1.549 4.49 4.49 0 01-3.498-1.306 4.491 4.491 0 01-1.307-3.498A4.49 4.49 0 012.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 011.307-3.497 4.49 4.49 0 013.497-1.307zm7.007 6.387a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" /></svg>
                        <p>program.exe</p>
                    </div>
                </div>
            </section>
            
            <!-- SCENE 3: Java's Two-Step Process -->
            <section id="scene-3" class="scene flex-col items-center justify-center gap-4">
                 <h2 class="text-2xl font-bold text-sky-300 text-center">Step 3: The Java Method (Hybrid Approach)</h2>
                 <p class="text-sky-200 text-center max-w-4xl mb-4">Java uses a two-step process. First, the source code is **compiled** into a machine-independent format called bytecode. Then, the Java Virtual Machine (JVM) **interprets** this bytecode to run the program.</p>
                 <div id="java-process-flow" class="w-full flex flex-col md:flex-row items-stretch justify-around space-y-4 md:space-y-0 md:space-x-4">
                    <div id="java-step1" class="text-center p-4 card w-full md:w-1/3 opacity-0 transition-all duration-500 ease-out flex flex-col" style="transform: translateY(20px);">
                        <p class="font-bold mb-2">MyProgram.java</p>
                        <svg class="w-16 h-16 mx-auto text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.373 3.373 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                        <p id="java-arrow1" class="text-2xl my-2 flow-arrow">‚Üì</p>
                        <div class="mt-auto">
                            <p class="font-bold">Java Compiler (javac)</p>
                            <p class="text-xs text-sky-300">(Compilation Step)</p>
                        </div>
                    </div>
                    <div id="java-step2" class="text-center p-4 card w-full md:w-1/3 opacity-0 transition-all duration-500 ease-out flex flex-col" style="transform: translateY(20px);">
                         <p class="font-bold mb-2">MyProgram.class</p>
                         <svg class="w-16 h-16 mx-auto text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                         <p class="mt-2 text-sm">Java Bytecode</p>
                         <p id="java-arrow2" class="text-2xl my-2 flow-arrow">‚Üì</p>
                    </div>
                    <div id="java-step3" class="text-center p-4 card w-full md:w-1/3 opacity-0 transition-all duration-500 ease-out flex flex-col" style="transform: translateY(20px);">
                        <p class="font-bold mb-2">Execution on any OS</p>
                        <div class="flex justify-around items-center my-auto">
                           <div class="text-center"><svg class="w-10 h-10 mx-auto" fill="currentColor" viewBox="0 0 20 20"><path d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm14 0H4v10h12V5z"></path></svg><p class="text-sm">Windows</p></div>
                           <div class="text-center"><svg class="w-10 h-10 mx-auto" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.208 2.017a.917.917 0 00-1.12.333A7.01 7.01 0 005.13 6.017c-2.14.99-3.64 2.49-3.64 4.15 0 2.873 3.42 4.117 3.42 4.117a.917.917 0 001.246-.775s.25-1.417.333-2.417c.167-2 .5-3.917.5-3.917a.917.917 0 00-.75-.917s-1.083-.25-1.083-1.5c0-1.167.75-1.417.75-1.417a.917.917 0 00.917-.917z" clip-rule="evenodd"></path><path d="M11.68 15.117c0-1.333.333-3.167.333-3.167a.917.917 0 00-1-1.083s-1.083-.167-1.083-1.5c0-1 .5-1.417.5-1.417a.917.917 0 00.75-1.083c-.083-.667-.25-1.333-.25-1.333a.917.917 0 00-1.25-.667C7.623 3.667 5.13 5.333 5.13 8.333c0 2.808 2.848 5.36 5.25 5.583a.917.917 0 00.967-.916.917.917 0 00-.667-.883z"></path></svg><p class="text-sm">macOS</p></div>
                           <div class="text-center"><svg class="w-10 h-10 mx-auto" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg><p class="text-sm">Linux</p></div>
                        </div>
                        <div class="mt-auto">
                            <p class="font-bold">Java Virtual Machine (JVM)</p>
                            <p class="text-xs text-sky-300">(Interpretation Step)</p>
                        </div>
                    </div>
                 </div>
            </section>

            <!-- SCENE 4: Python's Process -->
            <section id="scene-4" class="scene flex-col items-center justify-center gap-4">
                 <h2 class="text-2xl font-bold text-sky-300 text-center">Step 4: The Python Process (A Hybrid Model)</h2>
                 <p class="text-sky-200 text-center max-w-4xl mb-4">When you run a Python script, the interpreter **first compiles** your human-readable code into an optimized format called **bytecode**. This bytecode is then **interpreted** by the Python Virtual Machine (PVM) which executes the program.</p>
                 <div class="w-full grid md:grid-cols-2 gap-6 items-start">
                    <!-- Left Column: The Process Flow -->
                    <div id="python-process" class="flex flex-col space-y-4">
                        <div id="python-step1" class="text-center p-4 card opacity-0 transition-all duration-500 ease-out" style="transform: translateY(20px);">
                            <p class="font-bold mb-2">my_script.py (Source Code)</p>
                             <svg class="w-16 h-16 mx-auto" style="color: var(--python-blue)" fill="currentColor" viewBox="0 0 32 32"><path d="M31.3 10.4c-.5-3-2.1-5.1-4.3-6.8-2.9-2.2-6.4-3.1-9.9-3.1-3.2 0-6.6.9-9.9 3.1-2.2 1.7-3.8 3.8-4.3 6.8-.4 2.5-.2 5.3.6 7.9s2.4 4.8 4.3 6.5c3.2 2.5 6.9 3.4 10.5 3.1s7.1-.9 10.2-3.1c1.9-1.7 3.4-3.9 4.3-6.5.8-2.6 1-5.3.6-7.9zM15.1 8c.6 0 1.1.5 1.1 1.1v2.8h-2.2c-.6 0-1.1-.5-1.1-1.1V8.6C13 8.3 14.1 8 15.1 8zm-1.1 17.1c-.6 0-1.1-.5-1.1-1.1v-2.8h2.2c.6 0 1.1.5 1.1 1.1v2.2c-.1.3-1.2.6-2.2.6zm6.8-1.1c0 .6-.5 1.1-1.1 1.1h-2.8V19h2.2c.6 0 1.1.5 1.1 1.1v4zm-7.9-5.1h5.6c.6 0 1.1.5 1.1 1.1s-.5 1.1-1.1 1.1h-5.6c-.6 0-1.1-.5-1.1-1.1s.5-1.1 1.1-1.1zm.9-1.1c.5 0 .9-.3 1-.7l.9-2.2c.2-.4.1-.9-.3-1.2-.4-.3-.9-.4-1.2-.2l-2.2.9c-.4.2-.7.6-.7.9v2.2c0 .2.3.4.4.4zm11.1-1.1c0 .6-.5 1.1-1.1 1.1h-2.8v-4.6h2.2c.6 0 1.1.5 1.1 1.1v2.4z"/><path d="M16.9 8c-.6 0-1.1.5-1.1 1.1v2.8h2.2c.6 0 1.1-.5 1.1-1.1V8.6C19 8.3 17.9 8 16.9 8zM18 25.1c.6 0 1.1-.5 1.1-1.1v-2.8h-2.2c-.6 0-1.1.5-1.1 1.1v2.2c.1.3 1.2.6 2.2.6z"/><path d="M12.9 19.8c-.5 0-.9.3-1 .7l-.9 2.2c-.2.4-.1.9.3 1.2.4.3.9.4 1.2.2l2.2-.9c.4-.2.7-.6.7-.9v-2.2c0-.2-.3-.4-.4-.4z"/></svg>
                        </div>
                        <p id="python-arrow1" class="text-2xl my-2 flow-arrow text-center">‚Üì</p>
                        <div id="python-step2" class="text-center p-4 card opacity-0 transition-all duration-500 ease-out" style="transform: translateY(20px);">
                            <p class="font-bold">Python Virtual Machine (PVM) üêç</p>
                            <p class="text-xs text-sky-300">(Compilation to Bytecode, then Interpretation)</p>
                            <p id="python-arrow2" class="text-2xl my-2 flow-arrow text-center">‚Üì</p>
                            <p class="font-bold">Program Output</p>
                        </div>
                    </div>
                    <!-- Right Column: Bytecode Example -->
                    <div id="python-bytecode-example" class="p-4 card opacity-0 transition-all duration-500 ease-out delay-500" style="transform: translateY(20px);">
                        <h4 class="font-bold text-lg mb-2 text-center">Bytecode Example</h4>
                        <div class="code-block text-sm mb-4">
                            <span class="text-purple-400">def</span> <span class="text-green-400">add_numbers</span>(a, b):<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;c = a + b<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="text-purple-400">return</span> c
                        </div>
                        <p class="text-sky-200 mb-2">...is compiled into low-level bytecode instructions like this:</p>
                        <table class="bytecode-table w-full text-left">
                            <thead><tr class="border-b border-sky-600"><th class="w-1/2">Instruction</th><th>Meaning</th></tr></thead>
                            <tbody>
                                <tr><td>LOAD_FAST</td><td>Push variable 'a' onto the stack</td></tr>
                                <tr><td>LOAD_FAST</td><td>Push variable 'b' onto the stack</td></tr>
                                <tr><td>BINARY_ADD</td><td>Pop two items, add them, push result</td></tr>
                                <tr><td>STORE_FAST</td><td>Store result in variable 'c'</td></tr>
                                <tr><td>LOAD_FAST</td><td>Push 'c' onto the stack</td></tr>
                                <tr><td>RETURN_VALUE</td><td>Return the top of the stack</td></tr>
                            </tbody>
                        </table>
                    </div>
                 </div>
            </section>
            
            <!-- SCENE 5: Quiz -->
            <section id="scene-5" class="scene flex-col items-center justify-center space-y-4">
                 <h2 class="text-2xl font-bold text-sky-300">Knowledge Check</h2>
                 <div id="quiz-container" class="w-full max-w-4xl">
                    <!-- Quiz questions will be injected here by JS -->
                 </div>
                 <div id="quiz-results" class="hidden w-full max-w-3xl text-center card p-6">
                     <h3 class="text-2xl font-bold">Quiz Complete!</h3>
                     <p class="text-xl mt-2">Your score: <span id="final-score" class="font-bold text-green-400"></span></p>
                     <p id="score-feedback" class="mt-2 text-sky-200"></p>
                     <button id="reset-simulation-btn" class="btn mt-6">Restart Simulation</button>
                 </div>
            </section>
        </div>

        <!-- Navigation -->
        <footer id="navigation-footer" class="flex justify-between items-center pt-4 border-t border-[var(--border-color)]">
            <button id="prev-btn" class="btn btn-secondary">&larr; Previous</button>
            <div id="step-indicator" class="text-sky-300">Step 1 of 6</div>
            <button id="next-btn" class="btn">Next &rarr;</button>
        </footer>
    </main>
    
    <div id="modal-backdrop" class="modal-backdrop">
        <div id="modal-content" class="modal-content card max-w-lg w-full p-6 text-center space-y-4">
            <h3 id="modal-title" class="text-2xl font-bold"></h3>
            <p id="modal-text" class="text-sky-200"></p>
            <button id="modal-close-btn" class="btn">Got it!</button>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM Caching ---
    const scenes = document.querySelectorAll('.scene');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const stepIndicator = document.getElementById('step-indicator');
    const instructions = document.getElementById('instructions');
    const footer = document.getElementById('navigation-footer');
    const modalBackdrop = document.getElementById('modal-backdrop');
    const modalCloseBtn = document.getElementById('modal-close-btn');

    let currentScene = 0;
    let isTransitioning = false;
    const totalScenes = 6; // 0-4 for content, 5 for quiz

    // --- Core Navigation Logic ---
    const updateScene = (newSceneIndex) => {
        if (isTransitioning || newSceneIndex < 0 || newSceneIndex >= totalScenes) return;
        isTransitioning = true;
        
        scenes[currentScene]?.classList.remove('active');
        currentScene = newSceneIndex;
        scenes[currentScene]?.classList.add('active');
        
        setupScene(currentScene);
        updateUI();

        setTimeout(() => { isTransitioning = false; }, 500);
    };

    const updateUI = () => {
        if (stepIndicator) stepIndicator.textContent = `Step ${currentScene + 1} of ${totalScenes}`;
        if (prevBtn) prevBtn.disabled = currentScene === 0;
        
        const quizResults = document.getElementById('quiz-results');
        const quizResultsVisible = quizResults ? !quizResults.classList.contains('hidden') : false;

        if (footer) footer.style.display = quizResultsVisible ? 'none' : 'flex';
    };

    // --- Event Listeners ---
    nextBtn.addEventListener('click', () => updateScene(currentScene + 1));
    prevBtn.addEventListener('click', () => updateScene(currentScene - 1));
    document.addEventListener('keydown', (e) => {
        if (modalBackdrop.classList.contains('visible') || e.target.tagName === 'INPUT') return;
        if (e.key === 'ArrowRight' && footer.style.display !== 'none') nextBtn.click();
        if (e.key === 'ArrowLeft' && footer.style.display !== 'none') prevBtn.click();
    });

    // --- Modal Logic ---
    const showModal = (title, text, onCloseCallback = null) => {
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-text').innerHTML = text;
        modalBackdrop.classList.add('visible');
        modalCloseBtn.onclick = () => {
            modalBackdrop.classList.remove('visible');
            if (onCloseCallback) setTimeout(onCloseCallback, 100);
        };
    };

    // --- Scene-Specific Logic ---
    const setupScene = (sceneIndex) => {
        resetSceneStates();
        switch (sceneIndex) {
            case 1:
                showModal('The Pure Interpreter', 'A pure interpreter translates and executes code one line at a time. Click the <strong>"Run Interpreter"</strong> button to see it in action.', runInterpreterAnimation);
                break;
            case 2:
                showModal('The Pure Compiler', 'A compiler translates the entire source code into machine code at once. Click <strong>"Run Compiler"</strong> to start the process.', runCompilerAnimation);
                break;
            case 3:
                showModal("Java's Hybrid Approach", "Java **compiles** source code into an intermediate format called **Bytecode**. Then, a platform-specific **Java Virtual Machine (JVM)** **interprets** this bytecode.", runJavaAnimation);
                break;
            case 4:
                showModal("Python's Hybrid Model", "Python is also a hybrid. The interpreter **first compiles** your human-readable `.py` code into optimized **bytecode**. This bytecode is then **interpreted** by the **Python Virtual Machine (PVM)**.", runPythonAnimation);
                break;
            case 5: // Quiz is now scene 5
                buildQuiz();
                break;
        }
    };
    
    const resetSceneStates = () => {
        // Shared resets
        document.querySelectorAll('.scene').forEach(s => {
            s.querySelectorAll('.opacity-0').forEach(el => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(20px)';
            });
            s.querySelectorAll('.flow-arrow').forEach(el => el.style.opacity = '0');
        });
        
        // Scene 1 & 2
        document.querySelectorAll('.code-line').forEach(line => line.classList.remove('highlight', 'error'));
        document.getElementById('interpreter-narration').textContent = '';
        document.getElementById('run-interpreter-btn').disabled = false;
        const sourceCodeIcon = document.getElementById('source-code-icon');
        sourceCodeIcon.style.transform = 'translateY(0px)';
        sourceCodeIcon.style.opacity = '1';
        const compilerMachine = document.getElementById('compiler-machine');
        compilerMachine.style.opacity = '0';
        compilerMachine.classList.remove('pulse');
        document.getElementById('exe-file-icon').style.opacity = '0';
        document.getElementById('exe-file-icon').style.transform = 'scale(0.5)';
        document.getElementById('compiler-narration').textContent = '';
        document.getElementById('run-compiler-btn').disabled = false;

        // Scene 5 (Quiz)
        const quizContainer = document.getElementById('quiz-container');
        quizContainer.innerHTML = '';
        quizContainer.classList.remove('hidden');
        quizContainer.style.pointerEvents = 'auto';
        document.getElementById('quiz-results').classList.add('hidden');
    };
    
    // --- Animation Functions ---
    const runJavaAnimation = () => {
        const step1 = document.getElementById('java-step1');
        const step2 = document.getElementById('java-step2');
        const step3 = document.getElementById('java-step3');
        
        setTimeout(() => { step1.style.opacity = '1'; step1.style.transform = 'translateY(0)'; }, 300);
        setTimeout(() => document.getElementById('java-arrow1').style.opacity = '1', 600);
        setTimeout(() => { step2.style.opacity = '1'; step2.style.transform = 'translateY(0)'; }, 900);
        setTimeout(() => document.getElementById('java-arrow2').style.opacity = '1', 1200);
        setTimeout(() => { step3.style.opacity = '1'; step3.style.transform = 'translateY(0)'; }, 1500);
    };

    const runPythonAnimation = () => {
        const step1 = document.getElementById('python-step1');
        const step2 = document.getElementById('python-step2');
        const bytecodeExample = document.getElementById('python-bytecode-example');
        
        setTimeout(() => { step1.style.opacity = '1'; step1.style.transform = 'translateY(0)'; }, 300);
        setTimeout(() => document.getElementById('python-arrow1').style.opacity = '1', 600);
        setTimeout(() => { step2.style.opacity = '1'; step2.style.transform = 'translateY(0)'; }, 900);
        setTimeout(() => { bytecodeExample.style.opacity = '1'; bytecodeExample.style.transform = 'translateY(0)'; }, 1200);
    };

    // --- QUIZ LOGIC ---
    const quizData = [
        { question: "Which translator is best for development due to its immediate, line-by-line error reporting?", type: "mcq", options: ["Compiler", "Assembler", "Interpreter", "Linker"], answer: "Interpreter" },
        { question: "A key advantage of compilation for commercial software is that the program can be distributed without the...", type: "mcq", options: ["Executable file", "Source code", "Operating system", "Compiler"], answer: "Source code" },
        { question: "The ability to compile code on one type of machine (e.g., Windows) to run on another (e.g., Linux) is called:", type: "mcq", options: ["Decompilation", "Re-interpretation", "Cross-compilation", "Virtualisation"], answer: "Cross-compilation" },
        { question: "True or False: A Java program is translated in a single step directly to machine code by the compiler.", type: "true-false", answer: "False" },
        { question: "What is the name of the machine-independent intermediate code produced by the Java compiler?", type: "text", answer: "bytecode" },
        { question: "Like Java, Python uses an intermediate form for optimization before execution. What is this Python intermediate code also called?", type: "text", answer: "bytecode"},
        { question: "What concept allows Java and Python programs to be written once and run on any platform with the correct virtual machine?", type: "text", answer: "machine independence" },
        { question: "Java was specifically designed to create applications, particularly for multimedia, to be used over the...", type: "mcq", options: ["Mainframe", "Standalone PC", "Internet", "Supercomputer"], answer: "Internet" },
        { question: "Sort these characteristics by translator type.", type: "drag-drop-characteristics", categories: { "Interpreter": [], "Compiler": [] }, characteristics: { "Used during development": "Interpreter", "Produces an executable (.exe) file": "Compiler", "Reports all errors after checking the whole program": "Compiler", "Easier for debugging": "Interpreter", "Used for final distribution of software": "Compiler", "Stops execution as soon as an error is found": "Interpreter" } }
    ];
    let userAnswers = {};
    let draggedItem = null;

    const buildQuiz = () => {
        const container = document.getElementById('quiz-container');
        container.innerHTML = '';
        quizData.forEach((q, index) => {
            const questionEl = document.createElement('div');
            questionEl.className = 'card p-6 mb-4';
            let content = `<p class="font-bold mb-4">${index + 1}. ${q.question}</p>`;

            if (q.type === 'mcq') {
                content += `<div class="space-y-2" data-question-index="${index}">${q.options.map(opt => `<div class="quiz-option p-3 rounded-lg cursor-pointer">${opt}</div>`).join('')}</div>`;
            } else if (q.type === 'true-false') {
                 content += `<div class="space-y-2" data-question-index="${index}"><div class="quiz-option p-3 rounded-lg cursor-pointer">True</div><div class="quiz-option p-3 rounded-lg cursor-pointer">False</div></div>`;
            } else if (q.type === 'text') {
                content += `<input type="text" data-question-index="${index}" class="text-input w-full p-2 rounded bg-gray-700/50 border-2 border-transparent focus:border-[var(--accent-color)] focus:bg-gray-700 outline-none transition-all" placeholder="Type your answer here...">`;
            } else if (q.type === 'drag-drop-characteristics') {
                 const characteristics = Object.keys(q.characteristics).sort(() => Math.random() - 0.5);
                 content += `<div class="flex flex-col lg:flex-row gap-4" data-question-index="${index}">
                    <div class="w-full lg:w-1/3 space-y-2 p-2 rounded-lg border-2 border-dashed border-gray-600">
                         <p class="font-semibold text-sky-300 text-center">Characteristics</p>
                         ${characteristics.map(char => `<div class="draggable p-2 card bg-blue-900/50 text-center" draggable="true" id="char-${index}-${char.replace(/\s/g,'')}">${char}</div>`).join('')}
                    </div>
                    <div class="w-full lg:w-2/3 flex flex-col md:flex-row gap-4">
                        <div class="w-full p-2 rounded-lg bg-black/20"><h4 class="font-bold text-center mb-2">Interpreter</h4><div class="drop-zone min-h-[150px] space-y-2 p-2 rounded-md" data-category="Interpreter"></div></div>
                        <div class="w-full p-2 rounded-lg bg-black/20"><h4 class="font-bold text-center mb-2">Compiler</h4><div class="drop-zone min-h-[150px] space-y-2 p-2 rounded-md" data-category="Compiler"></div></div>
                    </div>
                </div>`;
            }
            questionEl.innerHTML = content;
            container.appendChild(questionEl);
        });

        const markButton = document.createElement('button');
        markButton.id = 'mark-quiz-btn';
        markButton.className = 'btn block mx-auto mt-6';
        markButton.textContent = 'Mark My Answers';
        container.appendChild(markButton);
        
        container.addEventListener('click', handleQuizInteraction);
        setupDragDrop();
    };
    
    const handleQuizInteraction = (e) => {
        if (e.target.classList.contains('quiz-option')) {
            const parent = e.target.parentElement;
            userAnswers[parent.dataset.questionIndex] = e.target.textContent;
            Array.from(parent.children).forEach(child => child.classList.remove('selected'));
            e.target.classList.add('selected');
        }
        if(e.target.id === 'mark-quiz-btn') {
            markQuiz();
        }
    };

    const markQuiz = () => {
        let score = 0;
        document.querySelectorAll('#quiz-container .text-input').forEach(input => {
             if (input.value.length > 1) userAnswers[input.dataset.questionIndex] = input.value;
        });
        document.getElementById('quiz-container').style.pointerEvents = 'none';

        quizData.forEach((q, index) => {
            const questionEl = document.querySelector(`[data-question-index="${index}"]`);
            let isCorrect = false;
            if (q.type === 'mcq' || q.type === 'true-false') {
                const selectedOption = questionEl?.querySelector('.selected');
                if (selectedOption) {
                    isCorrect = selectedOption.textContent === q.answer;
                    selectedOption.classList.add(isCorrect ? 'correct' : 'incorrect');
                    if (!isCorrect) {
                        const correctEl = Array.from(questionEl.children).find(opt => opt.textContent === q.answer);
                        correctEl?.classList.add('correct');
                    }
                }
            } else if (q.type === 'text') {
                const inputEl = document.querySelector(`input[data-question-index="${index}"]`);
                isCorrect = userAnswers[index] && userAnswers[index].toLowerCase().trim().replace(/\s/g, "") === q.answer.toLowerCase().replace(/\s/g, "");
                inputEl.classList.add(isCorrect ? 'border-green-400' : 'border-red-400');
                if (!isCorrect) {
                    const hint = document.createElement('p');
                    hint.className = 'text-green-400 text-sm mt-1';
                    hint.textContent = `Correct answer: ${q.answer}`;
                    inputEl.parentElement.appendChild(hint);
                }
            } else if (q.type === 'drag-drop-characteristics') {
                let correctDrops = 0;
                let totalCharacteristics = 0;
                Object.keys(q.categories).forEach(category => {
                    const zone = questionEl.querySelector(`.drop-zone[data-category="${category}"]`);
                    const droppedItems = zone.querySelectorAll('.draggable');
                    droppedItems.forEach(item => {
                        totalCharacteristics++;
                        const charText = item.textContent;
                        if(q.characteristics[charText] === category){
                            correctDrops++;
                            item.classList.add('bg-green-500/30', 'border', 'border-green-500');
                        } else {
                            item.classList.add('bg-red-500/30', 'border', 'border-red-500');
                        }
                    });
                });
                isCorrect = correctDrops === Object.keys(q.characteristics).length && totalCharacteristics === Object.keys(q.characteristics).length;
            }
            if(isCorrect) score++;
        });

        setTimeout(() => {
            document.getElementById('quiz-container').classList.add('hidden');
            const resultsEl = document.getElementById('quiz-results');
            resultsEl.classList.remove('hidden');
            document.getElementById('final-score').textContent = `${score} / ${quizData.length}`;
            updateUI(); 
            const percentage = (score / quizData.length) * 100;
            const scoreFeedback = document.getElementById('score-feedback');
            if (percentage === 100) scoreFeedback.textContent = "Perfect! You've mastered these concepts.";
            else if (percentage >= 75) scoreFeedback.textContent = "Excellent work! A very strong understanding.";
            else if (percentage >= 50) scoreFeedback.textContent = "Good effort. Review the scenes to clarify any uncertain points.";
            else scoreFeedback.textContent = "You're on the right track. It might be helpful to go through the simulation again.";
        }, 1500);
    };

    document.getElementById('reset-simulation-btn').addEventListener('click', () => {
        userAnswers = {};
        updateScene(0);
    });

    // --- Unchanged Animation & Helper Functions ---
    const runInterpreterAnimation = () => {
        const runBtn = document.getElementById('run-interpreter-btn');
        if (runBtn.disabled) return;
        runBtn.disabled = true;
        const lines = document.querySelectorAll('.code-line');
        const narration = document.getElementById('interpreter-narration');
        let currentLine = 0;
        const speed = 800;
        const processLine = () => {
            if (currentLine > 0) lines[currentLine - 1].classList.remove('highlight');
            if (currentLine >= lines.length) return;
            const lineEl = lines[currentLine];
            lineEl.classList.add('highlight');
            narration.textContent = `Executing line ${currentLine + 1}...`;
            if (currentLine === 4) {
                setTimeout(() => {
                    lineEl.classList.add('error');
                    narration.textContent = `ERROR on line 5: Variable 'bonuss' is not defined.`;
                    showModal('Interpreter Found an Error!',"The interpreter stopped as soon as it hit an error...");
                }, speed);
                return;
            }
            currentLine++;
            setTimeout(processLine, speed);
        };
        processLine();
    };
    const runCompilerAnimation = () => {
        const runBtn = document.getElementById('run-compiler-btn');
        if (runBtn.disabled) return;
        runBtn.disabled = true;
        const sourceCode = document.getElementById('source-code-icon');
        const compiler = document.getElementById('compiler-machine');
        const exeFile = document.getElementById('exe-file-icon');
        const narration = document.getElementById('compiler-narration');
        narration.textContent = "Compiler is reading the entire source code...";
        setTimeout(() => sourceCode.style.transform = 'translateY(50px) scale(0.8)', 500);
        setTimeout(() => compiler.style.opacity = '1', 1000);
        setTimeout(() => {
            narration.textContent = "Translating all code into a single executable file...";
            compiler.classList.add('pulse');
        }, 1500);
        setTimeout(() => {
            sourceCode.style.opacity = '0';
            compiler.classList.remove('pulse');
        }, 3500);
        setTimeout(() => {
            narration.textContent = "Compilation successful! Executable created.";
            exeFile.style.opacity = '1';
            exeFile.style.transform = 'scale(1)';
            showModal('Compilation Complete!',"The compiler has created a single <strong>program.exe</strong> file...");
        }, 4000);
    };
    function setupDragDrop() {
        const draggables = document.querySelectorAll('.draggable');
        const dropZones = document.querySelectorAll('.drop-zone');
        draggables.forEach(draggable => {
            draggable.addEventListener('dragstart', (e) => {
                draggedItem = e.target;
                setTimeout(() => e.target.style.opacity = '0.5', 0);
            });
            draggable.addEventListener('dragend', (e) => {
                setTimeout(() => {
                    if (draggedItem) draggedItem.style.opacity = '1';
                    draggedItem = null;
                }, 0);
            });
        });
        dropZones.forEach(zone => {
            zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('over'); });
            zone.addEventListener('dragleave', () => zone.classList.remove('over'));
            zone.addEventListener('drop', e => {
                e.preventDefault();
                zone.classList.remove('over');
                if (draggedItem) zone.appendChild(draggedItem);
            });
        });
    }

    // Initial setup
    updateUI();
    setupScene(0);
    document.getElementById('run-interpreter-btn').addEventListener('click', runInterpreterAnimation);
    document.getElementById('run-compiler-btn').addEventListener('click', runCompilerAnimation);
});
</script>

</body>
</html>
