<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBMS Security Measures Simulation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f0f4f8;
            --text-color: #1e293b;
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --card-bg: rgba(255, 255, 255, 0.6);
            --border-color: rgba(203, 213, 225, 0.5);
            --glass-bg: rgba(255, 255, 255, 0.4);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
            --shadow-light: 0 4px 12px 0 rgba(31, 38, 135, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
        }
        
        /* Visual Polish: Glassmorphism and Shadows */
        .glassmorphism {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }

        .animated-gradient {
            background: linear-gradient(-45deg, #4f46e5, #ec4899, #22d3ee, #3b82f6);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Performance: Smooth animations and transitions */
        .step-content {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
            will-change: opacity, transform; /* GPU Acceleration Hint */
        }

        .step-content.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .btn-primary {
            transition: all 0.3s cubic-bezier(.25,.8,.25,1);
            position: relative;
            overflow: hidden;
            transform: translateZ(0); /* GPU Acceleration Hint */
            box-shadow: var(--shadow-light);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Visual Polish: Ripple effect on button click */
        .btn-primary:after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px; height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%, -50%);
            transform-origin: 50% 50%;
        }

        .btn-primary:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% { transform: scale(0, 0); opacity: 1; }
            20% { transform: scale(25, 25); opacity: 1; }
            100% { opacity: 0; transform: scale(40, 40); }
        }

        .progress-bar-fill {
            transition: width 0.5s cubic-bezier(.25,.8,.25,1);
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
        }

        .quiz-option {
            transition: all 0.2s ease-in-out;
        }
        .quiz-option:hover:not(:disabled) {
             transform: translateX(5px);
             border-color: var(--primary-color);
        }
        .quiz-option.correct {
            background-color: #10B981; color: white; border-color: #059669;
        }
        .quiz-option.incorrect {
            background-color: #EF4444; color: white; border-color: #DC2626;
        }
        
        /* Performance & Visual Polish: Modal animation */
        #modal {
            transition: opacity 0.3s ease;
        }
        #modal-content {
            transition: transform 0.3s cubic-bezier(.25,.8,.25,1);
            transform: translateY(-50px) scale(0.95);
        }
        #modal.active #modal-content {
             transform: translateY(0) scale(1);
        }

        /* Accessibility: Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body class="w-full h-screen flex flex-col items-center justify-center p-4 animated-gradient">

    <div id="simulation-container" class="w-full max-w-5xl h-full bg-white rounded-2xl flex flex-col overflow-hidden relative glassmorphism">

        <!-- Header -->
        <header class="w-full p-4 flex justify-between items-center border-b border-gray-200/50">
            <h1 class="text-xl md:text-2xl font-bold text-gray-800">DBMS Security Measures Simulation</h1>
            <button id="reset-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg btn-primary">Reset</button>
        </header>

        <!-- Main Content -->
        <main id="main-content" class="flex-grow p-6 overflow-y-auto relative">

            <!-- Step 0: Introduction -->
            <div id="step-0" class="step-content active text-center">
                <h2 class="text-3xl font-bold mb-4 text-primary-color">Welcome!</h2>
                <p class="mb-6 text-lg max-w-3xl mx-auto">This simulation guides you through the essential security measures for Database Management Systems (DBMS), aligned with the A-Level syllabus.</p>
                <p class="mb-8 text-md">Use the <span class="font-bold text-primary-color">"Next Step"</span> & <span class="font-bold text-primary-color">"Previous Step"</span> buttons or your <span class="font-bold text-primary-color">Arrow Keys</span> to navigate.</p>
                <button id="start-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg text-lg btn-primary">Start Learning</button>
            </div>
            
            <!-- Step 1: Usernames & Passwords -->
            <div id="step-1" class="step-content">
                <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 8a6 6 0 11-12 0 6 6 0 0112 0zM7 8a1 1 0 11-2 0 1 1 0 012 0zm5 0a1 1 0 11-2 0 1 1 0 012 0z" clip-rule="evenodd" /><path d="M5.5 13.5A3.5 3.5 0 019 10h2a3.5 3.5 0 013.5 3.5v.5a.5.5 0 01-1 0v-.5a2.5 2.5 0 00-2.5-2.5h-2A2.5 2.5 0 006.5 14v.5a.5.5 0 01-1 0v-.5z" /></svg>
                    1. Usernames & Passwords
                </h2>
                <p class="mb-6">The first line of defense is <span class="font-bold">authentication</span>. A unique username and a strong password ensure only authorized individuals can access the system.</p>
                <div class="flex justify-center items-center p-8 bg-gray-100 rounded-xl">
                    <div class="w-full max-w-sm p-6 bg-white rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold text-center mb-4">Database Login</h3>
                        <input id="username-input" type="text" placeholder="Username: admin" class="w-full p-2 mb-3 border rounded-md focus:ring-2 focus:ring-blue-400 outline-none">
                        <input id="password-input" type="password" placeholder="Password: Pa$$w0rd!" class="w-full p-2 mb-4 border rounded-md focus:ring-2 focus:ring-blue-400 outline-none">
                        <button id="login-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md btn-primary">Log In</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Access Rights / Privileges -->
            <div id="step-2" class="step-content">
                <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015.5-4.93a6.97 6.97 0 00-1.5-4.33A5 5 0 011 16v1h6.07z" /></svg>
                    2. Access Rights & Privileges
                </h2>
                <p class="mb-6">Not all users need access to all data. <span class="font-bold">Access privileges</span> restrict what users can see and do, following the principle of least privilege.</p>
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="flex-1">
                        <h3 class="text-lg font-semibold mb-2 text-center">Select User to Simulate:</h3>
                        <div id="user-selector" class="flex justify-center flex-wrap gap-4 mb-4">
                            <button data-user="clerk" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg btn-primary">Sales Clerk</button>
                            <button data-user="manager" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg btn-primary">Manager</button>
                            <button data-user="admin" class="bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4 rounded-lg btn-primary">DB Admin</button>
                        </div>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-semibold mb-2 text-center">User View: <span id="user-view-name" class="font-bold text-blue-600">None</span></h3>
                        <div id="db-view" class="p-4 bg-gray-100 rounded-xl min-h-[200px]">
                            <p id="db-placeholder" class="text-center text-gray-500 p-8">Select a user to see their access rights.</p>
                            <table id="clerk-table" class="hidden w-full text-left db-table">
                                <thead><tr><th class="p-2 bg-blue-200">Product</th><th class="p-2 bg-blue-200">Stock</th></tr></thead>
                                <tbody><tr><td class="p-2 border">Laptop</td><td class="p-2 border">50</td></tr><tr><td class="p-2 border">Mouse</td><td class="p-2 border">200</td></tr></tbody>
                            </table>
                            <table id="manager-table" class="hidden w-full text-left db-table">
                                <thead><tr><th class="p-2 bg-purple-200">Product</th><th class="p-2 bg-purple-200">Stock</th><th class="p-2 bg-purple-200">Cost Price</th></tr></thead>
                                <tbody><tr><td class="p-2 border">Laptop</td><td class="p-2 border">50</td><td class="p-2 border">$800</td></tr><tr><td class="p-2 border">Mouse</td><td class="p-2 border">200</td><td class="p-2 border">$15</td></tr></tbody>
                            </table>
                             <table id="admin-table" class="hidden w-full text-left db-table">
                                <thead><tr><th class="p-2 bg-gray-300">User</th><th class="p-2 bg-gray-300">Access Level</th><th class="p-2 bg-gray-300">Permissions</th></tr></thead>
                                <tbody><tr><td class="p-2 border">clerk</td><td class="p-2 border">User</td><td class="p-2 border">READ_ONLY</td></tr><tr><td class="p-2 border">manager</td><td class="p-2 border">Manager</td><td class="p-2 border">READ/WRITE</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Regular Backups -->
            <div id="step-3" class="step-content">
                 <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M4 3a2 2 0 100 4h12a2 2 0 100-4H4z" /><path fill-rule="evenodd" d="M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd" /></svg>
                    3. Regular Backups
                </h2>
                <p class="mb-6">Data can be lost. Regular, scheduled backups create copies of the database, which can be used to <span class="font-bold">restore</span> the system after an incident.</p>
                <div class="flex justify-around items-center gap-4 relative">
                     <div class="text-center z-10">
                        <svg class="w-24 h-24 mx-auto text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg>
                        <p class="font-semibold mt-2">Live Database</p>
                        <p id="live-data-status" class="text-green-600 font-bold transition-colors">OK</p>
                    </div>
                     <div class="text-center z-10">
                        <svg class="w-24 h-24 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path></svg>
                        <p class="font-semibold mt-2">Backup Storage</p>
                        <p id="backup-status" class="text-gray-500 transition-colors">Empty</p>
                    </div>
                </div>
                <div class="text-center mt-8">
                    <button id="backup-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg btn-primary">Create Backup</button>
                    <button id="disaster-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg btn-primary" disabled>Simulate Disaster</button>
                    <button id="restore-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg btn-primary" disabled>Restore Data</button>
                </div>
            </div>

            <!-- Step 4: Encryption -->
            <div id="step-4" class="step-content">
                 <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 1.944A11.954 11.954 0 012.166 5C2.056 5.649 2 6.319 2 7c0 5.225 3.34 9.67 8 11.317C14.66 16.67 18 12.225 18 7c0-.682-.057-1.35-.166-2.001A11.954 11.954 0 0110 1.944zM11 14a1 1 0 11-2 0 1 1 0 012 0zm0-7a1 1 0 10-2 0v3a1 1 0 102 0V7z" clip-rule="evenodd" /></svg>
                    4. Data Encryption
                </h2>
                 <p class="mb-6">Encryption scrambles data into unreadable <span class="font-bold">ciphertext</span>. Even if an attacker steals the data, it's useless without the secret decryption key.</p>
                <div class="p-6 bg-gray-100 rounded-xl">
                    <div class="flex flex-col md:flex-row items-center justify-around gap-4">
                        <div class="w-full md:w-2/5">
                            <label class="block font-semibold mb-2">Original Data (Plaintext):</label>
                            <p id="encryption-text" class="w-full p-3 bg-white rounded-md h-24 font-mono text-sm">user: admin, pass: P@ssw0rd!</p>
                        </div>
                        <div class="text-3xl font-bold text-gray-500">&harr;</div>
                        <div class="w-full md:w-2/5">
                             <label class="block font-semibold mb-2">Encrypted Data (Ciphertext):</label>
                            <p id="ciphertext" class="w-full p-3 bg-white rounded-md h-24 break-all text-sm font-mono"></p>
                        </div>
                    </div>
                    <div class="text-center mt-6">
                        <button id="encrypt-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg btn-primary">Encrypt</button>
                        <button id="decrypt-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg btn-primary" disabled>Decrypt</button>
                    </div>
                </div>
            </div>

            <!-- Step 5: Different Views -->
            <div id="step-5" class="step-content">
                <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /><path fill-rule="evenodd" d="M.458 10C3.732 4.943 7.523 3 10 3s6.268 1.943 9.542 7c-3.274 5.057-7.064 7-9.542 7S3.732 15.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" /></svg>
                    5. Different Views of Data
                </h2>
                <p class="mb-6">A <span class="font-bold">view</span> is a virtual table based on a query. It's a security layer that limits user access to specific rows and columns from underlying tables.</p>
                 <div class="flex flex-col lg:flex-row gap-4 justify-center items-start">
                    <div class="text-center p-2 bg-white/50 rounded-lg">
                        <h3 class="font-semibold mb-2">Base Table: Employees</h3>
                        <table class="db-table text-sm shadow-md">
                           <thead><tr class="bg-gray-200"><th class="p-2">ID</th><th class="p-2">Name</th><th class="p-2">Role</th><th class="p-2">Salary</th></tr></thead>
                           <tbody class="bg-white"><tr><td class="p-2 border">1</td><td class="p-2 border">A. Smith</td><td class="p-2 border">Manager</td><td class="p-2 border">$90,000</td></tr><tr><td class="p-2 border">2</td><td class="p-2 border">B. Jones</td><td class="p-2 border">Sales</td><td class="p-2 border">$55,000</td></tr></tbody>
                        </table>
                    </div>
                    <div class="text-center p-2 bg-white/50 rounded-lg">
                         <h3 class="font-semibold mb-2">Base Table: Personal Info</h3>
                         <table class="db-table text-sm shadow-md">
                           <thead><tr class="bg-gray-200"><th class="p-2">ID</th><th class="p-2">Address</th><th class="p-2">Phone</th></tr></thead>
                           <tbody class="bg-white"><tr><td class="p-2 border">1</td><td class="p-2 border">123 Main St</td><td class="p-2 border">555-1111</td></tr><tr><td class="p-2 border">2</td><td class="p-2 border">456 Oak Ave</td><td class="p-2 border">555-2222</td></tr></tbody>
                        </table>
                    </div>
                    <div id="view-creation" class="text-center lg:pl-6 pt-4 lg:pt-0">
                         <h3 class="font-semibold mb-2">Result: `SalesStaff` View</h3>
                         <div id="view-result-table" class="opacity-0 transition-opacity duration-1000 p-2 bg-white/50 rounded-lg inline-block">
                             <table class="db-table text-sm shadow-md">
                               <thead><tr class="bg-blue-200"><th class="p-2">Name</th><th class="p-2">Phone</th></tr></thead>
                               <tbody class="bg-white"><tr><td class="p-2 border">B. Jones</td><td class="p-2 border">555-2222</td></tr></tbody>
                            </table>
                         </div>
                         <button id="create-view-btn" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg btn-primary">Create View</button>
                    </div>
                </div>
            </div>

            <!-- Step 6: Usage Monitoring -->
            <div id="step-6" class="step-content">
                 <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V4a2 2 0 00-2-2H6zm1 2a1 1 0 000 2h6a1 1 0 100-2H7zm6 4a1 1 0 011 1v4a1 1 0 11-2 0v-4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                    6. Usage Monitoring
                </h2>
                <p class="mb-6">Databases can create an <span class="font-bold">audit log</span> that records all operations. This is crucial for tracking unauthorized activity and maintaining compliance.</p>
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="flex-1">
                        <h3 class="text-lg font-semibold mb-2 text-center">Perform an Action:</h3>
                        <div id="log-action-container" class="flex flex-col items-center gap-3">
                            <button data-action="LOGIN" class="w-48 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg btn-primary log-action-btn">User Login</button>
                            <button data-action="QUERY" class="w-48 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg btn-primary log-action-btn">Run Query</button>
                            <button data-action="UPDATE" class="w-48 bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded-lg btn-primary log-action-btn">Update Record</button>
                             <button data-action="DELETE_FAIL" class="w-48 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg btn-primary log-action-btn">Failed Delete</button>
                        </div>
                    </div>
                    <div class="flex-1">
                         <h3 class="text-lg font-semibold mb-2 text-center">Activity Log</h3>
                         <div id="activity-log" class="p-4 bg-gray-800 text-white font-mono text-xs rounded-xl h-48 overflow-y-auto shadow-inner">
                            <p class="text-gray-400">[SYSTEM] Logging service started...</p>
                         </div>
                    </div>
                </div>
            </div>

            <!-- Step 7: Quiz -->
            <div id="step-7" class="step-content">
                <h2 class="text-2xl font-bold mb-4 text-primary-color flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
                    Quiz: Test Your Knowledge
                </h2>
                <p class="mb-6">Answer the following questions to check your understanding.</p>
                
                <div id="quiz-container" class="space-y-8">
                    <!-- Questions will be dynamically inserted here -->
                </div>

                <!-- Quiz Results -->
                <div id="quiz-results" class="hidden text-center mt-8 p-6 bg-blue-50 rounded-lg">
                    <h3 class="text-2xl font-bold">Quiz Complete!</h3>
                    <p class="text-xl mt-2">Your score: <span id="score" class="font-bold text-primary-color">0</span> / <span id="total-score">0</span></p>
                    <button id="reset-quiz-btn" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg btn-primary">Try Again</button>
                </div>
            </div>
            
        </main>

        <!-- Footer / Navigation -->
        <footer class="w-full p-4 border-t border-gray-200/50 mt-auto">
            <div class="flex justify-between items-center">
                <button id="prev-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg btn-primary disabled:opacity-50 disabled:cursor-not-allowed">Previous Step</button>
                <div class="flex-grow mx-4">
                    <div class="w-full bg-gray-200 rounded-full h-2.5 shadow-inner">
                        <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full progress-bar-fill"></div>
                    </div>
                </div>
                <button id="next-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg btn-primary">Next Step</button>
            </div>
        </footer>
    </div>
    
    <!-- Modal for Popups -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center p-4 z-50 opacity-0 pointer-events-none">
        <div id="modal-content" class="glassmorphism rounded-2xl p-8 w-full max-w-md text-center text-gray-800 relative">
             <p id="modal-text" class="text-lg"></p>
             <button id="modal-close-btn" class="mt-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg btn-primary">OK</button>
        </div>
    </div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- Caching frequently accessed DOM elements for performance ---
        const DOMElements = {
            mainContent: document.getElementById('main-content'),
            startBtn: document.getElementById('start-btn'),
            prevBtn: document.getElementById('prev-btn'),
            nextBtn: document.getElementById('next-btn'),
            resetBtn: document.getElementById('reset-btn'),
            progressBar: document.getElementById('progress-bar'),
            stepContents: document.querySelectorAll('.step-content'),
            modal: document.getElementById('modal'),
            modalText: document.getElementById('modal-text'),
            modalCloseBtn: document.getElementById('modal-close-btn'),
            quizContainer: document.getElementById('quiz-container'),
            resetQuizBtn: document.getElementById('reset-quiz-btn'),
        };

        // --- State Management ---
        let state = {
            currentStep: 0,
            totalSteps: DOMElements.stepContents.length - 1,
            animationsPaused: false,
            quizState: {},
        };
        
        const quizData = [
            {
                question: "Which security measure is primarily designed to turn sensitive data into an unreadable format?",
                type: 'mcq',
                options: ["Access Privileges", "Regular Backups", "Encryption", "Usage Monitoring"],
                answer: "Encryption"
            },
            {
                question: "A sales clerk should only see product names and stock, but not cost price. Which feature achieves this?",
                type: 'mcq',
                options: ["Creating a separate database", "Encrypting the cost price column", "Setting specific access rights or a data view", "Deleting the cost price data"],
                answer: "Setting specific access rights or a data view"
            },
            {
                question: "Fill in the blank: An __________ log tracks operations performed by users, which is essential for auditing.",
                type: 'fill',
                answer: "activity"
            },
            {
                question: "A company wants to protect against data loss from a server fire. Describe the most appropriate security measure and why it is effective.",
                type: 'text',
                answerKeywords: ["backup", "copy", "restore", "lost", "damage"]
            }
        ];


        // --- Navigation ---
        function navigate(step) {
            if (step < 0 || step > state.totalSteps) return;
            
            DOMElements.stepContents[state.currentStep].classList.remove('active');
            state.currentStep = step;
            DOMElements.stepContents[state.currentStep].classList.add('active');
            
            updateNavigation();
        }

        function updateNavigation() {
            const progress = (state.currentStep / state.totalSteps) * 100;
            DOMElements.progressBar.style.width = `${progress}%`;

            DOMElements.prevBtn.disabled = state.currentStep === 0;
            DOMElements.nextBtn.style.display = state.currentStep === state.totalSteps ? 'none' : 'inline-flex';
            DOMElements.prevBtn.style.display = state.currentStep === 0 ? 'none' : 'inline-flex';
        }
        
        // --- UI & Modals ---
        function showModal(text, onclose = () => {}) {
            state.animationsPaused = true;
            DOMElements.modalText.innerHTML = text;
            DOMElements.modal.classList.add('active');
            DOMElements.modal.classList.remove('opacity-0', 'pointer-events-none');

            DOMElements.modalCloseBtn.addEventListener('click', function handler() {
                hideModal();
                onclose();
                this.removeEventListener('click', handler);
            });
        }

        function hideModal() {
            DOMElements.modal.classList.remove('active');
            DOMElements.modal.classList.add('opacity-0', 'pointer-events-none');
            state.animationsPaused = false;
        }

        // --- Simulation Reset ---
        function resetSimulation() {
            // This object maps a step index to its corresponding reset function.
            const stepResets = {
                1: resetStep1, 2: resetStep2, 3: resetStep3, 
                4: resetStep4, 5: resetStep5, 6: resetStep6, 7: resetQuiz
            };
            Object.values(stepResets).forEach(resetFunc => resetFunc());
            
            navigate(0);
            showModal("Simulation has been reset.", () => {});
        }

        // --- Step Initializations and Logic ---

        // Step 1: Login
        const loginBtn = document.getElementById('login-btn');
        const usernameInput = document.getElementById('username-input');
        const passwordInput = document.getElementById('password-input');
        function resetStep1() {
            usernameInput.value = '';
            passwordInput.value = '';
        }
        loginBtn.addEventListener('click', () => {
            const user = usernameInput.value.trim();
            const pass = passwordInput.value.trim();
            if (user.toLowerCase() === 'admin' && pass === 'Pa$$w0rd!') {
                showModal('<strong>Login Successful!</strong><br>Correct authentication credentials provided.');
            } else if (user && pass) {
                showModal('<strong>Login Failed!</strong><br>Incorrect username or password. Access is denied.');
            } else {
                showModal('<strong>Missing Information!</strong><br>Both username and password are required.');
            }
        });

        // Step 2: Access Rights
        const userSelector = document.getElementById('user-selector');
        const userViewName = document.getElementById('user-view-name');
        function resetStep2() {
            document.querySelectorAll('#db-view table').forEach(t => t.classList.add('hidden'));
            document.getElementById('db-placeholder').classList.remove('hidden');
            userViewName.textContent = 'None';
        }
        userSelector.addEventListener('click', e => {
            if (e.target.tagName !== 'BUTTON') return;
            const user = e.target.dataset.user;
            
            resetStep2();
            document.getElementById('db-placeholder').classList.add('hidden');
            document.getElementById(`${user}-table`).classList.remove('hidden');
            userViewName.textContent = e.target.textContent;

            const explanations = {
                clerk: 'The <span class="font-bold">Sales Clerk</span> has <span class="font-bold text-red-600">read-only</span> access to product and stock data, hiding sensitive cost information.',
                manager: 'The <span class="font-bold">Manager</span> has <span class="font-bold text-green-600">wider access</span>, including cost price, for making business decisions.',
                admin: 'The <span class="font-bold">Database Admin</span> has <span class="font-bold text-purple-600">full privileges</span> to manage system settings and user accounts, not daily operational data.'
            };
            showModal(explanations[user]);
        });
        
        // Step 3: Backups
        const backupBtn = document.getElementById('backup-btn');
        const disasterBtn = document.getElementById('disaster-btn');
        const restoreBtn = document.getElementById('restore-btn');
        const liveDataStatus = document.getElementById('live-data-status');
        const backupStatus = document.getElementById('backup-status');
        function resetStep3() {
            liveDataStatus.textContent = 'OK';
            liveDataStatus.className = 'text-green-600 font-bold transition-colors';
            backupStatus.textContent = 'Empty';
            backupStatus.className = 'text-gray-500 transition-colors';
            backupBtn.disabled = false;
            disasterBtn.disabled = true;
            restoreBtn.disabled = true;
        }
        function animateDataPacket(fromEl, toEl, color) {
            const packet = document.createElement('div');
            packet.className = `absolute w-4 h-4 rounded-full ${color} z-20`;
            DOMElements.mainContent.appendChild(packet);
            
            const startRect = fromEl.getBoundingClientRect();
            const endRect = toEl.getBoundingClientRect();
            const containerRect = DOMElements.mainContent.getBoundingClientRect();

            packet.style.left = `${startRect.left - containerRect.left + startRect.width / 2}px`;
            packet.style.top = `${startRect.top - containerRect.top + startRect.height / 2}px`;

            packet.animate([
                { transform: 'scale(1)', opacity: 1 },
                { 
                    left: `${endRect.left - containerRect.left + endRect.width / 2}px`,
                    top: `${endRect.top - containerRect.top + endRect.height / 2}px`,
                    transform: 'scale(0.5)',
                    opacity: 0.5
                }
            ], { duration: 1000, easing: 'ease-in-out' }).onfinish = () => packet.remove();
        }
        backupBtn.addEventListener('click', () => {
            if (state.animationsPaused) return;
            animateDataPacket(liveDataStatus, backupStatus, 'bg-blue-500');
            backupStatus.textContent = 'Creating...';
            setTimeout(() => {
                backupStatus.textContent = 'Backup Created';
                backupStatus.className = 'text-green-600 font-bold transition-colors';
                disasterBtn.disabled = false;
                showModal('<strong>Backup Complete!</strong><br>A copy of the database is now safely stored.');
            }, 1000);
        });
        disasterBtn.addEventListener('click', () => {
            if (state.animationsPaused) return;
            liveDataStatus.textContent = 'DATA CORRUPTED';
            liveDataStatus.className = 'text-red-600 font-bold animate-pulse transition-colors';
            restoreBtn.disabled = false;
            showModal('<strong>Disaster!</strong><br>The live data has been lost. A restore is necessary.');
        });
        restoreBtn.addEventListener('click', () => {
            if (state.animationsPaused) return;
            animateDataPacket(backupStatus, liveDataStatus, 'bg-green-500');
            liveDataStatus.textContent = 'Restoring...';
            liveDataStatus.className = 'text-yellow-500 font-bold transition-colors';
             setTimeout(() => {
                liveDataStatus.textContent = 'OK';
                liveDataStatus.className = 'text-green-600 font-bold transition-colors';
                showModal('<strong>Restore Complete!</strong><br>Data has been restored from the backup.');
            }, 1000);
        });

        // Step 4: Encryption
        const encryptBtn = document.getElementById('encrypt-btn');
        const decryptBtn = document.getElementById('decrypt-btn');
        const encryptionText = document.getElementById('encryption-text');
        const ciphertextEl = document.getElementById('ciphertext');
        const originalText = "user: admin, pass: P@ssw0rd!";
        function textToAsciiHex(text) {
            return text.split('').map(char => ('0' + char.charCodeAt(0).toString(16)).slice(-2)).join('');
        }
        function resetStep4() {
             encryptionText.textContent = originalText;
             encryptionText.classList.remove('text-gray-300');
             ciphertextEl.textContent = '';
             encryptBtn.disabled = false;
             decryptBtn.disabled = true;
        }
        encryptBtn.addEventListener('click', () => {
             if (state.animationsPaused) return;
             encryptBtn.disabled = true;
             encryptionText.classList.add('text-gray-300');
             ciphertextEl.textContent = 'Encrypting...';
             setTimeout(() => {
                ciphertextEl.textContent = textToAsciiHex(originalText);
                decryptBtn.disabled = false;
                showModal('<strong>Data Encrypted</strong><br>The original data is now unreadable ciphertext.');
             }, 1000);
        });
        decryptBtn.addEventListener('click', () => {
             if (state.animationsPaused) return;
             decryptBtn.disabled = true;
             ciphertextEl.textContent = 'Decrypting...';
             setTimeout(() => {
                 ciphertextEl.textContent = '';
                 encryptionText.textContent = originalText;
                 encryptionText.classList.remove('text-gray-300');
                 encryptBtn.disabled = false;
                 showModal('<strong>Data Decrypted</strong><br>The ciphertext has been converted back to readable plaintext.');
             }, 1000);
        });
        
        // Step 5: Views
        const createViewBtn = document.getElementById('create-view-btn');
        const viewResultTable = document.getElementById('view-result-table');
        function resetStep5() {
            viewResultTable.classList.add('opacity-0');
            createViewBtn.disabled = false;
        }
        createViewBtn.addEventListener('click', () => {
            if (state.animationsPaused) return;
            createViewBtn.disabled = true;
            viewResultTable.classList.remove('opacity-0');
            showModal(`<strong>View Created!</strong><br>A view named <code>SalesStaff</code> was created by joining two tables and selecting only the Name and Phone columns, hiding sensitive data.`);
        });

        // Step 6: Logging
        const logActionContainer = document.getElementById('log-action-container');
        const activityLog = document.getElementById('activity-log');
        function resetStep6() {
            activityLog.innerHTML = `<p class="text-gray-400">[SYSTEM] Logging service started...</p>`;
        }
        logActionContainer.addEventListener('click', e => {
            if (state.animationsPaused || !e.target.classList.contains('log-action-btn')) return;
            const action = e.target.dataset.action;
            const logMessages = {
                LOGIN: { class: 'text-green-400', msg: "User 'manager' logged in successfully from 192.168.1.10." },
                QUERY: { class: 'text-blue-400', msg: "User 'manager' executed SELECT on 'products'." },
                UPDATE: { class: 'text-yellow-400', msg: "User 'manager' updated record ID 5 in 'products'." },
                DELETE_FAIL: { class: 'text-red-400', msg: "User 'manager' failed DELETE on 'employees': insufficient privileges." }
            };
            const logData = logMessages[action];
            const logEntry = document.createElement('p');
            logEntry.className = logData.class;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] [INFO] ${logData.msg}`;
            activityLog.appendChild(logEntry);
            activityLog.scrollTop = activityLog.scrollHeight;
        });
        
        // --- Quiz Logic ---
        function buildQuiz() {
            DOMElements.quizContainer.innerHTML = '';
            quizData.forEach((q, index) => {
                const questionEl = document.createElement('div');
                questionEl.className = 'quiz-question';
                questionEl.dataset.questionIndex = index;

                let optionsHTML = '';
                if(q.type === 'mcq') {
                    optionsHTML = `<div class="quiz-options space-y-2" data-type="mcq">
                        ${q.options.map(opt => `<button class="quiz-option w-full text-left p-3 border-2 rounded-lg">${opt}</button>`).join('')}
                    </div>`;
                } else if(q.type === 'fill') {
                    optionsHTML = `<div class="quiz-options" data-type="fill">
                        <input type="text" class="w-full md:w-1/2 p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Type your answer here">
                        <button class="check-answer-btn bg-blue-500 text-white font-bold py-2 px-4 rounded-lg ml-2 btn-primary">Check</button>
                    </div>`;
                } else if(q.type === 'text') {
                     optionsHTML = `<div class="quiz-options" data-type="text">
                        <textarea rows="4" class="w-full p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Describe the measure and its importance..."></textarea>
                        <button class="check-answer-btn bg-blue-500 text-white font-bold py-2 px-4 rounded-lg mt-2 btn-primary">Check</button>
                    </div>`;
                }
                
                questionEl.innerHTML = `
                    <p class="font-semibold text-lg mb-3">Q${index + 1}: ${q.question}</p>
                    ${optionsHTML}
                    <div class="feedback mt-2 text-sm"></div>
                `;
                DOMElements.quizContainer.appendChild(questionEl);
            });
        }
        
        function resetQuizState() {
            state.quizState = {};
            quizData.forEach((_, index) => {
                state.quizState[index] = { answered: false, correct: false };
            });
        }
        
        function resetQuiz() {
            resetQuizState();
            buildQuiz(); // Rebuild the quiz to reset it completely
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('score').textContent = '0';
            document.getElementById('total-score').textContent = quizData.length;
        }

        // Event delegation for the entire quiz container
        DOMElements.quizContainer.addEventListener('click', e => {
            const questionDiv = e.target.closest('.quiz-question');
            if (!questionDiv) return;

            const index = questionDiv.dataset.questionIndex;
            if (state.quizState[index].answered) return;

            const qData = quizData[index];
            const optionsDiv = e.target.closest('.quiz-options');
            
            if (optionsDiv.dataset.type === 'mcq' && e.target.classList.contains('quiz-option')) {
                const selectedAnswer = e.target.textContent;
                const options = optionsDiv.querySelectorAll('.quiz-option');
                options.forEach(opt => {
                    opt.disabled = true;
                    if (opt.textContent === qData.answer) opt.classList.add('correct');
                });

                if (selectedAnswer === qData.answer) {
                    e.target.classList.add('correct');
                    state.quizState[index].correct = true;
                } else {
                    e.target.classList.add('incorrect');
                }
                state.quizState[index].answered = true;
                checkQuizCompletion();

            } else if (e.target.classList.contains('check-answer-btn')) {
                const inputEl = e.target.previousElementSibling;
                const feedbackEl = optionsDiv.nextElementSibling;
                const userAnswer = inputEl.value.trim().toLowerCase();
                
                if(qData.type === 'text' && userAnswer.length < 20) {
                     showModal("Please provide a more detailed answer.");
                     return;
                }
                if (userAnswer.length === 0) return;

                inputEl.disabled = true;
                e.target.disabled = true;
                state.quizState[index].answered = true;

                if (qData.type === 'fill') {
                     if (userAnswer === qData.answer) {
                         feedbackEl.textContent = 'Correct!';
                         feedbackEl.className = 'feedback mt-2 text-sm text-green-600';
                         state.quizState[index].correct = true;
                     } else {
                         feedbackEl.textContent = `Incorrect. The correct answer is "${qData.answer}".`;
                         feedbackEl.className = 'feedback mt-2 text-sm text-red-600';
                     }
                } else if (qData.type === 'text') {
                    const score = qData.answerKeywords.reduce((acc, keyword) => acc + (userAnswer.includes(keyword) ? 1 : 0), 0);
                    state.quizState[index].correct = score >= 3;
                    feedbackEl.innerHTML = `
                        <p class="font-bold ${state.quizState[index].correct ? 'text-green-600' : 'text-red-600'}">Your answer has been marked.</p>
                        <p class="font-bold mt-2">Mark Scheme:</p>
                        <ul class="list-disc list-inside">
                           <li>Award 1 mark for identifying (regular/scheduled) backups.</li>
                           <li>Award 1 mark for explaining this creates a copy of the data.</li>
                           <li>Award 1 mark for explaining this copy can be used to restore the data.</li>
                           <li>(Optional) Mentioning off-site storage is also a valid point.</li>
                        </ul>`;
                }
                checkQuizCompletion();
            }
        });

        function checkQuizCompletion() {
            const allAnswered = Object.values(state.quizState).every(q => q.answered);
            if (allAnswered) {
                const finalScore = Object.values(state.quizState).filter(q => q.correct).length;
                document.getElementById('score').textContent = finalScore;
                document.getElementById('quiz-results').classList.remove('hidden');
            }
        }
        
        // --- Initialization ---
        function initialize() {
            // Attach event listeners
            DOMElements.startBtn.addEventListener('click', () => navigate(1));
            DOMElements.prevBtn.addEventListener('click', () => navigate(state.currentStep - 1));
            DOMElements.nextBtn.addEventListener('click', () => navigate(state.currentStep + 1));
            DOMElements.resetBtn.addEventListener('click', resetSimulation);
            DOMElements.resetQuizBtn.addEventListener('click', resetQuiz);
            
            document.addEventListener('keydown', (e) => {
                if (!state.animationsPaused) {
                    if (e.key === 'ArrowRight') DOMElements.nextBtn.click();
                    if (e.key === 'ArrowLeft') DOMElements.prevBtn.click();
                }
            });
            
            // Set initial state
            resetQuiz();
            navigate(0);
        }
        
        initialize();
    });
</script>

</body>
</html>
