<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Packet Switching & Network Fundamentals</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .dyslexia-font {
            font-family: 'OpenDyslexic', monospace;
        }

        .high-contrast {
            background: #000;
            color: #fff;
        }

        .high-contrast .container {
            background: #111;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .accessibility-bar {
            background: #34495e;
            color: white;
            padding: 8px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .accessibility-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .accessibility-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .accessibility-btn:hover {
            background: #2980b9;
        }

        .header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .xp-bar {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .xp-fill {
            background: linear-gradient(90deg, #f1c40f, #f39c12);
            height: 100%;
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .xp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .navigation {
            background: #ecf0f1;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #bdc3c7;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-sections {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .nav-btn:hover, .nav-btn.active {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .nav-controls {
            display: flex;
            gap: 10px;
        }

        .main-content {
            padding: 30px;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .learning-outcomes {
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            border-left: 5px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .task-box {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-title {
            color: #2c3e50;
            font-size: 18px;
            font-weight: bold;
        }

        .reset-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .reset-btn:hover {
            background: #c0392b;
        }

        .question {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .options {
            display: grid;
            gap: 10px;
            margin: 10px 0;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #3498db;
        }

        .option.selected {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }

        .option.correct {
            background: #28a745;
            color: white;
            border-color: #1e7e34;
        }

        .option.incorrect {
            background: #dc3545;
            color: white;
            border-color: #bd2130;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 14px;
            margin: 10px 0;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #3498db;
        }

        .drag-drop-area {
            min-height: 200px;
            border: 3px dashed #bdc3c7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .drag-item {
            background: #3498db;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            user-select: none;
        }

        .drag-item:hover {
            transform: scale(1.05);
            background: #2980b9;
        }

        .drag-item.selected {
            background: #f39c12;
        }

        .drop-zone {
            min-height: 60px;
            border: 2px dashed #bdc3c7;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        .drop-zone.highlight {
            border-color: #3498db;
            background: #ebf3fd;
        }

        .drop-zone.filled {
            background: #d4edda;
            border-color: #28a745;
        }

        .simulation-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .simulation-step {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #f1c40f;
        }

        .canvas-container {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .drawing-canvas {
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            cursor: crosshair;
            touch-action: none;
        }

        .canvas-controls {
            margin: 10px 0;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .canvas-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .canvas-btn:hover {
            background: #5a6268;
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
            animation: achievementPop 0.5s ease-out;
        }

        @keyframes achievementPop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #f1c40f;
            border-radius: 50%;
            pointer-events: none;
            animation: particle 1s ease-out forwards;
        }

        @keyframes particle {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0) translateY(-100px); }
        }

        .feedback-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #17a2b8;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
            z-index: 999;
        }

        .feedback-btn:hover {
            background: #138496;
            transform: scale(1.1);
        }

        .feedback-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }

        .feedback-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .mark-scheme {
            background: #e8f5e8;
            border: 1px solid #28a745;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .mark-scheme.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hint-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }

        .hint-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin: 5px 0;
        }

        .real-world-box {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .common-mistakes {
            background: #ffeaa7;
            border-left: 5px solid #fdcb6e;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .extension-activity {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .paste-shame {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #dc3545;
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 1002;
            display: none;
            text-align: center;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-50%, -50%) rotate(-5deg); }
            75% { transform: translate(-50%, -50%) rotate(5deg); }
        }

        .level-display {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .navigation {
                flex-direction: column;
                align-items: stretch;
            }

            .nav-sections {
                justify-content: center;
            }

            .main-content {
                padding: 15px;
            }

            .accessibility-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .accessibility-controls {
                justify-content: center;
            }
        }

        .font-size-small { font-size: 14px; }
        .font-size-medium { font-size: 16px; }
        .font-size-large { font-size: 18px; }
        .font-size-xl { font-size: 20px; }
    </style>
</head>
<body>
    <div class="paste-shame" id="pasteShame">
        <h3>🚫 Pasting Not Allowed!</h3>
        <p>Please type your answers to demonstrate your understanding.</p>
    </div>

    <div class="container">
        <!-- Accessibility Bar -->
        <div class="accessibility-bar">
            <div class="accessibility-controls">
                <button class="accessibility-btn" onclick="toggleHighContrast()">🔆 High Contrast</button>
                <button class="accessibility-btn" onclick="toggleDyslexiaFont()">📖 Dyslexia Font</button>
                <select class="accessibility-btn" onchange="changeFontSize(this.value)">
                    <option value="medium">Font Size</option>
                    <option value="small">Small</option>
                    <option value="medium">Medium</option>
                    <option value="large">Large</option>
                    <option value="xl">Extra Large</option>
                </select>
            </div>
            <div>Packet Switching & Network Fundamentals</div>
        </div>

        <!-- Header -->
        <div class="header">
            <h1>📡 Packet Switching & Network Fundamentals</h1>
            <p>Cambridge A-Level Computer Science (9618)</p>
            
            <div class="level-display">
                <div>Level: <span id="currentLevel">1</span>/5</div>
                <div class="xp-bar">
                    <div class="xp-fill" id="xpFill"></div>
                    <div class="xp-text"><span id="currentXP">0</span> / <span id="maxXP">100</span> XP</div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <div class="nav-sections">
                <button class="nav-btn active" onclick="showSection(0)">Starter</button>
                <button class="nav-btn" onclick="showSection(1)">Circuit Switching</button>
                <button class="nav-btn" onclick="showSection(2)">Data Packets</button>
                <button class="nav-btn" onclick="showSection(3)">Routers</button>
                <button class="nav-btn" onclick="showSection(4)">Packet Structure</button>
                <button class="nav-btn" onclick="showSection(5)">Network Types</button>
                <button class="nav-btn" onclick="showSection(6)">PSTN</button>
                <button class="nav-btn" onclick="showSection(7)">Gateways</button>
                <button class="nav-btn" onclick="showSection(8)">Practice Exam</button>
                <button class="nav-btn" onclick="showSection(9)">Extension</button>
                <button class="nav-btn" onclick="showSection(10)">Summary</button>
                <button class="nav-btn" onclick="showSection(11)">Videos</button>
            </div>
            <div class="nav-controls">
                <button class="nav-btn" onclick="previousSection()">← Previous</button>
                <button class="nav-btn" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Section 0: Starter Activity -->
            <div class="section active" id="section0">
                <h2>🚀 Starter Activity: Network Knowledge Check</h2>
                
                <div class="learning-outcomes">
                    <h3>📋 Learning Outcomes</h3>
                    <ul>
                        <li>Understand the difference between circuit switching and packet switching</li>
                        <li>Explain the structure and purpose of data packets</li>
                        <li>Describe how routers function in packet transmission</li>
                        <li>Analyze packet transmission in LANs and WANs</li>
                        <li>Evaluate benefits and drawbacks of different network types</li>
                        <li>Apply knowledge of gateways and packet filtering</li>
                    </ul>
                </div>

                <div class="task-box">
                    <div class="task-header">
                        <div class="task-title">Starter Quiz: What Do You Know?</div>
                        <button class="reset-btn" onclick="resetSection(0)">🔄 Reset</button>
                    </div>

                    <div class="question">
                        <p><strong>1. When you make a phone call, what type of connection is typically established?</strong></p>
                        <div class="options" id="starter-q1">
                            <div class="option" onclick="selectOption(this, 'starter-q1', true)">A dedicated communication channel for the duration of the call</div>
                            <div class="option" onclick="selectOption(this, 'starter-q1', false)">Data is sent in small packets through different routes</div>
                            <div class="option" onclick="selectOption(this, 'starter-q1', false)">Multiple conversations share the same line simultaneously</div>
                            <div class="option" onclick="selectOption(this, 'starter-q1', false)">The connection changes every few seconds</div>
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>2. What happens to a large file when it's sent over the internet?</strong></p>
                        <div class="options" id="starter-q2">
                            <div class="option" onclick="selectOption(this, 'starter-q2', false)">It's sent as one complete unit</div>
                            <div class="option" onclick="selectOption(this, 'starter-q2', true)">It's broken into smaller packets and reassembled at destination</div>
                            <div class="option" onclick="selectOption(this, 'starter-q2', false)">It's compressed and then sent</div>
                            <div class="option" onclick="selectOption(this, 'starter-q2', false)">It waits for a clear line before transmission</div>
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>3. Click to match the correct pairs:</strong></p>
                        <div class="drag-drop-area" id="starter-matching">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%;">
                                <div>
                                    <h4>Terms:</h4>
                                    <div class="drag-item" onclick="selectForMatching(this, 'Router')">Router</div>
                                    <div class="drag-item" onclick="selectForMatching(this, 'Packet')">Packet</div>
                                    <div class="drag-item" onclick="selectForMatching(this, 'Gateway')">Gateway</div>
                                </div>
                                <div>
                                    <h4>Definitions:</h4>
                                    <div class="drop-zone" data-answer="Packet" onclick="dropMatch(this)">A unit of data with header and payload</div>
                                    <div class="drop-zone" data-answer="Router" onclick="dropMatch(this)">Forwards data between networks</div>
                                    <div class="drop-zone" data-answer="Gateway" onclick="dropMatch(this)">Bridge between different protocols</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="real-world-box">
                    <h3>🌍 Real-World Context</h3>
                    <p>Every time you stream a video, send a message, or browse the web, your data travels through complex networks using packet switching. Understanding these concepts helps explain why sometimes your internet feels slow or why certain connections are more reliable than others.</p>
                </div>
            </div>

            <!-- Section 1: Circuit Switching -->
            <div class="section" id="section1">
                <h2>📞 Circuit Switching Fundamentals</h2>

                <div class="task-box">
                    <div class="task-header">
                        <div class="task-title">Understanding Circuit Switching</div>
                        <button class="reset-btn" onclick="resetSection(1)">🔄 Reset</button>
                    </div>

                    <div class="simulation-box">
                        <h3>🎯 Circuit Switching Simulation</h3>
                        <iframe 
                            id="circuit-simulation-iframe"
                            style="width: 100%; height: 800px; border: none; border-radius: 8px; background: white;"
                            srcdoc='<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circuit Switching Simulation - A Level Computer Science</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease-out;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .simulation-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideInLeft 0.8s ease-out;
        }
        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideInRight 0.8s ease-out;
        }
        .instructions {
            background: #f0f4ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #4CAF50;
        }
        .instructions h3 {
            color: #2a5298;
            margin-bottom: 10px;
        }
        .instructions ol {
            margin-left: 20px;
        }
        .instructions li {
            margin-bottom: 5px;
            line-height: 1.6;
        }
        canvas {
            width: 100%;
            height: 400px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }
        .btn-info {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        .status {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border: 2px solid #e9ecef;
        }
        .status h4 {
            color: #2a5298;
            margin-bottom: 10px;
        }
        .quiz-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeIn 1s ease-out;
        }
        .quiz-question {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
        }
        .quiz-question h3 {
            color: #2a5298;
            margin-bottom: 15px;
        }
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .quiz-option {
            padding: 12px 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .quiz-option:hover {
            background: #f0f4ff;
            border-color: #3498db;
            transform: translateX(5px);
        }
        .quiz-option.selected {
            background: #e3f2fd;
            border-color: #2196F3;
        }
        .quiz-option.correct {
            background: #e8f5e9;
            border-color: #4CAF50;
        }
        .quiz-option.incorrect {
            background: #ffebee;
            border-color: #f44336;
        }
        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            animation: slideDown 0.3s ease-out;
        }
        .quiz-feedback.correct {
            background: #e8f5e9;
            border: 2px solid #4CAF50;
            color: #2e7d32;
        }
        .quiz-feedback.incorrect {
            background: #ffebee;
            border: 2px solid #f44336;
            color: #c62828;
        }
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            max-width: 500px;
            animation: popupIn 0.3s ease-out;
        }
        .popup h3 {
            color: #2a5298;
            margin-bottom: 15px;
        }
        .popup p {
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        .info-box {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid #2196F3;
        }
        .info-box h4 {
            color: #1976D2;
            margin-bottom: 10px;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideInLeft {
            from { transform: translateX(-50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideInRight {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideDown {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes popupIn {
            from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #333;
        }
        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Circuit Switching Simulation</h1>
            <p>Cambridge A Level Computer Science (9618)</p>
        </div>
        <div class="main-content">
            <div class="simulation-area">
                <h2>Network Simulation</h2>
                <canvas id="simulationCanvas"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4CAF50;"></div>
                        <span>Active Connection</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff9800;"></div>
                        <span>Reserved Path</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e0e0e0;"></div>
                        <span>Available Path</span>
                    </div>
                </div>
            </div>
            <div class="control-panel">
                <div class="instructions">
                    <h3>📖 How to Use This Simulation</h3>
                    <ol>
                        <li>Click "Start Call" to initiate a circuit-switched connection</li>
                        <li>Watch as the system establishes a dedicated path (orange)</li>
                        <li>Click "Send Data" to transmit data through the circuit</li>
                        <li>Observe how the path remains reserved during transmission</li>
                        <li>Click "End Call" to release the circuit</li>
                        <li>Test your knowledge with the quiz below!</li>
                    </ol>
                </div>
                <div class="controls">
                    <button class="btn btn-primary" id="startCall">Start Call</button>
                    <button class="btn btn-info" id="sendData" disabled>Send Data</button>
                    <button class="btn btn-secondary" id="endCall" disabled>End Call</button>
                    <button class="btn btn-secondary" id="reset">Reset</button>
                </div>
                <div class="status">
                    <h4>Connection Status</h4>
                    <p id="statusText">Ready to establish connection</p>
                </div>
                <div class="info-box">
                    <h4>💡 Key Points</h4>
                    <ul>
                        <li>Dedicated path for entire duration</li>
                        <li>Path established before communication</li>
                        <li>Bandwidth guaranteed but may be wasted</li>
                        <li>Common in telephone networks</li>
                        <li>Not ideal for internet (bursty traffic)</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="quiz-section">
            <h2>Test Your Understanding</h2>
            <div id="quizContainer"></div>
            <div class="controls">
                <button class="btn btn-primary" id="checkAnswers">Check Answers</button>
                <button class="btn btn-secondary" id="resetQuiz">Reset Quiz</button>
            </div>
            <div id="quizScore" style="margin-top: 20px; font-size: 1.2em; font-weight: bold;"></div>
        </div>
    </div>
    <div class="overlay" id="overlay"></div>
    <div class="popup" id="popup">
        <h3 id="popupTitle"></h3>
        <p id="popupContent"></p>
        <button class="btn btn-primary" onclick="closePopup()">Close</button>
    </div>
    <script>
        // Canvas setup
        const canvas = document.getElementById("simulationCanvas");
        const ctx = canvas.getContext("2d");
        
        // Set actual canvas size
        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
        }
        
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);
        // Network nodes
        const nodes = [
            { id: "A", x: 100, y: 200, label: "Device A" },
            { id: "S1", x: 250, y: 150, label: "Switch 1" },
            { id: "S2", x: 250, y: 250, label: "Switch 2" },
            { id: "S3", x: 400, y: 100, label: "Switch 3" },
            { id: "S4", x: 400, y: 200, label: "Switch 4" },
            { id: "S5", x: 400, y: 300, label: "Switch 5" },
            { id: "S6", x: 550, y: 150, label: "Switch 6" },
            { id: "S7", x: 550, y: 250, label: "Switch 7" },
            { id: "B", x: 700, y: 200, label: "Device B" }
        ];
        // Network connections
        const connections = [
            { from: "A", to: "S1" },
            { from: "A", to: "S2" },
            { from: "S1", to: "S3" },
            { from: "S1", to: "S4" },
            { from: "S2", to: "S4" },
            { from: "S2", to: "S5" },
            { from: "S3", to: "S6" },
            { from: "S4", to: "S6" },
            { from: "S4", to: "S7" },
            { from: "S5", to: "S7" },
            { from: "S6", to: "B" },
            { from: "S7", to: "B" }
        ];
        // Circuit path
        const circuitPath = ["A", "S1", "S4", "S6", "B"];
        
        // State
        let connectionState = "idle"; // idle, establishing, connected, transmitting
        let dataPackets = [];
        let animationFrame = 0;
        // Scale nodes to canvas size
        function scaleCoordinates() {
            const scaleX = canvas.width / 800;
            const scaleY = canvas.height / 400;
            
            return nodes.map(node => ({
                ...node,
                x: node.x * scaleX,
                y: node.y * scaleY
            }));
        }
        // Draw network
        function drawNetwork() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const scaledNodes = scaleCoordinates();
            
            // Draw connections
            connections.forEach(conn => {
                const fromNode = scaledNodes.find(n => n.id === conn.from);
                const toNode = scaledNodes.find(n => n.id === conn.to);
                
                ctx.beginPath();
                ctx.moveTo(fromNode.x, fromNode.y);
                ctx.lineTo(toNode.x, toNode.y);
                
                // Check if this connection is part of the circuit path
                const isInPath = circuitPath.includes(conn.from) && circuitPath.includes(conn.to) &&
                    Math.abs(circuitPath.indexOf(conn.from) - circuitPath.indexOf(conn.to)) === 1;
                
                if (isInPath && (connectionState === "establishing" || connectionState === "connected" || connectionState === "transmitting")) {
                    ctx.strokeStyle = "#ff9800";
                    ctx.lineWidth = 4;
                } else {
                    ctx.strokeStyle = "#e0e0e0";
                    ctx.lineWidth = 2;
                }
                
                ctx.stroke();
            });
            
            // Draw data packets
            dataPackets.forEach(packet => {
                ctx.fillStyle = "#4CAF50";
                ctx.beginPath();
                ctx.arc(packet.x, packet.y, 8, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw nodes
            scaledNodes.forEach(node => {
                // Node circle
                ctx.fillStyle = node.id === "A" || node.id === "B" ? "#2196F3" : "#9e9e9e";
                ctx.beginPath();
                ctx.arc(node.x, node.y, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // Node border
                ctx.strokeStyle = "#333";
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Node label
                ctx.fillStyle = "#333";
                ctx.font = "bold 14px Arial";
                ctx.textAlign = "center";
                ctx.fillText(node.label, node.x, node.y - 30);
            });
            
            // Draw establishing animation
            if (connectionState === "establishing") {
                const progress = (animationFrame % 60) / 60;
                const scaledPath = circuitPath.map(id => scaledNodes.find(n => n.id === id));
                
                for (let i = 0; i < scaledPath.length - 1; i++) {
                    const from = scaledPath[i];
                    const to = scaledPath[i + 1];
                    const x = from.x + (to.x - from.x) * progress;
                    const y = from.y + (to.y - from.y) * progress;
                    
                    ctx.fillStyle = "#ff9800";
                    ctx.beginPath();
                    ctx.arc(x, y, 6, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }
        // Update data packets
        function updateDataPackets() {
            const scaledNodes = scaleCoordinates();
            
            dataPackets = dataPackets.filter(packet => {
                if (packet.targetIndex >= circuitPath.length) {
                    return false;
                }
                
                const target = scaledNodes.find(n => n.id === circuitPath[packet.targetIndex]);
                const dx = target.x - packet.x;
                const dy = target.y - packet.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 5) {
                    packet.targetIndex++;
                    if (packet.targetIndex >= circuitPath.length) {
                        return false;
                    }
                }
                
                const speed = 3;
                packet.x += (dx / distance) * speed;
                packet.y += (dy / distance) * speed;
                
                return true;
            });
        }
        // Animation loop
        function animate() {
            animationFrame++;
            
            if (connectionState === "transmitting") {
                updateDataPackets();
            }
            
            drawNetwork();
            requestAnimationFrame(animate);
        }
        // Start animation
        animate();
        // Control functions
        function startCall() {
            if (connectionState !== "idle") return;
            
            connectionState = "establishing";
            document.getElementById("statusText").textContent = "Establishing circuit connection...";
            document.getElementById("startCall").disabled = true;
            
            showPopup("Circuit Establishment", "The system is now reserving a dedicated path through the network switches. This path will remain exclusively yours for the entire duration of the call.");
            
            setTimeout(() => {
                connectionState = "connected";
                document.getElementById("statusText").textContent = "Circuit established - Ready to transmit";
                document.getElementById("sendData").disabled = false;
                document.getElementById("endCall").disabled = false;
            }, 3000);
        }
        function sendData() {
            if (connectionState !== "connected") return;
            
            connectionState = "transmitting";
            document.getElementById("statusText").textContent = "Transmitting data through circuit...";
            document.getElementById("sendData").disabled = true;
            
            const scaledNodes = scaleCoordinates();
            const startNode = scaledNodes.find(n => n.id === "A");
            
            // Create multiple data packets
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    dataPackets.push({
                        x: startNode.x,
                        y: startNode.y,
                        targetIndex: 1
                    });
                }, i * 500);
            }
            
            setTimeout(() => {
                connectionState = "connected";
                document.getElementById("statusText").textContent = "Data transmission complete";
                document.getElementById("sendData").disabled = false;
            }, 4000);
        }
        function endCall() {
            if (connectionState === "idle") return;
            
            connectionState = "idle";
            dataPackets = [];
            document.getElementById("statusText").textContent = "Circuit released - Ready for new connection";
            document.getElementById("startCall").disabled = false;
            document.getElementById("sendData").disabled = true;
            document.getElementById("endCall").disabled = true;
            
            showPopup("Circuit Released", "The dedicated path has been released and is now available for other connections. This is a key characteristic of circuit switching - resources are freed only after the call ends.");
        }
        function reset() {
            connectionState = "idle";
            dataPackets = [];
            animationFrame = 0;
            document.getElementById("statusText").textContent = "Ready to establish connection";
            document.getElementById("startCall").disabled = false;
            document.getElementById("sendData").disabled = true;
            document.getElementById("endCall").disabled = true;
            resetQuiz();
        }
        // Event listeners
        document.getElementById("startCall").addEventListener("click", startCall);
        document.getElementById("sendData").addEventListener("click", sendData);
        document.getElementById("endCall").addEventListener("click", endCall);
        document.getElementById("reset").addEventListener("click", reset);
        // Popup functions
        function showPopup(title, content) {
            document.getElementById("popupTitle").textContent = title;
            document.getElementById("popupContent").textContent = content;
            document.getElementById("popup").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        }
        function closePopup() {
            document.getElementById("popup").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }
        document.getElementById("overlay").addEventListener("click", closePopup);
        // Quiz data
        const quizQuestions = [
            {
                question: "What is the main characteristic of circuit switching?",
                options: [
                    "Data is split into packets",
                    "A dedicated communication path is established for the entire duration",
                    "Multiple users share the same path simultaneously",
                    "Connections are established dynamically as needed"
                ],
                correct: 1,
                feedback: "Circuit switching creates a dedicated communication channel between two endpoints for the entire duration of the communication."
            },
            {
                question: "When is the communication path established in circuit switching?",
                options: [
                    "After data transmission begins",
                    "Prior to the start of communication",
                    "During data transmission",
                    "Only when congestion occurs"
                ],
                correct: 1,
                feedback: "In circuit switching, the connection must be established before any communication can begin."
            },
            {
                question: "Why doesn&apos;t circuit switching work well for the internet?",
                options: [
                    "It&apos;s too fast for web browsing",
                    "It wastes bandwidth during idle periods",
                    "It&apos;s too expensive to implement",
                    "It doesn&apos;t support digital data"
                ],
                correct: 1,
                feedback: "Circuit switching reserves bandwidth even when no data is being transmitted, which is inefficient for the bursty nature of internet traffic."
            },
            {
                question: "What happens to the circuit path during periods of silence in a phone call?",
                options: [
                    "It&apos;s released and re-established when needed",
                    "It remains reserved but unused",
                    "It&apos;s shared with other users",
                    "It automatically compresses the silence"
                ],
                correct: 1,
                feedback: "The dedicated path remains reserved even during silence, which can lead to inefficient use of network resources."
            },
            {
                question: "Which of the following is an advantage of circuit switching?",
                options: [
                    "Efficient use of bandwidth",
                    "Guaranteed quality of service",
                    "Support for many simultaneous users",
                    "Automatic error correction"
                ],
                correct: 1,
                feedback: "Circuit switching provides guaranteed bandwidth and consistent quality of service since the path is dedicated."
            },
            {
                question: "In which type of network is circuit switching most commonly used?",
                options: [
                    "Computer networks",
                    "Traditional telephone networks",
                    "Wireless sensor networks",
                    "Modern internet infrastructure"
                ],
                correct: 1,
                feedback: "Circuit switching is primarily used in traditional telephone networks (PSTN - Public Switched Telephone Network)."
            }
        ];
        // Initialize quiz
        function initializeQuiz() {
            const container = document.getElementById("quizContainer");
            container.innerHTML = "";
            
            quizQuestions.forEach((q, index) => {
                const questionDiv = document.createElement("div");
                questionDiv.className = "quiz-question";
                questionDiv.innerHTML = `
                    <h3>Question ${index + 1}: ${q.question}</h3>
                    <div class="quiz-options">
                        ${q.options.map((option, optIndex) => `
                            <div class="quiz-option" data-question="${index}" data-option="${optIndex}">
                                ${option}
                            </div>
                        `).join("")}
                    </div>
                    <div class="quiz-feedback" id="feedback-${index}"></div>
                `;
                container.appendChild(questionDiv);
            });
            
            // Add click handlers
            document.querySelectorAll(".quiz-option").forEach(option => {
                option.addEventListener("click", selectOption);
            });
        }
        function selectOption(e) {
            const questionIndex = parseInt(e.target.dataset.question);
            const options = document.querySelectorAll(`.quiz-option[data-question="${questionIndex}"]`);
            
            options.forEach(opt => opt.classList.remove("selected"));
            e.target.classList.add("selected");
        }
        function checkAnswers() {
            let score = 0;
            
            quizQuestions.forEach((q, index) => {
                const selected = document.querySelector(`.quiz-option[data-question="${index}"].selected`);
                const feedback = document.getElementById(`feedback-${index}`);
                const options = document.querySelectorAll(`.quiz-option[data-question="${index}"]`);
                
                if (selected) {
                    const selectedIndex = parseInt(selected.dataset.option);
                    
                    options.forEach((opt, optIndex) => {
                        opt.classList.remove("correct", "incorrect");
                        if (optIndex === q.correct) {
                            opt.classList.add("correct");
                        } else if (optIndex === selectedIndex && selectedIndex !== q.correct) {
                            opt.classList.add("incorrect");
                        }
                    });
                    
                    if (selectedIndex === q.correct) {
                        score++;
                        feedback.className = "quiz-feedback correct";
                        feedback.textContent = "✓ Correct! " + q.feedback;
                    } else {
                        feedback.className = "quiz-feedback incorrect";
                        feedback.textContent = "✗ Incorrect. " + q.feedback;
                    }
                    feedback.style.display = "block";
                }
            });
            
            const scoreDiv = document.getElementById("quizScore");
            scoreDiv.textContent = `Your Score: ${score}/${quizQuestions.length} (${Math.round(score/quizQuestions.length * 100)}%)`;
            
            if (score === quizQuestions.length) {
                scoreDiv.style.color = "#4CAF50";
                showPopup("Excellent!", "Perfect score! You have mastered the concept of circuit switching.");
            } else if (score >= quizQuestions.length * 0.7) {
                scoreDiv.style.color = "#ff9800";
                showPopup("Good Job!", "You have a solid understanding of circuit switching. Review the incorrect answers to improve further.");
            } else {
                scoreDiv.style.color = "#f44336";
                showPopup("Keep Practicing", "Review the feedback for each question and try the simulation again to better understand circuit switching.");
            }
        }
        function resetQuiz() {
            document.querySelectorAll(".quiz-option").forEach(option => {
                option.classList.remove("selected", "correct", "incorrect");
            });
            document.querySelectorAll(".quiz-feedback").forEach(feedback => {
                feedback.style.display = "none";
            });
            document.getElementById("quizScore").textContent = "";
        }
        // Initialize quiz on load
        initializeQuiz();
        // Quiz event listeners
        document.getElementById("checkAnswers").addEventListener("click", checkAnswers);
        document.getElementById("resetQuiz").addEventListener("click", resetQuiz);
    </script>
</body>
</html>'
                        ></iframe>
                    </div>

                    <div class="question">
                        <p><strong>Fill in the blanks: Circuit switching involves creating a _______ communication connection between two endpoints for the duration of a phone call or transfer of data.</strong></p>
                        <select class="input-field" id="circuit-blank1" onchange="checkCircuitBlank()">
                            <option value="">Choose an option...</option>
                            <option value="temporary">temporary</option>
                            <option value="dedicated">dedicated</option>
                            <option value="shared">shared</option>
                            <option value="wireless">wireless</option>
                            <option value="encrypted">encrypted</option>
                            <option value="public">public</option>
                        </select>
                        <div class="mark-scheme" id="circuit-mark1">
                            <strong>✓ Correct!</strong> "Dedicated" - Circuit switching creates a dedicated communication channel exclusively for the duration of the connection.
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>True or False: Circuit switching works very well for internet data transmission.</strong></p>
                        <div class="options" id="circuit-tf">
                            <div class="option" onclick="selectOption(this, 'circuit-tf', false)">True</div>
                            <div class="option" onclick="selectOption(this, 'circuit-tf', true)">False</div>
                        </div>
                        <button class="hint-btn" onclick="showHint('circuit-hint1')">💡 Hint (-5 XP)</button>
                        <div class="hint-box" id="circuit-hint1">
                            Think about whether the internet benefits from having dedicated channels or if it's better to share resources efficiently.
                        </div>
                    </div>
                </div>

                <div class="common-mistakes">
                    <h3>⚠️ Common Mistakes</h3>
                    <ul>
                        <li>Confusing circuit switching with packet switching - remember circuit switching maintains a dedicated path</li>
                        <li>Thinking circuit switching is always better - it's inefficient for internet data which has bursts of activity</li>
                        <li>Forgetting that the entire path must be available before communication can begin</li>
                    </ul>
                </div>
            </div>

            <!-- Section 2: Data Packets -->
            <div class="section" id="section2">
                <h2>📦 Data Packets and Packet Switching</h2>

                <div style="margin: 20px 0;">
                    <iframe 
                        id="packet-switching-simulation-iframe"
                        style="width: 100%; height: 1200px; border: none; border-radius: 8px; background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.1);"
                        srcdoc='<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Packet Switching Simulation - A Level Computer Science</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease-out;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .simulation-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideInLeft 0.8s ease-out;
        }
        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideInRight 0.8s ease-out;
        }
        .packet-info {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeIn 1s ease-out;
        }
        .instructions {
            background: #f0f4ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        .instructions h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .instructions ol {
            margin-left: 20px;
        }
        .instructions li {
            margin-bottom: 5px;
            line-height: 1.6;
        }
        canvas {
            width: 100%;
            height: 450px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
        }
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(240, 147, 251, 0.4);
        }
        .btn-info {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }
        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
        }
        .status {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border: 2px solid #e9ecef;
        }
        .status h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .packet-structure {
            display: flex;
            margin: 20px 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .packet-part {
            padding: 15px;
            text-align: center;
            color: white;
            font-weight: bold;
            position: relative;
        }
        .packet-header {
            background: #667eea;
            flex: 1;
        }
        .packet-payload {
            background: #4CAF50;
            flex: 2;
        }
        .packet-trailer {
            background: #ff6b6b;
            flex: 0.5;
        }
        .packet-details {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9em;
        }
        .reassembly-area {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            min-height: 100px;
            border: 2px dashed #2196F3;
        }
        .reassembly-area h4 {
            color: #1976D2;
            margin-bottom: 10px;
        }
        .received-packet {
            display: inline-block;
            background: #2196F3;
            color: white;
            padding: 5px 10px;
            margin: 5px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .quiz-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeIn 1s ease-out;
        }
        .quiz-question {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
        }
        .quiz-question h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .quiz-option {
            padding: 12px 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .quiz-option:hover {
            background: #f0f4ff;
            border-color: #667eea;
            transform: translateX(5px);
        }
        .quiz-option.selected {
            background: #e3f2fd;
            border-color: #2196F3;
        }
        .quiz-option.correct {
            background: #e8f5e9;
            border-color: #4CAF50;
        }
        .quiz-option.incorrect {
            background: #ffebee;
            border-color: #f44336;
        }
        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            animation: slideDown 0.3s ease-out;
        }
        .quiz-feedback.correct {
            background: #e8f5e9;
            border: 2px solid #4CAF50;
            color: #2e7d32;
        }
        .quiz-feedback.incorrect {
            background: #ffebee;
            border: 2px solid #f44336;
            color: #c62828;
        }
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            max-width: 500px;
            animation: popupIn 0.3s ease-out;
        }
        .popup h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        .popup p {
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        .info-box {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid #2196F3;
        }
        .info-box h4 {
            color: #1976D2;
            margin-bottom: 10px;
        }
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 5px;
            border: 2px solid #333;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideInLeft {
            from { transform: translateX(-50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideInRight {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideDown {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes popupIn {
            from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Packet Switching Simulation</h1>
            <p>Cambridge A Level Computer Science (9618)</p>
        </div>
        <div class="packet-info">
            <h2>Packet Structure</h2>
            <div class="packet-structure">
                <div class="packet-part packet-header">Header</div>
                <div class="packet-part packet-payload">Payload (Body)</div>
                <div class="packet-part packet-trailer">Trailer</div>
            </div>
            <div class="packet-details">
                <p><strong>Header:</strong> Contains recipient address, sender address, packet number (e.g., 2/5), TTL/hop limit</p>
                <p><strong>Payload:</strong> The actual data (500-1500 bytes typically)</p>
                <p><strong>Trailer:</strong> Error checking data (checksum/CRC)</p>
            </div>
        </div>
        <div class="main-content">
            <div class="simulation-area">
                <h2>Network Simulation</h2>
                <canvas id="simulationCanvas"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #667eea;"></div>
                        <span>Packet 1</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f093fb;"></div>
                        <span>Packet 2</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4facfe;"></div>
                        <span>Packet 3</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fa709a;"></div>
                        <span>Packet 4</span>
                    </div>
                </div>
                <div class="reassembly-area">
                    <h4>Reassembly at Destination</h4>
                    <div id="reassemblyDisplay">Waiting for packets...</div>
                </div>
            </div>
            <div class="control-panel">
                <div class="instructions">
                    <h3>📖 How to Use This Simulation</h3>
                    <ol>
                        <li>Click "Create Message" to see data being split into packets</li>
                        <li>Click "Send Packets" to transmit them through the network</li>
                        <li>Watch as each packet takes a different route</li>
                        <li>Observe packets arriving out of order</li>
                        <li>See how they&apos;re reassembled at the destination</li>
                        <li>Test your knowledge with the quiz below!</li>
                    </ol>
                </div>
                <div class="controls">
                    <button class="btn btn-primary" id="createMessage">Create Message</button>
                    <button class="btn btn-info" id="sendPackets" disabled>Send Packets</button>
                    <button class="btn btn-secondary" id="reset">Reset</button>
                </div>
                <div class="status">
                    <h4>Transmission Status</h4>
                    <p id="statusText">Ready to create message</p>
                </div>
                <div class="info-box">
                    <h4>💡 Key Points</h4>
                    <ul>
                        <li>Message broken into multiple packets</li>
                        <li>Each packet can take different route</li>
                        <li>Packets may arrive out of order</li>
                        <li>Reassembled using packet numbers</li>
                        <li>Error checking ensures integrity</li>
                        <li>More efficient for internet traffic</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="quiz-section">
            <h2>Test Your Understanding</h2>
            <div id="quizContainer"></div>
            <div class="controls">
                <button class="btn btn-primary" id="checkAnswers">Check Answers</button>
                <button class="btn btn-secondary" id="resetQuiz">Reset Quiz</button>
            </div>
            <div id="quizScore" style="margin-top: 20px; font-size: 1.2em; font-weight: bold;"></div>
        </div>
    </div>
    <div class="overlay" id="overlay"></div>
    <div class="popup" id="popup">
        <h3 id="popupTitle"></h3>
        <p id="popupContent"></p>
        <button class="btn btn-primary" onclick="closePopup()">Close</button>
    </div>
    <script>
        // Canvas setup
        const canvas = document.getElementById("simulationCanvas");
        const ctx = canvas.getContext("2d");
        
        // Set actual canvas size
        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
        }
        
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);
        // Network nodes
        const nodes = [
            { id: "A", x: 100, y: 225, label: "Sender" },
            { id: "R1", x: 250, y: 100, label: "Router 1" },
            { id: "R2", x: 250, y: 225, label: "Router 2" },
            { id: "R3", x: 250, y: 350, label: "Router 3" },
            { id: "R4", x: 450, y: 100, label: "Router 4" },
            { id: "R5", x: 450, y: 225, label: "Router 5" },
            { id: "R6", x: 450, y: 350, label: "Router 6" },
            { id: "R7", x: 650, y: 175, label: "Router 7" },
            { id: "R8", x: 650, y: 300, label: "Router 8" },
            { id: "B", x: 800, y: 225, label: "Receiver" }
        ];
        // Network connections
        const connections = [
            { from: "A", to: "R1" },
            { from: "A", to: "R2" },
            { from: "A", to: "R3" },
            { from: "R1", to: "R4" },
            { from: "R1", to: "R5" },
            { from: "R2", to: "R4" },
            { from: "R2", to: "R5" },
            { from: "R2", to: "R6" },
            { from: "R3", to: "R5" },
            { from: "R3", to: "R6" },
            { from: "R4", to: "R7" },
            { from: "R5", to: "R7" },
            { from: "R5", to: "R8" },
            { from: "R6", to: "R8" },
            { from: "R7", to: "B" },
            { from: "R8", to: "B" }
        ];
        // Different routes for packets
        const routes = [
            ["A", "R1", "R4", "R7", "B"],
            ["A", "R2", "R5", "R8", "B"],
            ["A", "R3", "R6", "R8", "B"],
            ["A", "R2", "R4", "R7", "B"]
        ];
        // State
        let packets = [];
        let messageCreated = false;
        let receivedPackets = [];
        let animationFrame = 0;
        // Packet colors
        const packetColors = ["#667eea", "#f093fb", "#4facfe", "#fa709a"];
        // Scale nodes to canvas size
        function scaleCoordinates() {
            const scaleX = canvas.width / 900;
            const scaleY = canvas.height / 450;
            
            return nodes.map(node => ({
                ...node,
                x: node.x * scaleX,
                y: node.y * scaleY
            }));
        }
        // Create packets from message
        function createMessage() {
            packets = [];
            receivedPackets = [];
            messageCreated = true;
            
            const message = "HELLO WORLD!";
            const packetSize = 3; // Characters per packet
            
            for (let i = 0; i < 4; i++) {
                const start = i * packetSize;
                const end = Math.min(start + packetSize, message.length);
                const data = message.substring(start, end);
                
                packets.push({
                    id: i + 1,
                    data: data,
                    route: routes[i],
                    position: 0,
                    x: 0,
                    y: 0,
                    color: packetColors[i],
                    ttl: 10,
                    speed: 2 + Math.random() * 2 // Variable speeds
                });
            }
            
            document.getElementById("statusText").textContent = "Message split into 4 packets";
            document.getElementById("sendPackets").disabled = false;
            document.getElementById("reassemblyDisplay").innerHTML = "Waiting for packets...";
            
            showPopup("Message Packetization", "Your message \"HELLO WORLD!\" has been split into 4 packets. Each packet contains a header with routing information, a portion of the data (payload), and error checking in the trailer.");
        }
        // Send packets
        function sendPackets() {
            document.getElementById("statusText").textContent = "Transmitting packets...";
            document.getElementById("sendPackets").disabled = true;
            
            // Start packets at slightly different times
            packets.forEach((packet, index) => {
                setTimeout(() => {
                    packet.active = true;
                }, index * 300);
            });
        }
        // Update packet positions
        function updatePackets() {
            const scaledNodes = scaleCoordinates();
            
            packets.forEach(packet => {
                if (!packet.active || packet.position >= packet.route.length - 1) return;
                
                const currentNode = scaledNodes.find(n => n.id === packet.route[Math.floor(packet.position)]);
                const nextNode = scaledNodes.find(n => n.id === packet.route[Math.floor(packet.position) + 1]);
                
                if (!currentNode || !nextNode) return;
                
                const progress = packet.position - Math.floor(packet.position);
                packet.x = currentNode.x + (nextNode.x - currentNode.x) * progress;
                packet.y = currentNode.y + (nextNode.y - currentNode.y) * progress;
                
                packet.position += packet.speed / 100;
                
                // Check if packet reached destination
                if (packet.position >= packet.route.length - 1) {
                    packet.position = packet.route.length - 1;
                    if (!receivedPackets.find(p => p.id === packet.id)) {
                        receivedPackets.push(packet);
                        updateReassembly();
                        
                        if (receivedPackets.length === packets.length) {
                            document.getElementById("statusText").textContent = "All packets received - Message reassembled!";
                            showPopup("Successful Transmission", "All packets have arrived at the destination. Notice how they may have arrived in a different order than they were sent, but the packet numbers allow proper reassembly.");
                        }
                    }
                }
            });
        }
        // Update reassembly display
        function updateReassembly() {
            const display = document.getElementById("reassemblyDisplay");
            display.innerHTML = "";
            
            // Sort by packet ID for proper reassembly
            const sorted = [...receivedPackets].sort((a, b) => a.id - b.id);
            
            sorted.forEach(packet => {
                const packetDiv = document.createElement("span");
                packetDiv.className = "received-packet";
                packetDiv.style.background = packet.color;
                packetDiv.textContent = `${packet.id}/4: ${packet.data}`;
                display.appendChild(packetDiv);
            });
            
            if (receivedPackets.length === packets.length) {
                const message = sorted.map(p => p.data).join("");
                display.innerHTML += `<div style="margin-top: 10px; font-weight: bold;">Reassembled: ${message}</div>`;
            }
        }
        // Draw network
        function drawNetwork() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const scaledNodes = scaleCoordinates();
            
            // Draw connections
            connections.forEach(conn => {
                const fromNode = scaledNodes.find(n => n.id === conn.from);
                const toNode = scaledNodes.find(n => n.id === conn.to);
                
                ctx.beginPath();
                ctx.moveTo(fromNode.x, fromNode.y);
                ctx.lineTo(toNode.x, toNode.y);
                ctx.strokeStyle = "#e0e0e0";
                ctx.lineWidth = 2;
                ctx.stroke();
            });
            
            // Draw active routes
            packets.forEach(packet => {
                if (!packet.active) return;
                
                ctx.strokeStyle = packet.color;
                ctx.lineWidth = 3;
                ctx.globalAlpha = 0.3;
                
                for (let i = 0; i < packet.route.length - 1; i++) {
                    const from = scaledNodes.find(n => n.id === packet.route[i]);
                    const to = scaledNodes.find(n => n.id === packet.route[i + 1]);
                    
                    ctx.beginPath();
                    ctx.moveTo(from.x, from.y);
                    ctx.lineTo(to.x, to.y);
                    ctx.stroke();
                }
                
                ctx.globalAlpha = 1;
            });
            
            // Draw nodes
            scaledNodes.forEach(node => {
                // Node circle
                ctx.fillStyle = node.id === "A" || node.id === "B" ? "#2196F3" : "#9e9e9e";
                ctx.beginPath();
                ctx.arc(node.x, node.y, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // Node border
                ctx.strokeStyle = "#333";
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Node label
                ctx.fillStyle = "#333";
                ctx.font = "bold 14px Arial";
                ctx.textAlign = "center";
                ctx.fillText(node.label, node.x, node.y - 30);
            });
            
            // Draw packets
            packets.forEach(packet => {
                if (!packet.active || packet.position >= packet.route.length - 1) return;
                
                // Packet visualization
                ctx.fillStyle = packet.color;
                ctx.strokeStyle = "#333";
                ctx.lineWidth = 2;
                
                // Draw packet as rectangle
                ctx.fillRect(packet.x - 20, packet.y - 10, 40, 20);
                ctx.strokeRect(packet.x - 20, packet.y - 10, 40, 20);
                
                // Packet label
                ctx.fillStyle = "white";
                ctx.font = "bold 12px Arial";
                ctx.textAlign = "center";
                ctx.fillText(`P${packet.id}`, packet.x, packet.y + 4);
            });
            
            // Draw message creation visualization
            if (messageCreated && packets.length > 0 && !packets[0].active) {
                const sender = scaledNodes.find(n => n.id === "A");
                
                packets.forEach((packet, index) => {
                    const y = sender.y - 60 + index * 25;
                    
                    ctx.fillStyle = packet.color;
                    ctx.fillRect(sender.x - 30, y - 10, 60, 20);
                    ctx.strokeStyle = "#333";
                    ctx.strokeRect(sender.x - 30, y - 10, 60, 20);
                    
                    ctx.fillStyle = "white";
                    ctx.font = "bold 12px Arial";
                    ctx.textAlign = "center";
                    ctx.fillText(`${packet.id}/4: ${packet.data}`, sender.x, y + 4);
                });
            }
        }
        // Animation loop
        function animate() {
            animationFrame++;
            updatePackets();
            drawNetwork();
            requestAnimationFrame(animate);
        }
        // Start animation
        animate();
        // Reset function
        function reset() {
            packets = [];
            receivedPackets = [];
            messageCreated = false;
            document.getElementById("statusText").textContent = "Ready to create message";
            document.getElementById("sendPackets").disabled = true;
            document.getElementById("reassemblyDisplay").innerHTML = "Waiting for packets...";
            resetQuiz();
        }
        // Event listeners
        document.getElementById("createMessage").addEventListener("click", createMessage);
        document.getElementById("sendPackets").addEventListener("click", sendPackets);
        document.getElementById("reset").addEventListener("click", reset);
        // Popup functions
        function showPopup(title, content) {
            document.getElementById("popupTitle").textContent = title;
            document.getElementById("popupContent").textContent = content;
            document.getElementById("popup").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        }
        function closePopup() {
            document.getElementById("popup").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }
        document.getElementById("overlay").addEventListener("click", closePopup);
        // Quiz data
        const quizQuestions = [
            {
                question: "What is the main characteristic of packet switching?",
                options: [
                    "A dedicated path is reserved for the entire communication",
                    "Messages are broken into parts and sent independently",
                    "All data must follow the same route",
                    "Connections are permanent once established"
                ],
                correct: 1,
                feedback: "In packet switching, messages are divided into packets that can travel independently via different routes."
            },
            {
                question: "What information is typically found in a packet header?",
                options: [
                    "Only the data being transmitted",
                    "Error checking codes",
                    "Recipient address, sender address, packet number, and TTL",
                    "Encryption keys"
                ],
                correct: 2,
                feedback: "The packet header contains routing information including addresses, packet sequence numbers, and Time To Live (TTL)."
            },
            {
                question: "What is the typical size range for a packet payload?",
                options: [
                    "10-50 bytes",
                    "500-1,500 bytes",
                    "10,000-50,000 bytes",
                    "Always exactly 1,000 bytes"
                ],
                correct: 1,
                feedback: "Packet payloads typically range from 500 to 1,500 bytes to balance efficiency and transmission time."
            },
            {
                question: "Why are packets kept relatively small?",
                options: [
                    "To save storage space",
                    "To prevent blocking other packets and balance efficiency",
                    "Because routers can&apos;t handle large packets",
                    "To reduce internet costs"
                ],
                correct: 1,
                feedback: "Small packets prevent any single packet from monopolizing network resources while maintaining efficiency."
            },
            {
                question: "What happens if a packet&apos;s checksum doesn&apos;t match at the destination?",
                options: [
                    "The packet is accepted anyway",
                    "The entire message is deleted",
                    "The packet is refused and a new copy is requested",
                    "The connection is permanently closed"
                ],
                correct: 2,
                feedback: "When error checking fails, the corrupted packet is rejected and the sender is asked to retransmit it."
            },
            {
                question: "How are packets reassembled in the correct order at the destination?",
                options: [
                    "They always arrive in order",
                    "Using packet numbers in the header",
                    "By checking the data content",
                    "Using timestamps only"
                ],
                correct: 1,
                feedback: "Packet numbers (e.g., 3/5) in the header allow proper reassembly regardless of arrival order."
            },
            {
                question: "What is the purpose of TTL (Time To Live) in a packet header?",
                options: [
                    "To specify data expiration date",
                    "To limit how many hops a packet can make",
                    "To set transmission speed",
                    "To encrypt the packet"
                ],
                correct: 1,
                feedback: "TTL prevents packets from circulating indefinitely by limiting the number of router hops."
            },
            {
                question: "In packet transmission within a LAN, what role does the server play?",
                options: [
                    "It creates all packets",
                    "It reads addresses and directs packets to recipients",
                    "It stores all packets permanently",
                    "It encrypts all data"
                ],
                correct: 1,
                feedback: "In a LAN, the server reads packet addresses and routes them to the appropriate recipients."
            }
        ];
        // Initialize quiz
        function initializeQuiz() {
            const container = document.getElementById("quizContainer");
            container.innerHTML = "";
            
            quizQuestions.forEach((q, index) => {
                const questionDiv = document.createElement("div");
                questionDiv.className = "quiz-question";
                questionDiv.innerHTML = `
                    <h3>Question ${index + 1}: ${q.question}</h3>
                    <div class="quiz-options">
                        ${q.options.map((option, optIndex) => `
                            <div class="quiz-option" data-question="${index}" data-option="${optIndex}">
                                ${option}
                            </div>
                        `).join("")}
                    </div>
                    <div class="quiz-feedback" id="feedback-${index}"></div>
                `;
                container.appendChild(questionDiv);
            });
            
            // Add click handlers
            document.querySelectorAll(".quiz-option").forEach(option => {
                option.addEventListener("click", selectOption);
            });
        }
        function selectOption(e) {
            const questionIndex = parseInt(e.target.dataset.question);
            const options = document.querySelectorAll(`.quiz-option[data-question="${questionIndex}"]`);
            
            options.forEach(opt => opt.classList.remove("selected"));
            e.target.classList.add("selected");
        }
        function checkAnswers() {
            let score = 0;
            
            quizQuestions.forEach((q, index) => {
                const selected = document.querySelector(`.quiz-option[data-question="${index}"].selected`);
                const feedback = document.getElementById(`feedback-${index}`);
                const options = document.querySelectorAll(`.quiz-option[data-question="${index}"]`);
                
                if (selected) {
                    const selectedIndex = parseInt(selected.dataset.option);
                    
                    options.forEach((opt, optIndex) => {
                        opt.classList.remove("correct", "incorrect");
                        if (optIndex === q.correct) {
                            opt.classList.add("correct");
                        } else if (optIndex === selectedIndex && selectedIndex !== q.correct) {
                            opt.classList.add("incorrect");
                        }
                    });
                    
                    if (selectedIndex === q.correct) {
                        score++;
                        feedback.className = "quiz-feedback correct";
                        feedback.textContent = "✓ Correct! " + q.feedback;
                    } else {
                        feedback.className = "quiz-feedback incorrect";
                        feedback.textContent = "✗ Incorrect. " + q.feedback;
                    }
                    feedback.style.display = "block";
                }
            });
            
            const scoreDiv = document.getElementById("quizScore");
            scoreDiv.textContent = `Your Score: ${score}/${quizQuestions.length} (${Math.round(score/quizQuestions.length * 100)}%)`;
            
            if (score === quizQuestions.length) {
                scoreDiv.style.color = "#4CAF50";
                showPopup("Excellent!", "Perfect score! You have mastered the concept of packet switching.");
            } else if (score >= quizQuestions.length * 0.7) {
                scoreDiv.style.color = "#ff9800";
                showPopup("Good Job!", "You have a solid understanding of packet switching. Review the incorrect answers to improve further.");
            } else {
                scoreDiv.style.color = "#f44336";
                showPopup("Keep Practicing", "Review the feedback for each question and try the simulation again to better understand packet switching.");
            }
        }
        function resetQuiz() {
            document.querySelectorAll(".quiz-option").forEach(option => {
                option.classList.remove("selected", "correct", "incorrect");
            });
            document.querySelectorAll(".quiz-feedback").forEach(feedback => {
                feedback.style.display = "none";
            });
            document.getElementById("quizScore").textContent = "";
        }
        // Initialize quiz on load
        initializeQuiz();
        // Quiz event listeners
        document.getElementById("checkAnswers").addEventListener("click", checkAnswers);
        document.getElementById("resetQuiz").addEventListener("click", resetQuiz);
    </script>
</body>
</html>'
                    ></iframe>
                </div>

                <div class="task-box">
                    <div class="task-header">
                        <div class="task-title">Understanding Data Packets</div>
                        <button class="reset-btn" onclick="resetSection(2)">🔄 Reset</button>
                    </div>

                    <div class="question">
                        <p><strong>Define a data packet in your own words:</strong></p>
                        <textarea class="input-field" id="packet-definition" rows="4" 
                                placeholder="Write your definition here... (Aim for at least 20 words)"
                                oninput="checkDefinitionLength('packet-definition', 'packet-mark1', ['unit', 'data', 'package', 'travels', 'network', 'path'], 20)"></textarea>
                        <div class="mark-scheme" id="packet-mark1">
                            <strong>Sample Answer:</strong> A data packet is a unit of data made into a single package that travels along a given network path. It contains both the actual data being transmitted and control information needed for routing and delivery.
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>Arrange these steps of packet switching in the correct order:</strong></p>
                        <div class="drag-drop-area" id="packet-sequence">
                            <div style="text-align: center; margin-bottom: 20px;">
                                <strong>Available Steps (click to select, then click position):</strong>
                            </div>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px;">
                                <div class="drag-item" onclick="selectSequenceItem(this, 4)">4. Reassembled at destination</div>
                                <div class="drag-item" onclick="selectSequenceItem(this, 1)">1. Message broken into packets</div>
                                <div class="drag-item" onclick="selectSequenceItem(this, 3)">3. Travel via optimum routes</div>
                                <div class="drag-item" onclick="selectSequenceItem(this, 2)">2. Packets sent independently</div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                                <div class="drop-zone" data-position="1" onclick="dropSequence(this)">Position 1</div>
                                <div class="drop-zone" data-position="2" onclick="dropSequence(this)">Position 2</div>
                                <div class="drop-zone" data-position="3" onclick="dropSequence(this)">Position 3</div>
                                <div class="drop-zone" data-position="4" onclick="dropSequence(this)">Position 4</div>
                            </div>
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>Multiple Choice: Packet switching is used in:</strong></p>
                        <div class="options" id="packet-usage">
                            <div class="option" onclick="selectOption(this, 'packet-usage', false)">Telephone networks only</div>
                            <div class="option" onclick="selectOption(this, 'packet-usage', true)">Internet Protocol (IP) transmissions and Web navigation</div>
                            <div class="option" onclick="selectOption(this, 'packet-usage', false)">Radio broadcasts only</div>
                            <div class="option" onclick="selectOption(this, 'packet-usage', false)">Satellite communications only</div>
                        </div>
                    </div>
                </div>

                <div class="real-world-box">
                    <h3>🌍 Real-World Example</h3>
                    <p>When you send an email with a photo attachment, the email is broken into hundreds of small packets. Each packet finds its own way through the internet - some might go through London, others through Manchester, but they all arrive at the destination where your email is perfectly reconstructed!</p>
                </div>
            </div>

            <!-- Section 3: Routers -->
            <div class="section" id="section3">
                <h2>🔀 Router Functions and Packet Routing</h2>

                <div class="task-box">
                    <div class="task-header">
                        <div class="task-title">Router Operations</div>
                        <button class="reset-btn" onclick="resetSection(3)">🔄 Reset</button>
                    </div>

                    <div class="simulation-box">
                        <h3>🎯 Router Simulation</h3>
                        <div id="router-simulation">
                            <div style="text-align: center; margin: 20px 0;">
                                <button class="nav-btn" onclick="startRouterDemo()">▶️ Start Router Demo</button>
                            </div>
                            <div id="router-demo" style="display: none;">
                                <div class="simulation-step" id="demo-step1">
                                    <strong>Step 1:</strong> Packet arrives at Router A with destination IP 192.168.1.100
                                </div>
                                <div class="simulation-step" id="demo-step2" style="display: none;">
                                    <strong>Step 2:</strong> Router looks up destination in routing table
                                </div>
                                <div class="simulation-step" id="demo-step3" style="display: none;">
                                    <strong>Step 3:</strong> Router finds best path and forwards packet (Hop 1)
                                </div>
                                <div class="simulation-step" id="demo-step4" style="display: none;">
                                    <strong>Step 4:</strong> Process repeats at each router until destination reached
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>Fill in the missing words:</strong></p>
                        <p>Routers connect two or more _______ and can act as a hardware _______. Each router stores data about available routes in a _______ _______.</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 20px 0;">
                            <select class="input-field" id="router-blank1">
                                <option value="">First blank...</option>
                                <option value="computers">computers</option>
                                <option value="networks">networks</option>
                                <option value="cables">cables</option>
                                <option value="protocols">protocols</option>
                                <option value="switches">switches</option>
                            </select>
                            <select class="input-field" id="router-blank2">
                                <option value="">Second blank...</option>
                                <option value="router">router</option>
                                <option value="firewall">firewall</option>
                                <option value="switch">switch</option>
                                <option value="gateway">gateway</option>
                                <option value="modem">modem</option>
                            </select>
                            <select class="input-field" id="router-blank3">
                                <option value="">Third blank...</option>
                                <option value="routing table">routing table</option>
                                <option value="network card">network card</option>
                                <option value="memory bank">memory bank</option>
                                <option value="data cache">data cache</option>
                                <option value="address book">address book</option>
                            </select>
                        </div>
                        <button class="nav-btn" onclick="checkRouterBlanks()" style="margin: 10px 0;">Check Answers</button>
                        <div class="mark-scheme" id="router-blanks-mark">
                            <strong>Correct Answers:</strong>
                            <ul>
                                <li>networks - Routers connect different networks together</li>
                                <li>firewall - Routers can provide security by filtering traffic</li>
                                <li>routing table - This stores information about available network paths</li>
                            </ul>
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>What is a 'hop' in networking?</strong></p>
                        <div class="options" id="hop-definition">
                            <div class="option" onclick="selectOption(this, 'hop-definition', false)">The speed at which data travels</div>
                            <div class="option" onclick="selectOption(this, 'hop-definition', true)">Each forwarding of a packet by a router</div>
                            <div class="option" onclick="selectOption(this, 'hop-definition', false)">The distance between two computers</div>
                            <div class="option" onclick="selectOption(this, 'hop-definition', false)">A type of network cable</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Continue with more sections... -->
            <!-- For brevity, I'll continue with a few more key sections -->

            <!-- Section 4: Packet Structure -->
            <div class="section" id="section4">
                <h2>🏗️ Packet Structure Deep Dive</h2>

                <div class="task-box">
                    <div class="task-header">
                        <div class="task-title">Packet Components</div>
                        <button class="reset-btn" onclick="resetSection(4)">🔄 Reset</button>
                    </div>

                    <div class="question">
                        <p><strong>Label the packet diagram:</strong></p>
                        <div style="text-align: center; margin: 20px 0;">
                            <svg width="400" height="200" style="border: 1px solid #ccc;">
                                <rect x="50" y="50" width="100" height="40" fill="#3498db" stroke="#2980b9"/>
                                <rect x="150" y="50" width="200" height="40" fill="#2ecc71" stroke="#27ae60"/>
                                <rect x="350" y="50" width="100" height="40" fill="#e74c3c" stroke="#c0392b"/>
                                
                                <text x="100" y="75" text-anchor="middle" fill="white" font-weight="bold">?</text>
                                <text x="250" y="75" text-anchor="middle" fill="white" font-weight="bold">?</text>
                                <text x="400" y="75" text-anchor="middle" fill="white" font-weight="bold">?</text>
                                
                                <line x1="100" y1="90" x2="100" y2="120" stroke="#333"/>
                                <line x1="250" y1="90" x2="250" y2="120" stroke="#333"/>
                                <line x1="400" y1="90" x2="400" y2="120" stroke="#333"/>
                            </svg>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                            <select class="input-field" id="packet-label1">
                                <option value="">Label 1...</option>
                                <option value="Header">Header</option>
                                <option value="Payload">Payload</option>
                                <option value="Trailer">Trailer</option>
                                <option value="Address">Address</option>
                            </select>
                            <select class="input-field" id="packet-label2">
                                <option value="">Label 2...</option>
                                <option value="Header">Header</option>
                                <option value="Payload">Payload</option>
                                <option value="Trailer">Trailer</option>
                                <option value="Body">Body</option>
                            </select>
                            <select class="input-field" id="packet-label3">
                                <option value="">Label 3...</option>
                                <option value="Header">Header</option>
                                <option value="Payload">Payload</option>
                                <option value="Trailer">Trailer</option>
                                <option value="Footer">Footer</option>
                            </select>
                        </div>
                        <button class="nav-btn" onclick="checkPacketLabels()" style="margin: 10px 0;">Check Labels</button>
                    </div>

                    <div class="question">
                        <p><strong>Why are packets kept small? Select all correct reasons:</strong></p>
                        <div id="packet-size-reasons">
                            <div class="option" onclick="toggleMultiSelect(this, true)">To ensure individual packets don't take too long to transfer</div>
                            <div class="option" onclick="toggleMultiSelect(this, true)">To prevent blocking other packets from moving</div>
                            <div class="option" onclick="toggleMultiSelect(this, false)">To make them easier to lose</div>
                            <div class="option" onclick="toggleMultiSelect(this, false)">To increase the total transmission time</div>
                            <div class="option" onclick="toggleMultiSelect(this, true)">Balance efficiency - not too small to avoid too many headers</div>
                        </div>
                        <button class="nav-btn" onclick="checkMultiSelect('packet-size-reasons')" style="margin: 10px 0;">Check Selection</button>
                    </div>
                </div>

                <div class="canvas-container">
                    <h3>✏️ Draw a Packet Structure</h3>
                    <p>Draw and label a simple packet structure showing header, payload, and trailer:</p>
                    <canvas id="drawingCanvas" class="drawing-canvas" width="600" height="300"></canvas>
                    <div class="canvas-controls">
                        <button class="canvas-btn" onclick="clearCanvas()">🗑️ Clear</button>
                        <button class="canvas-btn" onclick="changeCanvasColor('#000000')">⚫ Black</button>
                        <button class="canvas-btn" onclick="changeCanvasColor('#3498db')">🔵 Blue</button>
                        <button class="canvas-btn" onclick="changeCanvasColor('#e74c3c')">🔴 Red</button>
                        <button class="canvas-btn" onclick="changeCanvasColor('#2ecc71')">🟢 Green</button>
                    </div>
                </div>
            </div>

            <!-- Section 8: Practice Exam Questions -->
            <div class="section" id="section8">
                <h2>📝 Practice Exam Questions</h2>

                <div class="task-box">
                    <div class="task-header">
                        <div class="task-title">Exam Practice</div>
                        <button class="reset-btn" onclick="resetSection(8)">🔄 Reset</button>
                    </div>

                    <div class="question">
                        <p><strong>[6 marks] Explain the difference between circuit switching and packet switching, giving one advantage of each method.</strong></p>
                        <textarea class="input-field" id="exam-q1" rows="8" 
                                placeholder="Write your answer here..."
                                oninput="updateExamProgress('exam-q1', 6)"></textarea>
                        <div style="margin: 10px 0;">
                            <strong>Self-Assessment:</strong>
                            <input type="number" id="exam-q1-marks" min="0" max="6" placeholder="?/6 marks" 
                                   style="width: 80px; padding: 5px; margin-left: 10px;" 
                                   onchange="updateTotalMarks()">
                        </div>
                        <button class="nav-btn" onclick="showExamMarkScheme('exam-q1-marks', 'exam-mark1', 30)">📋 Show Mark Scheme</button>
                        <div class="mark-scheme" id="exam-mark1">
                            <strong>Mark Scheme (6 marks):</strong>
                            <ul>
                                <li><strong>Circuit Switching (3 marks):</strong>
                                    <ul>
                                        <li>Dedicated communication channel/path established (1)</li>
                                        <li>Maintained for duration of call/transmission (1)</li>
                                        <li>Advantage: Guaranteed bandwidth/quality of service (1)</li>
                                    </ul>
                                </li>
                                <li><strong>Packet Switching (3 marks):</strong>
                                    <ul>
                                        <li>Data broken into packets (1)</li>
                                        <li>Packets sent independently via different routes (1)</li>
                                        <li>Advantage: Efficient use of network resources/better fault tolerance (1)</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>[4 marks] Describe the role of a router in packet transmission.</strong></p>
                        <textarea class="input-field" id="exam-q2" rows="6" 
                                placeholder="Write your answer here..."
                                oninput="updateExamProgress('exam-q2', 4)"></textarea>
                        <div style="margin: 10px 0;">
                            <strong>Self-Assessment:</strong>
                            <input type="number" id="exam-q2-marks" min="0" max="4" placeholder="?/4 marks" 
                                   style="width: 80px; padding: 5px; margin-left: 10px;"
                                   onchange="updateTotalMarks()">
                        </div>
                        <button class="nav-btn" onclick="showExamMarkScheme('exam-q2-marks', 'exam-mark2', 25)">📋 Show Mark Scheme</button>
                        <div class="mark-scheme" id="exam-mark2">
                            <strong>Mark Scheme (4 marks):</strong>
                            <ul>
                                <li>Connects two or more networks (1)</li>
                                <li>Forwards data packets from one network to another (1)</li>
                                <li>Uses routing table to determine best path (1)</li>
                                <li>Each forwarding is called a hop (1)</li>
                            </ul>
                        </div>
                    </div>

                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <strong>Total Predicted Score: <span id="totalMarks">0</span>/10 marks</strong>
                        <div style="margin-top: 10px;">
                            <div style="background: #dee2e6; height: 20px; border-radius: 10px; overflow: hidden;">
                                <div id="scoreBar" style="background: linear-gradient(90deg, #e74c3c, #f39c12, #2ecc71); height: 100%; width: 0%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 9: Extension Activities -->
            <div class="section" id="section9">
                <h2>🚀 Extension Activities</h2>

                <div class="extension-activity">
                    <h3>🔬 Research Project: Modern Network Protocols</h3>
                    <p>Research and compare IPv4 and IPv6 packet structures. How do they differ and why was IPv6 developed?</p>
                    <textarea class="input-field" rows="6" 
                              placeholder="Write your research findings here..."
                              oninput="awardExtensionXP(this, ['IPv4', 'IPv6', 'address', 'space', 'header', 'security'])"></textarea>
                </div>

                <div class="extension-activity">
                    <h3>🌐 Critical Thinking: Network Security</h3>
                    <p>Packet filtering is one method of network security. Research and explain two other methods networks use to maintain security.</p>
                    <textarea class="input-field" rows="6" 
                              placeholder="Explain two other network security methods..."
                              oninput="awardExtensionXP(this, ['encryption', 'VPN', 'firewall', 'authentication', 'intrusion', 'detection'])"></textarea>
                </div>

                <div class="extension-activity">
                    <h3>💡 Problem Solving: Network Design</h3>
                    <p>A company wants to connect three offices in different cities. Design a network solution explaining your choice of circuit switching vs packet switching and justify your decision.</p>
                    <textarea class="input-field" rows="8" 
                              placeholder="Design your network solution..."
                              oninput="awardExtensionXP(this, ['cost', 'reliability', 'bandwidth', 'scalability', 'maintenance', 'performance'])"></textarea>
                </div>
            </div>

            <!-- Section 10: Summary Quiz -->
            <div class="section" id="section10">
                <h2>🎯 Summary Quiz</h2>

                <div class="task-box">
                    <div class="task-header">
                        <div class="task-title">Final Understanding Check</div>
                        <button class="reset-btn" onclick="resetSection(10)">🔄 Reset</button>
                    </div>

                    <div class="question">
                        <p><strong>1. What is the main advantage of packet switching over circuit switching for internet traffic?</strong></p>
                        <div class="options" id="summary-q1">
                            <div class="option" onclick="selectOption(this, 'summary-q1', false)">It's faster for all types of data</div>
                            <div class="option" onclick="selectOption(this, 'summary-q1', true)">More efficient use of network resources</div>
                            <div class="option" onclick="selectOption(this, 'summary-q1', false)">It requires less equipment</div>
                            <div class="option" onclick="selectOption(this, 'summary-q1', false)">It's more secure</div>
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>2. A packet header contains:</strong></p>
                        <div class="options" id="summary-q2">
                            <div class="option" onclick="selectOption(this, 'summary-q2', false)">Only the sender's address</div>
                            <div class="option" onclick="selectOption(this, 'summary-q2', false)">Only the recipient's address</div>
                            <div class="option" onclick="selectOption(this, 'summary-q2', true)">Recipient address, sender address, packet number, and TTL</div>
                            <div class="option" onclick="selectOption(this, 'summary-q2', false)">The actual data being transmitted</div>
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>3. Why might a company choose a dedicated line between buildings?</strong></p>
                        <div class="options" id="summary-q3">
                            <div class="option" onclick="selectOption(this, 'summary-q3', false)">It's always cheaper</div>
                            <div class="option" onclick="selectOption(this, 'summary-q3', true)">Faster and more consistent transmission speed</div>
                            <div class="option" onclick="selectOption(this, 'summary-q3', false)">It uses packet switching</div>
                            <div class="option" onclick="selectOption(this, 'summary-q3', false)">It requires no maintenance</div>
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>4. A gateway is required when:</strong></p>
                        <div class="options" id="summary-q4">
                            <div class="option" onclick="selectOption(this, 'summary-q4', false)">Connecting devices on the same network</div>
                            <div class="option" onclick="selectOption(this, 'summary-q4', true)">Data travels between networks using different protocols</div>
                            <div class="option" onclick="selectOption(this, 'summary-q4', false)">Sending emails</div>
                            <div class="option" onclick="selectOption(this, 'summary-q4', false)">Browsing websites</div>
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>5. Packet filtering works by:</strong></p>
                        <div class="options" id="summary-q5">
                            <div class="option" onclick="selectOption(this, 'summary-q5', true)">Inspecting packets to check which port they're trying to access</div>
                            <div class="option" onclick="selectOption(this, 'summary-q5', false)">Encrypting all data packets</div>
                            <div class="option" onclick="selectOption(this, 'summary-q5', false)">Compressing packets to save bandwidth</div>
                            <div class="option" onclick="selectOption(this, 'summary-q5', false)">Routing packets via the fastest path</div>
                        </div>
                    </div>

                    <div class="question">
                        <p><strong>6. PSTN uses:</strong></p>
                        <div class="options" id="summary-q6">
                            <div class="option" onclick="selectOption(this, 'summary-q6', false)">Packet switching exclusively</div>
                            <div class="option" onclick="selectOption(this, 'summary-q6', true)">Circuit switching with full duplex transmission</div>
                            <div class="option" onclick="selectOption(this, 'summary-q6', false)">Only wireless connections</div>
                            <div class="option" onclick="selectOption(this, 'summary-q6', false)">Half duplex transmission only</div>
                        </div>
                    </div>

                    <button class="nav-btn" onclick="calculateSummaryScore()" style="margin: 20px 0; font-size: 16px; padding: 12px 24px;">📊 Calculate Final Score</button>
                    
                    <div id="summaryResults" style="display: none; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
                        <h3>🎉 Quiz Complete!</h3>
                        <div style="font-size: 24px; margin: 15px 0;">
                            Score: <span id="finalScore">0</span>/6
                        </div>
                        <div id="scoreMessage"></div>
                    </div>
                </div>
            </div>

            <!-- Section 11: Videos -->
            <div class="section" id="section11">
                <h2>📺 Video Resources</h2>
                
                <div style="background: #f8f9fa; padding: 30px; border-radius: 10px; text-align: center;">
                    <h3>📹 Educational Videos</h3>
                    <p>Video content will be embedded here to support learning:</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div style="background: white; padding: 20px; border-radius: 8px; border: 2px dashed #dee2e6;">
                            <h4>🎬 Circuit vs Packet Switching</h4>
                            <p>Visual explanation of the differences</p>
                            <div style="background: #f1f3f4; height: 150px; margin: 10px 0; border-radius: 5px; display: flex; align-items: center; justify-content: center;">
                                <span style="color: #6c757d;">Video Placeholder</span>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 8px; border: 2px dashed #dee2e6;">
                            <h4>🎬 How Routers Work</h4>
                            <p>Detailed router operation demonstration</p>
                            <div style="background: #f1f3f4; height: 150px; margin: 10px 0; border-radius: 5px; display: flex; align-items: center; justify-content: center;">
                                <span style="color: #6c757d;">Video Placeholder</span>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 8px; border: 2px dashed #dee2e6;">
                            <h4>🎬 Packet Structure Analysis</h4>
                            <p>Deep dive into packet components</p>
                            <div style="background: #f1f3f4; height: 150px; margin: 10px 0; border-radius: 5px; display: flex; align-items: center; justify-content: center;">
                                <span style="color: #6c757d;">Video Placeholder</span>
                            </div>
                        </div>
                    </div>
                    
                    <p style="color: #6c757d; font-style: italic;">Videos will be added by the instructor to enhance learning experience.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Button -->
    <button class="feedback-btn" onclick="openFeedback()">💬</button>

    <!-- Feedback Modal -->
    <div class="feedback-modal" id="feedbackModal">
        <div class="feedback-content">
            <h3>📝 Feedback & Bug Reports</h3>
            <p>Help us improve this lesson! Report bugs or suggest features:</p>
            
            <div style="margin: 15px 0;">
                <label for="feedbackType"><strong>Type:</strong></label>
                <select id="feedbackType" class="input-field">
                    <option value="bug">🐛 Bug Report</option>
                    <option value="feature">💡 Feature Request</option>
                    <option value="improvement">📈 Improvement Suggestion</option>
                    <option value="content">📚 Content Issue</option>
                </select>
            </div>
            
            <div style="margin: 15px 0;">
                <label for="feedbackText"><strong>Description:</strong></label>
                <textarea id="feedbackText" class="input-field" rows="6" 
                          placeholder="Please describe the issue or suggestion in detail..."></textarea>
            </div>
            
            <div style="margin: 15px 0; font-size: 12px; color: #6c757d;">
                <strong>Current Location:</strong> <span id="currentLocation"></span><br>
                <strong>Page Section:</strong> <span id="currentSection"></span>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="nav-btn" onclick="closeFeedback()" style="background: #6c757d;">Cancel</button>
                <button class="nav-btn" onclick="submitFeedback()">Send Feedback</button>
            </div>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievementPopup" style="display: none;">
        <h3 id="achievementTitle">🎉 Achievement Unlocked!</h3>
        <p id="achievementText">Great job!</p>
        <div id="achievementXP" style="margin-top: 10px;"></div>
    </div>

    <script>
        // Global variables
        let currentSection = 0;
        let currentXP = 0;
        let currentLevel = 1;
        let maxXP = 100;
        let completedActions = new Set();
        let selectedMatchItem = null;
        let selectedSequenceItem = null;
        let hintPenalty = 0;
        let isDrawing = false;
        let canvas, ctx;
        let currentColor = '#000000';

        // Achievement definitions
        const achievements = [
            { id: 'first_correct', name: 'First Success', description: 'Got your first answer correct!', xp: 10 },
            { id: 'quick_learner', name: 'Quick Learner', description: 'Completed starter activity!', xp: 15 },
            { id: 'packet_master', name: 'Packet Master', description: 'Mastered packet concepts!', xp: 20 },
            { id: 'router_expert', name: 'Router Expert', description: 'Understanding router operations!', xp: 20 },
            { id: 'exam_ready', name: 'Exam Ready', description: 'Completed practice questions!', xp: 25 },
            { id: 'extension_explorer', name: 'Extension Explorer', description: 'Completed extension activities!', xp: 30 },
            { id: 'summary_champion', name: 'Summary Champion', description: 'Aced the summary quiz!', xp: 25 },
            { id: 'max_level', name: 'Network Expert', description: 'Reached maximum level!', xp: 50 }
        ];

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeCanvas();
            setupPasteProtection();
            updateXPDisplay();
            addSwipeSupport();
            setupAccessibility();
        });

        // Accessibility functions
        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
        }

        function toggleDyslexiaFont() {
            document.body.classList.toggle('dyslexia-font');
        }

        function changeFontSize(size) {
            document.body.classList.remove('font-size-small', 'font-size-medium', 'font-size-large', 'font-size-xl');
            document.body.classList.add('font-size-' + size);
        }

        function setupAccessibility() {
            // Add keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'ArrowLeft':
                            e.preventDefault();
                            previousSection();
                            break;
                        case 'ArrowRight':
                            e.preventDefault();
                            nextSection();
                            break;
                    }
                }
            });

            // Add ARIA labels
            const sections = document.querySelectorAll('.section');
            sections.forEach((section, index) => {
                section.setAttribute('aria-label', `Section ${index + 1}`);
                section.setAttribute('role', 'main');
            });
        }

        // Navigation functions
        function showSection(sectionIndex) {
            const sections = document.querySelectorAll('.section');
            const navBtns = document.querySelectorAll('.nav-sections .nav-btn');
            
            // Hide all sections
            sections.forEach(section => section.classList.remove('active'));
            
            // Show selected section
            if (sections[sectionIndex]) {
                sections[sectionIndex].classList.add('active');
            }
            
            // Update navigation
            navBtns.forEach(btn => btn.classList.remove('active'));
            if (navBtns[sectionIndex]) {
                navBtns[sectionIndex].classList.add('active');
            }
            
            currentSection = sectionIndex;
            
            // Update feedback location
            updateFeedbackLocation();
        }

        function nextSection() {
            const sections = document.querySelectorAll('.section');
            if (currentSection < sections.length - 1) {
                showSection(currentSection + 1);
            }
        }

        function previousSection() {
            if (currentSection > 0) {
                showSection(currentSection - 1);
            }
        }

        // XP and Achievement System
        function awardXP(amount, actionId = null) {
            if (actionId && completedActions.has(actionId)) {
                return; // Don't award XP for repeated actions
            }
            
            if (actionId) {
                completedActions.add(actionId);
            }
            
            // Apply hint penalty
            const finalAmount = Math.max(1, amount - hintPenalty);
            currentXP += finalAmount;
            
            // Reset hint penalty after use
            hintPenalty = 0;
            
            // Check for level up
            while (currentXP >= maxXP && currentLevel < 5) {
                currentLevel++;
                currentXP -= maxXP;
                maxXP = Math.floor(maxXP * 1.2); // Increase XP requirement
                showAchievement('Level Up!', `You reached level ${currentLevel}!`, 20);
                
                if (currentLevel === 5) {
                    unlockAchievement('max_level');
                }
            }
            
            updateXPDisplay();
            createParticles();
            
            // Haptic feedback on mobile
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }

        function updateXPDisplay() {
            document.getElementById('currentXP').textContent = currentXP;
            document.getElementById('maxXP').textContent = maxXP;
            document.getElementById('currentLevel').textContent = currentLevel;
            
            const percentage = (currentXP / maxXP) * 100;
            document.getElementById('xpFill').style.width = percentage + '%';
        }

        function unlockAchievement(achievementId) {
            const achievement = achievements.find(a => a.id === achievementId);
            if (achievement && !completedActions.has('achievement_' + achievementId)) {
                completedActions.add('achievement_' + achievementId);
                showAchievement(achievement.name, achievement.description, achievement.xp);
                awardXP(achievement.xp);
            }
        }

        function showAchievement(title, description, xp) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementTitle').textContent = '🎉 ' + title;
            document.getElementById('achievementText').textContent = description;
            document.getElementById('achievementXP').textContent = '+' + xp + ' XP';
            
            popup.style.display = 'block';
            setTimeout(() => {
                popup.style.display = 'none';
            }, 3000);
        }

        function createParticles() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = Math.random() * window.innerHeight + 'px';
                    document.body.appendChild(particle);
                    
                    setTimeout(() => {
                        particle.remove();
                    }, 1000);
                }, i * 100);
            }
        }

        // Question handling functions
        function selectOption(element, groupId, isCorrect) {
            if (completedActions.has(groupId)) return;
            
            const options = document.querySelectorAll(`#${groupId} .option`);
            options.forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });
            
            element.classList.add('selected');
            
            setTimeout(() => {
                if (isCorrect) {
                    element.classList.add('correct');
                    awardXP(10, groupId);
                    
                    if (groupId === 'starter-q1' || groupId === 'starter-q2') {
                        checkStarterComplete();
                    }
                } else {
                    element.classList.add('incorrect');
                    options.forEach(opt => {
                        if (opt.onclick.toString().includes('true')) {
                            opt.classList.add('correct');
                        }
                    });
                }
            }, 500);
        }

        function checkStarterComplete() {
            if (completedActions.has('starter-q1') && completedActions.has('starter-q2')) {
                setTimeout(() => {
                    unlockAchievement('quick_learner');
                }, 1000);
            }
        }

        // Matching exercise functions
        function selectForMatching(element, value) {
            document.querySelectorAll('.drag-item').forEach(item => {
                item.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedMatchItem = { element: element, value: value };
        }

        function dropMatch(dropZone) {
            if (!selectedMatchItem) return;
            
            const isCorrect = selectedMatchItem.value === dropZone.dataset.answer;
            
            if (isCorrect) {
                dropZone.textContent = selectedMatchItem.value + ': ' + dropZone.textContent;
                dropZone.classList.add('filled');
                selectedMatchItem.element.style.display = 'none';
                awardXP(5, 'match_' + selectedMatchItem.value);
                
                // Check if all matches complete
                const filledZones = document.querySelectorAll('#starter-matching .drop-zone.filled');
                if (filledZones.length === 3) {
                    unlockAchievement('first_correct');
                }
            }
            
            selectedMatchItem = null;
        }

        // Sequence exercise functions
        function selectSequenceItem(element, correctPosition) {
            document.querySelectorAll('.drag-item').forEach(item => {
                item.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedSequenceItem = { element: element, position: correctPosition };
        }

        function dropSequence(dropZone) {
            if (!selectedSequenceItem) return;
            
            const targetPosition = parseInt(dropZone.dataset.position);
            const isCorrect = selectedSequenceItem.position === targetPosition;
            
            if (isCorrect) {
                dropZone.textContent = selectedSequenceItem.element.textContent;
                dropZone.classList.add('filled');
                selectedSequenceItem.element.style.display = 'none';
                awardXP(5, 'sequence_' + targetPosition);
            }
            
            selectedSequenceItem = null;
        }

        // Fill-in-blank functions
        function checkCircuitBlank() {
            const answer = document.getElementById('circuit-blank1').value;
            if (answer === 'dedicated') {
                document.getElementById('circuit-mark1').classList.add('show');
                awardXP(10, 'circuit-blank1');
            }
        }

        function checkDefinitionLength(inputId, markSchemeId, keywords, minLength) {
            const input = document.getElementById(inputId);
            const markScheme = document.getElementById(markSchemeId);
            const text = input.value.toLowerCase();
            const words = text.split(/\s+/).filter(word => word.length > 2);
            
            if (words.length >= minLength) {
                let keywordCount = 0;
                keywords.forEach(keyword => {
                    if (text.includes(keyword.toLowerCase())) {
                        keywordCount++;
                    }
                });
                
                if (keywordCount >= Math.floor(keywords.length * 0.6)) {
                    markScheme.classList.add('show');
                    awardXP(15, inputId);
                }
            }
        }

        // Router simulation
        function startRouterDemo() {
            const steps = ['demo-step1', 'demo-step2', 'demo-step3', 'demo-step4'];
            document.getElementById('router-demo').style.display = 'block';
            
            steps.forEach((stepId, index) => {
                setTimeout(() => {
                    document.getElementById(stepId).style.display = 'block';
                    if (index === steps.length - 1) {
                        awardXP(15, 'router-demo');
                    }
                }, index * 1500);
            });
        }

        function checkRouterBlanks() {
            const blank1 = document.getElementById('router-blank1').value;
            const blank2 = document.getElementById('router-blank2').value;
            const blank3 = document.getElementById('router-blank3').value;
            
            let correctCount = 0;
            if (blank1 === 'networks') correctCount++;
            if (blank2 === 'firewall') correctCount++;
            if (blank3 === 'routing table') correctCount++;
            
            if (correctCount >= 2) {
                document.getElementById('router-blanks-mark').classList.add('show');
                awardXP(15, 'router-blanks');
                
                if (correctCount === 3) {
                    unlockAchievement('router_expert');
                }
            }
        }

        // Packet labeling
        function checkPacketLabels() {
            const label1 = document.getElementById('packet-label1').value;
            const label2 = document.getElementById('packet-label2').value;
            const label3 = document.getElementById('packet-label3').value;
            
            let correct = 0;
            if (label1 === 'Header') correct++;
            if (label2 === 'Payload') correct++;
            if (label3 === 'Trailer') correct++;
            
            if (correct >= 2) {
                awardXP(15, 'packet-labels');
                if (correct === 3) {
                    unlockAchievement('packet_master');
                }
            }
        }

        // Multi-select handling
        function toggleMultiSelect(element, isCorrect) {
            element.classList.toggle('selected');
            element.dataset.correct = isCorrect;
        }

        function checkMultiSelect(containerId) {
            const container = document.getElementById(containerId);
            const selected = container.querySelectorAll('.option.selected');
            let correctSelected = 0;
            let totalCorrect = 0;
            
            container.querySelectorAll('.option').forEach(option => {
                if (option.dataset.correct === 'true') {
                    totalCorrect++;
                    if (option.classList.contains('selected')) {
                        correctSelected++;
                        option.classList.add('correct');
                    }
                } else if (option.classList.contains('selected')) {
                    option.classList.add('incorrect');
                }
            });
            
            if (correctSelected === totalCorrect && selected.length === totalCorrect) {
                awardXP(20, containerId);
            }
        }

        // Canvas functions
        function initializeCanvas() {
            canvas = document.getElementById('drawingCanvas');
            if (canvas) {
                ctx = canvas.getContext('2d');
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                
                // Mouse events
                canvas.addEventListener('mousedown', startDrawing);
                canvas.addEventListener('mousemove', draw);
                canvas.addEventListener('mouseup', stopDrawing);
                
                // Touch events
                canvas.addEventListener('touchstart', handleTouch);
                canvas.addEventListener('touchmove', handleTouch);
                canvas.addEventListener('touchend', stopDrawing);
            }
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            ctx.beginPath();
            ctx.moveTo((e.clientX - rect.left) * scaleX, (e.clientY - rect.top) * scaleY);
            
            awardXP(5, 'canvas-first-draw');
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            ctx.strokeStyle = currentColor;
            ctx.lineTo((e.clientX - rect.left) * scaleX, (e.clientY - rect.top) * scaleY);
            ctx.stroke();
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                            e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function changeCanvasColor(color) {
            currentColor = color;
        }

        // Exam functions
        function updateExamProgress(inputId, maxMarks) {
            const input = document.getElementById(inputId);
            const text = input.value;
            const wordCount = text.split(/\s+/).filter(word => word.length > 0).length;
            
            // Award XP for substantial answers
            if (wordCount >= 30 && !completedActions.has(inputId + '-progress')) {
                awardXP(15, inputId + '-progress');
            }
        }

        function showExamMarkScheme(marksInputId, markSchemeId, minWords) {
            const marksInput = document.getElementById(marksInputId);
            const markScheme = document.getElementById(markSchemeId);
            const examInput = document.getElementById(marksInputId.replace('-marks', ''));
            
            const wordCount = examInput.value.split(/\s+/).filter(word => word.length > 0).length;
            
            if (wordCount >= minWords) {
                markScheme.classList.add('show');
                awardXP(10, markSchemeId);
            } else {
                alert('Please write a more detailed answer before viewing the mark scheme.');
            }
        }

        function updateTotalMarks() {
            const q1Marks = parseInt(document.getElementById('exam-q1-marks').value) || 0;
            const q2Marks = parseInt(document.getElementById('exam-q2-marks').value) || 0;
            const total = q1Marks + q2Marks;
            
            document.getElementById('totalMarks').textContent = total;
            const percentage = (total / 10) * 100;
            document.getElementById('scoreBar').style.width = percentage + '%';
            
            if (total >= 8) {
                unlockAchievement('exam_ready');
            }
        }

        // Extension activity XP
        function awardExtensionXP(element, keywords) {
            const text = element.value.toLowerCase();
            const wordCount = text.split(/\s+/).filter(word => word.length > 2).length;
            
            if (wordCount >= 50) {
                let keywordCount = 0;
                keywords.forEach(keyword => {
                    if (text.includes(keyword.toLowerCase())) {
                        keywordCount++;
                    }
                });
                
                if (keywordCount >= 3 && !completedActions.has(element.id)) {
                    awardXP(25, element.id);
                    
                    // Check if all extension activities complete
                    const extensionInputs = document.querySelectorAll('.extension-activity textarea');
                    let completedCount = 0;
                    extensionInputs.forEach(input => {
                        if (completedActions.has(input.id)) {
                            completedCount++;
                        }
                    });
                    
                    if (completedCount === extensionInputs.length) {
                        unlockAchievement('extension_explorer');
                    }
                }
            }
        }

        // Summary quiz
        function calculateSummaryScore() {
            const questions = ['summary-q1', 'summary-q2', 'summary-q3', 'summary-q4', 'summary-q5', 'summary-q6'];
            let score = 0;
            
            questions.forEach(questionId => {
                if (completedActions.has(questionId)) {
                    score++;
                }
            });
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('summaryResults').style.display = 'block';
            
            const messageElement = document.getElementById('scoreMessage');
            if (score === 6) {
                messageElement.textContent = '🌟 Perfect! You have mastered packet switching concepts!';
                unlockAchievement('summary_champion');
            } else if (score >= 4) {
                messageElement.textContent = '👍 Well done! You have a good understanding of the topic.';
                awardXP(15, 'summary-good');
            } else {
                messageElement.textContent = '📚 Keep studying! Review the content and try again.';
            }
        }

        // Hint system
        function showHint(hintId) {
            document.getElementById(hintId).style.display = 'block';
            hintPenalty += 5;
        }

        // Reset functions
        function resetSection(sectionIndex) {
            const section = document.getElementById(`section${sectionIndex}`);
            
            // Reset all inputs
            section.querySelectorAll('input, select, textarea').forEach(input => {
                input.value = '';
            });
            
            // Reset all options
            section.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
            });
            
            // Reset drop zones
            section.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('filled');
                const answer = zone.dataset.answer;
                if (answer) {
                    if (answer === 'Packet') zone.textContent = 'A unit of data with header and payload';
                    else if (answer === 'Router') zone.textContent = 'Forwards data between networks';
                    else if (answer === 'Gateway') zone.textContent = 'Bridge between different protocols';
                }
            });
            
            // Reset drag items
            section.querySelectorAll('.drag-item').forEach(item => {
                item.style.display = 'block';
                item.classList.remove('selected');
            });
            
            // Reset mark schemes
            section.querySelectorAll('.mark-scheme').forEach(scheme => {
                scheme.classList.remove('show');
            });
            
            // Reset hints
            section.querySelectorAll('.hint-box').forEach(hint => {
                hint.style.display = 'none';
            });
            
            // Clear canvas if in section 4
            if (sectionIndex === 4 && canvas) {
                clearCanvas();
            }
        }

        // Feedback system
        function openFeedback() {
            document.getElementById('feedbackModal').style.display = 'flex';
            updateFeedbackLocation();
        }

        function closeFeedback() {
            document.getElementById('feedbackModal').style.display = 'none';
        }

        function updateFeedbackLocation() {
            const sectionNames = ['Starter', 'Circuit Switching', 'Data Packets', 'Routers', 
                                'Packet Structure', 'Network Types', 'PSTN', 'Gateways', 
                                'Practice Exam', 'Extension', 'Summary', 'Videos'];
            document.getElementById('currentLocation').textContent = window.location.href;
            document.getElementById('currentSection').textContent = sectionNames[currentSection] || 'Unknown';
        }

        function submitFeedback() {
            const type = document.getElementById('feedbackType').value;
            const text = document.getElementById('feedbackText').value;
            const location = document.getElementById('currentLocation').textContent;
            const section = document.getElementById('currentSection').textContent;
            
            if (!text.trim()) {
                alert('Please enter your feedback before sending.');
                return;
            }
            
            // Create email content
            const subject = encodeURIComponent(`Lesson Feedback: ${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const body = encodeURIComponent(`
Feedback Type: ${type.charAt(0).toUpperCase() + type.slice(1)}
Section: ${section}
Page: ${location}

Description:
${text}

Technical Info:
User Agent: ${navigator.userAgent}
Screen Size: ${screen.width}x${screen.height}
            `);
            
            // Open email client
            window.location.href = `mailto:millingtond@mgs.org?subject=${subject}&body=${body}`;
            
            // Close modal and show confirmation
            closeFeedback();
            showAchievement('Feedback Sent!', 'Thank you for helping improve this lesson!', 5);
            
            // Clear form
            document.getElementById('feedbackText').value = '';
        }

        // Paste protection
        function setupPasteProtection() {
            document.addEventListener('paste', function(e) {
                e.preventDefault();
                showPasteShame();
            });
            
            // Disable right-click context menu
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
            
            // Disable common keyboard shortcuts for copying
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 'v' || e.key === 'V') {
                        e.preventDefault();
                        showPasteShame();
                    }
                }
            });
        }

        function showPasteShame() {
            const shame = document.getElementById('pasteShame');
            shame.style.display = 'block';
            setTimeout(() => {
                shame.style.display = 'none';
            }, 2000);
        }

        // Mobile support
        function addSwipeSupport() {
            let startX = 0;
            let startY = 0;
            
            document.addEventListener('touchstart', function(e) {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            });
            
            document.addEventListener('touchend', function(e) {
                const endX = e.changedTouches[0].clientX;
                const endY = e.changedTouches[0].clientY;
                const diffX = startX - endX;
                const diffY = startY - endY;
                
                // Only handle horizontal swipes
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                    if (diffX > 0) {
                        nextSection(); // Swipe left = next
                    } else {
                        previousSection(); // Swipe right = previous
                    }
                }
            });
        }

        // Circuit Switching Simulation Code
        let circuitCanvas, circuitCtx;
        let circuitNodes = [];
        let circuitConnections = [];
        let circuitPath = [];
        let circuitState = 'idle';
        let circuitDataPackets = [];
        let circuitAnimationFrame = 0;

        function initializeCircuitSimulation() {
            circuitCanvas = document.getElementById('circuitCanvas');
            if (!circuitCanvas) {
                console.log('Circuit canvas not found');
                return;
            }
            
            circuitCtx = circuitCanvas.getContext('2d');
            
            // Set canvas size
            function resizeCircuitCanvas() {
                const rect = circuitCanvas.getBoundingClientRect();
                // Ensure minimum dimensions
                circuitCanvas.width = Math.max(rect.width || 600, 600);
                circuitCanvas.height = Math.max(rect.height || 300, 300);
                initializeCircuitNetwork();
                drawCircuitNetwork(); // Draw immediately after sizing
            }
            
            resizeCircuitCanvas();
            window.addEventListener('resize', resizeCircuitCanvas);
            
            // Start animation loop if not already started
            if (!circuitAnimationId) {
                animateCircuit();
            }
        }

        function initializeCircuitNetwork() {
            const w = circuitCanvas.width;
            const h = circuitCanvas.height;
            
            // Define nodes
            circuitNodes = [
                { id: 'A', x: w * 0.1, y: h * 0.5, label: 'Device A' },
                { id: 'S1', x: w * 0.25, y: h * 0.3, label: 'Switch 1' },
                { id: 'S2', x: w * 0.25, y: h * 0.7, label: 'Switch 2' },
                { id: 'S3', x: w * 0.45, y: h * 0.2, label: 'Switch 3' },
                { id: 'S4', x: w * 0.45, y: h * 0.5, label: 'Switch 4' },
                { id: 'S5', x: w * 0.45, y: h * 0.8, label: 'Switch 5' },
                { id: 'S6', x: w * 0.65, y: h * 0.35, label: 'Switch 6' },
                { id: 'S7', x: w * 0.65, y: h * 0.65, label: 'Switch 7' },
                { id: 'B', x: w * 0.9, y: h * 0.5, label: 'Device B' }
            ];
            
            // Define connections
            circuitConnections = [
                { from: 'A', to: 'S1' },
                { from: 'A', to: 'S2' },
                { from: 'S1', to: 'S3' },
                { from: 'S1', to: 'S4' },
                { from: 'S2', to: 'S4' },
                { from: 'S2', to: 'S5' },
                { from: 'S3', to: 'S6' },
                { from: 'S4', to: 'S6' },
                { from: 'S4', to: 'S7' },
                { from: 'S5', to: 'S7' },
                { from: 'S6', to: 'B' },
                { from: 'S7', to: 'B' }
            ];
            
            // Define circuit path
            circuitPath = ['A', 'S1', 'S4', 'S6', 'B'];
        }

        function drawCircuitNetwork() {
            if (!circuitCtx) return;
            
            circuitCtx.clearRect(0, 0, circuitCanvas.width, circuitCanvas.height);
            
            // Draw connections
            circuitConnections.forEach(conn => {
                const fromNode = circuitNodes.find(n => n.id === conn.from);
                const toNode = circuitNodes.find(n => n.id === conn.to);
                
                if (!fromNode || !toNode) return;
                
                circuitCtx.beginPath();
                circuitCtx.moveTo(fromNode.x, fromNode.y);
                circuitCtx.lineTo(toNode.x, toNode.y);
                
                // Check if connection is part of active circuit
                const isInPath = circuitPath.includes(conn.from) && circuitPath.includes(conn.to) &&
                    Math.abs(circuitPath.indexOf(conn.from) - circuitPath.indexOf(conn.to)) === 1;
                
                if (isInPath && circuitState !== 'idle') {
                    circuitCtx.strokeStyle = '#ff9800';
                    circuitCtx.lineWidth = 4;
                } else {
                    circuitCtx.strokeStyle = '#e0e0e0';
                    circuitCtx.lineWidth = 2;
                }
                
                circuitCtx.stroke();
            });
            
            // Draw data packets
            circuitDataPackets.forEach(packet => {
                circuitCtx.fillStyle = '#4CAF50';
                circuitCtx.beginPath();
                circuitCtx.arc(packet.x, packet.y, 6, 0, Math.PI * 2);
                circuitCtx.fill();
            });
            
            // Draw nodes
            circuitNodes.forEach(node => {
                // Node circle
                circuitCtx.fillStyle = (node.id === 'A' || node.id === 'B') ? '#2196F3' : '#9e9e9e';
                circuitCtx.beginPath();
                circuitCtx.arc(node.x, node.y, 15, 0, Math.PI * 2);
                circuitCtx.fill();
                
                // Node border
                circuitCtx.strokeStyle = '#333';
                circuitCtx.lineWidth = 2;
                circuitCtx.stroke();
                
                // Node label
                circuitCtx.fillStyle = '#333';
                circuitCtx.font = 'bold 12px Arial';
                circuitCtx.textAlign = 'center';
                circuitCtx.textBaseline = 'bottom';
                circuitCtx.fillText(node.label, node.x, node.y - 20);
            });
            
            // Draw establishing animation
            if (circuitState === 'establishing') {
                const progress = (circuitAnimationFrame % 60) / 60;
                
                for (let i = 0; i < circuitPath.length - 1; i++) {
                    const from = circuitNodes.find(n => n.id === circuitPath[i]);
                    const to = circuitNodes.find(n => n.id === circuitPath[i + 1]);
                    if (!from || !to) continue;
                    
                    const x = from.x + (to.x - from.x) * progress;
                    const y = from.y + (to.y - from.y) * progress;
                    
                    circuitCtx.fillStyle = '#ff9800';
                    circuitCtx.beginPath();
                    circuitCtx.arc(x, y, 4, 0, Math.PI * 2);
                    circuitCtx.fill();
                }
            }
        }

        function updateCircuitDataPackets() {
            circuitDataPackets = circuitDataPackets.filter(packet => {
                if (packet.targetIndex >= circuitPath.length) return false;
                
                const target = circuitNodes.find(n => n.id === circuitPath[packet.targetIndex]);
                if (!target) return false;
                
                const dx = target.x - packet.x;
                const dy = target.y - packet.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 5) {
                    packet.targetIndex++;
                    if (packet.targetIndex >= circuitPath.length) return false;
                }
                
                const speed = 3;
                packet.x += (dx / distance) * speed;
                packet.y += (dy / distance) * speed;
                
                return true;
            });
        }

        let circuitAnimationId = null;

        function animateCircuit() {
            if (!circuitCanvas || !circuitCtx) return;
            
            circuitAnimationFrame++;
            
            if (circuitState === 'transmitting') {
                updateCircuitDataPackets();
            }
            
            drawCircuitNetwork();
            circuitAnimationId = requestAnimationFrame(animateCircuit);
        }

        function startCircuitCall() {
            if (circuitState !== 'idle') return;
            
            circuitState = 'establishing';
            document.getElementById('circuitStatus').textContent = 'Establishing circuit connection...';
            document.getElementById('startCallBtn').disabled = true;
            
            setTimeout(() => {
                circuitState = 'connected';
                document.getElementById('circuitStatus').textContent = 'Circuit established - Ready to transmit';
                document.getElementById('sendDataBtn').disabled = false;
                document.getElementById('endCallBtn').disabled = false;
                awardXP(10, 'circuit-sim-establish');
            }, 3000);
        }

        function sendCircuitData() {
            if (circuitState !== 'connected') return;
            
            circuitState = 'transmitting';
            document.getElementById('circuitStatus').textContent = 'Transmitting data through circuit...';
            document.getElementById('sendDataBtn').disabled = true;
            
            const startNode = circuitNodes.find(n => n.id === 'A');
            if (!startNode) return;
            
            // Create data packets
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    circuitDataPackets.push({
                        x: startNode.x,
                        y: startNode.y,
                        targetIndex: 1
                    });
                }, i * 500);
            }
            
            setTimeout(() => {
                circuitState = 'connected';
                document.getElementById('circuitStatus').textContent = 'Data transmission complete';
                document.getElementById('sendDataBtn').disabled = false;
                awardXP(10, 'circuit-sim-transmit');
            }, 4000);
        }

        function endCircuitCall() {
            if (circuitState === 'idle') return;
            
            circuitState = 'idle';
            circuitDataPackets = [];
            document.getElementById('circuitStatus').textContent = 'Circuit released - Ready for new connection';
            document.getElementById('startCallBtn').disabled = false;
            document.getElementById('sendDataBtn').disabled = true;
            document.getElementById('endCallBtn').disabled = true;
            awardXP(10, 'circuit-sim-complete');
        }

        function resetCircuit() {
            circuitState = 'idle';
            circuitDataPackets = [];
            circuitAnimationFrame = 0;
            document.getElementById('circuitStatus').textContent = 'Ready to establish connection';
            document.getElementById('startCallBtn').disabled = false;
            document.getElementById('sendDataBtn').disabled = true;
            document.getElementById('endCallBtn').disabled = true;
            
            // Redraw the network
            if (circuitCtx) {
                drawCircuitNetwork();
            }
        }

        // Initialize circuit simulation when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initializeCircuitSimulation, 100);
        });
    </script>
</body>
</html>