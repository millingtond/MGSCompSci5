<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Computational Thinking Skills - A Level Computer Science</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #7c3aed;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --highlight-color: #fef3c7;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* High Contrast Mode */
        body.high-contrast {
            --bg-color: #000000;
            --text-color: #ffffff;
            --card-bg: #1a1a1a;
            --border-color: #ffffff;
            --primary-color: #00ff00;
            --secondary-color: #ffff00;
        }

        /* Dyslexia Font */
        body.dyslexia-font {
            font-family: 'Comic Sans MS', 'OpenDyslexic', sans-serif;
            letter-spacing: 0.1em;
            word-spacing: 0.2em;
            line-height: 1.8;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* XP Bar */
        .xp-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            backdrop-filter: blur(10px);
        }

        .xp-bar {
            width: 200px;
            height: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24, #f59e0b);
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .xp-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .level-badge {
            font-size: 0.9rem;
            font-weight: 600;
            background: rgba(255,255,255,0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
        }

        /* Navigation */
        .nav-container {
            background: white;
            padding: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 80px;
            z-index: 999;
            box-shadow: var(--shadow);
        }

        .nav-pills {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding: 0.5rem;
            max-width: 1200px;
            margin: 0 auto;
            scrollbar-width: thin;
        }

        .nav-pill {
            padding: 0.5rem 1rem;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 2rem;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .nav-pill:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .nav-pill.active {
            background: var(--primary-color);
            color: white;
            box-shadow: var(--shadow);
        }

        .nav-pill.completed {
            border-color: var(--success-color);
            position: relative;
        }

        .nav-pill.completed::after {
            content: '✓';
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--success-color);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card */
        .card {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Interactive Areas */
        .interactive-area {
            background: var(--bg-color);
            border: 2px dashed var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1rem 0;
            transition: all 0.3s;
        }

        .interactive-area:hover {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.05);
        }

        .highlight {
            background: var(--highlight-color);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--bg-color);
            color: var(--text-color);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-danger {
            background: var(--error-color);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            transform: translateX(400px);
            transition: transform 0.5s ease;
            z-index: 2000;
            max-width: 300px;
            border: 2px solid var(--success-color);
        }

        .achievement-popup.show {
            transform: translateX(0);
        }

        .achievement-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 0.5rem;
            animation: bounce 0.6s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Quiz Options */
        .quiz-option {
            display: block;
            width: 100%;
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-option:hover {
            background: var(--bg-color);
            border-color: var(--primary-color);
            transform: translateX(5px);
        }

        .quiz-option.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .quiz-option.correct {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .quiz-option.incorrect {
            background: var(--error-color);
            color: white;
            border-color: var(--error-color);
        }

        /* Input Fields */
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: inherit;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Drag and Drop (Click Based) */
        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 1rem 0;
        }

        .draggable-item {
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }

        .draggable-item:hover {
            background: var(--bg-color);
            transform: scale(1.02);
        }

        .draggable-item.selected {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .draggable-item.matched {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .drop-zone {
            min-height: 60px;
            padding: 1rem;
            margin: 0.5rem 0;
            border: 2px dashed var(--border-color);
            border-radius: 0.5rem;
            background: var(--bg-color);
            cursor: pointer;
            transition: all 0.3s;
        }

        .drop-zone:hover {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.05);
        }

        .drop-zone.highlight {
            background: rgba(37, 99, 235, 0.1);
            border-color: var(--primary-color);
        }

        .drop-zone.correct {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success-color);
        }

        /* Code Block */
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Consolas', 'Monaco', monospace;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .code-keyword {
            color: #a78bfa;
        }

        .code-string {
            color: #86efac;
        }

        .code-comment {
            color: #64748b;
            font-style: italic;
        }

        /* Simulation */
        .simulation-container {
            background: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .simulation-step {
            display: none;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 0.5rem;
            margin: 0.5rem 0;
            border: 2px solid transparent;
        }

        .simulation-step.active {
            display: block;
            border-color: var(--primary-color);
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .simulation-controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            justify-content: center;
        }

        /* Drawing Canvas */
        .canvas-container {
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            margin: 1rem 0;
            position: relative;
            background: white;
        }

        .drawing-canvas {
            display: block;
            touch-action: none;
            cursor: crosshair;
        }

        /* Feedback Button */
        .feedback-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s;
            z-index: 1000;
        }

        .feedback-btn:hover {
            transform: scale(1.1);
            background: #6b2fc7;
        }

        /* Feedback Modal */
        .feedback-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .feedback-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Accessibility Controls */
        .accessibility-controls {
            position: fixed;
            top: 150px;
            right: 20px;
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
        }

        .accessibility-controls button {
            display: block;
            width: 100%;
            margin: 0.5rem 0;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            background: var(--bg-color);
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .accessibility-controls button:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Progress Indicator */
        .progress-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--border-color);
            transition: all 0.3s;
        }

        .progress-dot.active {
            background: var(--primary-color);
            transform: scale(1.5);
        }

        .progress-dot.completed {
            background: var(--success-color);
        }

        /* Shame Message */
        .shame-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--error-color);
            color: white;
            padding: 2rem;
            border-radius: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            z-index: 3000;
            animation: shameAnimation 3s ease;
        }

        @keyframes shameAnimation {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(0); }
        }

        /* Mark Scheme */
        .mark-scheme {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--success-color);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }

        .mark-scheme.show {
            display: block;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.25rem;
            }

            .header-content {
                flex-direction: column;
            }

            .xp-container {
                width: 100%;
                justify-content: center;
            }

            .matching-container {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .accessibility-controls {
                display: none;
            }
        }

        /* Font Size Controls */
        body.font-small {
            font-size: 14px;
        }

        body.font-large {
            font-size: 18px;
        }

        body.font-xlarge {
            font-size: 20px;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid transparent;
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Particles */
        .particle {
            position: fixed;
            pointer-events: none;
            opacity: 0;
            z-index: 2999;
        }

        @keyframes particleFall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-content">
            <h1>Computational Thinking Skills</h1>
            <div class="xp-container" role="status" aria-live="polite">
                <span class="level-badge">Level <span id="current-level">1</span></span>
                <div class="xp-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <div class="xp-fill" id="xp-fill" style="width: 0%"></div>
                </div>
                <span id="xp-text">0 / 100 XP</span>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-container" role="navigation" aria-label="Lesson sections">
        <div class="nav-pills" id="nav-pills">
            <button class="nav-pill active" data-section="intro" aria-current="page">Introduction</button>
            <button class="nav-pill" data-section="starter">Starter</button>
            <button class="nav-pill" data-section="abstraction">Abstraction</button>
            <button class="nav-pill" data-section="decomposition">Decomposition</button>
            <button class="nav-pill" data-section="pattern">Pattern Recognition</button>
            <button class="nav-pill" data-section="summary">Summary</button>
            <button class="nav-pill" data-section="exam">Exam Practice</button>
            <button class="nav-pill" data-section="extension">Extension</button>
            <button class="nav-pill" data-section="videos">Videos</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" role="main">
        <!-- Introduction Section -->
        <section id="intro" class="section active">
            <div class="card">
                <h2 class="card-title">
                    <span>🧠</span> Welcome to Computational Thinking
                </h2>
                
                <div class="progress-indicator" role="group" aria-label="Section progress">
                    <span class="progress-dot active"></span>
                    <span class="progress-dot"></span>
                    <span class="progress-dot"></span>
                    <span class="progress-dot"></span>
                    <span class="progress-dot"></span>
                </div>

                <h3>Learning Outcomes</h3>
                <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                    <li>Show an understanding of <span class="highlight">abstraction</span></li>
                    <li>Describe and use <span class="highlight">decomposition</span></li>
                    <li>Identify and apply <span class="highlight">pattern recognition</span></li>
                    <li>Create abstract models of systems</li>
                    <li>Break down complex problems into manageable parts</li>
                </ul>

                <div class="interactive-area">
                    <h4>Quick Check: What do you already know?</h4>
                    <p>Which of these is NOT a computational thinking skill?</p>
                    <button class="quiz-option" data-answer="a">Abstraction</button>
                    <button class="quiz-option" data-answer="b">Compilation</button>
                    <button class="quiz-option" data-answer="c">Decomposition</button>
                    <button class="quiz-option" data-answer="d">Pattern Recognition</button>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="navigateSection('next')">
                        Start Learning →
                    </button>
                </div>
            </div>
        </section>

        <!-- Starter Activity -->
        <section id="starter" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🎯</span> Starter Activity: Pattern Matching
                </h2>
                
                <p>Match each computational thinking concept with its description by clicking first on the concept, then on its matching description.</p>
                
                <div class="matching-container" id="starter-matching">
                    <div>
                        <h4>Concepts</h4>
                        <div class="draggable-item" data-id="abstraction">Abstraction</div>
                        <div class="draggable-item" data-id="decomposition">Decomposition</div>
                        <div class="draggable-item" data-id="pattern">Pattern Recognition</div>
                        <div class="draggable-item" data-id="algorithm">Algorithm Design</div>
                    </div>
                    <div>
                        <h4>Descriptions</h4>
                        <div class="drop-zone" data-match="abstraction">Removing unnecessary details</div>
                        <div class="drop-zone" data-match="decomposition">Breaking problems into smaller parts</div>
                        <div class="drop-zone" data-match="pattern">Finding similarities in problems</div>
                        <div class="drop-zone" data-match="algorithm">Creating step-by-step solutions</div>
                    </div>
                </div>
                
                <button class="btn btn-secondary" onclick="resetStarterActivity()">Reset Activity</button>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Abstraction Section -->
        <section id="abstraction" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🎨</span> Understanding Abstraction
                </h2>
                
                <h3>What is Abstraction?</h3>
                <p>Abstraction is the process of <span class="highlight">extracting essential information</span> while ignoring irrelevant details for the provision of a solution.</p>
                
                <div class="interactive-area">
                    <h4>Interactive: Abstraction in Action</h4>
                    <p>Let's see abstraction step-by-step with a London Underground map example:</p>
                    
                    <div class="simulation-container">
                        <div class="simulation-step active" data-step="1">
                            <h5>Step 1: Real-world complexity</h5>
                            <p>A real map would show: streets, buildings, exact distances, geographical features, landmarks, etc.</p>
                        </div>
                        <div class="simulation-step" data-step="2">
                            <h5>Step 2: Identify essential information</h5>
                            <p>For tube travel, we need: station names, line connections, zones</p>
                        </div>
                        <div class="simulation-step" data-step="3">
                            <h5>Step 3: Remove unnecessary details</h5>
                            <p>We don't need: exact geographical positions, street names, building locations</p>
                        </div>
                        <div class="simulation-step" data-step="4">
                            <h5>Step 4: Abstract representation</h5>
                            <p>Result: The simplified tube map showing only stations and connections!</p>
                        </div>
                        
                        <div class="simulation-controls">
                            <button class="btn btn-secondary" onclick="changeSimulationStep('abstraction', -1)">← Previous</button>
                            <span id="abstraction-step-indicator">Step 1 of 4</span>
                            <button class="btn btn-secondary" onclick="changeSimulationStep('abstraction', 1)">Next →</button>
                        </div>
                    </div>
                </div>
                
                <h3>Benefits of Abstraction</h3>
                <div class="interactive-area">
                    <h4>Fill in the blanks</h4>
                    <p>Choose the correct benefits from the options below:</p>
                    
                    <p>1. Abstraction leads to 
                        <select class="input-field" style="width: 200px; display: inline-block;" id="benefit1">
                            <option value="">Choose...</option>
                            <option value="increased">increased</option>
                            <option value="reduced">reduced</option>
                            <option value="complicated">complicated</option>
                        </select> development time.
                    </p>
                    
                    <p>2. The program takes up 
                        <select class="input-field" style="width: 200px; display: inline-block;" id="benefit2">
                            <option value="">Choose...</option>
                            <option value="more">more</option>
                            <option value="less">less</option>
                            <option value="same">same</option>
                        </select> space in memory.
                    </p>
                    
                    <p>3. Customer satisfaction is 
                        <select class="input-field" style="width: 200px; display: inline-block;" id="benefit3">
                            <option value="">Choose...</option>
                            <option value="lower">lower</option>
                            <option value="greater">greater</option>
                            <option value="unchanged">unchanged</option>
                        </select> as requirements are met without extraneous features.
                    </p>
                    
                    <button class="btn btn-primary" onclick="checkAbstractionBenefits()">Check Answers</button>
                </div>
                
                <div class="interactive-area">
                    <h4>Practice: Create an Abstract Model</h4>
                    <p>You need to create a student record system. Which details are ESSENTIAL? (Select all that apply)</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem;">
                        <label><input type="checkbox" id="detail1"> Student ID</label>
                        <label><input type="checkbox" id="detail2"> Shoe size</label>
                        <label><input type="checkbox" id="detail3"> Name</label>
                        <label><input type="checkbox" id="detail4"> Favorite color</label>
                        <label><input type="checkbox" id="detail5"> Grade/Class</label>
                        <label><input type="checkbox" id="detail6"> Hair length</label>
                        <label><input type="checkbox" id="detail7"> Contact information</label>
                        <label><input type="checkbox" id="detail8"> Preferred breakfast</label>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkAbstractionPractice()">Check Selection</button>
                </div>
                
                <button class="btn btn-secondary" onclick="resetAbstractionSection()">Reset Section</button>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Decomposition Section -->
        <section id="decomposition" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🧩</span> Decomposition
                </h2>
                
                <h3>What is Decomposition?</h3>
                <p>Decomposition involves:</p>
                <ol style="margin: 1rem 0; padding-left: 1.5rem;">
                    <li>Breaking down a problem into <span class="highlight">sub-problems</span></li>
                    <li>Making the problem <span class="highlight">easier to understand and solve</span></li>
                    <li>Leading to the concept of <span class="highlight">program modules</span></li>
                </ol>
                
                <div class="interactive-area">
                    <h4>Interactive: Decompose a Problem</h4>
                    <p>Let's decompose the problem of "Creating an Online Shopping System"</p>
                    
                    <div class="simulation-container">
                        <div class="simulation-step active" data-step="1">
                            <h5>Main Problem</h5>
                            <p><strong>Create an Online Shopping System</strong></p>
                            <p>This seems complex! Let's break it down...</p>
                        </div>
                        <div class="simulation-step" data-step="2">
                            <h5>Level 1 Decomposition</h5>
                            <ul>
                                <li>User Management</li>
                                <li>Product Catalog</li>
                                <li>Shopping Cart</li>
                                <li>Payment Processing</li>
                            </ul>
                        </div>
                        <div class="simulation-step" data-step="3">
                            <h5>Level 2 Decomposition (User Management)</h5>
                            <ul>
                                <li>User Registration</li>
                                <li>User Login</li>
                                <li>Password Reset</li>
                                <li>Profile Management</li>
                            </ul>
                        </div>
                        <div class="simulation-step" data-step="4">
                            <h5>Level 3 Decomposition (User Registration)</h5>
                            <ul>
                                <li>Validate email format</li>
                                <li>Check password strength</li>
                                <li>Store user data</li>
                                <li>Send confirmation email</li>
                            </ul>
                        </div>
                        
                        <div class="simulation-controls">
                            <button class="btn btn-secondary" onclick="changeSimulationStep('decomposition', -1)">← Previous</button>
                            <span id="decomposition-step-indicator">Step 1 of 4</span>
                            <button class="btn btn-secondary" onclick="changeSimulationStep('decomposition', 1)">Next →</button>
                        </div>
                    </div>
                </div>
                
                <div class="interactive-area">
                    <h4>Quiz: Decomposition Principles</h4>
                    
                    <p><strong>1. What is the main purpose of decomposition?</strong></p>
                    <button class="quiz-option" onclick="checkDecompQuiz(1, 'a')">To make code run faster</button>
                    <button class="quiz-option" onclick="checkDecompQuiz(1, 'b')">To break complex problems into manageable parts</button>
                    <button class="quiz-option" onclick="checkDecompQuiz(1, 'c')">To reduce memory usage</button>
                    <button class="quiz-option" onclick="checkDecompQuiz(1, 'd')">To improve graphics</button>
                    
                    <p style="margin-top: 1rem;"><strong>2. Decomposition leads to the concept of:</strong></p>
                    <button class="quiz-option" onclick="checkDecompQuiz(2, 'a')">Global variables</button>
                    <button class="quiz-option" onclick="checkDecompQuiz(2, 'b')">Infinite loops</button>
                    <button class="quiz-option" onclick="checkDecompQuiz(2, 'c')">Program modules/functions</button>
                    <button class="quiz-option" onclick="checkDecompQuiz(2, 'd')">Syntax errors</button>
                </div>
                
                <div class="interactive-area">
                    <h4>Practice: Decompose a Task</h4>
                    <p>Order these steps for decomposing "Making a Cup of Tea" (click in correct order):</p>
                    
                    <div id="tea-steps">
                        <button class="quiz-option" data-order="3" onclick="selectTeaStep(this)">Pour hot water into cup</button>
                        <button class="quiz-option" data-order="1" onclick="selectTeaStep(this)">Fill kettle with water</button>
                        <button class="quiz-option" data-order="4" onclick="selectTeaStep(this)">Add milk/sugar if desired</button>
                        <button class="quiz-option" data-order="2" onclick="selectTeaStep(this)">Boil the water</button>
                        <button class="quiz-option" data-order="5" onclick="selectTeaStep(this)">Stir and serve</button>
                    </div>
                    
                    <button class="btn btn-primary" onclick="checkTeaOrder()">Check Order</button>
                </div>
                
                <button class="btn btn-secondary" onclick="resetDecompositionSection()">Reset Section</button>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Pattern Recognition Section -->
        <section id="pattern" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🔍</span> Pattern Recognition
                </h2>
                
                <h3>What is Pattern Recognition?</h3>
                <p>Pattern recognition is the <span class="highlight">identification of parts of a problem that are similar</span> and could use the same solution.</p>
                
                <h4>Benefits:</h4>
                <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                    <li><strong>Code Reusability</strong> - Write once, use many times</li>
                    <li><strong>Efficient Problem Solving</strong> - Apply known solutions to similar problems</li>
                    <li><strong>Reduced Development Time</strong> - Don't reinvent the wheel</li>
                </ul>
                
                <div class="interactive-area">
                    <h4>Interactive: Spot the Pattern</h4>
                    <p>Look at these problems and identify the common pattern:</p>
                    
                    <div class="code-block">
                        <span class="code-comment">// Problem 1: Calculate area of rectangle</span><br>
                        area = length × width<br><br>
                        
                        <span class="code-comment">// Problem 2: Calculate area of screen</span><br>
                        screenArea = screenLength × screenWidth<br><br>
                        
                        <span class="code-comment">// Problem 3: Calculate area of floor</span><br>
                        floorArea = roomLength × roomWidth
                    </div>
                    
                    <p>What pattern do you see?</p>
                    <input type="text" class="input-field" id="pattern-answer" placeholder="Describe the pattern...">
                    <button class="btn btn-primary" onclick="checkPatternAnswer()">Check Answer</button>
                </div>
                
                <div class="interactive-area">
                    <h4>Pattern Recognition Exercise</h4>
                    <p>Match problems that could use the same solution pattern:</p>
                    
                    <div class="matching-container" id="pattern-matching">
                        <div>
                            <h5>Problems</h5>
                            <div class="draggable-item" data-id="p1">Validate email address</div>
                            <div class="draggable-item" data-id="p2">Find largest number in list</div>
                            <div class="draggable-item" data-id="p3">Validate phone number</div>
                            <div class="draggable-item" data-id="p4">Find smallest number in list</div>
                            <div class="draggable-item" data-id="p5">Search for item in list</div>
                            <div class="draggable-item" data-id="p6">Check if user exists</div>
                        </div>
                        <div>
                            <h5>Pattern Categories</h5>
                            <div class="drop-zone" data-match="validation">Validation Pattern</div>
                            <div class="drop-zone" data-match="search">Search Pattern</div>
                            <div class="drop-zone" data-match="comparison">Comparison Pattern</div>
                        </div>
                    </div>
                </div>
                
                <div class="interactive-area">
                    <h4>True or False: Pattern Recognition</h4>
                    
                    <p>1. Pattern recognition helps reduce code duplication</p>
                    <button class="quiz-option" onclick="checkPatternTF(1, true)">True</button>
                    <button class="quiz-option" onclick="checkPatternTF(1, false)">False</button>
                    
                    <p style="margin-top: 1rem;">2. Each problem always needs a completely unique solution</p>
                    <button class="quiz-option" onclick="checkPatternTF(2, true)">True</button>
                    <button class="quiz-option" onclick="checkPatternTF(2, false)">False</button>
                    
                    <p style="margin-top: 1rem;">3. Recognizing patterns can lead to creating reusable functions</p>
                    <button class="quiz-option" onclick="checkPatternTF(3, true)">True</button>
                    <button class="quiz-option" onclick="checkPatternTF(3, false)">False</button>
                </div>
                
                <button class="btn btn-secondary" onclick="resetPatternSection()">Reset Section</button>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Summary Section -->
        <section id="summary" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>📝</span> Summary & Final Quiz
                </h2>
                
                <h3>Key Takeaways</h3>
                <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                    <li><strong>Abstraction</strong> - Extract essential information, ignore irrelevant details</li>
                    <li><strong>Decomposition</strong> - Break complex problems into manageable sub-problems</li>
                    <li><strong>Pattern Recognition</strong> - Identify similarities to reuse solutions</li>
                </ul>
                
                <div class="interactive-area">
                    <h4>Final Assessment</h4>
                    
                    <!-- Question 1 -->
                    <p><strong>1. Which of these is an example of abstraction?</strong></p>
                    <button class="quiz-option" data-question="1" data-answer="a">Writing every detail about a car in a racing game</button>
                    <button class="quiz-option" data-question="1" data-answer="b">Showing only speed, position, and fuel in a racing game</button>
                    <button class="quiz-option" data-question="1" data-answer="c">Including weather patterns in a calculator app</button>
                    <button class="quiz-option" data-question="1" data-answer="d">Adding more features than requested</button>
                    
                    <!-- Question 2 -->
                    <p style="margin-top: 1rem;"><strong>2. Decomposition helps programmers by:</strong></p>
                    <button class="quiz-option" data-question="2" data-answer="a">Making programs run slower</button>
                    <button class="quiz-option" data-question="2" data-answer="b">Creating more bugs</button>
                    <button class="quiz-option" data-question="2" data-answer="c">Allowing teams to work on different parts</button>
                    <button class="quiz-option" data-question="2" data-answer="d">Increasing complexity</button>
                    
                    <!-- Question 3 -->
                    <p style="margin-top: 1rem;"><strong>3. The main benefit of pattern recognition is:</strong></p>
                    <button class="quiz-option" data-question="3" data-answer="a">Making code harder to read</button>
                    <button class="quiz-option" data-question="3" data-answer="b">Code reusability</button>
                    <button class="quiz-option" data-question="3" data-answer="c">Slower execution</button>
                    <button class="quiz-option" data-question="3" data-answer="d">Increased memory usage</button>
                    
                    <!-- Question 4 -->
                    <p style="margin-top: 1rem;"><strong>4. Which statement about abstraction is FALSE?</strong></p>
                    <button class="quiz-option" data-question="4" data-answer="a">It reduces development time</button>
                    <button class="quiz-option" data-question="4" data-answer="b">It includes all possible details</button>
                    <button class="quiz-option" data-question="4" data-answer="c">It focuses on essential information</button>
                    <button class="quiz-option" data-question="4" data-answer="d">It improves customer satisfaction</button>
                    
                    <!-- Question 5 -->
                    <p style="margin-top: 1rem;"><strong>5. Breaking a "Create Website" task into smaller parts is an example of:</strong></p>
                    <button class="quiz-option" data-question="5" data-answer="a">Pattern recognition</button>
                    <button class="quiz-option" data-question="5" data-answer="b">Abstraction</button>
                    <button class="quiz-option" data-question="5" data-answer="c">Decomposition</button>
                    <button class="quiz-option" data-question="5" data-answer="d">Compilation</button>
                    
                    <!-- Question 6 -->
                    <p style="margin-top: 1rem;"><strong>6. True or False: All three computational thinking skills can be used together on the same problem.</strong></p>
                    <button class="quiz-option" data-question="6" data-answer="a">True</button>
                    <button class="quiz-option" data-question="6" data-answer="b">False</button>
                    
                    <button class="btn btn-primary" onclick="submitFinalQuiz()" style="margin-top: 1.5rem;">Submit Quiz</button>
                    
                    <div id="quiz-results" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--bg-color); border-radius: 0.5rem;">
                        <h4>Your Results:</h4>
                        <p id="quiz-score"></p>
                        <div id="quiz-feedback"></div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Exam Practice Section -->
        <section id="exam" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>📋</span> Exam Practice Questions
                </h2>
                
                <div class="interactive-area">
                    <h4>Question 1 (4 marks)</h4>
                    <p>Explain what is meant by abstraction and give two benefits of using abstraction in program development.</p>
                    
                    <textarea class="input-field" id="exam-q1" rows="6" placeholder="Write your answer here..."></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <label>Predicted marks: 
                            <input type="number" id="marks-q1" min="0" max="4" style="width: 50px;" class="input-field">
                        </label>
                        <button class="btn btn-secondary" onclick="showMarkScheme('q1')">Show Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="mark-scheme-q1">
                        <h5>Mark Scheme:</h5>
                        <ul>
                            <li>Definition: Extracting essential information while ignoring irrelevant details (1 mark)</li>
                            <li>Benefit 1: Reduced development time (1 mark)</li>
                            <li>Benefit 2: Smaller program size / Less memory usage (1 mark)</li>
                            <li>Benefit 3: Greater customer satisfaction (1 mark)</li>
                            <li>Any 2 benefits for full marks</li>
                        </ul>
                    </div>
                </div>
                
                <div class="interactive-area">
                    <h4>Question 2 (6 marks)</h4>
                    <p>A programmer needs to create a library management system. Describe how they would use decomposition to tackle this problem. Include at least three sub-problems in your answer.</p>
                    
                    <textarea class="input-field" id="exam-q2" rows="8" placeholder="Write your answer here..."></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <label>Predicted marks: 
                            <input type="number" id="marks-q2" min="0" max="6" style="width: 50px;" class="input-field">
                        </label>
                        <button class="btn btn-secondary" onclick="showMarkScheme('q2')">Show Mark Scheme</button>
                    </div>
                    
                    <div class="mark-scheme" id="mark-scheme-q2">
                        <h5>Mark Scheme:</h5>
                        <ul>
                            <li>Explanation of decomposition process (1 mark)</li>
                            <li>Breaking main problem into sub-problems (1 mark)</li>
                            <li>Sub-problem examples (1 mark each, max 3):
                                <ul>
                                    <li>Book management (add/remove/search books)</li>
                                    <li>Member management (register/update members)</li>
                                    <li>Loan system (borrow/return books)</li>
                                    <li>Fine calculation</li>
                                    <li>Report generation</li>
                                </ul>
                            </li>
                            <li>Mention of modules/functions (1 mark)</li>
                        </ul>
                    </div>
                </div>
                
                <h4>Rough Work Canvas</h4>
                <p>Use this space for calculations or diagrams:</p>
                <div class="canvas-container">
                    <canvas id="drawing-canvas" class="drawing-canvas" width="600" height="300"></canvas>
                </div>
                <button class="btn btn-secondary" onclick="clearCanvas()">Clear Canvas</button>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Extension Section -->
        <section id="extension" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🚀</span> Extension Activities
                </h2>
                
                <h3>Beyond the Specification</h3>
                
                <div class="interactive-area">
                    <h4>Research Task</h4>
                    <p>Investigate how computational thinking is used in machine learning. How do abstraction and pattern recognition play crucial roles in training AI models?</p>
                    
                    <textarea class="input-field" rows="6" placeholder="Write your findings here..."></textarea>
                </div>
                
                <div class="interactive-area">
                    <h4>Real-World Application</h4>
                    <p>Choose a complex real-world system (e.g., online banking, social media platform, autonomous vehicle) and:</p>
                    <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
                        <li>Create an abstract model showing only essential components</li>
                        <li>Decompose it into at least 5 major sub-systems</li>
                        <li>Identify 3 patterns that could be reused across different parts</li>
                    </ol>
                    
                    <textarea class="input-field" rows="8" placeholder="Describe your analysis..."></textarea>
                </div>
                
                <div class="interactive-area">
                    <h4>Advanced Challenge</h4>
                    <p>How might quantum computing change our approach to decomposition? Consider how parallel processing at the quantum level might affect how we break down problems.</p>
                    
                    <textarea class="input-field" rows="4" placeholder="Share your thoughts..."></textarea>
                </div>
                
                <button class="btn btn-primary" onclick="submitExtension()">Submit Extension Work</button>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('next')">Next →</button>
                </div>
            </div>
        </section>

        <!-- Videos Section -->
        <section id="videos" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span>🎥</span> Video Resources
                </h2>
                
                <p>Your teacher will add relevant video links here to support your learning.</p>
                
                <div style="background: var(--bg-color); padding: 3rem; border-radius: 0.5rem; text-align: center; margin: 2rem 0;">
                    <span style="font-size: 4rem;">📹</span>
                    <p>Video content will be added here</p>
                </div>
                
                <h4>Suggested Topics for Videos:</h4>
                <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                    <li>Real-world examples of abstraction</li>
                    <li>Decomposition in software development</li>
                    <li>Pattern recognition in algorithms</li>
                    <li>Computational thinking in different industries</li>
                </ul>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="navigateSection('prev')">← Previous</button>
                    <button class="btn btn-primary" onclick="navigateSection('intro')">Start Over</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievement-popup" role="alert" aria-live="assertive">
        <div class="achievement-icon" id="achievement-icon">🏆</div>
        <h4 id="achievement-title">Achievement Unlocked!</h4>
        <p id="achievement-desc">You've earned a new achievement</p>
    </div>

    <!-- Shame Message -->
    <div class="shame-message" id="shame-message" role="alert">
        🚫 No pasting allowed! Do your own work! 🚫
    </div>

    <!-- Feedback Button -->
    <button class="feedback-btn" onclick="openFeedback()" aria-label="Send feedback">
        💬
    </button>

    <!-- Feedback Modal -->
    <div class="feedback-modal" id="feedback-modal" role="dialog" aria-labelledby="feedback-title">
        <div class="feedback-content">
            <h3 id="feedback-title">Send Feedback</h3>
            <p>Found a bug or have a suggestion? Let us know!</p>
            <p>Current page: <span id="feedback-page"></span></p>
            <textarea class="input-field" id="feedback-text" rows="5" placeholder="Describe the issue or suggestion..."></textarea>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="closeFeedback()">Cancel</button>
                <button class="btn btn-primary" onclick="sendFeedback()">Send</button>
            </div>
        </div>
    </div>

    <!-- Accessibility Controls -->
    <div class="accessibility-controls" role="toolbar" aria-label="Accessibility controls">
        <h4>Accessibility</h4>
        <button onclick="toggleHighContrast()">High Contrast</button>
        <button onclick="toggleDyslexiaFont()">Dyslexia Font</button>
        <button onclick="changeFontSize('small')">A-</button>
        <button onclick="changeFontSize('normal')">A</button>
        <button onclick="changeFontSize('large')">A+</button>
    </div>

    <script>
        // Game State
        let gameState = {
            xp: 0,
            level: 1,
            completedSections: [],
            achievements: [],
            actionsPerformed: new Set(),
            currentSection: 'intro',
            selectedItem: null,
            quizAnswers: {}
        };

        // XP Requirements per level
        const XP_PER_LEVEL = 100;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            setupMatchingActivities();
            initCanvas();
            updateXPDisplay();
        });

        // Event Listeners
        function setupEventListeners() {
            // Navigation pills
            document.querySelectorAll('.nav-pill').forEach(pill => {
                pill.addEventListener('click', () => {
                    navigateToSection(pill.dataset.section);
                });
            });

            // Quiz options
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('quiz-option')) {
                    const siblings = Array.from(e.target.parentElement.querySelectorAll('.quiz-option'));
                    siblings.forEach(s => s.classList.remove('selected'));
                    e.target.classList.add('selected');
                }
            });

            // Prevent paste
            document.addEventListener('paste', function(e) {
                e.preventDefault();
                showShameMessage();
                return false;
            });

            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowLeft') navigateSection('prev');
                if (e.key === 'ArrowRight') navigateSection('next');
            });

            // Touch support for mobile
            let touchStartX = 0;
            document.addEventListener('touchstart', function(e) {
                touchStartX = e.touches[0].clientX;
            });

            document.addEventListener('touchend', function(e) {
                const touchEndX = e.changedTouches[0].clientX;
                const diff = touchStartX - touchEndX;
                
                if (Math.abs(diff) > 50) { // Swipe threshold
                    if (diff > 0) navigateSection('next');
                    else navigateSection('prev');
                }
            });
        }

        // Navigation
        function navigateToSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-pill').forEach(p => p.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
            
            gameState.currentSection = sectionId;
            updateFeedbackPage();
            
            // Award XP for first visit
            if (!gameState.completedSections.includes(sectionId)) {
                awardXP(5, 'Section Visit', `visit_${sectionId}`);
            }
        }

        function navigateSection(direction) {
            const sections = ['intro', 'starter', 'abstraction', 'decomposition', 'pattern', 'summary', 'exam', 'extension', 'videos'];
            const currentIndex = sections.indexOf(gameState.currentSection);
            
            if (direction === 'next' && currentIndex < sections.length - 1) {
                navigateToSection(sections[currentIndex + 1]);
            } else if (direction === 'prev' && currentIndex > 0) {
                navigateToSection(sections[currentIndex - 1]);
            }
        }

        // XP System
        function awardXP(amount, reason, actionId = null) {
            if (actionId && gameState.actionsPerformed.has(actionId)) {
                return; // Already performed this action
            }
            
            if (actionId) {
                gameState.actionsPerformed.add(actionId);
            }
            
            gameState.xp += amount;
            updateXPDisplay();
            checkLevelUp();
            checkAchievements();
            
            // Show floating XP
            showFloatingXP(amount);
        }

        function updateXPDisplay() {
            const xpForNextLevel = gameState.level * XP_PER_LEVEL;
            const xpProgress = (gameState.xp % XP_PER_LEVEL) / XP_PER_LEVEL * 100;
            
            document.getElementById('xp-fill').style.width = xpProgress + '%';
            document.getElementById('xp-text').textContent = `${gameState.xp} / ${xpForNextLevel} XP`;
            document.getElementById('current-level').textContent = gameState.level;
        }

        function checkLevelUp() {
            const newLevel = Math.floor(gameState.xp / XP_PER_LEVEL) + 1;
            if (newLevel > gameState.level && newLevel <= 5) {
                gameState.level = newLevel;
                showAchievement('Level Up!', `You reached Level ${gameState.level}!`, '⬆️');
                createParticles();
            }
        }

        function showFloatingXP(amount) {
            const xpFloat = document.createElement('div');
            xpFloat.style.cssText = `
                position: fixed;
                top: 100px;
                right: 50px;
                color: #f59e0b;
                font-weight: bold;
                font-size: 1.5rem;
                pointer-events: none;
                z-index: 3000;
                animation: floatUp 2s ease-out forwards;
            `;
            xpFloat.textContent = `+${amount} XP`;
            document.body.appendChild(xpFloat);
            
            setTimeout(() => xpFloat.remove(), 2000);
        }

        // Add floating animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes floatUp {
                0% { transform: translateY(0); opacity: 1; }
                100% { transform: translateY(-50px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Achievements
        function checkAchievements() {
            // First correct answer
            if (!gameState.achievements.includes('first_correct') && gameState.actionsPerformed.has('correct_answer')) {
                gameState.achievements.push('first_correct');
                showAchievement('First Steps', 'Got your first correct answer!', '✅');
            }
            
            // Complete all main sections
            const mainSections = ['abstraction', 'decomposition', 'pattern'];
            const allComplete = mainSections.every(s => gameState.completedSections.includes(s));
            if (!gameState.achievements.includes('all_sections') && allComplete) {
                gameState.achievements.push('all_sections');
                showAchievement('Master Thinker', 'Completed all main sections!', '🎓');
            }
            
            // Perfect quiz
            if (!gameState.achievements.includes('perfect_quiz') && gameState.perfectQuiz) {
                gameState.achievements.push('perfect_quiz');
                showAchievement('Perfect Score', 'Got 100% on the final quiz!', '💯');
            }
            
            // Level 5
            if (!gameState.achievements.includes('max_level') && gameState.level === 5) {
                gameState.achievements.push('max_level');
                showAchievement('Maximum Level', 'Reached the highest level!', '👑');
            }
        }

        function showAchievement(title, desc, icon) {
            const popup = document.getElementById('achievement-popup');
            document.getElementById('achievement-title').textContent = title;
            document.getElementById('achievement-desc').textContent = desc;
            document.getElementById('achievement-icon').textContent = icon;
            
            popup.classList.add('show');
            setTimeout(() => popup.classList.remove('show'), 3000);
            
            // Haptic feedback for mobile
            if ('vibrate' in navigator) {
                navigator.vibrate(200);
            }
        }

        // Particles effect
        function createParticles() {
            const colors = ['#fbbf24', '#f59e0b', '#2563eb', '#7c3aed', '#10b981'];
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.cssText = `
                    left: ${Math.random() * window.innerWidth}px;
                    top: ${Math.random() * window.innerHeight}px;
                    width: ${Math.random() * 10 + 5}px;
                    height: ${Math.random() * 10 + 5}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    border-radius: 50%;
                    animation: particleFall ${Math.random() * 3 + 2}s ease-out forwards;
                `;
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 5000);
            }
        }

        // Starter Activity
        function setupMatchingActivities() {
            // Starter matching
            setupMatching('starter-matching', {
                'abstraction': 'abstraction',
                'decomposition': 'decomposition',
                'pattern': 'pattern',
                'algorithm': 'algorithm'
            });
            
            // Pattern matching
            setupMatching('pattern-matching', {
                'p1': 'validation',
                'p2': 'comparison',
                'p3': 'validation',
                'p4': 'comparison',
                'p5': 'search',
                'p6': 'search'
            });
        }

        function setupMatching(containerId, answers) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const items = container.querySelectorAll('.draggable-item');
            const zones = container.querySelectorAll('.drop-zone');
            
            items.forEach(item => {
                item.addEventListener('click', function() {
                    if (this.classList.contains('matched')) return;
                    
                    // Deselect all items
                    items.forEach(i => i.classList.remove('selected'));
                    this.classList.add('selected');
                    gameState.selectedItem = this;
                });
            });
            
            zones.forEach(zone => {
                zone.addEventListener('click', function() {
                    if (!gameState.selectedItem || gameState.selectedItem.classList.contains('matched')) return;
                    
                    const itemId = gameState.selectedItem.dataset.id;
                    const zoneMatch = this.dataset.match;
                    
                    if (answers[itemId] === zoneMatch) {
                        // Correct match
                        gameState.selectedItem.classList.add('matched');
                        gameState.selectedItem.classList.remove('selected');
                        this.classList.add('correct');
                        this.innerHTML += `<div style="margin-top: 0.5rem;">${gameState.selectedItem.textContent}</div>`;
                        
                        awardXP(10, 'Correct Match', `match_${itemId}`);
                        gameState.actionsPerformed.add('correct_answer');
                        
                        // Check if all matched
                        const allMatched = Array.from(items).every(item => item.classList.contains('matched'));
                        if (allMatched && containerId === 'starter-matching') {
                            awardXP(20, 'Starter Complete', 'starter_complete');
                            markSectionComplete('starter');
                        }
                    } else {
                        // Wrong match
                        this.classList.add('highlight');
                        setTimeout(() => this.classList.remove('highlight'), 1000);
                    }
                    
                    gameState.selectedItem = null;
                });
            });
        }

        function resetStarterActivity() {
            const container = document.getElementById('starter-matching');
            if (!container) return;
            
            container.querySelectorAll('.draggable-item').forEach(item => {
                item.classList.remove('matched', 'selected');
            });
            
            container.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('correct', 'highlight');
                const originalText = zone.dataset.match;
                zone.innerHTML = originalText.charAt(0).toUpperCase() + originalText.slice(1).replace(/([A-Z])/g, ' $1');
            });
            
            gameState.selectedItem = null;
        }

        // Abstraction Section
        function changeSimulationStep(simulation, direction) {
            const container = document.querySelector(`#${simulation} .simulation-container`);
            if (!container) return;
            
            const steps = container.querySelectorAll('.simulation-step');
            const activeStep = container.querySelector('.simulation-step.active');
            const currentIndex = Array.from(steps).indexOf(activeStep);
            
            let newIndex = currentIndex + direction;
            if (newIndex < 0) newIndex = 0;
            if (newIndex >= steps.length) newIndex = steps.length - 1;
            
            steps.forEach(s => s.classList.remove('active'));
            steps[newIndex].classList.add('active');
            
            const indicator = document.getElementById(`${simulation}-step-indicator`);
            if (indicator) {
                indicator.textContent = `Step ${newIndex + 1} of ${steps.length}`;
            }
            
            // Award XP for completing simulation
            if (newIndex === steps.length - 1) {
                awardXP(15, 'Simulation Complete', `${simulation}_sim_complete`);
            }
        }

        function checkAbstractionBenefits() {
            const answers = {
                'benefit1': 'reduced',
                'benefit2': 'less',
                'benefit3': 'greater'
            };
            
            let correct = 0;
            for (const [id, answer] of Object.entries(answers)) {
                const select = document.getElementById(id);
                if (select.value === answer) {
                    select.style.borderColor = '#10b981';
                    correct++;
                } else {
                    select.style.borderColor = '#ef4444';
                }
            }
            
            if (correct === 3) {
                awardXP(20, 'Benefits Correct', 'abstraction_benefits');
                showFloatingMessage('Perfect! You understand the benefits of abstraction.');
            } else {
                showFloatingMessage(`${correct}/3 correct. Try again!`);
            }
        }

        function checkAbstractionPractice() {
            const essential = ['detail1', 'detail3', 'detail5', 'detail7'];
            const checked = [];
            
            for (let i = 1; i <= 8; i++) {
                const checkbox = document.getElementById(`detail${i}`);
                if (checkbox.checked) {
                    checked.push(`detail${i}`);
                }
            }
            
            const correct = essential.every(id => checked.includes(id));
            const noExtra = checked.every(id => essential.includes(id));
            
            if (correct && noExtra) {
                awardXP(25, 'Abstract Model', 'abstraction_practice');
                markSectionComplete('abstraction');
                showFloatingMessage('Excellent! You identified only the essential details.');
            } else {
                showFloatingMessage('Not quite. Think about what\'s truly essential for a student record system.');
            }
        }

        function resetAbstractionSection() {
            // Reset dropdowns
            ['benefit1', 'benefit2', 'benefit3'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.value = '';
                    el.style.borderColor = '';
                }
            });
            
            // Reset checkboxes
            for (let i = 1; i <= 8; i++) {
                const checkbox = document.getElementById(`detail${i}`);
                if (checkbox) checkbox.checked = false;
            }
            
            // Reset simulation
            const steps = document.querySelectorAll('#abstraction .simulation-step');
            steps.forEach((s, i) => {
                s.classList.toggle('active', i === 0);
            });
            document.getElementById('abstraction-step-indicator').textContent = 'Step 1 of 4';
        }

        // Decomposition Section
        function checkDecompQuiz(question, answer) {
            const correct = {
                1: 'b',
                2: 'c'
            };
            
            const isCorrect = correct[question] === answer;
            
            // Visual feedback
            const buttons = event.target.parentElement.querySelectorAll('.quiz-option');
            buttons.forEach(btn => {
                btn.classList.remove('correct', 'incorrect');
                if (btn === event.target) {
                    btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
            });
            
            if (isCorrect) {
                awardXP(15, 'Quiz Correct', `decomp_q${question}`);
                gameState.actionsPerformed.add('correct_answer');
            }
            
            // Check if both questions answered correctly
            if (gameState.actionsPerformed.has('decomp_q1') && gameState.actionsPerformed.has('decomp_q2')) {
                markSectionComplete('decomposition');
            }
        }

        let teaOrder = [];
        function selectTeaStep(button) {
            if (!teaOrder.includes(button)) {
                teaOrder.push(button);
                button.style.background = '#2563eb';
                button.style.color = 'white';
                button.textContent = `${teaOrder.length}. ${button.textContent}`;
            }
        }

        function checkTeaOrder() {
            const correctOrder = ['1', '2', '3', '4', '5'];
            const userOrder = teaOrder.map(btn => btn.dataset.order);
            
            const isCorrect = JSON.stringify(userOrder) === JSON.stringify(correctOrder);
            
            if (isCorrect) {
                awardXP(20, 'Tea Order', 'tea_decomposition');
                showFloatingMessage('Perfect! You decomposed the task correctly.');
            } else {
                showFloatingMessage('Not quite right. Think about the logical order of steps.');
                // Reset
                teaOrder = [];
                document.querySelectorAll('#tea-steps .quiz-option').forEach(btn => {
                    btn.style.background = '';
                    btn.style.color = '';
                    btn.textContent = btn.textContent.replace(/^\d+\.\s/, '');
                });
            }
        }

        function resetDecompositionSection() {
            // Reset quiz options
            document.querySelectorAll('#decomposition .quiz-option').forEach(opt => {
                opt.classList.remove('correct', 'incorrect', 'selected');
                opt.style.background = '';
                opt.style.color = '';
            });
            
            // Reset tea order
            teaOrder = [];
            document.querySelectorAll('#tea-steps .quiz-option').forEach(btn => {
                btn.textContent = btn.textContent.replace(/^\d+\.\s/, '');
            });
            
            // Reset simulation
            const steps = document.querySelectorAll('#decomposition .simulation-step');
            steps.forEach((s, i) => {
                s.classList.toggle('active', i === 0);
            });
            document.getElementById('decomposition-step-indicator').textContent = 'Step 1 of 4';
        }

        // Pattern Recognition Section
        function checkPatternAnswer() {
            const input = document.getElementById('pattern-answer');
            const answer = input.value.toLowerCase();
            
            // Check for keywords
            const keywords = ['area', 'multiplication', 'multiply', 'length', 'width', 'rectangle'];
            const hasKeyword = keywords.some(keyword => answer.includes(keyword));
            
            if (hasKeyword && answer.length > 10) {
                awardXP(15, 'Pattern Identified', 'pattern_identification');
                input.style.borderColor = '#10b981';
                showFloatingMessage('Correct! All problems calculate area using length × width.');
            } else {
                input.style.borderColor = '#ef4444';
                showFloatingMessage('Think about what operation is common to all three problems.');
            }
        }

        function checkPatternTF(question, answer) {
            const correct = {
                1: true,
                2: false,
                3: true
            };
            
            const isCorrect = correct[question] === answer;
            const button = event.target;
            
            button.parentElement.querySelectorAll('.quiz-option').forEach(btn => {
                btn.classList.remove('correct', 'incorrect');
            });
            
            button.classList.add(isCorrect ? 'correct' : 'incorrect');
            
            if (isCorrect) {
                awardXP(10, 'TF Correct', `pattern_tf_${question}`);
            }
            
            // Check if all answered
            if (gameState.actionsPerformed.has('pattern_tf_1') && 
                gameState.actionsPerformed.has('pattern_tf_2') && 
                gameState.actionsPerformed.has('pattern_tf_3')) {
                markSectionComplete('pattern');
            }
        }

        function resetPatternSection() {
            // Reset input
            const input = document.getElementById('pattern-answer');
            if (input) {
                input.value = '';
                input.style.borderColor = '';
            }
            
            // Reset matching
            resetMatching('pattern-matching');
            
            // Reset true/false
            document.querySelectorAll('#pattern .quiz-option').forEach(opt => {
                opt.classList.remove('correct', 'incorrect', 'selected');
            });
        }

        function resetMatching(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.querySelectorAll('.draggable-item').forEach(item => {
                item.classList.remove('matched', 'selected');
            });
            
            container.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('correct', 'highlight');
                // Remove added items
                const addedItems = zone.querySelectorAll('div');
                addedItems.forEach(item => item.remove());
            });
            
            gameState.selectedItem = null;
        }

        // Summary Quiz
        function submitFinalQuiz() {
            const answers = {
                1: 'b',
                2: 'c',
                3: 'b',
                4: 'b',
                5: 'c',
                6: 'a'
            };
            
            let correct = 0;
            
            for (const [question, answer] of Object.entries(answers)) {
                const selected = document.querySelector(`.quiz-option[data-question="${question}"].selected`);
                if (selected && selected.dataset.answer === answer) {
                    selected.classList.add('correct');
                    correct++;
                } else if (selected) {
                    selected.classList.add('incorrect');
                    // Show correct answer
                    document.querySelector(`.quiz-option[data-question="${question}"][data-answer="${answer}"]`).classList.add('correct');
                }
            }
            
            const percentage = Math.round((correct / 6) * 100);
            const scoreEl = document.getElementById('quiz-score');
            const feedbackEl = document.getElementById('quiz-feedback');
            
            scoreEl.textContent = `You scored ${correct}/6 (${percentage}%)`;
            
            if (correct === 6) {
                feedbackEl.innerHTML = '<p style="color: #10b981;">Perfect score! You\'ve mastered computational thinking!</p>';
                gameState.perfectQuiz = true;
                awardXP(50, 'Perfect Quiz', 'perfect_final_quiz');
            } else if (correct >= 4) {
                feedbackEl.innerHTML = '<p style="color: #f59e0b;">Good job! Review the incorrect answers to improve.</p>';
                awardXP(30, 'Quiz Complete', 'final_quiz');
            } else {
                feedbackEl.innerHTML = '<p style="color: #ef4444;">Keep studying! Review the material and try again.</p>';
                awardXP(15, 'Quiz Attempt', 'final_quiz_attempt');
            }
            
            document.getElementById('quiz-results').style.display = 'block';
            markSectionComplete('summary');
            checkAchievements();
        }

        // Exam Practice
        function showMarkScheme(question) {
            const textarea = document.getElementById(`exam-${question}`);
            const marks = document.getElementById(`marks-${question}`);
            
            if (textarea.value.length < 50 || !marks.value) {
                alert('Please write a more detailed answer and enter your predicted marks first.');
                return;
            }
            
            document.getElementById(`mark-scheme-${question}`).classList.add('show');
            awardXP(10, 'Exam Practice', `exam_${question}`);
        }

        // Extension
        function submitExtension() {
            const textareas = document.querySelectorAll('#extension textarea');
            let totalWords = 0;
            
            textareas.forEach(ta => {
                totalWords += ta.value.split(' ').filter(word => word.length > 0).length;
            });
            
            if (totalWords > 50) {
                awardXP(30, 'Extension Complete', 'extension_work');
                markSectionComplete('extension');
                showFloatingMessage('Excellent extension work! Your teacher will review your responses.');
            } else {
                showFloatingMessage('Please provide more detailed responses (at least 50 words total).');
            }
        }

        // Canvas for drawing
        function initCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                if (e.touches) {
                    lastX = (e.touches[0].clientX - rect.left) * scaleX;
                    lastY = (e.touches[0].clientY - rect.top) * scaleY;
                } else {
                    lastX = (e.clientX - rect.left) * scaleX;
                    lastY = (e.clientY - rect.top) * scaleY;
                }
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                
                let currentX, currentY;
                if (e.touches) {
                    currentX = (e.touches[0].clientX - rect.left) * scaleX;
                    currentY = (e.touches[0].clientY - rect.top) * scaleY;
                } else {
                    currentX = (e.clientX - rect.left) * scaleX;
                    currentY = (e.clientY - rect.top) * scaleY;
                }
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.strokeStyle = '#1e293b';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                lastX = currentX;
                lastY = currentY;
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
            
            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function clearCanvas() {
            const canvas = document.getElementById('drawing-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Feedback System
        function openFeedback() {
            document.getElementById('feedback-modal').style.display = 'flex';
            updateFeedbackPage();
        }

        function closeFeedback() {
            document.getElementById('feedback-modal').style.display = 'none';
            document.getElementById('feedback-text').value = '';
        }

        function updateFeedbackPage() {
            const sectionNames = {
                'intro': 'Introduction',
                'starter': 'Starter Activity',
                'abstraction': 'Abstraction',
                'decomposition': 'Decomposition',
                'pattern': 'Pattern Recognition',
                'summary': 'Summary & Quiz',
                'exam': 'Exam Practice',
                'extension': 'Extension Activities',
                'videos': 'Videos'
            };
            
            document.getElementById('feedback-page').textContent = sectionNames[gameState.currentSection] || 'Unknown';
        }

        function sendFeedback() {
            const text = document.getElementById('feedback-text').value;
            if (!text.trim()) {
                alert('Please enter your feedback');
                return;
            }
            
            const subject = encodeURIComponent('Computational Thinking Worksheet Feedback');
            const body = encodeURIComponent(`
Page: ${document.getElementById('feedback-page').textContent}
Section ID: ${gameState.currentSection}

Feedback:
${text}

User State:
Level: ${gameState.level}
XP: ${gameState.xp}
Completed Sections: ${gameState.completedSections.join(', ')}
            `);
            
            window.location.href = `mailto:millingtond@mgs.org?subject=${subject}&body=${body}`;
            closeFeedback();
            awardXP(5, 'Feedback Sent', 'feedback_sent');
        }

        // Accessibility
        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
        }

        function toggleDyslexiaFont() {
            document.body.classList.toggle('dyslexia-font');
        }

        function changeFontSize(size) {
            document.body.classList.remove('font-small', 'font-large', 'font-xlarge');
            if (size !== 'normal') {
                document.body.classList.add('font-' + size);
            }
        }

        // Utilities
        function markSectionComplete(section) {
            if (!gameState.completedSections.includes(section)) {
                gameState.completedSections.push(section);
                document.querySelector(`[data-section="${section}"]`).classList.add('completed');
                awardXP(25, 'Section Complete', `complete_${section}`);
            }
        }

        function showFloatingMessage(message) {
            const msg = document.createElement('div');
            msg.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: #1e293b;
                color: white;
                padding: 1rem 2rem;
                border-radius: 0.5rem;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                z-index: 3000;
                animation: fadeInOut 3s ease;
            `;
            msg.textContent = message;
            document.body.appendChild(msg);
            
            setTimeout(() => msg.remove(), 3000);
        }

        // Add fade animation
        const fadeStyle = document.createElement('style');
        fadeStyle.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            }
        `;
        document.head.appendChild(fadeStyle);

        function showShameMessage() {
            const shame = document.getElementById('shame-message');
            shame.style.display = 'block';
            setTimeout(() => shame.style.display = 'none', 3000);
            
            // Deduct XP for trying to paste
            gameState.xp = Math.max(0, gameState.xp - 10);
            updateXPDisplay();
        }

        // Click outside modal to close
        document.getElementById('feedback-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeFeedback();
            }
        });

        // Prevent right-click
        document.addEventListener('contextmenu', e => e.preventDefault());

        // Intro quiz check
        document.querySelector('#intro .quiz-option[data-answer="b"]').addEventListener('click', function() {
            this.classList.add('correct');
            awardXP(10, 'Intro Quiz', 'intro_quiz_correct');
            gameState.actionsPerformed.add('correct_answer');
        });
    </script>
</body>
</html>