<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCSE Python Summer Project - Enhanced Edition</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="Y10Programmingwork.css">
    
    <!-- Add the enhanced CSS here or in a separate file -->
    <link rel="stylesheet" href="enhanced-features.css">

    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/default.min.css">
    
    <!-- CodeMirror JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
    
    <!-- Chart.js for progress visualization (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

        <script src="enhanced-features.js"></script>
            <!-- Chart.js for progress visualization (optional) -->


    
    <!-- Programming Guide -->
    <script src="programming-guide.js"></script>
    
    <!-- jsPDF for PDF export (loaded dynamically when needed) -->
    
    <!-- jsPDF for PDF export (loaded dynamically when needed) -->
</head>
<body>
    <!-- Skip to Content Link -->
    <a href="#mainContent" class="skip-to-content">Skip to main content</a>

    <!-- Loading Message -->
    <div id="loading-message" style="text-align: center; padding: 2rem;">
        <h2>Loading Python Summer Project...</h2>
        <div class="spinner"></div>
        <p>Please wait while we set up the enhanced environment.</p>
    </div>

    <!-- Header -->
    <header class="header" style="display: none;" role="banner">
        <div class="header-content">
            <h1>GCSE Python Summer Project - Enhanced Edition</h1>
            <p id="header-subtitle">70 core tasks + 5 comprehensive challenges. Earn XP and unlock badges!</p>
        </div>
        <div class="header-right">
<button class="btn btn-secondary" id="progress-btn" onclick="if(window.showProgressModal) window.showProgressModal(); else console.error('Progress modal not loaded');" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;">
    📊 Progress
</button>
<button class="btn btn-secondary" id="cert-btn" onclick="if(window.appState && window.appState.exportManager) window.appState.exportManager.generateCertificate(); else console.error('Certificate generator not loaded');" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;">
    🏅 Certificate
</button>
<button class="btn btn-secondary" id="playground-btn" onclick="if(window.showPlaygroundModal) window.showPlaygroundModal(); else console.error('Playground modal not loaded');" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;">
    🎮 Playground
</button>
<button class="btn btn-secondary" id="map-btn" onclick="if(window.showConceptMapModal) window.showConceptMapModal(); else console.error('Concept map modal not loaded');" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;">
    🗺️ Map
</button>
            <button class="btn btn-secondary" id="backup-btn" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;">
                💾 Backup
            </button>
            <button class="btn btn-secondary" id="restore-btn" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;">
                ⬆ Restore
            </button>
            <div class="streak-display" id="streak-display" style="display: none;">
                <span class="streak-flame">🔥</span>
                <span id="streak-count">0 day streak</span>
            </div>
            <div class="xp-display">
                <span class="xp-icon">⭐</span>
                <span class="xp-amount" id="total-xp">0 XP</span>
                <span class="current-badge" id="current-badge">Beginner</span>
            </div>
        </div>
    </header>

    <!-- Backup Reminder Popup -->
    <div class="backup-reminder" id="backup-reminder">
        <button class="close-btn" id="close-reminder">×</button>
        <h4>💾 Time for a backup?</h4>
        <p>It's been a while since your last backup. Download your progress to keep it safe!</p>
        <button class="btn btn-primary" style="margin-top: 0.5rem; font-size: 0.85rem;" id="reminder-backup-btn">Download Backup</button>
    </div>

    <!-- Welcome Backup Modal -->
    <div id="backup-modal" class="backup-modal">
        <div class="backup-modal-content">
            <h2>💾 Welcome Back!</h2>
            <p>Remember to backup your progress regularly to avoid losing your work. Your progress is stored in your browser and could be lost if you clear your data.</p>
            <div class="backup-modal-buttons">
                <button class="btn btn-primary" id="modal-backup-btn">Download Backup Now</button>
                <button class="btn btn-secondary" id="modal-skip-btn">Skip for Now</button>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-container" style="display: none;" role="main">
        <aside class="sidebar" role="navigation" aria-label="Task navigation">
            <div class="badges-section">
                <div class="badges-header">
                    <span>🏆</span>
                    <span>Badges</span>
                </div>
                <div class="badge-list" id="badge-list">
                    <!-- Badges will be generated by JavaScript -->
                </div>
            </div>
            <nav id="sidebar-nav">
                <!-- Navigation will be generated by JavaScript -->
            </nav>
        </aside>
        
        <main class="content" id="mainContent" tabindex="-1">
            <!-- Main content will be generated by JavaScript -->
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast" role="alert" aria-live="polite"></div>
    
    <!-- XP Notification -->
    <div id="xp-notification" class="xp-notification" style="display: none;" role="alert" aria-live="polite">
        <h2>+<span id="xp-earned">0</span> XP!</h2>
        <p id="xp-message">Well done!</p>
    </div>

    <!-- Mobile Menu Button (created dynamically) -->
    <!-- Mobile Overlay (created dynamically) -->

    <!-- Theme Controls (created dynamically) -->
    <!-- Accessibility Panel (created dynamically) -->

    <!-- Debugger Panel (created dynamically) -->

    <!-- External JavaScript -->
    <script src="Y10Programmingwork.js"></script>
    
<script>
    // Ensure proper initialization order
    let enhancedFeaturesReady = false;
    let mainAppReady = false;
    
    function checkAndInitializeEnhanced() {
        if (mainAppReady && !enhancedFeaturesReady) {
            if (typeof initializeEnhancedFeatures === 'function') {
                initializeEnhancedFeatures();
                enhancedFeaturesReady = true;
            } else {
                console.error('initializeEnhancedFeatures not found');
            }
        }
    }
    
    // Wrap the original main function
    const originalMain = main;
    main = async function() {
        try {
            await originalMain();
            mainAppReady = true;
            checkAndInitializeEnhanced();
        } catch (error) {
            console.error('Error in main initialization:', error);
        }
    };
    
    // Also check when enhanced features load
    window.addEventListener('load', () => {
        setTimeout(checkAndInitializeEnhanced, 100);
    });
</script>
</body>
</html>